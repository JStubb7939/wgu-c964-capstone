{"messages": [{"role": "user","content": "Generate a Bicep template for ai-foundry [AiMl/AiFoundry] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/ai-ml/ai-foundry:0.5.0\",\"name\": \"aiFoundry\"}],\"rationale\": \"Creates an AI Foundry account and project with Standard Agent Services.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module aiFoundry 'br/public:avm/ptn/ai-ml/ai-foundry:0.5.0' = {\\n  name: 'aiFoundryDeployment'\\n  params: {\\n    // Required parameters\\n    baseName: '<baseName>'\\n    // Non-required parameters\\n    aiFoundryConfiguration: {\\n      accountName: '<accountName>'\\n      allowProjectManagement: true\\n      createCapabilityHosts: true\\n      disableLocalAuth: true\\n      location: '<location>'\\n      networking: {\\n        agentServiceSubnetResourceId: '<agentServiceSubnetResourceId>'\\n        aiServicesPrivateDnsZoneResourceId: '<aiServicesPrivateDnsZoneResourceId>'\\n        cognitiveServicesPrivateDnsZoneResourceId: '<cognitiveServicesPrivateDnsZoneResourceId>'\\n        openAiPrivateDnsZoneResourceId: '<openAiPrivateDnsZoneResourceId>'\\n      }\\n      project: {\\n        desc: 'This is a custom project for testing.'\\n        displayName: '<displayName>'\\n        name: '<name>'\\n      }\\n      roleAssignments: [\\n        {\\n          principalId: '<principalId>'\\n          principalType: 'ServicePrincipal'\\n          roleDefinitionIdOrName: 'Cognitive Services OpenAI User'\\n        }\\n      ]\\n      sku: 'S0'\\n    }\\n    aiModelDeployments: [\\n      {\\n        model: {\\n          format: 'OpenAI'\\n          name: 'gpt-4o'\\n          version: '2024-11-20'\\n        }\\n        name: 'gpt-4o'\\n        sku: {\\n          capacity: 1\\n          name: 'Standard'\\n        }\\n      }\\n    ]\\n    aiSearchConfiguration: {\\n      name: '<name>'\\n      privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n      roleAssignments: [\\n        {\\n          principalId: '<principalId>'\\n          principalType: 'ServicePrincipal'\\n          roleDefinitionIdOrName: 'Search Index Data Contributor'\\n        }\\n      ]\\n    }\\n    baseUniqueName: '<baseUniqueName>'\\n    cosmosDbConfiguration: {\\n      name: '<name>'\\n      privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n      roleAssignments: [\\n        {\\n          principalId: '<principalId>'\\n          principalType: 'ServicePrincipal'\\n          roleDefinitionIdOrName: 'Cosmos DB Account Reader Role'\\n        }\\n      ]\\n    }\\n    includeAssociatedResources: true\\n    keyVaultConfiguration: {\\n      name: '<name>'\\n      privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n      roleAssignments: [\\n        {\\n          principalId: '<principalId>'\\n          principalType: 'ServicePrincipal'\\n          roleDefinitionIdOrName: 'Key Vault Secrets User'\\n        }\\n      ]\\n    }\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: '<name>'\\n    }\\n    privateEndpointSubnetResourceId: '<privateEndpointSubnetResourceId>'\\n    storageAccountConfiguration: {\\n      blobPrivateDnsZoneResourceId: '<blobPrivateDnsZoneResourceId>'\\n      name: '<name>'\\n      roleAssignments: [\\n        {\\n          principalId: '<principalId>'\\n          principalType: 'ServicePrincipal'\\n          roleDefinitionIdOrName: 'Storage Blob Data Contributor'\\n        }\\n      ]\\n    }\\n    tags: {\\n      Environment: 'Example'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for avm/ptn/alz/ama [Alz/Ama] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/alz/ama:0.1.0\",\"name\": \"ama\"}],\"rationale\": \"This modules deployes resources for Azure Monitoring Agent (AMA) to be used within Azure Landing Zones\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module ama 'br/public:avm/ptn/alz/ama:0.1.0' = {\\n  name: 'amaDeployment'\\n  params: {\\n    // Required parameters\\n    dataCollectionRuleChangeTrackingName: 'alz-ama-dcr-ct-alzamamin'\\n    dataCollectionRuleMDFCSQLName: 'alz-ama-dcr-mdfc-sql-alzamamin'\\n    dataCollectionRuleVMInsightsName: 'alz-ama-dcr-vm-insights-alzamamin'\\n    logAnalyticsWorkspaceResourceId: '<logAnalyticsWorkspaceResourceId>'\\n    userAssignedIdentityName: 'alz-ama-identity-alzamamin'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for IaaS VM with CosmosDB Tier 4 [App/IaasVmCosmosdbTier4] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/app/iaas-vm-cosmosdb-tier4:0.1.0\",\"name\": \"iaasVmCosmosdbTier4\"}],\"rationale\": \"Creates an IaaS VM with CosmosDB Tier 4 resiliency configuration.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module iaasVmCosmosdbTier4 'br/public:avm/ptn/app/iaas-vm-cosmosdb-tier4:0.1.0' = {\\n  name: 'iaasVmCosmosdbTier4Deployment'\\n  params: {\\n    name: '<name>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Policy Assignment at a Management Group, Subscription or Resource Group scope [Authorization/PolicyAssignment] using the Policy Assignments (Management Group scope) configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/authorization/policy-assignment:0.5.0\",\"name\": \"policyAssignment\"}],\"rationale\": \"This module deploys a Policy Assignment at a Management Group, Subscription or Resource Group scope.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module policyAssignment 'br/public:avm/ptn/authorization/policy-assignment:0.5.0' = {\\n  name: 'policyAssignmentDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'apamgmin001'\\n    policyDefinitionId: '/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d'\\n    // Non-required parameters\\n    location: '<location>'\\n    metadata: {\\n      assignedBy: 'Bicep'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Policy Exemption at a Management Group, Subscription or Resource Group scope [Authorization/PolicyExemption] using the Policy Exemptions (Management Group scope) configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/authorization/policy-exemption:0.1.0\",\"name\": \"policyExemption\"}],\"rationale\": \"This module deploys a Policy Exemption at a Management Group, Subscription or Resource Group scope.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module policyExemption 'br/public:avm/ptn/authorization/policy-exemption:0.1.0' = {\\n  name: 'policyExemptionDeployment'\\n  params: {\\n    // Required parameters\\n    exemptionCategory: 'Mitigated'\\n    name: 'apemgmax001'\\n    policyAssignmentId: '<policyAssignmentId>'\\n    // Non-required parameters\\n    assignmentScopeValidation: 'Default'\\n    description: '[Description] Policy Exemption at the management group scope'\\n    displayName: '[DisplayName] Policy Exemption at the management group scope'\\n    enableTelemetry: true\\n    location: '<location>'\\n    managementGroupId: '<managementGroupId>'\\n    metadata: {\\n      assignedBy: 'Bicep'\\n      category: 'Security'\\n    }\\n    resourceSelectors: [\\n      {\\n        name: 'resourceSelector-test'\\n        selectors: [\\n          {\\n            in: [\\n              'Microsoft.Compute/virtualMachines'\\n            ]\\n            kind: 'resourceType'\\n          }\\n          {\\n            in: [\\n              'westeurope'\\n            ]\\n            kind: 'resourceLocation'\\n          }\\n        ]\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Role Assignment at a Management Group, Subscription or Resource Group scope [Authorization/RoleAssignment] using the Role Assignments (Management Group scope) configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/authorization/role-assignment:0.2.0\",\"name\": \"roleAssignment\"}],\"rationale\": \"This module deploys a Role Assignment at a Management Group, Subscription or Resource Group scope.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module roleAssignment 'br/public:avm/ptn/authorization/role-assignment:0.2.0' = {\\n  name: 'roleAssignmentDeployment'\\n  params: {\\n    // Required parameters\\n    principalId: '<principalId>'\\n    roleDefinitionIdOrName: 'Resource Policy Contributor'\\n    // Non-required parameters\\n    location: '<location>'\\n    principalType: 'ServicePrincipal'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a custom role definition to a Management Group [Authorization/RoleDefinition] using the Role Definition (Management Group scope) - Using loadJsonContent configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/authorization/role-definition:0.1.0\",\"name\": \"roleDefinition\"}],\"rationale\": \"This module deploys a custom role definition to a Management Group.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module roleDefinition 'br/public:avm/ptn/authorization/role-definition:0.1.0' = {\\n  name: 'roleDefinitionDeployment'\\n  params: {\\n    // Required parameters\\n    name: '<name>'\\n    // Non-required parameters\\n    actions: '<actions>'\\n    dataActions: '<dataActions>'\\n    description: '<description>'\\n    location: '<location>'\\n    notActions: '<notActions>'\\n    notDataActions: '<notDataActions>'\\n    roleName: '<roleName>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azd Container App Upsert [Azd/ContainerAppUpsert] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/azd/container-app-upsert:0.2.0\",\"name\": \"containerAppUpsert\"}],\"rationale\": \"Creates or updates an existing Azure Container App.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module containerAppUpsert 'br/public:avm/ptn/azd/container-app-upsert:0.2.0' = {\\n  name: 'containerAppUpsertDeployment'\\n  params: {\\n    // Required parameters\\n    containerAppsEnvironmentName: '<containerAppsEnvironmentName>'\\n    name: 'acaumin001'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azd Azure Machine Learning Dependencies [Azd/MlHubDependencies] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/azd/ml-hub-dependencies:0.2.0\",\"name\": \"mlHubDependencies\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS DEPRECATED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module mlHubDependencies 'br/public:avm/ptn/azd/ml-hub-dependencies:0.2.0' = {\\n  name: 'mlHubDependenciesDeployment'\\n  params: {\\n    // Required parameters\\n    cognitiveServicesName: 'cog07hubdmin'\\n    keyVaultName: 'key07hubdmin'\\n    storageAccountName: 'st07hubdmin'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for private-analytical-workspace [Data/PrivateAnalyticalWorkspace] using the Minimal Deployment - allowed IP address configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/data/private-analytical-workspace:0.1.0\",\"name\": \"privateAnalyticalWorkspace\"}],\"rationale\": \"This pattern module enables you to use Azure services that are typical for data analytics solutions. The goal is to help data scientists establish an environment for data analysis simply. It is secure by default for enterprise use. Data scientists should not spend much time on how to build infrastructure solution. They should mainly concentrate on the data analytics components they require for the solution.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module privateAnalyticalWorkspace 'br/public:avm/ptn/data/private-analytical-workspace:0.1.0' = {\\n  name: 'privateAnalyticalWorkspaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dpawminpu002'\\n    // Non-required parameters\\n    advancedOptions: {\\n      keyVault: {\\n        enablePurgeProtection: false\\n      }\\n      networkAcls: {\\n        ipRules: [\\n          '104.43.16.94'\\n        ]\\n      }\\n    }\\n    enableDatabricks: false\\n    tags: {\\n      CostCenter: '123-456-789'\\n      Owner: 'Contoso'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for private-analytical-workspace [Data/PrivateAnalyticalWorkspace] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/data/private-analytical-workspace:0.1.0\",\"name\": \"privateAnalyticalWorkspace\"}],\"rationale\": \"This pattern module enables you to use Azure services that are typical for data analytics solutions. The goal is to help data scientists establish an environment for data analysis simply. It is secure by default for enterprise use. Data scientists should not spend much time on how to build infrastructure solution. They should mainly concentrate on the data analytics components they require for the solution.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module privateAnalyticalWorkspace 'br/public:avm/ptn/data/private-analytical-workspace:0.1.0' = {\\n  name: 'privateAnalyticalWorkspaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dpawwaf002'\\n    // Non-required parameters\\n    advancedOptions: {\\n      keyVault: {\\n        createMode: 'default'\\n        enablePurgeProtection: false\\n        enableSoftDelete: true\\n        sku: 'standard'\\n        softDeleteRetentionInDays: 90\\n      }\\n      logAnalyticsWorkspace: {\\n        dailyQuotaGb: 1\\n        dataRetention: 35\\n      }\\n    }\\n    enableDatabricks: true\\n    enableTelemetry: true\\n    location: '<location>'\\n    tags: {\\n      CostCenter: '123-456-789'\\n      'hidden-title': 'This is visible in the resource name'\\n      Owner: 'Contoso'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for self-hosted agents and runners for Azure DevOps and GitHub on Azure Container Instances and/or Azure Container Apps [DevOps/CicdAgentsAndRunners] using large parameter set for Azure DevOps self-hosted agents using Azure Container Apps."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/dev-ops/cicd-agents-and-runners:0.3.0\",\"name\": \"cicdAgentsAndRunners\"}],\"rationale\": \"This module deploys self-hosted agents and runners for Azure DevOps and GitHub on Azure Container Instances and/or Azure Container Apps.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module cicdAgentsAndRunners 'br/public:avm/ptn/dev-ops/cicd-agents-and-runners:0.3.0' = {\\n  name: 'cicdAgentsAndRunnersDeployment'\\n  params: {\\n    // Required parameters\\n    computeTypes: [\\n      'azure-container-app'\\n    ]\\n    namingPrefix: '<namingPrefix>'\\n    networkingConfiguration: {\\n      addressSpace: '10.0.0.0/16'\\n      containerAppSubnetAddressPrefix: '10.0.1.0/24'\\n      containerAppSubnetName: 'acaSubnet'\\n      networkType: 'createNew'\\n      virtualNetworkName: 'vnet-aca'\\n    }\\n    selfHostedConfig: {\\n      agentNamePrefix: '<agentNamePrefix>'\\n      agentsPoolName: 'aca-pool'\\n      azureContainerAppTarget: {\\n        resources: {\\n          cpu: '1'\\n          memory: '2Gi'\\n        }\\n      }\\n      devOpsOrganization: 'azureDevOpsOrganization'\\n      personalAccessToken: '<personalAccessToken>'\\n      placeHolderAgentName: 'acaPlaceHolderAgent'\\n      selfHostedType: 'azuredevops'\\n      targetPipelinesQueueLength: '1'\\n    }\\n    // Non-required parameters\\n    location: '<location>'\\n    privateNetworking: false\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a subscription to accelerate deployment of landing zones. For more information on how to use it, please visit this [Wiki](https://github.com/Azure/bicep-lz-vending/wiki) [Lz/SubVending] using the Multiple virtual networks configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/lz/sub-vending:0.4.0\",\"name\": \"subVending\"}],\"rationale\": \"This module deploys a subscription to accelerate deployment of landing zones. For more information on how to use it, please visit this [Wiki](https://github.com/Azure/bicep-lz-vending/wiki).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module subVending 'br/public:avm/ptn/lz/sub-vending:0.4.0' = {\\n  name: 'subVendingDeployment'\\n  params: {\\n    additionalVirtualNetworks: [\\n      {\\n        addressPrefixes: [\\n          '10.120.0.0/16'\\n        ]\\n        location: '<location>'\\n        name: '<name>'\\n        resourceGroupLockEnabled: false\\n        resourceGroupName: '<resourceGroupName>'\\n        subnets: [\\n          {\\n            addressPrefix: '10.120.1.0/24'\\n            name: 'subnet1'\\n            networkSecurityGroup: {\\n              location: '<location>'\\n              name: '<name>'\\n              securityRules: [\\n                {\\n                  name: 'Allow-HTTPS'\\n                  properties: {\\n                    access: 'Allow'\\n                    description: 'Allow HTTPS'\\n                    destinationAddressPrefix: '*'\\n                    destinationPortRange: '443'\\n                    direction: 'Inbound'\\n                    priority: 100\\n                    protocol: 'Tcp'\\n                    sourceAddressPrefix: '*'\\n                    sourcePortRange: '*'\\n                  }\\n                }\\n              ]\\n            }\\n          }\\n        ]\\n      }\\n      {\\n        addressPrefixes: [\\n          '10.90.0.0/16'\\n        ]\\n        deployNatGateway: true\\n        location: '<location>'\\n        name: '<name>'\\n        natGatewayConfiguration: {\\n          name: '<name>'\\n        }\\n        peerToHubNetwork: false\\n        resourceGroupLockEnabled: false\\n        resourceGroupName: '<resourceGroupName>'\\n        subnets: [\\n          {\\n            addressPrefix: '10.90.1.0/24'\\n            associateWithNatGateway: true\\n            name: 'data-subnet'\\n            routeTableName: '<routeTableName>'\\n          }\\n        ]\\n      }\\n    ]\\n    peerAllVirtualNetworks: true\\n    resourceProviders: {}\\n    routeTables: [\\n      {\\n        location: '<location>'\\n        name: '<name>'\\n        routes: [\\n          {\\n            name: 'route1'\\n            properties: {\\n              addressPrefix: '0.0.0.0/0'\\n              nextHopType: 'None'\\n            }\\n          }\\n        ]\\n      }\\n    ]\\n    routeTablesResourceGroupName: '<routeTablesResourceGroupName>'\\n    subscriptionAliasEnabled: true\\n    subscriptionAliasName: '<subscriptionAliasName>'\\n    subscriptionBillingScope: '<subscriptionBillingScope>'\\n    subscriptionDisplayName: '<subscriptionDisplayName>'\\n    subscriptionManagementGroupAssociationEnabled: true\\n    subscriptionManagementGroupId: 'bicep-lz-vending-automation-child'\\n    subscriptionTags: {\\n      namePrefix: '<namePrefix>'\\n      serviceShort: '<serviceShort>'\\n    }\\n    subscriptionWorkload: 'Production'\\n    virtualNetworkAddressSpace: [\\n      '10.110.0.0/16'\\n    ]\\n    virtualNetworkEnabled: true\\n    virtualNetworkLocation: '<virtualNetworkLocation>'\\n    virtualNetworkName: '<virtualNetworkName>'\\n    virtualNetworkResourceGroupLockEnabled: false\\n    virtualNetworkResourceGroupName: '<virtualNetworkResourceGroupName>'\\n    virtualNetworkSubnets: [\\n      {\\n        addressPrefix: '10.110.1.0/24'\\n        name: 'app-subnet'\\n        routeTableName: '<routeTableName>'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a subscription to accelerate deployment of landing zones. For more information on how to use it, please visit this [Wiki](https://github.com/Azure/bicep-lz-vending/wiki) [Lz/SubVending] using RBAC conditions."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/lz/sub-vending:0.4.0\",\"name\": \"subVending\"}],\"rationale\": \"This module deploys a subscription to accelerate deployment of landing zones. For more information on how to use it, please visit this [Wiki](https://github.com/Azure/bicep-lz-vending/wiki).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module subVending 'br/public:avm/ptn/lz/sub-vending:0.4.0' = {\\n  name: 'subVendingDeployment'\\n  params: {\\n    resourceProviders: {}\\n    roleAssignmentEnabled: true\\n    roleAssignments: [\\n      {\\n        definition: '/providers/Microsoft.Authorization/roleDefinitions/f58310d9-a9f6-439a-9e8d-f62e7b41a168'\\n        principalId: '<principalId>'\\n        principalType: 'User'\\n        relativeScope: ''\\n        roleAssignmentCondition: {\\n          roleConditionType: {\\n            principleTypesToAssign: [\\n              'Group'\\n              'ServicePrincipal'\\n            ]\\n            rolesToAssign: [\\n              'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n            ]\\n            templateName: 'constrainRolesAndPrincipalTypes'\\n          }\\n        }\\n      }\\n    ]\\n    subscriptionAliasEnabled: true\\n    subscriptionAliasName: '<subscriptionAliasName>'\\n    subscriptionBillingScope: '<subscriptionBillingScope>'\\n    subscriptionDisplayName: '<subscriptionDisplayName>'\\n    subscriptionManagementGroupAssociationEnabled: true\\n    subscriptionManagementGroupId: 'bicep-lz-vending-automation-child'\\n    subscriptionTags: {\\n      namePrefix: '<namePrefix>'\\n      serviceShort: '<serviceShort>'\\n    }\\n    subscriptionWorkload: 'Production'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Hub Networking [Network/HubNetworking] using the No Addons configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/network/hub-networking:0.5.0\",\"name\": \"hubNetworking\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module hubNetworking 'br/public:avm/ptn/network/hub-networking:0.5.0' = {\\n  name: 'hubNetworkingDeployment'\\n  params: {\\n    hubVirtualNetworks: {\\n      hub1: {\\n        addressPrefixes: '<addressPrefixes>'\\n        diagnosticSettings: [\\n          {\\n            eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n            eventHubName: '<eventHubName>'\\n            metricCategories: [\\n              {\\n                category: 'AllMetrics'\\n              }\\n            ]\\n            name: 'customSetting'\\n            storageAccountResourceId: '<storageAccountResourceId>'\\n            workspaceResourceId: '<workspaceResourceId>'\\n          }\\n        ]\\n        dnsServers: [\\n          '10.0.1.6'\\n          '10.0.1.7'\\n        ]\\n        enableAzureFirewall: false\\n        enableBastion: false\\n        enablePeering: false\\n        flowTimeoutInMinutes: 30\\n        location: '<location>'\\n        routes: [\\n          {\\n            name: 'defaultRoute'\\n            properties: {\\n              addressPrefix: '0.0.0.0/0'\\n              nextHopType: 'Internet'\\n            }\\n          }\\n        ]\\n        subnets: [\\n          {\\n            addressPrefix: '<addressPrefix>'\\n            name: 'GatewaySubnet'\\n          }\\n          {\\n            addressPrefix: '<addressPrefix>'\\n            name: 'AzureFirewallSubnet'\\n          }\\n          {\\n            addressPrefix: '<addressPrefix>'\\n            name: 'AzureBastionSubnet'\\n          }\\n        ]\\n        vnetEncryption: false\\n        vnetEncryptionEnforcement: 'AllowUnencrypted'\\n      }\\n    }\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Policy Insights Remediation [PolicyInsights/Remediation] using the Policy Remediation (Management Group scope - max) configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/policy-insights/remediation:0.2.0\",\"name\": \"remediation\"}],\"rationale\": \"This module deploys a Policy Insights Remediation.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module remediation 'br/public:avm/ptn/policy-insights/remediation:0.2.0' = {\\n  name: 'remediationDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'pirmgmax001'\\n    policyAssignmentId: '<policyAssignmentId>'\\n    // Non-required parameters\\n    failureThresholdPercentage: '0.5'\\n    filtersLocations: []\\n    filtersResourceIds: []\\n    location: '<location>'\\n    parallelDeployments: 1\\n    policyDefinitionReferenceId: 'Prerequisite_DeployExtensionWindows'\\n    resourceCount: 10\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Chat-with-your-data-Solution-Accelerator [Sa/ChatWithYourData] using the Sandbox With Azure Cosmos DB configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/sa/chat-with-your-data:0.1.0\",\"name\": \"chatWithYourData\"}],\"rationale\": \"This module contains the resources required to deploy the [Chat-with-your-data-solution-accelerator](https://github.com/Azure-Samples/chat-with-your-data-solution-accelerator) for both Sandbox environments and WAF aligned environments.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module chatWithYourData 'br/public:avm/ptn/sa/chat-with-your-data:0.1.0' = {\\n  name: 'chatWithYourDataDeployment'\\n  params: {\\n    databaseType: 'CosmosDB'\\n    location: '<location>'\\n    solutionName: '<solutionName>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Document Knowledge Mining Solution [Sa/DocumentKnowledgeMining] using the Sandbox configuration with default parameter values configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/sa/document-knowledge-mining:0.1.0\",\"name\": \"documentKnowledgeMining\"}],\"rationale\": \"This module contains the resources required to deploy the [Document Knowledge Mining Solution](https://github.com/microsoft/Document-knowledge-mining-solution) for both Sandbox environments and enterprise-grade environments.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module documentKnowledgeMining 'br/public:avm/ptn/sa/document-knowledge-mining:0.1.0' = {\\n  name: 'documentKnowledgeMiningDeployment'\\n  params: {\\n    // Required parameters\\n    aiDeploymentsLocation: '<aiDeploymentsLocation>'\\n    enableMonitoring: false\\n    enablePrivateNetworking: false\\n    enableRedundancy: false\\n    enableScalability: false\\n    // Non-required parameters\\n    createdBy: 'AVM_Pipeline'\\n    enableTelemetry: true\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Security Center (Defender for Cloud) Configuration [Security/SecurityCenter] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/security/security-center:0.1.0\",\"name\": \"securityCenter\"}],\"rationale\": \"This module deploys an Azure Security Center (Defender for Cloud) Configuration.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module securityCenter 'br/public:avm/ptn/security/security-center:0.1.0' = {\\n  name: 'securityCenterDeployment'\\n  params: {\\n    // Required parameters\\n    scope: '<scope>'\\n    workspaceResourceId: '<workspaceResourceId>'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Custom Images using Azure Image Builder [VirtualMachineImages/AzureImageBuilder] deploying only the assets & image."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/virtual-machine-images/azure-image-builder:0.2.0\",\"name\": \"azureImageBuilder\"}],\"rationale\": \"This module provides you with a packaged solution to create custom images using the Azure Image Builder service publishing to an Azure Compute Gallery.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module azureImageBuilder 'br/public:avm/ptn/virtual-machine-images/azure-image-builder:0.2.0' = {\\n  name: 'azureImageBuilderDeployment'\\n  params: {\\n    // Required parameters\\n    computeGalleryImageDefinitionName: '<computeGalleryImageDefinitionName>'\\n    computeGalleryImageDefinitions: '<computeGalleryImageDefinitions>'\\n    computeGalleryName: '<computeGalleryName>'\\n    imageTemplateImageSource: {\\n      offer: 'ubuntu-24_04-lts'\\n      publisher: 'canonical'\\n      sku: 'server'\\n      type: 'PlatformImage'\\n      version: 'latest'\\n    }\\n    // Non-required parameters\\n    assetsStorageAccountContainerName: '<assetsStorageAccountContainerName>'\\n    assetsStorageAccountName: '<assetsStorageAccountName>'\\n    deploymentScriptManagedIdentityName: '<deploymentScriptManagedIdentityName>'\\n    deploymentScriptStorageAccountName: '<deploymentScriptStorageAccountName>'\\n    deploymentScriptSubnetName: '<deploymentScriptSubnetName>'\\n    deploymentsToPerform: 'Only assets & image'\\n    imageContainerInstanceSubnetName: '<imageContainerInstanceSubnetName>'\\n    imageManagedIdentityName: '<imageManagedIdentityName>'\\n    imageSubnetName: '<imageSubnetName>'\\n    imageTemplateCustomizationSteps: [\\n      {\\n        name: 'Example script'\\n        scriptUri: '<scriptUri>'\\n        type: 'Shell'\\n      }\\n    ]\\n    imageTemplateResourceGroupName: '<imageTemplateResourceGroupName>'\\n    location: '<location>'\\n    resourceGroupName: '<resourceGroupName>'\\n    storageAccountFilesToUpload: [\\n      {\\n        name: '<name>'\\n        value: '<value>'\\n      }\\n    ]\\n    virtualNetworkName: '<virtualNetworkName>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Analysis Services Servers [Microsoft.AnalysisServices/servers] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/analysis-services/server:0.3.0\",\"name\": \"server\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module server 'br/public:avm/res/analysis-services/server:0.3.0' = {\\n  name: 'serverDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'assmin'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for API Management Services [Microsoft.ApiManagement/service] deploying an APIM v2 sku."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/api-management/service:0.11.0\",\"name\": \"service\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module service 'br/public:avm/res/api-management/service:0.11.0' = {\\n  name: 'serviceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'apisv2s001'\\n    publisherEmail: 'apimgmt-noreply@mail.windowsazure.com'\\n    publisherName: 'az-amorg-x-001'\\n    // Non-required parameters\\n    enableDeveloperPortal: true\\n    sku: 'BasicV2'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Container App [Microsoft.App/containerApps] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/app/container-app:0.19.0\",\"name\": \"containerApp\"}],\"rationale\": \"This module deploys a Container App.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module containerApp 'br/public:avm/res/app/container-app:0.19.0' = {\\n  name: 'containerAppDeployment'\\n  params: {\\n    // Required parameters\\n    containers: [\\n      {\\n        image: 'mcr.microsoft.com/k8se/quickstart:latest'\\n        name: 'simple-hello-world-container'\\n        probes: [\\n          {\\n            httpGet: {\\n              httpHeaders: [\\n                {\\n                  name: 'Custom-Header'\\n                  value: 'Awesome'\\n                }\\n              ]\\n              path: '/health'\\n              port: 8080\\n            }\\n            initialDelaySeconds: 3\\n            periodSeconds: 3\\n            type: 'Liveness'\\n          }\\n        ]\\n        resources: {\\n          cpu: '<cpu>'\\n          memory: '0.5Gi'\\n        }\\n      }\\n    ]\\n    environmentResourceId: '<environmentResourceId>'\\n    name: 'acawaf001'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        logCategoriesAndGroups: []\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    ingressAllowInsecure: false\\n    ingressExternal: false\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    tags: {\\n      Env: 'test'\\n      'hidden-title': 'This is visible in the resource name'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for App ManagedEnvironments [Microsoft.App/managedEnvironments] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/app/managed-environment:0.11.0\",\"name\": \"managedEnvironment\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module managedEnvironment 'br/public:avm/res/app/managed-environment:0.11.0' = {\\n  name: 'managedEnvironmentDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'amemax001'\\n    // Non-required parameters\\n    appInsightsConnectionString: '<appInsightsConnectionString>'\\n    appLogsConfiguration: {\\n      destination: 'log-analytics'\\n      logAnalyticsConfiguration: {\\n        customerId: '<customerId>'\\n        sharedKey: '<sharedKey>'\\n      }\\n    }\\n    certificate: {\\n      certificateKeyVaultProperties: {\\n        identityResourceId: '<identityResourceId>'\\n        keyVaultUrl: '<keyVaultUrl>'\\n      }\\n      name: 'dep-cert-amemax'\\n    }\\n    dnsSuffix: 'contoso.com'\\n    dockerBridgeCidr: '172.16.0.1/28'\\n    infrastructureResourceGroupName: '<infrastructureResourceGroupName>'\\n    infrastructureSubnetResourceId: '<infrastructureSubnetResourceId>'\\n    internal: true\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    openTelemetryConfiguration: {\\n      logsConfiguration: {\\n        destinations: [\\n          'appInsights'\\n        ]\\n      }\\n      tracesConfiguration: {\\n        destinations: [\\n          'appInsights'\\n        ]\\n      }\\n    }\\n    peerTrafficEncryption: true\\n    platformReservedCidr: '172.17.17.0/24'\\n    platformReservedDnsIP: '172.17.17.17'\\n    roleAssignments: [\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    storages: [\\n      {\\n        accessMode: 'ReadWrite'\\n        kind: 'SMB'\\n        shareName: 'smbfileshare'\\n        storageAccountName: '<storageAccountName>'\\n      }\\n      {\\n        accessMode: 'ReadWrite'\\n        kind: 'NFS'\\n        shareName: 'nfsfileshare'\\n        storageAccountName: '<storageAccountName>'\\n      }\\n    ]\\n    tags: {\\n      Env: 'test'\\n      'hidden-title': 'This is visible in the resource name'\\n    }\\n    workloadProfiles: [\\n      {\\n        maximumCount: 3\\n        minimumCount: 0\\n        name: 'CAW01'\\n        workloadProfileType: 'D4'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an App Configuration Store [Microsoft.AppConfiguration/configurationStores] using Customer-Managed-Keys with User-Assigned identity."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/app-configuration/configuration-store:0.9.0\",\"name\": \"configurationStore\"}],\"rationale\": \"This module deploys an App Configuration Store.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module configurationStore 'br/public:avm/res/app-configuration/configuration-store:0.9.0' = {\\n  name: 'configurationStoreDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'accencr001'\\n    // Non-required parameters\\n    createMode: 'Default'\\n    customerManagedKey: {\\n      keyName: '<keyName>'\\n      keyVaultResourceId: '<keyVaultResourceId>'\\n      userAssignedIdentityResourceId: '<userAssignedIdentityResourceId>'\\n    }\\n    disableLocalAuth: '<disableLocalAuth>'\\n    enablePurgeProtection: false\\n    keyValues: [\\n      {\\n        contentType: 'contentType'\\n        name: 'keyName'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Reader'\\n          }\\n        ]\\n        value: 'valueName'\\n      }\\n    ]\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    softDeleteRetentionInDays: 1\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Policy Assignment at a Resource Group scope. Optionally, it further assigns permissions to the policy's identity (if configured) to various scopes. Note, if you provide any role definition ids and or define additional scopes to assign permissions to, set permissions are deployled as a permutation of the provided parameters. In other words, each role would be provided to each scope for the assignment's identity [Microsoft.Authorization/policyAssignments] using only defaults (Resource Group scope)."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/authorization/policy-assignment/rg-scope:0.1.0\",\"name\": \"policyAssignment\"}],\"rationale\": \"This module deploys a Policy Assignment at a Resource Group scope. Optionally, it further assigns permissions to the policy's identity (if configured) to various scopes. Note, if you provide any role definition ids and or define additional scopes to assign permissions to, set permissions are deployled as a permutation of the provided parameters. In other words, each role would be provided to each scope for the assignment's identity.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module policyAssignment 'br/public:avm/res/authorization/policy-assignment/rg-scope:0.1.0' = {\\n  name: 'policyAssignmentDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'rapargmin001'\\n    policyDefinitionId: '/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d'\\n    // Non-required parameters\\n    metadata: {\\n      assignedBy: 'Bicep'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Role Assignment at a Management Group scope [Microsoft.Authorization/roleAssignments] using large parameter set (Management Group scope)."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/authorization/role-assignment/mg-scope:0.1.0\",\"name\": \"roleAssignment\"}],\"rationale\": \"This module deploys a Role Assignment at a Management Group scope.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module roleAssignment 'br/public:avm/res/authorization/role-assignment/mg-scope:0.1.0' = {\\n  name: 'roleAssignmentDeployment'\\n  params: {\\n    // Required parameters\\n    principalId: '<principalId>'\\n    roleDefinitionIdOrName: 'Management Group Reader'\\n    // Non-required parameters\\n    description: 'Role Assignment (management group scope)'\\n    location: '<location>'\\n    managementGroupId: '<managementGroupId>'\\n    principalType: 'ServicePrincipal'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Role Assignment at a Subscription scope [Microsoft.Authorization/roleAssignments] using the WAF-aligned (Subscription scope) configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/authorization/role-assignment/sub-scope:0.1.0\",\"name\": \"roleAssignment\"}],\"rationale\": \"This module deploys a Role Assignment at a Subscription scope.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module roleAssignment 'br/public:avm/res/authorization/role-assignment/sub-scope:0.1.0' = {\\n  name: 'roleAssignmentDeployment'\\n  params: {\\n    // Required parameters\\n    principalId: '<principalId>'\\n    roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n    // Non-required parameters\\n    principalType: 'ServicePrincipal'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Stack HCI Logical Network [Microsoft.AzureStackHCI/logicalNetworks] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/azure-stack-hci/logical-network:0.2.0\",\"name\": \"logicalNetwork\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module logicalNetwork 'br/public:avm/res/azure-stack-hci/logical-network:0.2.0' = {\\n  name: 'logicalNetworkDeployment'\\n  params: {\\n    // Required parameters\\n    customLocationResourceId: '<customLocationResourceId>'\\n    name: 'ashlnminlogicalnetwork'\\n    vmSwitchName: '<vmSwitchName>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Stack HCI Virtual Hard Disk [Microsoft.AzureStackHCI/virtualHardDisks] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/azure-stack-hci/virtual-hard-disk:0.1.0\",\"name\": \"virtualHardDisk\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualHardDisk 'br/public:avm/res/azure-stack-hci/virtual-hard-disk:0.1.0' = {\\n  name: 'virtualHardDiskDeployment'\\n  params: {\\n    // Required parameters\\n    customLocationResourceId: '<customLocationResourceId>'\\n    diskSizeGB: 4\\n    dynamic: true\\n    name: 'ashvdmax1'\\n    // Non-required parameters\\n    containerId: '<containerId>'\\n    enableTelemetry: true\\n    location: '<location>'\\n    roleAssignments: [\\n      {\\n        name: 'cbc3932a-1bee-4318-ae76-d70e1ba399c8'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Batch Account [Microsoft.Batch/batchAccounts] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/batch/batch-account:0.11.0\",\"name\": \"batchAccount\"}],\"rationale\": \"This module deploys a Batch Account.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module batchAccount 'br/public:avm/res/batch/batch-account:0.11.0' = {\\n  name: 'batchAccountDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'bbawaf001'\\n    storageAccountResourceId: '<storageAccountResourceId>'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    managedIdentities: {\\n      systemAssigned: true\\n    }\\n    poolAllocationMode: 'BatchService'\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'batchAccount'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    storageAccessIdentityResourceId: '<storageAccessIdentityResourceId>'\\n    storageAuthenticationMode: 'BatchAccountManagedIdentity'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Redis Cache [Microsoft.Cache/redis] using data persistence configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/cache/redis:0.16.0\",\"name\": \"redis\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module redis 'br/public:avm/res/cache/redis:0.16.0' = {\\n  name: 'redisDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'crper001'\\n    // Non-required parameters\\n    location: '<location>'\\n    redisConfiguration: {\\n      'rdb-backup-enabled': 'true'\\n      'rdb-backup-frequency': '60'\\n      'rdb-backup-max-snapshot-count': '1'\\n      'rdb-storage-connection-string': '<rdb-storage-connection-string>'\\n    }\\n    skuName: 'Premium'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Redis Enterprise or Azure Managed Redis cache [Microsoft.Cache/redisEnterprise] deploying with a key vault reference to save secrets."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/cache/redis-enterprise:0.3.0\",\"name\": \"redisEnterprise\"}],\"rationale\": \"This module deploys a Redis Enterprise or Azure Managed Redis cache.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module redisEnterprise 'br/public:avm/res/cache/redis-enterprise:0.3.0' = {\\n  name: 'redisEnterpriseDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'kvref'\\n    // Non-required parameters\\n    database: {\\n      secretsExportConfiguration: {\\n        keyVaultResourceId: '<keyVaultResourceId>'\\n        primaryAccessKeyName: 'custom-primaryAccessKey-name'\\n        primaryConnectionStringName: 'custom-primaryConnectionString-name'\\n        primaryStackExchangeRedisConnectionStringName: 'custom-primaryStackExchangeRedisConnectionString-name'\\n        secondaryAccessKeyName: 'custom-secondaryAccessKey-name'\\n        secondaryConnectionStringName: 'custom-secondaryConnectionString-name'\\n        secondaryStackExchangeRedisConnectionStringName: 'custom-secondaryStackExchangeRedisConnectionString-name'\\n      }\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a CDN Profile [Microsoft.Cdn/profiles] using maximum parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/cdn/profile:0.16.0\",\"name\": \"profile\"}],\"rationale\": \"This module deploys a CDN Profile.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module profile 'br/public:avm/res/cdn/profile:0.16.0' = {\\n  name: 'profileDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dep-test-cdnpmax'\\n    sku: 'Premium_AzureFrontDoor'\\n    // Non-required parameters\\n    afdEndpoints: [\\n      {\\n        autoGeneratedDomainNameLabelScope: 'TenantReuse'\\n        enabledState: 'Enabled'\\n        name: 'dep-test-cdnpmax-afd-endpoint-1'\\n        routes: [\\n          {\\n            cacheConfiguration: {\\n              compressionSettings: {\\n                contentTypesToCompress: [\\n                  'application/json'\\n                  'text/css'\\n                  'text/html'\\n                ]\\n                isCompressionEnabled: true\\n              }\\n              queryParameters: 'version,locale'\\n              queryStringCachingBehavior: 'IncludeSpecifiedQueryStrings'\\n            }\\n            customDomainNames: [\\n              'dep-test1-cdnpmax-custom-domain'\\n            ]\\n            enabledState: 'Enabled'\\n            forwardingProtocol: 'MatchRequest'\\n            httpsRedirect: 'Enabled'\\n            linkToDefaultDomain: 'Enabled'\\n            name: 'dep-test-cdnpmax-afd-route-1'\\n            originGroupName: 'dep-test-cdnpmax-origin-group-1'\\n            patternsToMatch: [\\n              '/api/*'\\n              '/health'\\n            ]\\n            ruleSets: [\\n              'deptestcdnpmaxruleset1'\\n            ]\\n            supportedProtocols: [\\n              'Http'\\n              'Https'\\n            ]\\n          }\\n        ]\\n      }\\n    ]\\n    customDomains: [\\n      {\\n        certificateType: 'ManagedCertificate'\\n        hostName: 'dep-test1-cdnpmax-custom-domain.azurewebsites.net'\\n        minimumTlsVersion: 'TLS12'\\n        name: 'dep-test1-cdnpmax-custom-domain'\\n      }\\n      {\\n        certificateType: 'ManagedCertificate'\\n        cipherSuiteSetType: 'TLS12_2022'\\n        hostName: 'dep-test2-cdnpmax-custom-domain.azurewebsites.net'\\n        minimumTlsVersion: 'TLS12'\\n        name: 'dep-test2-cdnpmax-custom-domain'\\n      }\\n      {\\n        certificateType: 'ManagedCertificate'\\n        cipherSuiteSetType: 'Customized'\\n        customizedCipherSuiteSet: {\\n          cipherSuiteSetForTls13: [\\n            'TLS_AES_128_GCM_SHA256'\\n            'TLS_AES_256_GCM_SHA384'\\n          ]\\n        }\\n        hostName: 'dep-test3-cdnpmax-custom-domain.azurewebsites.net'\\n        minimumTlsVersion: 'TLS13'\\n        name: 'dep-test3-cdnpmax-custom-domain'\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        logCategoriesAndGroups: [\\n          {\\n            categoryGroup: 'allLogs'\\n            enabled: true\\n          }\\n        ]\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n            enabled: true\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    location: 'global'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n      notes: 'This resource cannot be deleted for security reasons.'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    originGroups: [\\n      {\\n        healthProbeSettings: {\\n          probeIntervalInSeconds: 120\\n          probePath: '/health'\\n          probeProtocol: 'Https'\\n          probeRequestType: 'GET'\\n        }\\n        loadBalancingSettings: {\\n          additionalLatencyInMilliseconds: 50\\n          sampleSize: 4\\n          successfulSamplesRequired: 3\\n        }\\n        name: 'dep-test-cdnpmax-origin-group-1'\\n        origins: [\\n          {\\n            enabledState: 'Enabled'\\n            enforceCertificateNameCheck: true\\n            hostName: '<hostName>'\\n            httpPort: 80\\n            httpsPort: 443\\n            name: 'dep-test-cdnpmax-origin-1'\\n            priority: 1\\n            weight: 1000\\n          }\\n        ]\\n        sessionAffinityState: 'Enabled'\\n        trafficRestorationTimeToHealedOrNewEndpointsInMinutes: 15\\n      }\\n      {\\n        loadBalancingSettings: {\\n          additionalLatencyInMilliseconds: 100\\n          sampleSize: 6\\n          successfulSamplesRequired: 4\\n        }\\n        name: 'dep-test-cdnpmax-origin-group-2'\\n        origins: [\\n          {\\n            enabledState: 'Enabled'\\n            enforceCertificateNameCheck: true\\n            hostName: '<hostName>'\\n            httpPort: 80\\n            httpsPort: 443\\n            name: 'dep-test-cdnpmax-origin-2'\\n            priority: 1\\n            weight: 1000\\n          }\\n        ]\\n        sessionAffinityState: 'Disabled'\\n        trafficRestorationTimeToHealedOrNewEndpointsInMinutes: 10\\n      }\\n    ]\\n    originResponseTimeoutSeconds: 240\\n    roleAssignments: [\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'CDN Profile Contributor'\\n      }\\n    ]\\n    ruleSets: [\\n      {\\n        name: 'deptestcdnpmaxruleset1'\\n        rules: [\\n          {\\n            actions: [\\n              {\\n                name: 'UrlRedirect'\\n                parameters: {\\n                  customHostname: 'api.example.com'\\n                  customPath: '/v2/api/'\\n                  destinationProtocol: 'Https'\\n                  redirectType: 'PermanentRedirect'\\n                  typeName: 'DeliveryRuleUrlRedirectActionParameters'\\n                }\\n              }\\n            ]\\n            conditions: []\\n            matchProcessingBehavior: 'Continue'\\n            name: 'deptestcdnpmaxrule1'\\n            order: 1\\n          }\\n        ]\\n      }\\n    ]\\n    tags: {\\n      Application: 'CDN'\\n      CostCenter: '12345'\\n      Environment: 'Test'\\n      Owner: 'TestTeam'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Cognitive Service [Microsoft.CognitiveServices/accounts] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/cognitive-services/account:0.13.0\",\"name\": \"account\"}],\"rationale\": \"This module deploys a Cognitive Service.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module account 'br/public:avm/res/cognitive-services/account:0.13.0' = {\\n  name: 'accountDeployment'\\n  params: {\\n    // Required parameters\\n    kind: 'AIServices'\\n    name: 'csamax001'\\n    // Non-required parameters\\n    allowProjectManagement: false\\n    customSubDomainName: 'xcsamax'\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        logCategoriesAndGroups: [\\n          {\\n            category: 'RequestResponse'\\n          }\\n          {\\n            category: 'Audit'\\n          }\\n        ]\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    networkAcls: {\\n      defaultAction: 'Deny'\\n      ipRules: [\\n        {\\n          value: '40.74.28.0/23'\\n        }\\n      ]\\n      virtualNetworkRules: [\\n        {\\n          id: '<id>'\\n          ignoreMissingVnetServiceEndpoint: false\\n        }\\n      ]\\n    }\\n    networkInjections: {\\n      scenario: 'agent'\\n      subnetResourceId: '<subnetResourceId>'\\n      useMicrosoftManagedNetwork: false\\n    }\\n    privateEndpoints: [\\n      {\\n        customDnsConfigs: [\\n          {\\n            fqdn: 'abc.account.com'\\n            ipAddresses: [\\n              '10.0.0.10'\\n            ]\\n          }\\n        ]\\n        ipConfigurations: [\\n          {\\n            name: 'myIPconfigDefault'\\n            properties: {\\n              groupId: 'account'\\n              memberName: 'default'\\n              privateIPAddress: '10.0.0.10'\\n            }\\n          }\\n          {\\n            name: 'myIPconfigSecondary'\\n            properties: {\\n              groupId: 'account'\\n              memberName: 'secondary'\\n              privateIPAddress: '10.0.0.11'\\n            }\\n          }\\n          {\\n            name: 'myIPconfigThird'\\n            properties: {\\n              groupId: 'account'\\n              memberName: 'third'\\n              privateIPAddress: '10.0.0.12'\\n            }\\n          }\\n        ]\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    publicNetworkAccess: 'Disabled'\\n    roleAssignments: [\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    sku: 'S0'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Communication Service [Microsoft.Communication/communicationServices] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/communication/communication-service:0.4.0\",\"name\": \"communicationService\"}],\"rationale\": \"This module deploys a Communication Service\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module communicationService 'br/public:avm/res/communication/communication-service:0.4.0' = {\\n  name: 'communicationServiceDeployment'\\n  params: {\\n    // Required parameters\\n    dataLocation: 'Germany'\\n    name: 'ccsmax001'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    linkedDomains: [\\n      '<emailDomainResourceId>'\\n    ]\\n    location: 'global'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: false\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    roleAssignments: [\\n      {\\n        name: '9237b909-e8fb-4bb8-8194-34aae537cee2'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Availability Set [Microsoft.Compute/availabilitySets] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/availability-set:0.2.0\",\"name\": \"availabilitySet\"}],\"rationale\": \"This module deploys an Availability Set.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module availabilitySet 'br/public:avm/res/compute/availability-set:0.2.0' = {\\n  name: 'availabilitySetDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'caswaf001'\\n    // Non-required parameters\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    proximityPlacementGroupResourceId: '<proximityPlacementGroupResourceId>'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Disk Encryption Set. The module will attempt to set permissions on the provided Key Vault for any used user-assigned identity [Microsoft.Compute/diskEncryptionSets] using Key Vault with the Access Policy permission model."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/disk-encryption-set:0.4.0\",\"name\": \"diskEncryptionSet\"}],\"rationale\": \"This module deploys a Disk Encryption Set. The module will attempt to set permissions on the provided Key Vault for any used user-assigned identity.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module diskEncryptionSet 'br/public:avm/res/compute/disk-encryption-set:0.4.0' = {\\n  name: 'diskEncryptionSetDeployment'\\n  params: {\\n    // Required parameters\\n    keyName: '<keyName>'\\n    keyVaultResourceId: '<keyVaultResourceId>'\\n    name: 'cdesap001'\\n    // Non-required parameters\\n    location: '<location>'\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    roleAssignments: [\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Compute Image [Microsoft.Compute/images] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/image:0.3.0\",\"name\": \"image\"}],\"rationale\": \"This module deploys a Compute Image.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module image 'br/public:avm/res/compute/image:0.3.0' = {\\n  name: 'imageDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'cimin001'\\n    osAccountType: 'Standard_LRS'\\n    osDiskBlobUri: '<osDiskBlobUri>'\\n    osDiskCaching: 'ReadWrite'\\n    osType: 'Windows'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Public SSH Key [Microsoft.Compute/sshPublicKeys] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/ssh-public-key:0.4.0\",\"name\": \"sshPublicKey\"}],\"rationale\": \"This module deploys a Public SSH Key.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module sshPublicKey 'br/public:avm/res/compute/ssh-public-key:0.4.0' = {\\n  name: 'sshPublicKeyDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'sshkey-cspkmax001'\\n    // Non-required parameters\\n    enableTelemetry: true\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'lock'\\n    }\\n    publicKey: '<publicKey>'\\n    roleAssignments: [\\n      {\\n        name: '74ec0421-c3f4-46f2-acf0-b519fe6fcf1c'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Machine with one or multiple NICs and optionally one or multiple public IPs [Microsoft.Compute/virtualMachines] deploying Windows VM with premium SSDv2 data disk and shared disk."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/virtual-machine:0.15.0\",\"name\": \"virtualMachine\"}],\"rationale\": \"This module deploys a Virtual Machine with one or multiple NICs and optionally one or multiple public IPs.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualMachine 'br/public:avm/res/compute/virtual-machine:0.15.0' = {\\n  name: 'virtualMachineDeployment'\\n  params: {\\n    // Required parameters\\n    adminUsername: 'localAdminUser'\\n    availabilityZone: 1\\n    imageReference: {\\n      offer: 'WindowsServer'\\n      publisher: 'MicrosoftWindowsServer'\\n      sku: '2022-datacenter-azure-edition'\\n      version: 'latest'\\n    }\\n    name: 'cvmwindisk'\\n    nicConfigurations: [\\n      {\\n        ipConfigurations: [\\n          {\\n            name: 'ipconfig01'\\n            subnetResourceId: '<subnetResourceId>'\\n          }\\n        ]\\n        nicSuffix: '-nic-01'\\n      }\\n    ]\\n    osDisk: {\\n      caching: 'ReadWrite'\\n      diskSizeGB: 128\\n      managedDisk: {\\n        storageAccountType: 'Premium_LRS'\\n      }\\n    }\\n    osType: 'Windows'\\n    vmSize: 'Standard_D2s_v3'\\n    // Non-required parameters\\n    adminPassword: '<adminPassword>'\\n    dataDisks: [\\n      {\\n        caching: 'None'\\n        diskIOPSReadWrite: 3000\\n        diskMBpsReadWrite: 125\\n        diskSizeGB: 1024\\n        managedDisk: {\\n          storageAccountType: 'PremiumV2_LRS'\\n        }\\n      }\\n      {\\n        managedDisk: {\\n          id: '<id>'\\n        }\\n      }\\n    ]\\n    location: '<location>'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Machine with one or multiple NICs and optionally one or multiple public IPs [Microsoft.Compute/virtualMachines] deploying Windows VM in a defined zone with a premium zrs data disk."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/virtual-machine:0.15.0\",\"name\": \"virtualMachine\"}],\"rationale\": \"This module deploys a Virtual Machine with one or multiple NICs and optionally one or multiple public IPs.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualMachine 'br/public:avm/res/compute/virtual-machine:0.15.0' = {\\n  name: 'virtualMachineDeployment'\\n  params: {\\n    // Required parameters\\n    adminUsername: 'localAdminUser'\\n    availabilityZone: 2\\n    imageReference: {\\n      offer: 'WindowsServer'\\n      publisher: 'MicrosoftWindowsServer'\\n      sku: '2022-datacenter-azure-edition'\\n      version: 'latest'\\n    }\\n    name: 'cvmwinzrs'\\n    nicConfigurations: [\\n      {\\n        ipConfigurations: [\\n          {\\n            name: 'ipconfig01'\\n            subnetResourceId: '<subnetResourceId>'\\n          }\\n        ]\\n        nicSuffix: '-nic-01'\\n      }\\n    ]\\n    osDisk: {\\n      caching: 'ReadWrite'\\n      diskSizeGB: 128\\n      managedDisk: {\\n        storageAccountType: 'Premium_ZRS'\\n      }\\n    }\\n    osType: 'Windows'\\n    vmSize: 'Standard_D2s_v3'\\n    // Non-required parameters\\n    adminPassword: '<adminPassword>'\\n    dataDisks: [\\n      {\\n        caching: 'None'\\n        diskSizeGB: 1024\\n        managedDisk: {\\n          storageAccountType: 'Premium_ZRS'\\n        }\\n      }\\n    ]\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Machine Scale Set [Microsoft.Compute/virtualMachineScaleSets] deploying VMSS in uniform orchestration mode with Windows image."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/virtual-machine-scale-set:0.11.0\",\"name\": \"virtualMachineScaleSet\"}],\"rationale\": \"This module deploys a Virtual Machine Scale Set.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualMachineScaleSet 'br/public:avm/res/compute/virtual-machine-scale-set:0.11.0' = {\\n  name: 'virtualMachineScaleSetDeployment'\\n  params: {\\n    // Required parameters\\n    adminPassword: '<adminPassword>'\\n    adminUsername: 'localAdminUser'\\n    imageReference: {\\n      offer: 'WindowsServer'\\n      publisher: 'MicrosoftWindowsServer'\\n      sku: '2022-datacenter-azure-edition'\\n      version: 'latest'\\n    }\\n    name: 'cvmsswinuni001'\\n    nicConfigurations: [\\n      {\\n        ipConfigurations: [\\n          {\\n            name: 'ipconfig1'\\n            properties: {\\n              publicIPAddressConfiguration: {\\n                name: 'pip-cvmsswinuni'\\n              }\\n              subnet: {\\n                id: '<id>'\\n              }\\n            }\\n          }\\n        ]\\n        nicSuffix: '-nic01'\\n      }\\n    ]\\n    osDisk: {\\n      createOption: 'fromImage'\\n      diskSizeGB: 128\\n      managedDisk: {\\n        storageAccountType: 'Premium_LRS'\\n      }\\n    }\\n    osType: 'Windows'\\n    skuName: 'Standard_B12ms'\\n    // Non-required parameters\\n    orchestrationMode: 'Uniform'\\n    patchMode: 'AutomaticByOS'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Consumption Budget for a Resource Group [Microsoft.Consumption/budgets] using the WAF-aligned (Resource Group scope) configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/consumption/budget/rg-scope:0.1.0\",\"name\": \"budget\"}],\"rationale\": \"This module deploys a Consumption Budget for a Resource Group.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module budget 'br/public:avm/res/consumption/budget/rg-scope:0.1.0' = {\\n  name: 'budgetDeployment'\\n  params: {\\n    // Required parameters\\n    amount: 500\\n    name: 'rcbrgmwaf001'\\n    // Non-required parameters\\n    contactEmails: [\\n      'dummy@contoso.com'\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Container Instance Container Group [Microsoft.ContainerInstance/containerGroups] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/container-instance/container-group:0.6.0\",\"name\": \"containerGroup\"}],\"rationale\": \"This module deploys a Container Instance Container Group.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module containerGroup 'br/public:avm/res/container-instance/container-group:0.6.0' = {\\n  name: 'containerGroupDeployment'\\n  params: {\\n    // Required parameters\\n    availabilityZone: '<availabilityZone>'\\n    containers: [\\n      {\\n        name: '<name>'\\n        properties: {\\n          command: [\\n            '-c'\\n            '/bin/sh'\\n            'node /usr/src/app/index.js & (sleep 10; touch /tmp/ready); wait'\\n          ]\\n          environmentVariables: [\\n            {\\n              name: 'CLIENT_ID'\\n              value: 'TestClientId'\\n            }\\n            {\\n              name: 'CLIENT_SECRET'\\n              secureValue: 'TestSecret'\\n            }\\n          ]\\n          image: 'mcr.microsoft.com/azuredocs/aci-helloworld'\\n          ports: [\\n            {\\n              port: 80\\n              protocol: 'Tcp'\\n            }\\n            {\\n              port: 443\\n              protocol: 'Tcp'\\n            }\\n          ]\\n          readinessProbe: {\\n            exec: {\\n              command: [\\n                '/tmp/ready'\\n                'cat'\\n              ]\\n            }\\n            failureThreshold: 3\\n            initialDelaySeconds: 10\\n            periodSeconds: 5\\n          }\\n          resources: {\\n            limits: {\\n              cpu: 4\\n              memoryInGB: '4'\\n            }\\n            requests: {\\n              cpu: 2\\n              memoryInGB: '2'\\n            }\\n          }\\n        }\\n      }\\n      {\\n        name: '<name>'\\n        properties: {\\n          command: []\\n          environmentVariables: []\\n          image: 'mcr.microsoft.com/azuredocs/aci-helloworld'\\n          ports: [\\n            {\\n              port: 8080\\n              protocol: 'Tcp'\\n            }\\n          ]\\n          resources: {\\n            requests: {\\n              cpu: 2\\n              memoryInGB: '2'\\n            }\\n          }\\n        }\\n      }\\n    ]\\n    name: '<name>'\\n    // Non-required parameters\\n    ipAddress: {\\n      ports: [\\n        {\\n          port: 80\\n          protocol: 'Tcp'\\n        }\\n        {\\n          port: 443\\n          protocol: 'Tcp'\\n        }\\n      ]\\n    }\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    logAnalytics: {\\n      logType: 'ContainerInstanceLogs'\\n      workspaceResourceId: '<workspaceResourceId>'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Container Registry (ACR) [Microsoft.ContainerRegistry/registries] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/container-registry/registry:0.9.0\",\"name\": \"registry\"}],\"rationale\": \"This module deploys an Azure Container Registry (ACR).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module registry 'br/public:avm/res/container-registry/registry:0.9.0' = {\\n  name: 'registryDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'crrwaf001'\\n    // Non-required parameters\\n    acrAdminUserEnabled: false\\n    acrSku: 'Premium'\\n    azureADAuthenticationAsArmPolicyStatus: 'enabled'\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    exportPolicyStatus: 'enabled'\\n    location: '<location>'\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    quarantinePolicyStatus: 'enabled'\\n    replications: [\\n      {\\n        location: '<location>'\\n        name: '<name>'\\n      }\\n    ]\\n    softDeletePolicyDays: 7\\n    softDeletePolicyStatus: 'disabled'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    trustPolicyStatus: 'enabled'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Kubernetes Service (AKS) Managed Cluster [Microsoft.ContainerService/managedClusters] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/container-service/managed-cluster:0.11.0\",\"name\": \"managedCluster\"}],\"rationale\": \"This module deploys an Azure Kubernetes Service (AKS) Managed Cluster.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module managedCluster 'br/public:avm/res/container-service/managed-cluster:0.11.0' = {\\n  name: 'managedClusterDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'cswaf001'\\n    primaryAgentPoolProfiles: [\\n      {\\n        availabilityZones: [\\n          3\\n        ]\\n        count: 1\\n        enableAutoScaling: true\\n        maxCount: 3\\n        maxPods: 50\\n        minCount: 3\\n        mode: 'System'\\n        name: 'systempool'\\n        nodeTaints: [\\n          'CriticalAddonsOnly=true:NoSchedule'\\n        ]\\n        osDiskSizeGB: 0\\n        osType: 'Linux'\\n        type: 'VirtualMachineScaleSets'\\n        vmSize: 'Standard_DS4_v2'\\n        vnetSubnetResourceId: '<vnetSubnetResourceId>'\\n      }\\n    ]\\n    // Non-required parameters\\n    aadProfile: {\\n      aadProfileEnableAzureRBAC: true\\n      aadProfileManaged: true\\n    }\\n    agentPools: [\\n      {\\n        availabilityZones: [\\n          3\\n        ]\\n        count: 2\\n        enableAutoScaling: true\\n        maxCount: 3\\n        maxPods: 50\\n        minCount: 3\\n        minPods: 2\\n        mode: 'User'\\n        name: 'userpool1'\\n        nodeLabels: {}\\n        osDiskSizeGB: 60\\n        osDiskType: 'Ephemeral'\\n        osType: 'Linux'\\n        scaleSetEvictionPolicy: 'Delete'\\n        scaleSetPriority: 'Regular'\\n        type: 'VirtualMachineScaleSets'\\n        vmSize: 'Standard_DS4_v2'\\n        vnetSubnetResourceId: '<vnetSubnetResourceId>'\\n      }\\n      {\\n        availabilityZones: [\\n          3\\n        ]\\n        count: 2\\n        enableAutoScaling: true\\n        maxCount: 3\\n        maxPods: 50\\n        minCount: 3\\n        minPods: 2\\n        mode: 'User'\\n        name: 'userpool2'\\n        nodeLabels: {}\\n        osDiskSizeGB: 60\\n        osDiskType: 'Ephemeral'\\n        osType: 'Linux'\\n        scaleSetEvictionPolicy: 'Delete'\\n        scaleSetPriority: 'Regular'\\n        type: 'VirtualMachineScaleSets'\\n        vmSize: 'Standard_DS4_v2'\\n      }\\n    ]\\n    autoNodeOsUpgradeProfileUpgradeChannel: 'Unmanaged'\\n    autoUpgradeProfileUpgradeChannel: 'stable'\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        logCategoriesAndGroups: [\\n          {\\n            category: 'kube-apiserver'\\n          }\\n          {\\n            category: 'kube-controller-manager'\\n          }\\n          {\\n            category: 'kube-scheduler'\\n          }\\n          {\\n            category: 'cluster-autoscaler'\\n          }\\n        ]\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    disableLocalAccounts: true\\n    dnsServiceIP: '10.10.200.10'\\n    enableAzureDefender: true\\n    enablePrivateCluster: true\\n    maintenanceConfigurations: [\\n      {\\n        maintenanceWindow: {\\n          durationHours: 4\\n          schedule: {\\n            weekly: {\\n              dayOfWeek: 'Sunday'\\n              intervalWeeks: 1\\n            }\\n          }\\n          startDate: '2024-07-15'\\n          startTime: '00:00'\\n          utcOffset: '+00:00'\\n        }\\n        name: 'aksManagedAutoUpgradeSchedule'\\n      }\\n      {\\n        maintenanceWindow: {\\n          durationHours: 4\\n          schedule: {\\n            weekly: {\\n              dayOfWeek: 'Sunday'\\n              intervalWeeks: 1\\n            }\\n          }\\n          startDate: '2024-07-15'\\n          startTime: '00:00'\\n          utcOffset: '+00:00'\\n        }\\n        name: 'aksManagedNodeOSUpgradeSchedule'\\n      }\\n    ]\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    monitoringWorkspaceResourceId: '<monitoringWorkspaceResourceId>'\\n    networkPlugin: 'azure'\\n    networkPolicy: 'azure'\\n    omsAgentEnabled: true\\n    privateDNSZone: '<privateDNSZone>'\\n    serviceCidr: '10.10.200.0/24'\\n    skuTier: 'Standard'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Data Protection Backup Vaults [Microsoft.DataProtection/backupVaults] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/data-protection/backup-vault:0.12.0\",\"name\": \"backupVault\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module backupVault 'br/public:avm/res/data-protection/backup-vault:0.12.0' = {\\n  name: 'backupVaultDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dpbvwaf001'\\n    // Non-required parameters\\n    azureMonitorAlertSettingsAlertsForAllJobFailures: 'Disabled'\\n    backupPolicies: [\\n      {\\n        name: 'DefaultPolicy'\\n        properties: {\\n          datasourceTypes: [\\n            'Microsoft.Compute/disks'\\n          ]\\n          objectType: 'BackupPolicy'\\n          policyRules: [\\n            {\\n              backupParameters: {\\n                backupType: 'Incremental'\\n                objectType: 'AzureBackupParams'\\n              }\\n              dataStore: {\\n                dataStoreType: 'OperationalStore'\\n                objectType: 'DataStoreInfoBase'\\n              }\\n              name: 'BackupDaily'\\n              objectType: 'AzureBackupRule'\\n              trigger: {\\n                objectType: 'ScheduleBasedTriggerContext'\\n                schedule: {\\n                  repeatingTimeIntervals: [\\n                    'R/2022-05-31T23:30:00+01:00/P1D'\\n                  ]\\n                  timeZone: 'W. Europe Standard Time'\\n                }\\n                taggingCriteria: [\\n                  {\\n                    isDefault: true\\n                    taggingPriority: 99\\n                    tagInfo: {\\n                      id: 'Default_'\\n                      tagName: 'Default'\\n                    }\\n                  }\\n                ]\\n              }\\n            }\\n            {\\n              isDefault: true\\n              lifecycles: [\\n                {\\n                  deleteAfter: {\\n                    duration: 'P7D'\\n                    objectType: 'AbsoluteDeleteOption'\\n                  }\\n                  sourceDataStore: {\\n                    dataStoreType: 'OperationalStore'\\n                    objectType: 'DataStoreInfoBase'\\n                  }\\n                  targetDataStoreCopySettings: []\\n                }\\n              ]\\n              name: 'Default'\\n              objectType: 'AzureRetentionRule'\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n    immutabilitySettingState: 'Locked'\\n    location: '<location>'\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    softDeleteSettings: {\\n      retentionDurationInDays: 14\\n      state: 'On'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Databricks Workspaces [Microsoft.Databricks/workspaces] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/databricks/workspace:0.11.0\",\"name\": \"workspace\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module workspace 'br/public:avm/res/databricks/workspace:0.11.0' = {\\n  name: 'workspaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dwmax005'\\n    // Non-required parameters\\n    amlWorkspaceResourceId: '<amlWorkspaceResourceId>'\\n    automaticClusterUpdate: 'Enabled'\\n    complianceSecurityProfileValue: 'Enabled'\\n    complianceStandards: [\\n      'HIPAA'\\n      'PCI_DSS'\\n    ]\\n    customerManagedKey: {\\n      keyName: '<keyName>'\\n      keyVaultResourceId: '<keyVaultResourceId>'\\n    }\\n    customerManagedKeyManagedDisk: {\\n      autoRotationEnabled: false\\n      keyName: '<keyName>'\\n      keyVaultResourceId: '<keyVaultResourceId>'\\n    }\\n    customPrivateSubnetName: '<customPrivateSubnetName>'\\n    customPublicSubnetName: '<customPublicSubnetName>'\\n    customVirtualNetworkResourceId: '<customVirtualNetworkResourceId>'\\n    defaultCatalog: {\\n      initialType: 'UnityCatalog'\\n    }\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        logCategoriesAndGroups: [\\n          {\\n            category: 'jobs'\\n          }\\n          {\\n            category: 'notebook'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    disablePublicIp: true\\n    enhancedSecurityMonitoring: 'Enabled'\\n    loadBalancerBackendPoolName: '<loadBalancerBackendPoolName>'\\n    loadBalancerResourceId: '<loadBalancerResourceId>'\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedResourceGroupResourceId: '<managedResourceGroupResourceId>'\\n    natGatewayName: 'nat-gateway'\\n    prepareEncryption: true\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'databricks_ui_api'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'browser_authentication'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    publicIpName: 'nat-gw-public-ip'\\n    publicNetworkAccess: 'Disabled'\\n    requiredNsgRules: 'NoAzureDatabricksRules'\\n    requireInfrastructureEncryption: true\\n    roleAssignments: [\\n      {\\n        name: '2754e64b-b96e-44bc-9cb2-6e39b057f515'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    skuName: 'premium'\\n    storageAccountName: 'sadwmax001'\\n    storageAccountSkuName: 'Standard_ZRS'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    vnetAddressPrefix: '10.100'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a DBforPostgreSQL Flexible Server [Microsoft.DBforPostgreSQL/flexibleServers] using managed HSM Customer-Managed-Keys with User-Assigned identity."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/db-for-postgre-sql/flexible-server:0.13.0\",\"name\": \"flexibleServer\"}],\"rationale\": \"This module deploys a DBforPostgreSQL Flexible Server.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module flexibleServer 'br/public:avm/res/db-for-postgre-sql/flexible-server:0.13.0' = {\\n  name: 'flexibleServerDeployment'\\n  params: {\\n    // Required parameters\\n    availabilityZone: -1\\n    name: 'dfpshsm003'\\n    skuName: 'Standard_D2s_v3'\\n    tier: 'GeneralPurpose'\\n    // Non-required parameters\\n    administrators: [\\n      {\\n        objectId: '<objectId>'\\n        principalName: '<principalName>'\\n        principalType: 'ServicePrincipal'\\n      }\\n    ]\\n    customerManagedKey: {\\n      keyName: '<keyName>'\\n      keyVaultResourceId: '<keyVaultResourceId>'\\n      userAssignedIdentityResourceId: '<userAssignedIdentityResourceId>'\\n    }\\n    geoRedundantBackup: 'Disabled'\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a DBforPostgreSQL Flexible Server [Microsoft.DBforPostgreSQL/flexibleServers] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/db-for-postgre-sql/flexible-server:0.13.0\",\"name\": \"flexibleServer\"}],\"rationale\": \"This module deploys a DBforPostgreSQL Flexible Server.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module flexibleServer 'br/public:avm/res/db-for-postgre-sql/flexible-server:0.13.0' = {\\n  name: 'flexibleServerDeployment'\\n  params: {\\n    // Required parameters\\n    availabilityZone: 1\\n    name: 'dfpswaf001'\\n    skuName: 'Standard_D2s_v3'\\n    tier: 'GeneralPurpose'\\n    // Non-required parameters\\n    administrators: [\\n      {\\n        objectId: '<objectId>'\\n        principalName: '<principalName>'\\n        principalType: 'ServicePrincipal'\\n      }\\n    ]\\n    authConfig: {\\n      activeDirectoryAuth: 'Enabled'\\n      passwordAuth: 'Disabled'\\n    }\\n    configurations: [\\n      {\\n        name: 'log_min_messages'\\n        source: 'user-override'\\n        value: 'INFO'\\n      }\\n      {\\n        name: 'autovacuum_naptime'\\n        source: 'user-override'\\n        value: '80'\\n      }\\n    ]\\n    databases: [\\n      {\\n        charset: 'UTF8'\\n        collation: 'en_US.utf8'\\n        name: 'testdb1'\\n      }\\n      {\\n        name: 'testdb2'\\n      }\\n    ]\\n    delegatedSubnetResourceId: '<delegatedSubnetResourceId>'\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    highAvailability: 'ZoneRedundant'\\n    maintenanceWindow: {\\n      customWindow: 'Enabled'\\n      dayOfWeek: 0\\n      startHour: 1\\n      startMinute: 0\\n    }\\n    privateDnsZoneArmResourceId: '<privateDnsZoneArmResourceId>'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Virtual Desktop Scaling Plan [Microsoft.DesktopVirtualization/scalingPlans] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/desktop-virtualization/scaling-plan:0.4.0\",\"name\": \"scalingPlan\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module scalingPlan 'br/public:avm/res/desktop-virtualization/scaling-plan:0.4.0' = {\\n  name: 'scalingPlanDeployment'\\n  params: {\\n    name: 'dvspmin002'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Dev Center [Microsoft.DevCenter/devcenters] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/dev-center/devcenter:0.1.0\",\"name\": \"devcenter\"}],\"rationale\": \"This module deploys an Azure Dev Center.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module devcenter 'br/public:avm/res/dev-center/devcenter:0.1.0' = {\\n  name: 'devcenterDeployment'\\n  params: {\\n    // Required parameters\\n    name: '<name>'\\n    // Non-required parameters\\n    attachedNetworks: [\\n      {\\n        name: 'test-attached-network'\\n        networkConnectionResourceId: '<networkConnectionResourceId>'\\n      }\\n    ]\\n    catalogs: [\\n      {\\n        gitHub: {\\n          branch: 'main'\\n          path: 'Environment-Definitions'\\n          uri: 'https://github.com/microsoft/devcenter-catalog.git'\\n        }\\n        name: 'quickstart-catalog'\\n        syncType: 'Scheduled'\\n      }\\n      {\\n        adoGit: {\\n          branch: 'main'\\n          secretIdentifier: '<secretIdentifier>'\\n          uri: 'https://contoso@dev.azure.com/contoso/your-project/_git/your-repo'\\n        }\\n        name: 'testCatalogAzureDevOpsGit'\\n        syncType: 'Manual'\\n      }\\n    ]\\n    devboxDefinitions: [\\n      {\\n        hibernateSupport: 'Enabled'\\n        imageResourceId: '<imageResourceId>'\\n        name: 'test-devbox-definition-builtin-gallery-image'\\n        sku: {\\n          capacity: 1\\n          family: 'general_i'\\n          name: 'general_i_8c32gb512ssd_v2'\\n        }\\n        tags: {\\n          costCenter: '1234'\\n        }\\n      }\\n      {\\n        imageResourceId: '<imageResourceId>'\\n        name: 'test-devbox-definition-custom-gallery-image'\\n        sku: {\\n          name: 'general_i_8c32gb256ssd_v2'\\n        }\\n      }\\n    ]\\n    devBoxProvisioningSettings: {\\n      installAzureMonitorAgentEnableStatus: 'Enabled'\\n    }\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    displayName: 'Dev Center Test'\\n    environmentTypes: [\\n      {\\n        displayName: 'Development Environment'\\n        name: 'dev'\\n        tags: {\\n          costCenter: '1234'\\n        }\\n      }\\n      {\\n        displayName: 'Testing Environment'\\n        name: 'test'\\n        tags: {\\n          costCenter: '5678'\\n        }\\n      }\\n      {\\n        displayName: 'Production Environment'\\n        name: 'prod'\\n        tags: {\\n          costCenter: '9012'\\n        }\\n      }\\n    ]\\n    galleries: [\\n      {\\n        devCenterIdentityPrincipalId: '<devCenterIdentityPrincipalId>'\\n        galleryResourceId: '<galleryResourceId>'\\n        name: 'computegallery'\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    networkSettings: {\\n      microsoftHostedNetworkEnableStatus: 'Disabled'\\n    }\\n    projectCatalogSettings: {\\n      catalogItemSyncEnableStatus: 'Enabled'\\n    }\\n    projectPolicies: [\\n      {\\n        name: 'Default'\\n        resourcePolicies: [\\n          {\\n            action: 'Allow'\\n            resourceType: 'Images'\\n          }\\n          {\\n            action: 'Allow'\\n            resourceType: 'Skus'\\n          }\\n          {\\n            action: 'Allow'\\n            resourceType: 'AttachedNetworks'\\n          }\\n        ]\\n      }\\n      {\\n        name: 'DevProjectsPolicy'\\n        projectsResourceIdOrName: [\\n          '<value>/providers/Microsoft.DevCenter/projects/test-project-another-resource-group'\\n          'test-project-same-resource-group'\\n        ]\\n        resourcePolicies: [\\n          {\\n            filter: 'Name eq \\\\'general_i_8c32gb512ssd_v2\\\\''\\n            resources: '<resources>'\\n          }\\n          {\\n            resources: '<resources>'\\n          }\\n          {\\n            resources: '<resources>'\\n          }\\n          {\\n            action: 'Deny'\\n            resourceType: 'AttachedNetworks'\\n          }\\n        ]\\n      }\\n    ]\\n    projects: [\\n      {\\n        catalogSettings: {\\n          catalogItemSyncTypes: [\\n            'EnvironmentDefinition'\\n            'ImageDefinition'\\n          ]\\n        }\\n        environmentTypes: [\\n          {\\n            creatorRoleAssignmentRoles: [\\n              'acdd72a7-3385-48ef-bd42-f606fba81ae7'\\n            ]\\n            deploymentTargetSubscriptionResourceId: '<deploymentTargetSubscriptionResourceId>'\\n            displayName: 'My Sandbox Environment Type'\\n            managedIdentities: {\\n              systemAssigned: false\\n              userAssignedResourceIds: [\\n                '<managedIdentityResourceId>'\\n              ]\\n            }\\n            name: 'dev'\\n            status: 'Enabled'\\n          }\\n        ]\\n        managedIdentities: {\\n          userAssignedResourceIds: [\\n            '<managedIdentityResourceId>'\\n          ]\\n        }\\n        maxDevBoxesPerUser: 2\\n        name: 'test-project-same-resource-group'\\n        pools: [\\n          {\\n            devBoxDefinitionName: 'test-devbox-definition-builtin-gallery-image'\\n            devBoxDefinitionType: 'Reference'\\n            displayName: 'My Sandbox Pool - Managed Network'\\n            localAdministrator: 'Disabled'\\n            managedVirtualNetworkRegion: 'westeurope'\\n            name: 'sandbox-pool'\\n            singleSignOnStatus: 'Enabled'\\n            stopOnDisconnect: {\\n              gracePeriodMinutes: 60\\n              status: 'Enabled'\\n            }\\n            virtualNetworkType: 'Managed'\\n          }\\n        ]\\n      }\\n      {\\n        name: 'test-project-another-resource-group'\\n        resourceGroupResourceId: '<resourceGroupResourceId>'\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'DevCenter Project Admin'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      costCenter: '1234'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Dev Center Project [Microsoft.DevCenter/projects] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/dev-center/project:0.1.0\",\"name\": \"project\"}],\"rationale\": \"This module deploys a Dev Center Project.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module project 'br/public:avm/res/dev-center/project:0.1.0' = {\\n  name: 'projectDeployment'\\n  params: {\\n    // Required parameters\\n    devCenterResourceId: '<devCenterResourceId>'\\n    name: 'dcpwaf001'\\n    // Non-required parameters\\n    catalogSettings: {\\n      catalogItemSyncTypes: [\\n        'EnvironmentDefinition'\\n        'ImageDefinition'\\n      ]\\n    }\\n    description: 'This is a test project for the Dev Center project module.'\\n    displayName: 'My Dev Center Project'\\n    environmentTypes: [\\n      {\\n        creatorRoleAssignmentRoles: [\\n          'acdd72a7-3385-48ef-bd42-f606fba81ae7'\\n        ]\\n        deploymentTargetSubscriptionResourceId: '<deploymentTargetSubscriptionResourceId>'\\n        displayName: 'My Sandbox Environment Type'\\n        managedIdentities: {\\n          systemAssigned: false\\n          userAssignedResourceIds: [\\n            '<managedIdentityResourceId>'\\n          ]\\n        }\\n        name: 'dep-et-dcpwaf'\\n        status: 'Enabled'\\n      }\\n    ]\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    maxDevBoxesPerUser: 2\\n    pools: [\\n      {\\n        devBoxDefinitionName: '<devBoxDefinitionName>'\\n        devBoxDefinitionType: 'Reference'\\n        displayName: 'My Sandbox Pool - Managed Network'\\n        localAdministrator: 'Disabled'\\n        managedVirtualNetworkRegion: 'westeurope'\\n        name: 'sandbox-pool'\\n        singleSignOnStatus: 'Enabled'\\n        stopOnDisconnect: {\\n          gracePeriodMinutes: 60\\n          status: 'Enabled'\\n        }\\n        virtualNetworkType: 'Managed'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a DevTest Lab [Microsoft.DevTestLab/labs] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/dev-test-lab/lab:0.4.0\",\"name\": \"lab\"}],\"rationale\": \"This module deploys a DevTest Lab.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module lab 'br/public:avm/res/dev-test-lab/lab:0.4.0' = {\\n  name: 'labDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dtllmax001'\\n    // Non-required parameters\\n    announcement: {\\n      enabled: 'Enabled'\\n      expirationDate: '2028-12-30T13:00:00Z'\\n      markdown: 'DevTest Lab announcement text. <br> New line. It also supports Markdown'\\n      title: 'DevTest announcement title'\\n    }\\n    artifactsources: [\\n      {\\n        displayName: 'Public Artifact Repo'\\n        folderPath: '/Artifacts'\\n        name: 'Public Repo'\\n        sourceType: 'GitHub'\\n        status: 'Enabled'\\n        uri: 'https://github.com/Azure/azure-devtestlab.git'\\n      }\\n      {\\n        armTemplateFolderPath: '/Environments'\\n        branchRef: 'master'\\n        displayName: 'Public Environment Repo'\\n        name: 'Public Environment Repo'\\n        sourceType: 'GitHub'\\n        status: 'Disabled'\\n        tags: {\\n          'hidden-title': 'This is visible in the resource name'\\n          labName: 'dtllmax001'\\n          resourceType: 'DevTest Lab'\\n        }\\n        uri: 'https://github.com/Azure/azure-devtestlab.git'\\n      }\\n      {\\n        armTemplateFolderPath: '/ArmTemplates'\\n        branchRef: 'main'\\n        displayName: 'Private Artifact Repo'\\n        folderPath: '/Artifacts'\\n        name: 'Private Repo'\\n        securityToken: '<securityToken>'\\n        status: 'Disabled'\\n        uri: 'https://github.com/Azure/azure-devtestlab.git'\\n      }\\n    ]\\n    artifactsStorageAccount: '<artifactsStorageAccount>'\\n    browserConnect: 'Enabled'\\n    costs: {\\n      currencyCode: 'AUD'\\n      cycleType: 'CalendarMonth'\\n      status: 'Enabled'\\n      target: 450\\n      thresholdValue100DisplayOnChart: 'Enabled'\\n      thresholdValue100SendNotificationWhenExceeded: 'Enabled'\\n      thresholdValue125DisplayOnChart: 'Disabled'\\n      thresholdValue75DisplayOnChart: 'Enabled'\\n    }\\n    disableAutoUpgradeCseMinorVersion: true\\n    encryptionDiskEncryptionSetId: '<encryptionDiskEncryptionSetId>'\\n    encryptionType: 'EncryptionAtRestWithCustomerKey'\\n    environmentPermission: 'Contributor'\\n    extendedProperties: {\\n      RdpConnectionType: '7'\\n    }\\n    isolateLabResources: 'Enabled'\\n    labStorageType: 'Premium'\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    managementIdentitiesResourceIds: [\\n      '<managedIdentityResourceId>'\\n    ]\\n    notificationchannels: [\\n      {\\n        description: 'Integration configured for auto-shutdown'\\n        emailRecipient: 'mail@contosodtlmail.com'\\n        events: [\\n          'AutoShutdown'\\n        ]\\n        name: 'autoShutdown'\\n        notificationLocale: 'en'\\n        webHookUrl: 'https://webhook.contosotest.com'\\n      }\\n      {\\n        events: [\\n          'Cost'\\n        ]\\n        name: 'costThreshold'\\n        webHookUrl: 'https://webhook.contosotest.com'\\n      }\\n    ]\\n    policies: [\\n      {\\n        evaluatorType: 'MaxValuePolicy'\\n        factData: '<factData>'\\n        factName: 'UserOwnedLabVmCountInSubnet'\\n        name: '<name>'\\n        threshold: '1'\\n      }\\n      {\\n        evaluatorType: 'MaxValuePolicy'\\n        factName: 'UserOwnedLabVmCount'\\n        name: 'MaxVmsAllowedPerUser'\\n        threshold: '2'\\n      }\\n      {\\n        evaluatorType: 'MaxValuePolicy'\\n        factName: 'UserOwnedLabPremiumVmCount'\\n        name: 'MaxPremiumVmsAllowedPerUser'\\n        status: 'Disabled'\\n        threshold: '1'\\n      }\\n      {\\n        evaluatorType: 'MaxValuePolicy'\\n        factName: 'LabVmCount'\\n        name: 'MaxVmsAllowedPerLab'\\n        threshold: '3'\\n      }\\n      {\\n        evaluatorType: 'MaxValuePolicy'\\n        factName: 'LabPremiumVmCount'\\n        name: 'MaxPremiumVmsAllowedPerLab'\\n        threshold: '2'\\n      }\\n      {\\n        evaluatorType: 'AllowedValuesPolicy'\\n        factData: ''\\n        factName: 'LabVmSize'\\n        name: 'AllowedVmSizesInLab'\\n        status: 'Enabled'\\n        threshold: '<threshold>'\\n      }\\n      {\\n        evaluatorType: 'AllowedValuesPolicy'\\n        factName: 'ScheduleEditPermission'\\n        name: 'ScheduleEditPermission'\\n        threshold: '<threshold>'\\n      }\\n      {\\n        evaluatorType: 'AllowedValuesPolicy'\\n        factName: 'GalleryImage'\\n        name: 'GalleryImage'\\n        threshold: '<threshold>'\\n      }\\n      {\\n        description: 'Public Environment Policy'\\n        evaluatorType: 'AllowedValuesPolicy'\\n        factName: 'EnvironmentTemplate'\\n        name: 'EnvironmentTemplate'\\n        threshold: '<threshold>'\\n      }\\n    ]\\n    premiumDataDisks: 'Enabled'\\n    roleAssignments: [\\n      {\\n        name: 'b08c589c-2c79-41bd-8195-d5e62ad12f67'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    schedules: [\\n      {\\n        dailyRecurrence: {\\n          time: '0000'\\n        }\\n        name: 'LabVmsShutdown'\\n        notificationSettings: {\\n          status: 'Enabled'\\n          timeInMinutes: 30\\n        }\\n        status: 'Enabled'\\n        taskType: 'LabVmsShutdownTask'\\n        timeZoneId: 'AUS Eastern Standard Time'\\n      }\\n      {\\n        name: 'LabVmAutoStart'\\n        status: 'Enabled'\\n        taskType: 'LabVmsStartupTask'\\n        timeZoneId: 'AUS Eastern Standard Time'\\n        weeklyRecurrence: {\\n          time: '0700'\\n          weekdays: [\\n            'Friday'\\n            'Monday'\\n            'Thursday'\\n            'Tuesday'\\n            'Wednesday'\\n          ]\\n        }\\n      }\\n    ]\\n    secrets: [\\n      {\\n        name: 'labSecret1'\\n        value: '<value>'\\n      }\\n    ]\\n    storageAccountAccess: '<storageAccountAccess>'\\n    support: {\\n      enabled: 'Enabled'\\n      markdown: 'DevTest Lab support text. <br> New line. It also supports Markdown'\\n    }\\n    tags: {\\n      'hidden-title': 'This is visible in the resource name'\\n      labName: 'dtllmax001'\\n      resourceType: 'DevTest Lab'\\n    }\\n    virtualnetworks: [\\n      {\\n        allowedSubnets: [\\n          {\\n            allowPublicIp: 'Allow'\\n            labSubnetName: '<labSubnetName>'\\n            resourceId: '<resourceId>'\\n          }\\n          {\\n            allowPublicIp: 'Deny'\\n            labSubnetName: '<labSubnetName>'\\n            resourceId: '<resourceId>'\\n          }\\n        ]\\n        description: 'lab virtual network description'\\n        externalProviderResourceId: '<externalProviderResourceId>'\\n        name: '<name>'\\n        subnetOverrides: [\\n          {\\n            labSubnetName: '<labSubnetName>'\\n            resourceId: '<resourceId>'\\n            sharedPublicIpAddressConfiguration: {\\n              allowedPorts: [\\n                {\\n                  backendPort: 3389\\n                  transportProtocol: 'Tcp'\\n                }\\n                {\\n                  backendPort: 22\\n                  transportProtocol: 'Tcp'\\n                }\\n              ]\\n            }\\n            useInVmCreationPermission: 'Allow'\\n            usePublicIpAddressPermission: 'Allow'\\n          }\\n          {\\n            labSubnetName: '<labSubnetName>'\\n            resourceId: '<resourceId>'\\n            useInVmCreationPermission: 'Deny'\\n            usePublicIpAddressPermission: 'Deny'\\n          }\\n        ]\\n      }\\n    ]\\n    vmCreationResourceGroupId: '<vmCreationResourceGroupId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Cosmos DB account [Microsoft.DocumentDB/databaseAccounts] using bounded consistency."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/document-db/database-account:0.16.0\",\"name\": \"databaseAccount\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module databaseAccount 'br/public:avm/res/document-db/database-account:0.16.0' = {\\n  name: 'databaseAccountDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'bounded'\\n    // Non-required parameters\\n    defaultConsistencyLevel: 'BoundedStaleness'\\n    maxIntervalInSeconds: 600\\n    maxStalenessPrefix: 200000\\n    sqlDatabases: [\\n      {\\n        name: 'no-containers-specified'\\n      }\\n    ]\\n    zoneRedundant: false\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Cosmos DB account [Microsoft.DocumentDB/databaseAccounts] using the Plain configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/document-db/database-account:0.16.0\",\"name\": \"databaseAccount\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module databaseAccount 'br/public:avm/res/document-db/database-account:0.16.0' = {\\n  name: 'databaseAccountDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dddapln001'\\n    // Non-required parameters\\n    capabilitiesToAdd: [\\n      'EnableServerless'\\n    ]\\n    databaseAccountOfferType: 'Standard'\\n    failoverLocations: [\\n      {\\n        failoverPriority: 0\\n        isZoneRedundant: false\\n        locationName: '<locationName>'\\n      }\\n    ]\\n    sqlDatabases: [\\n      {\\n        name: 'no-containers-specified'\\n      }\\n    ]\\n    totalThroughputLimit: 4000\\n    zoneRedundant: false\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Azure Cosmos DB for MongoDB (vCore) cluster [Microsoft.DocumentDB/mongoClusters] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/document-db/mongo-cluster:0.4.0\",\"name\": \"mongoCluster\"}],\"rationale\": \"This module deploys a Azure Cosmos DB for MongoDB (vCore) cluster.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module mongoCluster 'br/public:avm/res/document-db/mongo-cluster:0.4.0' = {\\n  name: 'mongoClusterDeployment'\\n  params: {\\n    // Required parameters\\n    administratorLogin: 'Admin003'\\n    administratorLoginPassword: '<administratorLoginPassword>'\\n    name: 'ddmcmax002'\\n    nodeCount: 2\\n    sku: 'M30'\\n    storage: 256\\n    // Non-required parameters\\n    createMode: 'Default'\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    enableMicrosoftEntraAuth: false\\n    entraAuthIdentities: []\\n    highAvailabilityMode: 'Disabled'\\n    location: '<location>'\\n    networkAcls: {\\n      allowAllIPs: true\\n      allowAzureIPs: true\\n      customRules: [\\n        {\\n          endIpAddress: '192.168.2.0'\\n          firewallRuleName: 'allow-192_168_1_0-to-192_168_2_0'\\n          startIpAddress: '192.168.1.0'\\n        }\\n      ]\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        name: '60395919-cfd3-47bf-8349-775ddebb255e'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Elastic SAN [Microsoft.ElasticSan/elasticSans] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/elastic-san/elastic-san:0.4.0\",\"name\": \"elasticSan\"}],\"rationale\": \"This module deploys an Elastic SAN.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module elasticSan 'br/public:avm/res/elastic-san/elastic-san:0.4.0' = {\\n  name: 'elasticSanDeployment'\\n  params: {\\n    // Required parameters\\n    availabilityZone: 1\\n    name: 'esanwaf001'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    publicNetworkAccess: 'Disabled'\\n    sku: 'Premium_LRS'\\n    tags: {\\n      CostCenter: '123-456-789'\\n      Owner: 'Contoso'\\n    }\\n    volumeGroups: [\\n      {\\n        customerManagedKey: {\\n          keyName: '<keyName>'\\n          keyVaultResourceId: '<keyVaultResourceId>'\\n          userAssignedIdentityResourceId: '<userAssignedIdentityResourceId>'\\n        }\\n        managedIdentities: {\\n          userAssignedResourceIds: [\\n            '<managedIdentityResourceId>'\\n          ]\\n        }\\n        name: 'vol-grp-01'\\n        privateEndpoints: [\\n          {\\n            privateDnsZoneGroup: {\\n              privateDnsZoneGroupConfigs: [\\n                {\\n                  privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n                }\\n              ]\\n            }\\n            subnetResourceId: '<subnetResourceId>'\\n            tags: {\\n              CostCenter: '123-456-789'\\n              Owner: 'Contoso'\\n            }\\n          }\\n        ]\\n        volumes: [\\n          {\\n            name: 'vol-grp-01-vol-01'\\n            sizeGiB: 1\\n          }\\n        ]\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Event Grid Namespace [Microsoft.EventGrid/namespaces] using the MQTT Broker with routing to a custom topic configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/event-grid/namespace:0.7.0\",\"name\": \"namespace\"}],\"rationale\": \"This module deploys an Event Grid Namespace.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module namespace 'br/public:avm/res/event-grid/namespace:0.7.0' = {\\n  name: 'namespaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'egnmqttnt001'\\n    // Non-required parameters\\n    alternativeAuthenticationNameSources: [\\n      'ClientCertificateEmail'\\n      'ClientCertificateUri'\\n    ]\\n    clientGroups: [\\n      {\\n        description: 'this is group1'\\n        name: 'group1'\\n        query: 'attributes.keyName IN [\\\\'a\\\\', \\\\'b\\\\', \\\\'c\\\\']'\\n      }\\n    ]\\n    clients: [\\n      {\\n        attributes: {\\n          deviceTypes: [\\n            'Fan'\\n            'Light'\\n          ]\\n          floor: 12\\n          room: '345'\\n        }\\n        authenticationName: 'client2auth'\\n        clientCertificateAuthenticationAllowedThumbprints: [\\n          '1111111111111111111111111111111111111111'\\n          '2222222222222222222222222222222222222222'\\n        ]\\n        clientCertificateAuthenticationValidationSchema: 'ThumbprintMatch'\\n        description: 'this is client2'\\n        name: 'client1'\\n        state: 'Enabled'\\n      }\\n      {\\n        clientCertificateAuthenticationAllowedThumbprints: [\\n          '3333333333333333333333333333333333333333'\\n        ]\\n        clientCertificateAuthenticationValidationSchema: 'ThumbprintMatch'\\n        name: 'client2'\\n      }\\n      {\\n        name: 'client3'\\n      }\\n      {\\n        clientCertificateAuthenticationValidationSchema: 'IpMatchesAuthenticationName'\\n        name: 'client4'\\n      }\\n    ]\\n    location: '<location>'\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    maximumClientSessionsPerAuthenticationName: 5\\n    maximumSessionExpiryInHours: 2\\n    permissionBindings: [\\n      {\\n        clientGroupName: 'group1'\\n        description: 'this is binding1'\\n        name: 'bindiing1'\\n        permission: 'Publisher'\\n        topicSpaceName: 'topicSpace1'\\n      }\\n      {\\n        clientGroupName: 'group1'\\n        name: 'bindiing2'\\n        permission: 'Subscriber'\\n        topicSpaceName: 'topicSpace2'\\n      }\\n    ]\\n    routeTopicResourceId: '<routeTopicResourceId>'\\n    routingEnrichments: {\\n      dynamic: [\\n        {\\n          key: 'dynamic1'\\n          value: '\\\\${client.authenticationName}'\\n        }\\n      ]\\n      static: [\\n        {\\n          key: 'static1'\\n          value: 'value1'\\n          valueType: 'String'\\n        }\\n        {\\n          key: 'static2'\\n          value: 'value2'\\n          valueType: 'String'\\n        }\\n      ]\\n    }\\n    routingIdentityInfo: {\\n      type: 'UserAssigned'\\n      userAssignedIdentity: '<userAssignedIdentity>'\\n    }\\n    topics: [\\n      {\\n        name: 'topic1'\\n      }\\n    ]\\n    topicSpaces: [\\n      {\\n        name: 'topicSpace1'\\n        topicTemplates: [\\n          'devices/foo/bar'\\n          'devices/topic1/+'\\n        ]\\n      }\\n      {\\n        name: 'topicSpace2'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        topicTemplates: [\\n          'devices/topic1/+'\\n        ]\\n      }\\n    ]\\n    topicSpacesState: 'Enabled'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Event Grid Topic [Microsoft.EventGrid/topics] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/event-grid/topic:0.9.0\",\"name\": \"topic\"}],\"rationale\": \"This module deploys an Event Grid Topic.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module topic 'br/public:avm/res/event-grid/topic:0.9.0' = {\\n  name: 'topicDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'egtmax001'\\n    // Non-required parameters\\n    dataResidencyBoundary: 'WithinRegion'\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    eventSubscriptions: [\\n      {\\n        deliveryWithResourceIdentity: {\\n          destination: {\\n            endpointType: 'StorageQueue'\\n            properties: {\\n              queueMessageTimeToLiveInSeconds: 86400\\n              queueName: '<queueName>'\\n              resourceId: '<resourceId>'\\n            }\\n          }\\n          identity: {\\n            type: 'UserAssigned'\\n            userAssignedIdentity: '<userAssignedIdentity>'\\n          }\\n        }\\n        eventDeliverySchema: 'CloudEventSchemaV1_0'\\n        expirationTimeUtc: '2099-01-01T11:00:21.715Z'\\n        filter: {\\n          enableAdvancedFilteringOnArrays: true\\n          isSubjectCaseSensitive: false\\n        }\\n        name: 'egtmax001'\\n        retryPolicy: {\\n          eventTimeToLiveInMinutes: 120\\n          maxDeliveryAttempts: 10\\n        }\\n      }\\n    ]\\n    inboundIpRules: [\\n      {\\n        action: 'Allow'\\n        ipMask: '40.74.28.0/23'\\n      }\\n    ]\\n    inputSchema: 'CloudEventSchemaV1_0'\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    minimumTlsVersionAllowed: '1.2'\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        service: 'topic'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'topic'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    publicNetworkAccess: 'Disabled'\\n    roleAssignments: [\\n      {\\n        name: 'f80d2f24-53f6-41b3-811f-668b2273dcf8'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Event Hub Namespaces [Microsoft.EventHub/namespaces] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/event-hub/namespace:0.13.0\",\"name\": \"namespace\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module namespace 'br/public:avm/res/event-hub/namespace:0.13.0' = {\\n  name: 'namespaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ehnwaf001'\\n    // Non-required parameters\\n    authorizationRules: [\\n      {\\n        name: 'RootManageSharedAccessKey'\\n        rights: [\\n          'Listen'\\n          'Manage'\\n          'Send'\\n        ]\\n      }\\n      {\\n        name: 'SendListenAccess'\\n        rights: [\\n          'Listen'\\n          'Send'\\n        ]\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    disableLocalAuth: true\\n    eventhubs: [\\n      {\\n        name: 'az-evh-x-001'\\n      }\\n      {\\n        authorizationRules: [\\n          {\\n            name: 'RootManageSharedAccessKey'\\n            rights: [\\n              'Listen'\\n              'Manage'\\n              'Send'\\n            ]\\n          }\\n          {\\n            name: 'SendListenAccess'\\n            rights: [\\n              'Listen'\\n              'Send'\\n            ]\\n          }\\n        ]\\n        captureDescription: {\\n          destination: {\\n            identity: {\\n              userAssignedResourceId: '<userAssignedResourceId>'\\n            }\\n            name: 'EventHubArchive.AzureBlockBlob'\\n            properties: {\\n              archiveNameFormat: '{Namespace}/{EventHub}/{PartitionId}/{Year}/{Month}/{Day}/{Hour}/{Minute}/{Second}'\\n              blobContainer: '<blobContainer>'\\n              storageAccountResourceId: '<storageAccountResourceId>'\\n            }\\n          }\\n          encoding: 'Avro'\\n          intervalInSeconds: 300\\n          sizeLimitInBytes: 314572800\\n          skipEmptyArchives: true\\n        }\\n        consumergroups: [\\n          {\\n            name: 'custom'\\n            userMetadata: 'customMetadata'\\n          }\\n        ]\\n        messageRetentionInDays: 1\\n        name: 'az-evh-x-002'\\n        partitionCount: 2\\n        retentionDescriptionCleanupPolicy: 'Delete'\\n        retentionDescriptionRetentionTimeInHours: 3\\n        status: 'Active'\\n      }\\n      {\\n        name: 'az-evh-x-003'\\n        retentionDescriptionCleanupPolicy: 'Compact'\\n        retentionDescriptionTombstoneRetentionTimeInHours: 24\\n      }\\n    ]\\n    isAutoInflateEnabled: true\\n    kafkaEnabled: true\\n    managedIdentities: {\\n      userAssignedResourceId: '<userAssignedResourceId>'\\n    }\\n    maximumThroughputUnits: 4\\n    minimumTlsVersion: '1.2'\\n    networkRuleSets: {\\n      defaultAction: 'Deny'\\n      ipRules: [\\n        {\\n          action: 'Allow'\\n          ipMask: '10.10.10.10'\\n        }\\n      ]\\n      trustedServiceAccessEnabled: false\\n      virtualNetworkRules: [\\n        {\\n          ignoreMissingVnetServiceEndpoint: true\\n          subnetResourceId: '<subnetResourceId>'\\n        }\\n      ]\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n    ]\\n    publicNetworkAccess: 'Disabled'\\n    skuCapacity: 2\\n    skuName: 'Standard'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Healthcare API Workspaces [Microsoft.HealthcareApis/workspaces] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/healthcare-apis/workspace:0.4.0\",\"name\": \"workspace\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module workspace 'br/public:avm/res/healthcare-apis/workspace:0.4.0' = {\\n  name: 'workspaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'hawmin001'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Hybrid Compute Machines [Microsoft.HybridCompute/machines] using the Creates an Arc Machine using only the defaults configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/hybrid-compute/machine:0.4.0\",\"name\": \"machine\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module machine 'br/public:avm/res/hybrid-compute/machine:0.4.0' = {\\n  name: 'machineDeployment'\\n  params: {\\n    // Required parameters\\n    kind: 'HCI'\\n    name: 'arcmachcimin'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Action Group [Microsoft.Insights/actionGroups] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/action-group:0.8.0\",\"name\": \"actionGroup\"}],\"rationale\": \"This module deploys an Action Group.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module actionGroup 'br/public:avm/res/insights/action-group:0.8.0' = {\\n  name: 'actionGroupDeployment'\\n  params: {\\n    // Required parameters\\n    groupShortName: 'agiagmin001'\\n    name: 'iagmin001'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Application Insights [Microsoft.Insights/components] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/component:0.6.0\",\"name\": \"component\"}],\"rationale\": \"This component deploys an Application Insights instance.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module component 'br/public:avm/res/insights/component:0.6.0' = {\\n  name: 'componentDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'icmax001'\\n    workspaceResourceId: '<workspaceResourceId>'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    disableIpMasking: false\\n    disableLocalAuth: true\\n    flowType: 'Redfield'\\n    forceCustomerStorageForProfiler: true\\n    immediatePurgeDataOn30Days: true\\n    linkedStorageAccountResourceId: '<linkedStorageAccountResourceId>'\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    requestSource: 'Azure'\\n    roleAssignments: [\\n      {\\n        name: '8aacced3-3fce-41bc-a416-959df1acec57'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Data Collection Rule [Microsoft.Insights/dataCollectionRules] using the Collecting custom text logs configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/data-collection-rule:0.7.0\",\"name\": \"dataCollectionRule\"}],\"rationale\": \"This module deploys a Data Collection Rule.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module dataCollectionRule 'br/public:avm/res/insights/data-collection-rule:0.7.0' = {\\n  name: 'dataCollectionRuleDeployment'\\n  params: {\\n    // Required parameters\\n    dataCollectionRuleProperties: {\\n      dataCollectionEndpointResourceId: '<dataCollectionEndpointResourceId>'\\n      dataFlows: [\\n        {\\n          destinations: [\\n            '<logAnalyticsWorkspaceName>'\\n          ]\\n          outputStream: 'Custom-CustomTableBasic_CL'\\n          streams: [\\n            'Custom-CustomTableBasic_CL'\\n          ]\\n          transformKql: 'source'\\n        }\\n      ]\\n      dataSources: {\\n        logFiles: [\\n          {\\n            filePatterns: [\\n              'C:\\\\\\\\TestLogsBasic\\\\\\\\TestLog*.log'\\n            ]\\n            format: 'text'\\n            name: 'CustomTableBasic_CL'\\n            samplingFrequencyInSeconds: 60\\n            settings: {\\n              text: {\\n                recordStartTimestampFormat: 'ISO 8601'\\n              }\\n            }\\n            streams: [\\n              'Custom-CustomTableBasic_CL'\\n            ]\\n          }\\n        ]\\n      }\\n      description: 'Collecting custom text logs without ingestion-time transformation.'\\n      destinations: {\\n        logAnalytics: [\\n          {\\n            name: '<name>'\\n            workspaceResourceId: '<workspaceResourceId>'\\n          }\\n        ]\\n      }\\n      kind: 'All'\\n      streamDeclarations: {\\n        'Custom-CustomTableBasic_CL': {\\n          columns: [\\n            {\\n              name: 'TimeGenerated'\\n              type: 'datetime'\\n            }\\n            {\\n              name: 'RawData'\\n              type: 'string'\\n            }\\n          ]\\n        }\\n      }\\n    }\\n    name: 'idcrcusbas001'\\n    // Non-required parameters\\n    location: '<location>'\\n    tags: {\\n      'hidden-title': 'This is visible in the resource name'\\n      kind: 'Windows'\\n      resourceType: 'Data Collection Rules'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Data Collection Rule [Microsoft.Insights/dataCollectionRules] using the Collecting Windows-specific information configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/data-collection-rule:0.7.0\",\"name\": \"dataCollectionRule\"}],\"rationale\": \"This module deploys a Data Collection Rule.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module dataCollectionRule 'br/public:avm/res/insights/data-collection-rule:0.7.0' = {\\n  name: 'dataCollectionRuleDeployment'\\n  params: {\\n    // Required parameters\\n    dataCollectionRuleProperties: {\\n      dataFlows: [\\n        {\\n          destinations: [\\n            'azureMonitorMetrics-default'\\n          ]\\n          streams: [\\n            'Microsoft-InsightsMetrics'\\n          ]\\n        }\\n        {\\n          destinations: [\\n            '<logAnalyticsWorkspaceName>'\\n          ]\\n          streams: [\\n            'Microsoft-Event'\\n          ]\\n        }\\n      ]\\n      dataSources: {\\n        performanceCounters: [\\n          {\\n            counterSpecifiers: [\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\% Disk Read Time'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\% Disk Time'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\% Disk Write Time'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\% Free Space'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\% Idle Time'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk Queue Length'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk Read Queue Length'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk sec/Read'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk sec/Transfer'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk sec/Write'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk Write Queue Length'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Bytes/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Read Bytes/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Reads/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Transfers/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Write Bytes/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Writes/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Free Megabytes'\\n              '\\\\\\\\Memory\\\\\\\\% Committed Bytes In Use'\\n              '\\\\\\\\Memory\\\\\\\\Available Bytes'\\n              '\\\\\\\\Memory\\\\\\\\Cache Bytes'\\n              '\\\\\\\\Memory\\\\\\\\Committed Bytes'\\n              '\\\\\\\\Memory\\\\\\\\Page Faults/sec'\\n              '\\\\\\\\Memory\\\\\\\\Pages/sec'\\n              '\\\\\\\\Memory\\\\\\\\Pool Nonpaged Bytes'\\n              '\\\\\\\\Memory\\\\\\\\Pool Paged Bytes'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Bytes Received/sec'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Bytes Sent/sec'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Bytes Total/sec'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Packets Outbound Errors'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Packets Received Errors'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Packets Received/sec'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Packets Sent/sec'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Packets/sec'\\n              '\\\\\\\\Process(_Total)\\\\\\\\Handle Count'\\n              '\\\\\\\\Process(_Total)\\\\\\\\Thread Count'\\n              '\\\\\\\\Process(_Total)\\\\\\\\Working Set'\\n              '\\\\\\\\Process(_Total)\\\\\\\\Working Set - Private'\\n              '\\\\\\\\Processor Information(_Total)\\\\\\\\% Privileged Time'\\n              '\\\\\\\\Processor Information(_Total)\\\\\\\\% Processor Time'\\n              '\\\\\\\\Processor Information(_Total)\\\\\\\\% User Time'\\n              '\\\\\\\\Processor Information(_Total)\\\\\\\\Processor Frequency'\\n              '\\\\\\\\System\\\\\\\\Context Switches/sec'\\n              '\\\\\\\\System\\\\\\\\Processes'\\n              '\\\\\\\\System\\\\\\\\Processor Queue Length'\\n              '\\\\\\\\System\\\\\\\\System Up Time'\\n            ]\\n            name: 'perfCounterDataSource60'\\n            samplingFrequencyInSeconds: 60\\n            streams: [\\n              'Microsoft-InsightsMetrics'\\n            ]\\n          }\\n        ]\\n        windowsEventLogs: [\\n          {\\n            name: 'eventLogsDataSource'\\n            streams: [\\n              'Microsoft-Event'\\n            ]\\n            xPathQueries: [\\n              'Application!*[System[(Level=1 or Level=2 or Level=3 or Level=4 or Level=0 or Level=5)]]'\\n              'Security!*[System[(band(Keywords,13510798882111488))]]'\\n              'System!*[System[(Level=1 or Level=2 or Level=3 or Level=4 or Level=0 or Level=5)]]'\\n            ]\\n          }\\n        ]\\n      }\\n      description: 'Collecting Windows-specific performance counters and Windows Event Logs'\\n      destinations: {\\n        azureMonitorMetrics: {\\n          name: 'azureMonitorMetrics-default'\\n        }\\n        logAnalytics: [\\n          {\\n            name: '<name>'\\n            workspaceResourceId: '<workspaceResourceId>'\\n          }\\n        ]\\n      }\\n      kind: 'Windows'\\n    }\\n    name: 'idcrwin001'\\n    // Non-required parameters\\n    location: '<location>'\\n    tags: {\\n      'hidden-title': 'This is visible in the resource name'\\n      kind: 'Windows'\\n      resourceType: 'Data Collection Rules'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Monitor Private Link Scope [microsoft.insights/privateLinkScopes] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/private-link-scope:0.7.0\",\"name\": \"privateLinkScope\"}],\"rationale\": \"This module deploys an Azure Monitor Private Link Scope.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module privateLinkScope 'br/public:avm/res/insights/private-link-scope:0.7.0' = {\\n  name: 'privateLinkScopeDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'iplsmin001'\\n    // Non-required parameters\\n    location: 'global'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Web Test [Microsoft.Insights/webtests] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/webtest:0.3.0\",\"name\": \"webtest\"}],\"rationale\": \"This module deploys a Web Test.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module webtest 'br/public:avm/res/insights/webtest:0.3.0' = {\\n  name: 'webtestDeployment'\\n  params: {\\n    // Required parameters\\n    appInsightResourceId: '<appInsightResourceId>'\\n    name: 'iwtmax001'\\n    request: {\\n      HttpVerb: 'GET'\\n      RequestUrl: 'https://learn.microsoft.com/en-us/'\\n    }\\n    webTestName: 'wt$iwtmax001'\\n    // Non-required parameters\\n    location: '<location>'\\n    locations: [\\n      {\\n        Id: 'emea-nl-ams-azr'\\n      }\\n    ]\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    roleAssignments: [\\n      {\\n        name: '86bf66a0-940f-438d-977e-624c00ccb2d8'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    syntheticMonitorId: 'iwtmax001'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Kubernetes Connected Cluster [Microsoft.Kubernetes/connectedClusters] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/kubernetes/connected-cluster:0.1.0\",\"name\": \"connectedCluster\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module connectedCluster 'br/public:avm/res/kubernetes/connected-cluster:0.1.0' = {\\n  name: 'connectedClusterDeployment'\\n  params: {\\n    name: 'kccmin001'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Kubernetes Configuration Flux Configuration [Microsoft.KubernetesConfiguration/fluxConfigurations] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/kubernetes-configuration/flux-configuration:0.3.0\",\"name\": \"fluxConfiguration\"}],\"rationale\": \"This module deploys a Kubernetes Configuration Flux Configuration.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module fluxConfiguration 'br/public:avm/res/kubernetes-configuration/flux-configuration:0.3.0' = {\\n  name: 'fluxConfigurationDeployment'\\n  params: {\\n    // Required parameters\\n    clusterName: '<clusterName>'\\n    kustomizations: {\\n      unified: {\\n        path: './cluster-manifests'\\n      }\\n    }\\n    name: 'kcfccc001'\\n    namespace: 'flux-system'\\n    scope: 'cluster'\\n    sourceKind: 'GitRepository'\\n    // Non-required parameters\\n    clusterType: 'connectedCluster'\\n    gitRepository: {\\n      repositoryRef: {\\n        branch: 'main'\\n      }\\n      sshKnownHosts: ''\\n      syncIntervalInSeconds: 300\\n      timeoutInSeconds: 180\\n      url: 'https://github.com/mspnp/aks-baseline'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Kusto Cluster [Microsoft.Kusto/clusters] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/kusto/cluster:0.8.0\",\"name\": \"cluster\"}],\"rationale\": \"This module deploys a Kusto Cluster.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module cluster 'br/public:avm/res/kusto/cluster:0.8.0' = {\\n  name: 'clusterDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'kcmax0001'\\n    sku: 'Standard_E2ads_v5'\\n    // Non-required parameters\\n    acceptedAudiences: [\\n      {\\n        value: 'https://contoso.com'\\n      }\\n    ]\\n    allowedFqdnList: [\\n      'contoso.com'\\n    ]\\n    allowedIpRangeList: [\\n      '192.168.1.1'\\n    ]\\n    autoScaleMax: 6\\n    autoScaleMin: 3\\n    capacity: 3\\n    clusterPrincipalAssignments: [\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'App'\\n        role: 'AllDatabasesViewer'\\n      }\\n    ]\\n    databases: [\\n      {\\n        databasePrincipalAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'App'\\n            role: 'Viewer'\\n          }\\n        ]\\n        kind: 'ReadWrite'\\n        name: 'myReadWriteDatabase'\\n        readWriteProperties: {\\n          hotCachePeriod: 'P1D'\\n          softDeletePeriod: 'P7D'\\n        }\\n      }\\n    ]\\n    enableAutoScale: true\\n    enableAutoStop: true\\n    enableDiskEncryption: true\\n    enableDoubleEncryption: true\\n    enablePublicNetworkAccess: true\\n    enablePurge: true\\n    enableRestrictOutboundNetworkAccess: true\\n    enableStreamingIngest: true\\n    enableZoneRedundant: true\\n    engineType: 'V3'\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    publicIPType: 'DualStack'\\n    roleAssignments: [\\n      {\\n        name: 'c2a4b728-c3d0-47f5-afbb-ea45c45859de'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Load test [Microsoft.LoadTestService/loadTests] using Customer-Managed-Keys with User-Assigned identity."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/load-test-service/load-test:0.4.0\",\"name\": \"loadTest\"}],\"rationale\": \"This module deploys a Load test.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module loadTest 'br/public:avm/res/load-test-service/load-test:0.4.0' = {\\n  name: 'loadTestDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ltucmk001'\\n    // Non-required parameters\\n    customerManagedKey: {\\n      keyName: '<keyName>'\\n      keyVaultResourceId: '<keyVaultResourceId>'\\n      userAssignedIdentityResourceId: '<userAssignedIdentityResourceId>'\\n    }\\n    location: '<location>'\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Machine Learning Registry [Microsoft.MachineLearningServices/registries] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/machine-learning-services/registry:0.1.0\",\"name\": \"registry\"}],\"rationale\": \"This module deploys an Azure Machine Learning Registry.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module registry 'br/public:avm/res/machine-learning-services/registry:0.1.0' = {\\n  name: 'registryDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'mlsrwaf001'\\n    // Non-required parameters\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Machine Learning Services Workspace [Microsoft.MachineLearningServices/workspaces] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/machine-learning-services/workspace:0.13.0\",\"name\": \"workspace\"}],\"rationale\": \"This module deploys a Machine Learning Services Workspace.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module workspace 'br/public:avm/res/machine-learning-services/workspace:0.13.0' = {\\n  name: 'workspaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'mlswwaf001'\\n    sku: 'Standard'\\n    // Non-required parameters\\n    associatedApplicationInsightsResourceId: '<associatedApplicationInsightsResourceId>'\\n    associatedKeyVaultResourceId: '<associatedKeyVaultResourceId>'\\n    associatedStorageAccountResourceId: '<associatedStorageAccountResourceId>'\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    location: '<location>'\\n    managedNetworkSettings: {\\n      firewallSku: 'Standard'\\n      isolationMode: 'AllowOnlyApprovedOutbound'\\n      outboundRules: {\\n        rule1: {\\n          category: 'UserDefined'\\n          destination: {\\n            serviceResourceId: '<serviceResourceId>'\\n            sparkEnabled: true\\n            subresourceTarget: 'blob'\\n          }\\n          type: 'PrivateEndpoint'\\n        }\\n        rule2: {\\n          category: 'UserDefined'\\n          destination: 'pypi.org'\\n          type: 'FQDN'\\n        }\\n        rule3: {\\n          category: 'UserDefined'\\n          destination: {\\n            portRanges: '80,443'\\n            protocol: 'TCP'\\n            serviceTag: 'AppService'\\n          }\\n          type: 'ServiceTag'\\n        }\\n      }\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n    ]\\n    systemDatastoresAuthMode: 'Identity'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Maintenance Configuration [Microsoft.Maintenance/maintenanceConfigurations] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/maintenance/maintenance-configuration:0.3.0\",\"name\": \"maintenanceConfiguration\"}],\"rationale\": \"This module deploys a Maintenance Configuration.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module maintenanceConfiguration 'br/public:avm/res/maintenance/maintenance-configuration:0.3.0' = {\\n  name: 'maintenanceConfigurationDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'mmcwaf001'\\n    // Non-required parameters\\n    extensionProperties: {\\n      InGuestPatchMode: 'User'\\n    }\\n    installPatches: {\\n      linuxParameters: {\\n        classificationsToInclude: '<classificationsToInclude>'\\n        packageNameMasksToExclude: '<packageNameMasksToExclude>'\\n        packageNameMasksToInclude: '<packageNameMasksToInclude>'\\n      }\\n      rebootSetting: 'IfRequired'\\n      windowsParameters: {\\n        classificationsToInclude: [\\n          'Critical'\\n          'Security'\\n        ]\\n        kbNumbersToExclude: '<kbNumbersToExclude>'\\n        kbNumbersToInclude: '<kbNumbersToInclude>'\\n      }\\n    }\\n    location: '<location>'\\n    maintenanceScope: 'InGuestPatch'\\n    maintenanceWindow: {\\n      duration: '03:00'\\n      expirationDateTime: '9999-12-31 23:59:59'\\n      recurEvery: 'Day'\\n      startDateTime: '2022-12-31 13:00'\\n      timeZone: 'W. Europe Standard Time'\\n    }\\n    namespace: 'mmcwafns'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    visibility: 'Custom'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Registration Definitions [Microsoft.ManagedServices/registrationDefinitions] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/managed-services/registration-definition:0.1.0\",\"name\": \"registrationDefinition\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module registrationDefinition 'br/public:avm/res/managed-services/registration-definition:0.1.0' = {\\n  name: 'registrationDefinitionDeployment'\\n  params: {\\n    // Required parameters\\n    authorizations: [\\n      {\\n        principalId: 'ecadddf6-78c3-4516-afb2-7d30a174ea13'\\n        roleDefinitionId: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: 'ecadddf6-78c3-4516-afb2-7d30a174ea13'\\n        roleDefinitionId: '91c1777a-f3dc-4fae-b103-61d183457e46'\\n      }\\n    ]\\n    managedByTenantId: '<managedByTenantId>'\\n    name: 'Component Validation - msrdwaf Subscription assignment'\\n    registrationDescription: 'Managed by Lighthouse'\\n    // Non-required parameters\\n    metadataLocation: '<metadataLocation>'\\n    resourceGroupName: '<resourceGroupName>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Maps Account [Microsoft.Maps/accounts] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/maps/account:0.1.0\",\"name\": \"account\"}],\"rationale\": \"This module deploys an Azure Maps Account.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module account 'br/public:avm/res/maps/account:0.1.0' = {\\n  name: 'accountDeployment'\\n  params: {\\n    name: 'mamin001'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Network Application Gateways [Microsoft.Network/applicationGateways] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/application-gateway:0.7.0\",\"name\": \"applicationGateway\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module applicationGateway 'br/public:avm/res/network/application-gateway:0.7.0' = {\\n  name: 'applicationGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    name: '<name>'\\n    // Non-required parameters\\n    backendAddressPools: [\\n      {\\n        name: 'backendAddressPool1'\\n      }\\n    ]\\n    backendHttpSettingsCollection: [\\n      {\\n        name: 'backendHttpSettings1'\\n        properties: {\\n          cookieBasedAffinity: 'Disabled'\\n          port: 80\\n          protocol: 'Http'\\n        }\\n      }\\n    ]\\n    frontendIPConfigurations: [\\n      {\\n        name: 'frontendIPConfig1'\\n        properties: {\\n          publicIPAddress: {\\n            id: '<id>'\\n          }\\n        }\\n      }\\n    ]\\n    frontendPorts: [\\n      {\\n        name: 'frontendPort1'\\n        properties: {\\n          port: 80\\n        }\\n      }\\n    ]\\n    gatewayIPConfigurations: [\\n      {\\n        name: 'publicIPConfig1'\\n        properties: {\\n          subnet: {\\n            id: '<id>'\\n          }\\n        }\\n      }\\n    ]\\n    httpListeners: [\\n      {\\n        name: 'httpListener1'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: '<id>'\\n          }\\n          frontendPort: {\\n            id: '<id>'\\n          }\\n          hostName: 'www.contoso.com'\\n          protocol: 'Http'\\n        }\\n      }\\n    ]\\n    location: '<location>'\\n    requestRoutingRules: [\\n      {\\n        name: 'requestRoutingRule1'\\n        properties: {\\n          backendAddressPool: {\\n            id: '<id>'\\n          }\\n          backendHttpSettings: {\\n            id: '<id>'\\n          }\\n          httpListener: {\\n            id: '<id>'\\n          }\\n          priority: 100\\n          ruleType: 'Basic'\\n        }\\n      }\\n    ]\\n    sku: 'Basic'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Application Gateway Web Application Firewall (WAF) Policies [Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/application-gateway-web-application-firewall-policy:0.2.0\",\"name\": \"applicationGatewayWebApplicationFirewallPolicy\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module applicationGatewayWebApplicationFirewallPolicy 'br/public:avm/res/network/application-gateway-web-application-firewall-policy:0.2.0' = {\\n  name: 'applicationGatewayWebApplicationFirewallPolicyDeployment'\\n  params: {\\n    // Required parameters\\n    managedRules: {\\n      managedRuleSets: [\\n        {\\n          ruleGroupOverrides: []\\n          ruleSetType: 'OWASP'\\n          ruleSetVersion: '3.2'\\n        }\\n        {\\n          ruleSetType: 'Microsoft_BotManagerRuleSet'\\n          ruleSetVersion: '0.1'\\n        }\\n      ]\\n    }\\n    name: 'nagwafpwaf001'\\n    // Non-required parameters\\n    location: '<location>'\\n    policySettings: {\\n      fileUploadLimitInMb: 10\\n      jsChallengeCookieExpirationInMins: 60\\n      mode: 'Prevention'\\n      state: 'Enabled'\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Firewall [Microsoft.Network/azureFirewalls] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/azure-firewall:0.9.0\",\"name\": \"azureFirewall\"}],\"rationale\": \"This module deploys an Azure Firewall.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module azureFirewall 'br/public:avm/res/network/azure-firewall:0.9.0' = {\\n  name: 'azureFirewallDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nafmin001'\\n    // Non-required parameters\\n    location: '<location>'\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Firewall [Microsoft.Network/azureFirewalls] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/azure-firewall:0.9.0\",\"name\": \"azureFirewall\"}],\"rationale\": \"This module deploys an Azure Firewall.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module azureFirewall 'br/public:avm/res/network/azure-firewall:0.9.0' = {\\n  name: 'azureFirewallDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nafwaf001'\\n    // Non-required parameters\\n    applicationRuleCollections: [\\n      {\\n        name: 'allow-app-rules'\\n        properties: {\\n          action: {\\n            type: 'Allow'\\n          }\\n          priority: 100\\n          rules: [\\n            {\\n              fqdnTags: [\\n                'AppServiceEnvironment'\\n                'WindowsUpdate'\\n              ]\\n              name: 'allow-ase-tags'\\n              protocols: [\\n                {\\n                  port: 80\\n                  protocolType: 'Http'\\n                }\\n                {\\n                  port: 443\\n                  protocolType: 'Https'\\n                }\\n              ]\\n              sourceAddresses: [\\n                '*'\\n              ]\\n            }\\n            {\\n              name: 'allow-ase-management'\\n              protocols: [\\n                {\\n                  port: 80\\n                  protocolType: 'Http'\\n                }\\n                {\\n                  port: 443\\n                  protocolType: 'Https'\\n                }\\n              ]\\n              sourceAddresses: [\\n                '*'\\n              ]\\n              targetFqdns: [\\n                'bing.com'\\n              ]\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n    availabilityZones: [\\n      1\\n      2\\n      3\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    location: '<location>'\\n    networkRuleCollections: [\\n      {\\n        name: 'allow-network-rules'\\n        properties: {\\n          action: {\\n            type: 'Allow'\\n          }\\n          priority: 100\\n          rules: [\\n            {\\n              destinationAddresses: [\\n                '*'\\n              ]\\n              destinationPorts: [\\n                '12000'\\n                '123'\\n              ]\\n              name: 'allow-ntp'\\n              protocols: [\\n                'Any'\\n              ]\\n              sourceAddresses: [\\n                '*'\\n              ]\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n    publicIPResourceID: '<publicIPResourceID>'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Network Gateway Connection [Microsoft.Network/connections] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/connection:0.1.0\",\"name\": \"connection\"}],\"rationale\": \"This module deploys a Virtual Network Gateway Connection.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module connection 'br/public:avm/res/network/connection:0.1.0' = {\\n  name: 'connectionDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ncmin001'\\n    virtualNetworkGateway1: {\\n      id: '<id>'\\n    }\\n    // Non-required parameters\\n    connectionType: 'Vnet2Vnet'\\n    location: '<location>'\\n    virtualNetworkGateway2ResourceId: '<virtualNetworkGateway2ResourceId>'\\n    vpnSharedKey: '<vpnSharedKey>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Dns Forwarding Rulesets [Microsoft.Network/dnsForwardingRulesets] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/dns-forwarding-ruleset:0.5.0\",\"name\": \"dnsForwardingRuleset\"}],\"rationale\": \"This template deploys an dns forwarding ruleset.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module dnsForwardingRuleset 'br/public:avm/res/network/dns-forwarding-ruleset:0.5.0' = {\\n  name: 'dnsForwardingRulesetDeployment'\\n  params: {\\n    // Required parameters\\n    dnsForwardingRulesetOutboundEndpointResourceIds: [\\n      '<dnsResolverOutboundEndpointsResourceId>'\\n    ]\\n    name: 'ndfrsmin001'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Public DNS zone [Microsoft.Network/dnsZones] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/dns-zone:0.5.0\",\"name\": \"dnsZone\"}],\"rationale\": \"This module deploys a Public DNS zone.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module dnsZone 'br/public:avm/res/network/dns-zone:0.5.0' = {\\n  name: 'dnsZoneDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ndzmax001.com'\\n    // Non-required parameters\\n    a: [\\n      {\\n        aRecords: [\\n          {\\n            ipv4Address: '10.240.4.4'\\n          }\\n        ]\\n        name: 'A_10.240.4.4'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        ttl: 3600\\n      }\\n    ]\\n    aaaa: [\\n      {\\n        aaaaRecords: [\\n          {\\n            ipv6Address: '2001:0db8:85a3:0000:0000:8a2e:0370:7334'\\n          }\\n        ]\\n        name: 'AAAA_2001_0db8_85a3_0000_0000_8a2e_0370_7334'\\n        ttl: 3600\\n      }\\n    ]\\n    caa: [\\n      {\\n        caaRecords: [\\n          {\\n            flags: 0\\n            tag: 'issue'\\n            value: 'ca.contoso.com'\\n          }\\n        ]\\n        name: 'CAA_test'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        ttl: 3600\\n      }\\n    ]\\n    cname: [\\n      {\\n        cnameRecord: {\\n          cname: 'test'\\n        }\\n        name: 'CNAME_test'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        ttl: 3600\\n      }\\n      {\\n        name: 'CNAME_aliasRecordSet'\\n        targetResourceId: '<targetResourceId>'\\n      }\\n    ]\\n    location: 'global'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    mx: [\\n      {\\n        mxRecords: [\\n          {\\n            exchange: 'contoso.com'\\n            preference: 100\\n          }\\n        ]\\n        name: 'MX_contoso'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        ttl: 3600\\n      }\\n    ]\\n    ns: [\\n      {\\n        name: 'NS_test'\\n        nsRecords: [\\n          {\\n            nsdname: 'ns.contoso.com'\\n          }\\n        ]\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        ttl: 3600\\n      }\\n    ]\\n    ptr: [\\n      {\\n        name: 'PTR_contoso'\\n        ptrRecords: [\\n          {\\n            ptrdname: 'contoso.com'\\n          }\\n        ]\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        ttl: 3600\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        name: 'a8697438-70e8-4f40-baa4-6e90a57fe1dc'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    soa: [\\n      {\\n        name: '@'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        soaRecord: {\\n          email: 'azuredns-hostmaster.microsoft.com'\\n          expireTime: 2419200\\n          host: 'ns1-04.azure-dns.com.'\\n          minimumTTL: 300\\n          refreshTime: 3600\\n          retryTime: 300\\n          serialNumber: 1\\n        }\\n        ttl: 3600\\n      }\\n    ]\\n    srv: [\\n      {\\n        name: 'SRV_contoso'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        srvRecords: [\\n          {\\n            port: 9332\\n            priority: 0\\n            target: 'test.contoso.com'\\n            weight: 0\\n          }\\n        ]\\n        ttl: 3600\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    txt: [\\n      {\\n        name: 'TXT_test'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        ttl: 3600\\n        txtRecords: [\\n          {\\n            value: [\\n              'test'\\n            ]\\n          }\\n        ]\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Express Route Gateway [Microsoft.Network/expressRouteGateways] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/express-route-gateway:0.8.0\",\"name\": \"expressRouteGateway\"}],\"rationale\": \"This module deploys an Express Route Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module expressRouteGateway 'br/public:avm/res/network/express-route-gateway:0.8.0' = {\\n  name: 'expressRouteGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nergmax001'\\n    virtualHubResourceId: '<virtualHubResourceId>'\\n    // Non-required parameters\\n    autoScaleConfigurationBoundsMax: 3\\n    autoScaleConfigurationBoundsMin: 2\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    roleAssignments: [\\n      {\\n        name: '78ad6c3f-7f77-4d26-9576-dbd947241ef0'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      hello: 'world'\\n      'hidden-title': 'This is visible in the resource name'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Firewall Policy [Microsoft.Network/firewallPolicies] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/firewall-policy:0.3.0\",\"name\": \"firewallPolicy\"}],\"rationale\": \"This module deploys a Firewall Policy.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module firewallPolicy 'br/public:avm/res/network/firewall-policy:0.3.0' = {\\n  name: 'firewallPolicyDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nfpwaf001'\\n    // Non-required parameters\\n    allowSqlRedirect: true\\n    ruleCollectionGroups: [\\n      {\\n        name: 'rule-001'\\n        priority: 5000\\n        ruleCollections: [\\n          {\\n            action: {\\n              type: 'Allow'\\n            }\\n            name: 'collection002'\\n            priority: 5555\\n            ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\\n            rules: [\\n              {\\n                destinationAddresses: [\\n                  '*'\\n                ]\\n                destinationFqdns: []\\n                destinationIpGroups: []\\n                destinationPorts: [\\n                  '80'\\n                ]\\n                ipProtocols: [\\n                  'TCP'\\n                  'UDP'\\n                ]\\n                name: 'rule002'\\n                ruleType: 'NetworkRule'\\n                sourceAddresses: [\\n                  '*'\\n                ]\\n                sourceIpGroups: []\\n              }\\n            ]\\n          }\\n        ]\\n      }\\n    ]\\n    snat: {\\n      autoLearnPrivateRanges: 'Enabled'\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    threatIntelMode: 'Deny'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an IP Group [Microsoft.Network/ipGroups] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/ip-group:0.3.0\",\"name\": \"ipGroup\"}],\"rationale\": \"This module deploys an IP Group.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module ipGroup 'br/public:avm/res/network/ip-group:0.3.0' = {\\n  name: 'ipGroupDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nigmin001'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Load Balancer [Microsoft.Network/loadBalancers] using external load balancer parameter - NIC backend addresses."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/load-balancer:0.5.0\",\"name\": \"loadBalancer\"}],\"rationale\": \"This module deploys a Load Balancer.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module loadBalancer 'br/public:avm/res/network/load-balancer:0.5.0' = {\\n  name: 'loadBalancerDeployment'\\n  params: {\\n    // Required parameters\\n    frontendIPConfigurations: [\\n      {\\n        name: 'publicIPConfig1'\\n        publicIPAddressResourceId: '<publicIPAddressResourceId>'\\n      }\\n    ]\\n    name: 'nlbext001'\\n    // Non-required parameters\\n    backendAddressPools: [\\n      {\\n        backendMembershipMode: 'NIC'\\n        name: 'backendAddressPool1'\\n      }\\n      {\\n        backendMembershipMode: 'None'\\n        name: 'backendAddressPool2'\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    inboundNatRules: [\\n      {\\n        backendPort: 443\\n        enableFloatingIP: false\\n        enableTcpReset: false\\n        frontendIPConfigurationName: 'publicIPConfig1'\\n        frontendPort: 443\\n        idleTimeoutInMinutes: 4\\n        name: 'inboundNatRule1'\\n        protocol: 'Tcp'\\n      }\\n      {\\n        backendPort: 3389\\n        frontendIPConfigurationName: 'publicIPConfig1'\\n        frontendPort: 3389\\n        name: 'inboundNatRule2'\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        backendAddressPoolName: 'backendAddressPool1'\\n        backendPort: 80\\n        disableOutboundSnat: true\\n        enableFloatingIP: false\\n        enableTcpReset: false\\n        frontendIPConfigurationName: 'publicIPConfig1'\\n        frontendPort: 80\\n        idleTimeoutInMinutes: 5\\n        loadDistribution: 'Default'\\n        name: 'publicIPLBRule1'\\n        probeName: 'probe1'\\n        protocol: 'Tcp'\\n      }\\n      {\\n        backendAddressPoolName: 'backendAddressPool2'\\n        backendPort: 8080\\n        frontendIPConfigurationName: 'publicIPConfig1'\\n        frontendPort: 8080\\n        loadDistribution: 'Default'\\n        name: 'publicIPLBRule2'\\n        probeName: 'probe2'\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    outboundRules: [\\n      {\\n        allocatedOutboundPorts: 63984\\n        backendAddressPoolName: 'backendAddressPool1'\\n        frontendIPConfigurationName: 'publicIPConfig1'\\n        name: 'outboundRule1'\\n      }\\n    ]\\n    probes: [\\n      {\\n        intervalInSeconds: 10\\n        name: 'probe1'\\n        numberOfProbes: 5\\n        port: 80\\n        protocol: 'Http'\\n        requestPath: '/http-probe'\\n      }\\n      {\\n        name: 'probe2'\\n        port: 443\\n        protocol: 'Https'\\n        requestPath: '/https-probe'\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a NAT Gateway [Microsoft.Network/natGateways] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/nat-gateway:2.0.0\",\"name\": \"natGateway\"}],\"rationale\": \"This module deploys a NAT Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module natGateway 'br/public:avm/res/network/nat-gateway:2.0.0' = {\\n  name: 'natGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    availabilityZone: 1\\n    name: 'nngmin001'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Network Interface [Microsoft.Network/networkInterfaces] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/network-interface:0.5.0\",\"name\": \"networkInterface\"}],\"rationale\": \"This module deploys a Network Interface.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module networkInterface 'br/public:avm/res/network/network-interface:0.5.0' = {\\n  name: 'networkInterfaceDeployment'\\n  params: {\\n    // Required parameters\\n    ipConfigurations: [\\n      {\\n        applicationSecurityGroups: [\\n          {\\n            id: '<id>'\\n          }\\n        ]\\n        loadBalancerBackendAddressPools: [\\n          {\\n            id: '<id>'\\n          }\\n        ]\\n        name: 'ipconfig01'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n      {\\n        applicationSecurityGroups: [\\n          {\\n            id: '<id>'\\n          }\\n        ]\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    name: 'nniwaf001'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Network Security Perimeter (NSP) [Microsoft.Network/networkSecurityPerimeters] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/network-security-perimeter:0.1.0\",\"name\": \"networkSecurityPerimeter\"}],\"rationale\": \"This module deploys a Network Security Perimeter (NSP).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module networkSecurityPerimeter 'br/public:avm/res/network/network-security-perimeter:0.1.0' = {\\n  name: 'networkSecurityPerimeterDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nnspmin001'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Hub P2S Gateway [Microsoft.Network/p2svpnGateways] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/p2s-vpn-gateway:0.1.0\",\"name\": \"p2sVpnGateway\"}],\"rationale\": \"This module deploys a Virtual Hub P2S Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module p2sVpnGateway 'br/public:avm/res/network/p2s-vpn-gateway:0.1.0' = {\\n  name: 'p2sVpnGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'npvgmaxp2sVpnGw'\\n    virtualHubResourceId: '<virtualHubResourceId>'\\n    // Non-required parameters\\n    associatedRouteTableName: 'noneRouteTable'\\n    customDnsServers: [\\n      '10.50.10.50'\\n      '10.50.50.50'\\n    ]\\n    enableInternetSecurity: false\\n    isRoutingPreferenceInternet: false\\n    location: '<location>'\\n    p2SConnectionConfigurationsName: 'p2sConnectionConfig'\\n    propagatedLabelNames: '<propagatedLabelNames>'\\n    propagatedRouteTableNames: [\\n      '<hubRouteTableName>'\\n    ]\\n    vpnClientAddressPoolAddressPrefixes: [\\n      '10.0.2.0/24'\\n      '10.0.3.0/24'\\n    ]\\n    vpnGatewayScaleUnit: 5\\n    vpnServerConfigurationResourceId: '<vpnServerConfigurationResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Private Endpoint [Microsoft.Network/privateEndpoints] using private link service."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/private-endpoint:0.11.0\",\"name\": \"privateEndpoint\"}],\"rationale\": \"This module deploys a Private Endpoint.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module privateEndpoint 'br/public:avm/res/network/private-endpoint:0.11.0' = {\\n  name: 'privateEndpointDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'npepls001'\\n    subnetResourceId: '<subnetResourceId>'\\n    // Non-required parameters\\n    ipConfigurations: [\\n      {\\n        name: 'myIPconfig'\\n        properties: {\\n          groupId: ''\\n          memberName: ''\\n          privateIPAddress: '10.0.0.10'\\n        }\\n      }\\n    ]\\n    privateLinkServiceConnections: [\\n      {\\n        name: 'npepls001'\\n        properties: {\\n          groupIds: []\\n          privateLinkServiceId: '<privateLinkServiceId>'\\n        }\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Public IP Address [Microsoft.Network/publicIPAddresses] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/public-ip-address:0.9.0\",\"name\": \"publicIpAddress\"}],\"rationale\": \"This module deploys a Public IP Address.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module publicIpAddress 'br/public:avm/res/network/public-ip-address:0.9.0' = {\\n  name: 'publicIpAddressDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'npiawaf001'\\n    // Non-required parameters\\n    availabilityZones: [\\n      1\\n      2\\n      3\\n    ]\\n    ddosSettings: '<ddosSettings>'\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    dnsSettings: '<dnsSettings>'\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    publicIPAddressVersion: 'IPv4'\\n    publicIPAllocationMethod: 'Static'\\n    publicIpPrefixResourceId: '<publicIpPrefixResourceId>'\\n    roleAssignments: [\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    skuName: 'Standard'\\n    skuTier: 'Regional'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a User Defined Route Table (UDR) [Microsoft.Network/routeTables] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/route-table:0.5.0\",\"name\": \"routeTable\"}],\"rationale\": \"This module deploys a User Defined Route Table (UDR).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module routeTable 'br/public:avm/res/network/route-table:0.5.0' = {\\n  name: 'routeTableDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nrtwaf001'\\n    // Non-required parameters\\n    routes: [\\n      {\\n        name: 'default'\\n        properties: {\\n          addressPrefix: '0.0.0.0/0'\\n          nextHopIpAddress: '172.16.0.20'\\n          nextHopType: 'VirtualAppliance'\\n        }\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Hub [Microsoft.Network/virtualHubs] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/virtual-hub:0.4.0\",\"name\": \"virtualHub\"}],\"rationale\": \"This module deploys a Virtual Hub.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualHub 'br/public:avm/res/network/virtual-hub:0.4.0' = {\\n  name: 'virtualHubDeployment'\\n  params: {\\n    // Required parameters\\n    addressPrefix: '10.0.0.0/16'\\n    name: 'nvhmin'\\n    virtualWanResourceId: '<virtualWanResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Network (vNet) [Microsoft.Network/virtualNetworks] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/virtual-network:0.7.0\",\"name\": \"virtualNetwork\"}],\"rationale\": \"This module deploys a Virtual Network (vNet).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualNetwork 'br/public:avm/res/network/virtual-network:0.7.0' = {\\n  name: 'virtualNetworkDeployment'\\n  params: {\\n    // Required parameters\\n    addressPrefixes: [\\n      '<addressPrefix>'\\n    ]\\n    name: 'nvnmax001'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    dnsServers: [\\n      '10.0.1.4'\\n      '10.0.1.5'\\n    ]\\n    flowTimeoutInMinutes: 20\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    roleAssignments: [\\n      {\\n        name: 'f5c27a7b-9b18-4dc1-b002-db3c38e80b64'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    subnets: [\\n      {\\n        addressPrefix: '<addressPrefix>'\\n        name: 'GatewaySubnet'\\n      }\\n      {\\n        addressPrefix: '<addressPrefix>'\\n        name: 'az-subnet-x-001'\\n        networkSecurityGroupResourceId: '<networkSecurityGroupResourceId>'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        routeTableResourceId: '<routeTableResourceId>'\\n        serviceEndpoints: [\\n          'Microsoft.Sql'\\n          'Microsoft.Storage'\\n        ]\\n      }\\n      {\\n        addressPrefix: '<addressPrefix>'\\n        delegation: 'Microsoft.Netapp/volumes'\\n        name: 'az-subnet-x-002'\\n        networkSecurityGroupResourceId: '<networkSecurityGroupResourceId>'\\n      }\\n      {\\n        addressPrefix: '<addressPrefix>'\\n        name: 'az-subnet-x-003'\\n        networkSecurityGroupResourceId: '<networkSecurityGroupResourceId>'\\n        privateEndpointNetworkPolicies: 'Disabled'\\n        privateLinkServiceNetworkPolicies: 'Enabled'\\n      }\\n      {\\n        addressPrefix: '<addressPrefix>'\\n        name: 'az-subnet-x-004'\\n        natGatewayResourceId: ''\\n        networkSecurityGroupResourceId: ''\\n        routeTableResourceId: ''\\n      }\\n      {\\n        addressPrefix: '<addressPrefix>'\\n        name: 'AzureBastionSubnet'\\n        networkSecurityGroupResourceId: '<networkSecurityGroupResourceId>'\\n      }\\n      {\\n        addressPrefix: '<addressPrefix>'\\n        name: 'AzureFirewallSubnet'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Network Gateway [Microsoft.Network/virtualNetworkGateways] using the VPN Active Passive with BGP settings configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/virtual-network-gateway:0.10.0\",\"name\": \"virtualNetworkGateway\"}],\"rationale\": \"This module deploys a Virtual Network Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualNetworkGateway 'br/public:avm/res/network/virtual-network-gateway:0.10.0' = {\\n  name: 'virtualNetworkGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    clusterSettings: {\\n      asn: 65815\\n      clusterMode: 'activePassiveBgp'\\n      customBgpIpAddresses: [\\n        '169.254.21.4'\\n        '169.254.21.5'\\n      ]\\n    }\\n    gatewayType: 'Vpn'\\n    name: 'nvgapb001'\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n    // Non-required parameters\\n    allowRemoteVnetTraffic: true\\n    disableIPSecReplayProtection: true\\n    domainNameLabel: [\\n      'dm-nvgapb'\\n    ]\\n    enableBgpRouteTranslationForNat: true\\n    enablePrivateIpAddress: true\\n    gatewayDefaultSiteLocalNetworkGatewayResourceId: '<gatewayDefaultSiteLocalNetworkGatewayResourceId>'\\n    publicIpAvailabilityZones: [\\n      1\\n      2\\n      3\\n    ]\\n    skuName: 'VpnGw2AZ'\\n    vpnGatewayGeneration: 'Generation2'\\n    vpnType: 'RouteBased'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Network Gateway [Microsoft.Network/virtualNetworkGateways] using SKU without Availability Zones."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/virtual-network-gateway:0.10.0\",\"name\": \"virtualNetworkGateway\"}],\"rationale\": \"This module deploys a Virtual Network Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualNetworkGateway 'br/public:avm/res/network/virtual-network-gateway:0.10.0' = {\\n  name: 'virtualNetworkGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    clusterSettings: {\\n      clusterMode: 'activePassiveNoBgp'\\n    }\\n    gatewayType: 'Vpn'\\n    name: 'nvgnaz001'\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n    // Non-required parameters\\n    publicIpAvailabilityZones: []\\n    skuName: 'VpnGw1'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a VPN Gateway [Microsoft.Network/vpnGateways] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/vpn-gateway:0.2.0\",\"name\": \"vpnGateway\"}],\"rationale\": \"This module deploys a VPN Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module vpnGateway 'br/public:avm/res/network/vpn-gateway:0.2.0' = {\\n  name: 'vpnGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'vpngmax001'\\n    virtualHubResourceId: '<virtualHubResourceId>'\\n    // Non-required parameters\\n    bgpSettings: {\\n      asn: 65515\\n      peerWeight: 0\\n    }\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    natRules: [\\n      {\\n        externalMappings: [\\n          {\\n            addressSpace: '192.168.21.0/24'\\n          }\\n        ]\\n        internalMappings: [\\n          {\\n            addressSpace: '10.4.0.0/24'\\n          }\\n        ]\\n        mode: 'EgressSnat'\\n        name: 'natRule1'\\n        type: 'Static'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    vpnConnections: [\\n      {\\n        enableBgp: false\\n        enableInternetSecurity: true\\n        enableRateLimiting: false\\n        name: '<name>'\\n        remoteVpnSiteResourceId: '<remoteVpnSiteResourceId>'\\n        routingWeight: 0\\n        useLocalAzureIpAddress: false\\n        usePolicyBasedTrafficSelectors: false\\n        vpnConnectionProtocolType: 'IKEv2'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a VPN Site [Microsoft.Network/vpnSites] using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/vpn-site:0.4.0\",\"name\": \"vpnSite\"}],\"rationale\": \"This module deploys a VPN Site.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module vpnSite 'br/public:avm/res/network/vpn-site:0.4.0' = {\\n  name: 'vpnSiteDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nvsmax'\\n    virtualWanResourceId: '<virtualWanResourceId>'\\n    // Non-required parameters\\n    deviceProperties: {\\n      linkSpeedInMbps: 0\\n    }\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    o365Policy: {\\n      breakOutCategories: {\\n        allow: true\\n        default: true\\n        optimize: true\\n      }\\n    }\\n    roleAssignments: [\\n      {\\n        name: '1dcfa9c2-5e95-42d2-bf04-bdecad93abcf'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      'hidden-title': 'This is visible in the resource name'\\n      tagA: 'valueA'\\n      tagB: 'valueB'\\n    }\\n    vpnSiteLinks: [\\n      {\\n        name: 'vSite-nvsmax'\\n        properties: {\\n          bgpProperties: {\\n            asn: 65010\\n            bgpPeeringAddress: '1.1.1.1'\\n          }\\n          ipAddress: '1.2.3.4'\\n          linkProperties: {\\n            linkProviderName: 'contoso'\\n            linkSpeedInMbps: 5\\n          }\\n        }\\n      }\\n      {\\n        name: 'Link1'\\n        properties: {\\n          bgpProperties: {\\n            asn: 65020\\n            bgpPeeringAddress: '192.168.1.0'\\n          }\\n          ipAddress: '2.2.2.2'\\n          linkProperties: {\\n            linkProviderName: 'contoso'\\n            linkSpeedInMbps: 5\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Operations Management Solution [Microsoft.OperationsManagement/solutions] using the Microsoft solution configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/operations-management/solution:0.3.0\",\"name\": \"solution\"}],\"rationale\": \"This module deploys an Operations Management Solution.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module solution 'br/public:avm/res/operations-management/solution:0.3.0' = {\\n  name: 'solutionDeployment'\\n  params: {\\n    // Required parameters\\n    logAnalyticsWorkspaceName: '<logAnalyticsWorkspaceName>'\\n    name: '<name>'\\n    plan: {\\n      product: 'OMSGallery/AzureAutomation'\\n    }\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Power BI Dedicated Capacity [Microsoft.PowerBIDedicated/capacities] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/power-bi-dedicated/capacity:0.2.0\",\"name\": \"capacity\"}],\"rationale\": \"This module deploys a Power BI Dedicated Capacity.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module capacity 'br/public:avm/res/power-bi-dedicated/capacity:0.2.0' = {\\n  name: 'capacityDeployment'\\n  params: {\\n    // Required parameters\\n    members: [\\n      '<managedIdentityPrincipalId>'\\n    ]\\n    name: 'pbdcapmin001'\\n    sku: {\\n      capacity: 1\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Recovery Services Vault [Microsoft.RecoveryServices/vaults] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/recovery-services/vault:0.10.0\",\"name\": \"vault\"}],\"rationale\": \"This module deploys a Recovery Services Vault.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module vault 'br/public:avm/res/recovery-services/vault:0.10.0' = {\\n  name: 'vaultDeployment'\\n  params: {\\n    name: 'rsvmin001'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Relay Namespaces [Microsoft.Relay/namespaces] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/relay/namespace:0.7.0\",\"name\": \"namespace\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module namespace 'br/public:avm/res/relay/namespace:0.7.0' = {\\n  name: 'namespaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'rnwaf001'\\n    // Non-required parameters\\n    authorizationRules: [\\n      {\\n        name: 'RootManageSharedAccessKey'\\n        rights: [\\n          'Listen'\\n          'Manage'\\n          'Send'\\n        ]\\n      }\\n      {\\n        name: 'AnotherKey'\\n        rights: [\\n          'Listen'\\n          'Send'\\n        ]\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    hybridConnections: [\\n      {\\n        name: 'rnwafhc001'\\n        userMetadata: '[{\\\\'key\\\\':\\\\'endpoint\\\\',\\\\'value\\\\':\\\\'db-server.constoso.com:1433\\\\'}]'\\n      }\\n    ]\\n    networkRuleSets: {\\n      defaultAction: 'Deny'\\n      ipRules: [\\n        {\\n          action: 'Allow'\\n          ipMask: '10.0.1.0/32'\\n        }\\n        {\\n          action: 'Allow'\\n          ipMask: '10.0.2.0/32'\\n        }\\n      ]\\n      trustedServiceAccessEnabled: true\\n      virtualNetworkRules: [\\n        {\\n          subnet: {\\n            id: '<id>'\\n            ignoreMissingVnetServiceEndpoint: true\\n          }\\n        }\\n      ]\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'namespace'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    wcfRelays: [\\n      {\\n        name: 'rnwafwcf001'\\n        relayType: 'NetTcp'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Deployment Scripts [Microsoft.Resources/deploymentScripts] using Private Endpoint."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/resources/deployment-script:0.5.0\",\"name\": \"deploymentScript\"}],\"rationale\": \"This module deploys Deployment Scripts.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module deploymentScript 'br/public:avm/res/resources/deployment-script:0.5.0' = {\\n  name: 'deploymentScriptDeployment'\\n  params: {\\n    // Required parameters\\n    kind: 'AzureCLI'\\n    name: 'rdspe001'\\n    // Non-required parameters\\n    azCliVersion: '2.52.0'\\n    cleanupPreference: 'Always'\\n    location: '<location>'\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    retentionInterval: 'P1D'\\n    runOnce: true\\n    scriptContent: 'echo \\\\'AVM Deployment Script test!\\\\''\\n    storageAccountResourceId: '<storageAccountResourceId>'\\n    subnetResourceIds: [\\n      '<subnetResourceId>'\\n    ]\\n    timeout: 'PT1H'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Search Service [Microsoft.Search/searchServices] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/search/search-service:0.11.0\",\"name\": \"searchService\"}],\"rationale\": \"This module deploys a Search Service.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module searchService 'br/public:avm/res/search/search-service:0.11.0' = {\\n  name: 'searchServiceDeployment'\\n  params: {\\n    name: 'sssmin002'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Security Insights Data Connectors [Microsoft.SecurityInsights/dataConnectors] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/security-insights/data-connector:0.1.0\",\"name\": \"dataConnector\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module dataConnector 'br/public:avm/res/security-insights/data-connector:0.1.0' = {\\n  name: 'dataConnectorDeployment'\\n  params: {\\n    // Required parameters\\n    properties: {\\n      kind: 'MicrosoftThreatIntelligence'\\n      properties: {\\n        dataTypes: {\\n          microsoftEmergingThreatFeed: {\\n            lookbackPeriod: '2025-01-01T00:00:00Z'\\n            state: 'Enabled'\\n          }\\n        }\\n        tenantId: '<tenantId>'\\n      }\\n    }\\n    workspaceResourceId: '<workspaceResourceId>'\\n    // Non-required parameters\\n    name: 'MicrosoftThreatIntelligence'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Service Bus Namespace [Microsoft.ServiceBus/namespaces] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/service-bus/namespace:0.15.0\",\"name\": \"namespace\"}],\"rationale\": \"This module deploys a Service Bus Namespace.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module namespace 'br/public:avm/res/service-bus/namespace:0.15.0' = {\\n  name: 'namespaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'sbnwaf001'\\n    // Non-required parameters\\n    authorizationRules: [\\n      {\\n        name: 'RootManageSharedAccessKey'\\n        rights: [\\n          'Listen'\\n          'Manage'\\n          'Send'\\n        ]\\n      }\\n      {\\n        name: 'AnotherKey'\\n        rights: [\\n          'Listen'\\n          'Send'\\n        ]\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    networkRuleSets: {\\n      defaultAction: 'Deny'\\n      ipRules: [\\n        {\\n          action: 'Allow'\\n          ipMask: '10.0.1.0/32'\\n        }\\n        {\\n          action: 'Allow'\\n          ipMask: '10.0.2.0/32'\\n        }\\n      ]\\n      trustedServiceAccessEnabled: true\\n      virtualNetworkRules: [\\n        {\\n          ignoreMissingVnetServiceEndpoint: true\\n          subnetResourceId: '<subnetResourceId>'\\n        }\\n      ]\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'namespace'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n    ]\\n    publicNetworkAccess: 'Disabled'\\n    queues: [\\n      {\\n        authorizationRules: [\\n          {\\n            name: 'RootManageSharedAccessKey'\\n            rights: [\\n              'Listen'\\n              'Manage'\\n              'Send'\\n            ]\\n          }\\n          {\\n            name: 'AnotherKey'\\n            rights: [\\n              'Listen'\\n              'Send'\\n            ]\\n          }\\n        ]\\n        autoDeleteOnIdle: 'PT5M'\\n        maxMessageSizeInKilobytes: 2048\\n        name: 'sbnwafq001'\\n        roleAssignments: []\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    topics: [\\n      {\\n        authorizationRules: [\\n          {\\n            name: 'RootManageSharedAccessKey'\\n            rights: [\\n              'Listen'\\n              'Manage'\\n              'Send'\\n            ]\\n          }\\n          {\\n            name: 'AnotherKey'\\n            rights: [\\n              'Listen'\\n              'Send'\\n            ]\\n          }\\n        ]\\n        name: 'sbnwaft001'\\n        roleAssignments: []\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Application Gateway for Containers [Microsoft.ServiceNetworking/trafficControllers] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/service-networking/traffic-controller:0.1.0\",\"name\": \"trafficController\"}],\"rationale\": \"This module deploys an Application Gateway for Containers\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module trafficController 'br/public:avm/res/service-networking/traffic-controller:0.1.0' = {\\n  name: 'trafficControllerDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'sntcwaf001'\\n    // Non-required parameters\\n    associations: [\\n      {\\n        name: 'association1'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    frontends: [\\n      {\\n        name: 'frontend1'\\n      }\\n      {\\n        name: 'frontend2'\\n      }\\n    ]\\n    location: '<location>'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure SQL Server Instance Pool [Microsoft.Sql/instancePools] using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/sql/instance-pool:0.1.0\",\"name\": \"instancePool\"}],\"rationale\": \"This module deploys an Azure SQL Server Instance Pool.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module instancePool 'br/public:avm/res/sql/instance-pool:0.1.0' = {\\n  name: 'instancePoolDeployment'\\n  params: {\\n    // Required parameters\\n    name: '<name>'\\n    subnetResourceId: '<subnetResourceId>'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure SQL Server [Microsoft.Sql/servers] with audit settings."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/sql/server:0.20.0\",\"name\": \"server\"}],\"rationale\": \"This module deploys an Azure SQL Server.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module server 'br/public:avm/res/sql/server:0.20.0' = {\\n  name: 'serverDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ssaud001'\\n    // Non-required parameters\\n    administratorLogin: 'adminUserName'\\n    administratorLoginPassword: '<administratorLoginPassword>'\\n    auditSettings: {\\n      isManagedIdentityInUse: true\\n      state: 'Enabled'\\n      storageAccountResourceId: '<storageAccountResourceId>'\\n    }\\n    location: '<location>'\\n    managedIdentities: {\\n      systemAssigned: true\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure SQL Server [Microsoft.Sql/servers] with a secondary database."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/sql/server:0.20.0\",\"name\": \"server\"}],\"rationale\": \"This module deploys an Azure SQL Server.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module server 'br/public:avm/res/sql/server:0.20.0' = {\\n  name: 'serverDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'sqlsec-sec'\\n    // Non-required parameters\\n    administratorLogin: 'adminUserName'\\n    administratorLoginPassword: '<administratorLoginPassword>'\\n    databases: [\\n      {\\n        availabilityZone: -1\\n        createMode: 'Secondary'\\n        maxSizeBytes: 2147483648\\n        name: '<name>'\\n        sku: {\\n          name: 'Basic'\\n          tier: 'Basic'\\n        }\\n        sourceDatabaseResourceId: '<sourceDatabaseResourceId>'\\n        zoneRedundant: false\\n      }\\n    ]\\n    location: '<location>'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Storage Account [Microsoft.Storage/storageAccounts] using Customer-Managed-Keys with System-Assigned identity."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/storage/storage-account:0.27.0\",\"name\": \"storageAccount\"}],\"rationale\": \"This module deploys a Storage Account.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module storageAccount 'br/public:avm/res/storage/storage-account:0.27.0' = {\\n  name: 'storageAccountDeployment'\\n  params: {\\n    // Required parameters\\n    name: '<name>'\\n    // Non-required parameters\\n    blobServices: {\\n      containers: [\\n        {\\n          name: 'container'\\n          publicAccess: 'None'\\n        }\\n      ]\\n    }\\n    customerManagedKey: {\\n      keyName: '<keyName>'\\n      keyVaultResourceId: '<keyVaultResourceId>'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'blob'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Storage Account [Microsoft.Storage/storageAccounts] deploying with a NFS File Share."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/storage/storage-account:0.27.0\",\"name\": \"storageAccount\"}],\"rationale\": \"This module deploys a Storage Account.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module storageAccount 'br/public:avm/res/storage/storage-account:0.27.0' = {\\n  name: 'storageAccountDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ssanfs001'\\n    // Non-required parameters\\n    fileServices: {\\n      shares: [\\n        {\\n          enabledProtocols: 'NFS'\\n          name: 'nfsfileshare'\\n        }\\n      ]\\n    }\\n    kind: 'FileStorage'\\n    skuName: 'Premium_LRS'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Synapse Workspace [Microsoft.Synapse/workspaces] using Big Data Pool."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/synapse/workspace:0.14.0\",\"name\": \"workspace\"}],\"rationale\": \"This module deploys a Synapse Workspace.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module workspace 'br/public:avm/res/synapse/workspace:0.14.0' = {\\n  name: 'workspaceDeployment'\\n  params: {\\n    // Required parameters\\n    defaultDataLakeStorageAccountResourceId: '<defaultDataLakeStorageAccountResourceId>'\\n    defaultDataLakeStorageFilesystem: '<defaultDataLakeStorageFilesystem>'\\n    name: 'swbdp001'\\n    sqlAdministratorLogin: 'synwsadmin'\\n    // Non-required parameters\\n    bigDataPools: [\\n      {\\n        autoPauseDelayInMinutes: 10\\n        autoScale: {\\n          maxNodeCount: 5\\n          minNodeCount: 3\\n        }\\n        autotuneEnabled: true\\n        cacheSize: 50\\n        dynamicExecutorAllocation: {\\n          maxExecutors: 4\\n          minExecutors: 1\\n        }\\n        name: 'depbdp01'\\n        nodeSize: 'Small'\\n        nodeSizeFamily: 'MemoryOptimized'\\n        sessionLevelPackagesEnabled: true\\n      }\\n      {\\n        name: 'depbdp02'\\n        nodeSize: 'Small'\\n        nodeSizeFamily: 'MemoryOptimized'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Synapse Workspace [Microsoft.Synapse/workspaces] using SQL Pool."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/synapse/workspace:0.14.0\",\"name\": \"workspace\"}],\"rationale\": \"This module deploys a Synapse Workspace.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module workspace 'br/public:avm/res/synapse/workspace:0.14.0' = {\\n  name: 'workspaceDeployment'\\n  params: {\\n    // Required parameters\\n    defaultDataLakeStorageAccountResourceId: '<defaultDataLakeStorageAccountResourceId>'\\n    defaultDataLakeStorageFilesystem: '<defaultDataLakeStorageFilesystem>'\\n    name: 'swsqlp001'\\n    sqlAdministratorLogin: 'synwsadmin'\\n    // Non-required parameters\\n    sqlPools: [\\n      {\\n        name: 'depsqlp01'\\n      }\\n      {\\n        collation: 'SQL_Latin1_General_CP1_CI_AS'\\n        maxSizeBytes: 1099511627776\\n        name: 'depsqlp02'\\n        sku: 'DW200c'\\n        storageAccountType: 'LRS'\\n        transparentDataEncryption: 'Enabled'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for API Connections [Microsoft.Web/connections] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/web/connection:0.4.0\",\"name\": \"connection\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module connection 'br/public:avm/res/web/connection:0.4.0' = {\\n  name: 'connectionDeployment'\\n  params: {\\n    // Required parameters\\n    displayName: 'azuremonitorlogs'\\n    name: 'azuremonitor'\\n    // Non-required parameters\\n    api: {\\n      id: '<id>'\\n    }\\n    location: '<location>'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an App Service Plan [Microsoft.Web/serverfarms] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/web/serverfarm:0.5.0\",\"name\": \"serverfarm\"}],\"rationale\": \"This module deploys an App Service Plan.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module serverfarm 'br/public:avm/res/web/serverfarm:0.5.0' = {\\n  name: 'serverfarmDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'wsfwaf001'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSettingwsfwaf'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    kind: 'app'\\n    skuCapacity: 3\\n    skuName: 'P1v3'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    zoneRedundant: true\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Web or Function App [Microsoft.Web/sites] using the Web App, using only defaults configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/web/site:0.19.0\",\"name\": \"site\"}],\"rationale\": \"This module deploys a Web or Function App.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module site 'br/public:avm/res/web/site:0.19.0' = {\\n  name: 'siteDeployment'\\n  params: {\\n    // Required parameters\\n    kind: 'app'\\n    name: 'wswamin001'\\n    serverFarmResourceId: '<serverFarmResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Static Web App [Microsoft.Web/staticSites] using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/web/static-site:0.9.0\",\"name\": \"staticSite\"}],\"rationale\": \"This module deploys a Static Web App.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module staticSite 'br/public:avm/res/web/static-site:0.9.0' = {\\n  name: 'staticSiteDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'wsswaf001'\\n    // Non-required parameters\\n    allowConfigFileUpdates: true\\n    appSettings: {\\n      foo: 'bar'\\n      setting: 1\\n    }\\n    enterpriseGradeCdnStatus: 'Disabled'\\n    functionAppSettings: {\\n      foo: 'bar'\\n      setting: 1\\n    }\\n    linkedBackend: {\\n      resourceId: '<resourceId>'\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n    ]\\n    sku: 'Standard'\\n    stagingEnvironmentPolicy: 'Enabled'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for ai-foundry using the Bring Your Own Resources configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/ai-ml/ai-foundry:0.5.0\",\"name\": \"aiFoundry\"}],\"rationale\": \"Creates an AI Foundry account and project with Standard Agent Services.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module aiFoundry 'br/public:avm/ptn/ai-ml/ai-foundry:0.5.0' = {\\n  name: 'aiFoundryDeployment'\\n  params: {\\n    // Required parameters\\n    baseName: '<baseName>'\\n    // Non-required parameters\\n    aiFoundryConfiguration: {\\n      createCapabilityHosts: true\\n    }\\n    aiModelDeployments: [\\n      {\\n        model: {\\n          format: 'OpenAI'\\n          name: 'gpt-4o'\\n          version: '2024-11-20'\\n        }\\n        name: 'gpt-4o'\\n        sku: {\\n          capacity: 1\\n          name: 'Standard'\\n        }\\n      }\\n    ]\\n    aiSearchConfiguration: {\\n      existingResourceId: '<existingResourceId>'\\n    }\\n    cosmosDbConfiguration: {\\n      existingResourceId: '<existingResourceId>'\\n    }\\n    includeAssociatedResources: true\\n    keyVaultConfiguration: {\\n      existingResourceId: '<existingResourceId>'\\n    }\\n    storageAccountConfiguration: {\\n      existingResourceId: '<existingResourceId>'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for AI Platform Baseline using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/ai-platform/baseline:0.7.0\",\"name\": \"baseline\"}],\"rationale\": \"This module provides a secure and scalable environment for deploying AI applications on Azure.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module baseline 'br/public:avm/ptn/ai-platform/baseline:0.7.0' = {\\n  name: 'baselineDeployment'\\n  params: {\\n    // Required parameters\\n    name: '<name>'\\n    // Non-required parameters\\n    managedIdentityName: '<managedIdentityName>'\\n    tags: {\\n      Env: 'test'\\n      'hidden-title': 'This is visible in the resource name'\\n    }\\n    virtualMachineConfiguration: {\\n      adminPassword: '<adminPassword>'\\n      adminUsername: 'localAdminUser'\\n      enableAadLoginExtension: true\\n      enableAzureMonitorAgent: true\\n      maintenanceConfigurationResourceId: '<maintenanceConfigurationResourceId>'\\n      patchMode: 'AutomaticByPlatform'\\n      zone: 1\\n    }\\n    workspaceConfiguration: {\\n      networkIsolationMode: 'AllowOnlyApprovedOutbound'\\n      networkOutboundRules: {\\n        rule: {\\n          category: 'UserDefined'\\n          destination: {\\n            serviceResourceId: '<serviceResourceId>'\\n            subresourceTarget: 'blob'\\n          }\\n          type: 'PrivateEndpoint'\\n        }\\n      }\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a container to run as a job using the Align to WAF configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/app/container-job-toolkit:0.1.0\",\"name\": \"containerJobToolkit\"}],\"rationale\": \"This module deploys a container to run as a job.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module containerJobToolkit 'br/public:avm/ptn/app/container-job-toolkit:0.1.0' = {\\n  name: 'containerJobToolkitDeployment'\\n  params: {\\n    // Required parameters\\n    containerImageSource: 'mcr.microsoft.com/k8se/quickstart-jobs:latest'\\n    name: 'acjwaf001'\\n    // Non-required parameters\\n    appInsightsConnectionString: '<appInsightsConnectionString>'\\n    deployInVnet: true\\n    location: '<location>'\\n    logAnalyticsWorkspaceResourceId: '<logAnalyticsWorkspaceResourceId>'\\n    managedIdentityResourceId: '<managedIdentityResourceId>'\\n    overwriteExistingImage: true\\n    tags: {\\n      Env: 'test'\\n      'hidden-title': 'This is visible in the resource name'\\n    }\\n    workloadProfileName: 'CAW01'\\n    workloadProfiles: [\\n      {\\n        maximumCount: 6\\n        minimumCount: 3\\n        name: 'CAW01'\\n        workloadProfileType: 'D4'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a PIM Role Assignment at a Management Group, Subscription or Resource Group scope using the PIM Active permanent Role Assignments (Subscription scope) configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/authorization/pim-role-assignment:0.1.0\",\"name\": \"pimRoleAssignment\"}],\"rationale\": \"This module deploys a PIM Role Assignment at a Management Group, Subscription or Resource Group scope.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module pimRoleAssignment 'br/public:avm/ptn/authorization/pim-role-assignment:0.1.0' = {\\n  name: 'pimRoleAssignmentDeployment'\\n  params: {\\n    // Required parameters\\n    pimRoleAssignmentType: {\\n      roleAssignmentType: 'Active'\\n      scheduleInfo: {\\n        durationType: 'NoExpiration'\\n      }\\n    }\\n    principalId: '<principalId>'\\n    requestType: 'AdminAssign'\\n    roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n    // Non-required parameters\\n    justification: 'AVM test'\\n    subscriptionId: '<subscriptionId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Policy Exemption at a Management Group, Subscription or Resource Group scope using the Policy Exemptions (Management Group scope) configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/authorization/policy-exemption:0.1.0\",\"name\": \"policyExemption\"}],\"rationale\": \"This module deploys a Policy Exemption at a Management Group, Subscription or Resource Group scope.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module policyExemption 'br/public:avm/ptn/authorization/policy-exemption:0.1.0' = {\\n  name: 'policyExemptionDeployment'\\n  params: {\\n    // Required parameters\\n    exemptionCategory: 'Mitigated'\\n    name: 'apemgmin001'\\n    policyAssignmentId: '<policyAssignmentId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Role Assignment for a specific resource using the Resource Role Assignments configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/authorization/resource-role-assignment:0.1.0\",\"name\": \"resourceRoleAssignment\"}],\"rationale\": \"This module deploys a Role Assignment for a specific resource.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module resourceRoleAssignment 'br/public:avm/ptn/authorization/resource-role-assignment:0.1.0' = {\\n  name: 'resourceRoleAssignmentDeployment'\\n  params: {\\n    // Required parameters\\n    principalId: '<principalId>'\\n    resourceId: '<resourceId>'\\n    roleDefinitionId: '2a2b9908-6ea1-4ae2-8e65-a410df84e7d1'\\n    // Non-required parameters\\n    principalType: 'ServicePrincipal'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a custom role definition to a Management Group using the Role Definition (Management Group scope) - Required Parameters configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/authorization/role-definition:0.1.0\",\"name\": \"roleDefinition\"}],\"rationale\": \"This module deploys a custom role definition to a Management Group.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module roleDefinition 'br/public:avm/ptn/authorization/role-definition:0.1.0' = {\\n  name: 'roleDefinitionDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'rbac-custom-role-reader'\\n    // Non-required parameters\\n    actions: [\\n      '*/read'\\n    ]\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for avm/ptn/azd/apim-api using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/azd/apim-api:0.1.0\",\"name\": \"apimApi\"}],\"rationale\": \"Creates and configure an API within an API Management service instance.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module apimApi 'br/public:avm/ptn/azd/apim-api:0.1.0' = {\\n  name: 'apimApiDeployment'\\n  params: {\\n    // Required parameters\\n    apiBackendUrl: '<apiBackendUrl>'\\n    apiDescription: 'api description'\\n    apiDisplayName: 'apd-aapmin'\\n    apiName: 'an-aapmin001'\\n    apiPath: 'apipath-aapmin'\\n    name: '<name>'\\n    webFrontendUrl: '<webFrontendUrl>'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azd Azure Machine Learning Environment using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/azd/ml-ai-environment:0.1.0\",\"name\": \"mlAiEnvironment\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS DEPRECATED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module mlAiEnvironment 'br/public:avm/ptn/azd/ml-ai-environment:0.1.0' = {\\n  name: 'mlAiEnvironmentDeployment'\\n  params: {\\n    // Required parameters\\n    cognitiveServicesName: 'maemaxcs001'\\n    hubName: 'maemaxhub001'\\n    keyVaultName: 'maemaxkv002'\\n    openAiConnectionName: 'maemaxai001-connection'\\n    projectName: 'maemaxpro001'\\n    searchConnectionName: 'maemaxsearch001-connection'\\n    storageAccountName: 'maemaxsta001'\\n    userAssignedtName: 'maemaxua001'\\n    // Non-required parameters\\n    applicationInsightsName: 'maemaxappin001'\\n    cognitiveServicesDeployments: [\\n      {\\n        model: {\\n          format: 'OpenAI'\\n          name: 'gpt-35-turbo'\\n          version: '0613'\\n        }\\n        name: 'gpt-35-turbo'\\n        sku: {\\n          capacity: 20\\n          name: 'Standard'\\n        }\\n      }\\n    ]\\n    containerRegistryName: 'maemaxcr001'\\n    location: '<location>'\\n    logAnalyticsName: 'maemaxla001'\\n    searchServiceName: 'maemaxsearch001'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for private-analytical-workspace using the Minimal Deployment - fully private configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/data/private-analytical-workspace:0.1.0\",\"name\": \"privateAnalyticalWorkspace\"}],\"rationale\": \"This pattern module enables you to use Azure services that are typical for data analytics solutions. The goal is to help data scientists establish an environment for data analysis simply. It is secure by default for enterprise use. Data scientists should not spend much time on how to build infrastructure solution. They should mainly concentrate on the data analytics components they require for the solution.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module privateAnalyticalWorkspace 'br/public:avm/ptn/data/private-analytical-workspace:0.1.0' = {\\n  name: 'privateAnalyticalWorkspaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dpawminpriv002'\\n    // Non-required parameters\\n    advancedOptions: {\\n      keyVault: {\\n        enablePurgeProtection: false\\n      }\\n    }\\n    enableDatabricks: false\\n    tags: {\\n      CostCenter: '123-456-789'\\n      Owner: 'Contoso'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for private-analytical-workspace using the Use Case 3 - allowed IP address configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/data/private-analytical-workspace:0.1.0\",\"name\": \"privateAnalyticalWorkspace\"}],\"rationale\": \"This pattern module enables you to use Azure services that are typical for data analytics solutions. The goal is to help data scientists establish an environment for data analysis simply. It is secure by default for enterprise use. Data scientists should not spend much time on how to build infrastructure solution. They should mainly concentrate on the data analytics components they require for the solution.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module privateAnalyticalWorkspace 'br/public:avm/ptn/data/private-analytical-workspace:0.1.0' = {\\n  name: 'privateAnalyticalWorkspaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dpawu3p002'\\n    // Non-required parameters\\n    advancedOptions: {\\n      databricks: {\\n        subnetNameBackend: '<subnetNameBackend>'\\n        subnetNameFrontend: '<subnetNameFrontend>'\\n      }\\n      networkAcls: {\\n        ipRules: [\\n          '104.43.16.94'\\n        ]\\n      }\\n      virtualNetwork: {\\n        subnetNamePrivateLink: '<subnetNamePrivateLink>'\\n      }\\n    }\\n    enableDatabricks: true\\n    keyVaultResourceId: '<keyVaultResourceId>'\\n    logAnalyticsWorkspaceResourceId: '<logAnalyticsWorkspaceResourceId>'\\n    tags: {\\n      CostCenter: '123-456-789'\\n      Owner: 'Contoso'\\n    }\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for self-hosted agents and runners for Azure DevOps and GitHub on Azure Container Instances and/or Azure Container Apps using only defaults for GitHub self-hosted runners using Azure Container Apps."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/dev-ops/cicd-agents-and-runners:0.3.0\",\"name\": \"cicdAgentsAndRunners\"}],\"rationale\": \"This module deploys self-hosted agents and runners for Azure DevOps and GitHub on Azure Container Instances and/or Azure Container Apps.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module cicdAgentsAndRunners 'br/public:avm/ptn/dev-ops/cicd-agents-and-runners:0.3.0' = {\\n  name: 'cicdAgentsAndRunnersDeployment'\\n  params: {\\n    // Required parameters\\n    computeTypes: [\\n      'azure-container-app'\\n    ]\\n    namingPrefix: '<namingPrefix>'\\n    networkingConfiguration: {\\n      addressSpace: '10.0.0.0/16'\\n      networkType: 'createNew'\\n      virtualNetworkName: 'vnet-aca'\\n    }\\n    selfHostedConfig: {\\n      azureContainerAppTarget: {\\n        resources: {\\n          cpu: '1'\\n          memory: '2Gi'\\n        }\\n      }\\n      githubOrganization: 'githHubOrganization'\\n      githubRepository: 'dummyRepo'\\n      personalAccessToken: '<personalAccessToken>'\\n      selfHostedType: 'github'\\n    }\\n    // Non-required parameters\\n    location: '<location>'\\n    logAnalyticsReplicationRegion: 'westus2'\\n    privateNetworking: false\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Finops hub from the Finops toolkit using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/finops-toolkit/finops-hub:0.1.0\",\"name\": \"finopsHub\"}],\"rationale\": \"This module deploys a Finops hub from the Finops toolkit.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module finopsHub 'br/public:avm/ptn/finops-toolkit/finops-hub:0.1.0' = {\\n  name: 'finopsHubDeployment'\\n  params: {\\n    // Required parameters\\n    hubName: 'finops-hub-finmin'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a subscription to accelerate deployment of landing zones. For more information on how to use it, please visit this [Wiki](https://github.com/Azure/bicep-lz-vending/wiki) using PIM Eligible Role assignments."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/lz/sub-vending:0.4.0\",\"name\": \"subVending\"}],\"rationale\": \"This module deploys a subscription to accelerate deployment of landing zones. For more information on how to use it, please visit this [Wiki](https://github.com/Azure/bicep-lz-vending/wiki).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module subVending 'br/public:avm/ptn/lz/sub-vending:0.4.0' = {\\n  name: 'subVendingDeployment'\\n  params: {\\n    pimRoleAssignments: [\\n      {\\n        definition: '/providers/Microsoft.Authorization/roleDefinitions/f58310d9-a9f6-439a-9e8d-f62e7b41a168'\\n        justification: 'This is a justification from an AVM test.'\\n        principalId: '<principalId>'\\n        relativeScope: ''\\n        requestType: 'AdminUpdate'\\n        roleAssignmentType: 'Eligible'\\n        scheduleInfo: {\\n          duration: 'PT4H'\\n          durationType: 'AfterDuration'\\n          startTime: '<startTime>'\\n        }\\n      }\\n    ]\\n    resourceProviders: {}\\n    roleAssignmentEnabled: true\\n    subscriptionAliasEnabled: true\\n    subscriptionAliasName: '<subscriptionAliasName>'\\n    subscriptionBillingScope: '<subscriptionBillingScope>'\\n    subscriptionDisplayName: '<subscriptionDisplayName>'\\n    subscriptionManagementGroupAssociationEnabled: true\\n    subscriptionManagementGroupId: 'bicep-lz-vending-automation-child'\\n    subscriptionTags: {\\n      namePrefix: '<namePrefix>'\\n      serviceShort: '<serviceShort>'\\n    }\\n    subscriptionWorkload: 'Production'\\n    virtualNetworkEnabled: true\\n    virtualNetworkLocation: '<virtualNetworkLocation>'\\n    virtualNetworkName: '<virtualNetworkName>'\\n    virtualNetworkResourceGroupName: '<virtualNetworkResourceGroupName>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Hub Networking using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/network/hub-networking:0.5.0\",\"name\": \"hubNetworking\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module hubNetworking 'br/public:avm/ptn/network/hub-networking:0.5.0' = {\\n  name: 'hubNetworkingDeployment'\\n  params: {\\n    hubVirtualNetworks: {\\n      hub1: {\\n        addressPrefixes: '<addressPrefixes>'\\n        azureFirewallSettings: {\\n          azureSkuTier: 'Standard'\\n          diagnosticSettings: [\\n            {\\n              eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n              eventHubName: '<eventHubName>'\\n              metricCategories: [\\n                {\\n                  category: 'AllMetrics'\\n                }\\n              ]\\n              name: 'customSetting'\\n              storageAccountResourceId: '<storageAccountResourceId>'\\n              workspaceResourceId: '<workspaceResourceId>'\\n            }\\n          ]\\n          location: '<location>'\\n          publicIPAddressObject: {\\n            name: 'hub1-waf-pip'\\n          }\\n          threatIntelMode: 'Alert'\\n          zones: [\\n            1\\n            2\\n            3\\n          ]\\n        }\\n        bastionHost: {\\n          bastionHostName: 'bastion-hub1'\\n          disableCopyPaste: true\\n          enableFileCopy: false\\n          enableIpConnect: false\\n          enableShareableLink: false\\n          scaleUnits: 2\\n          skuName: 'Standard'\\n        }\\n        diagnosticSettings: [\\n          {\\n            eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n            eventHubName: '<eventHubName>'\\n            metricCategories: [\\n              {\\n                category: 'AllMetrics'\\n              }\\n            ]\\n            name: 'customSetting'\\n            storageAccountResourceId: '<storageAccountResourceId>'\\n            workspaceResourceId: '<workspaceResourceId>'\\n          }\\n        ]\\n        dnsServers: [\\n          '10.0.1.4'\\n          '10.0.1.5'\\n        ]\\n        enableAzureFirewall: true\\n        enableBastion: true\\n        enablePeering: false\\n        flowTimeoutInMinutes: 30\\n        location: '<location>'\\n        lock: {\\n          kind: 'CanNotDelete'\\n          name: 'hub1Lock'\\n        }\\n        peeringSettings: [\\n          {\\n            allowForwardedTraffic: true\\n            allowGatewayTransit: false\\n            allowVirtualNetworkAccess: true\\n            remoteVirtualNetworkName: 'hub2'\\n            useRemoteGateways: false\\n          }\\n        ]\\n        routes: [\\n          {\\n            name: 'defaultRoute'\\n            properties: {\\n              addressPrefix: '0.0.0.0/0'\\n              nextHopType: 'Internet'\\n            }\\n          }\\n        ]\\n        subnets: [\\n          {\\n            addressPrefix: '<addressPrefix>'\\n            name: 'GatewaySubnet'\\n          }\\n          {\\n            addressPrefix: '<addressPrefix>'\\n            name: 'AzureFirewallSubnet'\\n          }\\n          {\\n            addressPrefix: '<addressPrefix>'\\n            name: 'AzureBastionSubnet'\\n          }\\n          {\\n            addressPrefix: '<addressPrefix>'\\n            delegation: 'Microsoft.Network/dnsResolvers'\\n            name: 'DNSResolver'\\n          }\\n        ]\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n        vnetEncryption: false\\n        vnetEncryptionEnforcement: 'AllowUnencrypted'\\n      }\\n      hub2: {\\n        addressPrefixes: '<addressPrefixes>'\\n        azureFirewallSettings: {\\n          azureSkuTier: 'Standard'\\n          location: '<location>'\\n          publicIPAddressObject: {\\n            name: 'hub2-waf-pip'\\n          }\\n          threatIntelMode: 'Alert'\\n          zones: [\\n            1\\n            2\\n            3\\n          ]\\n        }\\n        bastionHost: {\\n          disableCopyPaste: true\\n          enableFileCopy: false\\n          enableIpConnect: false\\n          enableShareableLink: false\\n          scaleUnits: 2\\n          skuName: 'Standard'\\n        }\\n        enableAzureFirewall: true\\n        enableBastion: true\\n        enablePeering: false\\n        flowTimeoutInMinutes: 10\\n        location: '<location>'\\n        lock: {\\n          kind: 'CanNotDelete'\\n          name: 'hub2Lock'\\n        }\\n        peeringSettings: [\\n          {\\n            allowForwardedTraffic: true\\n            allowGatewayTransit: false\\n            allowVirtualNetworkAccess: true\\n            remoteVirtualNetworkName: 'hub1'\\n            useRemoteGateways: false\\n          }\\n        ]\\n        routes: [\\n          {\\n            name: 'defaultRoute'\\n            properties: {\\n              addressPrefix: '0.0.0.0/0'\\n              nextHopType: 'Internet'\\n            }\\n          }\\n        ]\\n        subnets: [\\n          {\\n            addressPrefix: '<addressPrefix>'\\n            name: 'GatewaySubnet'\\n          }\\n          {\\n            addressPrefix: '<addressPrefix>'\\n            name: 'AzureFirewallSubnet'\\n          }\\n          {\\n            addressPrefix: '<addressPrefix>'\\n            name: 'AzureBastionSubnet'\\n          }\\n        ]\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n        vnetEncryption: false\\n        vnetEncryptionEnforcement: 'AllowUnencrypted'\\n      }\\n    }\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Policy Insights Remediation using the Policy Remediation (Management Group scope - defaults) configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/policy-insights/remediation:0.2.0\",\"name\": \"remediation\"}],\"rationale\": \"This module deploys a Policy Insights Remediation.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module remediation 'br/public:avm/ptn/policy-insights/remediation:0.2.0' = {\\n  name: 'remediationDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'pirmgmin001'\\n    policyAssignmentId: '<policyAssignmentId>'\\n    // Non-required parameters\\n    location: '<location>'\\n    policyDefinitionReferenceId: 'Prerequisite_DeployExtensionWindows'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Build-your-own-copilot-Solution-Accelerator using the Waf-aligned configuration with default parameter values configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/sa/build-your-own-copilot:0.1.0\",\"name\": \"buildYourOwnCopilot\"}],\"rationale\": \"This module contains the resources required to deploy the [Build-your-own-copilot-Solution-Accelerator](https://github.com/microsoft/Build-your-own-copilot-Solution-Accelerator) for both Sandbox environments and WAF aligned environments.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module buildYourOwnCopilot 'br/public:avm/ptn/sa/build-your-own-copilot:0.1.0' = {\\n  name: 'buildYourOwnCopilotDeployment'\\n  params: {\\n    // Required parameters\\n    azureAiServiceLocation: '<azureAiServiceLocation>'\\n    enableMonitoring: true\\n    enablePrivateNetworking: true\\n    enablePurgeProtection: true\\n    enableRedundancy: true\\n    enableScalability: true\\n    // Non-required parameters\\n    enableTelemetry: true\\n    vmAdminPassword: '<vmAdminPassword>'\\n    vmAdminUsername: 'adminuser'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Document Knowledge Mining Solution using the Default configuration with enterprise-grade parameter values configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/sa/document-knowledge-mining:0.1.0\",\"name\": \"documentKnowledgeMining\"}],\"rationale\": \"This module contains the resources required to deploy the [Document Knowledge Mining Solution](https://github.com/microsoft/Document-knowledge-mining-solution) for both Sandbox environments and enterprise-grade environments.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module documentKnowledgeMining 'br/public:avm/ptn/sa/document-knowledge-mining:0.1.0' = {\\n  name: 'documentKnowledgeMiningDeployment'\\n  params: {\\n    // Required parameters\\n    aiDeploymentsLocation: '<aiDeploymentsLocation>'\\n    enableMonitoring: true\\n    enablePrivateNetworking: true\\n    enableRedundancy: true\\n    enableScalability: true\\n    // Non-required parameters\\n    createdBy: 'AVM_Pipeline'\\n    enableTelemetry: true\\n    location: '<location>'\\n    vmAdminPassword: '<vmAdminPassword>'\\n    vmAdminUsername: 'adminuser'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Security Center (Defender for Cloud) Configuration using default parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/security/security-center:0.1.0\",\"name\": \"securityCenter\"}],\"rationale\": \"This module deploys an Azure Security Center (Defender for Cloud) Configuration.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module securityCenter 'br/public:avm/ptn/security/security-center:0.1.0' = {\\n  name: 'securityCenterDeployment'\\n  params: {\\n    // Required parameters\\n    scope: '<scope>'\\n    workspaceResourceId: '<workspaceResourceId>'\\n    // Non-required parameters\\n    deviceSecurityGroupProperties: {}\\n    ioTSecuritySolutionProperties: {}\\n    location: '<location>'\\n    securityContactProperties: {\\n      alertNotifications: 'Off'\\n      alertsToAdmins: 'Off'\\n      email: 'foo@contoso.com'\\n      phone: '+12345678'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Custom Images using Azure Image Builder deploying full solution for Windows."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/virtual-machine-images/azure-image-builder:0.2.0\",\"name\": \"azureImageBuilder\"}],\"rationale\": \"This module provides you with a packaged solution to create custom images using the Azure Image Builder service publishing to an Azure Compute Gallery.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module azureImageBuilder 'br/public:avm/ptn/virtual-machine-images/azure-image-builder:0.2.0' = {\\n  name: 'azureImageBuilderDeployment'\\n  params: {\\n    // Required parameters\\n    computeGalleryImageDefinitionName: '<computeGalleryImageDefinitionName>'\\n    computeGalleryImageDefinitions: [\\n      {\\n        hyperVGeneration: 'V2'\\n        identifier: {\\n          offer: 'devops_windows'\\n          publisher: 'devops'\\n          sku: 'devops_windows_az'\\n        }\\n        name: '<name>'\\n        osState: 'Generalized'\\n        osType: 'Windows'\\n      }\\n    ]\\n    computeGalleryName: 'galapvmiaibaw'\\n    imageTemplateImageSource: {\\n      offer: 'Windows-11'\\n      publisher: 'MicrosoftWindowsDesktop'\\n      sku: 'win11-24h2-avd'\\n      type: 'PlatformImage'\\n      version: 'latest'\\n    }\\n    // Non-required parameters\\n    assetsStorageAccountContainerName: '<assetsStorageAccountContainerName>'\\n    assetsStorageAccountName: '<assetsStorageAccountName>'\\n    deploymentsToPerform: '<deploymentsToPerform>'\\n    imageTemplateCustomizationSteps: [\\n      {\\n        name: 'PowerShell Core installation'\\n        scriptUri: '<scriptUri>'\\n        type: 'PowerShell'\\n      }\\n      {\\n        destination: '<destination>'\\n        name: '<name>'\\n        sourceUri: '<sourceUri>'\\n        type: 'File'\\n      }\\n      {\\n        inline: [\\n          'pwsh \\\\'<value>\\\\''\\n        ]\\n        name: 'Software installation'\\n        type: 'PowerShell'\\n      }\\n    ]\\n    imageTemplateResourceGroupName: ''\\n    location: '<location>'\\n    resourceGroupName: '<resourceGroupName>'\\n    storageAccountFilesToUpload: [\\n      {\\n        name: '<name>'\\n        value: '<value>'\\n      }\\n      {\\n        name: '<name>'\\n        value: '<value>'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Alert Processing Rule using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/alerts-management/action-rule:0.2.0\",\"name\": \"actionRule\"}],\"rationale\": \"This module deploys an Alert Processing Rule.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module actionRule 'br/public:avm/res/alerts-management/action-rule:0.2.0' = {\\n  name: 'actionRuleDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'aprwaf001'\\n    // Non-required parameters\\n    actions: [\\n      {\\n        actionGroupIds: [\\n          '<actionGroupResourceId>'\\n        ]\\n        actionType: 'AddActionGroups'\\n      }\\n    ]\\n    aprDescription: 'Test deployment of the module with the waf aligned set of parameters.'\\n    location: '<location>'\\n    scopes: [\\n      '<id>'\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for API Management Services using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/api-management/service:0.11.0\",\"name\": \"service\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module service 'br/public:avm/res/api-management/service:0.11.0' = {\\n  name: 'serviceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'apismax001'\\n    publisherEmail: 'apimgmt-noreply@mail.windowsazure.com'\\n    publisherName: 'az-amorg-x-001'\\n    // Non-required parameters\\n    additionalLocations: [\\n      {\\n        disableGateway: false\\n        location: '<location>'\\n        publicIpAddressResourceId: '<publicIpAddressResourceId>'\\n        sku: {\\n          capacity: 1\\n          name: 'Premium'\\n        }\\n        virtualNetworkConfiguration: {\\n          subnetResourceId: '<subnetResourceId>'\\n        }\\n      }\\n    ]\\n    apiDiagnostics: [\\n      {\\n        apiName: 'echo-api'\\n        loggerName: 'logger'\\n        metrics: true\\n        name: 'applicationinsights'\\n      }\\n    ]\\n    apis: [\\n      {\\n        apiVersionSetName: 'echo-version-set'\\n        displayName: 'Echo API'\\n        name: 'echo-api'\\n        path: 'echo'\\n        protocols: [\\n          'http'\\n          'https'\\n        ]\\n        serviceUrl: 'http://echoapi.cloudapp.net/api'\\n      }\\n    ]\\n    apiVersionSets: [\\n      {\\n        description: 'echo-version-set'\\n        displayName: 'echo-version-set'\\n        name: 'echo-version-set'\\n        versioningScheme: 'Segment'\\n      }\\n    ]\\n    authorizationServers: [\\n      {\\n        authorizationEndpoint: '<authorizationEndpoint>'\\n        clientId: 'apimclientid'\\n        clientRegistrationEndpoint: 'http://localhost'\\n        clientSecret: '<clientSecret>'\\n        displayName: 'AuthServer1'\\n        grantTypes: [\\n          'authorizationCode'\\n        ]\\n        name: 'AuthServer1'\\n        tokenEndpoint: '<tokenEndpoint>'\\n      }\\n    ]\\n    backends: [\\n      {\\n        name: 'backend'\\n        tls: {\\n          validateCertificateChain: false\\n          validateCertificateName: false\\n        }\\n        url: 'http://echoapi.cloudapp.net/api'\\n      }\\n    ]\\n    caches: [\\n      {\\n        connectionString: 'connectionstringtest'\\n        name: 'westeurope'\\n        useFromLocation: 'westeurope'\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    identityProviders: [\\n      {\\n        allowedTenants: [\\n          'mytenant.onmicrosoft.com'\\n        ]\\n        authority: '<authority>'\\n        clientId: 'apimClientid'\\n        clientLibrary: 'MSAL-2'\\n        clientSecret: 'apimSlientSecret'\\n        name: 'aad'\\n        signInTenant: 'mytenant.onmicrosoft.com'\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    loggers: [\\n      {\\n        credentials: {\\n          instrumentationKey: '<instrumentationKey>'\\n        }\\n        description: 'Logger to Azure Application Insights'\\n        isBuffered: false\\n        name: 'logger'\\n        targetResourceId: '<targetResourceId>'\\n        type: 'applicationInsights'\\n      }\\n    ]\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    namedValues: [\\n      {\\n        displayName: 'apimkey'\\n        name: 'apimkey'\\n        secret: true\\n      }\\n    ]\\n    policies: [\\n      {\\n        format: 'xml'\\n        value: '<policies> <inbound> <rate-limit-by-key calls=\\\\'250\\\\' renewal-period=\\\\'60\\\\' counter-key=\\\\'@(context.Request.IpAddress)\\\\' /> </inbound> <backend> <forward-request /> </backend> <outbound> </outbound> </policies>'\\n      }\\n    ]\\n    portalsettings: [\\n      {\\n        name: 'signin'\\n        properties: {\\n          enabled: false\\n        }\\n      }\\n      {\\n        name: 'signup'\\n        properties: {\\n          enabled: false\\n          termsOfService: {\\n            consentRequired: false\\n            enabled: false\\n          }\\n        }\\n      }\\n    ]\\n    products: [\\n      {\\n        apis: [\\n          'echo-api'\\n        ]\\n        approvalRequired: false\\n        displayName: 'Starter'\\n        groups: [\\n          'developers'\\n        ]\\n        name: 'Starter'\\n        subscriptionRequired: false\\n      }\\n    ]\\n    publicIpAddressResourceId: '<publicIpAddressResourceId>'\\n    publicNetworkAccess: 'Enabled'\\n    roleAssignments: [\\n      {\\n        name: '6352c3e3-ac6b-43d5-ac43-1077ff373721'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    subnetResourceId: '<subnetResourceId>'\\n    subscriptions: [\\n      {\\n        displayName: 'testArmSubscriptionAllApis'\\n        name: 'testArmSubscriptionAllApis'\\n        scope: '/apis'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    virtualNetworkType: 'Internal'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Container App using the VNet integrated container app deployment configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/app/container-app:0.19.0\",\"name\": \"containerApp\"}],\"rationale\": \"This module deploys a Container App.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module containerApp 'br/public:avm/res/app/container-app:0.19.0' = {\\n  name: 'containerAppDeployment'\\n  params: {\\n    // Required parameters\\n    containers: [\\n      {\\n        image: 'mcr.microsoft.com/k8se/quickstart:latest'\\n        name: 'simple-hello-world-container'\\n        resources: {\\n          cpu: '<cpu>'\\n          memory: '0.5Gi'\\n        }\\n      }\\n    ]\\n    environmentResourceId: '<environmentResourceId>'\\n    name: 'acavnet001'\\n    // Non-required parameters\\n    additionalPortMappings: [\\n      {\\n        exposedPort: 8080\\n        external: false\\n        targetPort: 8080\\n      }\\n    ]\\n    ingressAllowInsecure: false\\n    ingressExternal: false\\n    ingressTargetPort: 80\\n    ingressTransport: 'tcp'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for App ManagedEnvironments using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/app/managed-environment:0.11.0\",\"name\": \"managedEnvironment\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module managedEnvironment 'br/public:avm/res/app/managed-environment:0.11.0' = {\\n  name: 'managedEnvironmentDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'amemin001'\\n    // Non-required parameters\\n    dockerBridgeCidr: '172.16.0.1/28'\\n    infrastructureResourceGroupName: '<infrastructureResourceGroupName>'\\n    infrastructureSubnetResourceId: '<infrastructureSubnetResourceId>'\\n    internal: true\\n    platformReservedCidr: '172.17.17.0/24'\\n    platformReservedDnsIP: '172.17.17.17'\\n    workloadProfiles: [\\n      {\\n        maximumCount: 3\\n        minimumCount: 0\\n        name: 'CAW01'\\n        workloadProfileType: 'D4'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an App Configuration Store using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/app-configuration/configuration-store:0.9.0\",\"name\": \"configurationStore\"}],\"rationale\": \"This module deploys an App Configuration Store.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module configurationStore 'br/public:avm/res/app-configuration/configuration-store:0.9.0' = {\\n  name: 'configurationStoreDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'accmin001'\\n    // Non-required parameters\\n    enablePurgeProtection: false\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Policy Assignment at a Management Group scope. Optionally, it further assigns permissions to the policy's identity (if configured) to various scopes. Note, if you provide any role definition ids and or define additional scopes to assign permissions to, set permissions are deployled as a permutation of the provided parameters. In other words, each role would be provided to each scope for the assignment's identity using the WAF-aligned (Management Group scope) configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/authorization/policy-assignment/mg-scope:0.1.0\",\"name\": \"policyAssignment\"}],\"rationale\": \"This module deploys a Policy Assignment at a Management Group scope. Optionally, it further assigns permissions to the policy's identity (if configured) to various scopes. Note, if you provide any role definition ids and or define additional scopes to assign permissions to, set permissions are deployled as a permutation of the provided parameters. In other words, each role would be provided to each scope for the assignment's identity.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module policyAssignment 'br/public:avm/res/authorization/policy-assignment/mg-scope:0.1.0' = {\\n  name: 'policyAssignmentDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'rapamgwaf001'\\n    policyDefinitionId: '/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d'\\n    // Non-required parameters\\n    additionalManagementGroupsIDsToAssignRbacTo: [\\n      '<name>'\\n    ]\\n    metadata: {\\n      assignedBy: 'Bicep'\\n    }\\n    roleDefinitionIds: [\\n      '/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c'\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Role Assignment at a Management Group scope using only defaults (Management Group scope)."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/authorization/role-assignment/mg-scope:0.1.0\",\"name\": \"roleAssignment\"}],\"rationale\": \"This module deploys a Role Assignment at a Management Group scope.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module roleAssignment 'br/public:avm/res/authorization/role-assignment/mg-scope:0.1.0' = {\\n  name: 'roleAssignmentDeployment'\\n  params: {\\n    // Required parameters\\n    principalId: '<principalId>'\\n    roleDefinitionIdOrName: 'Resource Policy Contributor'\\n    // Non-required parameters\\n    location: '<location>'\\n    principalType: 'ServicePrincipal'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Role Assignment at a Subscription scope using large parameter set (Subscription scope)."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/authorization/role-assignment/sub-scope:0.1.0\",\"name\": \"roleAssignment\"}],\"rationale\": \"This module deploys a Role Assignment at a Subscription scope.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module roleAssignment 'br/public:avm/res/authorization/role-assignment/sub-scope:0.1.0' = {\\n  name: 'roleAssignmentDeployment'\\n  params: {\\n    // Required parameters\\n    principalId: '<principalId>'\\n    roleDefinitionIdOrName: 'Reader'\\n    // Non-required parameters\\n    description: 'Role Assignment (subscription scope)'\\n    principalType: 'ServicePrincipal'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Stack HCI Cluster using the Deploy Azure Stack HCI Cluster in Azure with a 2 node switched configuration WAF aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/azure-stack-hci/cluster:0.2.0\",\"name\": \"cluster\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module cluster 'br/public:avm/res/azure-stack-hci/cluster:0.2.0' = {\\n  name: 'clusterDeployment'\\n  params: {\\n    // Required parameters\\n    deploymentSettings: {\\n      bitlockerBootVolume: true\\n      bitlockerDataVolumes: true\\n      clusterNodeNames: '<clusterNodeNames>'\\n      clusterWitnessStorageAccountName: '<clusterWitnessStorageAccountName>'\\n      customLocationName: 'ashcwaf-location'\\n      defaultGateway: '192.168.1.1'\\n      deploymentPrefix: '<deploymentPrefix>'\\n      dnsServers: [\\n        '192.168.1.254'\\n      ]\\n      domainFqdn: 'jumpstart.local'\\n      domainOUPath: '<domainOUPath>'\\n      driftControlEnforced: true\\n      enableStorageAutoIp: true\\n      endingIPAddress: '192.168.1.65'\\n      keyVaultName: '<keyVaultName>'\\n      networkIntents: [\\n        {\\n          adapter: [\\n            'FABRIC'\\n            'FABRIC2'\\n          ]\\n          adapterPropertyOverrides: {\\n            jumboPacket: '9014'\\n            networkDirect: 'Disabled'\\n            networkDirectTechnology: 'iWARP'\\n          }\\n          name: 'ManagementCompute'\\n          overrideAdapterProperty: true\\n          overrideQosPolicy: false\\n          overrideVirtualSwitchConfiguration: false\\n          qosPolicyOverrides: {\\n            bandwidthPercentageSMB: '50'\\n            priorityValue8021ActionCluster: '7'\\n            priorityValue8021ActionSMB: '3'\\n          }\\n          trafficType: [\\n            'Compute'\\n            'Management'\\n          ]\\n          virtualSwitchConfigurationOverrides: {\\n            enableIov: 'true'\\n            loadBalancingAlgorithm: 'Dynamic'\\n          }\\n        }\\n        {\\n          adapter: [\\n            'StorageA'\\n            'StorageB'\\n          ]\\n          adapterPropertyOverrides: {\\n            jumboPacket: '9014'\\n            networkDirect: 'Disabled'\\n            networkDirectTechnology: 'iWARP'\\n          }\\n          name: 'Storage'\\n          overrideAdapterProperty: true\\n          overrideQosPolicy: true\\n          overrideVirtualSwitchConfiguration: false\\n          qosPolicyOverrides: {\\n            bandwidthPercentageSMB: '50'\\n            priorityValue8021ActionCluster: '7'\\n            priorityValue8021ActionSMB: '3'\\n          }\\n          trafficType: [\\n            'Storage'\\n          ]\\n          virtualSwitchConfigurationOverrides: {\\n            enableIov: 'true'\\n            loadBalancingAlgorithm: 'Dynamic'\\n          }\\n        }\\n      ]\\n      sideChannelMitigationEnforced: true\\n      smbClusterEncryption: true\\n      smbSigningEnforced: true\\n      startingIPAddress: '192.168.1.55'\\n      storageConnectivitySwitchless: false\\n      storageNetworks: [\\n        {\\n          adapterName: 'StorageA'\\n          name: 'Storage1Network'\\n          vlan: '711'\\n        }\\n        {\\n          adapterName: 'StorageB'\\n          name: 'Storage2Network'\\n          vlan: '712'\\n        }\\n      ]\\n      subnetMask: '255.255.255.0'\\n    }\\n    hciResourceProviderObjectId: '<hciResourceProviderObjectId>'\\n    name: '<name>'\\n    // Non-required parameters\\n    deploymentUser: 'deployUser'\\n    deploymentUserPassword: '<deploymentUserPassword>'\\n    localAdminPassword: '<localAdminPassword>'\\n    localAdminUser: 'Administrator'\\n    servicePrincipalId: '<servicePrincipalId>'\\n    servicePrincipalSecret: '<servicePrincipalSecret>'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Stack HCI Virtual Hard Disk using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/azure-stack-hci/virtual-hard-disk:0.1.0\",\"name\": \"virtualHardDisk\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualHardDisk 'br/public:avm/res/azure-stack-hci/virtual-hard-disk:0.1.0' = {\\n  name: 'virtualHardDiskDeployment'\\n  params: {\\n    // Required parameters\\n    customLocationResourceId: '<customLocationResourceId>'\\n    diskSizeGB: 4\\n    dynamic: false\\n    name: 'ashvdmin1'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Batch Account using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/batch/batch-account:0.11.0\",\"name\": \"batchAccount\"}],\"rationale\": \"This module deploys a Batch Account.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module batchAccount 'br/public:avm/res/batch/batch-account:0.11.0' = {\\n  name: 'batchAccountDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'bbamax001'\\n    storageAccountResourceId: '<storageAccountResourceId>'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n    }\\n    networkProfile: {\\n      accountAccess: {\\n        allowedIpRules: [\\n          '40.74.28.0/23'\\n        ]\\n        defaultAction: 'Deny'\\n      }\\n      nodeManagementAccess: {\\n        allowedIpRules: [\\n          '40.74.28.0/23'\\n        ]\\n      }\\n    }\\n    poolAllocationMode: 'BatchService'\\n    privateEndpoints: [\\n      {\\n        customDnsConfigs: [\\n          {\\n            fqdn: 'abc.batch.com'\\n            ipAddresses: [\\n              '10.0.16.10'\\n            ]\\n          }\\n        ]\\n        ipConfigurations: [\\n          {\\n            name: 'myIPconfig'\\n            properties: {\\n              groupId: 'batchAccount'\\n              memberName: 'batchAccount'\\n              privateIPAddress: '10.0.16.10'\\n            }\\n          }\\n        ]\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        roleAssignments: [\\n          {\\n            name: '9afa4fb3-2157-40db-aebb-039ce73c50ca'\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        service: 'batchAccount'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'batchAccount'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'nodeManagement'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        name: 'd57821b0-52b3-4a42-9799-533a9cdb7eec'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    storageAccessIdentityResourceId: '<storageAccessIdentityResourceId>'\\n    storageAuthenticationMode: 'BatchAccountManagedIdentity'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Redis Cache using the Passive Geo-Replicated Redis Cache configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/cache/redis:0.16.0\",\"name\": \"redis\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module redis 'br/public:avm/res/cache/redis:0.16.0' = {\\n  name: 'redisDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'crpgeo001'\\n    // Non-required parameters\\n    capacity: 2\\n    enableNonSslPort: true\\n    geoReplicationObject: {\\n      linkedRedisCacheLocation: '<linkedRedisCacheLocation>'\\n      linkedRedisCacheResourceId: '<linkedRedisCacheResourceId>'\\n      name: '<name>'\\n    }\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    minimumTlsVersion: '1.2'\\n    redisVersion: '6'\\n    replicasPerMaster: 1\\n    replicasPerPrimary: 1\\n    shardCount: 1\\n    skuName: 'Premium'\\n    zoneRedundant: false\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Redis Enterprise or Azure Managed Redis cache using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/cache/redis-enterprise:0.3.0\",\"name\": \"redisEnterprise\"}],\"rationale\": \"This module deploys a Redis Enterprise or Azure Managed Redis cache.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module redisEnterprise 'br/public:avm/res/cache/redis-enterprise:0.3.0' = {\\n  name: 'redisEnterpriseDeployment'\\n  params: {\\n    name: 'cremin001'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a CDN Profile using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/cdn/profile:0.16.0\",\"name\": \"profile\"}],\"rationale\": \"This module deploys a CDN Profile.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module profile 'br/public:avm/res/cdn/profile:0.16.0' = {\\n  name: 'profileDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dep-test-cdnpmin'\\n    sku: 'Standard_AzureFrontDoor'\\n    // Non-required parameters\\n    location: 'global'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Cognitive Service using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/cognitive-services/account:0.13.0\",\"name\": \"account\"}],\"rationale\": \"This module deploys a Cognitive Service.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module account 'br/public:avm/res/cognitive-services/account:0.13.0' = {\\n  name: 'accountDeployment'\\n  params: {\\n    // Required parameters\\n    kind: 'SpeechServices'\\n    name: 'csamin001'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Communication Service using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/communication/communication-service:0.4.0\",\"name\": \"communicationService\"}],\"rationale\": \"This module deploys a Communication Service\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module communicationService 'br/public:avm/res/communication/communication-service:0.4.0' = {\\n  name: 'communicationServiceDeployment'\\n  params: {\\n    // Required parameters\\n    dataLocation: 'Germany'\\n    name: 'ccsmin001'\\n    // Non-required parameters\\n    location: 'global'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Availability Set using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/availability-set:0.2.0\",\"name\": \"availabilitySet\"}],\"rationale\": \"This module deploys an Availability Set.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module availabilitySet 'br/public:avm/res/compute/availability-set:0.2.0' = {\\n  name: 'availabilitySetDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'casmax001'\\n    // Non-required parameters\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    proximityPlacementGroupResourceId: '<proximityPlacementGroupResourceId>'\\n    roleAssignments: [\\n      {\\n        name: 'd9d13442-232d-4861-9ab9-bad5e90c4f71'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    skuName: 'Aligned'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Compute Disk using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/disk:0.5.0\",\"name\": \"disk\"}],\"rationale\": \"This module deploys a Compute Disk\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module disk 'br/public:avm/res/compute/disk:0.5.0' = {\\n  name: 'diskDeployment'\\n  params: {\\n    // Required parameters\\n    availabilityZone: 2\\n    name: 'cdwaf001'\\n    sku: 'Premium_LRS'\\n    // Non-required parameters\\n    diskIOPSReadWrite: 500\\n    diskMBpsReadWrite: 60\\n    diskSizeGB: 128\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    logicalSectorSize: 512\\n    osType: 'Windows'\\n    publicNetworkAccess: 'Enabled'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Compute Gallery (formerly known as Shared Image Gallery) using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/gallery:0.9.0\",\"name\": \"gallery\"}],\"rationale\": \"This module deploys an Azure Compute Gallery (formerly known as Shared Image Gallery).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module gallery 'br/public:avm/res/compute/gallery:0.9.0' = {\\n  name: 'galleryDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'cgwaf001'\\n    // Non-required parameters\\n    applications: [\\n      {\\n        name: 'cgwaf-appd-001'\\n        supportedOSType: 'Windows'\\n      }\\n    ]\\n    images: [\\n      {\\n        identifier: {\\n          offer: 'WindowsServer'\\n          publisher: 'MicrosoftWindowsServer'\\n          sku: '2022-datacenter-azure-edition'\\n        }\\n        name: 'az-imgd-ws-001'\\n        osState: 'Generalized'\\n        osType: 'Windows'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Public SSH Key using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/ssh-public-key:0.4.0\",\"name\": \"sshPublicKey\"}],\"rationale\": \"This module deploys a Public SSH Key.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module sshPublicKey 'br/public:avm/res/compute/ssh-public-key:0.4.0' = {\\n  name: 'sshPublicKeyDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'cspkmin001'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Machine with one or multiple NICs and optionally one or multiple public IPs using only defaults for Windows."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/virtual-machine:0.15.0\",\"name\": \"virtualMachine\"}],\"rationale\": \"This module deploys a Virtual Machine with one or multiple NICs and optionally one or multiple public IPs.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualMachine 'br/public:avm/res/compute/virtual-machine:0.15.0' = {\\n  name: 'virtualMachineDeployment'\\n  params: {\\n    // Required parameters\\n    adminUsername: 'localAdminUser'\\n    availabilityZone: -1\\n    imageReference: {\\n      offer: 'WindowsServer'\\n      publisher: 'MicrosoftWindowsServer'\\n      sku: '2022-datacenter-azure-edition'\\n      version: 'latest'\\n    }\\n    name: 'cvmwinmin'\\n    nicConfigurations: [\\n      {\\n        ipConfigurations: [\\n          {\\n            name: 'ipconfig01'\\n            subnetResourceId: '<subnetResourceId>'\\n          }\\n        ]\\n        nicSuffix: '-nic-01'\\n      }\\n    ]\\n    osDisk: {\\n      caching: 'ReadWrite'\\n      diskSizeGB: 128\\n      managedDisk: {\\n        storageAccountType: 'Premium_LRS'\\n      }\\n    }\\n    osType: 'Windows'\\n    vmSize: 'Standard_D2s_v3'\\n    // Non-required parameters\\n    adminPassword: '<adminPassword>'\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Machine with one or multiple NICs and optionally one or multiple public IPs using the Adding the VM to a VMSS configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/virtual-machine:0.15.0\",\"name\": \"virtualMachine\"}],\"rationale\": \"This module deploys a Virtual Machine with one or multiple NICs and optionally one or multiple public IPs.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualMachine 'br/public:avm/res/compute/virtual-machine:0.15.0' = {\\n  name: 'virtualMachineDeployment'\\n  params: {\\n    // Required parameters\\n    adminUsername: 'localAdminUser'\\n    availabilityZone: -1\\n    imageReference: {\\n      offer: 'WindowsServer'\\n      publisher: 'MicrosoftWindowsServer'\\n      sku: '2022-datacenter-azure-edition'\\n      version: 'latest'\\n    }\\n    name: 'cvmwinvmss'\\n    nicConfigurations: [\\n      {\\n        ipConfigurations: [\\n          {\\n            name: 'ipconfig01'\\n            subnetResourceId: '<subnetResourceId>'\\n          }\\n        ]\\n        nicSuffix: '-nic-01'\\n      }\\n    ]\\n    osDisk: {\\n      caching: 'ReadWrite'\\n      diskSizeGB: 128\\n      managedDisk: {\\n        storageAccountType: 'Premium_LRS'\\n      }\\n    }\\n    osType: 'Windows'\\n    vmSize: 'Standard_D2s_v3'\\n    // Non-required parameters\\n    adminPassword: '<adminPassword>'\\n    location: '<location>'\\n    virtualMachineScaleSetResourceId: '<virtualMachineScaleSetResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Machine Scale Set using large parameter set for Windows."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/compute/virtual-machine-scale-set:0.11.0\",\"name\": \"virtualMachineScaleSet\"}],\"rationale\": \"This module deploys a Virtual Machine Scale Set.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualMachineScaleSet 'br/public:avm/res/compute/virtual-machine-scale-set:0.11.0' = {\\n  name: 'virtualMachineScaleSetDeployment'\\n  params: {\\n    // Required parameters\\n    adminPassword: '<adminPassword>'\\n    adminUsername: 'localAdminUser'\\n    imageReference: {\\n      offer: 'WindowsServer'\\n      publisher: 'MicrosoftWindowsServer'\\n      sku: '2022-datacenter-azure-edition'\\n      version: 'latest'\\n    }\\n    name: 'cvmsswinmax001'\\n    nicConfigurations: [\\n      {\\n        ipConfigurations: [\\n          {\\n            name: 'ipconfig1'\\n            properties: {\\n              publicIPAddressConfiguration: {\\n                name: 'pip-cvmsswinmax'\\n              }\\n              subnet: {\\n                id: '<id>'\\n              }\\n            }\\n          }\\n        ]\\n        nicSuffix: '-nic01'\\n      }\\n    ]\\n    osDisk: {\\n      createOption: 'fromImage'\\n      diskSizeGB: 128\\n      managedDisk: {\\n        storageAccountType: 'Premium_LRS'\\n      }\\n    }\\n    osType: 'Windows'\\n    skuName: 'Standard_B12ms'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    encryptionAtHost: false\\n    extensionAntiMalwareConfig: {\\n      enabled: true\\n      settings: {\\n        AntimalwareEnabled: true\\n        Exclusions: {\\n          Extensions: '.log;.ldf'\\n          Paths: 'D:\\\\\\\\IISlogs;D:\\\\\\\\DatabaseLogs'\\n          Processes: 'mssence.svc'\\n        }\\n        RealtimeProtectionEnabled: true\\n        ScheduledScanSettings: {\\n          day: '7'\\n          isEnabled: 'true'\\n          scanType: 'Quick'\\n          time: '120'\\n        }\\n      }\\n    }\\n    extensionAzureDiskEncryptionConfig: {\\n      enabled: true\\n      settings: {\\n        EncryptionOperation: 'EnableEncryption'\\n        KekVaultResourceId: '<KekVaultResourceId>'\\n        KeyEncryptionAlgorithm: 'RSA-OAEP'\\n        KeyEncryptionKeyURL: '<KeyEncryptionKeyURL>'\\n        KeyVaultResourceId: '<KeyVaultResourceId>'\\n        KeyVaultURL: '<KeyVaultURL>'\\n        ResizeOSDisk: 'false'\\n        VolumeType: 'All'\\n      }\\n    }\\n    extensionCustomScriptConfig: {\\n      protectedSettings: {\\n        managedIdentityResourceId: '<managedIdentityResourceId>'\\n      }\\n      settings: {\\n        commandToExecute: '<commandToExecute>'\\n        fileUris: [\\n          '<storageAccountCSEFileUrl>'\\n        ]\\n      }\\n    }\\n    extensionDependencyAgentConfig: {\\n      enabled: true\\n    }\\n    extensionDSCConfig: {\\n      enabled: true\\n    }\\n    extensionHealthConfig: {\\n      enabled: true\\n      port: 80\\n      protocol: 'http'\\n      requestPath: '/'\\n    }\\n    extensionMonitoringAgentConfig: {\\n      autoUpgradeMinorVersion: true\\n      enabled: true\\n    }\\n    extensionNetworkWatcherAgentConfig: {\\n      enabled: true\\n    }\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: false\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    roleAssignments: [\\n      {\\n        name: '1910de8c-4dab-4189-96bb-2feb68350fb8'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    skuCapacity: 1\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    upgradePolicyMode: 'Manual'\\n    vmNamePrefix: 'vmsswinvm'\\n    vmPriority: 'Regular'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Consumption Budget for a Resource Group using large parameter set (Resource Group scope)."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/consumption/budget/rg-scope:0.1.0\",\"name\": \"budget\"}],\"rationale\": \"This module deploys a Consumption Budget for a Resource Group.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module budget 'br/public:avm/res/consumption/budget/rg-scope:0.1.0' = {\\n  name: 'budgetDeployment'\\n  params: {\\n    // Required parameters\\n    amount: 500\\n    name: 'rcbrgmax001'\\n    // Non-required parameters\\n    contactEmails: [\\n      'dummy@contoso.com'\\n    ]\\n    resourceGroupFilter: [\\n      'rg-group1'\\n      'rg-group2'\\n    ]\\n    thresholds: [\\n      50\\n      75\\n      90\\n      100\\n      110\\n    ]\\n    thresholdType: 'Forecasted'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Container Instance Container Group using only defaults and low memory containers."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/container-instance/container-group:0.6.0\",\"name\": \"containerGroup\"}],\"rationale\": \"This module deploys a Container Instance Container Group.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module containerGroup 'br/public:avm/res/container-instance/container-group:0.6.0' = {\\n  name: 'containerGroupDeployment'\\n  params: {\\n    // Required parameters\\n    availabilityZone: -1\\n    containers: [\\n      {\\n        name: 'az-aci-x-001'\\n        properties: {\\n          image: 'mcr.microsoft.com/azuredocs/aci-helloworld'\\n          ports: [\\n            {\\n              port: 443\\n              protocol: 'Tcp'\\n            }\\n          ]\\n          resources: {\\n            requests: {\\n              cpu: 2\\n              memoryInGB: '0.5'\\n            }\\n          }\\n        }\\n      }\\n    ]\\n    name: 'ciclow001'\\n    // Non-required parameters\\n    ipAddress: {\\n      ports: [\\n        {\\n          port: 443\\n          protocol: 'Tcp'\\n        }\\n      ]\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Container Registry (ACR) using scopeMaps in parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/container-registry/registry:0.9.0\",\"name\": \"registry\"}],\"rationale\": \"This module deploys an Azure Container Registry (ACR).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module registry 'br/public:avm/res/container-registry/registry:0.9.0' = {\\n  name: 'registryDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'crrs001'\\n    // Non-required parameters\\n    acrSku: 'Standard'\\n    location: '<location>'\\n    scopeMaps: [\\n      {\\n        actions: [\\n          'repositories/*/content/read'\\n        ]\\n        description: 'This is a test for scopeMaps feature.'\\n        name: 'testscopemap'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Kubernetes Service (AKS) Managed Cluster using Private Cluster."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/container-service/managed-cluster:0.11.0\",\"name\": \"managedCluster\"}],\"rationale\": \"This module deploys an Azure Kubernetes Service (AKS) Managed Cluster.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module managedCluster 'br/public:avm/res/container-service/managed-cluster:0.11.0' = {\\n  name: 'managedClusterDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'csmpriv001'\\n    primaryAgentPoolProfiles: [\\n      {\\n        availabilityZones: [\\n          3\\n        ]\\n        count: 1\\n        enableAutoScaling: true\\n        maxCount: 3\\n        maxPods: 30\\n        minCount: 1\\n        mode: 'System'\\n        name: 'systempool'\\n        nodeTaints: [\\n          'CriticalAddonsOnly=true:NoSchedule'\\n        ]\\n        osDiskSizeGB: 0\\n        osType: 'Linux'\\n        type: 'VirtualMachineScaleSets'\\n        vmSize: 'Standard_DS4_v2'\\n        vnetSubnetResourceId: '<vnetSubnetResourceId>'\\n      }\\n    ]\\n    // Non-required parameters\\n    aadProfile: {\\n      aadProfileEnableAzureRBAC: true\\n      aadProfileManaged: true\\n    }\\n    agentPools: [\\n      {\\n        availabilityZones: [\\n          3\\n        ]\\n        count: 2\\n        enableAutoScaling: true\\n        maxCount: 3\\n        maxPods: 30\\n        minCount: 1\\n        minPods: 2\\n        mode: 'User'\\n        name: 'userpool1'\\n        nodeLabels: {}\\n        osDiskSizeGB: 128\\n        osType: 'Linux'\\n        scaleSetEvictionPolicy: 'Delete'\\n        scaleSetPriority: 'Regular'\\n        type: 'VirtualMachineScaleSets'\\n        vmSize: 'Standard_DS4_v2'\\n        vnetSubnetResourceId: '<vnetSubnetResourceId>'\\n      }\\n    ]\\n    dnsServiceIP: '10.10.200.10'\\n    enablePrivateCluster: true\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    networkPlugin: 'azure'\\n    privateDNSZone: '<privateDNSZone>'\\n    serviceCidr: '10.10.200.0/24'\\n    skuTier: 'Standard'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Data Protection Backup Vaults using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/data-protection/backup-vault:0.12.0\",\"name\": \"backupVault\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module backupVault 'br/public:avm/res/data-protection/backup-vault:0.12.0' = {\\n  name: 'backupVaultDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dpbvmax001'\\n    // Non-required parameters\\n    azureMonitorAlertSettingsAlertsForAllJobFailures: 'Disabled'\\n    backupInstances: [\\n      {\\n        dataSourceInfo: {\\n          datasourceType: 'Microsoft.Storage/storageAccounts/blobServices'\\n          resourceID: '<resourceID>'\\n          resourceLocation: '<resourceLocation>'\\n          resourceName: '<resourceName>'\\n          resourceType: 'Microsoft.Storage/storageAccounts'\\n          resourceUri: '<resourceUri>'\\n        }\\n        name: '<name>'\\n        policyInfo: {\\n          policyName: '<policyName>'\\n          policyParameters: {\\n            backupDatasourceParametersList: [\\n              {\\n                containersList: '<containersList>'\\n                objectType: 'BlobBackupDatasourceParameters'\\n              }\\n            ]\\n          }\\n        }\\n      }\\n      {\\n        dataSourceInfo: {\\n          datasourceType: 'Microsoft.Compute/disks'\\n          resourceID: '<resourceID>'\\n          resourceLocation: '<resourceLocation>'\\n          resourceName: '<resourceName>'\\n          resourceType: 'Microsoft.Compute/disks'\\n          resourceUri: '<resourceUri>'\\n        }\\n        name: '<name>'\\n        policyInfo: {\\n          policyName: '<policyName>'\\n          policyParameters: {\\n            dataStoreParametersList: [\\n              {\\n                dataStoreType: 'OperationalStore'\\n                objectType: 'AzureOperationalStoreParameters'\\n                resourceGroupId: '<resourceGroupId>'\\n              }\\n            ]\\n          }\\n        }\\n      }\\n      {\\n        dataSourceInfo: {\\n          datasourceType: 'Microsoft.Compute/disks'\\n          resourceID: '<resourceID>'\\n          resourceLocation: '<resourceLocation>'\\n          resourceName: '<resourceName>'\\n          resourceType: 'Microsoft.Compute/disks'\\n          resourceUri: '<resourceUri>'\\n        }\\n        name: '<name>'\\n        policyInfo: {\\n          policyName: '<policyName>'\\n          policyParameters: {\\n            dataStoreParametersList: [\\n              {\\n                dataStoreType: 'OperationalStore'\\n                objectType: 'AzureOperationalStoreParameters'\\n                resourceGroupId: '<resourceGroupId>'\\n              }\\n            ]\\n          }\\n        }\\n      }\\n    ]\\n    backupPolicies: [\\n      {\\n        name: '<name>'\\n        properties: {\\n          datasourceTypes: [\\n            'Microsoft.Compute/disks'\\n          ]\\n          objectType: 'BackupPolicy'\\n          policyRules: [\\n            {\\n              backupParameters: {\\n                backupType: 'Incremental'\\n                objectType: 'AzureBackupParams'\\n              }\\n              dataStore: {\\n                dataStoreType: 'OperationalStore'\\n                objectType: 'DataStoreInfoBase'\\n              }\\n              name: 'BackupDaily'\\n              objectType: 'AzureBackupRule'\\n              trigger: {\\n                objectType: 'ScheduleBasedTriggerContext'\\n                schedule: {\\n                  repeatingTimeIntervals: [\\n                    'R/2025-03-31T00:00:00+04:00/P1D'\\n                  ]\\n                  timeZone: 'Arabian Standard Time'\\n                }\\n                taggingCriteria: [\\n                  {\\n                    isDefault: true\\n                    taggingPriority: 99\\n                    tagInfo: {\\n                      id: 'Default_'\\n                      tagName: 'Default'\\n                    }\\n                  }\\n                ]\\n              }\\n            }\\n            {\\n              isDefault: true\\n              lifecycles: [\\n                {\\n                  deleteAfter: {\\n                    duration: 'P7D'\\n                    objectType: 'AbsoluteDeleteOption'\\n                  }\\n                  sourceDataStore: {\\n                    dataStoreType: 'OperationalStore'\\n                    objectType: 'DataStoreInfoBase'\\n                  }\\n                  targetDataStoreCopySettings: []\\n                }\\n              ]\\n              name: 'Default'\\n              objectType: 'AzureRetentionRule'\\n            }\\n          ]\\n        }\\n      }\\n      {\\n        name: '<name>'\\n        properties: {\\n          datasourceTypes: [\\n            'Microsoft.Storage/storageAccounts/blobServices'\\n          ]\\n          objectType: 'BackupPolicy'\\n          policyRules: [\\n            {\\n              isDefault: true\\n              lifecycles: [\\n                {\\n                  deleteAfter: {\\n                    duration: 'P30D'\\n                    objectType: 'AbsoluteDeleteOption'\\n                  }\\n                  sourceDataStore: {\\n                    dataStoreType: 'OperationalStore'\\n                    objectType: 'DataStoreInfoBase'\\n                  }\\n                  targetDataStoreCopySettings: []\\n                }\\n              ]\\n              name: 'Default'\\n              objectType: 'AzureRetentionRule'\\n            }\\n            {\\n              isDefault: true\\n              lifecycles: [\\n                {\\n                  deleteAfter: {\\n                    duration: 'P90D'\\n                    objectType: 'AbsoluteDeleteOption'\\n                  }\\n                  sourceDataStore: {\\n                    dataStoreType: 'VaultStore'\\n                    objectType: 'DataStoreInfoBase'\\n                  }\\n                  targetDataStoreCopySettings: []\\n                }\\n              ]\\n              name: 'Default'\\n              objectType: 'AzureRetentionRule'\\n            }\\n            {\\n              backupParameters: {\\n                backupType: 'Discrete'\\n                objectType: 'AzureBackupParams'\\n              }\\n              dataStore: {\\n                dataStoreType: 'VaultStore'\\n                objectType: 'DataStoreInfoBase'\\n              }\\n              name: 'BackupDaily'\\n              objectType: 'AzureBackupRule'\\n              trigger: {\\n                objectType: 'ScheduleBasedTriggerContext'\\n                schedule: {\\n                  repeatingTimeIntervals: [\\n                    'R/2025-03-31T00:00:00+04:00/P1D'\\n                  ]\\n                  timeZone: 'Arabian Standard Time'\\n                }\\n                taggingCriteria: [\\n                  {\\n                    isDefault: true\\n                    taggingPriority: 99\\n                    tagInfo: {\\n                      id: 'Default_'\\n                      tagName: 'Default'\\n                    }\\n                  }\\n                ]\\n              }\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n    immutabilitySettingState: 'Unlocked'\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n    }\\n    roleAssignments: [\\n      {\\n        name: 'cbc3932a-1bee-4318-ae76-d70e1ba399c8'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Databricks Workspaces with encryption."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/databricks/workspace:0.11.0\",\"name\": \"workspace\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module workspace 'br/public:avm/res/databricks/workspace:0.11.0' = {\\n  name: 'workspaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dwenc001'\\n    // Non-required parameters\\n    customerManagedKey: {\\n      keyName: '<keyName>'\\n      keyVaultResourceId: '<keyVaultResourceId>'\\n    }\\n    customerManagedKeyManagedDisk: {\\n      keyName: '<keyName>'\\n      keyVaultResourceId: '<keyVaultResourceId>'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for DBforMySQL Flexible Servers using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/db-for-my-sql/flexible-server:0.9.0\",\"name\": \"flexibleServer\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module flexibleServer 'br/public:avm/res/db-for-my-sql/flexible-server:0.9.0' = {\\n  name: 'flexibleServerDeployment'\\n  params: {\\n    // Required parameters\\n    availabilityZone: 1\\n    name: 'dfmswaf001'\\n    skuName: 'Standard_D2ds_v4'\\n    tier: 'GeneralPurpose'\\n    // Non-required parameters\\n    administratorLogin: 'adminUserName'\\n    administratorLoginPassword: '<administratorLoginPassword>'\\n    highAvailability: 'ZoneRedundant'\\n    highAvailabilityZone: 2\\n    storageAutoGrow: 'Enabled'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a DBforPostgreSQL Flexible Server using the Primary server and Readonly Replication server configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/db-for-postgre-sql/flexible-server:0.13.0\",\"name\": \"flexibleServer\"}],\"rationale\": \"This module deploys a DBforPostgreSQL Flexible Server.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module flexibleServer 'br/public:avm/res/db-for-postgre-sql/flexible-server:0.13.0' = {\\n  name: 'flexibleServerDeployment'\\n  params: {\\n    // Required parameters\\n    availabilityZone: -1\\n    name: 'dfpsrep001'\\n    skuName: 'Standard_D2s_v3'\\n    tier: 'GeneralPurpose'\\n    // Non-required parameters\\n    autoGrow: 'Enabled'\\n    createMode: '<createMode>'\\n    highAvailability: 'Disabled'\\n    sourceServerResourceId: '<sourceServerResourceId>'\\n    storageSizeGB: 512\\n    version: '17'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Virtual Desktop Host Pool using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/desktop-virtualization/host-pool:0.8.0\",\"name\": \"hostPool\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module hostPool 'br/public:avm/res/desktop-virtualization/host-pool:0.8.0' = {\\n  name: 'hostPoolDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dvhpwaf002'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Dev Center using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/dev-center/devcenter:0.1.0\",\"name\": \"devcenter\"}],\"rationale\": \"This module deploys an Azure Dev Center.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module devcenter 'br/public:avm/res/dev-center/devcenter:0.1.0' = {\\n  name: 'devcenterDeployment'\\n  params: {\\n    name: 'dcdcmin001'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Dev Center Project using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/dev-center/project:0.1.0\",\"name\": \"project\"}],\"rationale\": \"This module deploys a Dev Center Project.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module project 'br/public:avm/res/dev-center/project:0.1.0' = {\\n  name: 'projectDeployment'\\n  params: {\\n    // Required parameters\\n    devCenterResourceId: '<devCenterResourceId>'\\n    name: 'dcpmax001'\\n    // Non-required parameters\\n    catalogs: [\\n      {\\n        gitHub: {\\n          branch: 'main'\\n          path: 'dotnet-dev-orchardcore'\\n          secretIdentifier: '<secretIdentifier>'\\n          uri: 'https://github.com/microsoft/devcenter-catalog.git'\\n        }\\n        name: 'testCatalogGitHub'\\n        syncType: 'Scheduled'\\n        tags: {\\n          'test-tag': 'test-value'\\n        }\\n      }\\n      {\\n        adoGit: {\\n          branch: 'main'\\n          secretIdentifier: '<secretIdentifier>'\\n          uri: 'https://contoso@dev.azure.com/contoso/your-project/_git/your-repo'\\n        }\\n        name: 'testCatalogAzureDevOpsGit'\\n        syncType: 'Manual'\\n      }\\n    ]\\n    catalogSettings: {\\n      catalogItemSyncTypes: [\\n        'EnvironmentDefinition'\\n        'ImageDefinition'\\n      ]\\n    }\\n    description: 'This is a test project for the Dev Center project module.'\\n    displayName: 'My Dev Center Project'\\n    environmentTypes: [\\n      {\\n        creatorRoleAssignmentRoles: [\\n          'acdd72a7-3385-48ef-bd42-f606fba81ae7'\\n          'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n        ]\\n        deploymentTargetSubscriptionResourceId: '<deploymentTargetSubscriptionResourceId>'\\n        displayName: 'My Sandbox Environment Type'\\n        managedIdentities: {\\n          systemAssigned: false\\n          userAssignedResourceIds: [\\n            '<managedIdentity1ResourceId>'\\n          ]\\n        }\\n        name: 'dep-et-dcpmax'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'DevCenter Project Admin'\\n          }\\n        ]\\n        status: 'Enabled'\\n        tags: {\\n          'prj-type': 'sandbox'\\n        }\\n        userRoleAssignmentsRoles: [\\n          {\\n            objectId: '<objectId>'\\n            roleDefinitions: [\\n              'b59867f0-fa02-499b-be73-45a86b5b3e1c'\\n              'e503ece1-11d0-4e8e-8e2c-7a6c3bf38815'\\n            ]\\n          }\\n          {\\n            objectId: '<objectId>'\\n            roleDefinitions: [\\n              '<roleDefinitionId // Custom role>'\\n            ]\\n          }\\n        ]\\n      }\\n    ]\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentity1ResourceId>'\\n      ]\\n    }\\n    maxDevBoxesPerUser: 2\\n    pools: [\\n      {\\n        devBoxDefinitionName: '<devBoxDefinitionName>'\\n        devBoxDefinitionType: 'Reference'\\n        displayName: 'My Sandbox Pool - Managed Network'\\n        localAdministrator: 'Enabled'\\n        managedVirtualNetworkRegion: 'australiaeast'\\n        name: 'sandbox-pool'\\n        schedule: {\\n          state: 'Enabled'\\n          time: '18:30'\\n          timeZone: 'Australia/Sydney'\\n        }\\n        singleSignOnStatus: 'Enabled'\\n        stopOnDisconnect: {\\n          gracePeriodMinutes: 60\\n          status: 'Enabled'\\n        }\\n        stopOnNoConnect: {\\n          gracePeriodMinutes: 30\\n          status: 'Enabled'\\n        }\\n        virtualNetworkType: 'Managed'\\n      }\\n      {\\n        devBoxDefinitionName: '<devBoxDefinitionName>'\\n        devBoxDefinitionType: 'Reference'\\n        displayName: 'My Sandbox Pool - Unmanaged Network'\\n        localAdministrator: 'Disabled'\\n        name: 'sandbox-pool-2'\\n        networkConnectionName: '<networkConnectionName>'\\n        singleSignOnStatus: 'Disabled'\\n        virtualNetworkType: 'Unmanaged'\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'DevCenter Project Admin'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        roleDefinitionIdOrName: 'DevCenter Project Admin'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a DevTest Lab using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/dev-test-lab/lab:0.4.0\",\"name\": \"lab\"}],\"rationale\": \"This module deploys a DevTest Lab.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module lab 'br/public:avm/res/dev-test-lab/lab:0.4.0' = {\\n  name: 'labDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'dtllmin001'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Cosmos DB account using analytical storage."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/document-db/database-account:0.16.0\",\"name\": \"databaseAccount\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module databaseAccount 'br/public:avm/res/document-db/database-account:0.16.0' = {\\n  name: 'databaseAccountDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'analytical'\\n    // Non-required parameters\\n    enableAnalyticalStorage: true\\n    sqlDatabases: [\\n      {\\n        name: 'no-containers-specified'\\n      }\\n    ]\\n    zoneRedundant: false\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Cosmos DB account deploying multiple regions."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/document-db/database-account:0.16.0\",\"name\": \"databaseAccount\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module databaseAccount 'br/public:avm/res/document-db/database-account:0.16.0' = {\\n  name: 'databaseAccountDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'multi-region'\\n    // Non-required parameters\\n    backupIntervalInMinutes: 300\\n    backupPolicyType: 'Periodic'\\n    backupRetentionIntervalInHours: 16\\n    backupStorageRedundancy: 'Geo'\\n    enableAutomaticFailover: true\\n    enableMultipleWriteLocations: true\\n    failoverLocations: [\\n      {\\n        failoverPriority: 0\\n        isZoneRedundant: false\\n        locationName: '<locationName>'\\n      }\\n      {\\n        failoverPriority: 1\\n        isZoneRedundant: false\\n        locationName: '<locationName>'\\n      }\\n    ]\\n    sqlDatabases: [\\n      {\\n        name: 'no-containers-specified'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Azure Cosmos DB for MongoDB (vCore) cluster using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/document-db/mongo-cluster:0.4.0\",\"name\": \"mongoCluster\"}],\"rationale\": \"This module deploys a Azure Cosmos DB for MongoDB (vCore) cluster.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module mongoCluster 'br/public:avm/res/document-db/mongo-cluster:0.4.0' = {\\n  name: 'mongoClusterDeployment'\\n  params: {\\n    // Required parameters\\n    administratorLogin: 'Admin001'\\n    administratorLoginPassword: '<administratorLoginPassword>'\\n    name: 'ddmcdefmin001'\\n    nodeCount: 1\\n    sku: 'M10'\\n    storage: 32\\n    // Non-required parameters\\n    highAvailabilityMode: 'Disabled'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Elastic SAN using the Private endpoint-enabled deployment configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/elastic-san/elastic-san:0.4.0\",\"name\": \"elasticSan\"}],\"rationale\": \"This module deploys an Elastic SAN.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module elasticSan 'br/public:avm/res/elastic-san/elastic-san:0.4.0' = {\\n  name: 'elasticSanDeployment'\\n  params: {\\n    // Required parameters\\n    availabilityZone: -1\\n    name: 'esanpe001'\\n    // Non-required parameters\\n    sku: 'Premium_ZRS'\\n    volumeGroups: [\\n      {\\n        name: 'vol-grp-01'\\n        privateEndpoints: [\\n          {\\n            lock: {\\n              kind: 'CanNotDelete'\\n              name: 'myCustomLockName'\\n            }\\n            privateDnsZoneGroup: {\\n              privateDnsZoneGroupConfigs: [\\n                {\\n                  privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n                }\\n              ]\\n            }\\n            subnetResourceId: '<subnetResourceId>'\\n            tags: {\\n              CostCenter: '123-456-789'\\n              Owner: 'Contoso'\\n            }\\n          }\\n        ]\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Event Grid Namespace using the MQTT Broker with routing to a namespace topic configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/event-grid/namespace:0.7.0\",\"name\": \"namespace\"}],\"rationale\": \"This module deploys an Event Grid Namespace.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module namespace 'br/public:avm/res/event-grid/namespace:0.7.0' = {\\n  name: 'namespaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'egnmqttct001'\\n    // Non-required parameters\\n    alternativeAuthenticationNameSources: [\\n      'ClientCertificateEmail'\\n      'ClientCertificateUri'\\n    ]\\n    clientGroups: [\\n      {\\n        description: 'this is group1'\\n        name: 'group1'\\n        query: 'attributes.keyName IN [\\\\'a\\\\', \\\\'b\\\\', \\\\'c\\\\']'\\n      }\\n    ]\\n    clients: [\\n      {\\n        attributes: {\\n          deviceTypes: [\\n            'Fan'\\n            'Light'\\n          ]\\n          floor: 12\\n          room: '345'\\n        }\\n        authenticationName: 'client2auth'\\n        clientCertificateAuthenticationAllowedThumbprints: [\\n          '1111111111111111111111111111111111111111'\\n          '2222222222222222222222222222222222222222'\\n        ]\\n        clientCertificateAuthenticationValidationSchema: 'ThumbprintMatch'\\n        description: 'this is client2'\\n        name: 'client1'\\n        state: 'Enabled'\\n      }\\n      {\\n        clientCertificateAuthenticationAllowedThumbprints: [\\n          '3333333333333333333333333333333333333333'\\n        ]\\n        clientCertificateAuthenticationValidationSchema: 'ThumbprintMatch'\\n        name: 'client2'\\n      }\\n      {\\n        name: 'client3'\\n      }\\n      {\\n        clientCertificateAuthenticationValidationSchema: 'IpMatchesAuthenticationName'\\n        name: 'client4'\\n      }\\n    ]\\n    location: '<location>'\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    maximumClientSessionsPerAuthenticationName: 5\\n    maximumSessionExpiryInHours: 2\\n    permissionBindings: [\\n      {\\n        clientGroupName: 'group1'\\n        description: 'this is binding1'\\n        name: 'bindiing1'\\n        permission: 'Publisher'\\n        topicSpaceName: 'topicSpace1'\\n      }\\n      {\\n        clientGroupName: 'group1'\\n        name: 'bindiing2'\\n        permission: 'Subscriber'\\n        topicSpaceName: 'topicSpace2'\\n      }\\n    ]\\n    routeTopicResourceId: '<routeTopicResourceId>'\\n    routingEnrichments: {\\n      dynamic: [\\n        {\\n          key: 'dynamic1'\\n          value: '\\\\${client.authenticationName}'\\n        }\\n      ]\\n      static: [\\n        {\\n          key: 'static1'\\n          value: 'value1'\\n          valueType: 'String'\\n        }\\n        {\\n          key: 'static2'\\n          value: 'value2'\\n          valueType: 'String'\\n        }\\n      ]\\n    }\\n    routingIdentityInfo: {\\n      type: 'UserAssigned'\\n      userAssignedIdentity: '<userAssignedIdentity>'\\n    }\\n    topics: [\\n      {\\n        name: 'topic1'\\n      }\\n    ]\\n    topicSpaces: [\\n      {\\n        name: 'topicSpace1'\\n        topicTemplates: [\\n          'devices/foo/bar'\\n          'devices/topic1/+'\\n        ]\\n      }\\n      {\\n        name: 'topicSpace2'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        topicTemplates: [\\n          'devices/topic1/+'\\n        ]\\n      }\\n    ]\\n    topicSpacesState: 'Enabled'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Event Grid Topic using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/event-grid/topic:0.9.0\",\"name\": \"topic\"}],\"rationale\": \"This module deploys an Event Grid Topic.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module topic 'br/public:avm/res/event-grid/topic:0.9.0' = {\\n  name: 'topicDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'egtmin001'\\n    // Non-required parameters\\n    eventSubscriptions: [\\n      {\\n        deliveryWithResourceIdentity: {\\n          destination: {\\n            endpointType: 'StorageQueue'\\n            properties: {\\n              queueName: '<queueName>'\\n              resourceId: '<resourceId>'\\n            }\\n          }\\n          identity: {\\n            type: 'UserAssigned'\\n            userAssignedIdentity: '<userAssignedIdentity>'\\n          }\\n        }\\n        name: 'egtmin001'\\n      }\\n    ]\\n    location: '<location>'\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'topic'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    publicNetworkAccess: 'Disabled'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Event Hub Namespaces using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/event-hub/namespace:0.13.0\",\"name\": \"namespace\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module namespace 'br/public:avm/res/event-hub/namespace:0.13.0' = {\\n  name: 'namespaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ehnmax001'\\n    // Non-required parameters\\n    authorizationRules: [\\n      {\\n        name: 'RootManageSharedAccessKey'\\n        rights: [\\n          'Listen'\\n          'Manage'\\n          'Send'\\n        ]\\n      }\\n      {\\n        name: 'SendListenAccess'\\n        rights: [\\n          'Listen'\\n          'Send'\\n        ]\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    disableLocalAuth: true\\n    eventhubs: [\\n      {\\n        messageRetentionInDays: 3\\n        name: 'az-evh-x-001'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Reader'\\n          }\\n        ]\\n      }\\n      {\\n        authorizationRules: [\\n          {\\n            name: 'RootManageSharedAccessKey'\\n            rights: [\\n              'Listen'\\n              'Manage'\\n              'Send'\\n            ]\\n          }\\n          {\\n            name: 'SendListenAccess'\\n            rights: [\\n              'Listen'\\n              'Send'\\n            ]\\n          }\\n        ]\\n        captureDescription: {\\n          destination: {\\n            identity: {\\n              userAssignedResourceId: '<userAssignedResourceId>'\\n            }\\n            name: 'EventHubArchive.AzureBlockBlob'\\n            properties: {\\n              archiveNameFormat: '{Namespace}/{EventHub}/{PartitionId}/{Year}/{Month}/{Day}/{Hour}/{Minute}/{Second}'\\n              blobContainer: '<blobContainer>'\\n              storageAccountResourceId: '<storageAccountResourceId>'\\n            }\\n          }\\n          encoding: 'Avro'\\n          intervalInSeconds: 300\\n          sizeLimitInBytes: 314572800\\n          skipEmptyArchives: true\\n        }\\n        consumergroups: [\\n          {\\n            name: 'custom'\\n            userMetadata: 'customMetadata'\\n          }\\n        ]\\n        name: 'az-evh-x-002'\\n        partitionCount: 2\\n        retentionDescriptionCleanupPolicy: 'Delete'\\n        retentionDescriptionEnabled: true\\n        retentionDescriptionRetentionTimeInHours: 3\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Reader'\\n          }\\n        ]\\n        status: 'Active'\\n      }\\n      {\\n        name: 'az-evh-x-003'\\n        retentionDescriptionCleanupPolicy: 'Compact'\\n        retentionDescriptionEnabled: true\\n        retentionDescriptionTombstoneRetentionTimeInHours: 24\\n      }\\n    ]\\n    isAutoInflateEnabled: true\\n    kafkaEnabled: true\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n      notes: 'This is a custom lock note.'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceId: '<userAssignedResourceId>'\\n    }\\n    maximumThroughputUnits: 4\\n    minimumTlsVersion: '1.2'\\n    networkRuleSets: {\\n      defaultAction: 'Deny'\\n      ipRules: [\\n        {\\n          action: 'Allow'\\n          ipMask: '10.10.10.10'\\n        }\\n      ]\\n      publicNetworkAccess: 'Disabled'\\n      trustedServiceAccessEnabled: false\\n      virtualNetworkRules: [\\n        {\\n          ignoreMissingVnetServiceEndpoint: true\\n          subnetResourceId: '<subnetResourceId>'\\n        }\\n      ]\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'namespace'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n    ]\\n    publicNetworkAccess: 'Disabled'\\n    roleAssignments: [\\n      {\\n        name: 'bd0f41e3-8e3e-4cd3-b028-edd61608bd9f'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    skuCapacity: 2\\n    skuName: 'Standard'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    zoneRedundant: true\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Health Bots using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/health-bot/health-bot:0.3.0\",\"name\": \"healthBot\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module healthBot 'br/public:avm/res/health-bot/health-bot:0.3.0' = {\\n  name: 'healthBotDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'hbhbwaf002'\\n    sku: 'F0'\\n    // Non-required parameters\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Azure Arc License using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/hybrid-compute/license:0.1.0\",\"name\": \"license\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module license 'br/public:avm/res/hybrid-compute/license:0.1.0' = {\\n  name: 'licenseDeployment'\\n  params: {\\n    name: 'hclwaf001'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Hybrid Container Service Provisioned Cluster Instance using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/hybrid-container-service/provisioned-cluster-instance:0.2.0\",\"name\": \"provisionedClusterInstance\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module provisionedClusterInstance 'br/public:avm/res/hybrid-container-service/provisioned-cluster-instance:0.2.0' = {\\n  name: 'provisionedClusterInstanceDeployment'\\n  params: {\\n    // Required parameters\\n    cloudProviderProfile: {\\n      infraNetworkProfile: {\\n        vnetSubnetIds: [\\n          '<resourceId>'\\n        ]\\n      }\\n    }\\n    customLocationResourceId: '<customLocationResourceId>'\\n    name: 'hcpciwaf001'\\n    // Non-required parameters\\n    agentPoolProfiles: [\\n      {\\n        count: 2\\n        enableAutoScaling: false\\n        maxCount: 5\\n        maxPods: 110\\n        minCount: 1\\n        name: 'nodepool1'\\n        nodeLabels: {}\\n        nodeTaints: []\\n        osSKU: 'CBLMariner'\\n        osType: 'Linux'\\n        vmSize: 'Standard_A4_v2'\\n      }\\n    ]\\n    connectClustersTags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    controlPlane: {\\n      controlPlaneEndpoint: {\\n        hostIP: '<hostIP>'\\n      }\\n      count: 1\\n      vmSize: 'Standard_A4_v2'\\n    }\\n    keyVaultName: '<keyVaultName>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Application Insights using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/component:0.6.0\",\"name\": \"component\"}],\"rationale\": \"This component deploys an Application Insights instance.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module component 'br/public:avm/res/insights/component:0.6.0' = {\\n  name: 'componentDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'icmin001'\\n    workspaceResourceId: '<workspaceResourceId>'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Data Collection Rule using the Collecting custom text logs with ingestion-time transformation configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/data-collection-rule:0.7.0\",\"name\": \"dataCollectionRule\"}],\"rationale\": \"This module deploys a Data Collection Rule.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module dataCollectionRule 'br/public:avm/res/insights/data-collection-rule:0.7.0' = {\\n  name: 'dataCollectionRuleDeployment'\\n  params: {\\n    // Required parameters\\n    dataCollectionRuleProperties: {\\n      dataCollectionEndpointResourceId: '<dataCollectionEndpointResourceId>'\\n      dataFlows: [\\n        {\\n          destinations: [\\n            '<logAnalyticsWorkspaceName>'\\n          ]\\n          outputStream: 'Custom-CustomTableAdvanced_CL'\\n          streams: [\\n            'Custom-CustomTableAdvanced_CL'\\n          ]\\n          transformKql: 'source | extend LogFields = split(RawData, \\\\',\\\\') | extend EventTime = todatetime(LogFields[0]) | extend EventLevel = tostring(LogFields[1]) | extend EventCode = toint(LogFields[2]) | extend Message = tostring(LogFields[3]) | project TimeGenerated, EventTime, EventLevel, EventCode, Message'\\n        }\\n      ]\\n      dataSources: {\\n        logFiles: [\\n          {\\n            filePatterns: [\\n              'C:\\\\\\\\TestLogsAdvanced\\\\\\\\TestLog*.log'\\n            ]\\n            format: 'text'\\n            name: 'CustomTableAdvanced_CL'\\n            samplingFrequencyInSeconds: 60\\n            settings: {\\n              text: {\\n                recordStartTimestampFormat: 'ISO 8601'\\n              }\\n            }\\n            streams: [\\n              'Custom-CustomTableAdvanced_CL'\\n            ]\\n          }\\n        ]\\n      }\\n      description: 'Collecting custom text logs with ingestion-time transformation to columns. Expected format of a log line (comma separated values): \\\\'<DateTime>,<EventLevel>,<EventCode>,<Message>\\\\', for example: \\\\'2023-01-25T20:15:05Z,ERROR,404,Page not found\\\\''\\n      destinations: {\\n        logAnalytics: [\\n          {\\n            name: '<name>'\\n            workspaceResourceId: '<workspaceResourceId>'\\n          }\\n        ]\\n      }\\n      kind: 'Windows'\\n      streamDeclarations: {\\n        'Custom-CustomTableAdvanced_CL': {\\n          columns: [\\n            {\\n              name: 'TimeGenerated'\\n              type: 'datetime'\\n            }\\n            {\\n              name: 'EventTime'\\n              type: 'datetime'\\n            }\\n            {\\n              name: 'EventLevel'\\n              type: 'string'\\n            }\\n            {\\n              name: 'EventCode'\\n              type: 'int'\\n            }\\n            {\\n              name: 'Message'\\n              type: 'string'\\n            }\\n            {\\n              name: 'RawData'\\n              type: 'string'\\n            }\\n          ]\\n        }\\n      }\\n    }\\n    name: 'idcrcusadv001'\\n    // Non-required parameters\\n    location: '<location>'\\n    managedIdentities: {\\n      systemAssigned: true\\n    }\\n    tags: {\\n      'hidden-title': 'This is visible in the resource name'\\n      kind: 'Windows'\\n      resourceType: 'Data Collection Rules'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Data Collection Rule using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/data-collection-rule:0.7.0\",\"name\": \"dataCollectionRule\"}],\"rationale\": \"This module deploys a Data Collection Rule.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module dataCollectionRule 'br/public:avm/res/insights/data-collection-rule:0.7.0' = {\\n  name: 'dataCollectionRuleDeployment'\\n  params: {\\n    // Required parameters\\n    dataCollectionRuleProperties: {\\n      dataFlows: [\\n        {\\n          destinations: [\\n            'azureMonitorMetrics-default'\\n          ]\\n          streams: [\\n            'Microsoft-InsightsMetrics'\\n          ]\\n        }\\n        {\\n          destinations: [\\n            '<logAnalyticsWorkspaceName>'\\n          ]\\n          streams: [\\n            'Microsoft-Event'\\n          ]\\n        }\\n      ]\\n      dataSources: {\\n        performanceCounters: [\\n          {\\n            counterSpecifiers: [\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\% Disk Read Time'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\% Disk Time'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\% Disk Write Time'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\% Free Space'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\% Idle Time'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk Queue Length'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk Read Queue Length'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk sec/Read'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk sec/Transfer'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk sec/Write'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Avg. Disk Write Queue Length'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Bytes/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Read Bytes/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Reads/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Transfers/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Write Bytes/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Disk Writes/sec'\\n              '\\\\\\\\LogicalDisk(_Total)\\\\\\\\Free Megabytes'\\n              '\\\\\\\\Memory\\\\\\\\% Committed Bytes In Use'\\n              '\\\\\\\\Memory\\\\\\\\Available Bytes'\\n              '\\\\\\\\Memory\\\\\\\\Cache Bytes'\\n              '\\\\\\\\Memory\\\\\\\\Committed Bytes'\\n              '\\\\\\\\Memory\\\\\\\\Page Faults/sec'\\n              '\\\\\\\\Memory\\\\\\\\Pages/sec'\\n              '\\\\\\\\Memory\\\\\\\\Pool Nonpaged Bytes'\\n              '\\\\\\\\Memory\\\\\\\\Pool Paged Bytes'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Bytes Received/sec'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Bytes Sent/sec'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Bytes Total/sec'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Packets Outbound Errors'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Packets Received Errors'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Packets Received/sec'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Packets Sent/sec'\\n              '\\\\\\\\Network Interface(*)\\\\\\\\Packets/sec'\\n              '\\\\\\\\Process(_Total)\\\\\\\\Handle Count'\\n              '\\\\\\\\Process(_Total)\\\\\\\\Thread Count'\\n              '\\\\\\\\Process(_Total)\\\\\\\\Working Set'\\n              '\\\\\\\\Process(_Total)\\\\\\\\Working Set - Private'\\n              '\\\\\\\\Processor Information(_Total)\\\\\\\\% Privileged Time'\\n              '\\\\\\\\Processor Information(_Total)\\\\\\\\% Processor Time'\\n              '\\\\\\\\Processor Information(_Total)\\\\\\\\% User Time'\\n              '\\\\\\\\Processor Information(_Total)\\\\\\\\Processor Frequency'\\n              '\\\\\\\\System\\\\\\\\Context Switches/sec'\\n              '\\\\\\\\System\\\\\\\\Processes'\\n              '\\\\\\\\System\\\\\\\\Processor Queue Length'\\n              '\\\\\\\\System\\\\\\\\System Up Time'\\n            ]\\n            name: 'perfCounterDataSource60'\\n            samplingFrequencyInSeconds: 60\\n            streams: [\\n              'Microsoft-InsightsMetrics'\\n            ]\\n          }\\n        ]\\n        windowsEventLogs: [\\n          {\\n            name: 'eventLogsDataSource'\\n            streams: [\\n              'Microsoft-Event'\\n            ]\\n            xPathQueries: [\\n              'Application!*[System[(Level=1 or Level=2 or Level=3 or Level=4 or Level=0 or Level=5)]]'\\n              'Security!*[System[(band(Keywords,13510798882111488))]]'\\n              'System!*[System[(Level=1 or Level=2 or Level=3 or Level=4 or Level=0 or Level=5)]]'\\n            ]\\n          }\\n        ]\\n      }\\n      description: 'Collecting Windows-specific performance counters and Windows Event Logs'\\n      destinations: {\\n        azureMonitorMetrics: {\\n          name: 'azureMonitorMetrics-default'\\n        }\\n        logAnalytics: [\\n          {\\n            name: '<name>'\\n            workspaceResourceId: '<workspaceResourceId>'\\n          }\\n        ]\\n      }\\n      kind: 'Windows'\\n    }\\n    name: 'idcrwaf001'\\n    // Non-required parameters\\n    location: '<location>'\\n    tags: {\\n      'hidden-title': 'This is visible in the resource name'\\n      kind: 'Windows'\\n      resourceType: 'Data Collection Rules'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Metric Alert using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/metric-alert:0.4.0\",\"name\": \"metricAlert\"}],\"rationale\": \"This module deploys a Metric Alert.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module metricAlert 'br/public:avm/res/insights/metric-alert:0.4.0' = {\\n  name: 'metricAlertDeployment'\\n  params: {\\n    // Required parameters\\n    criteria: {\\n      componentResourceId: '<componentResourceId>'\\n      failedLocationCount: 3\\n      'odata.type': 'Microsoft.Azure.Monitor.WebtestLocationAvailabilityCriteria'\\n      webTestResourceId: '<webTestResourceId>'\\n    }\\n    name: 'imawaf001'\\n    // Non-required parameters\\n    actions: [\\n      '<actionGroupResourceId>'\\n    ]\\n    evaluationFrequency: 'PT5M'\\n    scopes: [\\n      '<appInsightsResourceId>'\\n      '<pingTestResourceId>'\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    windowSize: 'PT5M'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Web Test using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/webtest:0.3.0\",\"name\": \"webtest\"}],\"rationale\": \"This module deploys a Web Test.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module webtest 'br/public:avm/res/insights/webtest:0.3.0' = {\\n  name: 'webtestDeployment'\\n  params: {\\n    // Required parameters\\n    appInsightResourceId: '<appInsightResourceId>'\\n    name: 'iwtmin001'\\n    request: {\\n      HttpVerb: 'GET'\\n      RequestUrl: 'https://learn.microsoft.com/en-us/'\\n    }\\n    webTestName: 'wt$iwtmin001'\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Key Vault using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/key-vault/vault:0.13.0\",\"name\": \"vault\"}],\"rationale\": \"This module deploys a Key Vault.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module vault 'br/public:avm/res/key-vault/vault:0.13.0' = {\\n  name: 'vaultDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'kvvwaf002'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    enablePurgeProtection: false\\n    enableRbacAuthorization: true\\n    keys: [\\n      {\\n        attributes: {\\n          enabled: true\\n          exp: 1702648632\\n          nbf: 10000\\n        }\\n        keySize: 4096\\n        name: 'keyName'\\n        rotationPolicy: {\\n          attributes: {\\n            expiryTime: 'P2Y'\\n          }\\n          lifetimeActions: [\\n            {\\n              action: {\\n                type: 'rotate'\\n              }\\n              trigger: {\\n                timeBeforeExpiry: 'P2M'\\n              }\\n            }\\n            {\\n              action: {\\n                type: 'notify'\\n              }\\n              trigger: {\\n                timeBeforeExpiry: 'P30D'\\n              }\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n    networkAcls: {\\n      bypass: 'AzureServices'\\n      defaultAction: 'Deny'\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'vault'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    secrets: [\\n      {\\n        attributes: {\\n          enabled: true\\n          exp: 1702648632\\n          nbf: 10000\\n        }\\n        contentType: 'Something'\\n        name: 'secretName'\\n        value: 'secretValue'\\n      }\\n    ]\\n    softDeleteRetentionInDays: 7\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Kubernetes Configuration Extension using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/kubernetes-configuration/extension:0.3.0\",\"name\": \"extension\"}],\"rationale\": \"This module deploys a Kubernetes Configuration Extension.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module extension 'br/public:avm/res/kubernetes-configuration/extension:0.3.0' = {\\n  name: 'extensionDeployment'\\n  params: {\\n    // Required parameters\\n    clusterName: '<clusterName>'\\n    extensionType: 'microsoft.flux'\\n    name: 'kcewaf001'\\n    // Non-required parameters\\n    configurationSettings: {\\n      'image-automation-controller.enabled': 'false'\\n      'image-reflector-controller.enabled': 'false'\\n      'kustomize-controller.enabled': 'true'\\n      'notification-controller.enabled': 'false'\\n      'source-controller.enabled': 'true'\\n    }\\n    fluxConfigurations: [\\n      {\\n        gitRepository: {\\n          repositoryRef: {\\n            branch: 'main'\\n          }\\n          sshKnownHosts: ''\\n          syncIntervalInSeconds: 300\\n          timeoutInSeconds: 180\\n          url: 'https://github.com/mspnp/aks-baseline'\\n        }\\n        kustomizations: {\\n          unified: {\\n            path: './cluster-manifests'\\n          }\\n        }\\n        namespace: 'flux-system'\\n        scope: 'cluster'\\n        suspend: false\\n      }\\n    ]\\n    releaseNamespace: 'flux-system'\\n    releaseTrain: 'Stable'\\n    version: '0.5.2'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Kusto Cluster using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/kusto/cluster:0.8.0\",\"name\": \"cluster\"}],\"rationale\": \"This module deploys a Kusto Cluster.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module cluster 'br/public:avm/res/kusto/cluster:0.8.0' = {\\n  name: 'clusterDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'kcmin0001'\\n    sku: 'Standard_E2ads_v5'\\n    // Non-required parameters\\n    enableDiskEncryption: true\\n    location: '<location>'\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Load test using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/load-test-service/load-test:0.4.0\",\"name\": \"loadTest\"}],\"rationale\": \"This module deploys a Load test.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module loadTest 'br/public:avm/res/load-test-service/load-test:0.4.0' = {\\n  name: 'loadTestDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ltmax001'\\n    // Non-required parameters\\n    loadTestDescription: 'This is a test load test to validate the module.'\\n    location: '<location>'\\n    lock: {\\n      kind: 'None'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n    }\\n    roleAssignments: [\\n      {\\n        name: 'd37a15bc-8634-4f4f-a736-700c1b955cd7'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Machine Learning Registry using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/machine-learning-services/registry:0.1.0\",\"name\": \"registry\"}],\"rationale\": \"This module deploys an Azure Machine Learning Registry.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module registry 'br/public:avm/res/machine-learning-services/registry:0.1.0' = {\\n  name: 'registryDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'mlsrmax001'\\n    // Non-required parameters\\n    acrAccountName: '<acrAccountName>'\\n    acrSku: 'Premium'\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        name: '8f8b1c39-827f-43e6-a457-98bb15b5dbdf'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    storageAccountAllowBlobPublicAccess: false\\n    storageAccountHnsEnabled: true\\n    storageAccountName: '<storageAccountName>'\\n    storageAccountType: 'Standard_ZRS'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Machine Learning Services Workspace using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/machine-learning-services/workspace:0.13.0\",\"name\": \"workspace\"}],\"rationale\": \"This module deploys a Machine Learning Services Workspace.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module workspace 'br/public:avm/res/machine-learning-services/workspace:0.13.0' = {\\n  name: 'workspaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'mlswmax001'\\n    sku: 'Premium'\\n    // Non-required parameters\\n    associatedApplicationInsightsResourceId: '<associatedApplicationInsightsResourceId>'\\n    associatedKeyVaultResourceId: '<associatedKeyVaultResourceId>'\\n    associatedStorageAccountResourceId: '<associatedStorageAccountResourceId>'\\n    computes: [\\n      {\\n        computeLocation: '<computeLocation>'\\n        computeType: 'AmlCompute'\\n        description: 'Default CPU Cluster'\\n        disableLocalAuth: false\\n        location: '<location>'\\n        managedIdentities: {\\n          systemAssigned: false\\n          userAssignedResourceIds: [\\n            '<managedIdentityResourceId>'\\n          ]\\n        }\\n        name: 'DefaultCPU'\\n        properties: {\\n          enableNodePublicIp: true\\n          isolatedNetwork: false\\n          osType: 'Linux'\\n          remoteLoginPortPublicAccess: 'Disabled'\\n          scaleSettings: {\\n            maxNodeCount: 3\\n            minNodeCount: 0\\n            nodeIdleTimeBeforeScaleDown: 'PT5M'\\n          }\\n          vmPriority: 'Dedicated'\\n          vmSize: 'STANDARD_DS11_V2'\\n        }\\n        sku: 'Basic'\\n      }\\n    ]\\n    datastores: [\\n      {\\n        name: 'datastore'\\n        properties: {\\n          accountName: 'myaccount'\\n          containerName: 'my-container'\\n          credentials: {\\n            credentialsType: 'None'\\n          }\\n          datastoreType: 'AzureBlob'\\n          endpoint: '<endpoint>'\\n          protocol: 'https'\\n          resourceGroup: '<resourceGroup>'\\n          serviceDataAccessAuthIdentity: 'None'\\n          subscriptionId: '<subscriptionId>'\\n        }\\n      }\\n    ]\\n    description: 'The cake is a lie.'\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    discoveryUrl: 'http://example.com'\\n    friendlyName: 'Workspace'\\n    imageBuildCompute: 'testcompute'\\n    ipAllowlist: [\\n      '1.2.3.4/32'\\n    ]\\n    kind: 'Default'\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: false\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    managedNetworkSettings: {\\n      isolationMode: 'Disabled'\\n    }\\n    primaryUserAssignedIdentity: '<primaryUserAssignedIdentity>'\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          name: 'group1'\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              name: 'config1'\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          name: 'group2'\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              name: 'config2'\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    provisionNetworkNow: true\\n    roleAssignments: [\\n      {\\n        name: 'f9b5b0d9-f27e-4c89-bacf-1bbc4a99dbce'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    serverlessComputeSettings: {\\n      serverlessComputeCustomSubnet: '<serverlessComputeCustomSubnet>'\\n      serverlessComputeNoPublicIP: true\\n    }\\n    systemDatastoresAuthMode: 'AccessKey'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Maintenance Configuration using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/maintenance/maintenance-configuration:0.3.0\",\"name\": \"maintenanceConfiguration\"}],\"rationale\": \"This module deploys a Maintenance Configuration.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module maintenanceConfiguration 'br/public:avm/res/maintenance/maintenance-configuration:0.3.0' = {\\n  name: 'maintenanceConfigurationDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'mmcmax001'\\n    // Non-required parameters\\n    extensionProperties: {\\n      InGuestPatchMode: 'User'\\n    }\\n    installPatches: {\\n      linuxParameters: {\\n        classificationsToInclude: '<classificationsToInclude>'\\n        packageNameMasksToExclude: '<packageNameMasksToExclude>'\\n        packageNameMasksToInclude: '<packageNameMasksToInclude>'\\n      }\\n      rebootSetting: 'IfRequired'\\n      windowsParameters: {\\n        classificationsToInclude: [\\n          'Critical'\\n          'Security'\\n        ]\\n        kbNumbersToExclude: '<kbNumbersToExclude>'\\n        kbNumbersToInclude: '<kbNumbersToInclude>'\\n      }\\n    }\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    maintenanceScope: 'InGuestPatch'\\n    maintenanceWindow: {\\n      duration: '03:00'\\n      expirationDateTime: '9999-12-31 23:59:59'\\n      recurEvery: 'Day'\\n      startDateTime: '2022-12-31 13:00'\\n      timeZone: 'W. Europe Standard Time'\\n    }\\n    namespace: 'mmcmaxns'\\n    roleAssignments: [\\n      {\\n        name: 'd78ec5f7-4692-4f43-8c17-7569466bbed5'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    visibility: 'Custom'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Registration Definitions using the Resource group deployment configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/managed-services/registration-definition:0.1.0\",\"name\": \"registrationDefinition\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module registrationDefinition 'br/public:avm/res/managed-services/registration-definition:0.1.0' = {\\n  name: 'registrationDefinitionDeployment'\\n  params: {\\n    // Required parameters\\n    authorizations: [\\n      {\\n        principalId: 'ecadddf6-78c3-4516-afb2-7d30a174ea13'\\n        roleDefinitionId: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: 'ecadddf6-78c3-4516-afb2-7d30a174ea13'\\n        roleDefinitionId: '91c1777a-f3dc-4fae-b103-61d183457e46'\\n      }\\n    ]\\n    managedByTenantId: '<managedByTenantId>'\\n    name: 'Component Validation - msrdrg Subscription assignment'\\n    registrationDescription: 'Managed by Lighthouse'\\n    // Non-required parameters\\n    metadataLocation: '<metadataLocation>'\\n    registrationId: '<registrationId>'\\n    resourceGroupName: '<resourceGroupName>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Service Groups using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/management/service-group:0.1.0\",\"name\": \"serviceGroup\"}],\"rationale\": \"This module will allow you to create a service group and also associate resource to this service group, if you have permissions upon those resources.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module serviceGroup 'br/public:avm/res/management/service-group:0.1.0' = {\\n  name: 'serviceGroupDeployment'\\n  params: {\\n    // Required parameters\\n    name: '<name>'\\n    // Non-required parameters\\n    displayName: 'Service Group E2E Test WAF Aligned'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure NetApp Files Account and the associated resource types such as backups, capacity pools and volumes using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/net-app/net-app-account:0.11.0\",\"name\": \"netAppAccount\"}],\"rationale\": \"This module deploys an Azure NetApp Files Account and the associated resource types such as backups, capacity pools and volumes.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module netAppAccount 'br/public:avm/res/net-app/net-app-account:0.11.0' = {\\n  name: 'netAppAccountDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nanaawaf001'\\n    // Non-required parameters\\n    location: '<location>'\\n    tags: {\\n      service: 'netapp'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Application Gateway Web Application Firewall (WAF) Policies using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/application-gateway-web-application-firewall-policy:0.2.0\",\"name\": \"applicationGatewayWebApplicationFirewallPolicy\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module applicationGatewayWebApplicationFirewallPolicy 'br/public:avm/res/network/application-gateway-web-application-firewall-policy:0.2.0' = {\\n  name: 'applicationGatewayWebApplicationFirewallPolicyDeployment'\\n  params: {\\n    // Required parameters\\n    managedRules: {\\n      managedRuleSets: [\\n        {\\n          ruleGroupOverrides: []\\n          ruleSetType: 'OWASP'\\n          ruleSetVersion: '3.2'\\n        }\\n        {\\n          ruleGroupOverrides: []\\n          ruleSetType: 'Microsoft_BotManagerRuleSet'\\n          ruleSetVersion: '0.1'\\n        }\\n      ]\\n    }\\n    name: 'nagwafpmax001'\\n    // Non-required parameters\\n    location: '<location>'\\n    policySettings: {\\n      customBlockResponseBody: 'PGh0bWw+CjxoZWFkZXI+PHRpdGxlPkhlbGxvPC90aXRsZT48L2hlYWRlcj4KPGJvZHk+CkhlbGxvIHdvcmxkCjwvYm9keT4KPC9odG1sPg=='\\n      customBlockResponseStatusCode: 403\\n      fileUploadLimitInMb: 10\\n      jsChallengeCookieExpirationInMins: 60\\n      mode: 'Prevention'\\n      state: 'Enabled'\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Firewall using the Custom-PIP configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/azure-firewall:0.9.0\",\"name\": \"azureFirewall\"}],\"rationale\": \"This module deploys an Azure Firewall.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module azureFirewall 'br/public:avm/res/network/azure-firewall:0.9.0' = {\\n  name: 'azureFirewallDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nafcstpip001'\\n    // Non-required parameters\\n    location: '<location>'\\n    publicIPAddressObject: {\\n      diagnosticSettings: [\\n        {\\n          eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n          eventHubName: '<eventHubName>'\\n          metricCategories: [\\n            {\\n              category: 'AllMetrics'\\n            }\\n          ]\\n          name: 'customSetting'\\n          storageAccountResourceId: '<storageAccountResourceId>'\\n          workspaceResourceId: '<workspaceResourceId>'\\n        }\\n      ]\\n      name: 'new-pip-nafcstpip'\\n      publicIPAllocationMethod: 'Static'\\n      publicIPPrefixResourceId: ''\\n      roleAssignments: [\\n        {\\n          principalId: '<principalId>'\\n          principalType: 'ServicePrincipal'\\n          roleDefinitionIdOrName: 'Reader'\\n        }\\n      ]\\n      skuName: 'Standard'\\n      skuTier: 'Regional'\\n    }\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Firewall using the Public-IP-Prefix configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/azure-firewall:0.9.0\",\"name\": \"azureFirewall\"}],\"rationale\": \"This module deploys an Azure Firewall.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module azureFirewall 'br/public:avm/res/network/azure-firewall:0.9.0' = {\\n  name: 'azureFirewallDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nafpip001'\\n    // Non-required parameters\\n    availabilityZones: []\\n    azureSkuTier: 'Basic'\\n    location: '<location>'\\n    managementIPAddressObject: {\\n      managementIPAllocationMethod: 'Static'\\n      managementIPPrefixResourceId: '<managementIPPrefixResourceId>'\\n      name: 'managementIP01'\\n      skuName: 'Standard'\\n      skuTier: 'Regional'\\n    }\\n    publicIPAddressObject: {\\n      name: 'publicIP01'\\n      publicIPAllocationMethod: 'Static'\\n      publicIPPrefixResourceId: '<publicIPPrefixResourceId>'\\n      skuName: 'Standard'\\n      skuTier: 'Regional'\\n    }\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Bastion Host using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/bastion-host:0.8.0\",\"name\": \"bastionHost\"}],\"rationale\": \"This module deploys a Bastion Host.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module bastionHost 'br/public:avm/res/network/bastion-host:0.8.0' = {\\n  name: 'bastionHostDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nbhwaf001'\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n    // Non-required parameters\\n    bastionSubnetPublicIpResourceId: '<bastionSubnetPublicIpResourceId>'\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    disableCopyPaste: true\\n    enableFileCopy: false\\n    enableIpConnect: false\\n    enableShareableLink: false\\n    location: '<location>'\\n    scaleUnits: 4\\n    skuName: 'Standard'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a DDoS Protection Plan using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/ddos-protection-plan:0.3.0\",\"name\": \"ddosProtectionPlan\"}],\"rationale\": \"This module deploys a DDoS Protection Plan.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module ddosProtectionPlan 'br/public:avm/res/network/ddos-protection-plan:0.3.0' = {\\n  name: 'ddosProtectionPlanDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ndppwaf001'\\n    // Non-required parameters\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Public DNS zone using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/dns-zone:0.5.0\",\"name\": \"dnsZone\"}],\"rationale\": \"This module deploys a Public DNS zone.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module dnsZone 'br/public:avm/res/network/dns-zone:0.5.0' = {\\n  name: 'dnsZoneDeployment'\\n  params: {\\n    name: 'ndzmin001.com'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Express Route Gateway using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/express-route-gateway:0.8.0\",\"name\": \"expressRouteGateway\"}],\"rationale\": \"This module deploys an Express Route Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module expressRouteGateway 'br/public:avm/res/network/express-route-gateway:0.8.0' = {\\n  name: 'expressRouteGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nergmin002'\\n    virtualHubResourceId: '<virtualHubResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Firewall Policy using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/firewall-policy:0.3.0\",\"name\": \"firewallPolicy\"}],\"rationale\": \"This module deploys a Firewall Policy.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module firewallPolicy 'br/public:avm/res/network/firewall-policy:0.3.0' = {\\n  name: 'firewallPolicyDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nfpmax001'\\n    // Non-required parameters\\n    allowSqlRedirect: true\\n    enableProxy: true\\n    intrusionDetection: {\\n      mode: 'Alert'\\n    }\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    roleAssignments: [\\n      {\\n        name: 'c1c7fa14-5a90-4932-8781-fa91318b8858'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    ruleCollectionGroups: [\\n      {\\n        name: 'rule-001'\\n        priority: 5000\\n        ruleCollections: [\\n          {\\n            action: {\\n              type: 'Allow'\\n            }\\n            name: 'collection002'\\n            priority: 5555\\n            ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\\n            rules: [\\n              {\\n                destinationAddresses: [\\n                  '*'\\n                ]\\n                destinationFqdns: []\\n                destinationIpGroups: []\\n                destinationPorts: [\\n                  '80'\\n                ]\\n                ipProtocols: [\\n                  'TCP'\\n                  'UDP'\\n                ]\\n                name: 'rule002'\\n                ruleType: 'NetworkRule'\\n                sourceAddresses: [\\n                  '*'\\n                ]\\n                sourceIpGroups: []\\n              }\\n            ]\\n          }\\n        ]\\n      }\\n    ]\\n    servers: [\\n      '10.0.0.4'\\n      '10.0.0.5'\\n    ]\\n    snat: {\\n      autoLearnPrivateRanges: 'Enabled'\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    tier: 'Premium'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Front Door Web Application Firewall (WAF) Policy using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/front-door-web-application-firewall-policy:0.3.0\",\"name\": \"frontDoorWebApplicationFirewallPolicy\"}],\"rationale\": \"This module deploys a Front Door Web Application Firewall (WAF) Policy.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module frontDoorWebApplicationFirewallPolicy 'br/public:avm/res/network/front-door-web-application-firewall-policy:0.3.0' = {\\n  name: 'frontDoorWebApplicationFirewallPolicyDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nagwafpwaf001'\\n    // Non-required parameters\\n    customRules: {\\n      rules: [\\n        {\\n          action: 'Block'\\n          enabledState: 'Enabled'\\n          matchConditions: [\\n            {\\n              matchValue: [\\n                'CH'\\n              ]\\n              matchVariable: 'RemoteAddr'\\n              negateCondition: false\\n              operator: 'GeoMatch'\\n              selector: '<selector>'\\n              transforms: []\\n            }\\n            {\\n              matchValue: [\\n                'windows'\\n              ]\\n              matchVariable: 'RequestHeader'\\n              negateCondition: false\\n              operator: 'Contains'\\n              selector: 'UserAgent'\\n              transforms: []\\n            }\\n            {\\n              matchValue: [\\n                '?>'\\n                '<?php'\\n              ]\\n              matchVariable: 'QueryString'\\n              negateCondition: false\\n              operator: 'Contains'\\n              transforms: [\\n                'Lowercase'\\n                'UrlDecode'\\n              ]\\n            }\\n          ]\\n          name: 'CustomRule1'\\n          priority: 2\\n          rateLimitDurationInMinutes: 1\\n          rateLimitThreshold: 10\\n          ruleType: 'MatchRule'\\n        }\\n      ]\\n    }\\n    location: '<location>'\\n    managedRules: {\\n      managedRuleSets: [\\n        {\\n          ruleSetType: 'Microsoft_BotManagerRuleSet'\\n          ruleSetVersion: '1.0'\\n        }\\n      ]\\n    }\\n    policySettings: {\\n      customBlockResponseBody: 'PGh0bWw+CjxoZWFkZXI+PHRpdGxlPkhlbGxvPC90aXRsZT48L2hlYWRlcj4KPGJvZHk+CkhlbGxvIHdvcmxkCjwvYm9keT4KPC9odG1sPg=='\\n      customBlockResponseStatusCode: 200\\n      mode: 'Prevention'\\n      redirectUrl: 'http://www.bing.com'\\n    }\\n    sku: 'Premium_AzureFrontDoor'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Load Balancer using external load balancer parameter - VNet backend addresses."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/load-balancer:0.5.0\",\"name\": \"loadBalancer\"}],\"rationale\": \"This module deploys a Load Balancer.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module loadBalancer 'br/public:avm/res/network/load-balancer:0.5.0' = {\\n  name: 'loadBalancerDeployment'\\n  params: {\\n    // Required parameters\\n    frontendIPConfigurations: [\\n      {\\n        name: 'publicIPConfig1'\\n        publicIPAddressResourceId: '<publicIPAddressResourceId>'\\n      }\\n    ]\\n    name: 'nlbnet001'\\n    // Non-required parameters\\n    backendAddressPools: [\\n      {\\n        backendMembershipMode: 'BackendAddress'\\n        loadBalancerBackendAddresses: [\\n          {\\n            name: 'beAddress1'\\n            properties: {\\n              ipAddress: '10.0.0.15'\\n            }\\n          }\\n          {\\n            name: 'beAddress2'\\n            properties: {\\n              ipAddress: '10.0.0.16'\\n            }\\n          }\\n        ]\\n        name: 'backendAddressPool1'\\n        virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n      }\\n      {\\n        name: 'backendAddressPool2'\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    inboundNatRules: [\\n      {\\n        backendPort: 443\\n        enableFloatingIP: false\\n        enableTcpReset: false\\n        frontendIPConfigurationName: 'publicIPConfig1'\\n        frontendPort: 443\\n        idleTimeoutInMinutes: 4\\n        name: 'inboundNatRule1'\\n        protocol: 'Tcp'\\n      }\\n      {\\n        backendPort: 3389\\n        frontendIPConfigurationName: 'publicIPConfig1'\\n        frontendPort: 3389\\n        name: 'inboundNatRule2'\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        backendAddressPoolName: 'backendAddressPool1'\\n        backendPort: 80\\n        disableOutboundSnat: true\\n        enableFloatingIP: false\\n        enableTcpReset: false\\n        frontendIPConfigurationName: 'publicIPConfig1'\\n        frontendPort: 80\\n        idleTimeoutInMinutes: 5\\n        loadDistribution: 'Default'\\n        name: 'publicIPLBRule1'\\n        probeName: 'probe1'\\n        protocol: 'Tcp'\\n      }\\n      {\\n        backendAddressPoolName: 'backendAddressPool2'\\n        backendPort: 8080\\n        frontendIPConfigurationName: 'publicIPConfig1'\\n        frontendPort: 8080\\n        loadDistribution: 'Default'\\n        name: 'publicIPLBRule2'\\n        probeName: 'probe2'\\n      }\\n    ]\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    outboundRules: [\\n      {\\n        allocatedOutboundPorts: 63984\\n        backendAddressPoolName: 'backendAddressPool1'\\n        frontendIPConfigurationName: 'publicIPConfig1'\\n        name: 'outboundRule1'\\n      }\\n    ]\\n    probes: [\\n      {\\n        intervalInSeconds: 10\\n        name: 'probe1'\\n        numberOfProbes: 5\\n        port: 80\\n        protocol: 'Http'\\n        requestPath: '/http-probe'\\n      }\\n      {\\n        name: 'probe2'\\n        port: 443\\n        protocol: 'Https'\\n        requestPath: '/https-probe'\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Local Network Gateway using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/local-network-gateway:0.4.0\",\"name\": \"localNetworkGateway\"}],\"rationale\": \"This module deploys a Local Network Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module localNetworkGateway 'br/public:avm/res/network/local-network-gateway:0.4.0' = {\\n  name: 'localNetworkGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    localGatewayPublicIpAddress: '8.8.8.8'\\n    localNetworkAddressSpace: {\\n      addressPrefixes: [\\n        '192.168.1.0/24'\\n      ]\\n    }\\n    name: 'nlngwaf001'\\n    // Non-required parameters\\n    bgpSettings: {\\n      localAsn: 65123\\n      localBgpPeeringAddress: '192.168.1.5'\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Network Interface using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/network-interface:0.5.0\",\"name\": \"networkInterface\"}],\"rationale\": \"This module deploys a Network Interface.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module networkInterface 'br/public:avm/res/network/network-interface:0.5.0' = {\\n  name: 'networkInterfaceDeployment'\\n  params: {\\n    // Required parameters\\n    ipConfigurations: [\\n      {\\n        applicationSecurityGroups: [\\n          {\\n            id: '<id>'\\n          }\\n        ]\\n        loadBalancerBackendAddressPools: [\\n          {\\n            id: '<id>'\\n          }\\n        ]\\n        name: 'myIpconfig01'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n      {\\n        applicationSecurityGroups: [\\n          {\\n            id: '<id>'\\n          }\\n        ]\\n        publicIPAddressResourceId: '<publicIPAddressResourceId>'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n      {\\n        name: 'myIpV6Config'\\n        privateIPAddressVersion: 'IPv6'\\n        publicIPAddressResourceId: '<publicIPAddressResourceId>'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    name: 'nnimax001'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    roleAssignments: [\\n      {\\n        name: '026b830f-441f-469a-8cf3-c3ea9f5bcfe1'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Network security Group (NSG) using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/network-security-group:0.5.0\",\"name\": \"networkSecurityGroup\"}],\"rationale\": \"This module deploys a Network security Group (NSG).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module networkSecurityGroup 'br/public:avm/res/network/network-security-group:0.5.0' = {\\n  name: 'networkSecurityGroupDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nnsgwaf001'\\n    // Non-required parameters\\n    securityRules: [\\n      {\\n        name: 'deny-hop-outbound'\\n        properties: {\\n          access: 'Deny'\\n          destinationAddressPrefix: '*'\\n          destinationPortRanges: [\\n            '22'\\n            '3389'\\n          ]\\n          direction: 'Outbound'\\n          priority: 200\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          sourcePortRange: '*'\\n        }\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Hub P2S Gateway using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/p2s-vpn-gateway:0.1.0\",\"name\": \"p2sVpnGateway\"}],\"rationale\": \"This module deploys a Virtual Hub P2S Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module p2sVpnGateway 'br/public:avm/res/network/p2s-vpn-gateway:0.1.0' = {\\n  name: 'p2sVpnGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'npvgminp2sVpnGw'\\n    virtualHubResourceId: '<virtualHubResourceId>'\\n    // Non-required parameters\\n    associatedRouteTableName: 'defaultRouteTable'\\n    p2SConnectionConfigurationsName: 'p2sConnectionConfig1'\\n    vpnClientAddressPoolAddressPrefixes: [\\n      '10.0.2.0/24'\\n    ]\\n    vpnServerConfigurationResourceId: '<vpnServerConfigurationResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Private Endpoint using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/private-endpoint:0.11.0\",\"name\": \"privateEndpoint\"}],\"rationale\": \"This module deploys a Private Endpoint.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module privateEndpoint 'br/public:avm/res/network/private-endpoint:0.11.0' = {\\n  name: 'privateEndpointDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'npemax001'\\n    subnetResourceId: '<subnetResourceId>'\\n    // Non-required parameters\\n    applicationSecurityGroupResourceIds: [\\n      '<applicationSecurityGroupResourceId>'\\n    ]\\n    customDnsConfigs: [\\n      {\\n        fqdn: 'abc.keyvault.com'\\n        ipAddresses: [\\n          '10.0.0.10'\\n        ]\\n      }\\n    ]\\n    customNetworkInterfaceName: 'npemax001nic'\\n    ipConfigurations: [\\n      {\\n        name: 'myIPconfig'\\n        properties: {\\n          groupId: 'vault'\\n          memberName: 'default'\\n          privateIPAddress: '10.0.0.10'\\n        }\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    privateDnsZoneGroup: {\\n      name: 'default'\\n      privateDnsZoneGroupConfigs: [\\n        {\\n          name: 'config'\\n          privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n        }\\n      ]\\n    }\\n    privateLinkServiceConnections: [\\n      {\\n        name: 'npemax001'\\n        properties: {\\n          groupIds: [\\n            'vault'\\n          ]\\n          privateLinkServiceId: '<privateLinkServiceId>'\\n          requestMessage: 'Hey there'\\n        }\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        name: '6804f270-b4e9-455f-a11b-7f2a64e38f7c'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Public IP Address using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/public-ip-address:0.9.0\",\"name\": \"publicIpAddress\"}],\"rationale\": \"This module deploys a Public IP Address.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module publicIpAddress 'br/public:avm/res/network/public-ip-address:0.9.0' = {\\n  name: 'publicIpAddressDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'npiamax001'\\n    // Non-required parameters\\n    availabilityZones: [\\n      1\\n      2\\n      3\\n    ]\\n    ddosSettings: '<ddosSettings>'\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    dnsSettings: '<dnsSettings>'\\n    ipTags: [\\n      {\\n        ipTagType: 'RoutingPreference'\\n        tag: 'Internet'\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    publicIPAddressVersion: 'IPv4'\\n    publicIPAllocationMethod: 'Static'\\n    publicIpPrefixResourceId: '<publicIpPrefixResourceId>'\\n    roleAssignments: [\\n      {\\n        name: '902f366b-ba61-4eb6-aa3a-786d317f2dbc'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    skuName: 'Standard'\\n    skuTier: 'Regional'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a User Defined Route Table (UDR) using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/route-table:0.5.0\",\"name\": \"routeTable\"}],\"rationale\": \"This module deploys a User Defined Route Table (UDR).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module routeTable 'br/public:avm/res/network/route-table:0.5.0' = {\\n  name: 'routeTableDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nrtmax001'\\n    // Non-required parameters\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    roleAssignments: [\\n      {\\n        name: 'de4b134c-7087-480d-892f-ce6629720d29'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    routes: [\\n      {\\n        name: 'default'\\n        properties: {\\n          addressPrefix: '0.0.0.0/0'\\n          nextHopIpAddress: '172.16.0.20'\\n          nextHopType: 'VirtualAppliance'\\n        }\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Traffic Manager Profile using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/trafficmanagerprofile:0.3.0\",\"name\": \"trafficmanagerprofile\"}],\"rationale\": \"This module deploys a Traffic Manager Profile.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module trafficmanagerprofile 'br/public:avm/res/network/trafficmanagerprofile:0.3.0' = {\\n  name: 'trafficmanagerprofileDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ntmpwaf001'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    endpoints: [\\n      {\\n        name: 'webApp01Endpoint'\\n        properties: {\\n          endpointLocation: '<endpointLocation>'\\n          endpointStatus: 'Enabled'\\n          priority: 1\\n          targetResourceId: '<targetResourceId>'\\n          weight: 1\\n        }\\n        type: 'Microsoft.Network/trafficManagerProfiles/azureEndpoints'\\n      }\\n      {\\n        name: 'webApp02Endpoint'\\n        properties: {\\n          endpointLocation: '<endpointLocation>'\\n          endpointStatus: 'Enabled'\\n          priority: 2\\n          targetResourceId: '<targetResourceId>'\\n          weight: 1\\n        }\\n        type: 'Microsoft.Network/trafficManagerProfiles/azureEndpoints'\\n      }\\n    ]\\n    monitorConfig: {\\n      path: '/'\\n      port: 443\\n      protocol: 'https'\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Network (vNet) using an IPv6 address space."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/virtual-network:0.7.0\",\"name\": \"virtualNetwork\"}],\"rationale\": \"This module deploys a Virtual Network (vNet).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualNetwork 'br/public:avm/res/network/virtual-network:0.7.0' = {\\n  name: 'virtualNetworkDeployment'\\n  params: {\\n    // Required parameters\\n    addressPrefixes: [\\n      '10.0.0.0/21'\\n      'fd00:592b:3014::/64'\\n    ]\\n    name: 'nvnipv6001'\\n    // Non-required parameters\\n    location: '<location>'\\n    subnets: [\\n      {\\n        addressPrefixes: [\\n          '10.0.0.0/24'\\n          'fd00:592b:3014::/64'\\n        ]\\n        name: 'ipv6-subnet'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Network Gateway using the VPN Active Active without BGP settings configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/virtual-network-gateway:0.10.0\",\"name\": \"virtualNetworkGateway\"}],\"rationale\": \"This module deploys a Virtual Network Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualNetworkGateway 'br/public:avm/res/network/virtual-network-gateway:0.10.0' = {\\n  name: 'virtualNetworkGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    clusterSettings: {\\n      clusterMode: 'activeActiveNoBgp'\\n    }\\n    gatewayType: 'Vpn'\\n    name: 'nvgaa001'\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n    // Non-required parameters\\n    allowRemoteVnetTraffic: true\\n    disableIPSecReplayProtection: true\\n    domainNameLabel: [\\n      'dm-nvgaa'\\n    ]\\n    enableBgpRouteTranslationForNat: true\\n    enablePrivateIpAddress: true\\n    gatewayDefaultSiteLocalNetworkGatewayResourceId: '<gatewayDefaultSiteLocalNetworkGatewayResourceId>'\\n    publicIpAvailabilityZones: [\\n      1\\n      2\\n      3\\n    ]\\n    skuName: 'VpnGw2AZ'\\n    vpnGatewayGeneration: 'Generation2'\\n    vpnType: 'RouteBased'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Virtual Network Gateway using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/virtual-network-gateway:0.10.0\",\"name\": \"virtualNetworkGateway\"}],\"rationale\": \"This module deploys a Virtual Network Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module virtualNetworkGateway 'br/public:avm/res/network/virtual-network-gateway:0.10.0' = {\\n  name: 'virtualNetworkGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    clusterSettings: {\\n      clusterMode: 'activeActiveBgp'\\n      customBgpIpAddresses: [\\n        '169.254.21.4'\\n        '169.254.21.5'\\n      ]\\n      secondCustomBgpIpAddresses: [\\n        '169.254.22.4'\\n        '169.254.22.5'\\n      ]\\n      secondPipName: 'nvgmax001-pip2'\\n    }\\n    gatewayType: 'Vpn'\\n    name: 'nvgmax001'\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n    // Non-required parameters\\n    allowRemoteVnetTraffic: true\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    disableIPSecReplayProtection: true\\n    domainNameLabel: [\\n      'dm-nvgmax'\\n    ]\\n    enableBgpRouteTranslationForNat: true\\n    enablePrivateIpAddress: true\\n    gatewayDefaultSiteLocalNetworkGatewayResourceId: '<gatewayDefaultSiteLocalNetworkGatewayResourceId>'\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    natRules: [\\n      {\\n        externalMappings: [\\n          {\\n            addressSpace: '192.168.0.0/24'\\n            portRange: '100'\\n          }\\n        ]\\n        internalMappings: [\\n          {\\n            addressSpace: '10.100.0.0/24'\\n            portRange: '100'\\n          }\\n        ]\\n        mode: 'IngressSnat'\\n        name: 'nat-rule-1-static-IngressSnat'\\n        type: 'Static'\\n      }\\n      {\\n        externalMappings: [\\n          {\\n            addressSpace: '10.200.0.0/26'\\n          }\\n        ]\\n        internalMappings: [\\n          {\\n            addressSpace: '172.16.0.0/26'\\n          }\\n        ]\\n        mode: 'EgressSnat'\\n        name: 'nat-rule-2-dynamic-EgressSnat'\\n        type: 'Static'\\n      }\\n    ]\\n    publicIpAvailabilityZones: [\\n      1\\n      2\\n      3\\n    ]\\n    roleAssignments: [\\n      {\\n        name: 'db30550e-70b7-4dbe-901e-e9363b69c05f'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    skuName: 'VpnGw2AZ'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    vpnGatewayGeneration: 'Generation2'\\n    vpnType: 'RouteBased'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a VPN Gateway using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/vpn-gateway:0.2.0\",\"name\": \"vpnGateway\"}],\"rationale\": \"This module deploys a VPN Gateway.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module vpnGateway 'br/public:avm/res/network/vpn-gateway:0.2.0' = {\\n  name: 'vpnGatewayDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'vpngmin001'\\n    virtualHubResourceId: '<virtualHubResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a VPN Site using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/vpn-site:0.4.0\",\"name\": \"vpnSite\"}],\"rationale\": \"This module deploys a VPN Site.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module vpnSite 'br/public:avm/res/network/vpn-site:0.4.0' = {\\n  name: 'vpnSiteDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'nvsmin'\\n    virtualWanResourceId: '<virtualWanResourceId>'\\n    // Non-required parameters\\n    addressPrefixes: [\\n      '10.0.0.0/16'\\n    ]\\n    ipAddress: '1.2.3.4'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Operations Management Solution using only defaults."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/operations-management/solution:0.3.0\",\"name\": \"solution\"}],\"rationale\": \"This module deploys an Operations Management Solution.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module solution 'br/public:avm/res/operations-management/solution:0.3.0' = {\\n  name: 'solutionDeployment'\\n  params: {\\n    // Required parameters\\n    logAnalyticsWorkspaceName: '<logAnalyticsWorkspaceName>'\\n    name: '<name>'\\n    plan: {\\n      product: 'OMSGallery/Updates'\\n    }\\n    // Non-required parameters\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Portal Dashboard using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/portal/dashboard:0.3.0\",\"name\": \"dashboard\"}],\"rationale\": \"This module deploys a Portal Dashboard.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module dashboard 'br/public:avm/res/portal/dashboard:0.3.0' = {\\n  name: 'dashboardDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'pdwaf001'\\n    // Non-required parameters\\n    lenses: [\\n      {\\n        order: 0\\n        parts: [\\n          {\\n            metadata: {\\n              inputs: []\\n              settings: {\\n                content: {\\n                  src: 'https://www.youtube.com/watch?v=JbIMrJKW5N0'\\n                  subtitle: 'Learn more about AVM'\\n                  title: 'Azure Verified Modules (AVM) introduction'\\n                }\\n              }\\n              type: 'Extension/HubsExtension/PartType/VideoPart'\\n            }\\n            position: {\\n              colSpan: 6\\n              rowSpan: 4\\n              x: 0\\n              y: 0\\n            }\\n          }\\n          {\\n            metadata: {\\n              inputs: []\\n              type: 'Extension/Microsoft_AAD_IAM/PartType/UserManagementSummaryPart'\\n            }\\n            position: {\\n              colSpan: 2\\n              rowSpan: 2\\n              x: 6\\n              y: 0\\n            }\\n          }\\n          {\\n            metadata: {\\n              inputs: []\\n              settings: {\\n                content: {}\\n              }\\n              type: 'Extension/HubsExtension/PartType/ClockPart'\\n            }\\n            position: {\\n              colSpan: 2\\n              rowSpan: 2\\n              x: 8\\n              y: 0\\n            }\\n          }\\n          {\\n            metadata: {\\n              inputs: [\\n                {\\n                  isOptional: true\\n                  name: 'selectedMenuItemId'\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/GalleryTile'\\n            }\\n            position: {\\n              colSpan: 2\\n              rowSpan: 2\\n              x: 6\\n              y: 2\\n            }\\n          }\\n          {\\n            metadata: {\\n              inputs: []\\n              type: 'Extension/HubsExtension/PartType/HelpAndSupportPart'\\n            }\\n            position: {\\n              colSpan: 2\\n              rowSpan: 2\\n              x: 8\\n              y: 2\\n            }\\n          }\\n        ]\\n      }\\n    ]\\n    location: '<location>'\\n    metadata: {\\n      model: {\\n        filterLocale: {\\n          value: 'en-us'\\n        }\\n        filters: {\\n          value: {\\n            MsPortalFx_TimeRange: {\\n              displayCache: {\\n                name: 'UTC Time'\\n                value: 'Past 24 hours'\\n              }\\n              filteredPartIds: [\\n                'StartboardPart-MonitorChartPart-f6c2e060-fabc-4ce5-b031-45f3296510dd'\\n              ]\\n              model: {\\n                format: 'utc'\\n                granularity: 'auto'\\n                relative: '24h'\\n              }\\n            }\\n          }\\n        }\\n        timeRange: {\\n          type: 'MsPortalFx.Composition.Configuration.ValueTypes.TimeRange'\\n          value: {\\n            relative: {\\n              duration: 24\\n              timeUnit: 1\\n            }\\n          }\\n        }\\n      }\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Purview Accounts using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/purview/account:0.9.0\",\"name\": \"account\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module account 'br/public:avm/res/purview/account:0.9.0' = {\\n  name: 'accountDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'pvawaf001'\\n    // Non-required parameters\\n    accountPrivateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'account'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    eventHubPrivateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'namespace'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    location: '<location>'\\n    managedResourceGroupName: 'pvawaf001-managed-rg'\\n    portalPrivateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'portal'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    publicNetworkAccess: 'Disabled'\\n    storageBlobPrivateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'blob'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    storageQueuePrivateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'queue'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Relay Namespaces using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/relay/namespace:0.7.0\",\"name\": \"namespace\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module namespace 'br/public:avm/res/relay/namespace:0.7.0' = {\\n  name: 'namespaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'rnmax001'\\n    // Non-required parameters\\n    authorizationRules: [\\n      {\\n        name: 'RootManageSharedAccessKey'\\n        rights: [\\n          'Listen'\\n          'Manage'\\n          'Send'\\n        ]\\n      }\\n      {\\n        name: 'AnotherKey'\\n        rights: [\\n          'Listen'\\n          'Send'\\n        ]\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    hybridConnections: [\\n      {\\n        name: 'rnmaxhc001'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Reader'\\n          }\\n        ]\\n        userMetadata: '[{\\\\'key\\\\':\\\\'endpoint\\\\',\\\\'value\\\\':\\\\'db-server.constoso.com:1433\\\\'}]'\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    networkRuleSets: {\\n      defaultAction: 'Deny'\\n      ipRules: [\\n        {\\n          action: 'Allow'\\n          ipMask: '10.0.1.0/32'\\n        }\\n        {\\n          action: 'Allow'\\n          ipMask: '10.0.2.0/32'\\n        }\\n      ]\\n      trustedServiceAccessEnabled: true\\n      virtualNetworkRules: [\\n        {\\n          subnet: {\\n            id: '<id>'\\n            ignoreMissingVnetServiceEndpoint: true\\n          }\\n        }\\n      ]\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'namespace'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        name: 'd3dff05a-96d7-4d63-82c2-0fd8ac7b859d'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    skuName: 'Standard'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    wcfRelays: [\\n      {\\n        name: 'rnmaxwcf001'\\n        relayType: 'NetTcp'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Reader'\\n          }\\n        ]\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Deployment Scripts using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/resources/deployment-script:0.5.0\",\"name\": \"deploymentScript\"}],\"rationale\": \"This module deploys Deployment Scripts.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module deploymentScript 'br/public:avm/res/resources/deployment-script:0.5.0' = {\\n  name: 'deploymentScriptDeployment'\\n  params: {\\n    // Required parameters\\n    kind: 'AzureCLI'\\n    name: 'rdsmax001'\\n    // Non-required parameters\\n    arguments: '-argument1 \\\\\\\\\\\\'test\\\\\\\\\\\\''\\n    azCliVersion: '2.52.0'\\n    cleanupPreference: 'Always'\\n    containerGroupName: 'dep-cg-rdsmax'\\n    environmentVariables: [\\n      {\\n        name: 'var1'\\n        value: 'test'\\n      }\\n      {\\n        name: 'var2'\\n        secureValue: '<secureValue>'\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'None'\\n    }\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    retentionInterval: 'P1D'\\n    roleAssignments: [\\n      {\\n        name: 'd8eadbae-2c20-4e8f-9a48-4c6d739d0c4a'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    runOnce: true\\n    scriptContent: 'echo \\\\'AVM Deployment Script test!\\\\''\\n    storageAccountResourceId: '<storageAccountResourceId>'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    timeout: 'PT1H'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Resource Group using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/resources/resource-group:0.4.0\",\"name\": \"resourceGroup\"}],\"rationale\": \"This module deploys a Resource Group.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module resourceGroup 'br/public:avm/res/resources/resource-group:0.4.0' = {\\n  name: 'resourceGroupDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'avm-resources.resourcegroups-rrgwaf-rg'\\n    // Non-required parameters\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for Security Insights Data Connectors using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/security-insights/data-connector:0.1.0\",\"name\": \"dataConnector\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module dataConnector 'br/public:avm/res/security-insights/data-connector:0.1.0' = {\\n  name: 'dataConnectorDeployment'\\n  params: {\\n    // Required parameters\\n    properties: {\\n      kind: 'MicrosoftThreatIntelligence'\\n      properties: {\\n        dataTypes: {\\n          microsoftEmergingThreatFeed: {\\n            lookbackPeriod: '2025-01-01T00:00:00Z'\\n            state: 'Enabled'\\n          }\\n        }\\n        tenantId: '<tenantId>'\\n      }\\n    }\\n    workspaceResourceId: '<workspaceResourceId>'\\n    // Non-required parameters\\n    location: '<location>'\\n    name: 'MicrosoftThreatIntelligence'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Service Bus Namespace using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/service-bus/namespace:0.15.0\",\"name\": \"namespace\"}],\"rationale\": \"This module deploys a Service Bus Namespace.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module namespace 'br/public:avm/res/service-bus/namespace:0.15.0' = {\\n  name: 'namespaceDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'sbnmax001'\\n    // Non-required parameters\\n    authorizationRules: [\\n      {\\n        name: 'RootManageSharedAccessKey'\\n        rights: [\\n          'Listen'\\n          'Manage'\\n          'Send'\\n        ]\\n      }\\n      {\\n        name: 'AnotherKey'\\n        rights: [\\n          'Listen'\\n          'Send'\\n        ]\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        logCategoriesAndGroups: [\\n          {\\n            category: 'RuntimeAuditLogs'\\n          }\\n        ]\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'diagnosticsetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    disableLocalAuth: true\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    minimumTlsVersion: '1.2'\\n    networkRuleSets: {\\n      defaultAction: 'Deny'\\n      ipRules: [\\n        {\\n          action: 'Allow'\\n          ipMask: '10.0.1.0/32'\\n        }\\n        {\\n          action: 'Allow'\\n          ipMask: '10.0.2.0/32'\\n        }\\n      ]\\n      trustedServiceAccessEnabled: true\\n      virtualNetworkRules: [\\n        {\\n          ignoreMissingVnetServiceEndpoint: true\\n          subnetResourceId: '<subnetResourceId>'\\n        }\\n      ]\\n    }\\n    premiumMessagingPartitions: 1\\n    privateEndpoints: [\\n      {\\n        customDnsConfigs: [\\n          {\\n            fqdn: 'abc.namespace.com'\\n            ipAddresses: [\\n              '10.0.0.10'\\n            ]\\n          }\\n        ]\\n        ipConfigurations: [\\n          {\\n            name: 'myIPconfig'\\n            properties: {\\n              groupId: 'namespace'\\n              memberName: 'namespace'\\n              privateIPAddress: '10.0.0.10'\\n            }\\n          }\\n        ]\\n        name: 'myPrivateEndpoint'\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        privateLinkServiceConnectionName: 'customLinkName'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    publicNetworkAccess: 'Enabled'\\n    queues: [\\n      {\\n        authorizationRules: [\\n          {\\n            name: 'RootManageSharedAccessKey'\\n            rights: [\\n              'Listen'\\n              'Manage'\\n              'Send'\\n            ]\\n          }\\n          {\\n            name: 'AnotherKey'\\n            rights: [\\n              'Listen'\\n              'Send'\\n            ]\\n          }\\n        ]\\n        autoDeleteOnIdle: 'PT5M'\\n        maxMessageSizeInKilobytes: 2048\\n        name: 'sbnmaxq001'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        name: '2c42f915-20bf-4094-ba42-fee1f811d374'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    skuObject: {\\n      capacity: 16\\n      name: 'Premium'\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    topics: [\\n      {\\n        authorizationRules: [\\n          {\\n            name: 'RootManageSharedAccessKey'\\n            rights: [\\n              'Listen'\\n              'Manage'\\n              'Send'\\n            ]\\n          }\\n          {\\n            name: 'AnotherKey'\\n            rights: [\\n              'Listen'\\n              'Send'\\n            ]\\n          }\\n        ]\\n        name: 'sbnmaxt001'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Owner'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n          }\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n          }\\n        ]\\n        subscriptions: [\\n          {\\n            name: 'subscriptionwithoutrules001'\\n          }\\n          {\\n            name: 'subscriptionwithsqlfilterrule001'\\n            rules: [\\n              {\\n                action: {\\n                  compatibilityLevel: 20\\n                  requiresPreprocessing: true\\n                  sqlExpression: 'SET Foo = 1;'\\n                }\\n                filterType: 'SqlFilter'\\n                name: 'test-sql-filter'\\n                sqlFilter: {\\n                  sqlExpression: 'Test=1'\\n                }\\n              }\\n            ]\\n          }\\n          {\\n            name: 'subscriptionwithcorrelationfilterrule001'\\n            rules: [\\n              {\\n                action: {\\n                  compatibilityLevel: 20\\n                  requiresPreprocessing: true\\n                  sqlExpression: 'SET Foo = 1;'\\n                }\\n                correlationFilter: {\\n                  contentType: 'application/json'\\n                  correlationId: 'Test'\\n                  label: 'Test'\\n                  messageId: 'Test'\\n                  properties: {\\n                    barHeader: 'Bar'\\n                    fooHeader: 'Foo'\\n                  }\\n                  replyTo: 'Test'\\n                  replyToSessionId: 'Test'\\n                  sessionId: 'Test'\\n                  to: 'Test'\\n                }\\n                filterType: 'CorrelationFilter'\\n                name: 'test-correlation-filter'\\n              }\\n            ]\\n          }\\n        ]\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Application Gateway for Containers using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/service-networking/traffic-controller:0.1.0\",\"name\": \"trafficController\"}],\"rationale\": \"This module deploys an Application Gateway for Containers\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module trafficController 'br/public:avm/res/service-networking/traffic-controller:0.1.0' = {\\n  name: 'trafficControllerDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'sntcmax001'\\n    // Non-required parameters\\n    associations: [\\n      {\\n        name: 'association1'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    frontends: [\\n      {\\n        name: 'frontend1'\\n      }\\n      {\\n        name: 'frontend2'\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    roleAssignments: [\\n      {\\n        name: 'a6931c52-0b79-4fe9-ad3d-72188dfff379'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for SignalR Web PubSub Services using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/signal-r-service/web-pub-sub:0.7.0\",\"name\": \"webPubSub\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module webPubSub 'br/public:avm/res/signal-r-service/web-pub-sub:0.7.0' = {\\n  name: 'webPubSubDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'srswpswaf-001'\\n    // Non-required parameters\\n    capacity: 2\\n    clientCertEnabled: false\\n    disableAadAuth: false\\n    disableLocalAuth: true\\n    managedIdentities: {\\n      systemAssigned: true\\n    }\\n    networkAcls: {\\n      defaultAction: 'Allow'\\n      privateEndpoints: [\\n        {\\n          allow: []\\n          deny: [\\n            'ServerConnection'\\n            'Trace'\\n          ]\\n          name: 'pe-srswpswaf-001'\\n        }\\n      ]\\n      publicNetwork: {\\n        allow: []\\n        deny: [\\n          'RESTAPI'\\n          'Trace'\\n        ]\\n      }\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'webpubsub'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n    ]\\n    resourceLogConfigurationsToEnable: [\\n      'ConnectivityLogs'\\n    ]\\n    sku: 'Standard_S1'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure SQL Server with an administrator."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/sql/server:0.20.0\",\"name\": \"server\"}],\"rationale\": \"This module deploys an Azure SQL Server.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module server 'br/public:avm/res/sql/server:0.20.0' = {\\n  name: 'serverDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'sqlsadmin'\\n    // Non-required parameters\\n    administrators: {\\n      azureADOnlyAuthentication: true\\n      login: 'myspn'\\n      principalType: 'Application'\\n      sid: '<sid>'\\n    }\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure SQL Server using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/sql/server:0.20.0\",\"name\": \"server\"}],\"rationale\": \"This module deploys an Azure SQL Server.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module server 'br/public:avm/res/sql/server:0.20.0' = {\\n  name: 'serverDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'sqlsmax'\\n    // Non-required parameters\\n    administratorLogin: 'adminUserName'\\n    administratorLoginPassword: '<administratorLoginPassword>'\\n    customerManagedKey: {\\n      autoRotationEnabled: true\\n      keyName: '<keyName>'\\n      keyVaultResourceId: '<keyVaultResourceId>'\\n      keyVersion: '<keyVersion>'\\n    }\\n    databases: [\\n      {\\n        availabilityZone: -1\\n        backupLongTermRetentionPolicy: {\\n          monthlyRetention: 'P6M'\\n        }\\n        backupShortTermRetentionPolicy: {\\n          retentionDays: 14\\n        }\\n        collation: 'SQL_Latin1_General_CP1_CI_AS'\\n        customerManagedKey: {\\n          autoRotationEnabled: true\\n          keyName: '<keyName>'\\n          keyVaultResourceId: '<keyVaultResourceId>'\\n          keyVersion: '<keyVersion>'\\n        }\\n        diagnosticSettings: [\\n          {\\n            eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n            eventHubName: '<eventHubName>'\\n            name: 'customSetting'\\n            storageAccountResourceId: '<storageAccountResourceId>'\\n            workspaceResourceId: '<workspaceResourceId>'\\n          }\\n        ]\\n        elasticPoolResourceId: '<elasticPoolResourceId>'\\n        licenseType: 'LicenseIncluded'\\n        lock: {\\n          kind: 'CanNotDelete'\\n          name: 'myCustomLockName'\\n        }\\n        managedIdentities: {\\n          userAssignedResourceIds: [\\n            '<databaseIdentityResourceId>'\\n          ]\\n        }\\n        maxSizeBytes: 34359738368\\n        name: 'sqlsmaxdb-001'\\n        sku: {\\n          capacity: 0\\n          name: 'ElasticPool'\\n          tier: 'GeneralPurpose'\\n        }\\n      }\\n    ]\\n    elasticPools: [\\n      {\\n        availabilityZone: -1\\n        lock: {\\n          kind: 'CanNotDelete'\\n          name: 'myCustomLockName'\\n        }\\n        name: 'sqlsmax-ep-001'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'SQL DB Contributor'\\n          }\\n        ]\\n        sku: {\\n          capacity: 10\\n          name: 'GP_Gen5'\\n          tier: 'GeneralPurpose'\\n        }\\n      }\\n    ]\\n    firewallRules: [\\n      {\\n        endIpAddress: '0.0.0.0'\\n        name: 'AllowAllWindowsAzureIps'\\n        startIpAddress: '0.0.0.0'\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<serverIdentityResourceId>'\\n      ]\\n    }\\n    primaryUserAssignedIdentityResourceId: '<primaryUserAssignedIdentityResourceId>'\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    restrictOutboundNetworkAccess: 'Disabled'\\n    roleAssignments: [\\n      {\\n        name: '7027a5c5-d1b1-49e0-80cc-ffdff3a3ada9'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    securityAlertPolicies: [\\n      {\\n        emailAccountAdmins: true\\n        name: 'Default'\\n        state: 'Enabled'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    virtualNetworkRules: [\\n      {\\n        ignoreMissingVnetServiceEndpoint: true\\n        name: 'newVnetRule1'\\n        virtualNetworkSubnetResourceId: '<virtualNetworkSubnetResourceId>'\\n      }\\n    ]\\n    vulnerabilityAssessmentsObj: {\\n      name: 'default'\\n      recurringScans: {\\n        emails: [\\n          'test1@contoso.com'\\n          'test2@contoso.com'\\n        ]\\n        emailSubscriptionAdmins: true\\n        isEnabled: true\\n      }\\n      storageAccountResourceId: '<storageAccountResourceId>'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Storage Account using managed HSM Customer-Managed-Keys with User-Assigned identity."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/storage/storage-account:0.27.0\",\"name\": \"storageAccount\"}],\"rationale\": \"This module deploys a Storage Account.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module storageAccount 'br/public:avm/res/storage/storage-account:0.27.0' = {\\n  name: 'storageAccountDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ssauhsm001'\\n    // Non-required parameters\\n    blobServices: {\\n      containers: [\\n        {\\n          name: 'container'\\n          publicAccess: 'None'\\n        }\\n      ]\\n    }\\n    customerManagedKey: {\\n      keyName: '<keyName>'\\n      keyVaultResourceId: '<keyVaultResourceId>'\\n      userAssignedIdentityResourceId: '<userAssignedIdentityResourceId>'\\n    }\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Storage Account using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/storage/storage-account:0.27.0\",\"name\": \"storageAccount\"}],\"rationale\": \"This module deploys a Storage Account.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module storageAccount 'br/public:avm/res/storage/storage-account:0.27.0' = {\\n  name: 'storageAccountDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'ssamax001'\\n    // Non-required parameters\\n    allowBlobPublicAccess: false\\n    blobServices: {\\n      automaticSnapshotPolicyEnabled: true\\n      containerDeleteRetentionPolicyDays: 10\\n      containerDeleteRetentionPolicyEnabled: true\\n      containers: [\\n        {\\n          enableNfsV3AllSquash: true\\n          enableNfsV3RootSquash: true\\n          name: 'avdscripts'\\n          publicAccess: 'None'\\n          roleAssignments: [\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: 'Owner'\\n            }\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n            }\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n            }\\n          ]\\n        }\\n        {\\n          metadata: {\\n            testKey: 'testValue'\\n          }\\n          name: 'archivecontainer'\\n          publicAccess: 'None'\\n        }\\n      ]\\n      corsRules: [\\n        {\\n          allowedHeaders: [\\n            'x-ms-meta-data'\\n            'x-ms-meta-source-path'\\n            'x-ms-meta-target-path'\\n          ]\\n          allowedMethods: [\\n            'GET'\\n            'PUT'\\n          ]\\n          allowedOrigins: [\\n            'http://*.contoso.com'\\n            'http://www.fabrikam.com'\\n          ]\\n          exposedHeaders: [\\n            'x-ms-meta-data'\\n            'x-ms-meta-source-path'\\n            'x-ms-meta-target-path'\\n          ]\\n          maxAgeInSeconds: 200\\n        }\\n      ]\\n      deleteRetentionPolicyDays: 9\\n      deleteRetentionPolicyEnabled: true\\n      diagnosticSettings: [\\n        {\\n          eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n          eventHubName: '<eventHubName>'\\n          metricCategories: [\\n            {\\n              category: 'AllMetrics'\\n            }\\n          ]\\n          name: 'customSetting'\\n          storageAccountResourceId: '<storageAccountResourceId>'\\n          workspaceResourceId: '<workspaceResourceId>'\\n        }\\n      ]\\n      isVersioningEnabled: false\\n      lastAccessTimeTrackingPolicyEnabled: true\\n      versionDeletePolicyDays: 3\\n    }\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    enableHierarchicalNamespace: true\\n    enableNfsV3: true\\n    enableSftp: true\\n    fileServices: {\\n      corsRules: [\\n        {\\n          allowedHeaders: [\\n            'x-ms-meta-data'\\n            'x-ms-meta-source-path'\\n            'x-ms-meta-target-path'\\n          ]\\n          allowedMethods: [\\n            'GET'\\n            'PUT'\\n          ]\\n          allowedOrigins: [\\n            'http://*.contoso.com'\\n            'http://www.fabrikam.com'\\n          ]\\n          exposedHeaders: [\\n            'x-ms-meta-data'\\n            'x-ms-meta-source-path'\\n            'x-ms-meta-target-path'\\n          ]\\n          maxAgeInSeconds: 200\\n        }\\n      ]\\n      diagnosticSettings: [\\n        {\\n          eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n          eventHubName: '<eventHubName>'\\n          metricCategories: [\\n            {\\n              category: 'AllMetrics'\\n            }\\n          ]\\n          name: 'customSetting'\\n          storageAccountResourceId: '<storageAccountResourceId>'\\n          workspaceResourceId: '<workspaceResourceId>'\\n        }\\n      ]\\n      shares: [\\n        {\\n          accessTier: 'Hot'\\n          name: 'avdprofiles'\\n          roleAssignments: [\\n            {\\n              name: 'cff1213b-7877-4425-b67c-bb1de8950dfb'\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: 'Owner'\\n            }\\n            {\\n              name: '<name>'\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n            }\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n            }\\n          ]\\n          shareQuota: 5120\\n        }\\n        {\\n          name: 'avdprofiles2'\\n          shareQuota: 102400\\n        }\\n      ]\\n    }\\n    largeFileSharesState: 'Enabled'\\n    localUsers: [\\n      {\\n        hasSharedKey: false\\n        hasSshKey: true\\n        hasSshPassword: false\\n        homeDirectory: 'avdscripts'\\n        name: 'testuser'\\n        permissionScopes: [\\n          {\\n            permissions: 'r'\\n            resourceName: 'avdscripts'\\n            service: 'blob'\\n          }\\n        ]\\n      }\\n    ]\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n      notes: 'This is a custom lock note.'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    managementPolicyRules: [\\n      {\\n        definition: {\\n          actions: {\\n            baseBlob: {\\n              delete: {\\n                daysAfterModificationGreaterThan: 30\\n              }\\n              tierToCool: {\\n                daysAfterLastAccessTimeGreaterThan: 5\\n              }\\n            }\\n          }\\n          filters: {\\n            blobIndexMatch: [\\n              {\\n                name: 'BlobIndex'\\n                op: '=='\\n                value: '1'\\n              }\\n            ]\\n            blobTypes: [\\n              'blockBlob'\\n            ]\\n            prefixMatch: [\\n              'sample-container/log'\\n            ]\\n          }\\n        }\\n        enabled: true\\n        name: 'FirstRule'\\n        type: 'Lifecycle'\\n      }\\n    ]\\n    networkAcls: {\\n      bypass: 'AzureServices'\\n      defaultAction: 'Deny'\\n      ipRules: [\\n        {\\n          action: 'Allow'\\n          value: '1.1.1.1'\\n        }\\n      ]\\n      resourceAccessRules: [\\n        {\\n          resourceId: '<resourceId>'\\n          tenantId: '<tenantId>'\\n        }\\n      ]\\n      virtualNetworkRules: [\\n        {\\n          action: 'Allow'\\n          id: '<id>'\\n        }\\n      ]\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'blob'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'blob'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'table'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'queue'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'file'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'web'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'dfs'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    queueServices: {\\n      corsRules: [\\n        {\\n          allowedHeaders: [\\n            'x-ms-meta-data'\\n            'x-ms-meta-source-path'\\n            'x-ms-meta-target-path'\\n          ]\\n          allowedMethods: [\\n            'GET'\\n            'PUT'\\n          ]\\n          allowedOrigins: [\\n            'http://*.contoso.com'\\n            'http://www.fabrikam.com'\\n          ]\\n          exposedHeaders: [\\n            'x-ms-meta-data'\\n            'x-ms-meta-source-path'\\n            'x-ms-meta-target-path'\\n          ]\\n          maxAgeInSeconds: 200\\n        }\\n      ]\\n      diagnosticSettings: [\\n        {\\n          eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n          eventHubName: '<eventHubName>'\\n          metricCategories: [\\n            {\\n              category: 'AllMetrics'\\n            }\\n          ]\\n          name: 'customSetting'\\n          storageAccountResourceId: '<storageAccountResourceId>'\\n          workspaceResourceId: '<workspaceResourceId>'\\n        }\\n      ]\\n      queues: [\\n        {\\n          metadata: {\\n            key1: 'value1'\\n            key2: 'value2'\\n          }\\n          name: 'queue1'\\n          roleAssignments: [\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: 'Owner'\\n            }\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n            }\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n            }\\n          ]\\n        }\\n        {\\n          metadata: {}\\n          name: 'queue2'\\n        }\\n      ]\\n    }\\n    requireInfrastructureEncryption: true\\n    roleAssignments: [\\n      {\\n        name: '30b99723-a3d8-4e31-8872-b80c960d62bd'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    sasExpirationPeriod: '180.00:00:00'\\n    skuName: 'Standard_LRS'\\n    tableServices: {\\n      corsRules: [\\n        {\\n          allowedHeaders: [\\n            'x-ms-meta-data'\\n            'x-ms-meta-source-path'\\n            'x-ms-meta-target-path'\\n          ]\\n          allowedMethods: [\\n            'GET'\\n            'PUT'\\n          ]\\n          allowedOrigins: [\\n            'http://*.contoso.com'\\n            'http://www.fabrikam.com'\\n          ]\\n          exposedHeaders: [\\n            'x-ms-meta-data'\\n            'x-ms-meta-source-path'\\n            'x-ms-meta-target-path'\\n          ]\\n          maxAgeInSeconds: 200\\n        }\\n      ]\\n      diagnosticSettings: [\\n        {\\n          eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n          eventHubName: '<eventHubName>'\\n          metricCategories: [\\n            {\\n              category: 'AllMetrics'\\n            }\\n          ]\\n          name: 'customSetting'\\n          storageAccountResourceId: '<storageAccountResourceId>'\\n          workspaceResourceId: '<workspaceResourceId>'\\n        }\\n      ]\\n      tables: [\\n        {\\n          name: 'table1'\\n          roleAssignments: [\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: 'Owner'\\n            }\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n            }\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n            }\\n          ]\\n        }\\n        {\\n          name: 'table2'\\n          roleAssignments: [\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: 'Owner'\\n            }\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n            }\\n            {\\n              principalId: '<principalId>'\\n              principalType: 'ServicePrincipal'\\n              roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n            }\\n          ]\\n        }\\n      ]\\n    }\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an Azure Synapse Analytics (Private Link Hub) using the WAF-aligned configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/synapse/private-link-hub:0.6.0\",\"name\": \"privateLinkHub\"}],\"rationale\": \"This module deploys an Azure Synapse Analytics (Private Link Hub).\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module privateLinkHub 'br/public:avm/res/synapse/private-link-hub:0.6.0' = {\\n  name: 'privateLinkHubDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'splhwaf001'\\n    // Non-required parameters\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'Web'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Synapse Workspace using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/synapse/workspace:0.14.0\",\"name\": \"workspace\"}],\"rationale\": \"This module deploys a Synapse Workspace.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module workspace 'br/public:avm/res/synapse/workspace:0.14.0' = {\\n  name: 'workspaceDeployment'\\n  params: {\\n    // Required parameters\\n    defaultDataLakeStorageAccountResourceId: '<defaultDataLakeStorageAccountResourceId>'\\n    defaultDataLakeStorageFilesystem: '<defaultDataLakeStorageFilesystem>'\\n    name: 'swmax001'\\n    sqlAdministratorLogin: 'synwsadmin'\\n    // Non-required parameters\\n    administrator: {\\n      administratorType: 'ServicePrincipal'\\n      login: 'dep-msi-swmax'\\n      sid: '<sid>'\\n    }\\n    bigDataPools: [\\n      {\\n        autoPauseDelayInMinutes: 5\\n        autoScale: {\\n          maxNodeCount: 10\\n          minNodeCount: 3\\n        }\\n        autotuneEnabled: true\\n        cacheSize: 50\\n        defaultSparkLogFolder: '/logs'\\n        diagnosticSettings: [\\n          {\\n            eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n            eventHubName: '<eventHubName>'\\n            metricCategories: [\\n              {\\n                category: 'AllMetrics'\\n              }\\n            ]\\n            name: 'customSetting'\\n            storageAccountResourceId: '<storageAccountResourceId>'\\n            workspaceResourceId: '<workspaceResourceId>'\\n          }\\n        ]\\n        dynamicExecutorAllocation: {\\n          maxExecutors: 9\\n          minExecutors: 1\\n        }\\n        lock: {\\n          kind: 'CanNotDelete'\\n          name: 'myCustomLockName'\\n        }\\n        name: 'depbdp01'\\n        nodeSize: 'Large'\\n        nodeSizeFamily: 'MemoryOptimized'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Reader'\\n          }\\n        ]\\n        sessionLevelPackagesEnabled: true\\n        sparkConfigProperties: {\\n          configurationType: 'File'\\n          content: '<content>'\\n          filename: 'spark-defaults.conf'\\n        }\\n        sparkEventsFolder: '/events'\\n      }\\n    ]\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        logCategoriesAndGroups: [\\n          {\\n            category: 'SynapseRbacOperations'\\n          }\\n          {\\n            category: 'SynapseLinkEvent'\\n          }\\n        ]\\n        name: 'customSetting'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    initialWorkspaceAdminObjectID: '<initialWorkspaceAdminObjectID>'\\n    integrationRuntimes: [\\n      {\\n        name: 'shir01'\\n        type: 'SelfHosted'\\n      }\\n    ]\\n    location: '<location>'\\n    managedIdentities: {\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    managedVirtualNetwork: true\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'SQL'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'SQL'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'SqlOnDemand'\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        service: 'Dev'\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    roleAssignments: [\\n      {\\n        name: '499f9243-2170-4204-807d-ee6d0f94a0d0'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    sqlPools: [\\n      {\\n        collation: 'SQL_Latin1_General_CP1_CS_AS'\\n        diagnosticSettings: [\\n          {\\n            eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n            eventHubName: '<eventHubName>'\\n            metricCategories: [\\n              {\\n                category: 'AllMetrics'\\n              }\\n            ]\\n            name: 'customSetting'\\n            storageAccountResourceId: '<storageAccountResourceId>'\\n            workspaceResourceId: '<workspaceResourceId>'\\n          }\\n        ]\\n        lock: {\\n          kind: 'CanNotDelete'\\n          name: 'myCustomLockName'\\n        }\\n        maxSizeBytes: 1099511627776\\n        name: 'depsqlp01'\\n        roleAssignments: [\\n          {\\n            principalId: '<principalId>'\\n            principalType: 'ServicePrincipal'\\n            roleDefinitionIdOrName: 'Reader'\\n          }\\n        ]\\n        sku: 'DW100c'\\n        storageAccountType: 'GRS'\\n        transparentDataEncryption: 'Enabled'\\n      }\\n    ]\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for API Connections using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/web/connection:0.4.0\",\"name\": \"connection\"}],\"rationale\": \"\\u26a0\\ufe0fTHIS MODULE IS CURRENTLY ORPHANED.\\u26a0\\ufe0f\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module connection 'br/public:avm/res/web/connection:0.4.0' = {\\n  name: 'connectionDeployment'\\n  params: {\\n    // Required parameters\\n    displayName: 'azuremonitorlogs'\\n    name: 'azuremonitor'\\n    // Non-required parameters\\n    api: {\\n      id: '<id>'\\n    }\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    roleAssignments: [\\n      {\\n        name: '396667c8-de54-4dcb-916a-72af71359f34'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for an App Service Plan using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/web/serverfarm:0.5.0\",\"name\": \"serverfarm\"}],\"rationale\": \"This module deploys an App Service Plan.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module serverfarm 'br/public:avm/res/web/serverfarm:0.5.0' = {\\n  name: 'serverfarmDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'wsfmax001'\\n    // Non-required parameters\\n    diagnosticSettings: [\\n      {\\n        eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n        eventHubName: '<eventHubName>'\\n        metricCategories: [\\n          {\\n            category: 'AllMetrics'\\n          }\\n        ]\\n        name: 'customSettingwsfmax'\\n        storageAccountResourceId: '<storageAccountResourceId>'\\n        workspaceResourceId: '<workspaceResourceId>'\\n      }\\n    ]\\n    kind: 'app'\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'lock'\\n    }\\n    perSiteScaling: true\\n    roleAssignments: [\\n      {\\n        name: '97fc1da9-bfe4-409d-b17a-da9a82fad0d0'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    skuCapacity: 3\\n    skuName: 'P1v3'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    zoneRedundant: true\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Web or Function App using the Web App with Azure Storage Accounts Configuration configuration."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/web/site:0.19.0\",\"name\": \"site\"}],\"rationale\": \"This module deploys a Web or Function App.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module site 'br/public:avm/res/web/site:0.19.0' = {\\n  name: 'siteDeployment'\\n  params: {\\n    // Required parameters\\n    kind: 'app'\\n    name: 'wsazstor001'\\n    serverFarmResourceId: '<serverFarmResourceId>'\\n    // Non-required parameters\\n    configs: [\\n      {\\n        name: 'azurestorageaccounts'\\n        properties: {\\n          'config-storage': {\\n            accessKey: '<accessKey>'\\n            accountName: '<accountName>'\\n            mountPath: '\\\\\\\\mounts\\\\\\\\config'\\n            protocol: 'Smb'\\n            shareName: 'config-share'\\n            type: 'AzureFiles'\\n          }\\n          'data-storage': {\\n            accessKey: '<accessKey>'\\n            accountName: '<accountName>'\\n            mountPath: '\\\\\\\\mounts\\\\\\\\data'\\n            protocol: 'Smb'\\n            shareName: 'data-share'\\n            type: 'AzureFiles'\\n          }\\n          'logs-storage': {\\n            accessKey: '<accessKey>'\\n            accountName: '<accountName>'\\n            mountPath: '\\\\\\\\mounts\\\\\\\\logs'\\n            protocol: 'Smb'\\n            shareName: 'logs-share'\\n            type: 'AzureFiles'\\n          }\\n        }\\n      }\\n      {\\n        name: 'appsettings'\\n        properties: {\\n          STORAGE_CONFIG_MOUNT: '\\\\\\\\mounts\\\\\\\\config'\\n          STORAGE_DATA_MOUNT: '\\\\\\\\mounts\\\\\\\\data'\\n          STORAGE_LOGS_MOUNT: '\\\\\\\\mounts\\\\\\\\logs'\\n        }\\n      }\\n    ]\\n    location: '<location>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user","content": "Generate a Bicep template for a Static Web App using large parameter set."},{"role": "assistant","content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/web/static-site:0.9.0\",\"name\": \"staticSite\"}],\"rationale\": \"This module deploys a Static Web App.\"},\"files\": [{\"path\": \"main.bicep\",\"language\": \"bicep\",\"content\": \"module staticSite 'br/public:avm/res/web/static-site:0.9.0' = {\\n  name: 'staticSiteDeployment'\\n  params: {\\n    // Required parameters\\n    name: 'wssmax001'\\n    // Non-required parameters\\n    allowConfigFileUpdates: true\\n    appSettings: {\\n      foo: 'bar'\\n      setting: 1\\n    }\\n    enterpriseGradeCdnStatus: 'Disabled'\\n    functionAppSettings: {\\n      foo: 'bar'\\n      setting: 1\\n    }\\n    linkedBackend: {\\n      resourceId: '<resourceId>'\\n    }\\n    location: '<location>'\\n    lock: {\\n      kind: 'CanNotDelete'\\n      name: 'myCustomLockName'\\n    }\\n    managedIdentities: {\\n      systemAssigned: true\\n      userAssignedResourceIds: [\\n        '<managedIdentityResourceId>'\\n      ]\\n    }\\n    privateEndpoints: [\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n        tags: {\\n          Environment: 'Non-Prod'\\n          'hidden-title': 'This is visible in the resource name'\\n          Role: 'DeploymentValidation'\\n        }\\n      }\\n      {\\n        privateDnsZoneGroup: {\\n          privateDnsZoneGroupConfigs: [\\n            {\\n              privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n            }\\n          ]\\n        }\\n        subnetResourceId: '<subnetResourceId>'\\n      }\\n    ]\\n    publicNetworkAccess: 'Enabled'\\n    roleAssignments: [\\n      {\\n        name: 'ba1328f0-c7ab-47bf-afbf-0637b9c02bbe'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'Owner'\\n      }\\n      {\\n        name: '<name>'\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n      }\\n      {\\n        principalId: '<principalId>'\\n        principalType: 'ServicePrincipal'\\n        roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n      }\\n    ]\\n    sku: 'Standard'\\n    stagingEnvironmentPolicy: 'Enabled'\\n    tags: {\\n      Environment: 'Non-Prod'\\n      'hidden-title': 'This is visible in the resource name'\\n      Role: 'DeploymentValidation'\\n    }\\n    virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n  }\\n}\"}],\"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Static Web App: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/web/static-site:0.9.0\", \"name\": \"staticSite\"}], \"rationale\": \"AVM module for web.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module staticSite 'br/public:avm/res/web/static-site:0.9.0' = {\\n name: 'staticSiteDeployment'\\n params: {\\n // Required parameters\\n name: 'wsswaf001'\\n // Non-required parameters\\n allowConfigFileUpdates: true\\n appSettings: {\\n foo: 'bar'\\n setting: 1\\n }\\n enterpriseGradeCdnStatus: 'Disabled'\\n functionAppSettings: {\\n foo: 'bar'\\n setting: 1\\n }\\n linkedBackend: {\\n resourceId: '<resourceId>'\\n }\\n privateEndpoints: [\\n {\\n privateDnsZoneGroup: {\\n privateDnsZoneGroupConfigs: [\\n {\\n privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n }\\n ]\\n }\\n subnetResourceId: '<subnetResourceId>'\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n }\\n ]\\n sku: 'Standard'\\n stagingEnvironmentPolicy: 'Enabled'\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n virtualNetworkResourceId: '<virtualNetworkResourceId>'\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy an Azure SQL Server: With an administrator"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"administrators: {\\n azureADOnlyAuthentication: true\\n login: 'John Doe' // if application can be anything\\n sid: '[[objectId]]' // if application the object ID\\n 'principalType' : 'User' // options: 'User' 'Group' 'Application'\\n tenantId: '[[tenantId]]'\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Security Insights Setting: Using defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/security-insights/setting:0.1.0\", \"name\": \"setting\"}], \"rationale\": \"AVM module for security-insights.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module setting 'br/public:avm/res/security-insights/setting:0.1.0' = {\\n name: 'settingDeployment'\\n params: {\\n // Required parameters\\n name: 'Anomalies'\\n settingsType: 'Anomalies'\\n workspaceResourceId: '<workspaceResourceId>'\\n // Non-required parameters\\n properties: {}\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy an Operations Management Solution: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/operations-management/solution:0.3.0\", \"name\": \"solution\"}], \"rationale\": \"AVM module for operations-management.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module solution 'br/public:avm/res/operations-management/solution:0.3.0' = {\\n name: 'solutionDeployment'\\n params: {\\n // Required parameters\\n logAnalyticsWorkspaceName: '<logAnalyticsWorkspaceName>'\\n name: '<name>'\\n plan: {\\n name: '<name>'\\n product: 'OMSGallery/AzureAutomation'\\n publisher: 'Microsoft'\\n }\\n // Non-required parameters\\n location: '<location>'\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Virtual Network Gateway Connection: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"customIPSecPolicy: {\\n saLifeTimeSeconds: 28800\\n saDataSizeKilobytes: 102400000\\n ipsecEncryption: 'AES256'\\n ipsecIntegrity: 'SHA256'\\n ikeEncryption: 'AES256'\\n ikeIntegrity: 'SHA256'\\n dhGroup: 'DHGroup14'\\n pfsGroup: 'None'\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy an Express Route Port resource used by Express Route Direct: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/express-route-port:0.3.0\", \"name\": \"expressRoutePort\"}], \"rationale\": \"AVM module for network.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module expressRoutePort 'br/public:avm/res/network/express-route-port:0.3.0' = {\\n name: 'expressRoutePortDeployment'\\n params: {\\n // Required parameters\\n bandwidthInGbps: 10\\n name: 'nerpwaf001'\\n peeringLocation: 'Airtel-Chennai2-CLS'\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a NAT Gateway: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/nat-gateway:2.0.0\", \"name\": \"natGateway\"}], \"rationale\": \"AVM module for network.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module natGateway 'br/public:avm/res/network/nat-gateway:2.0.0' = {\\n name: 'natGatewayDeployment'\\n params: {\\n // Required parameters\\n availabilityZone: 1\\n name: 'nngwaf001'\\n // Non-required parameters\\n publicIPAddresses: [\\n {\\n availabilityZones: [\\n 1\\n 2\\n 3\\n ]\\n diagnosticSettings: [\\n {\\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n eventHubName: '<eventHubName>'\\n metricCategories: [\\n {\\n category: 'AllMetrics'\\n }\\n ]\\n name: 'customSetting'\\n storageAccountResourceId: '<storageAccountResourceId>'\\n workspaceResourceId: '<workspaceResourceId>'\\n }\\n ]\\n name: 'nngwaf001-pip'\\n skuTier: 'Regional'\\n }\\n ]\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Private DNS zone: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/private-dns-zone:0.8.0\", \"name\": \"privateDnsZone\"}], \"rationale\": \"AVM module for network.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module privateDnsZone 'br/public:avm/res/network/private-dns-zone:0.8.0' = {\\n name: 'privateDnsZoneDeployment'\\n params: {\\n // Required parameters\\n name: 'npdzwaf001.com'\\n // Non-required parameters\\n location: 'global'\\n lock: {\\n kind: 'CanNotDelete'\\n name: 'myCustomLockName'\\n }\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Traffic Manager Profile: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/network/trafficmanagerprofile:0.3.0\", \"name\": \"trafficmanagerprofile\"}], \"rationale\": \"AVM module for network.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module trafficmanagerprofile 'br/public:avm/res/network/trafficmanagerprofile:0.3.0' = {\\n name: 'trafficmanagerprofileDeployment'\\n params: {\\n // Required parameters\\n name: 'ntmpwaf001'\\n // Non-required parameters\\n diagnosticSettings: [\\n {\\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n eventHubName: '<eventHubName>'\\n metricCategories: [\\n {\\n category: 'AllMetrics'\\n }\\n ]\\n name: 'customSetting'\\n storageAccountResourceId: '<storageAccountResourceId>'\\n workspaceResourceId: '<workspaceResourceId>'\\n }\\n ]\\n endpoints: [\\n {\\n name: 'webApp01Endpoint'\\n properties: {\\n endpointLocation: '<endpointLocation>'\\n endpointStatus: 'Enabled'\\n priority: 1\\n targetResourceId: '<targetResourceId>'\\n weight: 1\\n }\\n type: 'Microsoft.Network/trafficManagerProfiles/azureEndpoints'\\n }\\n {\\n name: 'webApp02Endpoint'\\n properties: {\\n endpointLocation: '<endpointLocation>'\\n endpointStatus: 'Enabled'\\n priority: 2\\n targetResourceId: '<targetResourceId>'\\n weight: 1\\n }\\n type: 'Microsoft.Network/trafficManagerProfiles/azureEndpoints'\\n }\\n ]\\n monitorConfig: {\\n path: '/'\\n port: 443\\n protocol: 'https'\\n }\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a VPN Site: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"deviceProperties: {\\n deviceModel: 'morty'\\n deviceVendor: 'contoso'\\n linkSpeedInMbps: 0\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Maintenance Configuration Assignment: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/maintenance/configuration-assignment:0.2.0\", \"name\": \"configurationAssignment\"}], \"rationale\": \"AVM module for maintenance.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module configurationAssignment 'br/public:avm/res/maintenance/configuration-assignment:0.2.0' = {\\n name: 'configurationAssignmentDeployment'\\n params: {\\n // Required parameters\\n maintenanceConfigurationResourceId: '<maintenanceConfigurationResourceId>'\\n name: 'mcamrg001'\\n // Non-required parameters\\n resourceId: '<resourceId>'\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Kubernetes Runtime Load Balancer for MetalLB and related networking services: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/kubernetes-runtime/load-balancer:0.1.0\", \"name\": \"loadBalancer\"}], \"rationale\": \"AVM module for kubernetes-runtime.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module loadBalancer 'br/public:avm/res/kubernetes-runtime/load-balancer:0.1.0' = {\\n name: 'loadBalancerDeployment'\\n params: {\\n // Required parameters\\n addresses: [\\n '10.0.0.100-10.0.0.110'\\n ]\\n advertiseMode: 'Both'\\n clusterName: '<clusterName>'\\n kubernetesRuntimeRPObjectId: '<kubernetesRuntimeRPObjectId>'\\n name: 'krlbwaf001'\\n // Non-required parameters\\n bgpPeers: [\\n 'test-peer'\\n ]\\n serviceSelector: {\\n test: 'waf-test'\\n }\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy an Application Insights instance: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/insights/component:0.6.0\", \"name\": \"component\"}], \"rationale\": \"AVM module for insights.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module component 'br/public:avm/res/insights/component:0.6.0' = {\\n name: 'componentDeployment'\\n params: {\\n // Required parameters\\n name: 'icwaf001'\\n workspaceResourceId: '<workspaceResourceId>'\\n // Non-required parameters\\n diagnosticSettings: [\\n {\\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n eventHubName: '<eventHubName>'\\n metricCategories: [\\n {\\n category: 'AllMetrics'\\n }\\n ]\\n name: 'customSetting'\\n storageAccountResourceId: '<storageAccountResourceId>'\\n workspaceResourceId: '<workspaceResourceId>'\\n }\\n ]\\n location: '<location>'\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Azure Arc Gateway: Azure Arc Gateway using only the defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/hybrid-compute/gateway:0.1.0\", \"name\": \"gateway\"}], \"rationale\": \"AVM module for hybrid-compute.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module gateway 'br/public:avm/res/hybrid-compute/gateway:0.1.0' = {\\n name: 'gatewayDeployment'\\n params: {\\n name: 'hcgwaf001'\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy an Event Grid Domain: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/event-grid/domain:0.8.0\", \"name\": \"domain\"}], \"rationale\": \"AVM module for event-grid.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module domain 'br/public:avm/res/event-grid/domain:0.8.0' = {\\n name: 'domainDeployment'\\n params: {\\n // Required parameters\\n name: 'egdwaf001'\\n // Non-required parameters\\n diagnosticSettings: [\\n {\\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n eventHubName: '<eventHubName>'\\n metricCategories: [\\n {\\n category: 'AllMetrics'\\n }\\n ]\\n name: 'customSetting'\\n storageAccountResourceId: '<storageAccountResourceId>'\\n workspaceResourceId: '<workspaceResourceId>'\\n }\\n ]\\n inboundIpRules: []\\n location: '<location>'\\n lock: {\\n kind: 'CanNotDelete'\\n name: 'myCustomLockName'\\n }\\n minimumTlsVersionAllowed: '1.2'\\n privateEndpoints: [\\n {\\n privateDnsZoneGroup: {\\n privateDnsZoneGroupConfigs: [\\n {\\n privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n }\\n ]\\n }\\n service: 'domain'\\n subnetResourceId: '<subnetResourceId>'\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n }\\n ]\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n topics: [\\n 'topic-egdwaf001'\\n ]\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy an Azure Digital Twins Instance: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/digital-twins/digital-twins-instance:0.4.0\", \"name\": \"digitalTwinsInstance\"}], \"rationale\": \"AVM module for digital-twins.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module digitalTwinsInstance 'br/public:avm/res/digital-twins/digital-twins-instance:0.4.0' = {\\n name: 'digitalTwinsInstanceDeployment'\\n params: {\\n // Required parameters\\n name: 'dtdiwaf001'\\n // Non-required parameters\\n diagnosticSettings: [\\n {\\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n eventHubName: '<eventHubName>'\\n storageAccountResourceId: '<storageAccountResourceId>'\\n workspaceResourceId: '<workspaceResourceId>'\\n }\\n ]\\n privateEndpoints: [\\n {\\n privateDnsZoneGroup: {\\n privateDnsZoneGroupConfigs: [\\n {\\n privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n }\\n ]\\n }\\n subnetResourceId: '<subnetResourceId>'\\n }\\n {\\n privateDnsZoneGroup: {\\n privateDnsZoneGroupConfigs: [\\n {\\n privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\\n }\\n ]\\n }\\n subnetResourceId: '<subnetResourceId>'\\n }\\n ]\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy the module with the minimum set of required parameters: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/desktop-virtualization/host-pool:0.8.0\", \"name\": \"hostPool\"}], \"rationale\": \"AVM module for desktop-virtualization.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module hostPool 'br/public:avm/res/desktop-virtualization/host-pool:0.8.0' = {\\n name: 'hostPoolDeployment'\\n params: {\\n // Required parameters\\n name: 'dvhpwaf002'\\n // Non-required parameters\\n diagnosticSettings: [\\n {\\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n eventHubName: '<eventHubName>'\\n storageAccountResourceId: '<storageAccountResourceId>'\\n workspaceResourceId: '<workspaceResourceId>'\\n }\\n ]\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Data Protection Backup Vault: Using Customer-Managed-Keys with User-Assigned identity"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"backupPolicies: [\\n {\\n name: 'DefaultPolicy'\\n properties: {\\n policyRules: [\\n {\\n backupParameters: {\\n backupType: 'Incremental'\\n objectType: 'AzureBackupParams'\\n }\\n trigger: {\\n schedule: {\\n repeatingTimeIntervals: [\\n 'R/2022-05-31T23:30:00+01:00/P1D'\\n ]\\n timeZone: 'W. Europe Standard Time'\\n }\\n taggingCriteria: [\\n {\\n tagInfo: {\\n tagName: 'Default'\\n id: 'Default_'\\n }\\n taggingPriority: 99\\n isDefault: true\\n }\\n ]\\n objectType: 'ScheduleBasedTriggerContext'\\n }\\n dataStore: {\\n dataStoreType: 'OperationalStore'\\n objectType: 'DataStoreInfoBase'\\n }\\n name: 'BackupDaily'\\n objectType: 'AzureBackupRule'\\n }\\n {\\n lifecycles: [\\n {\\n deleteAfter: {\\n objectType: 'AbsoluteDeleteOption'\\n duration: 'P7D'\\n }\\n targetDataStoreCopySettings: []\\n sourceDataStore: {\\n dataStoreType: 'OperationalStore'\\n objectType: 'DataStoreInfoBase'\\n }\\n }\\n ]\\n isDefault: true\\n name: 'Default'\\n objectType: 'AzureRetentionRule'\\n }\\n ]\\n datasourceTypes: [\\n 'Microsoft.Compute/disks'\\n ]\\n objectType: 'BackupPolicy'\\n }\\n }\\n]\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Consumption Budget for a Subscription: Using only defaults (Subscription scope)"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/consumption/budget/sub-scope:0.1.0\", \"name\": \"budget\"}], \"rationale\": \"AVM module for consumption.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module budget 'br/public:avm/res/consumption/budget/sub-scope:0.1.0' = {\\n name: 'budgetDeployment'\\n params: {\\n // Required parameters\\n amount: 500\\n name: 'rcbsubwaf001'\\n // Non-required parameters\\n contactEmails: [\\n 'dummy@contoso.com'\\n ]\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Virtual Machine with one or multiple NICs and optionally one or multiple public IPs: Using automanage for the VM."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"extensionCustomScriptProtectedSetting: [\\n {\\n commandToExecute: 'powershell -ExecutionPolicy Unrestricted -File testscript.ps1'\\n }\\n]\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy an Azure Kubernetes Service (AKS) cluster with a system agent pool as well as an additional user agent pool: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/azd/aks:0.2.0\", \"name\": \"aks\"}], \"rationale\": \"AVM pattern module for azd.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module aks 'br/public:avm/ptn/azd/aks:0.2.0' = {\\n name: 'aksDeployment'\\n params: {\\n // Required parameters\\n containerRegistryName: '<containerRegistryName>'\\n keyVaultName: '<keyVaultName>'\\n monitoringWorkspaceResourceId: '<monitoringWorkspaceResourceId>'\\n name: '<name>'\\n principalId: '<principalId>'\\n // Non-required parameters\\n aadProfile: '<aadProfile>'\\n acrSku: 'Basic'\\n agentPoolConfig: [\\n {\\n maxPods: 30\\n maxSurge: '33%'\\n mode: 'User'\\n name: 'npuserpool'\\n osType: 'Linux'\\n type: 'VirtualMachineScaleSets'\\n vmSize: 'Standard_DS2_v2'\\n }\\n ]\\n agentPoolSize: 'Standard'\\n aksClusterRoleAssignmentName: '<aksClusterRoleAssignmentName>'\\n containerRegistryRoleName: '<containerRegistryRoleName>'\\n disableLocalAccounts: false\\n dnsPrefix: 'dep-dns-paamax'\\n location: '<location>'\\n principalType: 'ServicePrincipal'\\n skuTier: 'Free'\\n systemPoolConfig: [\\n {\\n availabilityZones: [\\n 1\\n 2\\n 3\\n ]\\n count: 3\\n enableAutoScaling: true\\n maxCount: 5\\n minCount: 3\\n mode: 'System'\\n name: 'npsystem'\\n vmSize: 'Standard_DS2_v2'\\n }\\n ]\\n webApplicationRoutingEnabled: true\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a PIM Role Assignment at a Management Group, Subscription or Resource Group scope: PIM Eligible Role Assignments (Management Group scope)"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/authorization/pim-role-assignment:0.1.0\", \"name\": \"pimRoleAssignment\"}], \"rationale\": \"AVM pattern module for authorization.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module pimRoleAssignment 'br/public:avm/ptn/authorization/pim-role-assignment:0.1.0' = {\\n name: 'pimRoleAssignmentDeployment'\\n params: {\\n // Required parameters\\n pimRoleAssignmentType: {\\n roleAssignmentType: 'Active'\\n scheduleInfo: {\\n durationType: 'NoExpiration'\\n }\\n }\\n principalId: '<principalId>'\\n requestType: 'AdminAssign'\\n roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\\n // Non-required parameters\\n justification: 'AVM test'\\n subscriptionId: '<subscriptionId>'\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a container to run as a job: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/app/container-job-toolkit:0.1.0\", \"name\": \"containerJobToolkit\"}], \"rationale\": \"AVM pattern module for app.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module containerJobToolkit 'br/public:avm/ptn/app/container-job-toolkit:0.1.0' = {\\n name: 'containerJobToolkitDeployment'\\n params: {\\n // Required parameters\\n containerImageSource: 'mcr.microsoft.com/k8se/quickstart-jobs:latest'\\n name: 'acjwaf001'\\n // Non-required parameters\\n appInsightsConnectionString: '<appInsightsConnectionString>'\\n deployInVnet: true\\n location: '<location>'\\n logAnalyticsWorkspaceResourceId: '<logAnalyticsWorkspaceResourceId>'\\n managedIdentityResourceId: '<managedIdentityResourceId>'\\n overwriteExistingImage: true\\n tags: {\\n Env: 'test'\\n 'hidden-title': 'This is visible in the resource name'\\n }\\n workloadProfileName: 'CAW01'\\n workloadProfiles: [\\n {\\n maximumCount: 6\\n minimumCount: 3\\n name: 'CAW01'\\n workloadProfileType: 'D4'\\n }\\n ]\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for a non-AVM solution. Can you show me how to deploy an Active Directory domain controller with proper DNS configuration?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the administrator account of the new VM and domain')\\nparam adminUsername string\\n\\n@description('The password for the administrator account of the new VM and domain')\\n@secure()\\nparam adminPassword string\\n\\n@description('The FQDN of the Active Directory Domain to be created')\\nparam domainName string\\n\\n@description('The DNS prefix for the public IP address used by the Load Balancer')\\nparam dnsPrefix string\\n\\n@description('Size of the VM for the controller')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('The location of resources, such as templates and DSC modules, that the template depends on')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('Auto-generated token to access _artifactsLocation. Leave it blank unless you need to provide your own value.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Virtual machine name.')\\n@maxLength(15)\\nparam virtualMachineName string = 'adVM'\\n\\n@description('Virtual network name.')\\nparam virtualNetworkName string = 'adVNET'\\n\\n@description('Virtual network address range.')\\nparam virtualNetworkAddressRange string = '10.0.0.0/16'\\n\\n@description('Load balancer front end IP address name.')\\nparam loadBalancerFrontEndIPName string = 'LBFE'\\n\\n@description('Backend address pool name.')\\nparam backendAddressPoolName string = 'LBBE'\\n\\n@description('Inbound NAT rules name.')\\nparam inboundNatRulesName string = 'adRDP'\\n\\n@description('Network interface name.')\\nparam networkInterfaceName string = 'adNic'\\n\\n@description('Private IP address.')\\nparam privateIPAddress string = '10.0.0.4'\\n\\n@description('Subnet name.')\\nparam subnetName string = 'adSubnet'\\n\\n@description('Subnet IP range.')\\nparam subnetRange string = '10.0.0.0/24'\\n\\n@description('Subnet IP range.')\\nparam publicIPAddressName string = 'adPublicIP'\\n\\n@description('Availability set name.')\\nparam availabilitySetName string = 'adAvailabiltySet'\\n\\n@description('Load balancer name.')\\nparam loadBalancerName string = 'adLoadBalancer'\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2022-07-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n    dnsSettings: {\\n      domainNameLabel: dnsPrefix\\n    }\\n  }\\n}\\n\\nresource availabilitySet 'Microsoft.Compute/availabilitySets@2022-08-01' = {\\n  name: availabilitySetName\\n  location: location\\n  properties: {\\n    platformUpdateDomainCount: 20\\n    platformFaultDomainCount: 2\\n  }\\n  sku: {\\n    name: 'Aligned'\\n  }\\n}\\n\\nresource loadBalancer 'Microsoft.Network/loadBalancers@2022-07-01' = {\\n  name: loadBalancerName\\n  location: location\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: loadBalancerFrontEndIPName\\n        properties: {\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: backendAddressPoolName\\n      }\\n    ]\\n    inboundNatRules: [\\n      {\\n        name: inboundNatRulesName\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIPConfigurations',\\n              loadBalancerName,\\n              loadBalancerFrontEndIPName\\n            )\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 3389\\n          backendPort: 3389\\n          enableFloatingIP: false\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource networkInterface 'Microsoft.Network/networkInterfaces@2022-07-01' = {\\n  name: networkInterfaceName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Static'\\n          privateIPAddress: privateIPAddress\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\n          }\\n          loadBalancerBackendAddressPools: [\\n            {\\n              id: resourceId(\\n                'Microsoft.Network/loadBalancers/backendAddressPools',\\n                loadBalancerName,\\n                backendAddressPoolName\\n              )\\n            }\\n          ]\\n          loadBalancerInboundNatRules: [\\n            {\\n              id: resourceId('Microsoft.Network/loadBalancers/inboundNatRules', loadBalancerName, inboundNatRulesName)\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    loadBalancer\\n    VNet\\n  ]\\n}\\n\\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2022-08-01' = {\\n  name: virtualMachineName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    availabilitySet: {\\n      id: availabilitySet.id\\n    }\\n    osProfile: {\\n      computerName: virtualMachineName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: 'MicrosoftWindowsServer'\\n        offer: 'WindowsServer'\\n        sku: '2019-Datacenter'\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${virtualMachineName}_OSDisk'\\n        caching: 'ReadOnly'\\n        createOption: 'FromImage'\\n        managedDisk: {\\n          storageAccountType: 'StandardSSD_LRS'\\n        }\\n      }\\n      dataDisks: [\\n        {\\n          name: '${virtualMachineName}_DataDisk'\\n          caching: 'ReadWrite'\\n          createOption: 'Empty'\\n          diskSizeGB: 20\\n          managedDisk: {\\n            storageAccountType: 'StandardSSD_LRS'\\n          }\\n          lun: 0\\n        }\\n      ]\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: networkInterface.id\\n        }\\n      ]\\n    }\\n  }\\n  dependsOn: [\\n    loadBalancer\\n  ]\\n}\\n\\nresource virtualMachineName_CreateADForest 'Microsoft.Compute/virtualMachines/extensions@2022-08-01' = {\\n  parent: virtualMachine\\n  name: 'CreateADForest'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Powershell'\\n    type: 'DSC'\\n    typeHandlerVersion: '2.19'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      ModulesUrl: uri(_artifactsLocation, 'DSC/CreateADPDC.zip${_artifactsLocationSasToken}')\\n      ConfigurationFunction: 'CreateADPDC.ps1\\\\\\\\CreateADPDC'\\n      Properties: {\\n        DomainName: domainName\\n        AdminCreds: {\\n          UserName: adminUsername\\n          Password: 'PrivateSettingsRef:AdminPassword'\\n        }\\n      }\\n    }\\n    protectedSettings: {\\n      Items: {\\n        AdminPassword: adminPassword\\n      }\\n    }\\n  }\\n}\\n\\nmodule VNet './nested_VNet.bicep' = {\\n  name: 'VNet'\\n  params: {\\n    virtualNetworkName: virtualNetworkName\\n    virtualNetworkAddressRange: virtualNetworkAddressRange\\n    subnetName: subnetName\\n    subnetRange: subnetRange\\n    location: location\\n  }\\n}\\n\\nmodule UpdateVNetDNS './nested_UpdateVNetDNS.bicep' = {\\n  name: 'UpdateVNetDNS'\\n  params: {\\n    virtualNetworkName: virtualNetworkName\\n    virtualNetworkAddressRange: virtualNetworkAddressRange\\n    subnetName: subnetName\\n    subnetRange: subnetRange\\n    DNSServerAddress: [\\n      privateIPAddress\\n    ]\\n    location: location\\n  }\\n  dependsOn: [\\n    virtualMachineName_CreateADForest\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"domainName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"virtualMachineName\\\": {\\n      \\\"value\\\": \\\"adVM\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"adVNET\\\"\\n    },\\n    \\\"virtualNetworkAddressRange\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"loadBalancerFrontEndIPName\\\": {\\n      \\\"value\\\": \\\"LBFE\\\"\\n    },\\n    \\\"backendAddressPoolName\\\": {\\n      \\\"value\\\": \\\"LBBE\\\"\\n    },\\n    \\\"inboundNatRulesName\\\": {\\n      \\\"value\\\": \\\"adRDP\\\"\\n    },\\n    \\\"networkInterfaceName\\\": {\\n      \\\"value\\\": \\\"adNic\\\"\\n    },\\n    \\\"privateIPAddress\\\": {\\n      \\\"value\\\": \\\"10.0.0.4\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"adSubnet\\\"\\n    },\\n    \\\"subnetRange\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/24\\\"\\n    },\\n    \\\"publicIPAddressName\\\": {\\n      \\\"value\\\": \\\"adPublicIP\\\"\\n    },\\n    \\\"availabilitySetName\\\": {\\n      \\\"value\\\": \\\"adAvailabiltySet\\\"\\n    },\\n    \\\"loadBalancerName\\\": {\\n      \\\"value\\\": \\\"adLoadBalancer\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep template for non-AVM networking? I need the traditional approach without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the Administrator of the new VM and Domain')\\nparam adminUsername string\\n\\n@description('Location for the VM, only certain regions support zones during preview.')\\n@allowed([\\n  'centralus'\\n  'eastus'\\n  'eastus2'\\n  'francecentral'\\n  'northeurope'\\n  'southeastasia'\\n  'ukwest'\\n  'westus2'\\n  'westeurope'\\n])\\nparam location string\\n\\n@description('The password for the Administrator account of the new VM and Domain')\\n@secure()\\nparam adminPassword string\\n\\n@description('The FQDN of the AD Domain created ')\\nparam domainName string = 'contoso.local'\\n\\n@description('The DNS prefix for the public IP address used by the Load Balancer')\\nparam dnsPrefix string\\n\\n@description('Size of the VM for the controller')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('The location of resources such as templates and DSC modules that the script is dependent')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('Auto-generated token to access _artifactsLocation')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar imagePublisher = 'MicrosoftWindowsServer'\\nvar imageOffer = 'WindowsServer'\\nvar imageSKU = '2019-Datacenter'\\nvar virtualNetworkName = 'adVNET'\\nvar virtualNetworkAddressRange = '10.0.0.0/16'\\nvar adSubnetName = 'adSubnet'\\nvar adSubnet = '10.0.0.0/24'\\nvar adSubnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, adSubnetName)\\nvar publicIPSKU = 'Standard'\\nvar publicIPAddressName = 'adPublicIp'\\nvar publicIPAddressType = 'Static'\\nvar publicIpAddressId = {\\n  id: publicIPAddress.id\\n}\\nvar vnetTemplateUri = uri(_artifactsLocation, 'nestedtemplates/vnet.json${_artifactsLocationSasToken}')\\nvar nicTemplateUri = uri(_artifactsLocation, 'nestedtemplates/nic.json${_artifactsLocationSasToken}')\\nvar vmName = [\\n  'adPDC'\\n  'adBDC'\\n]\\nvar nicName = [\\n  'adPDCNic'\\n  'adBDCNic'\\n]\\nvar ipAddress = [\\n  '10.0.0.4'\\n  '10.0.0.5'\\n]\\nvar configureADBDCTemplateUri = uri(\\n  _artifactsLocation,\\n  'nestedtemplates/configureADBDC.json${_artifactsLocationSasToken}'\\n)\\nvar adBDCConfigurationModulesURL = uri(_artifactsLocation, 'DSC/ConfigureADBDC.ps1.zip')\\nvar adBDCConfigurationScript = 'ConfigureADBDC.ps1'\\nvar adBDCConfigurationFunction = 'ConfigureADBDC'\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-11-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  sku: {\\n    name: publicIPSKU\\n  }\\n  zones: [\\n    '1'\\n  ]\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsPrefix\\n    }\\n  }\\n}\\n\\nmodule CreateVNet '?' /*TODO: replace with correct path to [variables('vnetTemplateUri')]*/ = {\\n  name: 'CreateVNet'\\n  params: {\\n    virtualNetworkName: virtualNetworkName\\n    virtualNetworkAddressRange: virtualNetworkAddressRange\\n    subnetName: adSubnetName\\n    subnetRange: adSubnet\\n    location: location\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-11-01' = [\\n  for i in range(0, 2): {\\n    name: nicName[i]\\n    location: location\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig1'\\n          properties: {\\n            privateIPAllocationMethod: 'Static'\\n            privateIPAddress: ipAddress[i]\\n            publicIPAddress: ((i == 0) ? publicIpAddressId : json('null'))\\n            subnet: {\\n              id: adSubnetRef\\n            }\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      CreateVNet\\n      publicIPAddress\\n    ]\\n  }\\n]\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2020-12-01' = [\\n  for i in range(0, 2): {\\n    name: vmName[i]\\n    location: location\\n    zones: [\\n      (i + 1)\\n    ]\\n    properties: {\\n      hardwareProfile: {\\n        vmSize: vmSize\\n      }\\n      osProfile: {\\n        computerName: vmName[i]\\n        adminUsername: adminUsername\\n        adminPassword: adminPassword\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: imagePublisher\\n          offer: imageOffer\\n          sku: imageSKU\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          caching: 'ReadOnly'\\n          createOption: 'FromImage'\\n          managedDisk: {\\n            storageAccountType: 'StandardSSD_LRS'\\n          }\\n        }\\n        dataDisks: [\\n          {\\n            diskSizeGB: 64\\n            lun: 0\\n            createOption: 'Empty'\\n          }\\n        ]\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', nicName[i])\\n          }\\n        ]\\n      }\\n    }\\n    dependsOn: [\\n      nic\\n    ]\\n  }\\n]\\n\\nresource vmName_0_CreateAdForest 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  name: '${vmName[0]}/CreateAdForest'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Powershell'\\n    type: 'DSC'\\n    typeHandlerVersion: '2.24'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      configuration: {\\n        url: uri(_artifactsLocation, 'DSC/CreateADPDC.ps1.zip')\\n        script: 'CreateADPDC.ps1'\\n        function: 'CreateADPDC'\\n      }\\n      configurationArguments: {\\n        domainName: domainName\\n      }\\n    }\\n    protectedSettings: {\\n      configurationUrlSasToken: _artifactsLocationSasToken\\n      configurationArguments: {\\n        adminCreds: {\\n          userName: adminUsername\\n          password: adminPassword\\n        }\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    vm\\n  ]\\n}\\n\\nresource vmName_1_PepareBDC 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  name: '${vmName[1]}/PepareBDC'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Powershell'\\n    type: 'DSC'\\n    typeHandlerVersion: '2.24'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      configuration: {\\n        url: uri(_artifactsLocation, 'DSC/PrepareADBDC.ps1.zip')\\n        script: 'PrepareADBDC.ps1'\\n        function: 'PrepareADBDC'\\n      }\\n      configurationArguments: {\\n        DNSServer: ipAddress[0]\\n      }\\n    }\\n    protectedSettings: {\\n      configurationUrlSasToken: _artifactsLocationSasToken\\n    }\\n  }\\n  dependsOn: [\\n    vm\\n  ]\\n}\\n\\nmodule UpdateVNetDNS1 '?' /*TODO: replace with correct path to [variables('vnetTemplateUri')]*/ = {\\n  name: 'UpdateVNetDNS1'\\n  params: {\\n    virtualNetworkName: virtualNetworkName\\n    virtualNetworkAddressRange: virtualNetworkAddressRange\\n    subnetName: adSubnetName\\n    subnetRange: adSubnet\\n    DNSServerAddress: [\\n      ipAddress[0]\\n    ]\\n    location: location\\n  }\\n  dependsOn: [\\n    vmName_0_CreateAdForest\\n    vmName_1_PepareBDC\\n  ]\\n}\\n\\nmodule UpdateBDCNIC '?' /*TODO: replace with correct path to [variables('nicTemplateUri')]*/ = {\\n  name: 'UpdateBDCNIC'\\n  params: {\\n    nicName: nicName[1]\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Static'\\n          privateIPAddress: ipAddress[1]\\n          subnet: {\\n            id: adSubnetRef\\n          }\\n        }\\n      }\\n    ]\\n    dnsServers: [\\n      ipAddress[0]\\n    ]\\n    location: location\\n  }\\n  dependsOn: [\\n    UpdateVNetDNS1\\n  ]\\n}\\n\\nmodule ConfiguringBackupADDomainController '?' /*TODO: replace with correct path to [variables('configureADBDCTemplateUri')]*/ = {\\n  name: 'ConfiguringBackupADDomainController'\\n  params: {\\n    extName: '${vmName[1]}/PepareBDC'\\n    location: location\\n    adminUsername: adminUsername\\n    adminPassword: adminPassword\\n    domainName: domainName\\n    adBDCConfigurationScript: adBDCConfigurationScript\\n    adBDCConfigurationFunction: adBDCConfigurationFunction\\n    adBDCConfigurationModulesURL: adBDCConfigurationModulesURL\\n    _artifactsLocationSasToken: _artifactsLocationSasToken\\n  }\\n  dependsOn: [\\n    UpdateBDCNIC\\n  ]\\n}\\n\\nmodule UpdateVNetDNS2 '?' /*TODO: replace with correct path to [variables('vnetTemplateUri')]*/ = {\\n  name: 'UpdateVNetDNS2'\\n  params: {\\n    virtualNetworkName: virtualNetworkName\\n    virtualNetworkAddressRange: virtualNetworkAddressRange\\n    subnetName: adSubnetName\\n    subnetRange: adSubnet\\n    DNSServerAddress: ipAddress\\n    location: location\\n  }\\n  dependsOn: [\\n    ConfiguringBackupADDomainController\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"domainName\\\": {\\n      \\\"value\\\": \\\"contoso.local\\\"\\n    },\\n    \\\"dnsPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM virtual network configuration? I need the traditional approach without AVM."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Unique DNS Name for the Storage Account where the Virtual Machine\\\\'s disks will be placed.')\\nparam newStorageAccountName string\\n\\n@description('User name for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Unique DNS Name for the Public IP used to access the Virtual Machine.')\\nparam dnsNameForPublicIP string\\n\\n@description('Name of the VM')\\nparam vmName string\\n\\n@description('The Ubuntu version for the VM. This will pick a fully patched image of this given Ubuntu version. Default value is 14.04.5-LTS')\\nparam ubuntuOSVersion string = '14.04.5-LTS'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('The base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Default VM size')\\nparam vmSize string = 'Standard_A2'\\n\\nvar imagePublisher = 'Canonical'\\nvar imageOffer = 'UbuntuServer'\\nvar nicName = 'vertxNic'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'vertxSubnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar storageAccountType = 'Standard_LRS'\\nvar publicIPAddressName = 'vertxPublicIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar virtualNetworkName = 'vertxVNET'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar networkSecurityGroupName = 'default-NSG'\\n\\nresource newStorageAccount 'Microsoft.Storage/storageAccounts@2021-02-01' = {\\n  name: newStorageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsNameForPublicIP\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2020-07-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'default-allow-22'\\n        properties: {\\n          priority: 1000\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '22'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: ubuntuOSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n  dependsOn: [\\n    newStorageAccount\\n  ]\\n}\\n\\nresource vmName_newuserscript 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: vm\\n  name: 'newuserscript'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        uri(_artifactsLocation, 'scripts/install.sh${_artifactsLocationSasToken}')\\n      ]\\n      commandToExecute: 'sh install.sh'\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"newStorageAccountName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsNameForPublicIP\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"ubuntuOSVersion\\\": {\\n      \\\"value\\\": \\\"14.04.5-LTS\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_A2\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param description string = ''\\nparam principalIds array\\nparam principalType string = ''\\nparam roleDefinitionIdOrName string\\nparam resourceId string\\n\\nvar builtInRoleNames = {\\n  Owner: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')\\n  Contributor: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\\n  Reader: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')\\n  'Avere Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '4f8fab4f-1852-4a58-a46a-8eaf358af14a'\\n  )\\n  'Avere Operator': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    'c025889f-8102-4ebf-b32c-fc0c6f0c6bd9'\\n  )\\n  'Backup Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '5e467623-bb1f-42f4-a55d-6e525e11384b'\\n  )\\n  'Backup Operator': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '00c29273-979b-4161-815c-10b084fb9324'\\n  )\\n  'Cosmos DB Operator': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '230815da-be43-4aae-9cb4-875f7bd000aa'\\n  )\\n  'DevTest Labs User': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '76283e04-6283-4c54-8f91-bcf1374a3c64'\\n  )\\n  'DocumentDB Account Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '5bd9cd88-fe45-4216-938b-f97437e15450'\\n  )\\n  'Log Analytics Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '92aaf0da-9dab-42b6-94a3-d43ce8d16293'\\n  )\\n  'Log Analytics Reader': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '73c42c96-874c-492b-b04d-ab87d138a893'\\n  )\\n  'Managed Application Contributor Role': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '641177b8-a67a-45b9-a033-47bc880bb21e'\\n  )\\n  'Managed Application Operator Role': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    'c7393b34-138c-406f-901b-d8cf2b17e6ae'\\n  )\\n  'Managed Applications Reader': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    'b9331d33-8a36-4f8c-b097-4f54124fdb44'\\n  )\\n  'Monitoring Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '749f88d5-cbae-40b8-bcfc-e573ddc772fa'\\n  )\\n  'Monitoring Metrics Publisher': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '3913510d-42f4-4e42-8a64-420c390055eb'\\n  )\\n  'Monitoring Reader': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '43d0d8ad-25c7-4714-9337-8ba259a9fe05'\\n  )\\n  'Network Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '4d97b98b-1d4f-4787-a291-c67834d212e7'\\n  )\\n  'Private DNS Zone Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    'b12aa53e-6015-4669-85d0-8515ebb3ae7f'\\n  )\\n  'Resource Policy Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '36243c78-bf99-498c-9df9-86d9f8d28608'\\n  )\\n  'Site Recovery Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '6670b86e-a3f7-4917-ac9b-5d6ab1be4567'\\n  )\\n  'Site Recovery Operator': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '494ae006-db33-4328-bf46-533a6560a3ca'\\n  )\\n  'SQL Managed Instance Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '4939a1f6-9ae0-4e48-a1e0-f2cbe897382d'\\n  )\\n  'SQL Security Manager': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '056cd41c-7e88-42e1-933e-88ba6a50c9c3'\\n  )\\n  'Storage Account Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '17d1049b-9a84-46fb-8f53-869881c3d3ab'\\n  )\\n  'User Access Administrator': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9'\\n  )\\n  'Virtual Machine Administrator Login': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '1c0163c0-47e6-4577-8991-ea5c82e286e4'\\n  )\\n  'Virtual Machine Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    '9980e02c-c2be-4d73-94e8-173b1dc7cf3c'\\n  )\\n  'Virtual Machine User Login': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    'fb879df8-f326-4884-b1cf-06f3ad86be52'\\n  )\\n}\\n\\nresource resourceId_principalIds_roleDefinitionIdOr 'Microsoft.Authorization/roleAssignments@2022-04-01' = [\\n  for item in principalIds: {\\n    scope: 'Microsoft.Network/virtualNetworks/${last(split(resourceId,'/'))}'\\n    name: guid(last(split(resourceId, '/')), item, roleDefinitionIdOrName)\\n    properties: {\\n      description: description\\n      roleDefinitionId: (contains(builtInRoleNames, roleDefinitionIdOrName)\\n        ? builtInRoleNames[roleDefinitionIdOrName]\\n        : roleDefinitionIdOrName)\\n      principalId: item\\n      principalType: ((!empty(principalType)) ? principalType : null)\\n    }\\n  }\\n]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"description\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"principalIds\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"principalType\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"roleDefinitionIdOrName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"resourceId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('This is the unique DNS name of the for the public IP for your VM')\\nparam vmDnsPrefix string\\n\\n@description('This is the username you wish to assign to your VMs admin account')\\nparam adminUsername string\\n\\n@description('Size of VM')\\nparam vmSize string = 'Standard_D2_v3'\\n\\n@description('Size of each data disk in GB')\\nparam sizeOfEachDataDiskInGB string\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('The base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar nicName = 'VMNic'\\nvar addressPrefix = '10.0.0.0/16'\\nvar imagePublisher = 'OpenLogic'\\nvar imageVersion = 'latest'\\nvar imageSKU = '8.0'\\nvar imageOffer = 'CentOS'\\nvar subnetName = 'Subnet-1'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar storageAccountType = 'Standard_LRS'\\nvar publicIPAddressName = 'publicIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar vmName = vmDnsPrefix\\nvar virtualNetworkName = 'WPVNET'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar storageAccountName = replace(replace(toLower('bitcore${uniqueString(resourceGroup().id)}'), '-', ''), '.', '')\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar networkSecurityGroupName = 'default-NSG'\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-02-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: vmDnsPrefix\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2020-07-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'default-allow-22'\\n        properties: {\\n          priority: 1000\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '22'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: imageSKU\\n        version: imageVersion\\n      }\\n      dataDisks: [\\n        {\\n          diskSizeGB: sizeOfEachDataDiskInGB\\n          lun: 0\\n          name: '${vmName}_DataDisk1'\\n          createOption: 'Empty'\\n        }\\n      ]\\n      osDisk: {\\n        name: '${vmName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n  dependsOn: [\\n    storageAccount\\n  ]\\n}\\n\\nresource vmName_newuserscript 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: vm\\n  name: 'newuserscript'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        uri(_artifactsLocation, 'install_bitcore.sh${_artifactsLocationSasToken}')\\n      ]\\n      commandToExecute: 'sh install_bitcore.sh ${adminUsername}'\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmDnsPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    },\\n    \\\"sizeOfEachDataDiskInGB\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The CloudLens Project Key. Used by the agents to connect back to the backend.')\\n@secure()\\nparam cloudlensProjectKey string\\n\\n@description('User name for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('The vm size where Moloch will be deployed')\\nparam toolVmSize string = 'Standard_D2_v3'\\n\\n@description('The name of the vm where Moloch will be deployed')\\nparam toolVmName string = 'MolochTool'\\n\\n@description('The vm size where the tap will be deployed')\\nparam tapVmSize string = 'Standard_D2_v3'\\n\\n@description('The name of the vm where the tap will be deployed')\\nparam tapVmName string = 'CloudLensTap'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\nvar imagePublisher = 'Canonical'\\nvar imageOffer = 'UbuntuServer'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'Subnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar storageAccountType = 'Standard_LRS'\\nvar publicIPAddressType = 'Dynamic'\\nvar virtualNetworkName = 'CloudLensVNET'\\nvar ubuntuOSVersion = '16.04.0-LTS'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar toolPublicIPAddressName = 'molochPublicIP'\\nvar toolStorageAccountName = 'tooldisk${uniqueString(resourceGroup().id)}'\\nvar toolDnsLabelPrefix = 'moloch-${uniqueString(resourceGroup().id)}'\\nvar toolNicName = 'MolochVMNic'\\nvar tapPublicIPAddressName = 'cloudlensPublicIP'\\nvar tapStorageAccountName = 'tapdisk${uniqueString(resourceGroup().id)}'\\nvar tapDnsLabelPrefix = 'cloudlens-${uniqueString(resourceGroup().id)}'\\nvar tapNicName = 'CloudLensVMNic'\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar networkSecurityGroupName = 'default-NSG'\\n\\nresource toolStorageAccount 'Microsoft.Storage/storageAccounts@2021-04-01' = {\\n  name: toolStorageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n  kind: 'Storage'\\n  properties: {}\\n}\\n\\nresource tapStorageAccount 'Microsoft.Storage/storageAccounts@2021-04-01' = {\\n  name: tapStorageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n  kind: 'Storage'\\n  properties: {}\\n}\\n\\nresource toolPublicIPAddress 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: toolPublicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: toolDnsLabelPrefix\\n    }\\n  }\\n}\\n\\nresource tapPublicIPAddress 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: tapPublicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: tapDnsLabelPrefix\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2020-07-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'default-allow-22'\\n        properties: {\\n          priority: 1000\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '22'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource toolNic 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: toolNicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: toolPublicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource tapNic 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: tapNicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: tapPublicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource toolVm 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: toolVmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: toolVmSize\\n    }\\n    osProfile: {\\n      computerName: toolVmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: ubuntuOSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        createOption: 'FromImage'\\n      }\\n      dataDisks: [\\n        {\\n          diskSizeGB: 1023\\n          lun: 0\\n          createOption: 'Empty'\\n        }\\n      ]\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: toolNic.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: reference(toolStorageAccountName, '2021-04-01').primaryEndpoints.blob\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    toolStorageAccount\\n  ]\\n}\\n\\nresource tapVm 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: tapVmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: tapVmSize\\n    }\\n    osProfile: {\\n      computerName: tapVmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: ubuntuOSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        createOption: 'FromImage'\\n      }\\n      dataDisks: [\\n        {\\n          diskSizeGB: 1023\\n          lun: 0\\n          createOption: 'Empty'\\n        }\\n      ]\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: tapNic.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: reference(tapStorageAccountName, '2021-04-01').primaryEndpoints.blob\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    tapStorageAccount\\n  ]\\n}\\n\\nresource toolVmName_config 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: toolVm\\n  name: 'config'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      skipDos2Unix: false\\n      timestamp: 123456789\\n    }\\n    protectedSettings: {\\n      fileUris: [\\n        uri(_artifactsLocation, 'scripts/setup-moloch.sh${_artifactsLocationSasToken}')\\n      ]\\n      commandToExecute: './setup-moloch.sh ${cloudlensProjectKey}'\\n    }\\n  }\\n}\\n\\nresource tapVmName_config 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: tapVm\\n  name: 'config'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      skipDos2Unix: false\\n      timestamp: 123456789\\n    }\\n    protectedSettings: {\\n      fileUris: [\\n        uri(_artifactsLocation, 'scripts/setup-tap.sh${_artifactsLocationSasToken}')\\n      ]\\n      commandToExecute: './setup-tap.sh ${cloudlensProjectKey}'\\n    }\\n  }\\n}\\n\\noutput Moloch_SSH_Command string = 'ssh ${adminUsername}@${toolPublicIPAddress.properties.dnsSettings.fqdn}'\\noutput Moloch_Host_Name string = toolPublicIPAddress.properties.dnsSettings.fqdn\\noutput Tapping_Host_SSH_Command string = 'ssh ${adminUsername}@${tapPublicIPAddress.properties.dnsSettings.fqdn}'\\noutput Tapping_Host_Name string = tapPublicIPAddress.properties.dnsSettings.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"cloudlensProjectKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"toolVmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    },\\n    \\\"toolVmName\\\": {\\n      \\\"value\\\": \\\"MolochTool\\\"\\n    },\\n    \\\"tapVmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    },\\n    \\\"tapVmName\\\": {\\n      \\\"value\\\": \\\"CloudLensTap\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location for all resources. The default is the Resource Group location.')\\nparam location string = resourceGroup().location\\n\\n@description('Name of the Virtual Network Resource Group.')\\nparam virtualNetworkResourceGroupName string\\n\\n@description('Name of the Virtual Network, should be in the above Location.')\\nparam virtualNetworkName string\\n\\n@description('Name of the Subnet in the Virtual Network.')\\nparam subnet1Name string\\n\\n@description('Name for the Network Security Group that the template will create. Note that a pre-existing Network Security Group with the same name will be replaced.')\\nparam networkSecurityGroupName string\\n\\n@description('Provide an address range using CIDR notation (e.g. 10.1.0.0/24), or an IP address (e.g. 192.168.99.21) for Management access via ssh (port 22/TCP). You can also provide a comma-separated list of IP addresses and/or address ranges (a valid comma-separated list is 10.1.0.4,10.2.1.0/24). To allow access from any IP you can use 0.0.0.0/0.')\\nparam MgmtSourceAddressOrRange string\\n\\n@description('The name of the vSensor.')\\nparam vsensorName string\\n\\n@description('Number of vSensors to be deployed, max is 4.')\\n@minValue(1)\\n@maxValue(4)\\nparam numberOfVsensors int = 1\\n\\n@description('The vSensor disk size in GB between 30 and 1024. Check the Darktrace customer portal for more information.')\\n@minValue(30)\\n@maxValue(1024)\\nparam diskSize int = 30\\n\\n@description('The VM size. Check the Darktrace customer portal for more information about the vSensor Virtual Hardware requirements.')\\nparam virtualMachineSize string = 'Standard_D2s_v3'\\n\\n@description('Username to be created when the vSensor is spun up. Note that password authentication over ssh for newly created VMs is disabled.')\\nparam adminUsername string\\n\\n@description('Public key for the adminUsername user to ssh the vSensor.')\\nparam adminPublicKey string = ''\\n\\n@description('The FQDN or the IP of the Darktrace master instance (virtual/physical).')\\nparam applianceHostName string\\n\\n@description('Darktrace master instance connection port.')\\n@minValue(1)\\n@maxValue(65535)\\nparam appliancePort int = 443\\n\\n@description('Darktrace Update Key needed to install the vSensor package. Contact your Darktrace representative for more information.')\\n@secure()\\nparam updateKey string\\n\\n@description('The push token that vSensor will use to connect and register on the Darktrace master instance. Should be generated on the Darktrace master instance.')\\n@secure()\\nparam pushToken string\\n\\n@description('TThe osSensor HMAC Token.')\\n@secure()\\nparam osSensorHMACToken string\\n\\nvar nsgSourceAddressPrefix = split(varMgmtSourceAddressOrRange, ',')\\nvar varMgmtSourceAddressOrRange = replace(MgmtSourceAddressOrRange, ' ', '')\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2022-05-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'AllowMgmtInPorts22'\\n        properties: {\\n          description: 'Allow Inbound traffic to TCP ports 22 from customer selected IPs/Ranges.'\\n          direction: 'Inbound'\\n          priority: 1001\\n          access: 'Allow'\\n          protocol: 'TCP'\\n          sourcePortRange: '*'\\n          destinationPortRanges: [\\n            '22'\\n          ]\\n          sourceAddressPrefixes: nsgSourceAddressPrefix\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n      {\\n        name: 'AllowVnetInPorts80_443'\\n        properties: {\\n          description: 'Allow Inbound traffic to TCP ports 80 and 443 from all VMs in the Vnet.'\\n          direction: 'Inbound'\\n          priority: 1011\\n          access: 'Allow'\\n          protocol: 'TCP'\\n          sourcePortRange: '*'\\n          destinationPortRanges: [\\n            '80'\\n            '443'\\n          ]\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'VirtualNetwork'\\n        }\\n      }\\n      {\\n        name: 'DenyAllIn'\\n        properties: {\\n          description: 'Deny all Inbound traffic.'\\n          direction: 'Inbound'\\n          priority: 1021\\n          access: 'Deny'\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          destinationPortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vsensorName_0_numberOfVsensors_1_nic 'Microsoft.Network/networkInterfaces@2022-05-01' = [\\n  for i in range(0, length(range(0, numberOfVsensors))): {\\n    name: '${vsensorName}-${(range(0,numberOfVsensors)[i]+1)}-nic'\\n    location: location\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig1'\\n          properties: {\\n            subnet: {\\n              id: resourceId(\\n                virtualNetworkResourceGroupName,\\n                'Microsoft.Network/virtualNetworks/subnets',\\n                virtualNetworkName,\\n                subnet1Name\\n              )\\n            }\\n            privateIPAllocationMethod: 'Dynamic'\\n          }\\n        }\\n      ]\\n      enableAcceleratedNetworking: true\\n      networkSecurityGroup: {\\n        id: networkSecurityGroup.id\\n      }\\n    }\\n    dependsOn: [\\n      networkSecurityGroup\\n    ]\\n  }\\n]\\n\\nresource vsensorName_0_numberOfVsensors_1 'Microsoft.Compute/virtualMachines@2022-08-01' = [\\n  for i in range(0, length(range(0, numberOfVsensors))): {\\n    name: '${vsensorName}-${(range(0,numberOfVsensors)[i]+1)}'\\n    location: location\\n    properties: {\\n      hardwareProfile: {\\n        vmSize: virtualMachineSize\\n      }\\n      storageProfile: {\\n        osDisk: {\\n          createOption: 'fromImage'\\n          diskSizeGB: diskSize\\n          managedDisk: {\\n            storageAccountType: 'StandardSSD_LRS'\\n          }\\n          deleteOption: 'delete'\\n        }\\n        imageReference: {\\n          publisher: 'canonical'\\n          offer: '0001-com-ubuntu-server-focal'\\n          sku: '20_04-lts-gen2'\\n          version: 'latest'\\n        }\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId(\\n              'Microsoft.Network/networkInterfaces',\\n              '${vsensorName}-${(range(0,numberOfVsensors)[range(0,numberOfVsensors)[i]]+1)}-nic'\\n            )\\n            properties: {\\n              deleteOption: 'delete'\\n            }\\n          }\\n        ]\\n      }\\n      osProfile: {\\n        computerName: vsensorName\\n        adminUsername: adminUsername\\n        linuxConfiguration: {\\n          disablePasswordAuthentication: true\\n          ssh: {\\n            publicKeys: [\\n              {\\n                path: '/home/${adminUsername}/.ssh/authorized_keys'\\n                keyData: adminPublicKey\\n              }\\n            ]\\n          }\\n          patchSettings: {\\n            patchMode: 'ImageDefault'\\n          }\\n        }\\n        customData: base64('#!/bin/bash\\\\nbash <(wget https://packages.darktrace.com/install -O -) --updateKey \\\"${updateKey}\\\"\\\\n sleep 5\\\\n/usr/sbin/set_pushtoken.sh \\\"${pushToken}\\\" ${applianceHostName}:${appliancePort}\\\\nsleep 5\\\\nset_ossensor_hmac.sh \\\"${osSensorHMACToken}\\\"')\\n      }\\n      diagnosticsProfile: {\\n        bootDiagnostics: {\\n          enabled: true\\n        }\\n      }\\n    }\\n    dependsOn: [\\n      resourceId(\\n        'Microsoft.Network/networkInterfaces',\\n        '${vsensorName}-${(range(0,numberOfVsensors)[range(0,numberOfVsensors)[i]]+1)}-nic'\\n      )\\n    ]\\n  }\\n]\\n\\noutput allowedManagementIPsAndRanges array = nsgSourceAddressPrefix\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"virtualNetworkResourceGroupName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnet1Name\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"networkSecurityGroupName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"MgmtSourceAddressOrRange\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vsensorName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"numberOfVsensors\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"diskSize\\\": {\\n      \\\"value\\\": 30\\n    },\\n    \\\"virtualMachineSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPublicKey\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"applianceHostName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"appliancePort\\\": {\\n      \\\"value\\\": 443\\n    },\\n    \\\"updateKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"pushToken\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"osSensorHMACToken\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of cluster - should be lowercase, if it is not, a lowercase version will be used.')\\nparam clusterNameDesired string = uniqueString(resourceGroup().id)\\n\\n@description('Location of resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Username on machines.')\\nparam adminUsername string\\n\\n@description('Password for the virtual machines .')\\n@secure()\\nparam adminPassword string\\n\\n@description('Comma separated list of users allowed to log into DLWorkspace webportal as administrator and manage the cluster')\\nparam dlwsAdmins string\\n\\n@description('Array of IP prefixes of machines which can be used to connect to the dev box.')\\nparam devSourceIP array = [\\n  '10.0.0.0/8'\\n]\\n\\n@description('Number of infra-VM to deploy.')\\nparam numberOfInfraVM int = 1\\n\\n@description('Size of the infra-VM. Use a CPU VM for infra-VM.')\\nparam infraVMSize string = 'Standard_D2s_v3'\\n\\n@description('Number of worker-VM to deploy.')\\nparam numberOfWorkerVM int = 1\\n\\n@description('Size of the worker-VM. Use a GPU VM for worker-VM.')\\nparam workerVMSize string = 'Standard_D2s_v3'\\n\\n@description('Provider for OpenID Authentication - currently supports MSFT or Google, leave blank if not using.')\\n@allowed([\\n  ''\\n  'Google'\\n  'MSFT'\\n])\\nparam openIDProvider string = ''\\n\\n@description('Name of the web application registered with the authentication provider.')\\nparam openIDTenant string = ''\\n\\n@description('ClientID of the web application registered with the authentication provider.')\\nparam openIDClientID string = ''\\n\\n@description('Client Secret of the web application registered with the authentication provider.')\\n@secure()\\nparam openIDClientSecret string = ''\\n\\n@description('The base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'')\\nparam _artifactsLocation string = 'https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/dlworkspace/dlworkspace-deployment/'\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar clusterName = toLower(clusterNameDesired)\\nvar standardStorageAccountType = 'StandardSSD_LRS'\\nvar imagePublisher = 'Canonical'\\nvar imageOffer = 'UbuntuServer'\\nvar ubuntuOSVersion = '16.04.0-LTS'\\nvar virtualNetworkName = '${resourceGroup().name}-VNet'\\nvar subnetName = 'VMSubnet'\\nvar addressPrefix = '192.168.0.0/16'\\nvar scriptFileUri = uri(_artifactsLocation, 'scripts/setupdevbox.sh${_artifactsLocationSasToken}')\\nvar singleQuote = '\\\\''\\nvar adminPasswordQ = concat(singleQuote, adminPassword, singleQuote)\\nvar dlwsAdminsQ = concat(singleQuote, dlwsAdmins, singleQuote)\\nvar openIDProviderQ = concat(singleQuote, openIDProvider, singleQuote)\\nvar openIDTenantQ = concat(singleQuote, openIDTenant, singleQuote)\\nvar openIDClientIDQ = concat(singleQuote, openIDClientID, singleQuote)\\nvar openIDClientSecretQ = concat(singleQuote, openIDClientSecret, singleQuote)\\n\\nresource clusterName_dev 'Microsoft.Compute/virtualMachines@2017-12-01' = {\\n  name: '${clusterName}-dev'\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: infraVMSize\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: ubuntuOSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        createOption: 'FromImage'\\n        caching: 'ReadWrite'\\n        managedDisk: {\\n          storageAccountType: standardStorageAccountType\\n        }\\n      }\\n    }\\n    osProfile: {\\n      computerName: '${clusterName}-dev'\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: clusterName_dev_VMNic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource clusterName_dev_setupdevbox 'Microsoft.Compute/virtualMachines/extensions@2017-12-01' = {\\n  parent: clusterName_dev\\n  name: 'setupdevbox'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        scriptFileUri\\n      ]\\n    }\\n    protectedSettings: {\\n      commandToExecute: 'bash setupdevbox.sh ${adminUsername} --cluster_name ${clusterName} --cluster_location ${location} --worker_vm_size ${workerVMSize} --infra_vm_size ${infraVMSize}  --worker_node_num ${numberOfWorkerVM} --infra_node_num ${numberOfInfraVM} --password ${adminPasswordQ} --users ${dlwsAdminsQ} --openid_name ${openIDProviderQ} --openid_tenant ${openIDTenantQ} --openid_clientid ${openIDClientIDQ} --openid_clientsecret ${openIDClientSecretQ}'\\n    }\\n  }\\n}\\n\\nresource clusterName_infra0_1 'Microsoft.Compute/virtualMachines@2017-12-01' = [\\n  for i in range(0, numberOfInfraVM): {\\n    name: '${clusterName}-infra0${(i+1)}'\\n    location: location\\n    properties: {\\n      hardwareProfile: {\\n        vmSize: infraVMSize\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: imagePublisher\\n          offer: imageOffer\\n          sku: ubuntuOSVersion\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          createOption: 'FromImage'\\n          caching: 'ReadWrite'\\n          managedDisk: {\\n            storageAccountType: standardStorageAccountType\\n          }\\n        }\\n      }\\n      osProfile: {\\n        computerName: '${clusterName}-infra0${(i+1)}'\\n        adminUsername: adminUsername\\n        adminPassword: adminPassword\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', '${clusterName}-infra0${(i+1)}-VMNic')\\n          }\\n        ]\\n      }\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Network/networkInterfaces', '${clusterName}-infra0${(i+1)}-VMNic')\\n    ]\\n  }\\n]\\n\\nresource clusterName_worker0_1 'Microsoft.Compute/virtualMachines@2017-12-01' = [\\n  for i in range(0, numberOfWorkerVM): {\\n    name: '${clusterName}-worker0${(i+1)}'\\n    location: location\\n    properties: {\\n      hardwareProfile: {\\n        vmSize: workerVMSize\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: imagePublisher\\n          offer: imageOffer\\n          sku: ubuntuOSVersion\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          createOption: 'FromImage'\\n          caching: 'ReadWrite'\\n          managedDisk: {\\n            storageAccountType: standardStorageAccountType\\n          }\\n        }\\n      }\\n      osProfile: {\\n        computerName: '${clusterName}-worker0${(i+1)}'\\n        adminUsername: adminUsername\\n        adminPassword: adminPassword\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', '${clusterName}-worker0${(i+1)}-VMNic')\\n          }\\n        ]\\n      }\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Network/networkInterfaces', '${clusterName}-worker0${(i+1)}-VMNic')\\n    ]\\n  }\\n]\\n\\nresource clusterName_dev_PublicIP 'Microsoft.Network/publicIPAddresses@2018-02-01' = {\\n  sku: {\\n    name: 'Basic'\\n  }\\n  name: '${clusterName}-dev-PublicIP'\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n    dnsSettings: {\\n      domainNameLabel: toLower('${clusterName}-dev')\\n    }\\n  }\\n}\\n\\nresource clusterName_infra0_1_PublicIP 'Microsoft.Network/publicIPAddresses@2018-02-01' = [\\n  for i in range(0, numberOfInfraVM): {\\n    sku: {\\n      name: 'Basic'\\n    }\\n    name: '${clusterName}-infra0${(i+1)}-PublicIP'\\n    location: location\\n    properties: {\\n      publicIPAllocationMethod: 'Dynamic'\\n      dnsSettings: {\\n        domainNameLabel: toLower('${clusterName}-infra0${(i+1)}')\\n      }\\n    }\\n  }\\n]\\n\\nresource clusterName_worker0_1_PublicIP 'Microsoft.Network/publicIPAddresses@2018-02-01' = [\\n  for i in range(0, numberOfWorkerVM): {\\n    sku: {\\n      name: 'Basic'\\n    }\\n    name: '${clusterName}-worker0${(i+1)}-PublicIP'\\n    location: location\\n    properties: {\\n      publicIPAllocationMethod: 'Dynamic'\\n      dnsSettings: {\\n        domainNameLabel: toLower('${clusterName}-worker0${(i+1)}')\\n      }\\n    }\\n  }\\n]\\n\\nresource clusterName_dev_VMNic 'Microsoft.Network/networkInterfaces@2018-02-01' = {\\n  name: '${clusterName}-dev-VMNic'\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: '${clusterName}-dev-IPConfig'\\n        properties: {\\n          privateIPAddress: '192.168.255.${(numberOfInfraVM+1)}'\\n          privateIPAllocationMethod: 'Static'\\n          privateIPAddressVersion: 'IPv4'\\n          publicIPAddress: {\\n            id: clusterName_dev_PublicIP.id\\n          }\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\n          }\\n        }\\n      }\\n    ]\\n    networkSecurityGroup: {\\n      id: clusterName_NSG.id\\n    }\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource clusterName_infra0_1_VMNic 'Microsoft.Network/networkInterfaces@2018-02-01' = [\\n  for i in range(0, numberOfInfraVM): {\\n    name: '${clusterName}-infra0${(i+1)}-VMNic'\\n    location: location\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: '${clusterName}-infra0${(i+1)}-IPConfig'\\n          properties: {\\n            privateIPAddress: '192.168.255.${(i+1)}'\\n            privateIPAllocationMethod: 'Static'\\n            privateIPAddressVersion: 'IPv4'\\n            publicIPAddress: {\\n              id: resourceId('Microsoft.Network/publicIPAddresses', '${clusterName}-infra0${(i+1)}-PublicIP')\\n            }\\n            subnet: {\\n              id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\n            }\\n          }\\n        }\\n      ]\\n      networkSecurityGroup: {\\n        id: clusterName_NSG.id\\n      }\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Network/publicIPAddresses', '${clusterName}-infra0${(i+1)}-PublicIP')\\n      virtualNetwork\\n      clusterName_NSG\\n    ]\\n  }\\n]\\n\\nresource clusterName_worker0_1_VMNic 'Microsoft.Network/networkInterfaces@2018-02-01' = [\\n  for i in range(0, numberOfWorkerVM): {\\n    name: '${clusterName}-worker0${(i+1)}-VMNic'\\n    location: location\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: '${clusterName}-worker0${(i+1)}-IPConfig'\\n          properties: {\\n            privateIPAddress: '192.168.1.${(i+1)}'\\n            privateIPAllocationMethod: 'Static'\\n            privateIPAddressVersion: 'IPv4'\\n            publicIPAddress: {\\n              id: resourceId('Microsoft.Network/publicIPAddresses', '${clusterName}-worker0${(i+1)}-PublicIP')\\n            }\\n            subnet: {\\n              id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\n            }\\n          }\\n        }\\n      ]\\n      networkSecurityGroup: {\\n        id: clusterName_NSG.id\\n      }\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Network/publicIPAddresses', '${clusterName}-worker0${(i+1)}-PublicIP')\\n      virtualNetwork\\n      clusterName_NSG\\n    ]\\n  }\\n]\\n\\nresource clusterName_NSG 'Microsoft.Network/networkSecurityGroups@2018-02-01' = {\\n  name: '${clusterName}-NSG'\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'allowalltcp'\\n        properties: {\\n          protocol: 'Tcp'\\n          access: 'Allow'\\n          priority: 1000\\n          direction: 'Inbound'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n          destinationPortRanges: [\\n            '80'\\n            '443'\\n            '30000-32767'\\n            '25826'\\n            '3080'\\n          ]\\n        }\\n      }\\n      {\\n        name: 'allowalludp'\\n        properties: {\\n          protocol: 'Udp'\\n          access: 'Allow'\\n          priority: 1010\\n          direction: 'Inbound'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n          destinationPortRange: '25826'\\n        }\\n      }\\n      {\\n        name: 'allowdevtcp'\\n        properties: {\\n          protocol: 'Tcp'\\n          access: 'Allow'\\n          priority: 900\\n          direction: 'Inbound'\\n          sourceAddressPrefixes: devSourceIP\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n          destinationPortRanges: [\\n            '22'\\n            '1443'\\n            '2379'\\n            '3306'\\n            '5000'\\n            '8086'\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2018-02-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: addressPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\noutput devmachine string = clusterName_dev_PublicIP.properties.dnsSettings.fqdn\\noutput webportal string = reference('${clusterName}-infra01-PublicIP').dnsSettings.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"clusterNameDesired\\\": {\\n      \\\"value\\\": \\\"uniqueString(resourceGroup().id)\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dlwsAdmins\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"devSourceIP\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"numberOfInfraVM\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"infraVMSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"numberOfWorkerVM\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"workerVMSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"openIDProvider\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"openIDTenant\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"openIDClientID\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"openIDClientSecret\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"'https:\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Admin username used when provisioning virtual machines')\\nparam adminUsername string\\n\\n@description('Existing virtual network name to deploy into which contains Elasticsearch nodes')\\nparam existingVirtualNetworkName string = 'es-vnet'\\n\\n@description('Number of subordinate JMeter nodes to provision')\\n@allowed([\\n  1\\n  2\\n  3\\n  4\\n  5\\n  6\\n  7\\n  8\\n  9\\n])\\nparam subNodeCount int = 2\\n\\n@description('Size of the subordinate JMeter nodes')\\n@allowed([\\n  'Standard_D2_v3'\\n  'Standard_D4_v3'\\n  'Standard_D8_v3'\\n  'Standard_A2'\\n  'Standard_A3'\\n  'Standard_A4'\\n  'Standard_A5'\\n  'Standard_A6'\\n  'Standard_A7'\\n])\\nparam subNodeSize string = 'Standard_D2_v3'\\n\\n@description('Size of the boss JMeter node')\\n@allowed([\\n  'Standard_D2_v3'\\n  'Standard_D4_v3'\\n  'Standard_D8_v3'\\n  'Standard_A2'\\n  'Standard_A3'\\n  'Standard_A4'\\n])\\nparam bossNodeSize string = 'Standard_D2_v3'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('The location of the test library and jar dependencies. This is extracted to every node under /opt/jmeter/apache-jmeter-2.13/lib/junit')\\nparam jarball string = 'https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch-jmeter/resources/jarball.zip'\\n\\n@description('The location of the test jmx and run properties. This is extracted to the JMeter master node only, in /opt/jmeter')\\nparam testpack string = 'https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch-jmeter/resources/testpack.zip'\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Name of the resource group used for the deployment.')\\nparam resourceGroupName string = resourceGroup().name\\n\\nvar storageAccountName = '${substring(uniqueString(resourceGroup().id,'jmeter'),0,6)}jmeter'\\nvar bossNodeIp = '10.0.4.10'\\nvar subNodesIpPrefix = '10.0.4.2'\\nvar networkSettings = {\\n  virtualNetworkName: existingVirtualNetworkName\\n  addressPrefix: '10.0.0.0/16'\\n  subnet: {\\n    jmeter: {\\n      name: 'jmeter'\\n      prefix: '10.0.4.0/24'\\n      vnet: existingVirtualNetworkName\\n    }\\n  }\\n}\\nvar subnetRef = resourceId(\\n  resourceGroupName,\\n  'Microsoft.Network/virtualNetworks/subnets',\\n  existingVirtualNetworkName,\\n  'jmeter'\\n)\\nvar nicName = 'jmeter-nic'\\nvar vmName = 'jmeter-vm'\\nvar settings = {\\n  imageReference: {\\n    publisher: 'Canonical'\\n    offer: 'UbuntuServer'\\n    sku: '14.04.5-LTS'\\n    version: 'latest'\\n  }\\n  managementPort: '22'\\n  extensionSettings: {\\n    boss: {\\n      publisher: 'Microsoft.Azure.Extensions'\\n      type: 'CustomScript'\\n      typeHandlerVersion: '2.0'\\n      autoUpgradeMinorVersion: true\\n      settings: {\\n        fileUris: [\\n          uri(_artifactsLocation, 'jmeter-install.sh${_artifactsLocationSasToken}')\\n        ]\\n        commandToExecute: 'bash jmeter-install.sh -mr ${subNodesIpPrefix}-${subNodeCount} -j ${jarball} -t ${testpack}'\\n      }\\n    }\\n    sub: {\\n      publisher: 'Microsoft.Azure.Extensions'\\n      type: 'CustomScript'\\n      typeHandlerVersion: '2.0'\\n      autoUpgradeMinorVersion: true\\n      settings: {\\n        fileUris: [\\n          uri(_artifactsLocation, 'jmeter-install.sh${_artifactsLocationSasToken}')\\n        ]\\n        commandToExecute: 'bash jmeter-install.sh -j ${jarball}'\\n      }\\n    }\\n  }\\n}\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-02-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: 'Standard_LRS'\\n  }\\n  kind: 'Storage'\\n}\\n\\nresource jmeter_pip 'Microsoft.Network/publicIPAddresses@2020-11-01' = {\\n  name: 'jmeter-pip'\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n  }\\n}\\n\\nresource jmeter_nsg 'Microsoft.Network/networkSecurityGroups@2020-11-01' = {\\n  name: 'jmeter-nsg'\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'SSH'\\n        properties: {\\n          description: 'Allows SSH traffic'\\n          protocol: 'Tcp'\\n          sourcePortRange: settings.managementPort\\n          destinationPortRange: settings.managementPort\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource networkSettings_virtualNetworkName_jmeter 'Microsoft.Network/virtualNetworks/subnets@2020-06-01' = {\\n  name: '${networkSettings.virtualNetworkName}/jmeter'\\n  location: location\\n  properties: {\\n    addressPrefix: networkSettings.subnet.jmeter.prefix\\n  }\\n}\\n\\nresource nicName_sub 'Microsoft.Network/networkInterfaces@2020-11-01' = [\\n  for i in range(0, subNodeCount): {\\n    name: '${nicName}-sub${i}'\\n    location: location\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfigsub'\\n          properties: {\\n            privateIPAllocationMethod: 'Static'\\n            privateIPAddress: concat(subNodesIpPrefix, i)\\n            subnet: {\\n              id: subnetRef\\n            }\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      networkSettings_virtualNetworkName_jmeter\\n    ]\\n  }\\n]\\n\\nresource nicName_boss 'Microsoft.Network/networkInterfaces@2020-11-01' = {\\n  name: '${nicName}-boss'\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfigboss'\\n        properties: {\\n          privateIPAllocationMethod: 'Static'\\n          privateIPAddress: bossNodeIp\\n          publicIPAddress: {\\n            id: jmeter_pip.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n    networkSecurityGroup: {\\n      id: jmeter_nsg.id\\n    }\\n  }\\n}\\n\\nresource vmName_boss 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: '${vmName}-boss'\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: bossNodeSize\\n    }\\n    osProfile: {\\n      computerName: 'jmeter-boss'\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: settings.imageReference\\n      osDisk: {\\n        name: '${vmName}-boss_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nicName_boss.id\\n        }\\n      ]\\n    }\\n  }\\n  dependsOn: [\\n    storageAccount\\n  ]\\n}\\n\\nresource vmName_boss_installjmeter 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: vmName_boss\\n  name: 'installjmeter'\\n  location: location\\n  properties: {\\n    publisher: settings.extensionSettings.boss.publisher\\n    type: settings.extensionSettings.boss.type\\n    typeHandlerVersion: settings.extensionSettings.boss.typeHandlerVersion\\n    settings: {\\n      fileUris: settings.extensionSettings.boss.settings.fileUris\\n      commandToExecute: concat(settings.extensionSettings.boss.settings.commandToExecute)\\n    }\\n  }\\n}\\n\\nresource vmName_sub 'Microsoft.Compute/virtualMachines@2020-12-01' = [\\n  for i in range(0, subNodeCount): {\\n    name: '${vmName}-sub${i}'\\n    location: location\\n    properties: {\\n      hardwareProfile: {\\n        vmSize: subNodeSize\\n      }\\n      osProfile: {\\n        computerName: 'jmeter-sub${i}'\\n        adminUsername: adminUsername\\n        adminPassword: adminPasswordOrKey\\n        linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n      }\\n      storageProfile: {\\n        imageReference: settings.imageReference\\n        osDisk: {\\n          name: '${vmName}-sub${i}_OSDisk'\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n        }\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', '${nicName}-sub${i}')\\n          }\\n        ]\\n      }\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Network/networkInterfaces/', '${nicName}-sub${i}')\\n      storageAccount\\n    ]\\n  }\\n]\\n\\nresource vmName_sub_installjmeter 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = [\\n  for i in range(0, subNodeCount): {\\n    name: '${vmName}-sub${i}/installjmeter'\\n    location: location\\n    properties: {\\n      publisher: settings.extensionSettings.sub.publisher\\n      type: settings.extensionSettings.sub.type\\n      typeHandlerVersion: settings.extensionSettings.sub.typeHandlerVersion\\n      settings: {\\n        fileUris: settings.extensionSettings.sub.settings.fileUris\\n        commandToExecute: concat(settings.extensionSettings.sub.settings.commandToExecute)\\n      }\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Compute/virtualMachines/', '${vmName}-sub${i}')\\n    ]\\n  }\\n]\\n\\noutput boss_pip string = jmeter_pip.properties.ipAddress\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingVirtualNetworkName\\\": {\\n      \\\"value\\\": \\\"es-vnet\\\"\\n    },\\n    \\\"subNodeCount\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"subNodeSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    },\\n    \\\"bossNodeSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"jarball\\\": {\\n      \\\"value\\\": \\\"'https:\\\"\\n    },\\n    \\\"testpack\\\": {\\n      \\\"value\\\": \\\"'https:\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"resourceGroupName\\\": {\\n      \\\"value\\\": \\\"resourceGroup().name\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Username for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('DNS Label for the Public IP. Must be lowercase. It should match with the following regular expression: ^[a-z][a-z0-9-]{1,61}[a-z0-9]$ or it will raise an error.')\\nparam dnsLabelPrefix string\\n\\n@description('Size of VM')\\nparam vmSize string = 'Standard_A1'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar storageAccountName = '${uniqueString(resourceGroup().id)}standardsa'\\nvar imagePublisher = 'Canonical'\\nvar imageOffer = 'UbuntuServer'\\nvar ubuntuOSVersion = '14.04.5-LTS'\\nvar nsgName = 'myNSG'\\nvar nicName = 'myVMNic'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'Subnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar storageAccountType = 'Standard_LRS'\\nvar publicIPAddressName = 'myPublicIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar vmName = 'IDEStandaloneDocker'\\nvar vmSize_var = vmSize\\nvar virtualNetworkName = 'MyVNET'\\nvar nsgID = nsg.id\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-01-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsLabelPrefix\\n    }\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: nsgID\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    nsgID\\n  ]\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2020-07-01' = {\\n  name: nsgName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'http'\\n        properties: {\\n          description: 'Allow HTTP'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '80'\\n          sourceAddressPrefix: 'Internet'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'ssh'\\n        properties: {\\n          description: 'Allow SSH'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '22'\\n          sourceAddressPrefix: 'Internet'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 110\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'sandbox'\\n        properties: {\\n          description: 'Allow Sandbox'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '8555'\\n          sourceAddressPrefix: 'Internet'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 120\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'ide-app'\\n        properties: {\\n          description: 'Allow IDE app'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '8080'\\n          sourceAddressPrefix: 'Internet'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 130\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize_var\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: ubuntuOSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n  dependsOn: [\\n    storageAccount\\n  ]\\n}\\n\\nresource vmName_installcustomscript 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: vm\\n  name: 'installcustomscript'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        uri(_artifactsLocation, 'install.sh${_artifactsLocationSasToken}')\\n      ]\\n      commandToExecute: 'sh install.sh'\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsLabelPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_A1\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Username for Hazelcast VMs')\\nparam adminUsername string\\n\\n@description('Type of authentication to use on the Hazelcast VMs.')\\n@allowed([\\n  'password'\\n  'sshPublicKey'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('Password or ssh key for the Hazelcast VMs.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Hazelcast Version')\\n@allowed([\\n  '4.0'\\n])\\nparam hazelcastVersion string = '4.0'\\n\\n@description('Cluster Name for hazelcast grid')\\nparam clusterName string = '${adminUsername}${uniqueString(resourceGroup().id)}'\\n\\n@description('Unique DNS Name for the Public IP used to access the Virtual Machine.')\\nparam dnsPrefix string = 'hazelcast'\\n\\n@description('The number of hazelcast nodes in the grid')\\nparam instanceCount int = 2\\n\\n@description('The cluster port to identify this cluster')\\nparam clusterPort string = '5701'\\n\\n@description('The size of each instance VM')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('The Ubuntu OS version for the Hazelcast VM. This will pick a fully patched image of this given Ubuntu version.')\\n@allowed([\\n  '15.10'\\n  '16.04-LTS'\\n  '18.04-LTS'\\n])\\nparam ubuntuOSVersion string = '16.04-LTS'\\n\\n@description('The base URL for the bootstrap files')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nvar imagePublisher = 'Canonical'\\nvar imageOffer = 'UbuntuServer'\\nvar nicName = 'hazelcastNic'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'Subnet'\\nvar subnetPrefix = '10.0.1.0/24'\\nvar publicIPAddressName = 'hazelcastPubIp'\\nvar publicIPAddressType = 'Dynamic'\\nvar vmName = 'hazelcast'\\nvar roleAssignmentName = 'hazelcastRA'\\nvar virtualNetworkName = 'hazelcastVNet'\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar Reader = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar scriptParameters = '${clusterName} ${hazelcastVersion} ${clusterPort}'\\nvar bootstrapFiles = [\\n  uri(_artifactsLocation, 'scripts/bootstrap_hazelcast${_artifactsLocationSasToken}')\\n  uri(_artifactsLocation, 'scripts/hazelcast.service${_artifactsLocationSasToken}')\\n  uri(_artifactsLocation, 'scripts/hazelcast.conf${_artifactsLocationSasToken}')\\n  uri(_artifactsLocation, 'scripts/hazelcast.xml${_artifactsLocationSasToken}')\\n  uri(_artifactsLocation, 'scripts/install_hazelcast${_artifactsLocationSasToken}')\\n  uri(_artifactsLocation, 'scripts/logging.properties${_artifactsLocationSasToken}')\\n  uri(_artifactsLocation, 'scripts/modify_configuration${_artifactsLocationSasToken}')\\n  uri(_artifactsLocation, 'scripts/modify_version${_artifactsLocationSasToken}')\\n  uri(_artifactsLocation, 'scripts/pom.xml${_artifactsLocationSasToken}')\\n]\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-09-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIPAddressName_0_instanceCount_1 'Microsoft.Network/publicIPAddresses@2022-09-01' = [\\n  for i in range(0, length(range(0, instanceCount))): {\\n    name: '${publicIPAddressName}${(range(0,instanceCount)[i]+1)}'\\n    location: location\\n    properties: {\\n      publicIPAllocationMethod: publicIPAddressType\\n      dnsSettings: {\\n        domainNameLabel: '${dnsPrefix}${(range(0,instanceCount)[i]+1)}${uniqueString(resourceGroup().id)}'\\n      }\\n    }\\n  }\\n]\\n\\nresource nicName_0_instanceCount_1 'Microsoft.Network/networkInterfaces@2022-09-01' = [\\n  for i in range(0, length(range(0, instanceCount))): {\\n    name: '${nicName}${(range(0,instanceCount)[i]+1)}'\\n    location: location\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig${(range(0,instanceCount)[i]+1)}'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            publicIPAddress: {\\n              id: resourceId(\\n                'Microsoft.Network/publicIPAddresses',\\n                '${publicIPAddressName}${(range(0,instanceCount)[i]+1)}'\\n              )\\n            }\\n            subnet: {\\n              id: subnetRef\\n            }\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      publicIPAddressName_0_instanceCount_1\\n      virtualNetwork\\n    ]\\n  }\\n]\\n\\nresource vmName_0_instanceCount_1 'Microsoft.Compute/virtualMachines@2022-11-01' = [\\n  for i in range(0, length(range(0, instanceCount))): {\\n    name: '${vmName}${(range(0,instanceCount)[i]+1)}'\\n    location: location\\n    identity: {\\n      type: 'SystemAssigned'\\n    }\\n    properties: {\\n      hardwareProfile: {\\n        vmSize: vmSize\\n      }\\n      osProfile: {\\n        computerName: vmName\\n        adminUsername: adminUsername\\n        adminPassword: adminPasswordOrKey\\n        linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: imagePublisher\\n          offer: imageOffer\\n          sku: ubuntuOSVersion\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          name: '${vmName}${(range(0,instanceCount)[i]+1)}_OSDisk'\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n        }\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', '${nicName}${(range(0,instanceCount)[i]+1)}')\\n          }\\n        ]\\n      }\\n    }\\n    dependsOn: [\\n      nicName_0_instanceCount_1\\n    ]\\n  }\\n]\\n\\nresource roleAssignmentName_0_instanceCount_1 'Microsoft.Authorization/roleAssignments@2022-04-01' = [\\n  for i in range(0, length(range(0, instanceCount))): {\\n    name: guid('${roleAssignmentName}${(range(0,instanceCount)[i]+1)}')\\n    properties: {\\n      roleDefinitionId: Reader\\n      principalId: reference(\\n        resourceId('Microsoft.Compute/virtualMachines', '${vmName}${(range(0,instanceCount)[i]+1)}'),\\n        '2019-12-01',\\n        'Full'\\n      ).identity.principalId\\n      principalType: 'ServicePrincipal'\\n    }\\n    dependsOn: [\\n      vmName_0_instanceCount_1\\n    ]\\n  }\\n]\\n\\nresource vmName_0_instanceCount_1_initHazelcast 'Microsoft.Compute/virtualMachines/extensions@2022-11-01' = [\\n  for i in range(0, length(range(0, instanceCount))): {\\n    name: '${vmName}${(range(0,instanceCount)[i]+1)}/initHazelcast'\\n    location: location\\n    properties: {\\n      publisher: 'Microsoft.Azure.Extensions'\\n      type: 'CustomScript'\\n      typeHandlerVersion: '2.0'\\n      autoUpgradeMinorVersion: true\\n      settings: {\\n        fileUris: bootstrapFiles\\n      }\\n      protectedSettings: {\\n        commandToExecute: 'sh bootstrap_hazelcast ${scriptParameters}'\\n      }\\n    }\\n    dependsOn: [\\n      roleAssignmentName_0_instanceCount_1\\n    ]\\n  }\\n]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"hazelcastVersion\\\": {\\n      \\\"value\\\": \\\"4.0\\\"\\n    },\\n    \\\"clusterName\\\": {\\n      \\\"value\\\": \\\"${adminUsername}${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"dnsPrefix\\\": {\\n      \\\"value\\\": \\\"hazelcast\\\"\\n    },\\n    \\\"instanceCount\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"clusterPort\\\": {\\n      \\\"value\\\": \\\"5701\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"ubuntuOSVersion\\\": {\\n      \\\"value\\\": \\\"16.04-LTS\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('User name for the Virtual Machine')\\nparam adminUsername string\\n\\n@description('Type of authentication to use on the Virtual Machine')\\n@allowed([\\n  'password'\\n  'sshPublicKey'\\n])\\nparam authenticationType string = 'password'\\n\\n@description('Password or SSH key for the Virtual Machine')\\n@secure()\\nparam adminPasswordOrSSHKey string\\n\\n@description('Location for all resources')\\nparam location string = resourceGroup().location\\n\\n@description('User name for the JBoss EAP Manager')\\nparam jbossEAPUserName string\\n\\n@description('Password for the JBoss EAP Manager')\\n@minLength(12)\\n@secure()\\nparam jbossEAPPassword string\\n\\n@description('Select the of RHEL OS License Type for deploying your Virtual Machine. Please read through the guide and make sure you follow the steps mentioned under section \\\\'Licenses, Subscriptions and Costs\\\\' if you are selecting BYOS')\\n@allowed([\\n  'PAYG'\\n  'BYOS'\\n])\\nparam rhelOSLicenseType string = 'PAYG'\\n\\n@description('User name for Red Hat subscription Manager')\\nparam rhsmUserName string\\n\\n@description('Password for Red Hat subscription Manager')\\n@secure()\\nparam rhsmPassword string\\n\\n@description('Red Hat Subscription Manager Pool ID (Should have EAP entitlement)')\\nparam rhsmPoolEAP string\\n\\n@description('Red Hat Subscription Manager Pool ID (Should have RHEL entitlement). Mandartory if you select the BYOS RHEL OS License Type')\\nparam rhsmPoolRHEL string = ''\\n\\n@description('Select the Java version to be installed')\\n@allowed([\\n  'JAVA_8'\\n  'JAVA_11'\\n])\\nparam javaVersion string = 'JAVA_8'\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Select the Replication Strategy for the Storage account')\\n@allowed([\\n  'Standard_LRS'\\n  'Standard_ZRS'\\n  'Standard_GRS'\\n  'Standard_RAGRS'\\n])\\nparam storageReplication string = 'Standard_LRS'\\n\\n@description('The size of the Virtual Machine')\\n@allowed([\\n  'Standard_D2s_v3'\\n  'Standard_D4s_v3'\\n  'Standard_D8s_v3'\\n  'Standard_E2S_v3'\\n  'Standard_E4S_v3'\\n  'Standard_E8S_v3'\\n  'Standard_F2S_v2'\\n  'Standard_F4S_v2'\\n  'Standard_F8S_v2'\\n])\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('Number of VMs to deploy')\\nparam numberOfInstances int = 2\\n\\nvar containerName = 'eapblobcontainer'\\nvar loadBalancersName = 'jbosseap-lb'\\nvar vmNameMap = {\\n  BYOS: 'jbosseap-byos-server'\\n  PAYG: 'jbosseap-payg-server'\\n}\\nvar vmName = vmNameMap[rhelOSLicenseType]\\nvar availabilitySetName = 'jbosseap-as'\\nvar skuName = 'Aligned'\\nvar nicName = 'jbosseap-server-nic'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'jbosseap-server-subnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar virtualNetworkName = 'jbosseap-vnet'\\nvar backendPoolName = 'jbosseap-server'\\nvar frontendName = 'LoadBalancerFrontEnd'\\nvar healthProbeEAP = 'eap-jboss-health'\\nvar healthProbeAdmin = 'eap-admin-health'\\nvar bootStorageAccountName = 'bootstrg${uniqueString(resourceGroup().id)}'\\nvar storageAccountType = 'Standard_LRS'\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrSSHKey\\n      }\\n    ]\\n  }\\n}\\nvar imageSku = ((rhelOSLicenseType == 'PAYG') ? '8_6' : 'rhel-lvm86')\\nvar offerMap = {\\n  BYOS: 'rhel-byos'\\n  PAYG: 'rhel'\\n}\\nvar imageOffer = offerMap[rhelOSLicenseType]\\nvar imageReference = {\\n  publisher: 'redhat'\\n  offer: imageOffer\\n  sku: imageSku\\n  version: 'latest'\\n}\\nvar plan = {\\n  name: imageSku\\n  publisher: 'redhat'\\n  product: 'rhel-byos'\\n}\\nvar guidName = 'pid-9c48eb09-c7f5-4cc1-9ee5-033abb031ff0'\\nvar storageAccountName = 'jbosstrg${uniqueString(resourceGroup().id)}'\\nvar scriptFolder = 'scripts'\\nvar fileToBeDownloaded = 'eap-session-replication.war'\\nvar scriptArgs = '-a ${uri(_artifactsLocation,'.')} -t \\\"${_artifactsLocationSasToken}\\\" -p ${scriptFolder} -f ${fileToBeDownloaded}'\\n\\nresource bootStorageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' = {\\n  name: bootStorageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n  kind: 'Storage'\\n  tags: {\\n    QuickstartName: 'JBoss EAP on RHEL (clustered, multi-VM)'\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  tags: {\\n    QuickstartName: 'JBoss EAP on RHEL (clustered, multi-VM)'\\n  }\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nicName_0_numberOfInstances 'Microsoft.Network/networkInterfaces@2022-07-01' = [\\n  for i in range(0, length(range(0, numberOfInstances))): {\\n    name: '${nicName}${range(0,numberOfInstances)[i]}'\\n    location: location\\n    tags: {\\n      QuickstartName: 'JBoss EAP on RHEL (clustered, multi-VM)'\\n    }\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig1'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            subnet: {\\n              id: reference(virtualNetwork.id, '2022-07-01').subnets[0].id\\n            }\\n            loadBalancerBackendAddressPools: [\\n              {\\n                id: reference(loadBalancers.id, '2022-07-01').backendAddressPools[0].id\\n              }\\n            ]\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      loadBalancers\\n      virtualNetwork\\n    ]\\n  }\\n]\\n\\nresource vmName_0_numberOfInstances 'Microsoft.Compute/virtualMachines@2022-08-01' = [\\n  for i in range(0, length(range(0, numberOfInstances))): {\\n    name: '${vmName}${range(0,numberOfInstances)[i]}'\\n    location: location\\n    plan: ((rhelOSLicenseType == 'PAYG') ? json('null') : plan)\\n    tags: {\\n      QuickstartName: 'JBoss EAP on RHEL (clustered, multi-VM)'\\n    }\\n    properties: {\\n      availabilitySet: {\\n        id: availabilitySet.id\\n      }\\n      hardwareProfile: {\\n        vmSize: vmSize\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId(\\n              'Microsoft.Network/networkInterfaces',\\n              '${nicName}${range(0,numberOfInstances)[range(0,numberOfInstances)[i]]}'\\n            )\\n          }\\n        ]\\n      }\\n      osProfile: {\\n        computerName: '${vmName}${range(0,numberOfInstances)[i]}'\\n        adminUsername: adminUsername\\n        adminPassword: adminPasswordOrSSHKey\\n        linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n      }\\n      storageProfile: {\\n        osDisk: {\\n          createOption: 'FromImage'\\n        }\\n        imageReference: imageReference\\n      }\\n      diagnosticsProfile: {\\n        bootDiagnostics: {\\n          enabled: true\\n          storageUri: reference(bootStorageAccount.id, '2022-09-01').primaryEndpoints.blob\\n        }\\n      }\\n    }\\n    dependsOn: [\\n      availabilitySet\\n      bootStorageAccount\\n      nicName_0_numberOfInstances\\n      storageAccount\\n    ]\\n  }\\n]\\n\\nresource vmName_0_numberOfInstances_jbosseap_setup_extension_0_numberOfInstances 'Microsoft.Compute/virtualMachines/extensions@2022-08-01' = [\\n  for i in range(0, length(range(0, numberOfInstances))): {\\n    name: '${vmName}${range(0,numberOfInstances)[i]}/jbosseap-setup-extension-${range(0,numberOfInstances)[i]}'\\n    location: location\\n    tags: {\\n      QuickstartName: 'JBoss EAP on RHEL (clustered, multi-VM)'\\n    }\\n    properties: {\\n      publisher: 'Microsoft.Azure.Extensions'\\n      type: 'CustomScript'\\n      typeHandlerVersion: '2.0'\\n      autoUpgradeMinorVersion: true\\n      settings: {\\n        fileUris: [\\n          uri(_artifactsLocation, 'scripts/jbosseap-setup-redhat.sh${_artifactsLocationSasToken}')\\n        ]\\n      }\\n      protectedSettings: {\\n        commandToExecute: 'sh jbosseap-setup-redhat.sh ${scriptArgs} ${jbossEAPUserName} \\\\'${jbossEAPPassword}\\\\' ${rhelOSLicenseType} ${rhsmUserName} \\\\'${rhsmPassword}\\\\' ${rhsmPoolEAP} ${storageAccountName} ${containerName} ${base64(listKeys(storageAccount.id,'2021-02-01').keys[0].value)} ${javaVersion} ${rhsmPoolRHEL}'\\n      }\\n    }\\n    dependsOn: [\\n      storageAccount\\n    ]\\n  }\\n]\\n\\nresource loadBalancers 'Microsoft.Network/loadBalancers@2022-07-01' = {\\n  name: loadBalancersName\\n  location: location\\n  sku: {\\n    name: 'Basic'\\n  }\\n  tags: {\\n    QuickstartName: 'JBoss EAP on RHEL (clustered, multi-VM)'\\n  }\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: frontendName\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          privateIPAddressVersion: 'IPv4'\\n          subnet: {\\n            id: reference(virtualNetwork.id, '2022-07-01').subnets[0].id\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: backendPoolName\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        name: '${loadBalancersName}-rule1'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', loadBalancersName, frontendName)\\n          }\\n          frontendPort: 80\\n          backendPort: 8080\\n          enableFloatingIP: false\\n          idleTimeoutInMinutes: 5\\n          protocol: 'Tcp'\\n          enableTcpReset: false\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadBalancersName, backendPoolName)\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadBalancersName, healthProbeEAP)\\n          }\\n        }\\n      }\\n      {\\n        name: '${loadBalancersName}-rule2'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', loadBalancersName, frontendName)\\n          }\\n          frontendPort: 9990\\n          backendPort: 9990\\n          enableFloatingIP: false\\n          idleTimeoutInMinutes: 5\\n          protocol: 'Tcp'\\n          enableTcpReset: false\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadBalancersName, backendPoolName)\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadBalancersName, healthProbeAdmin)\\n          }\\n        }\\n      }\\n    ]\\n    probes: [\\n      {\\n        name: healthProbeEAP\\n        properties: {\\n          protocol: 'Tcp'\\n          port: 8080\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n      }\\n      {\\n        name: healthProbeAdmin\\n        properties: {\\n          protocol: 'Tcp'\\n          port: 9990\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource availabilitySet 'Microsoft.Compute/availabilitySets@2022-08-01' = {\\n  name: availabilitySetName\\n  location: location\\n  sku: {\\n    name: skuName\\n  }\\n  tags: {\\n    QuickstartName: 'JBoss EAP on RHEL (clustered, multi-VM)'\\n  }\\n  properties: {\\n    platformUpdateDomainCount: 2\\n    platformFaultDomainCount: 2\\n  }\\n}\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: storageReplication\\n  }\\n  kind: 'Storage'\\n  tags: {\\n    QuickstartName: 'JBoss EAP on RHEL (clustered, multi-VM)'\\n  }\\n}\\n\\nresource storageAccountName_default_container 'Microsoft.Storage/storageAccounts/blobServices/containers@2022-09-01' = {\\n  name: '${storageAccountName}/default/${containerName}'\\n  dependsOn: [\\n    storageAccount\\n  ]\\n}\\n\\nmodule guid './nested_guid.bicep' = {\\n  name: guidName\\n  params: {}\\n}\\n\\noutput appURL string = uri(\\n  'http://${reference(loadBalancers.id,'2022-07-01').frontendIPConfigurations[0].properties.privateIPAddress}',\\n  '/eap-session-replication/'\\n)\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"password\\\"\\n    },\\n    \\\"adminPasswordOrSSHKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"jbossEAPUserName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"jbossEAPPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"rhelOSLicenseType\\\": {\\n      \\\"value\\\": \\\"PAYG\\\"\\n    },\\n    \\\"rhsmUserName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"rhsmPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"rhsmPoolEAP\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"rhsmPoolRHEL\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"javaVersion\\\": {\\n      \\\"value\\\": \\\"JAVA_8\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"storageReplication\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"numberOfInstances\\\": {\\n      \\\"value\\\": 2\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('User name for the Jenkins Virtual Machine.')\\n@minLength(1)\\nparam jenkinsVMAdminUsername string\\n\\n@description('Unique DNS Name for the Public IP used to access the Jenkins Virtual Machine.')\\n@minLength(3)\\nparam jenkinsDnsPrefix string\\n\\n@description('The Jenkins release type.')\\n@allowed([\\n  'LTS'\\n  'weekly'\\n  'verified'\\n])\\nparam jenkinsReleaseType string = 'LTS'\\n\\n@description('GitHub repository URL for the source code.')\\n@minLength(1)\\nparam repositoryUrl string = 'https://github.com/Azure/azure-quickstart-templates'\\n\\n@description('Client id for Azure service principal.')\\n@minLength(1)\\nparam clientId string\\n\\n@description('Client secret for Azure service principal.')\\n@minLength(1)\\n@secure()\\nparam clientSecret string\\n\\n@description('Prefix name for web app components, accepts numbers and letters only.')\\n@minLength(3)\\nparam appDnsPrefix string\\n\\n@description('User name for MySQL admin login.')\\n@minLength(3)\\nparam mySqlAdminLogin string\\n\\n@description('Password for MySQL admin login.')\\n@minLength(6)\\n@secure()\\nparam mySqlAdminPassword string\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = 'https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/jenkins/jenkins-cicd-webapp/'\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\nvar storageAccountName = '${toLower(appDnsPrefix)}storage'\\nvar servicePlanName = '${appDnsPrefix}ServicePlan'\\nvar webAppName = '${appDnsPrefix}Web'\\nvar appInsightsName = '${appDnsPrefix}AppInsights'\\nvar mySqlServerName = '${toLower(appDnsPrefix)}mysqlserver'\\nvar mySqlDbName = '${toLower(appDnsPrefix)}mysqldb'\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2017-06-01' = {\\n  sku: {\\n    name: 'Standard_RAGRS'\\n  }\\n  kind: 'Storage'\\n  name: storageAccountName\\n  location: location\\n  properties: {}\\n}\\n\\nresource servicePlan 'Microsoft.Web/serverfarms@2016-09-01' = {\\n  sku: {\\n    name: 'B1'\\n  }\\n  kind: 'app'\\n  name: servicePlanName\\n  location: location\\n  properties: {\\n    name: servicePlanName\\n  }\\n}\\n\\nresource webApp 'Microsoft.Web/sites@2016-08-01' = {\\n  kind: 'app'\\n  name: webAppName\\n  location: location\\n  properties: {\\n    serverFarmId: servicePlan.id\\n  }\\n}\\n\\nresource webAppName_web 'Microsoft.Web/sites/config@2016-08-01' = {\\n  parent: webApp\\n  name: 'web'\\n  location: location\\n  properties: {\\n    javaVersion: '1.8'\\n    javaContainer: 'TOMCAT'\\n    javaContainerVersion: '9.0'\\n  }\\n}\\n\\nresource webAppName_connectionstrings 'Microsoft.Web/sites/config@2016-08-01' = {\\n  parent: webApp\\n  name: 'connectionstrings'\\n  properties: {\\n    defaultConnection: {\\n      value: 'Database=${mySqlDbName};Data Source=${mySqlServer.properties.fullyQualifiedDomainName};User Id=${mySqlAdminLogin}@${mySqlServerName};Password=${mySqlAdminPassword}'\\n      type: 'MySql'\\n    }\\n  }\\n}\\n\\nresource appInsights 'microsoft.insights/components@2015-05-01' = {\\n  kind: 'java'\\n  name: appInsightsName\\n  location: 'eastus'\\n  tags: {\\n    'hidden-link:${resourceGroup().id}/providers/Microsoft.Web/sites/${webAppName}': 'Resource'\\n  }\\n  properties: {\\n    ApplicationId: appInsightsName\\n  }\\n}\\n\\nresource mySqlServer 'Microsoft.DBforMySQL/servers@2017-12-01' = {\\n  location: location\\n  name: mySqlServerName\\n  properties: {\\n    version: '5.7'\\n    storageMB: 51200\\n    administratorLogin: mySqlAdminLogin\\n    administratorLoginPassword: mySqlAdminPassword\\n  }\\n  sku: {\\n    name: 'B_Gen5_2'\\n    tier: 'Basic'\\n    capacity: 2\\n  }\\n}\\n\\nresource mySqlServerName_mySqlServerName_Firewall 'Microsoft.DBforMySQL/servers/firewallrules@2017-12-01' = {\\n  parent: mySqlServer\\n  location: location\\n  name: '${mySqlServerName}Firewall'\\n  properties: {\\n    startIpAddress: '0.0.0.0'\\n    endIpAddress: '255.255.255.255'\\n  }\\n}\\n\\nresource mySqlServerName_mySqlDb 'Microsoft.DBforMySQL/servers/databases@2017-12-01' = {\\n  parent: mySqlServer\\n  name: '${mySqlDbName}'\\n  properties: {\\n    charset: 'utf8'\\n    collation: 'utf8_general_ci'\\n  }\\n}\\n\\nmodule jenkinsDeployment '?' /*TODO: replace with correct path to [uri(parameters('_artifactsLocation'), concat('nested/jenkins.json', parameters('_artifactsLocationSasToken')))]*/ = {\\n  name: 'jenkinsDeployment'\\n  params: {\\n    adminUsername: jenkinsVMAdminUsername\\n    dnsPrefix: jenkinsDnsPrefix\\n    jenkinsReleaseType: jenkinsReleaseType\\n    repositoryUrl: repositoryUrl\\n    clientId: clientId\\n    clientSecret: clientSecret\\n    storageAccountName: storageAccountName\\n    storageAccountKey: listKeys(storageAccount.id, '2016-01-01').keys[0].value\\n    webAppName: webAppName\\n    _artifactsLocation: _artifactsLocation\\n    _artifactsLocationSasToken: _artifactsLocationSasToken\\n    authenticationType: authenticationType\\n    adminPasswordOrKey: adminPasswordOrKey\\n  }\\n}\\n\\noutput jenkinsURL string = jenkinsDeployment.properties.outputs.jenkinsURL.value\\noutput jenkinsSSH string = jenkinsDeployment.properties.outputs.jenkinsSSH.value\\noutput webAppURL string = 'http://${webApp.properties.defaultHostName}'\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"jenkinsVMAdminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"jenkinsDnsPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"jenkinsReleaseType\\\": {\\n      \\\"value\\\": \\\"LTS\\\"\\n    },\\n    \\\"repositoryUrl\\\": {\\n      \\\"value\\\": \\\"'https:\\\"\\n    },\\n    \\\"clientId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"clientSecret\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"appDnsPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"mySqlAdminLogin\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"mySqlAdminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"'https:\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Password for bal account')\\n@secure()\\nparam balPassword string\\n\\n@description('Username for bal account')\\nparam balUsername string\\n\\n@description('Name of the resource group that contains the existing virutal network.')\\nparam existingvirtualNetworkResourceGroup string\\n\\n@description('Name of the existing virutal network the KEMP LoadMaster will be deployed to.')\\nparam existingvirtualNetworkName string\\n\\n@description('Name of the existing subnet in the virtual network you want to use')\\nparam existingsubnetName1 string\\n\\n@description('Name of the existing subnet in the virtual network you want to use')\\nparam existingsubnetName2 string\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Size of the VM.')\\nparam vmSize string = 'Standard_A2_V2'\\n\\nvar publicIPAddressType = 'Dynamic'\\nvar vmName = 'VLM-MultiNIC'\\nvar subnetRef1 = resourceId(\\n  existingvirtualNetworkResourceGroup,\\n  'Microsoft.Network/virtualNetworks/subnets',\\n  existingvirtualNetworkName,\\n  existingsubnetName1\\n)\\nvar subnetRef2 = resourceId(\\n  existingvirtualNetworkResourceGroup,\\n  'Microsoft.Network/virtualNetworks/subnets',\\n  existingvirtualNetworkName,\\n  existingsubnetName2\\n)\\nvar nicName1 = 'NIC1'\\nvar nicName2 = 'NIC2'\\nvar dnsNameForPublicIP = 'vlm${uniqueString(resourceGroup().id)}'\\nvar imageOffer = 'vlm-azure'\\nvar imagePublisher = 'kemptech'\\nvar imageVersion = 'latest'\\nvar imageSKU = 'basic-byol'\\nvar publicIPAddressName = vmName\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2019-11-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  tags: {\\n    displayName: 'PublicIPAddress'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsNameForPublicIP\\n    }\\n  }\\n}\\n\\nresource nic1 'Microsoft.Network/networkInterfaces@2019-11-01' = {\\n  name: nicName1\\n  location: location\\n  tags: {\\n    displayName: 'NetworkInterface'\\n  }\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef1\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic2 'Microsoft.Network/networkInterfaces@2019-11-01' = {\\n  name: nicName2\\n  location: location\\n  tags: {\\n    displayName: 'NetworkInterface2'\\n  }\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: subnetRef2\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2019-12-01' = {\\n  name: vmName\\n  location: location\\n  tags: {\\n    displayName: 'VirtualMachine'\\n  }\\n  plan: {\\n    name: imageSKU\\n    product: imageOffer\\n    publisher: imagePublisher\\n  }\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: balUsername\\n      adminPassword: balPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: imageSKU\\n        version: imageVersion\\n      }\\n      osDisk: {\\n        name: '${vmName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic1.id\\n          properties: {\\n            primary: true\\n          }\\n        }\\n        {\\n          id: nic2.id\\n          properties: {\\n            primary: false\\n          }\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\noutput FQDN string = reference(publicIPAddress.id, '2019-11-01').dnsSettings.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"balPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"balUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingvirtualNetworkResourceGroup\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingvirtualNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingsubnetName1\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingsubnetName2\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_A2_V2\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Administrator user name used when provisioning virtual machines (which also becomes a system user administrator in MongoDB)')\\nparam adminUsername string\\n\\n@description('Administrator password used when provisioning virtual machines (which is also a password for the system administrator in MongoDB)')\\n@secure()\\nparam adminPassword string\\n\\n@description('Unique namespace for the Storage Account where the Virtual Machine\\\\'s disks will be placed (this name will be used as a prefix to create one or more storage accounts as per t-shirt size)')\\nparam storageAccountNamePrefix string = ''\\n\\n@description('Storage account type to be provisioned')\\n@allowed([\\n  'Standard_LRS'\\n  'Premium_LRS'\\n])\\nparam storageAccountType string = 'Standard_LRS'\\n\\n@description('Virtual machine series to use for data nodes in cluster')\\n@allowed([\\n  'D'\\n  'DS'\\n])\\nparam vmSeries string = 'D'\\n\\n@description('The arbitrary name of the virtual network provisioned for the MongoDB deployment')\\nparam virtualNetworkName string = 'mongodbVnet'\\n\\n@description('Subnet name for the virtual network that resources will be provisioned in to')\\nparam subnetName string = 'mongodbSubnet'\\n\\n@description('The network address space for the virtual network')\\nparam addressPrefix string = '10.0.0.0/16'\\n\\n@description('The network address space for the virtual subnet')\\nparam subnetPrefix string = '10.0.0.0/24'\\n\\n@description('The IP address prefix that will be used for constructing a static private IP address for each node in the cluster')\\nparam nodeAddressPrefix string = '10.0.0.1'\\n\\n@description('The flag allowing to enable or disable provisioning of the jumpbox VM that can be used to access the MongoDB environment')\\n@allowed([\\n  'Enabled'\\n  'Disabled'\\n])\\nparam jumpbox string = 'Disabled'\\n\\n@description('T-shirt size of the MongoDB deployment')\\n@allowed([\\n  'XSmall'\\n  'Small'\\n  'Medium'\\n  'Large'\\n  'XLarge'\\n  'XXLarge'\\n])\\nparam tshirtSize string = 'XSmall'\\n\\n@description('The target OS for the virtual machines running MongoDB')\\n@allowed([\\n  'Ubuntu'\\n])\\nparam osFamily string = 'Ubuntu'\\n\\n@description('The name of the MongoDB replica set')\\nparam replicaSetName string = 'rs0'\\n\\n@description('The shared secret key for the MongoDB replica set')\\nparam replicaSetKey string\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar osFamily_var = {\\n  Ubuntu: {\\n    osName: 'ubuntu'\\n    installerBaseUrl: 'http://repo.mongodb.org/apt/ubuntu'\\n    installerPackages: 'mongodb-org'\\n    installerVersion: '4.0.2'\\n    imagePublisher: 'Canonical'\\n    imageOffer: 'UbuntuServer'\\n    imageSKU: '14.04.5-LTS'\\n  }\\n}\\nvar tshirtSizeTypes = {\\n  XSmall: {\\n    vmSizeMember: 'Standard_${vmSeries}1_v2'\\n    vmSizeArbiter: 'Standard_${vmSeries}1_v2'\\n    numberOfMembers: 1\\n    totalMemberCount: 2\\n    arbiter: 'Enabled'\\n    vmTemplate: uri(_artifactsLocation, 'member-resources-D1.json${_artifactsLocationSasToken}')\\n    storageAccountCount: 1\\n    dataDiskSize: 128\\n  }\\n  Small: {\\n    vmSizeMember: 'Standard_${vmSeries}1_v2'\\n    vmSizeArbiter: 'Standard_${vmSeries}1_v2'\\n    numberOfMembers: 2\\n    totalMemberCount: 3\\n    arbiter: 'Disabled'\\n    vmTemplate: uri(_artifactsLocation, 'member-resources-D1.json${_artifactsLocationSasToken}')\\n    storageAccountCount: 1\\n    dataDiskSize: 128\\n  }\\n  Medium: {\\n    vmSizeMember: 'Standard_${vmSeries}2_v2'\\n    vmSizeArbiter: 'Standard_${vmSeries}1_v2'\\n    numberOfMembers: 3\\n    totalMemberCount: 4\\n    arbiter: 'Enabled'\\n    vmTemplate: uri(_artifactsLocation, 'member-resources-D2.json${_artifactsLocationSasToken}')\\n    storageAccountCount: 2\\n    dataDiskSize: 256\\n  }\\n  Large: {\\n    vmSizeMember: 'Standard_${vmSeries}2_v2'\\n    vmSizeArbiter: 'Standard_${vmSeries}1_v2'\\n    numberOfMembers: 7\\n    totalMemberCount: 8\\n    arbiter: 'Enabled'\\n    vmTemplate: uri(_artifactsLocation, 'member-resources-D2.json${_artifactsLocationSasToken}')\\n    storageAccountCount: 4\\n    dataDiskSize: 256\\n  }\\n  XLarge: {\\n    vmSizeMember: 'Standard_${vmSeries}3_v2'\\n    vmSizeArbiter: 'Standard_${vmSeries}1_v2'\\n    numberOfMembers: 7\\n    totalMemberCount: 8\\n    arbiter: 'Enabled'\\n    vmTemplate: uri(_artifactsLocation, 'member-resources-D3.json${_artifactsLocationSasToken}')\\n    storageAccountCount: 4\\n    dataDiskSize: 512\\n  }\\n  XXLarge: {\\n    vmSizeMember: 'Standard_${vmSeries}3_v2'\\n    vmSizeArbiter: 'Standard_${vmSeries}1_v2'\\n    numberOfMembers: 15\\n    totalMemberCount: 16\\n    arbiter: 'Disabled'\\n    vmTemplate: uri(_artifactsLocation, 'member-resources-D3.json${_artifactsLocationSasToken}')\\n    storageAccountCount: 8\\n    dataDiskSize: 512\\n  }\\n}\\nvar vmStorageAccountContainerName = 'vhd-mongodb'\\nvar sharedScriptUrl = 'https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/${osFamilySpec.osName}/'\\nvar jumpboxTemplate = {\\n  Enabled: 'jumpbox-resources.json'\\n  Disabled: 'empty-resources.json'\\n}\\nvar arbiterTemplate = {\\n  Enabled: 'arbiter-resources.json'\\n  Disabled: 'empty-resources.json'\\n}\\nvar sharedTemplateUrl = uri(_artifactsLocation, 'shared-resources.json${_artifactsLocationSasToken}')\\nvar jumpboxTemplateUrl = uri(_artifactsLocation, concat(jumpboxTemplate.Enabled, _artifactsLocationSasToken))\\nvar emptyResourcesTemplateUrl = uri(_artifactsLocation, concat(jumpboxTemplate.Disabled, _artifactsLocationSasToken))\\nvar arbiterTemplateUrl = uri(\\n  _artifactsLocation,\\n  concat(arbiterTemplate[clusterSpec.arbiter], _artifactsLocationSasToken)\\n)\\nvar commonSettings = {\\n  availabilitySetName: 'mongodbAvailSet'\\n}\\nvar storageSettings = {\\n  vhdStorageAccountName: storageAccountNamePrefix\\n  vhdContainerName: vmStorageAccountContainerName\\n  vmSeries: vmSeries\\n  destinationVhdsContainer: 'https://${storageAccountNamePrefix}${environment().suffixes.storage}/${vmStorageAccountContainerName}/'\\n  storageAccountCount: clusterSpec.storageAccountCount\\n  storageAccountType: storageAccountType\\n}\\nvar networkSettings = {\\n  virtualNetworkName: virtualNetworkName\\n  addressPrefix: addressPrefix\\n  subnetName: subnetName\\n  subnetPrefix: subnetPrefix\\n  subnetRef: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\n  machineIpPrefix: nodeAddressPrefix\\n}\\nvar machineSettings = {\\n  adminUsername: adminUsername\\n  adminPassword: adminPassword\\n  machineNamePrefix: 'mongodb-'\\n  osImageReference: {\\n    publisher: osFamilySpec.imagePublisher\\n    offer: osFamilySpec.imageOffer\\n    sku: osFamilySpec.imageSKU\\n    version: 'latest'\\n  }\\n}\\nvar clusterSpec = tshirtSizeTypes[tshirtSize]\\nvar osFamilySpec = osFamily_var[osFamily]\\nvar installCommand = 'bash mongodb-${osFamilySpec.osName}-install.sh -i ${osFamilySpec.installerBaseUrl} -b ${osFamilySpec.installerPackages} -v ${osFamilySpec.installerVersion} -r ${replicaSetName} -k ${replicaSetKey} -u ${adminUsername} -p ${adminPassword} -x ${networkSettings.machineIpPrefix} -n ${clusterSpec.totalMemberCount}'\\nvar vmScripts = {\\n  scriptsToDownload: [\\n    uri(_artifactsLocation, 'mongodb-${osFamilySpec.osName}-install.sh${_artifactsLocationSasToken}')\\n    '${sharedScriptUrl}vm-disk-utils-0.1.sh'\\n  ]\\n  regularNodeInstallCommand: installCommand\\n  lastNodeInstallCommand: '${installCommand} -l'\\n  arbiterNodeInstallCommand: '${installCommand} -a'\\n}\\n\\nmodule shared_resources '?' /*TODO: replace with correct path to [variables('sharedTemplateUrl')]*/ = {\\n  name: 'shared-resources'\\n  params: {\\n    commonSettings: commonSettings\\n    storageSettings: storageSettings\\n    networkSettings: networkSettings\\n    location: location\\n  }\\n}\\n\\nmodule jumpbox_resources '?' /*TODO: replace with correct path to [variables('jumpboxTemplateUrl')]*/ = if (jumpbox == 'Enabled') {\\n  name: 'jumpbox-resources'\\n  params: {\\n    storageSettings: {\\n      vhdStorageAccountName: '${storageSettings.vhdStorageAccountName}0'\\n      vhdContainerName: storageSettings.vhdContainerName\\n      vmSeries: vmSeries\\n      destinationVhdsContainer: 'https://${storageSettings.vhdStorageAccountName}0${environment().suffixes.storage}/${storageSettings.vhdContainerName}/'\\n    }\\n    networkSettings: networkSettings\\n    machineSettings: machineSettings\\n    location: location\\n  }\\n  dependsOn: [\\n    shared_resources\\n  ]\\n}\\n\\nmodule empty_resources '?' /*TODO: replace with correct path to [variables('emptyResourcesTemplateUrl')]*/ = if (jumpbox == 'Disabled') {\\n  name: 'empty-resources'\\n  params: {}\\n  dependsOn: [\\n    shared_resources\\n  ]\\n}\\n\\nmodule member_resources '?' /*TODO: replace with correct path to [variables('clusterSpec').vmTemplate]*/ = [\\n  for i in range(0, clusterSpec.numberOfMembers): {\\n    name: 'member-resources${i}'\\n    params: {\\n      commonSettings: commonSettings\\n      networkSettings: networkSettings\\n      machineSettings: {\\n        adminUsername: machineSettings.adminUsername\\n        adminPassword: machineSettings.adminPassword\\n        machineNamePrefix: machineSettings.machineNamePrefix\\n        osImageReference: machineSettings.osImageReference\\n        vmSize: clusterSpec.vmSizeMember\\n        dataDiskSize: clusterSpec.dataDiskSize\\n        machineIndex: i\\n        vmScripts: vmScripts.scriptsToDownload\\n        commandToExecute: vmScripts.regularNodeInstallCommand\\n      }\\n      location: location\\n    }\\n    dependsOn: [\\n      shared_resources\\n    ]\\n  }\\n]\\n\\nmodule lastmember_resources '?' /*TODO: replace with correct path to [variables('clusterSpec').vmTemplate]*/ = {\\n  name: 'lastmember-resources'\\n  params: {\\n    commonSettings: commonSettings\\n    networkSettings: networkSettings\\n    machineSettings: {\\n      adminUsername: machineSettings.adminUsername\\n      adminPassword: machineSettings.adminPassword\\n      machineNamePrefix: machineSettings.machineNamePrefix\\n      osImageReference: machineSettings.osImageReference\\n      vmSize: clusterSpec.vmSizeMember\\n      dataDiskSize: clusterSpec.dataDiskSize\\n      machineIndex: clusterSpec.numberOfMembers\\n      vmScripts: vmScripts.scriptsToDownload\\n      commandToExecute: vmScripts.lastNodeInstallCommand\\n    }\\n    location: location\\n  }\\n  dependsOn: [\\n    member_resources\\n  ]\\n}\\n\\nmodule arbiter_resources '?' /*TODO: replace with correct path to [variables('arbiterTemplateUrl')]*/ = {\\n  name: 'arbiter-resources'\\n  params: {\\n    networkSettings: networkSettings\\n    machineSettings: {\\n      adminUsername: machineSettings.adminUsername\\n      adminPassword: machineSettings.adminPassword\\n      machineNamePrefix: machineSettings.machineNamePrefix\\n      osImageReference: machineSettings.osImageReference\\n      vmSize: clusterSpec.vmSizeArbiter\\n      vmScripts: vmScripts.scriptsToDownload\\n      commandToExecute: concat(vmScripts.arbiterNodeInstallCommand)\\n    }\\n    location: location\\n  }\\n  dependsOn: [\\n    lastmember_resources\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"storageAccountNamePrefix\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"storageAccountType\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"vmSeries\\\": {\\n      \\\"value\\\": \\\"D\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"mongodbVnet\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"mongodbSubnet\\\"\\n    },\\n    \\\"addressPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"subnetPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/24\\\"\\n    },\\n    \\\"nodeAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.1\\\"\\n    },\\n    \\\"jumpbox\\\": {\\n      \\\"value\\\": \\\"Disabled\\\"\\n    },\\n    \\\"tshirtSize\\\": {\\n      \\\"value\\\": \\\"XSmall\\\"\\n    },\\n    \\\"osFamily\\\": {\\n      \\\"value\\\": \\\"Ubuntu\\\"\\n    },\\n    \\\"replicaSetName\\\": {\\n      \\\"value\\\": \\\"rs0\\\"\\n    },\\n    \\\"replicaSetKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Default location for the resources')\\nparam location string\\n\\n@description('user name to ssh to the VMs')\\nparam adminUsername string\\n\\n@description('password to ssh to the VMs')\\n@secure()\\nparam adminPassword string\\n\\n@description('virtual network name for the cluster')\\nparam virtualNetworkName string = 'pxcvnet'\\n\\n@description('subnet name for the MySQL nodes')\\nparam dbSubnetName string = 'dbsubnet'\\n\\n@description('IP address in CIDR for virtual network')\\nparam vnetAddressPrefix string = '10.0.0.0/16'\\n\\n@description('IP address in CIDR for db subnet')\\nparam dbSubnetAddressPrefix string = '10.0.1.0/24'\\n\\n@description('IP Addresses for the 3 VMs')\\n@maxLength(3)\\nparam vmIPs array = [\\n  '10.0.1.4'\\n  '10.0.1.5'\\n  '10.0.1.6'\\n]\\n\\n@description('host name prefix for the VMs')\\nparam vmNamePrefix string = 'pxcnd'\\n\\n@description('publisher for the VM OS image')\\n@allowed([\\n  'OpenLogic'\\n  'Canonical'\\n])\\nparam imagePublisher string = 'OpenLogic'\\n\\n@description('VM OS name')\\n@allowed([\\n  'CentOS'\\n  'UbuntuServer'\\n])\\nparam imageOffer string = 'CentOS'\\n\\n@description('VM OS version')\\nparam imageSKU string = '6.10'\\n\\n@description('bash script command line')\\nparam customScriptCommandToExecute string = 'bash azurepxc.sh'\\n\\n@description('Storage account type for the data disks')\\n@allowed([\\n  'Standard_LRS'\\n  'Premium_LRS'\\n])\\nparam storageAccountType string = 'Standard_LRS'\\n\\n@description('Linked Templates base url')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Default VM Size')\\nparam vmSize string = 'Standard_A1_v2'\\n\\nvar customScriptFilePath = uri(_artifactsLocation, 'azurepxc.sh${_artifactsLocationSasToken}')\\nvar mysqlConfigFilePath = uri(_artifactsLocation, 'my.cnf.template${_artifactsLocationSasToken}')\\nvar dbSubnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets/', virtualNetworkName, dbSubnetName)\\nvar publicIpAddressName = 'pip'\\nvar pxcClusterAddress = '${vmIPs[0]},${vmIPs[1]},${vmIPs[2]}'\\nvar customScriptCommandCommon = '${customScriptCommandToExecute} ${pxcClusterAddress} '\\nvar customScriptParam = [\\n  '${vmIPs[0]} bootstrap-pxc ${mysqlConfigFilePath}'\\n  '${vmIPs[1]} start ${mysqlConfigFilePath}'\\n  '${vmIPs[1]} start ${mysqlConfigFilePath}'\\n]\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetAddressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: dbSubnetName\\n        properties: {\\n          addressPrefix: dbSubnetAddressPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2017-08-01' = [\\n  for i in range(0, 3): {\\n    name: concat(publicIpAddressName, i)\\n    location: location\\n    zones: [\\n      (i + 1)\\n    ]\\n    sku: {\\n      name: 'Standard'\\n    }\\n    properties: {\\n      publicIPAllocationMethod: 'Static'\\n      publicIPAddressVersion: 'IPv4'\\n    }\\n  }\\n]\\n\\nresource nic_1 'Microsoft.Network/networkInterfaces@2017-08-01' = [\\n  for i in range(0, 3): {\\n    name: 'nic-${(i+1)}'\\n    location: location\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig1'\\n          properties: {\\n            privateIPAllocationMethod: 'Static'\\n            privateIPAddress: vmIPs[i]\\n            publicIPAddress: {\\n              id: resourceId('Microsoft.Network/publicIPAddresses', concat(publicIpAddressName, i))\\n            }\\n            subnet: {\\n              id: dbSubnetRef\\n            }\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      virtualNetwork\\n      publicIPAddress\\n    ]\\n  }\\n]\\n\\nresource disk_1 'Microsoft.Compute/disks@2017-03-30' = [\\n  for i in range(0, 6): {\\n    name: 'disk-${(i+1)}'\\n    location: location\\n    sku: {\\n      name: storageAccountType\\n    }\\n    zones: [\\n      ((i / 2) + 1)\\n    ]\\n    properties: {\\n      creationData: {\\n        createOption: 'Empty'\\n      }\\n      diskSizeGB: 64\\n    }\\n  }\\n]\\n\\nresource vmNamePrefix_1 'Microsoft.Compute/virtualMachines@2017-03-30' = [\\n  for i in range(0, 3): {\\n    name: '${vmNamePrefix}-${(i+1)}'\\n    location: location\\n    zones: [\\n      (i + 1)\\n    ]\\n    properties: {\\n      hardwareProfile: {\\n        vmSize: vmSize\\n      }\\n      osProfile: {\\n        computerName: '${vmNamePrefix}-${(i+1)}'\\n        adminUsername: adminUsername\\n        adminPassword: adminPassword\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: imagePublisher\\n          offer: imageOffer\\n          sku: imageSKU\\n          version: 'latest'\\n        }\\n        dataDisks: [\\n          for j in range(0, 2): {\\n            lun: j\\n            createOption: 'Attach'\\n            managedDisk: {\\n              id: resourceId('Microsoft.Compute/disks', 'disk-${((i*2)+(j+1))}')\\n            }\\n          }\\n        ]\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkinterfaces', 'nic-${(i+1)}')\\n          }\\n        ]\\n      }\\n    }\\n    dependsOn: [\\n      nic_1\\n    ]\\n  }\\n]\\n\\nresource vmNamePrefix_1_mySQLConfig 'Microsoft.Compute/virtualMachines/extensions@2017-03-30' = [\\n  for i in range(0, 3): {\\n    name: '${vmNamePrefix}-${(i+1)}/mySQLConfig'\\n    location: location\\n    properties: {\\n      publisher: 'Microsoft.Azure.Extensions'\\n      type: 'CustomScript'\\n      typeHandlerVersion: '2.0'\\n      autoUpgradeMinorVersion: true\\n      settings: {\\n        fileUris: [\\n          customScriptFilePath\\n        ]\\n      }\\n      protectedSettings: {\\n        commandToExecute: concat(customScriptCommandCommon, customScriptParam[i])\\n      }\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Compute/virtualMachines', '${vmNamePrefix}-${(i+1)}')\\n    ]\\n  }\\n]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"pxcvnet\\\"\\n    },\\n    \\\"dbSubnetName\\\": {\\n      \\\"value\\\": \\\"dbsubnet\\\"\\n    },\\n    \\\"vnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"dbSubnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.1.0/24\\\"\\n    },\\n    \\\"vmIPs\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"vmNamePrefix\\\": {\\n      \\\"value\\\": \\\"pxcnd\\\"\\n    },\\n    \\\"imagePublisher\\\": {\\n      \\\"value\\\": \\\"OpenLogic\\\"\\n    },\\n    \\\"imageOffer\\\": {\\n      \\\"value\\\": \\\"CentOS\\\"\\n    },\\n    \\\"imageSKU\\\": {\\n      \\\"value\\\": \\\"6.10\\\"\\n    },\\n    \\\"customScriptCommandToExecute\\\": {\\n      \\\"value\\\": \\\"bash azurepxc.sh\\\"\\n    },\\n    \\\"storageAccountType\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_A1_v2\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('SKU for the MySQL PaaS instance to be deployed.')\\nparam sku object\\n\\n@description('Name of the MySQL PaaS instance to be deployed.')\\nparam serverName string\\n\\n@description('Location where the instance should be deployed.')\\nparam location string\\n\\n@description('Number of replica instances to be deployed.')\\nparam numberOfReplicas int\\n\\n@description('Backup retention period.')\\nparam backupRetentionDays int\\n\\n@description('Enable or disable geo redundant backups.')\\nparam geoRedundantBackup string\\n\\n@description('Reference ID of the MySQL PaaS instance being deployed.')\\nparam sourceServerId string\\n\\n@batchSize(1)\\nresource mysqlServer 'Microsoft.DBforMySQL/servers@2017-12-01' = [for i in range(0, ((numberOfReplicas == 0) ? (numberOfReplicas + 1) : numberOfReplicas)): {\\n  sku: sku\\n  name: '${serverName}${(i + 1)}'\\n  location: location\\n  properties: {\\n    createMode: 'Replica'\\n    sourceServerId: sourceServerId\\n    storageProfile: {\\n      storageMB: sku.size\\n      backupRetentionDays: backupRetentionDays\\n      geoRedundantBackup: geoRedundantBackup\\n    }\\n  }\\n}]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"sku\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"serverName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"numberOfReplicas\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"backupRetentionDays\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"geoRedundantBackup\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sourceServerId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location for all resources')\\nparam location string = resourceGroup().location\\n\\n@description('Unique DNS Name for the Public IP used to access the Docker Virtual Machine (master node).')\\nparam dnsNameForJumpBox string = 'jumpbox-${uniqueString(resourceGroup().id)}'\\n\\n@description('The image to use for VMs created. This can be marketplace or custom image')\\n@metadata({ link: 'https://docs.microsoft.com/en-us/nodejs/api/azure-arm-compute/imagereference?view=azure-node-2.2.0' })\\nparam vmImageReference object = {\\n  publisher: 'Canonical'\\n  offer: 'UbuntuServer'\\n  sku: '18.04-LTS'\\n  version: 'latest'\\n}\\n\\n@description('Size of VMs in the VM Scale Set.')\\nparam vmNodeSku string = 'Standard_F8s_v2'\\n\\n@description('Size of the master node.')\\nparam vmMasterSku string = 'Standard_F16s_v2'\\n\\n@description('Choose between a standard disk for and SSD disk for the master node\\\\'s NFS fileshare')\\n@allowed([\\n  'Standard_LRS'\\n  'StandardSSD_LRS'\\n  'Premium_LRS'\\n])\\nparam vmMasterDiskType string = 'Premium_LRS'\\n\\n@description('The SSD Size to be used for the NFS file share. For pricing details see https://azure.microsoft.com/en-us/pricing/details/managed-disks/')\\n@allowed([\\n  32\\n  64\\n  128\\n  256\\n  512\\n  1000\\n  2000\\n  4000\\n  10000\\n])\\nparam vmMasterDiskSize int = 256\\n\\n@description('An additional installs script (bash run as root) to be run after nodes/master are configured. Can be used to mount additional storage or do additional setup')\\nparam vmAdditionalInstallScriptUrl string = ''\\n\\n@description('An argument to be passed to the additional install script')\\nparam vmAdditionalInstallScriptArgument string = ''\\n\\n@description('The install URL for nextflow, this can be used to pin nextflow versions')\\nparam nextflowInstallUrl string = 'https://get.nextflow.io'\\n\\n@description('Number of cluster VM instances (100 or less).')\\n@minValue(1)\\n@maxValue(100)\\nparam instanceCount int = 2\\n\\n@description('Admin username on all VMs.')\\nparam adminUsername string\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'password'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Name of the virtual network to deploy the scale set into.')\\nparam vnetName string = 'nfvnet'\\n\\n@description('Name of the subnet to deploy the scale set into.')\\nparam subnetName string = 'nfsubnet'\\n\\n@description('Azure file share name.')\\nparam shareName string = 'sharedstorage'\\n\\n@description('Path on VM to mount file shares. \\\\'/datadisks/disk1/\\\\' is a Premium Managed disk with high iops, this will suit most uses.')\\nparam mountpointPath string = '/datadisks/disk1'\\n\\n@description('Sets the cluster.maxCpus setting on all cluster nodes')\\nparam nodeMaxCpus int = 2\\n\\n@description('Determines whether to run the custom script extension on a subsequent deployment. Use the defaultValue.')\\nparam forceUpdateTag string = newGuid()\\n\\n@description('*Advanced* This is best left as default unless you are an advanced user. The base URI where artifacts required by this template are located.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('*Advanced* This should be left as default unless you are an advanced user. The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('*Advanced* This should be left as default unless you are an advanced user. The folder in the artifacts location were shared scripts are stored.')\\nparam _diskInitScriptUri string = 'https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/vm-disk-utils-0.1.sh'\\n\\n@description('*Advanced* This should be left as default unless you are an advanced user. The folder in the artifacts location were nextflow scripts are stored.')\\nparam _artifactsNextflowFolder string = 'scripts'\\n\\nvar nextflowInitScript = uri(_artifactsLocation, '${_artifactsNextflowFolder}/init.sh${_artifactsLocationSasToken}')\\nvar jumpboxNICName = 'jumpboxNIC'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar vmssName = 'cluster${uniqueString(dnsNameForJumpBox)}'\\nvar storageAccountType = 'Standard_LRS'\\nvar storageAccountName = 'nfstorage${uniqueString(resourceGroup().id)}'\\nvar storageSuffix = environment().suffixes.storage\\nvar publicIPAddressName = 'jumpboxPublicIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar jumpboxVMName = 'jumpboxVM'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, subnetName)\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar networkSecurityGroupName = 'default-NSG'\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' = {\\n  name: storageAccountName\\n  location: location\\n  kind: 'Storage'\\n  sku: {\\n    name: storageAccountType\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2022-09-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsNameForJumpBox\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2022-09-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'default-allow-22'\\n        properties: {\\n          priority: 1000\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '22'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vnet 'Microsoft.Network/virtualNetworks@2022-09-01' = {\\n  name: vnetName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource jumpboxNIC 'Microsoft.Network/networkInterfaces@2022-09-01' = {\\n  name: jumpboxNICName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n\\n    vnet\\n  ]\\n}\\n\\nresource jumpboxVM 'Microsoft.Compute/virtualMachines@2022-11-01' = {\\n  name: jumpboxVMName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmMasterSku\\n    }\\n    osProfile: {\\n      computerName: jumpboxVMName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: vmImageReference\\n      osDisk: {\\n        createOption: 'FromImage'\\n      }\\n      dataDisks: [\\n        {\\n          lun: 0\\n          name: 'jumpboxdatadisk'\\n          diskSizeGB: vmMasterDiskSize\\n          caching: 'None'\\n          createOption: 'Empty'\\n          managedDisk: {\\n            storageAccountType: vmMasterDiskType\\n          }\\n        }\\n      ]\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: jumpboxNIC.id\\n        }\\n      ]\\n    }\\n  }\\n  dependsOn: [\\n    storageAccount\\n\\n  ]\\n}\\n\\nresource jumpboxVMName_nfinit 'Microsoft.Compute/virtualMachines/extensions@2022-11-01' = {\\n  parent: jumpboxVM\\n  name: 'nfinit'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    forceUpdateTag: forceUpdateTag\\n    settings: {\\n      fileUris: [\\n        nextflowInitScript\\n        _diskInitScriptUri\\n      ]\\n    }\\n    protectedSettings: {\\n      commandToExecute: 'bash init.sh ${storageAccountName} \\\"${storageAccount.listKeys().keys[0].value}\\\" ${shareName} ${storageSuffix} ${mountpointPath} false ${adminUsername} 0 ${nextflowInstallUrl} ${vmAdditionalInstallScriptUrl} ${vmAdditionalInstallScriptArgument}'\\n    }\\n  }\\n}\\n\\nresource vmss 'Microsoft.Compute/virtualMachineScaleSets@2022-11-01' = {\\n  name: vmssName\\n  location: location\\n  sku: {\\n    name: vmNodeSku\\n    capacity: instanceCount\\n  }\\n  properties: {\\n    overprovision: true\\n    upgradePolicy: {\\n      mode: 'Manual'\\n    }\\n    virtualMachineProfile: {\\n      storageProfile: {\\n        osDisk: {\\n          createOption: 'FromImage'\\n          caching: 'ReadWrite'\\n        }\\n        imageReference: vmImageReference\\n      }\\n      osProfile: {\\n        computerNamePrefix: vmssName\\n        adminUsername: adminUsername\\n        adminPassword: adminPasswordOrKey\\n        linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\\n      }\\n      networkProfile: {\\n        networkInterfaceConfigurations: [\\n          {\\n            name: 'nic'\\n            properties: {\\n              primary: true\\n              ipConfigurations: [\\n                {\\n                  name: 'ipconfig'\\n                  properties: {\\n                    subnet: {\\n                      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, subnetName)\\n                    }\\n                  }\\n                }\\n              ]\\n            }\\n          }\\n        ]\\n      }\\n      extensionProfile: {\\n        extensions: [\\n          {\\n            name: 'filesextension'\\n            properties: {\\n              publisher: 'Microsoft.Azure.Extensions'\\n              type: 'CustomScript'\\n              typeHandlerVersion: '2.0'\\n              autoUpgradeMinorVersion: true\\n              forceUpdateTag: forceUpdateTag\\n              settings: {\\n                fileUris: [\\n                  nextflowInitScript\\n                  _diskInitScriptUri\\n                ]\\n              }\\n              protectedSettings: {\\n                commandToExecute: 'bash init.sh ${storageAccountName} \\\"${storageAccount.listKeys().keys[0].value}\\\" ${shareName} ${storageSuffix} ${mountpointPath} true ${adminUsername} ${nodeMaxCpus} ${nextflowInstallUrl} ${vmAdditionalInstallScriptUrl} ${vmAdditionalInstallScriptArgument}'\\n              }\\n            }\\n          }\\n        ]\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    vnet\\n\\n  ]\\n}\\n\\noutput JumpboxConnectionString string = 'ssh ${adminUsername}@${publicIPAddress.properties.dnsSettings.fqdn}'\\noutput ExampleNextflowCommand string = 'nextflow run hello -process.executor ignite -cluster.join path:${mountpointPath}/cifs/cluster -with-timeline runtimeline.html -with-trace -cluster.maxCpus 0'\\noutput ExampleNextflowCommandWithDocker string = 'nextflow run nextflow-io/rnatoy -with-docker -process.executor ignite -cluster.join path:${mountpointPath}/cifs/cluster -with-timeline runtimeline.html -with-trace -cluster.maxCpus 0'\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"dnsNameForJumpBox\\\": {\\n      \\\"value\\\": \\\"jumpbox-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"vmImageReference\\\": {\\n      \\\"value\\\": \\\"{\\\"\\n    },\\n    \\\"vmNodeSku\\\": {\\n      \\\"value\\\": \\\"Standard_F8s_v2\\\"\\n    },\\n    \\\"vmMasterSku\\\": {\\n      \\\"value\\\": \\\"Standard_F16s_v2\\\"\\n    },\\n    \\\"vmMasterDiskType\\\": {\\n      \\\"value\\\": \\\"Premium_LRS\\\"\\n    },\\n    \\\"vmMasterDiskSize\\\": {\\n      \\\"value\\\": 256\\n    },\\n    \\\"vmAdditionalInstallScriptUrl\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"vmAdditionalInstallScriptArgument\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"nextflowInstallUrl\\\": {\\n      \\\"value\\\": \\\"'https:\\\"\\n    },\\n    \\\"instanceCount\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"password\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vnetName\\\": {\\n      \\\"value\\\": \\\"nfvnet\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"nfsubnet\\\"\\n    },\\n    \\\"shareName\\\": {\\n      \\\"value\\\": \\\"sharedstorage\\\"\\n    },\\n    \\\"mountpointPath\\\": {\\n      \\\"value\\\": \\\"/datadisks/disk1\\\"\\n    },\\n    \\\"nodeMaxCpus\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"forceUpdateTag\\\": {\\n      \\\"value\\\": \\\"newGuid()\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"_diskInitScriptUri\\\": {\\n      \\\"value\\\": \\\"'https:\\\"\\n    },\\n    \\\"_artifactsNextflowFolder\\\": {\\n      \\\"value\\\": \\\"scripts\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Administrator username.')\\nparam adminUsername string = 'vagrant'\\n\\n@description('Administrator password. Username is \\\\'vagrant\\\\'.')\\n@secure()\\nparam adminPassword string\\n\\n@description('DNS Label for the Public IP. Must be lowercase. It should match with the following regular expression: ^[a-z][a-z0-9-]{1,61}[a-z0-9]$ or it will raise an error.')\\nparam dnsLabelPrefix string\\n\\n@description('Virtual machine size.')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar openedxVersion = 'open-release/ficus.master'\\nvar scriptDownloadUri = uri(_artifactsLocation, concat(installScript, _artifactsLocationSasToken))\\nvar installScript = 'install-openedx.sh'\\nvar installCommand = 'bash -c \\\\'nohup .${installScript} ${openedxVersion} </dev/null &>/var/log/azure/openedx-install.log &\\\\''\\nvar vmName = 'jumpbox2'\\nvar osImagePublisher = 'Canonical'\\nvar osImageOffer = 'UbuntuServer'\\nvar osImageSKU = '16.04-LTS'\\nvar publicIPAddressName = 'myPublicIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar virtualNetworkName = 'VNET'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar subnetName = 'Subnet'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar nsgName = 'node-nsg'\\nvar nsgID = nsg.id\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-11-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsLabelPrefix\\n    }\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2015-06-15' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: nsgID\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    nsgID\\n  ]\\n}\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2015-06-15' = {\\n  name: nsgName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'ssh'\\n        properties: {\\n          description: 'SSH'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '22'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 200\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'LMS'\\n        properties: {\\n          description: 'HTTP for Open edX LMS'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '8000'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 201\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'CMS'\\n        properties: {\\n          description: 'HTTP for Open edX CMS'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '8001'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 203\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vmName_nic 'Microsoft.Network/networkInterfaces@2015-06-15' = {\\n  name: '${vmName}-nic'\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipConfigNode'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2017-03-30' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: osImagePublisher\\n        offer: osImageOffer\\n        sku: osImageSKU\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmName}-osdisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: vmName_nic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource vmName_installscript 'Microsoft.Compute/virtualMachines/extensions@2015-06-15' = {\\n  parent: vm\\n  name: 'installscript'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        scriptDownloadUri\\n      ]\\n      commandToExecute: installCommand\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"vagrant\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsLabelPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('User name for the Virtual Machine.')\\n@minLength(3)\\nparam adminVMUsername string\\n\\n@description('Globally unique DNS Name for the Public IP used to access the Virtual Machine.')\\n@minLength(3)\\nparam dnsNameForPublicIPName string = 'os${uniqueString(resourceGroup().id)}'\\n\\n@description('Name for the Database.')\\n@minLength(3)\\nparam databaseName string = 'openscholarDB'\\n\\n@description('Provide Password for the My SQL.')\\n@minLength(12)\\n@secure()\\nparam mysqlPassword string\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Default VM Size.')\\nparam vmSize string = 'Standard_D2_v3'\\n\\nvar imagePublisher = 'Canonical'\\nvar imageOffer = 'UbuntuServer'\\nvar nicName = 'scholarVMNic'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'Subnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar publicIPAddressType = 'Dynamic'\\nvar vmName = 'openscholarVM'\\nvar virtualNetworkName = 'scholarVNET'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar installScriptName = 'openDrupal.sh'\\nvar ubuntuOSVersion = '16.04-LTS'\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminVMUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar networkSecurityGroupName = 'default-NSG'\\n\\nresource dnsNameForPublicIP 'Microsoft.Network/publicIPAddresses@2022-07-01' = {\\n  name: dnsNameForPublicIPName\\n  location: location\\n  tags: {\\n    displayName: 'PublicIPAddress'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsNameForPublicIPName\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2022-07-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'default-allow-22'\\n        properties: {\\n          priority: 1000\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '22'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n      {\\n        name: 'default-allow-80'\\n        properties: {\\n          priority: 1001\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '80'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  tags: {\\n    displayName: 'VirtualNetwork'\\n  }\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2022-07-01' = {\\n  name: nicName\\n  location: location\\n  tags: {\\n    displayName: 'NetworkInterface'\\n  }\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: dnsNameForPublicIP.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2022-08-01' = {\\n  name: vmName\\n  location: location\\n  tags: {\\n    displayName: 'VirtualMachine'\\n  }\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminVMUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: ubuntuOSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: 'osdisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource installopenScholar 'Microsoft.Compute/virtualMachines/extensions@2022-08-01' = {\\n  parent: vm\\n  name: 'installopenScholar'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        uri(_artifactsLocation, 'scripts/${installScriptName}${_artifactsLocationSasToken}')\\n      ]\\n    }\\n    protectedSettings: {\\n      commandToExecute: 'mv *.sh /home/${adminVMUsername} && cd /home/${adminVMUsername} && sudo chmod 777 *.sh && sudo -u ${adminVMUsername} /bin/bash ${installScriptName} ${mysqlPassword} ${databaseName}'\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminVMUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsNameForPublicIPName\\\": {\\n      \\\"value\\\": \\\"os${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"databaseName\\\": {\\n      \\\"value\\\": \\\"openscholarDB\\\"\\n    },\\n    \\\"mysqlPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Domain name of the public jumpbox')\\nparam domainName string = 'postgres-${uniqueString(resourceGroup().id)}'\\n\\n@description('Virtual machine administrator username')\\nparam adminUsername string\\n\\n@description('Virtual machine administrator password')\\n@secure()\\nparam adminPassword string\\n\\n@description('T-shirt size of the PostgreSQL deployment')\\n@allowed([\\n  'Small'\\n  'Medium'\\n  'Large'\\n  'XLarge'\\n])\\nparam tshirtSize string = 'Small'\\n\\n@description('The replication password used for PostgreSQL streaming replication')\\n@secure()\\nparam replicatorPassword string\\n\\n@description('The flag allowing to enable or disable provisioning of the jumpbox VM that can be used to access the PostgreSQL environment')\\n@allowed([\\n  'Enabled'\\n  'Disabled'\\n])\\nparam jumpbox string = 'Enabled'\\n\\n@description('Size of the jumpbox VM, ignored if jumbox is disabled.')\\nparam jumpBoxSize string = 'Standard_A1_V2'\\n\\n@description('Virtual network name')\\nparam virtualNetworkName string = 'vnet'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar sharedTemplateUrl = uri(_artifactsLocation, 'shared-resources.json${_artifactsLocationSasToken}')\\nvar deploymentSize = {\\n  Small: {\\n    vmSize: 'Standard_A1_v2'\\n    diskSize: 1023\\n    diskCount: 2\\n    vmCount: 2\\n    slaveCount: 1\\n    storage: {\\n      count: 1\\n      pool: 'db'\\n      map: [\\n        0\\n        0\\n      ]\\n      jumpbox: 0\\n    }\\n  }\\n  Medium: {\\n    vmSize: 'Standard_A2_v2'\\n    diskSize: 1023\\n    diskCount: 8\\n    vmCount: 2\\n    slaveCount: 1\\n    storage: {\\n      count: 2\\n      pool: 'db'\\n      map: [\\n        0\\n        1\\n      ]\\n      jumpbox: 0\\n    }\\n  }\\n  Large: {\\n    vmSize: 'Standard_A4_v2'\\n    diskSize: 1023\\n    diskCount: 16\\n    vmCount: 3\\n    slaveCount: 2\\n    storage: {\\n      count: 2\\n      pool: 'db'\\n      map: [\\n        0\\n        1\\n        1\\n      ]\\n      jumpbox: 0\\n    }\\n  }\\n  XLarge: {\\n    vmSize: 'Standard_A8_v2'\\n    diskSize: 1023\\n    diskCount: 16\\n    vmCount: 4\\n    slaveCount: 3\\n    storage: {\\n      count: 2\\n      pool: 'db'\\n      map: [\\n        0\\n        0\\n        1\\n        1\\n      ]\\n      jumpbox: 0\\n    }\\n  }\\n}\\nvar jumpboxTemplateUrl = uri(_artifactsLocation, 'jumpbox-resources.json${_artifactsLocationSasToken}')\\nvar databaseTemplateUrl = uri(_artifactsLocation, 'database-resources.json${_artifactsLocationSasToken}')\\nvar osSettings = {\\n  scripts: [\\n    uri(_artifactsLocation, 'install_postgresql.sh${_artifactsLocationSasToken}')\\n    'https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/vm-disk-utils-0.1.sh'\\n  ]\\n  imageReference: {\\n    publisher: 'Canonical'\\n    offer: 'UbuntuServer'\\n    sku: '18.04-LTS'\\n    version: 'latest'\\n  }\\n}\\nvar networkSettings = {\\n  vnetName: virtualNetworkName\\n  addressPrefix: '10.0.0.0/16'\\n  subnets: {\\n    dmz: {\\n      name: 'dmz'\\n      prefix: '10.0.0.0/24'\\n      vnet: virtualNetworkName\\n    }\\n    data: {\\n      name: 'data'\\n      prefix: '10.0.1.0/24'\\n      vnet: virtualNetworkName\\n    }\\n  }\\n}\\nvar availabilitySetSettings = {\\n  name: 'pgsqlAvailabilitySet'\\n  fdCount: 2\\n  udCount: 5\\n}\\n\\nmodule shared '?' /*TODO: replace with correct path to [variables('sharedTemplateUrl')]*/ = {\\n  name: 'shared'\\n  params: {\\n    networkSettings: networkSettings\\n    availabilitySetSettings: availabilitySetSettings\\n    location: location\\n  }\\n}\\n\\nmodule master_node '?' /*TODO: replace with correct path to [variables('databaseTemplateUrl')]*/ = {\\n  name: 'master-node'\\n  params: {\\n    location: location\\n    adminPassword: adminPassword\\n    replicatorPassword: replicatorPassword\\n    osSettings: osSettings\\n    subnet: networkSettings.subnets.data\\n    commonSettings: {\\n      adminUsername: adminUsername\\n      namespace: 'ms'\\n    }\\n    machineSettings: {\\n      vmSize: deploymentSize[tshirtSize].vmSize\\n      diskCount: deploymentSize[tshirtSize].diskCount\\n      diskSize: deploymentSize[tshirtSize].diskSize\\n      vmCount: 1\\n      availabilitySet: availabilitySetSettings.name\\n    }\\n    masterIpAddress: '0'\\n    dbType: 'MASTER'\\n  }\\n  dependsOn: [\\n    shared\\n  ]\\n}\\n\\nmodule slave_node '?' /*TODO: replace with correct path to [variables('databaseTemplateUrl')]*/ = {\\n  name: 'slave-node'\\n  params: {\\n    location: location\\n    adminPassword: adminPassword\\n    replicatorPassword: replicatorPassword\\n    osSettings: osSettings\\n    subnet: networkSettings.subnets.data\\n    commonSettings: {\\n      adminUsername: adminUsername\\n      namespace: 'sl'\\n    }\\n    machineSettings: {\\n      vmSize: deploymentSize[tshirtSize].vmSize\\n      diskCount: deploymentSize[tshirtSize].diskCount\\n      diskSize: deploymentSize[tshirtSize].diskSize\\n      vmCount: deploymentSize[tshirtSize].slaveCount\\n      availabilitySet: availabilitySetSettings.name\\n    }\\n    masterIpAddress: master_node.properties.outputs.masterip.value\\n    dbType: 'SLAVE'\\n  }\\n}\\n\\nmodule jumpbox_resource '?' /*TODO: replace with correct path to [variables('jumpboxTemplateUrl')]*/ = if ('Enabled' == jumpbox) {\\n  name: 'jumpbox'\\n  params: {\\n    location: location\\n    dnsName: domainName\\n    commonSettings: {\\n      adminUsername: adminUsername\\n      namespace: 'jumpbox'\\n    }\\n    adminPassword: adminPassword\\n    subnet: networkSettings.subnets.dmz\\n    osSettings: osSettings\\n    vmSize: jumpBoxSize\\n  }\\n  dependsOn: [\\n    shared\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"domainName\\\": {\\n      \\\"value\\\": \\\"postgres-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"tshirtSize\\\": {\\n      \\\"value\\\": \\\"Small\\\"\\n    },\\n    \\\"replicatorPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"jumpbox\\\": {\\n      \\\"value\\\": \\\"Enabled\\\"\\n    },\\n    \\\"jumpBoxSize\\\": {\\n      \\\"value\\\": \\\"Standard_A1_V2\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"vnet\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location for all resources')\\nparam location string = resourceGroup().location\\n\\n@description('Size of VMs in the VM Scale Set.')\\nparam vmSku string = 'Standard_D2s_v3'\\n\\n@description('String used as a base for naming resources (9 characters or less). A hash is prepended to this string for some resources, and resource-specific information is appended.')\\nparam vmssName string\\n\\n@description('Number of VM instances (100 or less).')\\n@minValue(1)\\n@maxValue(100)\\nparam instanceCount int = 1\\n\\n@description('Admin username on all VMs.')\\nparam adminUsername string\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Security Type of the Virtual Machine.')\\n@allowed([\\n  'Standard'\\n  'TrustedLaunch'\\n])\\nparam securityType string = 'TrustedLaunch'\\n\\n@description('The base URI where artifacts required by this template are located')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar virtualNetworkName = '${vmssName}vnet'\\nvar publicIPAddressName = '${vmssName}pip'\\nvar subnetName = '${vmssName}subnet'\\nvar loadBalancerName = '${vmssName}lb'\\nvar natPoolName = '${vmssName}natpool'\\nvar natpool2Name = '${vmssName}natpool2'\\nvar bePoolName = '${vmssName}bepool'\\nvar natStartPort = 50000\\nvar natEndPort = 50120\\nvar natBackendPort = 22\\nvar nicName = '${vmssName}nic'\\nvar ipConfigName = '${vmssName}ipconfig'\\nvar frontEndIPConfigID = resourceId(\\n  'Microsoft.Network/loadBalancers/frontendIPConfigurations',\\n  loadBalancerName,\\n  'loadBalancerFrontEnd'\\n)\\nvar osType = {\\n  publisher: 'Canonical'\\n  offer: '0001-com-ubuntu-server-focal'\\n  sku: '20_04-lts-gen2'\\n  version: 'latest'\\n}\\nvar imageReference = osType\\nvar securityProfileJson = {\\n  uefiSettings: {\\n    secureBootEnabled: true\\n    vTpmEnabled: true\\n  }\\n  securityType: securityType\\n}\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2023-04-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2023-04-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n    dnsSettings: {\\n      domainNameLabel: vmssName\\n    }\\n  }\\n}\\n\\nresource loadBalancer 'Microsoft.Network/loadBalancers@2023-04-01' = {\\n  name: loadBalancerName\\n  location: location\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: 'LoadBalancerFrontEnd'\\n        properties: {\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: bePoolName\\n      }\\n    ]\\n    inboundNatPools: [\\n      {\\n        name: natPoolName\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: frontEndIPConfigID\\n          }\\n          protocol: 'Tcp'\\n          frontendPortRangeStart: natStartPort\\n          frontendPortRangeEnd: natEndPort\\n          backendPort: natBackendPort\\n        }\\n      }\\n      {\\n        name: natpool2Name\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: frontEndIPConfigID\\n          }\\n          protocol: 'Tcp'\\n          frontendPortRangeStart: 9000\\n          frontendPortRangeEnd: 9120\\n          backendPort: 9000\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vmss 'Microsoft.Compute/virtualMachineScaleSets@2023-03-01' = {\\n  name: vmssName\\n  location: location\\n  sku: {\\n    name: vmSku\\n    tier: 'Standard'\\n    capacity: instanceCount\\n  }\\n  properties: {\\n    overprovision: false\\n    upgradePolicy: {\\n      mode: 'Manual'\\n    }\\n    virtualMachineProfile: {\\n      storageProfile: {\\n        osDisk: {\\n          createOption: 'FromImage'\\n          caching: 'ReadWrite'\\n        }\\n        imageReference: imageReference\\n      }\\n      osProfile: {\\n        computerNamePrefix: vmssName\\n        adminUsername: adminUsername\\n        adminPassword: adminPasswordOrKey\\n        linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\\n      }\\n      securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\\n      networkProfile: {\\n        networkInterfaceConfigurations: [\\n          {\\n            name: nicName\\n            properties: {\\n              primary: true\\n              ipConfigurations: [\\n                {\\n                  name: ipConfigName\\n                  properties: {\\n                    subnet: {\\n                      id: reference(virtualNetwork.id, '2023-04-01').subnets[0].id\\n                    }\\n                    loadBalancerBackendAddressPools: [\\n                      {\\n                        id: reference(loadBalancer.id, '2023-04-01').backendAddressPools[0].id\\n                      }\\n                    ]\\n                    loadBalancerInboundNatPools: [\\n                      {\\n                        id: reference(loadBalancer.id, '2023-04-01').inboundNatPools[0].id\\n                      }\\n                      {\\n                        id: reference(loadBalancer.id, '2023-04-01').inboundNatPools[1].id\\n                      }\\n                    ]\\n                  }\\n                }\\n              ]\\n            }\\n          }\\n        ]\\n      }\\n      extensionProfile: {\\n        extensions: [\\n          {\\n            name: 'lapextension'\\n            properties: {\\n              publisher: 'Microsoft.Azure.Extensions'\\n              type: 'CustomScript'\\n              typeHandlerVersion: '2.0'\\n              autoUpgradeMinorVersion: true\\n              settings: {\\n                fileUris: [\\n                  uri(_artifactsLocation, 'installserver.sh${_artifactsLocationSasToken}')\\n                  uri(_artifactsLocation, 'workserver.py${_artifactsLocationSasToken}')\\n                ]\\n                commandToExecute: 'bash installserver.sh'\\n              }\\n            }\\n          }\\n        ]\\n      }\\n    }\\n  }\\n}\\n\\nresource autoscaleHost 'Microsoft.Insights/autoscalesettings@2022-10-01' = {\\n  name: 'autoscaleHost'\\n  location: location\\n  properties: {\\n    name: 'autoscaleHost'\\n    targetResourceUri: vmss.id\\n    enabled: true\\n    profiles: [\\n      {\\n        name: 'Profile1'\\n        capacity: {\\n          minimum: '1'\\n          maximum: '10'\\n          default: '1'\\n        }\\n        rules: [\\n          {\\n            metricTrigger: {\\n              metricName: 'Percentage CPU'\\n              metricResourceUri: vmss.id\\n              timeGrain: 'PT1M'\\n              statistic: 'Average'\\n              timeWindow: 'PT5M'\\n              timeAggregation: 'Average'\\n              operator: 'GreaterThan'\\n              threshold: 60\\n            }\\n            scaleAction: {\\n              direction: 'Increase'\\n              type: 'ChangeCount'\\n              value: '1'\\n              cooldown: 'PT1M'\\n            }\\n          }\\n          {\\n            metricTrigger: {\\n              metricName: 'Percentage CPU'\\n              metricResourceUri: vmss.id\\n              timeGrain: 'PT1M'\\n              statistic: 'Average'\\n              timeWindow: 'PT5M'\\n              timeAggregation: 'Average'\\n              operator: 'LessThan'\\n              threshold: 30\\n            }\\n            scaleAction: {\\n              direction: 'Decrease'\\n              type: 'ChangeCount'\\n              value: '1'\\n              cooldown: 'PT1M'\\n            }\\n          }\\n        ]\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vmSku\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"vmssName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"instanceCount\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"securityType\\\": {\\n      \\\"value\\\": \\\"TrustedLaunch\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Username for the Virtual Machines')\\nparam adminUsername string\\n\\n@description('Number of Web servers to be deployed')\\nparam webTierVmCount int = 2\\n\\n@description('Number of App servers to be deployed')\\nparam appTierVmCount int = 2\\n\\n@description('Number of Database servers to be deployed')\\nparam databaseTierVmCount int = 2\\n\\n@description('Enter Public IP CIDR to allow for accessing the deployment.Enter in 0.0.0.0/0 format, you can always modify these later in NSG Settings')\\n@minLength(7)\\nparam remoteAllowedCIDR string = '0.0.0.0/0'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Default VM Size')\\nparam vmSize string = 'Standard_D2_v3'\\n\\nvar vmStorageAccountType = 'Standard_GRS'\\nvar vmStorageAccountName = '${uniqueString(resourceGroup().id)}storage'\\nvar diagStorageAccountName = '${uniqueString(resourceGroup().id)}diagstorage'\\nvar virtualNetworkName = 'RedHat3Tier-vnet'\\nvar webTierSubnetName = 'web-tier-subnet'\\nvar appTierSubnetName = 'app-tier-subnet'\\nvar databaseTierSubnetName = 'database-tier-subnet'\\nvar jumpSubnetName = 'jump-subnet'\\nvar webNSGName = 'web-tier-nsg'\\nvar appNSGName = 'app-tier-nsg'\\nvar databaseNSGName = 'database-tier-nsg'\\nvar jumpNSGName = 'jump-nsg'\\nvar webLoadBalancerName = 'web-lb'\\nvar weblbIPAddressName = 'web-lb-pip'\\nvar weblbDnsLabel = 'weblb${uniqueString(resourceGroup().id)}'\\nvar webLoadBalancerIPID = weblbIPAddress.id\\nvar webFrontEndIPConfigID = resourceId(\\n  'Microsoft.Network/loadBalancers/frontendIPConfigurations',\\n  webLoadBalancerName,\\n  'loadBalancerFrontEnd'\\n)\\nvar weblbBackendPoolID = resourceId(\\n  'Microsoft.Network/loadBalancers/backendAddressPools',\\n  webLoadBalancerName,\\n  'loadBalancerBackend'\\n)\\nvar weblbProbeHttpID = resourceId('Microsoft.Network/loadBalancers/probes', webLoadBalancerName, 'weblbProbeHttp')\\nvar weblbProbeHttpsID = resourceId('Microsoft.Network/loadBalancers/probes', webLoadBalancerName, 'weblbProbeHttps')\\nvar internalLoadBalancerName = 'internal-lb'\\nvar internalFrontEndIPConfigID = resourceId(\\n  'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n  internalLoadBalancerName,\\n  'loadBalancerFrontEnd'\\n)\\nvar internallbBackendPoolID = resourceId(\\n  'Microsoft.Network/loadBalancers/backendAddressPools',\\n  internalLoadBalancerName,\\n  'loadBalancerBackend'\\n)\\nvar internallbProbeSSHID = resourceId(\\n  'Microsoft.Network/loadBalancers/probes',\\n  internalLoadBalancerName,\\n  'internallbProbeSSH'\\n)\\nvar jumpIPAddressName = 'jump-pip'\\nvar jumpDnsLabel = 'jump${uniqueString(resourceGroup().id)}'\\nvar availSetName = 'avail-set-'\\nvar webTierVmNicName = '${webTierVmName}-nic-'\\nvar appTierVmNicName = '${appTierVmName}-nic-'\\nvar databaseTierVmNicName = '${databaseTierVmName}-nic-'\\nvar jumpVmNicName = '${jumpVmName}-nic'\\nvar redHatsku = '7.3'\\nvar Publisher = 'RedHat'\\nvar Offer = 'RHEL'\\nvar webTierVmName = 'web-tier-vm'\\nvar appTierVmName = 'app-tier-vm'\\nvar databaseTierVmName = 'database-tier-vm'\\nvar jumpVmName = 'jump-vm'\\nvar redHatTags = {\\n  type: 'object'\\n  provider: '9d2c71fc-96ba-4b4a-93b3-14def5bc96fc'\\n}\\nvar quickstartTags = {\\n  type: 'object'\\n  name: 'rhel-3tier-iaas'\\n}\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\n\\nresource vmStorageAccountName_1 'Microsoft.Storage/storageAccounts@2021-01-01' = [\\n  for i in range(0, 4): {\\n    name: concat(vmStorageAccountName, (i + 1))\\n    location: location\\n    tags: {\\n      displayName: 'VM Storage Accounts'\\n      quickstartName: quickstartTags.name\\n      provider: redHatTags.provider\\n    }\\n    sku: {\\n      name: vmStorageAccountType\\n    }\\n    kind: 'Storage'\\n    properties: {}\\n  }\\n]\\n\\nresource diagStorageAccount 'Microsoft.Storage/storageAccounts@2021-01-01' = {\\n  name: diagStorageAccountName\\n  location: location\\n  tags: {\\n    displayName: 'Diagnostics Storage Account'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  sku: {\\n    name: 'Standard_LRS'\\n  }\\n  kind: 'Storage'\\n  properties: {}\\n}\\n\\nresource webNSG 'Microsoft.Network/networkSecurityGroups@2016-03-30' = {\\n  name: webNSGName\\n  location: location\\n  tags: {\\n    displayName: 'Web NSG'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'HTTP-allow'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '80'\\n          sourceAddressPrefix: remoteAllowedCIDR\\n          destinationAddressPrefix: '10.0.1.0/24'\\n          access: 'Allow'\\n          priority: 110\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'HTTPS-allow'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '443'\\n          sourceAddressPrefix: remoteAllowedCIDR\\n          destinationAddressPrefix: '10.0.1.0/24'\\n          access: 'Allow'\\n          priority: 120\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource appNSG 'Microsoft.Network/networkSecurityGroups@2016-03-30' = {\\n  name: appNSGName\\n  location: location\\n  tags: {\\n    displayName: 'App NSG'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  properties: {}\\n}\\n\\nresource databaseNSG 'Microsoft.Network/networkSecurityGroups@2016-03-30' = {\\n  name: databaseNSGName\\n  location: location\\n  tags: {\\n    displayName: 'Database NSG'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  properties: {}\\n}\\n\\nresource jumpNSG 'Microsoft.Network/networkSecurityGroups@2016-03-30' = {\\n  name: jumpNSGName\\n  location: location\\n  tags: {\\n    displayName: 'Jump NSG'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'SSH-allow'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '22'\\n          sourceAddressPrefix: remoteAllowedCIDR\\n          destinationAddressPrefix: '10.0.0.128/25'\\n          access: 'Allow'\\n          priority: 110\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource jumpIPAddress 'Microsoft.Network/publicIPAddresses@2016-03-30' = {\\n  name: jumpIPAddressName\\n  location: location\\n  tags: {\\n    displayName: 'Jump VM Public IP'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n    dnsSettings: {\\n      domainNameLabel: jumpDnsLabel\\n    }\\n    idleTimeoutInMinutes: 4\\n  }\\n}\\n\\nresource weblbIPAddress 'Microsoft.Network/publicIPAddresses@2016-03-30' = {\\n  name: weblbIPAddressName\\n  location: location\\n  tags: {\\n    displayName: 'Web LB Public IP'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n    idleTimeoutInMinutes: 4\\n    dnsSettings: {\\n      domainNameLabel: weblbDnsLabel\\n    }\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2016-03-30' = {\\n  name: virtualNetworkName\\n  location: location\\n  tags: {\\n    displayName: 'Virtual Network'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        '10.0.0.0/16'\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: webTierSubnetName\\n        properties: {\\n          addressPrefix: '10.0.1.0/24'\\n          networkSecurityGroup: {\\n            id: webNSG.id\\n          }\\n        }\\n      }\\n      {\\n        name: appTierSubnetName\\n        properties: {\\n          addressPrefix: '10.0.2.0/24'\\n          networkSecurityGroup: {\\n            id: appNSG.id\\n          }\\n        }\\n      }\\n      {\\n        name: databaseTierSubnetName\\n        properties: {\\n          addressPrefix: '10.0.3.0/24'\\n          networkSecurityGroup: {\\n            id: databaseNSG.id\\n          }\\n        }\\n      }\\n      {\\n        name: jumpSubnetName\\n        properties: {\\n          addressPrefix: '10.0.0.128/25'\\n          networkSecurityGroup: {\\n            id: jumpNSG.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource availSetName_1 'Microsoft.Compute/availabilitySets@2017-12-01' = [\\n  for i in range(0, 3): {\\n    name: concat(availSetName, (i + 1))\\n    location: location\\n    tags: {\\n      displayName: 'Availability Sets'\\n      quickstartName: quickstartTags.name\\n      provider: redHatTags.provider\\n    }\\n    sku: {\\n      name: 'Aligned'\\n    }\\n    properties: {\\n      platformFaultDomainCount: 2\\n      platformUpdateDomainCount: 5\\n    }\\n  }\\n]\\n\\nresource webLoadBalancer 'Microsoft.Network/loadBalancers@2015-06-15' = {\\n  name: webLoadBalancerName\\n  location: location\\n  tags: {\\n    displayName: 'External Load Balancer'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: 'loadBalancerFrontEnd'\\n        properties: {\\n          publicIPAddress: {\\n            id: webLoadBalancerIPID\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: 'loadBalancerBackend'\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        name: 'LBRuleForlb80IP'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: webFrontEndIPConfigID\\n          }\\n          backendAddressPool: {\\n            id: weblbBackendPoolID\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 80\\n          backendPort: 80\\n          idleTimeoutInMinutes: 5\\n          enableFloatingIP: false\\n          probe: {\\n            id: weblbProbeHttpID\\n          }\\n        }\\n      }\\n      {\\n        name: 'LBRuleForlb443IP'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: webFrontEndIPConfigID\\n          }\\n          backendAddressPool: {\\n            id: weblbBackendPoolID\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 443\\n          backendPort: 443\\n          idleTimeoutInMinutes: 5\\n          enableFloatingIP: false\\n          probe: {\\n            id: weblbProbeHttpsID\\n          }\\n        }\\n      }\\n    ]\\n    probes: [\\n      {\\n        name: 'weblbProbeHttp'\\n        properties: {\\n          protocol: 'Tcp'\\n          port: 80\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n      }\\n      {\\n        name: 'weblbProbeHttps'\\n        properties: {\\n          protocol: 'Tcp'\\n          port: 443\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource internalLoadBalancer 'Microsoft.Network/loadBalancers@2015-06-15' = {\\n  name: internalLoadBalancerName\\n  location: location\\n  tags: {\\n    displayName: 'Internal Load Balancer'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: 'loadBalancerFrontEnd'\\n        properties: {\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, webTierSubnetName)\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: 'loadBalancerBackEnd'\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        name: 'internallbruleSSH'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: internalFrontEndIPConfigID\\n          }\\n          backendAddressPool: {\\n            id: internallbBackendPoolID\\n          }\\n          probe: {\\n            id: internallbProbeSSHID\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 22\\n          backendPort: 22\\n          idleTimeoutInMinutes: 15\\n        }\\n      }\\n    ]\\n    probes: [\\n      {\\n        name: 'internallbProbeSSH'\\n        properties: {\\n          protocol: 'Tcp'\\n          port: 22\\n          intervalInSeconds: 15\\n          numberOfProbes: 2\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource webTierVmNicName_1 'Microsoft.Network/networkInterfaces@2016-03-30' = [\\n  for i in range(0, webTierVmCount): {\\n    name: concat(webTierVmNicName, (i + 1))\\n    location: location\\n    tags: {\\n      displayName: 'Web Tier VM NICs'\\n      quickstartName: quickstartTags.name\\n      provider: redHatTags.provider\\n    }\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig1'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            subnet: {\\n              id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, webTierSubnetName)\\n            }\\n            loadBalancerBackendAddressPools: [\\n              {\\n                id: weblbBackendPoolID\\n              }\\n            ]\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      virtualNetwork\\n      webLoadBalancer\\n    ]\\n  }\\n]\\n\\nresource appTierVmNicName_1 'Microsoft.Network/networkInterfaces@2016-03-30' = [\\n  for i in range(0, appTierVmCount): {\\n    name: concat(appTierVmNicName, (i + 1))\\n    location: location\\n    tags: {\\n      displayName: 'App Tier VM NICs'\\n      quickstartName: quickstartTags.name\\n      provider: redHatTags.provider\\n    }\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig1'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            subnet: {\\n              id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, appTierSubnetName)\\n            }\\n            loadBalancerBackendAddressPools: [\\n              {\\n                id: internallbBackendPoolID\\n              }\\n            ]\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      virtualNetwork\\n      internalLoadBalancer\\n    ]\\n  }\\n]\\n\\nresource databaseTierVmNicName_1 'Microsoft.Network/networkInterfaces@2016-03-30' = [\\n  for i in range(0, databaseTierVmCount): {\\n    name: concat(databaseTierVmNicName, (i + 1))\\n    location: location\\n    tags: {\\n      displayName: 'Database Tier VM NICs'\\n      quickstartName: quickstartTags.name\\n      provider: redHatTags.provider\\n    }\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig1'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            subnet: {\\n              id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, databaseTierSubnetName)\\n            }\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      virtualNetwork\\n    ]\\n  }\\n]\\n\\nresource jumpVmNic 'Microsoft.Network/networkInterfaces@2016-03-30' = {\\n  name: jumpVmNicName\\n  location: location\\n  tags: {\\n    displayName: 'Jump VM NIC'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: jumpIPAddress.id\\n          }\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, jumpSubnetName)\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource webTierVmName_1 'Microsoft.Compute/virtualMachines@2017-03-30' = [\\n  for i in range(0, webTierVmCount): {\\n    name: '${webTierVmName}-${(i+1)}'\\n    location: location\\n    tags: {\\n      displayName: 'Web Tier VMs'\\n      quickstartName: quickstartTags.name\\n      provider: redHatTags.provider\\n    }\\n    properties: {\\n      availabilitySet: {\\n        id: resourceId('Microsoft.Compute/availabilitySets', '${availSetName}1')\\n      }\\n      hardwareProfile: {\\n        vmSize: vmSize\\n      }\\n      osProfile: {\\n        computerName: 'webserver${(i+1)}'\\n        adminUsername: adminUsername\\n        adminPassword: adminPasswordOrKey\\n        linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: Publisher\\n          offer: Offer\\n          sku: redHatsku\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          name: '${webTierVmName}-${(i+1)}_OSDisk'\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n        }\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', concat(webTierVmNicName, (i + 1)))\\n          }\\n        ]\\n      }\\n      diagnosticsProfile: {\\n        bootDiagnostics: {\\n          enabled: true\\n          storageUri: diagStorageAccount.properties.primaryEndpoints.blob\\n        }\\n      }\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Storage/storageAccounts/', '${vmStorageAccountName}1')\\n      resourceId('Microsoft.Network/networkInterfaces/', concat(webTierVmNicName, (i + 1)))\\n      resourceId('Microsoft.Compute/availabilitySets/', '${availSetName}1')\\n    ]\\n  }\\n]\\n\\nresource appTierVmName_1 'Microsoft.Compute/virtualMachines@2017-03-30' = [\\n  for i in range(0, appTierVmCount): {\\n    name: '${appTierVmName}-${(i+1)}'\\n    location: location\\n    tags: {\\n      displayName: 'App Tier VMs'\\n      quickstartName: quickstartTags.name\\n      provider: redHatTags.provider\\n    }\\n    properties: {\\n      availabilitySet: {\\n        id: resourceId('Microsoft.Compute/availabilitySets', '${availSetName}2')\\n      }\\n      hardwareProfile: {\\n        vmSize: vmSize\\n      }\\n      osProfile: {\\n        computerName: 'appserver${(i+1)}'\\n        adminUsername: adminUsername\\n        adminPassword: adminPasswordOrKey\\n        linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: Publisher\\n          offer: Offer\\n          sku: redHatsku\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          name: '${appTierVmName}-${(i+1)}_OSDisk'\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n        }\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', concat(appTierVmNicName, (i + 1)))\\n          }\\n        ]\\n      }\\n      diagnosticsProfile: {\\n        bootDiagnostics: {\\n          enabled: true\\n          storageUri: diagStorageAccount.properties.primaryEndpoints.blob\\n        }\\n      }\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Storage/storageAccounts/', '${vmStorageAccountName}2')\\n      resourceId('Microsoft.Network/networkInterfaces/', concat(appTierVmNicName, (i + 1)))\\n      resourceId('Microsoft.Compute/availabilitySets/', '${availSetName}2')\\n    ]\\n  }\\n]\\n\\nresource databaseTierVmName_1 'Microsoft.Compute/virtualMachines@2017-03-30' = [\\n  for i in range(0, databaseTierVmCount): {\\n    name: '${databaseTierVmName}-${(i+1)}'\\n    location: location\\n    tags: {\\n      displayName: 'Database Tier VMs'\\n      quickstartName: quickstartTags.name\\n      provider: redHatTags.provider\\n    }\\n    properties: {\\n      availabilitySet: {\\n        id: resourceId('Microsoft.Compute/availabilitySets', '${availSetName}3')\\n      }\\n      hardwareProfile: {\\n        vmSize: vmSize\\n      }\\n      osProfile: {\\n        computerName: 'databaseserver${(i+1)}'\\n        adminUsername: adminUsername\\n        adminPassword: adminPasswordOrKey\\n        linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: Publisher\\n          offer: Offer\\n          sku: redHatsku\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          name: '${databaseTierVmName}-${(i+1)}_OSDisk'\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n        }\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', concat(databaseTierVmNicName, (i + 1)))\\n          }\\n        ]\\n      }\\n      diagnosticsProfile: {\\n        bootDiagnostics: {\\n          enabled: true\\n          storageUri: diagStorageAccount.properties.primaryEndpoints.blob\\n        }\\n      }\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Storage/storageAccounts/', '${vmStorageAccountName}3')\\n      resourceId('Microsoft.Network/networkInterfaces/', concat(databaseTierVmNicName, (i + 1)))\\n      resourceId('Microsoft.Compute/availabilitySets/', '${availSetName}3')\\n    ]\\n  }\\n]\\n\\nresource jumpVm 'Microsoft.Compute/virtualMachines@2017-03-30' = {\\n  name: jumpVmName\\n  location: location\\n  tags: {\\n    displayName: 'Jump VM'\\n    quickstartName: quickstartTags.name\\n    provider: redHatTags.provider\\n  }\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: 'jumpvm'\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: Publisher\\n        offer: Offer\\n        sku: redHatsku\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${jumpVmName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: jumpVmNic.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: diagStorageAccount.properties.primaryEndpoints.blob\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    resourceId('Microsoft.Storage/storageAccounts/', '${vmStorageAccountName}4')\\n  ]\\n}\\n\\noutput webLoadBalancerIP string = weblbIPAddress.properties.ipAddress\\noutput webLoadBalancerFqdn string = weblbIPAddress.properties.dnsSettings.fqdn\\noutput jumpVMIP string = jumpIPAddress.properties.ipAddress\\noutput jumpVMFqdn string = jumpIPAddress.properties.dnsSettings.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"webTierVmCount\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"appTierVmCount\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"databaseTierVmCount\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"remoteAllowedCIDR\\\": {\\n      \\\"value\\\": \\\"0.0.0.0/0\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('User name for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('The resource group of the existing Virtual Network.')\\nparam existingVirtualNetworkResourceGroupName string = resourceGroup().name\\n\\n@description('The name of the existing Virtual Network.')\\nparam existingVirtualNetworkName string\\n\\n@description('The name of the existing subnet.')\\nparam existingSubnetName string\\n\\n@description('The VM size for the Virtual Machine.')\\nparam vmSize string = 'Standard_E16-4ds_v5'\\n\\n@description('The location where the Virtual Machine will be created.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation. When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar imagePublisher = 'SUSE'\\nvar imageOffer = 'sles-sap-15-sp3'\\nvar imageSku = 'gen2'\\nvar vmName = 'vhcals4hci'\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar s4ScriptFileUri = uri(_artifactsLocation, 'scripts/s4install.sh${_artifactsLocationSasToken}')\\nvar s4InifileUri = uri(_artifactsLocation, 'scripts/inifile.params${_artifactsLocationSasToken}')\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2023-09-01' = {\\n  name: vmName\\n  location: location\\n  tags: {\\n    Database: 'HANA'\\n    Application: 'S4HANA Fully Activated Appliance'\\n  }\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: imageSku\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmName}_OsDisk'\\n        osType: 'Linux'\\n        createOption: 'FromImage'\\n        deleteOption: 'Delete'\\n        managedDisk: {\\n          storageAccountType: 'Premium_LRS'\\n        }\\n      }\\n      dataDisks: [\\n        {\\n          name: '${vmName}_hanaData'\\n          lun: 0\\n          createOption: 'Empty'\\n          deleteOption: 'Delete'\\n          diskSizeGB: 512\\n          managedDisk: {\\n            storageAccountType: 'Premium_LRS'\\n          }\\n        }\\n        {\\n          name: '${vmName}_hanaLog'\\n          lun: 1\\n          createOption: 'Empty'\\n          deleteOption: 'Delete'\\n          diskSizeGB: 128\\n          managedDisk: {\\n            storageAccountType: 'Premium_LRS'\\n          }\\n        }\\n        {\\n          name: '${vmName}_sapMedia'\\n          lun: 2\\n          createOption: 'Empty'\\n          deleteOption: 'Delete'\\n          diskSizeGB: 512\\n          managedDisk: {\\n            storageAccountType: 'Premium_LRS'\\n          }\\n        }\\n        {\\n          name: '${vmName}_sapMnt'\\n          lun: 3\\n          createOption: 'Empty'\\n          deleteOption: 'Delete'\\n          diskSizeGB: 64\\n          managedDisk: {\\n            storageAccountType: 'Premium_LRS'\\n          }\\n        }\\n      ]\\n      diskControllerType: 'SCSI'\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: vmName_Nic.id\\n          properties: {\\n            deleteOption: 'Delete'\\n          }\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource vmName_Nic 'Microsoft.Network/networkInterfaces@2023-06-01' = {\\n  name: '${vmName}Nic'\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          subnet: {\\n            id: extensionResourceId(\\n              '/subscriptions/${subscription().subscriptionId}/resourceGroups/${existingVirtualNetworkResourceGroupName}',\\n              'Microsoft.Network/virtualNetworks/subnets',\\n              split('${existingVirtualNetworkName}/${existingSubnetName}', '/')[0],\\n              split('${existingVirtualNetworkName}/${existingSubnetName}', '/')[1]\\n            )\\n          }\\n          privateIPAllocationMethod: 'Dynamic'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vmName_vmName_Installscript 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = {\\n  parent: vm\\n  name: '${vmName}Installscript'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    protectedSettings: {\\n      fileUris: [\\n        uri(_artifactsLocation, 'scripts/install.sh${_artifactsLocationSasToken}')\\n      ]\\n      commandToExecute: 'sh install.sh ${s4ScriptFileUri} ${s4InifileUri}'\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingVirtualNetworkResourceGroupName\\\": {\\n      \\\"value\\\": \\\"resourceGroup().name\\\"\\n    },\\n    \\\"existingVirtualNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingSubnetName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_E16-4ds_v5\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('SAP System ID.')\\n@minLength(3)\\n@maxLength(3)\\nparam sapSystemId string = 'DEV'\\n\\n@description('The type of the operating system you want to deploy.')\\n@allowed([\\n  'Windows Server 2012 Datacenter'\\n  'Windows Server 2012 R2 Datacenter'\\n  'Windows Server 2016 Datacenter'\\n  'SLES 12'\\n  'SLES 12 BYOS'\\n  'RHEL 7'\\n  'Oracle Linux 7'\\n])\\nparam osType string = 'Windows Server 2012 R2 Datacenter'\\n\\n@description('The type of the database')\\n@allowed([\\n  'SQL'\\n  'HANA'\\n])\\nparam dbtype string = 'SQL'\\n\\n@description('The size of the SAP System you want to deploy.')\\n@allowed([\\n  'Demo'\\n  'Small'\\n  'Medium'\\n  'Large'\\n  'X-Large'\\n])\\nparam sapSystemSize string = 'Small'\\n\\n@description('Determines whether this is a high available deployment or not. A HA deployment contains multiple instances of single point of failures.')\\n@allowed([\\n  'HA'\\n  'Not HA'\\n])\\nparam systemAvailability string = 'Not HA'\\n\\n@description('Username for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Type of authentication to use on the Virtual Machine.')\\n@allowed([\\n  'password'\\n  'sshPublicKey'\\n])\\nparam authenticationType string = 'password'\\n\\n@description('Password or ssh key for the Virtual Machine.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('The id of the subnet you want to use.')\\nparam subnetId string = ''\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar images = {\\n  'Windows Server 2012 Datacenter': {\\n    sku: '2012-Datacenter'\\n    offer: 'WindowsServer'\\n    publisher: 'MicrosoftWindowsServer'\\n    version: 'latest'\\n    OSType: 'Windows'\\n    UsePlan: false\\n    osDiskSize: 128\\n  }\\n  'Windows Server 2012 R2 Datacenter': {\\n    sku: '2012-R2-Datacenter'\\n    offer: 'WindowsServer'\\n    publisher: 'MicrosoftWindowsServer'\\n    version: 'latest'\\n    OSType: 'Windows'\\n    UsePlan: false\\n    osDiskSize: 128\\n  }\\n  'Windows Server 2016 Datacenter': {\\n    sku: '2016-Datacenter'\\n    offer: 'WindowsServer'\\n    publisher: 'MicrosoftWindowsServer'\\n    version: 'latest'\\n    OSType: 'Windows'\\n    UsePlan: false\\n    osDiskSize: 128\\n  }\\n  'SLES 12': {\\n    sku: '12-SP3'\\n    offer: 'SLES-SAP'\\n    publisher: 'SUSE'\\n    version: 'latest'\\n    OSType: 'Linux'\\n    UsePlan: false\\n    osDiskSize: 64\\n  }\\n  'SLES 12 BYOS': {\\n    sku: '12-SP3'\\n    offer: 'SLES-SAP-BYOS'\\n    publisher: 'SUSE'\\n    version: 'latest'\\n    OSType: 'Linux'\\n    UsePlan: false\\n    osDiskSize: 64\\n  }\\n  'RHEL 7': {\\n    sku: '7.4'\\n    offer: 'RHEL'\\n    publisher: 'RedHat'\\n    version: 'latest'\\n    OSType: 'Linux'\\n    UsePlan: false\\n    osDiskSize: 64\\n  }\\n  'Oracle Linux 7': {\\n    sku: '7.3'\\n    offer: 'Oracle-Linux'\\n    publisher: 'Oracle'\\n    version: 'latest'\\n    OSType: 'Linux'\\n    UsePlan: false\\n    osDiskSize: 64\\n  }\\n}\\nvar internalOSType = images[osType].OSType\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar csExtension = {\\n  Windows: {\\n    Publisher: 'Microsoft.Compute'\\n    Name: 'CustomScriptExtension'\\n    Version: '1.7'\\n    script: uri(_artifactsLocation, 'scripts/diskConfig.ps1${_artifactsLocationSasToken}')\\n    scriptCall: 'powershell.exe -ExecutionPolicy bypass -File scripts/diskConfig.ps1'\\n  }\\n  Linux: {\\n    Publisher: 'Microsoft.Azure.Extensions'\\n    Name: 'CustomScript'\\n    Version: '2.0'\\n    script: uri(_artifactsLocation, 'scripts/diskConfig.sh${_artifactsLocationSasToken}')\\n    scriptCall: 'sh diskConfig.sh'\\n  }\\n}\\nvar cseExtPublisher = csExtension[internalOSType].Publisher\\nvar cseExtName = csExtension[internalOSType].Name\\nvar cseExtVersion = csExtension[internalOSType].Version\\nvar csExtensionScript = csExtension[internalOSType].script\\nvar csExtensionscriptCall = csExtension[internalOSType].scriptCall\\nvar sizes = {\\n  Demo: {\\n    HANA: {\\n      vmSize: 'Standard_E8s_v3'\\n      disks: [\\n        {\\n          lun: 0\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 128\\n        }\\n        {\\n          lun: 1\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 128\\n        }\\n        {\\n          lun: 2\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 128\\n        }\\n        {\\n          lun: 3\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 128\\n        }\\n        {\\n          lun: 4\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 128\\n        }\\n        {\\n          lun: 5\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 128\\n        }\\n        {\\n          lun: 6\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 128\\n        }\\n        {\\n          lun: 7\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 128\\n        }\\n      ]\\n      scriptArguments: {\\n        Linux: '-luns \\\\'0,1#2,3#4#5#6,7\\\\' -names \\\\'data#log#shared#usrsap#backup\\\\' -paths \\\\'/hana/data#/hana/log#/hana/shared#/usr/sap#/hana/backup\\\\'  -sizes \\\\'100#100#100#100#100\\\\''\\n      }\\n      useFastNetwork: false\\n    }\\n    SQL: {\\n      vmSize: 'Standard_D4s_v3'\\n      disks: [\\n        {\\n          lun: 0\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 128\\n        }\\n      ]\\n      scriptArguments: {\\n        Windows: '-luns \\\"0\\\" -names \\\"data\\\" -paths \\\"C:\\\\\\\\sql\\\\\\\\data,C:\\\\\\\\sql\\\\\\\\log\\\"  -sizes \\\"70,100\\\"'\\n      }\\n      useFastNetwork: false\\n    }\\n  }\\n  Small: {\\n    HANA: {\\n      vmSize: 'Standard_E32s_v3'\\n      disks: [\\n        {\\n          lun: 0\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 1\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 2\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 3\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 4\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 64\\n        }\\n        {\\n          lun: 5\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n      ]\\n      scriptArguments: {\\n        Linux: '-luns \\\\'0,1,2#3#4#5\\\\' -names \\\\'datalog#shared#usrsap#backup\\\\' -paths \\\\'/hana/data,/hana/log#/hana/shared#/usr/sap#/hana/backup\\\\' -sizes \\\\'70,100#100#100#100\\\\''\\n      }\\n      useFastNetwork: true\\n    }\\n    SQL: {\\n      vmSize: 'Standard_D8s_v3'\\n      disks: [\\n        {\\n          lun: 0\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 1\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 2\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 3\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 4\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n      ]\\n      scriptArguments: {\\n        Windows: '-luns \\\\'0,1,2,3#4\\\\' -names \\\\'data#log\\\\' -paths \\\\'C:\\\\\\\\sql\\\\\\\\data#C:\\\\\\\\sql\\\\\\\\log\\\\'  -sizes \\\\'100#100\\\\''\\n      }\\n      useFastNetwork: true\\n    }\\n  }\\n  Medium: {\\n    HANA: {\\n      vmSize: 'Standard_E64s_v3'\\n      disks: [\\n        {\\n          lun: 0\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 1\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 2\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 3\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 4\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 64\\n        }\\n        {\\n          lun: 5\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n      ]\\n      scriptArguments: {\\n        Linux: '-luns \\\\'0,1,2#3#4#5\\\\' -names \\\\'datalog#shared#usrsap#backup\\\\' -paths \\\\'/hana/data,/hana/log#/hana/shared#/usr/sap#/hana/backup\\\\' -sizes \\\\'70,100#100#100#100\\\\''\\n      }\\n      useFastNetwork: true\\n    }\\n    SQL: {\\n      vmSize: 'Standard_D16s_v3'\\n      disks: [\\n        {\\n          lun: 0\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 1\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 2\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 3\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 4\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 5\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 6\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 7\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n      ]\\n      scriptArguments: {\\n        Windows: '-luns \\\\'0,1,2,3,4,5,6#7\\\\' -names \\\\'data#log\\\\' -paths \\\\'C:\\\\\\\\sql\\\\\\\\data#C:\\\\\\\\sql\\\\\\\\log\\\\'  -sizes \\\\'100#100\\\\''\\n      }\\n      useFastNetwork: true\\n    }\\n  }\\n  Large: {\\n    HANA: {\\n      vmSize: 'Standard_M64s'\\n      disks: [\\n        {\\n          lun: 0\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 1\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 2\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 3\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 4\\n          caching: 'None'\\n          writeAcceleratorEnabled: 'true'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 5\\n          caching: 'None'\\n          writeAcceleratorEnabled: 'true'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 6\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 7\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 64\\n        }\\n        {\\n          lun: 8\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 9\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n      ]\\n      scriptArguments: {\\n        Linux: '-luns \\\\'0,1,2,3#4,5#6#7#8,9\\\\' -names \\\\'data#log#shared#usrsap#backup\\\\' -paths \\\\'/hana/data#/hana/log#/hana/shared#/usr/sap#/hana/backup\\\\' -sizes \\\\'100#100#100#100#100\\\\''\\n      }\\n      useFastNetwork: true\\n    }\\n    SQL: {\\n      vmSize: 'Standard_GS4'\\n      disks: [\\n        {\\n          lun: 0\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 1\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 2\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 3\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 4\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 5\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n      ]\\n      scriptArguments: {\\n        Windows: '-luns \\\\'0,1,2,3,4#5\\\\' -names \\\\'data#log\\\\' -paths \\\\'C:\\\\\\\\sql\\\\\\\\data#C:\\\\\\\\sql\\\\\\\\log\\\\'  -sizes \\\\'100#100\\\\''\\n      }\\n      useFastNetwork: false\\n    }\\n  }\\n  'X-Large': {\\n    HANA: {\\n      vmSize: 'Standard_M128s'\\n      disks: [\\n        {\\n          lun: 0\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 1\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 2\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 3\\n          caching: 'None'\\n          writeAcceleratorEnabled: 'true'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 4\\n          caching: 'None'\\n          writeAcceleratorEnabled: 'true'\\n          createOption: 'Empty'\\n          diskSizeGB: 512\\n        }\\n        {\\n          lun: 5\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 6\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 64\\n        }\\n        {\\n          lun: 7\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 2048\\n        }\\n        {\\n          lun: 8\\n          caching: 'ReadOnly'\\n          createOption: 'Empty'\\n          diskSizeGB: 2048\\n        }\\n      ]\\n      scriptArguments: {\\n        Linux: '-luns \\\\'0,1,2#3,4#5#6#7,8\\\\' -names \\\\'data#log#shared#usrsap#backup\\\\' -paths \\\\'/hana/data#/hana/log#/hana/shared#/usr/sap#/hana/backup\\\\' -sizes \\\\'100#100#100#100#100\\\\''\\n      }\\n      useFastNetwork: true\\n    }\\n    SQL: {\\n      vmSize: 'Standard_GS5'\\n      disks: [\\n        {\\n          lun: 0\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 1\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 2\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 3\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 4\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 5\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 6\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n        {\\n          lun: 7\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: 1024\\n        }\\n      ]\\n      scriptArguments: {\\n        Windows: '-luns \\\\'0,1,2,3,4,5,6#7\\\\' -names \\\\'data#log\\\\' -paths \\\\'C:\\\\\\\\sql\\\\\\\\data#C:\\\\\\\\sql\\\\\\\\log\\\\'  -sizes \\\\'100#100\\\\''\\n      }\\n      useFastNetwork: false\\n    }\\n  }\\n}\\nvar dbvmCount = ((systemAvailability == 'HA') ? 2 : 1)\\nvar sidlower = toLower(sapSystemId)\\nvar publicIpNameDB_var = '${sidlower}-pip-db'\\nvar vnetName = '${sidlower}-vnet'\\nvar subnetName = 'Subnet'\\nvar subnets = {\\ntrue: resourceId('Microsoft.Network/virtualNetworks/subnets',vnetName,subnetName)\\nfalse: subnetId\\n}\\nvar selectedSubnetId = subnets[string((length(subnetId) == 0))]\\nvar nsgName = '${sidlower}-nsg'\\nvar avSetNameDB_var = '${sidlower}-avset-db'\\nvar loadBalancerNameDB_var = '${sidlower}-lb-db'\\nvar nicNameDB_var = '${sidlower}-nic-db'\\nvar vmNameDB_var = '${sidlower}-db'\\nvar osSecurityRules = {\\n  Windows: [\\n    {\\n      name: 'RDP'\\n      properties: {\\n        description: 'Allow RDP Subnet'\\n        protocol: 'Tcp'\\n        sourcePortRange: '*'\\n        destinationPortRange: '3389'\\n        sourceAddressPrefix: '*'\\n        destinationAddressPrefix: '*'\\n        access: 'Allow'\\n        priority: 100\\n        direction: 'Inbound'\\n      }\\n    }\\n  ]\\n  Linux: [\\n    {\\n      name: 'SSH'\\n      properties: {\\n        description: 'Allow SSH Subnet'\\n        protocol: 'Tcp'\\n        sourcePortRange: '*'\\n        destinationPortRange: '22'\\n        sourceAddressPrefix: '*'\\n        destinationAddressPrefix: '*'\\n        access: 'Allow'\\n        priority: 100\\n        direction: 'Inbound'\\n      }\\n    }\\n  ]\\n}\\nvar selectedSecurityRules = osSecurityRules[internalOSType]\\nvar loadBalancerFrontendHANADB = 'frontend'\\nvar backendPoolHANADB = 'backend'\\nvar probePortHANADB = 'probe'\\nvar dbInstanceNumberHANA = 3\\nvar lbPrefixHANADB = 'lb${padLeft(dbInstanceNumberHANA,2,'0')}'\\nvar probePortInternalHANADB = (62500 + dbInstanceNumberHANA)\\nvar lbRulePrefixHANADB = '${lbPrefixHANADB}Rule'\\nvar loadBalancerFrontendSQLDB = 'frontend'\\nvar loadBalancerFrontendSQLCL = 'frontendcl'\\nvar backendPoolSQLDB = 'backend'\\nvar backendPoolSQLCL = 'backendcl'\\nvar probePortSQLDB = 'probe'\\nvar probePortSQLCL = 'probecl'\\nvar lbPrefixSQLDB = 'lbsql'\\nvar probePortInternalSQLDB = 62500\\nvar probePortInternalSQLCL = 63500\\nvar lbRulePrefixSQLDB = '${lbPrefixSQLDB}Rule'\\nvar idleTimeoutInMinutes = 30\\nvar lbFrontendConfigs = {\\n  HANA: {\\n    Linux: [\\n      {\\n        properties: {\\n          subnet: {\\n            id: selectedSubnetId\\n          }\\n          privateIPAllocationMethod: 'Dynamic'\\n        }\\n        name: loadBalancerFrontendHANADB\\n      }\\n    ]\\n  }\\n  SQL: {\\n    Windows: [\\n      {\\n        properties: {\\n          subnet: {\\n            id: selectedSubnetId\\n          }\\n          privateIPAllocationMethod: 'Dynamic'\\n        }\\n        name: loadBalancerFrontendSQLDB\\n      }\\n      {\\n        properties: {\\n          subnet: {\\n            id: selectedSubnetId\\n          }\\n          privateIPAllocationMethod: 'Dynamic'\\n        }\\n        name: loadBalancerFrontendSQLCL\\n      }\\n    ]\\n  }\\n}\\nvar lbBackendPools = {\\n  HANA: {\\n    Linux: [\\n      {\\n        name: backendPoolHANADB\\n      }\\n    ]\\n  }\\n  SQL: {\\n    Windows: [\\n      {\\n        name: backendPoolSQLDB\\n      }\\n      {\\n        name: backendPoolSQLCL\\n      }\\n    ]\\n  }\\n}\\nvar lbRules = {\\n  HANA: {\\n    Linux: [\\n      {\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n              loadBalancerNameDB_var,\\n              loadBalancerFrontendHANADB\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              loadBalancerNameDB_var,\\n              backendPoolHANADB\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadBalancerNameDB_var, probePortHANADB)\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: (30013 + (dbInstanceNumberHANA * 100))\\n          backendPort: (30013 + (dbInstanceNumberHANA * 100))\\n          enableFloatingIP: true\\n          idleTimeoutInMinutes: idleTimeoutInMinutes\\n        }\\n        name: '${lbRulePrefixHANADB}3${padLeft(dbInstanceNumberHANA,2,'0')}13'\\n      }\\n      {\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n              loadBalancerNameDB_var,\\n              loadBalancerFrontendHANADB\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              loadBalancerNameDB_var,\\n              backendPoolHANADB\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadBalancerNameDB_var, probePortHANADB)\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: (30015 + (dbInstanceNumberHANA * 100))\\n          backendPort: (30015 + (dbInstanceNumberHANA * 100))\\n          enableFloatingIP: true\\n          idleTimeoutInMinutes: idleTimeoutInMinutes\\n        }\\n        name: '${lbRulePrefixHANADB}3${padLeft(dbInstanceNumberHANA,2,'0')}15'\\n      }\\n      {\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n              loadBalancerNameDB_var,\\n              loadBalancerFrontendHANADB\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              loadBalancerNameDB_var,\\n              backendPoolHANADB\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadBalancerNameDB_var, probePortHANADB)\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: (30040 + (dbInstanceNumberHANA * 100))\\n          backendPort: (30040 + (dbInstanceNumberHANA * 100))\\n          enableFloatingIP: true\\n          idleTimeoutInMinutes: idleTimeoutInMinutes\\n        }\\n        name: '${lbRulePrefixHANADB}3${padLeft(dbInstanceNumberHANA,2,'0')}40'\\n      }\\n      {\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n              loadBalancerNameDB_var,\\n              loadBalancerFrontendHANADB\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              loadBalancerNameDB_var,\\n              backendPoolHANADB\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadBalancerNameDB_var, probePortHANADB)\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: (30041 + (dbInstanceNumberHANA * 100))\\n          backendPort: (30041 + (dbInstanceNumberHANA * 100))\\n          enableFloatingIP: true\\n          idleTimeoutInMinutes: idleTimeoutInMinutes\\n        }\\n        name: '${lbRulePrefixHANADB}3${padLeft(dbInstanceNumberHANA,2,'0')}41'\\n      }\\n      {\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n              loadBalancerNameDB_var,\\n              loadBalancerFrontendHANADB\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              loadBalancerNameDB_var,\\n              backendPoolHANADB\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadBalancerNameDB_var, probePortHANADB)\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: (30042 + (dbInstanceNumberHANA * 100))\\n          backendPort: (30042 + (dbInstanceNumberHANA * 100))\\n          enableFloatingIP: true\\n          idleTimeoutInMinutes: idleTimeoutInMinutes\\n        }\\n        name: '${lbRulePrefixHANADB}3${padLeft(dbInstanceNumberHANA,2,'0')}42'\\n      }\\n    ]\\n  }\\n  SQL: {\\n    Windows: [\\n      {\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n              loadBalancerNameDB_var,\\n              loadBalancerFrontendSQLDB\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              loadBalancerNameDB_var,\\n              backendPoolSQLDB\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadBalancerNameDB_var, probePortSQLDB)\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 1433\\n          backendPort: 1433\\n          enableFloatingIP: true\\n          idleTimeoutInMinutes: idleTimeoutInMinutes\\n        }\\n        name: '${lbRulePrefixSQLDB}1433'\\n      }\\n    ]\\n  }\\n}\\nvar lbProbes = {\\n  HANA: {\\n    Linux: [\\n      {\\n        properties: {\\n          protocol: 'Tcp'\\n          port: probePortInternalHANADB\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n        name: probePortHANADB\\n      }\\n    ]\\n  }\\n  SQL: {\\n    Windows: [\\n      {\\n        properties: {\\n          protocol: 'Tcp'\\n          port: probePortInternalSQLDB\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n        name: probePortSQLDB\\n      }\\n      {\\n        properties: {\\n          protocol: 'Tcp'\\n          port: probePortInternalSQLCL\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n        name: probePortSQLCL\\n      }\\n    ]\\n  }\\n}\\nvar nicBackAddressPools = {\\n  HANA: {\\n    Linux: [\\n      {\\n        id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadBalancerNameDB_var, backendPoolHANADB)\\n      }\\n    ]\\n  }\\n  SQL: {\\n    Windows: [\\n      {\\n        id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadBalancerNameDB_var, backendPoolSQLDB)\\n      }\\n      {\\n        id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadBalancerNameDB_var, backendPoolSQLCL)\\n      }\\n    ]\\n  }\\n}\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2020-07-01' = if (length(subnetId) == 0) {\\n  name: concat(nsgName)\\n  location: location\\n  properties: {\\n    securityRules: selectedSecurityRules\\n  }\\n}\\n\\nresource vnet 'Microsoft.Network/virtualNetworks@2020-07-01' = if (length(subnetId) == 0) {\\n  name: vnetName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        '10.0.0.0/16'\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: '10.0.0.0/24'\\n          networkSecurityGroup: {\\n            id: nsg.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource avSetNameDB 'Microsoft.Compute/availabilitySets@2020-12-01' = {\\n  name: avSetNameDB_var\\n  location: location\\n  sku: {\\n    name: 'Aligned'\\n  }\\n  properties: {\\n    platformFaultDomainCount: 2\\n    platformUpdateDomainCount: 20\\n  }\\n}\\n\\nresource publicIpNameDB 'Microsoft.Network/publicIPAddresses@2020-07-01' = [\\n  for i in range(0, dbvmCount): if (length(subnetId) == 0) {\\n    name: '${publicIpNameDB_var}-${i}'\\n    location: location\\n    properties: {\\n      publicIPAllocationMethod: 'Dynamic'\\n    }\\n    dependsOn: [\\n      vnet\\n    ]\\n  }\\n]\\n\\nresource loadBalancerNameDB 'Microsoft.Network/loadBalancers@2020-07-01' = if (dbvmCount > 1) {\\n  name: loadBalancerNameDB_var\\n  location: location\\n  properties: {\\n    frontendIPConfigurations: lbFrontendConfigs[dbtype][internalOSType]\\n    backendAddressPools: lbBackendPools[dbtype][internalOSType]\\n    loadBalancingRules: lbRules[dbtype][internalOSType]\\n    probes: lbProbes[dbtype][internalOSType]\\n  }\\n  dependsOn: [\\n    vnet\\n  ]\\n}\\n\\nresource nicNameDB 'Microsoft.Network/networkInterfaces@2020-07-01' = [\\n  for i in range(0, dbvmCount): {\\n    name: '${nicNameDB_var}-${i}'\\n    location: location\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig1'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            publicIPAddress: ((length(subnetId) == 0)\\n              ? json('{\\\"id\\\": \\\"${resourceId('Microsoft.Network/publicIPAddresses','${publicIpNameDB_var}-${i}')}\\\"}')\\n              : json('null'))\\n            subnet: {\\n              id: selectedSubnetId\\n            }\\n            loadBalancerBackendAddressPools: ((dbvmCount > 1)\\n              ? nicBackAddressPools[dbtype][internalOSType]\\n              : json('null'))\\n          }\\n        }\\n      ]\\n      enableAcceleratedNetworking: sizes[sapSystemSize][dbtype].useFastNetwork\\n    }\\n    dependsOn: [\\n      publicIpNameDB\\n      vnet\\n      loadBalancerNameDB\\n    ]\\n  }\\n]\\n\\nresource vmNameDB 'Microsoft.Compute/virtualMachines@2020-12-01' = [\\n  for i in range(0, dbvmCount): {\\n    name: '${vmNameDB_var}-${i}'\\n    location: location\\n    properties: {\\n      availabilitySet: {\\n        id: avSetNameDB.id\\n      }\\n      hardwareProfile: {\\n        vmSize: sizes[sapSystemSize][dbtype].vmSize\\n      }\\n      osProfile: {\\n        computerName: '${vmNameDB_var}-${i}'\\n        adminUsername: adminUsername\\n        adminPassword: adminPasswordOrKey\\n        linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: images[osType].publisher\\n          offer: images[osType].offer\\n          sku: images[osType].sku\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          name: '${vmNameDB_var}-${i}-osdisk'\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n          diskSizeGB: images[osType].osDiskSize\\n          managedDisk: {\\n            storageAccountType: 'Premium_LRS'\\n          }\\n        }\\n        dataDisks: sizes[sapSystemSize][dbtype].disks\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', '${nicNameDB_var}-${i}')\\n          }\\n        ]\\n      }\\n    }\\n    dependsOn: [\\n      nicNameDB\\n      avSetNameDB\\n    ]\\n  }\\n]\\n\\nresource vmNameDB_cseExt 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = [\\n  for i in range(0, dbvmCount): {\\n    name: '${vmNameDB_var}-${i}/${cseExtName}'\\n    location: location\\n    properties: {\\n      publisher: cseExtPublisher\\n      type: cseExtName\\n      typeHandlerVersion: cseExtVersion\\n      autoUpgradeMinorVersion: true\\n      settings: {\\n        fileUris: [\\n          csExtensionScript\\n        ]\\n        commandToExecute: '${csExtensionscriptCall} ${sizes[sapSystemSize][dbtype].scriptArguments[internalOSType]}'\\n      }\\n    }\\n    dependsOn: [\\n      vmNameDB\\n    ]\\n  }\\n]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"sapSystemId\\\": {\\n      \\\"value\\\": \\\"DEV\\\"\\n    },\\n    \\\"osType\\\": {\\n      \\\"value\\\": \\\"Windows Server 2012 R2 Datacenter\\\"\\n    },\\n    \\\"dbtype\\\": {\\n      \\\"value\\\": \\\"SQL\\\"\\n    },\\n    \\\"sapSystemSize\\\": {\\n      \\\"value\\\": \\\"Small\\\"\\n    },\\n    \\\"systemAvailability\\\": {\\n      \\\"value\\\": \\\"Not HA\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"password\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('SAP System ID.')\\n@minLength(3)\\n@maxLength(3)\\nparam sapSystemId string = 'DEQ'\\n\\n@description('The computer name. This parameter is also used as virtual machine name. It is required if you want to deploy this template using SAP LaMa.')\\n@minLength(3)\\nparam computerName string = 'deq-xscs-0'\\n\\n@description('The type of the operating system you want to deploy.')\\n@allowed([\\n  'Windows Server 2012 Datacenter'\\n  'Windows Server 2012 R2 Datacenter'\\n  'Windows Server 2016 Datacenter'\\n  'SLES 12'\\n  'RHEL 7'\\n  'Oracle Linux 7'\\n])\\nparam osType string = 'Windows Server 2016 Datacenter'\\n\\n@description('The size of the SAP System you want to deploy.')\\n@allowed([\\n  'Demo'\\n  'Small < 2.000 SAPS'\\n  'Medium < 9.000 SAPS'\\n  'Large < 18.000 SAPS'\\n  'X-Large < 40.000 SAPS'\\n])\\nparam sapSystemSize string = 'Small < 2.000 SAPS'\\n\\n@description('Username for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Type of authentication to use on the Virtual Machine.')\\n@allowed([\\n  'password'\\n  'sshPublicKey'\\n])\\nparam authenticationType string = 'password'\\n\\n@description('Password or ssh key for the Virtual Machine.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('The id of the subnet you want to use.')\\nparam subnetId string = ''\\n\\n@description('You can deploy an empty target if you want to use the virtual machine as a target for an instance relocate or similar. In this case, no additional disks or IP configurations are attached.')\\nparam deployEmptyTarget bool = false\\n\\n@description('The location of the SAR archives. The location should contain archives for SAPCAR, SAP Host Agent, SAPACEXT,  Microsoft Visual C++ Redistributable and the Microsoft ODBC driver for SQL Server.')\\nparam sapArtifactsLocation string = ''\\n\\n@description('The sasToken required to access sapArtifactsLocation.')\\n@secure()\\nparam sapArtifactsLocationSasToken string = ''\\n\\n@description('The filename for the sapcar application that matches the operating system you deploy. sapcar is used to extract the archives you provide in other parameters.')\\nparam sapcarFilename string = ''\\n\\n@description('The filename of the SAP Host Agent archive. SAP Host Agent is deployed as part of this template depoyment.')\\nparam sapHostAgentArchiveFilename string = ''\\n\\n@description('The filename of the SAP Adaptive Extensions. SAP Note 2343511 lists the minimum patch level required for Azure.')\\nparam sapacExtArchiveFilename string = ''\\n\\n@description('The filename of the VC Runtime that is required to install the SAP Adaptive Extensions. This parameter is only required for Windows.')\\nparam vcRedistFilename string = ''\\n\\n@description('Password for the sapadm account.')\\n@secure()\\nparam sapadmPassword string\\n\\n@description('The Linux User Id of the sapadm user. Not required for Windows.')\\nparam sapadmId int = 790\\n\\n@description('The Linux group id of the sapsys group. Not required for Windows.')\\nparam sapsysGid int = 79\\n\\n@description('Zone number. Set to 0 if you do not want to use Availability Zones')\\n@minValue(0)\\n@maxValue(3)\\nparam availabilityZone int = 0\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar selectedZones = ((availabilityZone == 0) ? json('null') : array(availabilityZone))\\nvar images = {\\n  'Windows Server 2012 Datacenter': {\\n    sku: '2012-Datacenter'\\n    offer: 'WindowsServer'\\n    publisher: 'MicrosoftWindowsServer'\\n    OSType: 'Windows'\\n    osDiskSize: 128\\n  }\\n  'Windows Server 2012 R2 Datacenter': {\\n    sku: '2012-R2-Datacenter'\\n    offer: 'WindowsServer'\\n    publisher: 'MicrosoftWindowsServer'\\n    OSType: 'Windows'\\n    osDiskSize: 128\\n  }\\n  'Windows Server 2016 Datacenter': {\\n    sku: '2016-Datacenter'\\n    offer: 'WindowsServer'\\n    publisher: 'MicrosoftWindowsServer'\\n    OSType: 'Windows'\\n    osDiskSize: 128\\n  }\\n  'SLES 12': {\\n    sku: '12-SP3'\\n    offer: 'SLES-SAP'\\n    publisher: 'SUSE'\\n    OSType: 'Linux'\\n    osDiskSize: 128\\n  }\\n  'RHEL 7': {\\n    sku: '7.3'\\n    offer: 'RHEL'\\n    publisher: 'RedHat'\\n    OSType: 'Linux'\\n    osDiskSize: 128\\n  }\\n  'Oracle Linux 7': {\\n    sku: '7.3'\\n    offer: 'Oracle-Linux'\\n    publisher: 'Oracle'\\n    OSType: 'Linux'\\n    osDiskSize: 128\\n  }\\n}\\nvar internalOSType = images[osType].OSType\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar osConfigs = {\\n  Windows: {\\n    Publisher: 'Microsoft.Compute'\\n    Name: 'CustomScriptExtension'\\n    Version: '1.7'\\n    script: uri(_artifactsLocation, 'scripts/diskConfig.ps1${_artifactsLocationSasToken}')\\n    scriptCall: 'powershell.exe -ExecutionPolicy bypass -File scripts/diskConfig.ps1'\\n    disks: [\\n      {\\n        lun: 0\\n        caching: 'ReadOnly'\\n        createOption: 'Empty'\\n        diskSizeGB: 128\\n      }\\n    ]\\n    scriptArguments: '-luns \\\"0\\\" -names \\\"sap\\\" -paths \\\"C:\\\\\\\\usr\\\\\\\\sap\\\\\\\\${sapSystemId},C:\\\\\\\\usr\\\\\\\\sap\\\\\\\\trans\\\"  -sizes \\\"50,100\\\"'\\n  }\\n  Linux: {\\n    Publisher: 'Microsoft.Azure.Extensions'\\n    Name: 'CustomScript'\\n    Version: '2.0'\\n    script: uri(_artifactsLocation, 'scripts/diskConfig.sh${_artifactsLocationSasToken}')\\n    scriptCall: 'sh diskConfig.sh'\\n    disks: [\\n      {\\n        lun: 0\\n        caching: 'ReadOnly'\\n        createOption: 'Empty'\\n        diskSizeGB: 128\\n      }\\n    ]\\n    scriptArguments: '-luns \\\\'0\\\\' -names \\\\'sap\\\\' -paths \\\\'/sapmnt/${sapSystemId},/usr/sap/${sapSystemId},/usr/sap/trans,/home/${sidlower}adm\\\\' -sizes \\\\'20,30,70,100\\\\''\\n  }\\n}\\nvar cseExtPublisher = osConfigs[internalOSType].Publisher\\nvar cseExtName = osConfigs[internalOSType].Name\\nvar cseExtVersion = osConfigs[internalOSType].Version\\nvar csExtensionScript = osConfigs[internalOSType].script\\nvar csExtensionscriptCall = osConfigs[internalOSType].scriptCall\\nvar sizes = {\\n  Demo: {\\n    Linux: {\\n      vmSize: 'Standard_E2s_v3'\\n      useFastNetwork: false\\n    }\\n    Windows: {\\n      vmSize: 'Standard_E2s_v3'\\n      useFastNetwork: false\\n    }\\n  }\\n  'Small < 2.000 SAPS': {\\n    Linux: {\\n      vmSize: 'Standard_E2s_v3'\\n      useFastNetwork: false\\n    }\\n    Windows: {\\n      vmSize: 'Standard_E2s_v3'\\n      useFastNetwork: false\\n    }\\n  }\\n  'Medium < 9.000 SAPS': {\\n    Linux: {\\n      vmSize: 'Standard_E2s_v3'\\n      useFastNetwork: false\\n    }\\n    Windows: {\\n      vmSize: 'Standard_E2s_v3'\\n      useFastNetwork: false\\n    }\\n  }\\n  'Large < 18.000 SAPS': {\\n    Linux: {\\n      vmSize: 'Standard_E4s_v3'\\n      useFastNetwork: true\\n    }\\n    Windows: {\\n      vmSize: 'Standard_E4s_v3'\\n      useFastNetwork: true\\n    }\\n  }\\n  'X-Large < 40.000 SAPS': {\\n    Linux: {\\n      vmSize: 'Standard_E4s_v3'\\n      useFastNetwork: true\\n    }\\n    Windows: {\\n      vmSize: 'Standard_E4s_v3'\\n      useFastNetwork: true\\n    }\\n  }\\n}\\nvar vmName = computerName\\nvar nicName = '${vmName}-nic'\\nvar sidlower = toLower(sapSystemId)\\nvar vnetName = '${sidlower}-vnet'\\nvar nsgName = '${sidlower}-nsg'\\nvar subnetName = 'Subnet'\\nvar subnets = {\\ntrue: resourceId('Microsoft.Network/virtualNetworks/subnets',vnetName,subnetName)\\nfalse: subnetId\\n}\\nvar selectedSubnetId = subnets[string((length(subnetId) == 0))]\\nvar basicIPConfig = [\\n  {\\n    name: 'ipconfig-vm'\\n    properties: {\\n      privateIPAllocationMethod: 'Dynamic'\\n      subnet: {\\n        id: selectedSubnetId\\n      }\\n      primary: true\\n    }\\n  }\\n]\\nvar databaseIPConfig = {\\n  Linux: [\\n    {\\n      name: 'ipconfig-ascs'\\n      properties: {\\n        privateIPAllocationMethod: 'Dynamic'\\n        subnet: {\\n          id: selectedSubnetId\\n        }\\n        primary: false\\n      }\\n    }\\n  ]\\n  Windows: [\\n    {\\n      name: 'ipconfig-ascs'\\n      properties: {\\n        privateIPAllocationMethod: 'Dynamic'\\n        subnet: {\\n          id: selectedSubnetId\\n        }\\n        primary: false\\n      }\\n    }\\n  ]\\n}\\nvar selectedIPConfig = concat(basicIPConfig, (deployEmptyTarget ? json('[]') : databaseIPConfig[internalOSType]))\\nvar osSecurityRules = {\\n  Windows: [\\n    {\\n      name: 'RDP'\\n      properties: {\\n        description: 'Allow RDP Subnet'\\n        protocol: 'Tcp'\\n        sourcePortRange: '*'\\n        destinationPortRange: '3389'\\n        sourceAddressPrefix: '*'\\n        destinationAddressPrefix: '*'\\n        access: 'Allow'\\n        priority: 100\\n        direction: 'Inbound'\\n      }\\n    }\\n  ]\\n  Linux: [\\n    {\\n      name: 'SSH'\\n      properties: {\\n        description: 'Allow SSH Subnet'\\n        protocol: 'Tcp'\\n        sourcePortRange: '*'\\n        destinationPortRange: '22'\\n        sourceAddressPrefix: '*'\\n        destinationAddressPrefix: '*'\\n        access: 'Allow'\\n        priority: 100\\n        direction: 'Inbound'\\n      }\\n    }\\n  ]\\n}\\nvar selectedSecurityRules = osSecurityRules[internalOSType]\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2020-11-01' = if (length(subnetId) == 0) {\\n  name: concat(nsgName)\\n  location: location\\n  properties: {\\n    securityRules: selectedSecurityRules\\n  }\\n}\\n\\nresource vnet 'Microsoft.Network/virtualNetworks@2020-11-01' = if (length(subnetId) == 0) {\\n  name: vnetName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        '10.0.0.0/16'\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: '10.0.0.0/24'\\n          networkSecurityGroup: {\\n            id: nsg.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-11-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: selectedIPConfig\\n  }\\n  dependsOn: [\\n    vnet\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: concat(vmName)\\n  zones: selectedZones\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: sizes[sapSystemSize][internalOSType].vmSize\\n    }\\n    osProfile: {\\n      computerName: computerName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: images[osType].publisher\\n        offer: images[osType].offer\\n        sku: images[osType].sku\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmName}-osdisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n        diskSizeGB: images[osType].osDiskSize\\n        managedDisk: {\\n          storageAccountType: 'Premium_LRS'\\n        }\\n      }\\n      dataDisks: (deployEmptyTarget ? json('[]') : osConfigs[internalOSType].disks)\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource vmName_cseExt 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = if (!deployEmptyTarget) {\\n  name: '${vmName}/${cseExtName}'\\n  location: location\\n  properties: {\\n    publisher: cseExtPublisher\\n    type: cseExtName\\n    typeHandlerVersion: cseExtVersion\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        csExtensionScript\\n      ]\\n    }\\n    protectedSettings: {\\n      commandToExecute: '${csExtensionscriptCall} ${osConfigs[internalOSType].scriptArguments}'\\n    }\\n  }\\n  dependsOn: [\\n    vm\\n  ]\\n}\\n\\nmodule name_installsaphostagent '?' /*TODO: replace with correct path to [uri(parameters('_artifactsLocation'), concat('nestedtemplates/installHostAgent.json', parameters('_artifactsLocationSasToken')))]*/ = if (length(sapHostAgentArchiveFilename) > 0) {\\n  name: '${deployment().name}-installsaphostagent'\\n  params: {\\n    vmName: vmName\\n    cseExtName: cseExtName\\n    cseExtPublisher: cseExtPublisher\\n    cseExtVersion: cseExtVersion\\n    sapArtifactsLocation: sapArtifactsLocation\\n    sapArtifactsLocationSasToken: sapArtifactsLocationSasToken\\n    sapcarFilename: sapcarFilename\\n    sapHostAgentArchiveFilename: sapHostAgentArchiveFilename\\n    sapacExtArchiveFilename: sapacExtArchiveFilename\\n    vcRedistFilename: vcRedistFilename\\n    sapadmPassword: sapadmPassword\\n    sapadmId: sapadmId\\n    sapsysGid: sapsysGid\\n    osType: internalOSType\\n    location: location\\n  }\\n  dependsOn: [\\n    vmName_cseExt\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"sapSystemId\\\": {\\n      \\\"value\\\": \\\"DEQ\\\"\\n    },\\n    \\\"computerName\\\": {\\n      \\\"value\\\": \\\"deq-xscs-0\\\"\\n    },\\n    \\\"osType\\\": {\\n      \\\"value\\\": \\\"Windows Server 2016 Datacenter\\\"\\n    },\\n    \\\"sapSystemSize\\\": {\\n      \\\"value\\\": \\\"Small < 2.000 SAPS\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"password\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"deployEmptyTarget\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"sapArtifactsLocation\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"sapArtifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"sapcarFilename\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"sapHostAgentArchiveFilename\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"sapacExtArchiveFilename\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"vcRedistFilename\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"sapadmPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sapadmId\\\": {\\n      \\\"value\\\": 790\\n    },\\n    \\\"sapsysGid\\\": {\\n      \\\"value\\\": 79\\n    },\\n    \\\"availabilityZone\\\": {\\n      \\\"value\\\": 0\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"targetScope = 'resourceGroup'\\nmetadata description = 'Create a DC, a SQL Server 2022, and from 1 to 5 server(s) hosting a SharePoint Subscription / 2019 / 2016 farm with an extensive configuration, including trusted authentication, user profiles with personal sites, an OAuth trust (using a certificate), a dedicated IIS site for hosting high-trust add-ins, etc... The latest version of key softwares (including Fiddler, vscode, np++, 7zip, ULS Viewer) is installed. SharePoint machines have additional fine-tuning to make them immediately usable (remote administration tools, custom policies for Edge and Chrome, shortcuts, etc...).'\\nmetadata author = 'Yvand'\\n\\n@description('Location for all the resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Version of the SharePoint farm to create.')\\n@allowed([\\n  'Subscription-Latest'\\n  'Subscription-25H1'\\n  'Subscription-24H2'\\n  'Subscription-24H1'\\n  'Subscription-23H2'\\n  'Subscription-23H1'\\n  'Subscription-22H2'\\n  'Subscription-RTM'\\n  '2019'\\n  '2016'\\n])\\nparam sharePointVersion string = 'Subscription-Latest'\\n\\n@description('FQDN of the Active Directory forest.')\\n@minLength(5)\\nparam domainFqdn string = 'contoso.local'\\n\\n@description('Number of servers with MinRole Front-end to add to the farm.')\\n@allowed([\\n  0\\n  1\\n  2\\n  3\\n  4\\n])\\nparam frontEndServersCount int = 0\\n\\n@description('Name of the Active Directory and SharePoint administrator. \\\"admin\\\" and \\\"administrator\\\" are not allowed.')\\n@minLength(1)\\nparam adminUsername string\\n\\n@description('Password for the admin account. Input must meet password complexity requirements as documented in https://learn.microsoft.com/azure/virtual-machines/windows/faq#what-are-the-password-requirements-when-creating-a-vm-')\\n@minLength(8)\\n@secure()\\nparam adminPassword string\\n\\n@description('Password for all the other accounts and the SharePoint passphrase. Input must meet password complexity requirements as documented in https://learn.microsoft.com/azure/virtual-machines/windows/faq#what-are-the-password-requirements-when-creating-a-vm-')\\n@minLength(8)\\n@secure()\\nparam otherAccountsPassword string\\n\\n@description('''\\nSpecify if a rule in the network security groups should allow the inbound RDP traffic:\\n- \\\"No\\\" (default): No rule is created, RDP traffic is blocked.\\n- \\\"*\\\" or \\\"Internet\\\": RDP traffic is allowed from everywhere.\\n- CIDR notation (e.g. 192.168.99.0/24 or 2001:1234::/64) or an IP address (e.g. 192.168.99.0 or 2001:1234::): RDP traffic is allowed from the IP address / pattern specified.\\n''')\\n@minLength(1)\\nparam rdpTrafficRule string = 'No'\\n\\n@description('''\\nSelect how the virtual machines connect to internet.\\nIMPORTANT: With AzureFirewallProxy, you need to either enable Azure Bastion, or manually add a public IP address to a virtual machine, to be able to connect to it.\\n''')\\n@allowed([\\n  'PublicIPAddress'\\n  'AzureFirewallProxy'\\n])\\nparam outboundAccessMethod string = 'PublicIPAddress'\\n\\n@description('Set if the Public IP addresses of virtual machines should have a name label.')\\n@allowed([\\n  'No'\\n  'SharePointVMsOnly'\\n  'Yes'\\n])\\nparam addNameToPublicIpAddresses string = 'SharePointVMsOnly'\\n\\n@description('Specify if Azure Bastion should be provisioned. See https://azure.microsoft.com/en-us/services/azure-bastion for more information.')\\nparam enableAzureBastion bool = false\\n\\n@description('Enable the Azure Hybrid Benefit on virtual machines, to use your on-premises Windows Server licenses and reduce cost. See https://docs.microsoft.com/en-us/azure/virtual-machines/windows/hybrid-use-benefit-licensing for more information.')\\nparam enableHybridBenefitServerLicenses bool = false\\n\\n@description('Time zone of the virtual machines. Type \\\"[TimeZoneInfo]::GetSystemTimeZones().Id\\\" in PowerShell to get the list.')\\n@minLength(2)\\n@allowed([\\n  'Dateline Standard Time'\\n  'UTC-11'\\n  'Aleutian Standard Time'\\n  'Hawaiian Standard Time'\\n  'Marquesas Standard Time'\\n  'Alaskan Standard Time'\\n  'UTC-09'\\n  'Pacific Standard Time (Mexico)'\\n  'UTC-08'\\n  'Pacific Standard Time'\\n  'US Mountain Standard Time'\\n  'Mountain Standard Time (Mexico)'\\n  'Mountain Standard Time'\\n  'Central America Standard Time'\\n  'Central Standard Time'\\n  'Easter Island Standard Time'\\n  'Central Standard Time (Mexico)'\\n  'Canada Central Standard Time'\\n  'SA Pacific Standard Time'\\n  'Eastern Standard Time (Mexico)'\\n  'Eastern Standard Time'\\n  'Haiti Standard Time'\\n  'Cuba Standard Time'\\n  'US Eastern Standard Time'\\n  'Turks And Caicos Standard Time'\\n  'Paraguay Standard Time'\\n  'Atlantic Standard Time'\\n  'Venezuela Standard Time'\\n  'Central Brazilian Standard Time'\\n  'SA Western Standard Time'\\n  'Pacific SA Standard Time'\\n  'Newfoundland Standard Time'\\n  'Tocantins Standard Time'\\n  'E. South America Standard Time'\\n  'SA Eastern Standard Time'\\n  'Argentina Standard Time'\\n  'Greenland Standard Time'\\n  'Montevideo Standard Time'\\n  'Magallanes Standard Time'\\n  'Saint Pierre Standard Time'\\n  'Bahia Standard Time'\\n  'UTC-02'\\n  'Mid-Atlantic Standard Time'\\n  'Azores Standard Time'\\n  'Cape Verde Standard Time'\\n  'UTC'\\n  'GMT Standard Time'\\n  'Greenwich Standard Time'\\n  'Sao Tome Standard Time'\\n  'Morocco Standard Time'\\n  'W. Europe Standard Time'\\n  'Central Europe Standard Time'\\n  'Romance Standard Time'\\n  'Central European Standard Time'\\n  'W. Central Africa Standard Time'\\n  'Jordan Standard Time'\\n  'GTB Standard Time'\\n  'Middle East Standard Time'\\n  'Egypt Standard Time'\\n  'E. Europe Standard Time'\\n  'Syria Standard Time'\\n  'West Bank Standard Time'\\n  'South Africa Standard Time'\\n  'FLE Standard Time'\\n  'Israel Standard Time'\\n  'Kaliningrad Standard Time'\\n  'Sudan Standard Time'\\n  'Libya Standard Time'\\n  'Namibia Standard Time'\\n  'Arabic Standard Time'\\n  'Turkey Standard Time'\\n  'Arab Standard Time'\\n  'Belarus Standard Time'\\n  'Russian Standard Time'\\n  'E. Africa Standard Time'\\n  'Iran Standard Time'\\n  'Arabian Standard Time'\\n  'Astrakhan Standard Time'\\n  'Azerbaijan Standard Time'\\n  'Russia Time Zone 3'\\n  'Mauritius Standard Time'\\n  'Saratov Standard Time'\\n  'Georgian Standard Time'\\n  'Volgograd Standard Time'\\n  'Caucasus Standard Time'\\n  'Afghanistan Standard Time'\\n  'West Asia Standard Time'\\n  'Ekaterinburg Standard Time'\\n  'Pakistan Standard Time'\\n  'Qyzylorda Standard Time'\\n  'India Standard Time'\\n  'Sri Lanka Standard Time'\\n  'Nepal Standard Time'\\n  'Central Asia Standard Time'\\n  'Bangladesh Standard Time'\\n  'Omsk Standard Time'\\n  'Myanmar Standard Time'\\n  'SE Asia Standard Time'\\n  'Altai Standard Time'\\n  'W. Mongolia Standard Time'\\n  'North Asia Standard Time'\\n  'N. Central Asia Standard Time'\\n  'Tomsk Standard Time'\\n  'China Standard Time'\\n  'North Asia East Standard Time'\\n  'Singapore Standard Time'\\n  'W. Australia Standard Time'\\n  'Taipei Standard Time'\\n  'Ulaanbaatar Standard Time'\\n  'Aus Central W. Standard Time'\\n  'Transbaikal Standard Time'\\n  'Tokyo Standard Time'\\n  'North Korea Standard Time'\\n  'Korea Standard Time'\\n  'Yakutsk Standard Time'\\n  'Cen. Australia Standard Time'\\n  'AUS Central Standard Time'\\n  'E. Australia Standard Time'\\n  'AUS Eastern Standard Time'\\n  'West Pacific Standard Time'\\n  'Tasmania Standard Time'\\n  'Vladivostok Standard Time'\\n  'Lord Howe Standard Time'\\n  'Bougainville Standard Time'\\n  'Russia Time Zone 10'\\n  'Magadan Standard Time'\\n  'Norfolk Standard Time'\\n  'Sakhalin Standard Time'\\n  'Central Pacific Standard Time'\\n  'Russia Time Zone 11'\\n  'New Zealand Standard Time'\\n  'UTC+12'\\n  'Fiji Standard Time'\\n  'Kamchatka Standard Time'\\n  'Chatham Islands Standard Time'\\n  'UTC+13'\\n  'Tonga Standard Time'\\n  'Samoa Standard Time'\\n  'Line Islands Standard Time'\\n])\\nparam timeZone string = 'Romance Standard Time'\\n\\n@description('The time (24h HHmm format) at which the virtual machines will automatically be shutdown and deallocated. Set value to \\\"9999\\\" to NOT configure the auto shutdown.')\\n@minLength(4)\\n@maxLength(4)\\nparam autoShutdownTime string = '1900'\\n\\n@description('Size of the DC virtual machine.')\\nparam vmDcSize string = 'Standard_B2als_v2'\\n\\n@description('Type of storage for the managed disk. Visit https://docs.microsoft.com/en-us/rest/api/compute/disks/list#diskstorageaccounttypes for more information.')\\n@allowed([\\n  'Standard_LRS'\\n  'StandardSSD_LRS'\\n  'StandardSSD_ZRS'\\n  'Premium_LRS'\\n  'PremiumV2_LRS'\\n  'Premium_ZRS'\\n  'UltraSSD_LRS'\\n])\\nparam vmDcStorage string = 'StandardSSD_LRS'\\n\\n@description('Size of the SQL virtual machine.')\\nparam vmSqlSize string = 'Standard_B2as_v2'\\n\\n@description('Type of storage for the managed disk. Visit https://docs.microsoft.com/en-us/rest/api/compute/disks/list#diskstorageaccounttypes for more information.')\\n@allowed([\\n  'Standard_LRS'\\n  'StandardSSD_LRS'\\n  'StandardSSD_ZRS'\\n  'Premium_LRS'\\n  'PremiumV2_LRS'\\n  'Premium_ZRS'\\n  'UltraSSD_LRS'\\n])\\nparam vmSqlStorage string = 'StandardSSD_LRS'\\n\\n@description('Size of the SharePoint virtual machine(s).')\\nparam vmSharePointSize string = 'Standard_B4as_v2'\\n\\n@description('Type of storage for the managed disk. Visit https://docs.microsoft.com/en-us/rest/api/compute/disks/list#diskstorageaccounttypes for more information.')\\n@allowed([\\n  'Standard_LRS'\\n  'StandardSSD_LRS'\\n  'StandardSSD_ZRS'\\n  'Premium_LRS'\\n  'PremiumV2_LRS'\\n  'Premium_ZRS'\\n  'UltraSSD_LRS'\\n])\\nparam vmSharePointStorage string = 'StandardSSD_LRS'\\n\\n@description('The base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@secure()\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured.')\\nparam _artifactsLocationSasToken string = ''\\n\\n// Local variables\\nvar resourceGroupNameFormatted = replace(\\n  replace(replace(replace(resourceGroup().name, '.', '-'), '(', '-'), ')', '-'),\\n  '_',\\n  '-'\\n)\\n\\nvar sharePointSettings = {\\n  isSharePointSubscription: (startsWith(sharePointVersion, 'subscription') ? true : false)\\n  sharePointImagesList: {\\n    Subscription: 'MicrosoftWindowsServer:WindowsServer:2025-datacenter-azure-edition:latest'\\n    sp2019: 'MicrosoftSharePoint:MicrosoftSharePointServer:sp2019gen2smalldisk:latest'\\n    sp2016: 'MicrosoftSharePoint:MicrosoftSharePointServer:sp2016:latest'\\n  }\\n  sharePointSubscriptionBits: [\\n    {\\n      Label: 'RTM'\\n      Packages: [\\n        {\\n          DownloadUrl: 'https://download.microsoft.com/download/3/f/5/3f5f8a7e-462b-41ff-a5b2-04bdf5821ceb/OfficeServer.iso'\\n          ChecksumType: 'SHA256'\\n          Checksum: 'C576B847C573234B68FC602A0318F5794D7A61D8149EB6AE537AF04470B7FC05'\\n        }\\n      ]\\n    }\\n    {\\n      Label: '22H2'\\n      Packages: [\\n        {\\n          DownloadUrl: 'https://download.microsoft.com/download/8/d/f/8dfcb515-6e49-42e5-b20f-5ebdfd19d8e7/wssloc-subscription-kb5002270-fullfile-x64-glb.exe'\\n          ChecksumType: 'SHA256'\\n          Checksum: '7E496530EB873146650A9E0653DE835CB2CAD9AF8D154CBD7387BB0F2297C9FC'\\n        }\\n        {\\n          DownloadUrl: 'https://download.microsoft.com/download/3/f/5/3f5b1ee0-3336-45d7-b2f4-1e6af977d574/sts-subscription-kb5002271-fullfile-x64-glb.exe'\\n          ChecksumType: 'SHA256'\\n          Checksum: '247011443AC573D4F03B1622065A7350B8B3DAE04D6A5A6DC64C8270A3BE7636'\\n        }\\n      ]\\n    }\\n    {\\n      Label: '23H1'\\n      Packages: [\\n        {\\n          DownloadUrl: 'https://download.microsoft.com/download/c/6/a/c6a17105-3d86-42ad-888d-49b22383bfa1/uber-subscription-kb5002355-fullfile-x64-glb.exe'\\n        }\\n      ]\\n    }\\n    {\\n      Label: '23H2'\\n      Packages: [\\n        {\\n          DownloadUrl: 'https://download.microsoft.com/download/f/5/5/f5559e3f-8b24-419f-b238-b09cf986e927/uber-subscription-kb5002474-fullfile-x64-glb.exe'\\n        }\\n      ]\\n    }\\n    {\\n      Label: '24H1'\\n      Packages: [\\n        {\\n          DownloadUrl: 'https://download.microsoft.com/download/b/a/b/bab0c7cc-0454-474b-8538-7927f75e6486/uber-subscription-kb5002564-fullfile-x64-glb.exe'\\n        }\\n      ]\\n    }\\n    {\\n      Label: '24H2'\\n      Packages: [\\n        {\\n          DownloadUrl: 'https://download.microsoft.com/download/6/6/a/66a0057f-79af-4307-8263-103ee75ef5c6/uber-subscription-kb5002640-fullfile-x64-glb.exe'\\n        }\\n      ]\\n    }\\n    {\\n      Label: '25H1'\\n      Packages: [\\n        {\\n          DownloadUrl: 'https://download.microsoft.com/download/0b131072-7ee6-41ea-b33a-b3410865f3a0/uber-subscription-kb5002698-fullfile-x64-glb.exe'\\n        }\\n      ]\\n    }\\n    {\\n      Label: 'Latest'\\n      Packages: [\\n        {\\n          DownloadUrl: 'https://download.microsoft.com/download/0d0fac81-9f1b-4f9f-9269-0798f9e0666c/uber-subscription-kb5002709-fullfile-x64-glb.exe'\\n        }\\n      ]\\n    }\\n  ]\\n}\\n\\nvar templateSettings = {\\n  vNetPrivatePrefix: '10.1.0.0/16'\\n  domainNameLabelScope: 'SubscriptionReuse'\\n  enableAutomaticUpdates: true\\n  vmDCName: 'DC'\\n  vmSQLName: 'SQL'\\n  vmSPName: 'SP'\\n  vmFEName: 'FE'\\n  vmDCImage: 'MicrosoftWindowsServer:WindowsServer:2025-datacenter-azure-edition-smalldisk:latest'\\n  vmSQLImage: 'MicrosoftSQLServer:sql2022-ws2022:sqldev-gen2:latest'\\n  vmSharePointImage: sharePointSettings.isSharePointSubscription\\n    ? sharePointSettings.sharePointImagesList.Subscription\\n    : sharePointVersion == '2019'\\n        ? sharePointSettings.sharePointImagesList.sp2019\\n        : sharePointSettings.sharePointImagesList.sp2016\\n}\\n\\nvar environmentSettings = {\\n  dcPrivateIPAddress: '10.1.1.100'\\n  sharePointSitesAuthority: 'spsites'\\n  sharePointCentralAdminPort: 5000\\n  sharePointBitsSelected: (sharePointSettings.isSharePointSubscription\\n    ? sharePointSettings.sharePointSubscriptionBits\\n    : '')\\n  localAdminUserName: 'l-${uniqueString(subscription().subscriptionId)}'\\n  enableAnalysis: false\\n  applyBrowserPolicies: true\\n  sqlAlias: 'SQLAlias'\\n  spSuperUserName: 'spSuperUser'\\n  spSuperReaderName: 'spSuperReader'\\n  adfsSvcUserName: 'adfssvc'\\n  sqlSvcUserName: 'sqlsvc'\\n  spSetupUserName: 'spsetup'\\n  spFarmUserName: 'spfarm'\\n  spSvcUserName: 'spsvc'\\n  spAppPoolUserName: 'spapppool'\\n  spADDirSyncUserName: 'spdirsync'\\n}\\n\\n// Azure Firewall proxy settings\\nvar firewallProxySettings = {\\n  firewallAddressPrefix: cidrSubnet(templateSettings.vNetPrivatePrefix, 24, 3)\\n  httpPort: 8080\\n  httpsPort: 8443\\n}\\n\\n// Single-line PowerShell script that runs on the VMs to update their proxy settings, if Azure Firewall is enabled\\nvar firewall_set_proxy_script = 'param([string]$proxyIp, [string]$proxyHttpPort, [string]$proxyHttpsPort, [string]$localDomainFqdn) $proxy = \\\"http={0}:{1};https={0}:{2}\\\" -f $proxyIp, $proxyHttpPort, $proxyHttpsPort; $bypasslist = \\\"*.{0};<local>\\\" -f $localDomainFqdn; netsh winhttp set proxy proxy-server=$proxy bypass-list=$bypasslist; $proxyEnabled = 1; New-ItemProperty -Path \\\"HKLM:\\\\\\\\SOFTWARE\\\\\\\\Policies\\\\\\\\Microsoft\\\\\\\\Windows\\\\\\\\CurrentVersion\\\\\\\\Internet Settings\\\" -Name \\\"ProxySettingsPerUser\\\" -PropertyType DWORD -Value 0 -Force; $proxyBytes = [system.Text.Encoding]::ASCII.GetBytes($proxy); $bypassBytes = [system.Text.Encoding]::ASCII.GetBytes($bypasslist); $defaultConnectionSettings = [byte[]]@(@(70, 0, 0, 0, 0, 0, 0, 0, $proxyEnabled, 0, 0, 0, $proxyBytes.Length, 0, 0, 0) + $proxyBytes + @($bypassBytes.Length, 0, 0, 0) + $bypassBytes + @(1..36 | % { 0 })); $registryPaths = @(\\\"HKLM:\\\\\\\\Software\\\\\\\\Microsoft\\\\\\\\Windows\\\\\\\\CurrentVersion\\\\\\\\Internet Settings\\\", \\\"HKLM:\\\\\\\\Software\\\\\\\\WOW6432Node\\\\\\\\Microsoft\\\\\\\\Windows\\\\\\\\CurrentVersion\\\\\\\\Internet Settings\\\"); foreach ($registryPath in $registryPaths) { Set-ItemProperty -Path $registryPath -Name ProxyServer -Value $proxy; Set-ItemProperty -Path $registryPath -Name ProxyEnable -Value $proxyEnabled; Set-ItemProperty -Path $registryPath -Name ProxyOverride -Value $bypasslist; Set-ItemProperty -Path \\\"$registryPath\\\\\\\\Connections\\\" -Name DefaultConnectionSettings -Value $defaultConnectionSettings; } Bitsadmin /util /setieproxy localsystem MANUAL_PROXY $proxy $bypasslist;'\\nvar firewall_runCommandProperties = {\\n  source: {\\n    script: firewall_set_proxy_script\\n  }\\n  parameters: [\\n    {\\n      name: 'proxyIp'\\n      value: cidrHost(firewallProxySettings.firewallAddressPrefix, 3) // Typically: '10.1.3.4' (based on firewallAddressPrefix 10.1.3.0/24)\\n    }\\n    {\\n      name: 'proxyHttpPort'\\n      value: string(firewallProxySettings.httpPort)\\n    }\\n    {\\n      name: 'proxyHttpsPort'\\n      value: string(firewallProxySettings.httpsPort)\\n    }\\n    {\\n      name: 'localDomainFqdn'\\n      value: domainFqdn\\n    }\\n  ]\\n  timeoutInSeconds: 90\\n  treatFailureAsDeploymentFailure: false\\n}\\n\\nvar baseVirtualMachines = [\\n  {\\n    virtualMachineSettings: {\\n      adminUsername: adminUsername\\n      virtualMachineName: templateSettings.vmDCName\\n      virtualMachineSize: vmDcSize\\n      virtualMachineStorage: vmDcStorage\\n      virtualMachineDiskSizeGB: 32\\n      virtualMachineSecurityType: 'TrustedLaunch'\\n      imageReference: {\\n        publisher: split(templateSettings.vmDCImage, ':')[0]\\n        offer: split(templateSettings.vmDCImage, ':')[1]\\n        sku: split(templateSettings.vmDCImage, ':')[2]\\n        version: split(templateSettings.vmDCImage, ':')[3]\\n      }\\n      privateIPAddress: environmentSettings.dcPrivateIPAddress\\n      pipConfiguration: outboundAccessMethod == 'PublicIPAddress'\\n        ? {\\n            publicIpNameSuffix: '-pip-01'\\n            publicIpSku: 'Standard'\\n            publicIPAllocationMethod: 'Static'\\n            zones: []\\n            dnsSettings: addNameToPublicIpAddresses == 'Yes'\\n              ? {\\n                  domainNameLabel: toLower('${resourceGroupNameFormatted}-${templateSettings.vmDCName}')\\n                  domainNameLabelScope: templateSettings.domainNameLabelScope\\n                }\\n              : null\\n          }\\n        : {}\\n    }\\n    dscSettings: {\\n      wmfVersion: 'latest'\\n      configuration: {\\n        url: uri(_artifactsLocation, 'dsc/ConfigureDCVM.zip${_artifactsLocationSasToken}')\\n        script: 'ConfigureDCVM.ps1'\\n        function: 'ConfigureDCVM'\\n      }\\n      configurationArguments: {\\n        domainFQDN: domainFqdn\\n        PrivateIP: environmentSettings.dcPrivateIPAddress\\n        SPServerName: templateSettings.vmSPName\\n        SharePointSitesAuthority: environmentSettings.sharePointSitesAuthority\\n        SharePointCentralAdminPort: environmentSettings.sharePointCentralAdminPort\\n        ApplyBrowserPolicies: environmentSettings.applyBrowserPolicies\\n      }\\n      privacy: {\\n        dataCollection: 'enable'\\n      }\\n    }\\n    dscProtectedSettings: {\\n      configurationArguments: {\\n        AdminCreds: {\\n          UserName: adminUsername\\n          Password: adminPassword\\n        }\\n        AdfsSvcCreds: {\\n          UserName: environmentSettings.adfsSvcUserName\\n          Password: otherAccountsPassword\\n        }\\n      }\\n    }\\n  }\\n  {\\n    virtualMachineSettings: {\\n      adminUsername: environmentSettings.localAdminUserName\\n      virtualMachineName: templateSettings.vmSQLName\\n      virtualMachineSize: vmSqlSize\\n      virtualMachineStorage: vmSqlStorage\\n      virtualMachineDiskSizeGB: 128\\n      virtualMachineSecurityType: 'TrustedLaunch'\\n      imageReference: {\\n        publisher: split(templateSettings.vmSQLImage, ':')[0]\\n        offer: split(templateSettings.vmSQLImage, ':')[1]\\n        sku: split(templateSettings.vmSQLImage, ':')[2]\\n        version: split(templateSettings.vmSQLImage, ':')[3]\\n      }\\n      privateIPAddress: null\\n      pipConfiguration: outboundAccessMethod == 'PublicIPAddress'\\n        ? {\\n            publicIpNameSuffix: '-pip-01'\\n            publicIpSku: 'Standard'\\n            publicIPAllocationMethod: 'Static'\\n            zones: []\\n            dnsSettings: addNameToPublicIpAddresses == 'Yes'\\n              ? {\\n                  domainNameLabel: toLower('${resourceGroupNameFormatted}-${templateSettings.vmSQLName}')\\n                  domainNameLabelScope: templateSettings.domainNameLabelScope\\n                }\\n              : null\\n          }\\n        : {}\\n    }\\n    dscSettings: {\\n      wmfVersion: 'latest'\\n      configuration: {\\n        url: uri(_artifactsLocation, 'dsc/ConfigureSQLVM.zip${_artifactsLocationSasToken}')\\n        script: 'ConfigureSQLVM.ps1'\\n        function: 'ConfigureSQLVM'\\n      }\\n      configurationArguments: {\\n        DNSServerIP: environmentSettings.dcPrivateIPAddress\\n        DomainFQDN: domainFqdn\\n      }\\n      privacy: {\\n        dataCollection: 'enable'\\n      }\\n    }\\n    dscProtectedSettings: {\\n      configurationArguments: {\\n        DomainAdminCreds: {\\n          UserName: adminUsername\\n          Password: adminPassword\\n        }\\n        SqlSvcCreds: {\\n          UserName: environmentSettings.sqlSvcUserName\\n          Password: otherAccountsPassword\\n        }\\n        SPSetupCreds: {\\n          UserName: environmentSettings.spSetupUserName\\n          Password: otherAccountsPassword\\n        }\\n      }\\n    }\\n  }\\n  {\\n    virtualMachineSettings: {\\n      adminUsername: environmentSettings.localAdminUserName\\n      virtualMachineName: templateSettings.vmSPName\\n      virtualMachineSize: vmSharePointSize\\n      virtualMachineStorage: vmSharePointStorage\\n      virtualMachineDiskSizeGB: 128\\n      virtualMachineSecurityType: sharePointVersion == '2016' ? null : 'TrustedLaunch'\\n      imageReference: {\\n        publisher: split(templateSettings.vmSharePointImage, ':')[0]\\n        offer: split(templateSettings.vmSharePointImage, ':')[1]\\n        sku: split(templateSettings.vmSharePointImage, ':')[2]\\n        version: split(templateSettings.vmSharePointImage, ':')[3]\\n      }\\n      privateIPAddress: null\\n      pipConfiguration: outboundAccessMethod == 'PublicIPAddress'\\n        ? {\\n            publicIpNameSuffix: '-pip-01'\\n            publicIpSku: 'Standard'\\n            publicIPAllocationMethod: 'Static'\\n            zones: []\\n            dnsSettings: addNameToPublicIpAddresses == 'Yes' || addNameToPublicIpAddresses == 'SharePointVMsOnly'\\n              ? {\\n                  domainNameLabel: toLower('${resourceGroupNameFormatted}-${templateSettings.vmSPName}')\\n                  domainNameLabelScope: templateSettings.domainNameLabelScope\\n                }\\n              : null\\n          }\\n        : {}\\n    }\\n    dscSettings: {\\n      wmfVersion: 'latest'\\n      configuration: {\\n        url: uri(\\n          _artifactsLocation,\\n          '${sharePointSettings.isSharePointSubscription ? 'dsc/ConfigureSPSE.zip' : 'dsc/ConfigureSPLegacy.zip'}${_artifactsLocationSasToken}'\\n        )\\n        script: (sharePointSettings.isSharePointSubscription ? 'ConfigureSPSE.ps1' : 'ConfigureSPLegacy.ps1')\\n        function: 'ConfigureSPVM'\\n      }\\n      configurationArguments: {\\n        DNSServerIP: environmentSettings.dcPrivateIPAddress\\n        DomainFQDN: domainFqdn\\n        DCServerName: templateSettings.vmDCName\\n        SQLServerName: templateSettings.vmSQLName\\n        SQLAlias: environmentSettings.sqlAlias\\n        SharePointVersion: sharePointVersion\\n        SharePointSitesAuthority: environmentSettings.sharePointSitesAuthority\\n        SharePointCentralAdminPort: environmentSettings.sharePointCentralAdminPort\\n        EnableAnalysis: environmentSettings.enableAnalysis\\n        SharePointBits: environmentSettings.sharePointBitsSelected\\n      }\\n      privacy: {\\n        dataCollection: 'enable'\\n      }\\n    }\\n    dscProtectedSettings: {\\n      configurationArguments: {\\n        DomainAdminCreds: {\\n          UserName: adminUsername\\n          Password: adminPassword\\n        }\\n        SPSetupCreds: {\\n          UserName: environmentSettings.spSetupUserName\\n          Password: otherAccountsPassword\\n        }\\n        SPFarmCreds: {\\n          UserName: environmentSettings.spFarmUserName\\n          Password: otherAccountsPassword\\n        }\\n        SPSvcCreds: {\\n          UserName: environmentSettings.spSvcUserName\\n          Password: otherAccountsPassword\\n        }\\n        SPAppPoolCreds: {\\n          UserName: environmentSettings.spAppPoolUserName\\n          Password: otherAccountsPassword\\n        }\\n        SPADDirSyncCreds: {\\n          UserName: environmentSettings.spADDirSyncUserName\\n          Password: otherAccountsPassword\\n        }\\n        SPPassphraseCreds: {\\n          UserName: 'Passphrase'\\n          Password: otherAccountsPassword\\n        }\\n        SPSuperUserCreds: {\\n          UserName: environmentSettings.spSuperUserName\\n          Password: otherAccountsPassword\\n        }\\n        SPSuperReaderCreds: {\\n          UserName: environmentSettings.spSuperReaderName\\n          Password: otherAccountsPassword\\n        }\\n      }\\n    }\\n  }\\n]\\n\\nvar frontendVirtualMachinesSettings = {\\n  virtualMachineSettings: {\\n    adminUsername: environmentSettings.localAdminUserName\\n    virtualMachineName: templateSettings.vmFEName\\n    virtualMachineSize: vmSharePointSize\\n    virtualMachineStorage: vmSharePointStorage\\n    virtualMachineDiskSizeGB: 128\\n    virtualMachineSecurityType: sharePointVersion == '2016' ? null : 'TrustedLaunch'\\n    imageReference: {\\n      publisher: split(templateSettings.vmSharePointImage, ':')[0]\\n      offer: split(templateSettings.vmSharePointImage, ':')[1]\\n      sku: split(templateSettings.vmSharePointImage, ':')[2]\\n      version: split(templateSettings.vmSharePointImage, ':')[3]\\n    }\\n    privateIPAddress: null\\n  }\\n  dscSettings: {\\n    wmfVersion: 'latest'\\n    configuration: {\\n      url: uri(\\n        _artifactsLocation,\\n        '${(sharePointSettings.isSharePointSubscription ? 'dsc/ConfigureFESE.zip' : 'dsc/ConfigureFELegacy.zip')}${_artifactsLocationSasToken}'\\n      )\\n      script: (sharePointSettings.isSharePointSubscription ? 'ConfigureFESE.ps1' : 'ConfigureFELegacy.ps1')\\n      function: 'ConfigureFEVM'\\n    }\\n    configurationArguments: {\\n      DNSServerIP: environmentSettings.dcPrivateIPAddress\\n      DomainFQDN: domainFqdn\\n      DCServerName: templateSettings.vmDCName\\n      SQLServerName: templateSettings.vmSQLName\\n      SQLAlias: environmentSettings.sqlAlias\\n      SharePointVersion: sharePointVersion\\n      SharePointSitesAuthority: environmentSettings.sharePointSitesAuthority\\n      EnableAnalysis: environmentSettings.enableAnalysis\\n      SharePointBits: environmentSettings.sharePointBitsSelected\\n    }\\n    privacy: {\\n      dataCollection: 'enable'\\n    }\\n  }\\n  dscProtectedSettings: {\\n    configurationArguments: {\\n      DomainAdminCreds: {\\n        UserName: adminUsername\\n        Password: adminPassword\\n      }\\n      SPSetupCreds: {\\n        UserName: environmentSettings.spSetupUserName\\n        Password: otherAccountsPassword\\n      }\\n      SPFarmCreds: {\\n        UserName: environmentSettings.spFarmUserName\\n        Password: otherAccountsPassword\\n      }\\n      SPPassphraseCreds: {\\n        UserName: 'Passphrase'\\n        Password: otherAccountsPassword\\n      }\\n    }\\n  }\\n}\\n\\nmodule virtualNetwork 'virtualNetwork.bicep' = {\\n  scope: resourceGroup()\\n  name: 'vnet-module'\\n  params: {\\n    location: location\\n    virtualNetworkName: 'vnet'\\n    addressPrefix: templateSettings.vNetPrivatePrefix\\n    mainSubnetAddressPrefix: cidrSubnet(templateSettings.vNetPrivatePrefix, 24, 1)\\n    networkSecurityRules: toLower(rdpTrafficRule) == 'no'\\n      ? []\\n      : [\\n          {\\n            name: 'nsg-rule-allow-rdp'\\n            properties: {\\n              description: 'Allow RDP'\\n              protocol: 'Tcp'\\n              sourcePortRange: '*'\\n              destinationPortRange: '3389'\\n              sourceAddressPrefix: rdpTrafficRule\\n              destinationAddressPrefix: '*'\\n              access: 'Allow'\\n              priority: 110\\n              direction: 'Inbound'\\n            }\\n          }\\n        ]\\n  }\\n}\\n\\n//@sys.batchSize(3)\\nmodule baseVirtualMachinesModule 'virtualMachine.bicep' = [\\n  for baseVirtualMachine in baseVirtualMachines: {\\n    scope: resourceGroup()\\n    name: 'virtualMachine-${baseVirtualMachine.virtualMachineSettings.virtualMachineName}-module'\\n    params: {\\n      location: location\\n      adminPassword: adminPassword\\n      subnetResourceId: virtualNetwork.outputs.mainSubnetResourceId\\n      licenseType: enableHybridBenefitServerLicenses ? 'Windows_Server' : null\\n      timeZone: timeZone\\n      autoShutdownTime: autoShutdownTime\\n      adminUsername: baseVirtualMachine.virtualMachineSettings.adminUsername\\n      virtualMachineName: baseVirtualMachine.virtualMachineSettings.virtualMachineName\\n      virtualMachineDiskSizeGB: baseVirtualMachine.virtualMachineSettings.virtualMachineDiskSizeGB\\n      virtualMachineImageReference: baseVirtualMachine.virtualMachineSettings.imageReference\\n      virtualMachineSize: baseVirtualMachine.virtualMachineSettings.virtualMachineSize\\n      virtualMachineStorageAccountType: baseVirtualMachine.virtualMachineSettings.virtualMachineStorage\\n      virtualMachineSecurityType: baseVirtualMachine.virtualMachineSettings.virtualMachineSecurityType\\n      pipConfiguration: baseVirtualMachine.virtualMachineSettings.?pipConfiguration\\n      privateIPAddress: baseVirtualMachine.virtualMachineSettings.privateIPAddress\\n      dscSettings: baseVirtualMachine.dscSettings\\n      dscProtectedSettings: baseVirtualMachine.dscProtectedSettings\\n      runCommandProperties: outboundAccessMethod == 'AzureFirewallProxy' ? firewall_runCommandProperties : null\\n    }\\n  }\\n]\\n\\nmodule frontends 'virtualMachine.bicep' = [\\n  for index in range(0, frontEndServersCount): {\\n    scope: resourceGroup()\\n    name: 'virtualMachine-FE-${index}-module'\\n    params: {\\n      location: location\\n      adminPassword: adminPassword\\n      subnetResourceId: virtualNetwork.outputs.mainSubnetResourceId\\n      licenseType: enableHybridBenefitServerLicenses ? 'Windows_Server' : null\\n      timeZone: timeZone\\n      autoShutdownTime: autoShutdownTime\\n      adminUsername: frontendVirtualMachinesSettings.virtualMachineSettings.adminUsername\\n      virtualMachineName: '${frontendVirtualMachinesSettings.virtualMachineSettings.virtualMachineName}-${index}'\\n      virtualMachineDiskSizeGB: frontendVirtualMachinesSettings.virtualMachineSettings.virtualMachineDiskSizeGB\\n      virtualMachineImageReference: frontendVirtualMachinesSettings.virtualMachineSettings.imageReference\\n      virtualMachineSize: frontendVirtualMachinesSettings.virtualMachineSettings.virtualMachineSize\\n      virtualMachineStorageAccountType: frontendVirtualMachinesSettings.virtualMachineSettings.virtualMachineStorage\\n      virtualMachineSecurityType: frontendVirtualMachinesSettings.virtualMachineSettings.?virtualMachineSecurityType\\n      pipConfiguration: outboundAccessMethod == 'PublicIPAddress'\\n        ? {\\n            publicIpNameSuffix: '-pip-01'\\n            publicIpSku: 'Standard'\\n            publicIPAllocationMethod: 'Static'\\n            zones: []\\n            dnsSettings: addNameToPublicIpAddresses == 'Yes' || addNameToPublicIpAddresses == 'SharePointVMsOnly'\\n              ? {\\n                  domainNameLabel: toLower('${resourceGroupNameFormatted}-${templateSettings.vmFEName}-${index}')\\n                  domainNameLabelScope: templateSettings.domainNameLabelScope\\n                }\\n              : null\\n          }\\n        : {}\\n      privateIPAddress: frontendVirtualMachinesSettings.virtualMachineSettings.privateIPAddress\\n      dscSettings: frontendVirtualMachinesSettings.dscSettings\\n      dscProtectedSettings: frontendVirtualMachinesSettings.dscProtectedSettings\\n      runCommandProperties: outboundAccessMethod == 'AzureFirewallProxy' ? firewall_runCommandProperties : null\\n    }\\n  }\\n]\\n\\nmodule bastion 'bastion.bicep' = if (enableAzureBastion == true) {\\n  scope: resourceGroup()\\n  name: 'bastion-module'\\n  params: {\\n    virtualNetworkName: virtualNetwork.outputs.vnetName\\n  }\\n}\\n\\nmodule firewall 'firewall.bicep' = if (outboundAccessMethod == 'AzureFirewallProxy') {\\n  scope: resourceGroup()\\n  name: 'firewall-module'\\n  params: {\\n    virtualNetworkName: virtualNetwork.outputs.vnetName\\n    addressPrefix: firewallProxySettings.firewallAddressPrefix\\n    http_port: firewallProxySettings.httpPort\\n    https_port: firewallProxySettings.httpsPort\\n  }\\n}\\n\\noutput domainAdminAccount string = '${substring(domainFqdn,0,indexOf(domainFqdn,'.'))}\\\\\\\\${adminUsername}'\\noutput domainAdminAccountFormatForBastion string = '${adminUsername}@${domainFqdn}'\\noutput localAdminAccount string = environmentSettings.localAdminUserName\\n\\n// output vm_base_public_dns array = [\\n//   for i in range(0, 2): (outboundAccessMethod == 'PublicIPAddress')\\n//     ? baseVirtualMachinesModule[i].outputs.virtualMachinePublicDomainName != null\\n//         ? baseVirtualMachinesModule[i].outputs.virtualMachinePublicDomainName\\n//         : baseVirtualMachinesModule[i].outputs.virtualMachinePublicIP\\n//     : null\\n// ]\\n\\n// output vm_fe_public_dns array = [\\n//   for i in range(0, frontEndServersCount - 1): (outboundAccessMethod == 'PublicIPAddress')\\n//     ? addNameToPublicIpAddresses == 'Yes' || addNameToPublicIpAddresses == 'SharePointVMsOnly'\\n//         ? frontends[i].outputs.virtualMachinePublicDomainName\\n//         : frontends[i].outputs.virtualMachinePublicIP\\n//     : null\\n// ]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"sharePointVersion\\\": {\\n      \\\"value\\\": \\\"Subscription-Latest\\\"\\n    },\\n    \\\"domainFqdn\\\": {\\n      \\\"value\\\": \\\"contoso.local\\\"\\n    },\\n    \\\"frontEndServersCount\\\": {\\n      \\\"value\\\": 0\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"otherAccountsPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"rdpTrafficRule\\\": {\\n      \\\"value\\\": \\\"No\\\"\\n    },\\n    \\\"outboundAccessMethod\\\": {\\n      \\\"value\\\": \\\"PublicIPAddress\\\"\\n    },\\n    \\\"addNameToPublicIpAddresses\\\": {\\n      \\\"value\\\": \\\"SharePointVMsOnly\\\"\\n    },\\n    \\\"enableAzureBastion\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"enableHybridBenefitServerLicenses\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"timeZone\\\": {\\n      \\\"value\\\": \\\"Romance Standard Time\\\"\\n    },\\n    \\\"autoShutdownTime\\\": {\\n      \\\"value\\\": \\\"1900\\\"\\n    },\\n    \\\"vmDcSize\\\": {\\n      \\\"value\\\": \\\"Standard_B2als_v2\\\"\\n    },\\n    \\\"vmDcStorage\\\": {\\n      \\\"value\\\": \\\"StandardSSD_LRS\\\"\\n    },\\n    \\\"vmSqlSize\\\": {\\n      \\\"value\\\": \\\"Standard_B2as_v2\\\"\\n    },\\n    \\\"vmSqlStorage\\\": {\\n      \\\"value\\\": \\\"StandardSSD_LRS\\\"\\n    },\\n    \\\"vmSharePointSize\\\": {\\n      \\\"value\\\": \\\"Standard_B4as_v2\\\"\\n    },\\n    \\\"vmSharePointStorage\\\": {\\n      \\\"value\\\": \\\"StandardSSD_LRS\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('User name for the Virtual Machine administrator. Do not use simple names such as \\\\'admin\\\\'.')\\nparam adminUsername string\\n\\n@description('Password for the Virtual Machine administrator.')\\n@secure()\\nparam adminPassword string\\n\\n@description('Unique name that will be used to generate various other names including the name of the Public IP used to access the Virtual Machine.')\\nparam uniqueNamePrefix string\\n\\n@description('The Windows version for the VM. This will pick a fully patched image of this given Windows version. Allowed values: 2008-R2-SP1, 2012-Datacenter, 2012-R2-Datacenter.')\\n@allowed([\\n  '2016-Datacenter'\\n])\\nparam windowsOSVersion string = '2016-Datacenter'\\n\\n@description('The size of the VM.')\\n@allowed([\\n  'Standard_A0'\\n  'Standard_A1'\\n  'Standard_A2'\\n  'Standard_A3'\\n  'Standard_A4'\\n  'Standard_A5'\\n  'Standard_A6'\\n  'Standard_A7'\\n  'Standard_A8'\\n  'Standard_A9'\\n  'Standard_A10'\\n  'Standard_A11'\\n  'Standard_D8_v3'\\n  'Standard_D2_v3'\\n  'Standard_D4_v3'\\n  'Standard_D8_v3'\\n  'Standard_D4_v3'\\n  'Standard_D4_v3'\\n  'Standard_D8_v3'\\n  'Standard_D16_v3'\\n])\\nparam vmSize string = 'Standard_D4_v3'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar newStorageAccountName = '${uniqueString(resourceGroup().id)}shs'\\nvar imagePublisher = 'MicrosoftWindowsServer'\\nvar imageOffer = 'WindowsServer'\\nvar nicName = '${uniqueNamePrefix}Nic'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'Subnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar storageAccountType = 'Standard_LRS'\\nvar publicIPAddressName = '${uniqueNamePrefix}IP'\\nvar publicIPAddressType = 'Dynamic'\\nvar vmName = '${uniqueNamePrefix}VM'\\nvar virtualNetworkName = '${uniqueNamePrefix}VNet'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar installScriptName = 'install_shibboleth_idp.ps1'\\nvar installCommand = 'powershell.exe -File ${installScriptName} ${uniqueNamePrefix} ${location}'\\n\\nresource newStorageAccount 'Microsoft.Storage/storageAccounts@2021-01-01' = {\\n  location: location\\n  name: newStorageAccountName\\n  sku: {\\n    name: storageAccountType\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: uniqueNamePrefix\\n    }\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: windowsOSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n  dependsOn: [\\n    newStorageAccount\\n  ]\\n}\\n\\nresource vmName_CustomScriptExtension 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: vm\\n  name: 'CustomScriptExtension'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Compute'\\n    type: 'CustomScriptExtension'\\n    typeHandlerVersion: '1.9'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        uri(_artifactsLocation, concat(installScriptName, _artifactsLocationSasToken))\\n      ]\\n      commandToExecute: installCommand\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"uniqueNamePrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"windowsOSVersion\\\": {\\n      \\\"value\\\": \\\"2016-Datacenter\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D4_v3\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name to use for the AKS Cluster.')\\nparam aksClusterName string = 'sql-server-aks'\\n\\n@description('The name of the resource group to create the AKS Cluster in.')\\nparam aksResourceGroupName string = 'sql-server-always-on'\\n\\n@description('AAD Client ID for Azure account authentication - used to authenticate to Azure using Service Principal for ACI creation to run CNAB operation and also for AKS Cluster.')\\n@secure()\\nparam azureClientId string\\n\\n@description('AAD Client Secret for Azure account authentication - used to authenticate to Azure using Service Principal for ACI creation to run CNAB operation and also for AKS Cluster.')\\n@secure()\\nparam azureClientSecret string\\n\\n@description('The name of the action to be performed on the application instance.')\\nparam cnabAction string = 'install'\\n\\n@description('The name of the application instance.')\\nparam cnabInstallationName string = 'porter-sql-server-always-on'\\n\\n@description('The file share name in the storage account for the CNAB state to be stored in')\\nparam cnabStateShareName string = ''\\n\\n@secure()\\n@description('The storage account key for the account for the CNAB state to be stored in, if this is left blank it will be looked up at runtime')\\nparam cnabStateStorageAccountKey string = ''\\n\\n@description('The storage account name for the account for the CNAB state to be stored in, by default this will be in the current resource group and will be created if it does not exist')\\nparam cnabStateStorageAccountName string = 'cnabstate${uniqueString(resourceGroup().id)}'\\n\\n@description('The resource group name for the storage account for the CNAB state to be stored in, by default this will be in the current resource group, if this is changed to a different resource group the storage account is expected to already exist')\\nparam cnabStateStorageAccountResourceGroupName string = resourceGroup().name\\n\\n@description('Name for the container group')\\nparam containerGroupName string = 'cg-${uniqueString(resourceGroup().id)}'\\n\\n@description('Name for the container')\\nparam containerName string = 'cn-${uniqueString(resourceGroup().id)}'\\n\\n@description('The location in which the resources will be created.')\\nparam location string = resourceGroup().location\\n\\n@description('The Password for the SQL Server Master Key.')\\n@secure()\\nparam sqlMasterkeyPassword string\\n\\n@description('The Password for the sa user in SQL Server.')\\n@secure()\\nparam sqlSaPassword string\\n\\nresource cnabStateStorageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' = if (cnabStateStorageAccountResourceGroupName == resourceGroup().name) {\\n  name: cnabStateStorageAccountName\\n  location: location\\n  sku: {\\n    name: 'Standard_LRS'\\n  }\\n  kind: 'StorageV2'\\n  properties: {\\n    encryption: {\\n      keySource: 'Microsoft.Storage'\\n      services: {\\n        file: {\\n          enabled: true\\n        }\\n      }\\n    }\\n  }\\n}\\n\\nresource containerGroup 'Microsoft.ContainerInstance/containerGroups@2023-05-01' = {\\n  name: containerGroupName\\n  location: location\\n  properties: {\\n    containers: [\\n      {\\n        name: containerName\\n        properties: {\\n          image: 'cnabquickstartstest.azurecr.io/simongdavies/run-duffle:latest'\\n          resources: {\\n            requests: {\\n              cpu: 1\\n              memoryInGB: 2\\n            }\\n          }\\n          environmentVariables: [\\n            {\\n              name: 'CNAB_ACTION'\\n              value: cnabAction\\n            }\\n            {\\n              name: 'CNAB_INSTALLATION_NAME'\\n              value: cnabInstallationName\\n            }\\n            {\\n              name: 'ACI_LOCATION'\\n              value: location\\n            }\\n            {\\n              name: 'CNAB_STATE_STORAGE_ACCOUNT_NAME'\\n              value: cnabStateStorageAccountName\\n            }\\n            {\\n              name: 'CNAB_STATE_STORAGE_ACCOUNT_KEY'\\n              secureValue: cnabStateStorageAccountKey\\n            }\\n            {\\n              name: 'CNAB_STATE_SHARE_NAME'\\n              value: cnabStateShareName\\n            }\\n            {\\n              name: 'VERBOSE'\\n              value: 'false'\\n            }\\n            {\\n              name: 'CNAB_BUNDLE_NAME'\\n              value: 'porter/sql-server-always-on'\\n            }\\n            {\\n              name: 'AKS_CLUSTER_NAME'\\n              value: aksClusterName\\n            }\\n            {\\n              name: 'AKS_RESOURCE_GROUP'\\n              value: aksResourceGroupName\\n            }\\n            {\\n              name: 'LOCATION'\\n              value: location\\n            }\\n            {\\n              name: 'SQL_MASTERKEYPASSWORD'\\n              secureValue: sqlMasterkeyPassword\\n            }\\n            {\\n              name: 'SQL_SAPASSWORD'\\n              secureValue: sqlSaPassword\\n            }\\n            {\\n              name: 'AZURE_CLIENT_ID'\\n              secureValue: azureClientId\\n            }\\n            {\\n              name: 'AZURE_CLIENT_SECRET'\\n              secureValue: azureClientSecret\\n            }\\n            {\\n              name: 'AZURE_SUBSCRIPTION_ID'\\n              value: subscription().subscriptionId\\n            }\\n            {\\n              name: 'AZURE_TENANT_ID'\\n              value: subscription().tenantId\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n    osType: 'Linux'\\n    restartPolicy: 'Never'\\n  }\\n  dependsOn: [\\n    cnabStateStorageAccount\\n  ]\\n}\\n\\noutput CNAB_Package_Action_Logs_Command string = 'az container logs -g ${resourceGroup().name} -n ${containerGroupName}  --container-name ${containerName} --follow'\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"aksClusterName\\\": {\\n      \\\"value\\\": \\\"sql-server-aks\\\"\\n    },\\n    \\\"aksResourceGroupName\\\": {\\n      \\\"value\\\": \\\"sql-server-always-on\\\"\\n    },\\n    \\\"azureClientId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"azureClientSecret\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"cnabAction\\\": {\\n      \\\"value\\\": \\\"install\\\"\\n    },\\n    \\\"cnabInstallationName\\\": {\\n      \\\"value\\\": \\\"porter-sql-server-always-on\\\"\\n    },\\n    \\\"cnabStateShareName\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"cnabStateStorageAccountKey\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"cnabStateStorageAccountName\\\": {\\n      \\\"value\\\": \\\"cnabstate${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"cnabStateStorageAccountResourceGroupName\\\": {\\n      \\\"value\\\": \\\"resourceGroup().name\\\"\\n    },\\n    \\\"containerGroupName\\\": {\\n      \\\"value\\\": \\\"cg-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"containerName\\\": {\\n      \\\"value\\\": \\\"cn-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"sqlMasterkeyPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sqlSaPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param namePrefix string\\nparam domainName string\\nparam dnsServerName string\\nparam adminUsername string\\n\\n@secure()\\nparam adminPassword string\\nparam sqlServerServiceAccountUserName string\\n\\n@secure()\\nparam sqlServerServiceAccountPassword string\\n\\n@allowed([\\n  'Standard_LRS'\\n  'StandardSSD_LRS'\\n  'Premium_LRS'\\n])\\nparam diskType string = 'StandardSSD_LRS'\\nparam nicSubnetUri string\\nparam lbSubnetUri string\\nparam sqlLBIPAddress string\\nparam sqlVMSize string\\nparam sqlWitnessVMSize string\\nparam _artifactsLocation string\\n\\n@secure()\\nparam _artifactsLocationSasToken string\\nparam windowsImagePublisher string = 'MicrosoftSQLServer'\\nparam windowsImageOffer string = 'SQL2014SP2-WS2012R2'\\nparam windowsImageSKU string = 'Enterprise'\\nparam windowsImageVersion string = 'latest'\\n\\n@description('Location for all resources.')\\nparam location string\\n\\nvar sqlDiskSize = 1000\\nvar sqlWitnessDiskSize = 128\\nvar sqlNamePrefix = '${namePrefix}-sql-'\\nvar sqlAvailabilitySetName = '${sqlNamePrefix}as'\\nvar sqlLBName = '${sqlNamePrefix}ilb'\\nvar lbFE1 = '${sqlNamePrefix}ilbfe1'\\nvar lbBE = '${sqlNamePrefix}ilbbe'\\nvar sqlLBFEConfigID1 = resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', sqlLBName, lbFE1)\\nvar sqlLBBEAddressPoolID = resourceId('Microsoft.Network/loadBalancers/backendAddressPools', sqlLBName, lbBE)\\nvar sqlAOProbe1 = '${sqlNamePrefix}ilbp1'\\nvar sqlLBProbeID1 = resourceId('Microsoft.Network/loadBalancers/probes/', sqlLBName, sqlAOProbe1)\\nvar deploySqlWitnessShareName = 'deploySqlWitnessShare'\\nvar sqlWitnessSharePath = '${namePrefix}-fsw'\\nvar sqlWitnessVMName = '${sqlNamePrefix}w'\\nvar deploySqlAlwaysOnName = 'deploySqlAlwaysOn'\\nvar sqlAOEPName = '${namePrefix}-agep'\\nvar sqlAOAGName1 = '${namePrefix}-ag1'\\nvar sqlAOListener1 = '${namePrefix}-agl1'\\n\\nresource sqlAvailabilitySet 'Microsoft.Compute/availabilitySets@2023-09-01' = {\\n  name: sqlAvailabilitySetName\\n  location: location\\n  properties: {\\n    platformUpdateDomainCount: 20\\n    platformFaultDomainCount: 2\\n  }\\n  sku: {\\n    name: 'Aligned'\\n  }\\n}\\n\\nresource sqlLB 'Microsoft.Network/loadBalancers@2023-09-01' = {\\n  name: sqlLBName\\n  location: location\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: lbFE1\\n        properties: {\\n          privateIPAllocationMethod: 'Static'\\n          privateIPAddress: sqlLBIPAddress\\n          subnet: {\\n            id: lbSubnetUri\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: lbBE\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        name: sqlAOListener1\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: sqlLBFEConfigID1\\n          }\\n          backendAddressPool: {\\n            id: sqlLBBEAddressPoolID\\n          }\\n          probe: {\\n            id: sqlLBProbeID1\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 1433\\n          backendPort: 1433\\n          enableFloatingIP: true\\n        }\\n      }\\n    ]\\n    probes: [\\n      {\\n        name: sqlAOProbe1\\n        properties: {\\n          protocol: 'Tcp'\\n          port: 59999\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource sqlNamePrefix_0_2_nic 'Microsoft.Network/networkInterfaces@2023-09-01' = [\\n  for i in range(0, length(range(0, 2))): {\\n    name: '${sqlNamePrefix}${range(0,2)[i]}-nic'\\n    location: location\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig1'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            subnet: {\\n              id: nicSubnetUri\\n            }\\n            loadBalancerBackendAddressPools: [\\n              {\\n                id: sqlLBBEAddressPoolID\\n              }\\n            ]\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      sqlLB\\n    ]\\n  }\\n]\\n\\nresource sqlWitnessVMName_nic 'Microsoft.Network/networkInterfaces@2023-09-01' = {\\n  name: '${sqlWitnessVMName}-nic'\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: nicSubnetUri\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource sqlNamePrefix_0_2 'Microsoft.Compute/virtualMachines@2023-09-01' = [\\n  for i in range(0, length(range(0, 2))): {\\n    name: '${sqlNamePrefix}${range(0,2)[i]}'\\n    location: location\\n    properties: {\\n      hardwareProfile: {\\n        vmSize: sqlVMSize\\n      }\\n      availabilitySet: {\\n        id: sqlAvailabilitySet.id\\n      }\\n      osProfile: {\\n        computerName: '${sqlNamePrefix}${range(0,2)[i]}'\\n        adminUsername: adminUsername\\n        adminPassword: adminPassword\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: windowsImagePublisher\\n          offer: windowsImageOffer\\n          sku: windowsImageSKU\\n          version: windowsImageVersion\\n        }\\n        osDisk: {\\n          name: '${sqlNamePrefix}${range(0,2)[i]}_OSDisk'\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n          managedDisk: {\\n            storageAccountType: diskType\\n          }\\n        }\\n        dataDisks: [\\n          {\\n            lun: 0\\n            name: '${sqlNamePrefix}${range(0,2)[i]}_datadisk1'\\n            createOption: 'Empty'\\n            diskSizeGB: sqlDiskSize\\n            caching: 'None'\\n            managedDisk: {\\n              storageAccountType: diskType\\n            }\\n          }\\n          {\\n            lun: 1\\n            name: '${sqlNamePrefix}${range(0,2)[i]}_logdisk1'\\n            createOption: 'Empty'\\n            diskSizeGB: sqlDiskSize\\n            caching: 'None'\\n            managedDisk: {\\n              storageAccountType: diskType\\n            }\\n          }\\n        ]\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', '${sqlNamePrefix}${range(0,2)[range(0,2)[i]]}-nic')\\n          }\\n        ]\\n      }\\n    }\\n    dependsOn: [\\n      sqlAvailabilitySet\\n      resourceId('Microsoft.Network/networkInterfaces', '${sqlNamePrefix}${range(0,2)[range(0,2)[i]]}-nic')\\n    ]\\n  }\\n]\\n\\nresource sqlWitnessVM 'Microsoft.Compute/virtualMachines@2023-09-01' = {\\n  name: sqlWitnessVMName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: sqlWitnessVMSize\\n    }\\n    availabilitySet: {\\n      id: sqlAvailabilitySet.id\\n    }\\n    osProfile: {\\n      computerName: sqlWitnessVMName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: windowsImagePublisher\\n        offer: windowsImageOffer\\n        sku: windowsImageSKU\\n        version: windowsImageVersion\\n      }\\n      osDisk: {\\n        name: '${sqlWitnessVMName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n        managedDisk: {\\n          storageAccountType: diskType\\n        }\\n      }\\n      dataDisks: [\\n        {\\n          name: '${sqlWitnessVMName}_datadisk1'\\n          caching: 'None'\\n          createOption: 'Empty'\\n          diskSizeGB: sqlWitnessDiskSize\\n          lun: 0\\n          managedDisk: {\\n            storageAccountType: diskType\\n          }\\n        }\\n      ]\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: sqlWitnessVMName_nic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nmodule deploySqlWitnessShare './nested_deploySqlWitnessShare.bicep' = {\\n  name: deploySqlWitnessShareName\\n  params: {\\n    sqlWitnessVMName: sqlWitnessVMName\\n    domainName: domainName\\n    sharePath: sqlWitnessSharePath\\n    adminUsername: adminUsername\\n    adminPassword: adminPassword\\n    _artifactsLocation: _artifactsLocation\\n    _artifactsLocationSasToken: _artifactsLocationSasToken\\n    location: location\\n  }\\n  dependsOn: [\\n    sqlWitnessVM\\n  ]\\n}\\n\\nmodule deploySqlAlwaysOn './nested_deploySqlAlwaysOn.bicep' = {\\n  name: deploySqlAlwaysOnName\\n  params: {\\n    sqlNamePrefix: sqlNamePrefix\\n    domainName: domainName\\n    namePrefix: namePrefix\\n    sharePath: sqlWitnessSharePath\\n    sqlWitnessVMName: sqlWitnessVMName\\n    sqlLBName: sqlLBName\\n    sqlLBIPAddress: sqlLBIPAddress\\n    dnsServerName: dnsServerName\\n    sqlServerServiceAccountUserName: sqlServerServiceAccountUserName\\n    sqlServerServiceAccountPassword: sqlServerServiceAccountPassword\\n    adminUsername: adminUsername\\n    adminPassword: adminPassword\\n    _artifactsLocation: _artifactsLocation\\n    _artifactsLocationSasToken: _artifactsLocationSasToken\\n    sqlAlwaysOnEndpointName: sqlAOEPName\\n    sqlAlwaysOnAvailabilityGroupName1: sqlAOAGName1\\n    sqlAlwaysOnAvailabilityGroupListenerName1: sqlAOListener1\\n    location: location\\n  }\\n  dependsOn: [\\n    deploySqlWitnessShare\\n    resourceId('Microsoft.Compute/virtualMachines', '${sqlNamePrefix}${range(0,2)[0]}')\\n    resourceId('Microsoft.Compute/virtualMachines', '${sqlNamePrefix}${range(0,2)[1]}')\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"namePrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"domainName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsServerName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sqlServerServiceAccountUserName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sqlServerServiceAccountPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"diskType\\\": {\\n      \\\"value\\\": \\\"StandardSSD_LRS\\\"\\n    },\\n    \\\"nicSubnetUri\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"lbSubnetUri\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sqlLBIPAddress\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sqlVMSize\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sqlWitnessVMSize\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"windowsImagePublisher\\\": {\\n      \\\"value\\\": \\\"MicrosoftSQLServer\\\"\\n    },\\n    \\\"windowsImageOffer\\\": {\\n      \\\"value\\\": \\\"SQL2014SP2-WS2012R2\\\"\\n    },\\n    \\\"windowsImageSKU\\\": {\\n      \\\"value\\\": \\\"Enterprise\\\"\\n    },\\n    \\\"windowsImageVersion\\\": {\\n      \\\"value\\\": \\\"latest\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The number of agents for the cluster.  This value can be from 1 to 100')\\n@minValue(1)\\n@maxValue(100)\\nparam agentCount int = 2\\n\\n@description('Sets the Domain name label for the agent pool IP Address.  The concatenation of the domain name label and the regional DNS zone make up the fully qualified domain name associated with the public IP address.')\\nparam agentEndpointDNSNamePrefix string\\n\\n@description('Sets the subnet of agent pool \\\\'agent\\\\'.')\\nparam agentSubnet string = '10.0.0.0/16'\\n\\n@description('The size of the Virtual Machine.')\\nparam agentVMSize string = 'Standard_D2_v3'\\n\\n@description('Sets the static IP of the first master')\\nparam firstConsecutiveStaticIP string = '172.16.0.5'\\n\\n@description('User name for the Linux Virtual Machines (SSH or Password).')\\nparam linuxAdminUsername string\\n\\n@description('Sets the location for all resources in the cluster')\\nparam location string = resourceGroup().location\\n\\n@description('Sets the Domain name label for the master IP Address.  The concatenation of the domain name label and the regional DNS zone make up the fully qualified domain name associated with the public IP address.')\\nparam masterEndpointDNSNamePrefix string\\n\\n@description('Sets the subnet of the master node(s).')\\nparam masterSubnet string = '172.16.0.0/24'\\n\\n@description('The size of the Virtual Machine.')\\nparam masterVMSize string\\n\\n@description('A string hash of the master DNS name to uniquely identify the cluster.')\\nparam nameSuffix string = '13957614'\\n\\n@description('SSH public key used for auth to all Linux machines.  Not Required.  If not set, you must provide a password key.')\\nparam sshRSAPublicKey string\\n\\nvar adminUsername = linuxAdminUsername\\nvar agentCount_var = agentCount\\nvar agentCustomScript = '/usr/bin/nohup /bin/bash -c \\\"/bin/bash /opt/azure/containers/${configureClusterScriptFile} ${clusterInstallParameters} >> /var/log/azure/cluster-bootstrap.log 2>&1 &\\\" &'\\nvar agentEndpointDNSNamePrefix_var = toLower(agentEndpointDNSNamePrefix)\\nvar agentIPAddressName = '${orchestratorName}-agent-ip-${agentEndpointDNSNamePrefix_var}-${nameSuffix_var}'\\nvar agentLbBackendPoolName = '${orchestratorName}-agent-${nameSuffix_var}'\\nvar agentLbIPConfigID = resourceId(\\n  'Microsoft.Network/loadBalancers/frontendIPConfigurations',\\n  agentLbName,\\n  agentLbIPConfigName\\n)\\nvar agentLbIPConfigName = '${orchestratorName}-agent-${nameSuffix_var}'\\nvar agentLbName = '${orchestratorName}-agent-${nameSuffix_var}'\\nvar agentRunCmd = 'runcmd:\\\\n -  [ /bin/bash, /opt/azure/containers/install-cluster.sh ]\\\\n\\\\n'\\nvar agentRunCmdFile = ' -  content: |\\\\n        #!/bin/bash\\\\n        sudo mkdir -p /var/log/azure\\\\n        ${agentCustomScript}\\\\n    path: /opt/azure/containers/install-cluster.sh\\\\n    permissions: \\\"0744\\\"\\\\n'\\nvar agentSubnet_var = agentSubnet\\nvar agentSubnetName = '${orchestratorName}-agentsubnet'\\nvar agentVMNamePrefix = '${orchestratorName}-agent-${nameSuffix_var}'\\nvar agentVMSize_var = agentVMSize\\nvar agentVnetSubnetID = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, agentSubnetName)\\nvar clusterInstallParameters = '${masterCount} ${masterVMNamePrefix_var} ${masterFirstAddrOctet4} ${adminUsername} ${postInstallScriptURI} ${masterFirstAddrPrefix}'\\nvar configureClusterScriptFile = 'configure-swarmmode-cluster.sh'\\nvar location_var = locations[((2 + length(location)) % (1 + length(location)))]\\nvar locations = [\\n  location\\n  location\\n]\\nvar masterAvailabilitySet_var = '${orchestratorName}-master-availabilitySet-${nameSuffix_var}'\\nvar masterCount = 1\\nvar masterCustomScript = '/bin/bash -c \\\"/bin/bash /opt/azure/containers/${configureClusterScriptFile} ${clusterInstallParameters} >> /var/log/azure/cluster-bootstrap.log 2>&1\\\"'\\nvar masterEndpointDNSNamePrefix_var = toLower(masterEndpointDNSNamePrefix)\\nvar masterFirstAddrOctet4 = masterFirstAddrOctets[3]\\nvar masterFirstAddrOctets = split(firstConsecutiveStaticIP, '.')\\nvar masterFirstAddrPrefix = '${masterFirstAddrOctets[0]}.${masterFirstAddrOctets[1]}.${masterFirstAddrOctets[2]}.'\\nvar masterLbBackendPoolName = '${orchestratorName}-master-pool-${nameSuffix_var}'\\nvar masterLbIPConfigID = resourceId(\\n  'Microsoft.Network/loadBalancers/frontendIPConfigurations',\\n  masterLbName,\\n  masterLbIPConfigName\\n)\\nvar masterLbIPConfigName = '${orchestratorName}-master-lbFrontEnd-${nameSuffix_var}'\\nvar masterLbInboundNatRules = [\\n  [\\n    {\\n      id: resourceId('Microsoft.Network/loadBalancers/inboundNatRules', masterLbName, 'SSH-${masterVMNamePrefix_var}0')\\n    }\\n    {\\n      id: resourceId(\\n        'Microsoft.Network/loadBalancers/inboundNatRules',\\n        masterLbName,\\n        'SSHPort22-${masterVMNamePrefix_var}0'\\n      )\\n    }\\n  ]\\n  [\\n    {\\n      id: resourceId('Microsoft.Network/loadBalancers/inboundNatRules', masterLbName, 'SSH-${masterVMNamePrefix_var}1')\\n    }\\n  ]\\n  [\\n    {\\n      id: resourceId('Microsoft.Network/loadBalancers/inboundNatRules', masterLbName, 'SSH-${masterVMNamePrefix_var}22')\\n    }\\n  ]\\n  [\\n    {\\n      id: resourceId('Microsoft.Network/loadBalancers/inboundNatRules', masterLbName, 'SSH-${masterVMNamePrefix_var}3')\\n    }\\n  ]\\n  [\\n    {\\n      id: resourceId('Microsoft.Network/loadBalancers/inboundNatRules', masterLbName, 'SSH-${masterVMNamePrefix_var}4')\\n    }\\n  ]\\n]\\nvar masterLbName = '${orchestratorName}-master-lb-${nameSuffix_var}'\\nvar masterPublicIPAddressName = '${orchestratorName}-master-ip-${masterEndpointDNSNamePrefix_var}-${nameSuffix_var}'\\nvar masterSshPort22InboundNatRuleNamePrefix = '${masterLbName}/SSHPort22-${masterVMNamePrefix_var}'\\nvar masterSubnet_var = masterSubnet\\nvar masterSubnetName = '${orchestratorName}-masterSubnet'\\nvar masterVMNamePrefix_var = '${orchestratorName}-master-${nameSuffix_var}-'\\nvar masterVMSize_var = masterVMSize\\nvar masterVnetSubnetID = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, masterSubnetName)\\nvar nameSuffix_var = nameSuffix\\nvar orchestratorName = 'swarmm'\\nvar osImageOffer = 'UbuntuServer'\\nvar osImagePublisher = 'Canonical'\\nvar osImageSKU = '16.04-LTS'\\nvar osImageVersion = 'latest'\\nvar postInstallScriptURI = 'disabled'\\nvar sshKeyPath = '/home/${adminUsername}/.ssh/authorized_keys'\\nvar sshRSAPublicKey_var = sshRSAPublicKey\\nvar virtualNetworkName = '${orchestratorName}-vnet-${nameSuffix_var}'\\nvar agentVmSizeSuffix = toLower(split(agentVMSize, '_')[1])\\nvar masterVmSizeSuffix = toLower(split(masterVMSize, '_')[1])\\nvar agentDiskType = (contains(agentVmSizeSuffix, 's') ? 'Premium_LRS' : 'StandardSSD_LRS')\\nvar masterDiskType = (contains(masterVmSizeSuffix, 's') ? 'Premium_LRS' : 'StandardSSD_LRS')\\n\\nresource agentIPAddress 'Microsoft.Network/publicIPAddresses@2020-04-01' = {\\n  location: location_var\\n  name: agentIPAddressName\\n  properties: {\\n    dnsSettings: {\\n      domainNameLabel: agentEndpointDNSNamePrefix_var\\n    }\\n    publicIPAllocationMethod: 'Dynamic'\\n  }\\n}\\n\\nresource agentLb 'Microsoft.Network/loadBalancers@2020-04-01' = {\\n  location: location_var\\n  name: agentLbName\\n  properties: {\\n    backendAddressPools: [\\n      {\\n        name: agentLbBackendPoolName\\n      }\\n    ]\\n    frontendIPConfigurations: [\\n      {\\n        name: agentLbIPConfigName\\n        properties: {\\n          publicIPAddress: {\\n            id: agentIPAddress.id\\n          }\\n        }\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        name: 'LBRule80'\\n        properties: {\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools/', agentLbName, agentLbBackendPoolName)\\n          }\\n          backendPort: 80\\n          enableFloatingIP: false\\n          frontendIPConfiguration: {\\n            id: agentLbIPConfigID\\n          }\\n          frontendPort: 80\\n          idleTimeoutInMinutes: 5\\n          loadDistribution: 'Default'\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', agentLbName, 'tcp80Probe')\\n          }\\n          protocol: 'Tcp'\\n        }\\n      }\\n      {\\n        name: 'LBRule443'\\n        properties: {\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', agentLbName, agentLbBackendPoolName)\\n          }\\n          backendPort: 443\\n          enableFloatingIP: false\\n          frontendIPConfiguration: {\\n            id: agentLbIPConfigID\\n          }\\n          frontendPort: 443\\n          idleTimeoutInMinutes: 5\\n          loadDistribution: 'Default'\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', agentLbName, 'tcp443Probe')\\n          }\\n          protocol: 'Tcp'\\n        }\\n      }\\n      {\\n        name: 'LBRule8080'\\n        properties: {\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', agentLbName, agentLbBackendPoolName)\\n          }\\n          backendPort: 8080\\n          enableFloatingIP: false\\n          frontendIPConfiguration: {\\n            id: agentLbIPConfigID\\n          }\\n          frontendPort: 8080\\n          idleTimeoutInMinutes: 5\\n          loadDistribution: 'Default'\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', agentLbName, 'tcp8080Probe')\\n          }\\n          protocol: 'Tcp'\\n        }\\n      }\\n    ]\\n    probes: [\\n      {\\n        name: 'tcp80Probe'\\n        properties: {\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n          port: 80\\n          protocol: 'Tcp'\\n        }\\n      }\\n      {\\n        name: 'tcp443Probe'\\n        properties: {\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n          port: 443\\n          protocol: 'Tcp'\\n        }\\n      }\\n      {\\n        name: 'tcp8080Probe'\\n        properties: {\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n          port: 8080\\n          protocol: 'Tcp'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource agentVMNamePrefix_vmss 'Microsoft.Compute/virtualMachineScaleSets@2019-07-01' = {\\n  location: location_var\\n  name: '${agentVMNamePrefix}-vmss'\\n  sku: {\\n    capacity: agentCount_var\\n    name: agentVMSize_var\\n    tier: 'Standard'\\n  }\\n  tags: {\\n    creationSource: 'acsengine-${agentVMNamePrefix}-vmss'\\n  }\\n  properties: {\\n    upgradePolicy: {\\n      mode: 'Automatic'\\n    }\\n    virtualMachineProfile: {\\n      networkProfile: {\\n        networkInterfaceConfigurations: [\\n          {\\n            name: 'nic'\\n            properties: {\\n              ipConfigurations: [\\n                {\\n                  name: 'nicipconfig'\\n                  properties: {\\n                    loadBalancerBackendAddressPools: [\\n                      {\\n                        id: resourceId(\\n                          'Microsoft.Network/loadBalancers/backendAddressPools',\\n                          agentLbName,\\n                          agentLbBackendPoolName\\n                        )\\n                      }\\n                    ]\\n                    subnet: {\\n                      id: agentVnetSubnetID\\n                    }\\n                  }\\n                }\\n              ]\\n              primary: true\\n            }\\n          }\\n        ]\\n      }\\n      osProfile: {\\n        adminUsername: adminUsername\\n        computerNamePrefix: agentVMNamePrefix\\n        customData: base64('#cloud-config\\\\n\\\\nwrite_files:\\\\n -  encoding: gzip\\\\n    content: !!binary |\\\\n        H4sIACkUqlkAA81ZbXPbNhL+zl+xpTW1nYaipDSXOWeUG8dWLp6rLY9kd24uaWOIhCzWFKEQoGSfq/9+u3ihSFmK3TaZOWUSkuAC++wunt0Fs/NdOEqycMTkxPN2/vzP24EjkY2T6yLnMFywfAqnIubQzzi8FbceCVxMEglJJhVLUwlqwmEs0lQskuwaIjGdiYxnSqJgAMciuuF55RZXRwHJ9VBl/SmTiudyfZhdm6X+gkGe5AqCW8/j0USAj6hzRUgrWqK0IO0I3ljOVCIy34uZ4t5MAsPJx/2jf/UGn476p+f9Ye/Tz73B8KR/1vXbzXan2fLrCNGKc5azKTcm1eGcHg4veoOj/uXZRbdx317agfNB793Jv3Gk40benQyGF4fHxwMcfLH0Dv9zOehdDnv0+OPSQxgXJ2co8NNPw6PByfnF5eAE37xcem8Ph73h5duzHq3/t6X38+nZ4WmvezURUmUI6opGLk/f4kpX2icNIwG/g+Qx7Mqw+ezDr63g77983PugLz983H/WCD+2w12aa5Fumftxr5y9/8xOd3NtCE51rHEnFJk6gEbFIX5d4jzn4+S2FDGK12TeJblUcBjHeSlXOs6Jzqdk94ED64adG8wLffscnH16sK5x5Vh8uXpwr8sA4dvy3t/IRs2y6VRk8K7IItptG/c4OiyTSMTD/+I/Z1wtRH6zt+/dewA7YF5p+mXmFdA/El/a5/ecpWpy123j0FjkkCBp4b7dxC27fA2xwGGAxTXRox/GfB5mRZrCRKnZQUjZ5LqJbNZCyRg+QOMfEPDP0IJf9BgqzvQNgXF7CyZMwojzDBUWWUyMQrIV3AquAWvZYeO/qiWYYCZGyLcyo5yzG30/TvRFppzPoE1rxJhxPIeyrgMCTFwGcgl4o7pMKKfyObCRMEnCZjnfesEkCPMwA2ZWu00UdDyLqxYX8goJRiyDnEuRzvmTotNahad0bJD8v0fiWwQCPUfP1nna6ch0LuWfj9FyA6m8932baq8qDseElUhTmMDSTlvm1/MRdLs4VCaLuok5V0WeAfmXp5JXx9oODy5a6nntpjrfaI9gjcIrs1XS93AaQtPFcQXs4Ro1VevqWzX1eq0va89MNTbajQdaJ+faa37jfpUPl437tTy83JwFTSJ0sZU8HRMFjs+G24Rtom24aJUJncpPEQtQHOPGIOQqCimQ8qFe1HhiNkzZnGxRY8VoizFDIN0c0LOZiVbZvWeebSjqZG6tp9pA5QmX8CPeYSTyuwAXzrDQFVRAg2DBEqXHu+2XEHzuBzohS8zIOLsZa0WUl8nkyVdNCcZq26ZZwxCSLKIICTfG2vD0ZLz0VIIKa+7BToxihHbmU4Gmsn+CMadSLp3vL2fYfK08DTHjVC3FTNdKdHxBAty8PdYv++adDQKYDTG9iZMcgpnZEvIO+TGN7TW0zkQ88yTizdgz7hpSh+gUU+TTBMVReQYHnRevXsJeJoAVavIcRoWiQM8xfe2TqF2BpVKgsylhKcBCGoMSuiAUWXILklZWwBSEc5aHeZGVSPCywk69PAQR7BqXfBganCbAvVseaaDdtcewkLk+Cpg10c/vQUVU0VtN/cfYgKMEBoe3gPDhzZOcFoo5z/Mk5k0iyK6L/Nb4bGBX/WTg10llR8u2R7sGi+G3JFqiJsWISGatDSMDIsx5ypnkEscXWSpYHDY2HwzsxMBODK4KU1PkVXk7vSIPU7RSEbG0EjM36xuwu67gW7Dcne+iCZH8h9tHTDQ5weytSKWW6Bgw8q59abaaSxZYL2iju964lnor3RfSy05YdTAaN41t7b1erDaR1u2WyMbiq0ajDqO1MQM/aLyqiPBYGrA/2hrXtG5vyFYAKr2YX++eXErfXKm3/bD4RuXXhSTD7JgXKXLUxhSoKs9yQTuR/9FTv7e5jyp7Ntc0YL9WdnC2f8Ge7XU1jCtXHKFrdR1i2KIu7DcDLARjfep07dhqlo2O1HLawCBgMWZIlWAWoN4VGnuVFnOfsvErFDI1ZquEiY7r4Fb4hhz9GbP8zmLBqoJEmmnIWHN+E7ivsXHD/leuPnqsAGucyFOuxA3Puv62N4fR5yLJeawJY37bjyxbFm/sWedg6am731Qk4zNCHOgJmJPRqAx7zny/tu4aBx9E7osGtB4IrthTmpbU7dBselmOWUpVwWxWVmGY+T0AuiWIkSjSONtVRJaMR4pCqSO37dRTrufOOQ8MqW1MvS0C6+Y18Bti88rlFn3s2H5Yec/mhExi22JbJsQ9Q7zQwR9gQlxwJDheOx3CbbN7DLjNwZfhr+dGthHaG+/cTQ7bvu1G5IT+xp/sMe8RSEOuDH3nLEnZKEkTdQdi7BxNZ5sD2LXHiF2NlxXUg5Qe08cf080Ql6vraFF3BlkhWTtKOSiHevjp/NzMzS/y8suc/Ap8pLNylY6PU/FJNKxTsLJrq9QrafdkytXAVINQ8kv7/1FmVVhlsf01NtmdgkZs+ogL32F9inEbjbAvo68JtQ3tGk8E+lwfTm6S6IZQi/EYuUbfm+zpVkZ5MlNkRfk/A3Sa8GvNcaf15O54M9jfkSCTYlbR8eaNOdek4jpk9I0ltJ/Xg5EQSqqczQICanE2UQ46b75vw/fmy4Kxs+wC6JzE0U4krbPIfJLXX+eNMDWTKVcI/PGP+naK6zhM50lcdH5j2R32I1OG1ZuSmRgrXJNOJRu4LSeFoohAQIli4dkKvQPkPmjDFFs+zBu4utNnEs+DoFQXcp74H9DolC7TGQAA\\\\n    path: /opt/azure/containers/configure-swarmmode-cluster.sh\\\\n    permissions: \\\"0744\\\"\\\\n\\\\n${agentRunCmdFile}${agentRunCmd}')\\n        linuxConfiguration: {\\n          disablePasswordAuthentication: true\\n          ssh: {\\n            publicKeys: [\\n              {\\n                keyData: sshRSAPublicKey\\n                path: sshKeyPath\\n              }\\n            ]\\n          }\\n        }\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          offer: osImageOffer\\n          publisher: osImagePublisher\\n          sku: osImageSKU\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n          managedDisk: {\\n            storageAccountType: agentDiskType\\n          }\\n        }\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    masterPublicIPAddress\\n    virtualNetwork\\n    agentLb\\n  ]\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-04-01' = {\\n  location: location_var\\n  name: virtualNetworkName\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        masterSubnet_var\\n        agentSubnet_var\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: masterSubnetName\\n        properties: {\\n          addressPrefix: masterSubnet_var\\n        }\\n      }\\n      {\\n        name: agentSubnetName\\n        properties: {\\n          addressPrefix: agentSubnet_var\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource masterAvailabilitySet 'Microsoft.Compute/availabilitySets@2019-07-01' = {\\n  location: location_var\\n  name: masterAvailabilitySet_var\\n  properties: {\\n    platformUpdateDomainCount: 20\\n    platformFaultDomainCount: 2\\n  }\\n  sku: {\\n    name: 'Aligned'\\n  }\\n}\\n\\nresource masterPublicIPAddress 'Microsoft.Network/publicIPAddresses@2020-04-01' = {\\n  location: location_var\\n  name: masterPublicIPAddressName\\n  properties: {\\n    dnsSettings: {\\n      domainNameLabel: masterEndpointDNSNamePrefix_var\\n    }\\n    publicIPAllocationMethod: 'Dynamic'\\n  }\\n}\\n\\nresource masterLb 'Microsoft.Network/loadBalancers@2020-04-01' = {\\n  location: location_var\\n  name: masterLbName\\n  properties: {\\n    backendAddressPools: [\\n      {\\n        name: masterLbBackendPoolName\\n      }\\n    ]\\n    frontendIPConfigurations: [\\n      {\\n        name: masterLbIPConfigName\\n        properties: {\\n          publicIPAddress: {\\n            id: masterPublicIPAddress.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource masterLbName_SSH_masterVMNamePrefix 'Microsoft.Network/loadBalancers/inboundNatRules@2020-04-01' = [\\n  for i in range(0, masterCount): {\\n    location: location_var\\n    name: '${masterLbName}/SSH-${masterVMNamePrefix_var}${i}'\\n    properties: {\\n      backendPort: 22\\n      enableFloatingIP: false\\n      frontendIPConfiguration: {\\n        id: masterLbIPConfigID\\n      }\\n      frontendPort: (i + 2200)\\n      protocol: 'Tcp'\\n    }\\n    dependsOn: [\\n      masterLb\\n    ]\\n  }\\n]\\n\\nresource masterSshPort22InboundNatRuleNamePrefix_0 'Microsoft.Network/loadBalancers/inboundNatRules@2020-04-01' = {\\n  location: location_var\\n  name: '${masterSshPort22InboundNatRuleNamePrefix}0'\\n  properties: {\\n    backendPort: 2222\\n    enableFloatingIP: false\\n    frontendIPConfiguration: {\\n      id: masterLbIPConfigID\\n    }\\n    frontendPort: 22\\n    protocol: 'Tcp'\\n  }\\n  dependsOn: [\\n    masterLb\\n  ]\\n}\\n\\nresource masterVMNamePrefix_nic 'Microsoft.Network/networkInterfaces@2020-04-01' = [\\n  for i in range(0, masterCount): {\\n    name: '${masterVMNamePrefix_var}nic-${i}'\\n    location: location_var\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipConfigNode'\\n          properties: {\\n            loadBalancerBackendAddressPools: [\\n              {\\n                id: resourceId(\\n                  'Microsoft.Network/loadBalancers/backendAddressPools',\\n                  masterLbName,\\n                  masterLbBackendPoolName\\n                )\\n              }\\n            ]\\n            loadBalancerInboundNatRules: masterLbInboundNatRules[i]\\n            privateIPAddress: concat(masterFirstAddrPrefix, (i + int(masterFirstAddrOctet4)))\\n            privateIPAllocationMethod: 'Static'\\n            subnet: {\\n              id: masterVnetSubnetID\\n            }\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      virtualNetwork\\n      masterLb\\n      resourceId(\\n        'Microsoft.Network/loadBalancers/inboundNatRules',\\n        masterLbName,\\n        'SSHPort22-${masterVMNamePrefix_var}0'\\n      )\\n      resourceId('Microsoft.Network/loadBalancers/inboundNatRules', masterLbName, 'SSH-${masterVMNamePrefix_var}${i}')\\n    ]\\n  }\\n]\\n\\nresource masterVMNamePrefix 'Microsoft.Compute/virtualMachines@2019-07-01' = [\\n  for i in range(0, masterCount): {\\n    name: concat(masterVMNamePrefix_var, i)\\n    location: location_var\\n    tags: {\\n      creationSource: 'acsengine-${masterVMNamePrefix_var}${i}'\\n    }\\n    properties: {\\n      availabilitySet: {\\n        id: masterAvailabilitySet.id\\n      }\\n      hardwareProfile: {\\n        vmSize: masterVMSize_var\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', '${masterVMNamePrefix_var}nic-${i}')\\n          }\\n        ]\\n      }\\n      osProfile: {\\n        adminUsername: adminUsername\\n        computerName: concat(masterVMNamePrefix_var, i)\\n        customData: base64('#cloud-config\\\\n\\\\nwrite_files:\\\\n -  encoding: gzip\\\\n    content: !!binary |\\\\n        H4sIACkUqlkAA81ZbXPbNhL+zl+xpTW1nYaipDSXOWeUG8dWLp6rLY9kd24uaWOIhCzWFKEQoGSfq/9+u3ihSFmK3TaZOWUSkuAC++wunt0Fs/NdOEqycMTkxPN2/vzP24EjkY2T6yLnMFywfAqnIubQzzi8FbceCVxMEglJJhVLUwlqwmEs0lQskuwaIjGdiYxnSqJgAMciuuF55RZXRwHJ9VBl/SmTiudyfZhdm6X+gkGe5AqCW8/j0USAj6hzRUgrWqK0IO0I3ljOVCIy34uZ4t5MAsPJx/2jf/UGn476p+f9Ye/Tz73B8KR/1vXbzXan2fLrCNGKc5azKTcm1eGcHg4veoOj/uXZRbdx317agfNB793Jv3Gk40benQyGF4fHxwMcfLH0Dv9zOehdDnv0+OPSQxgXJ2co8NNPw6PByfnF5eAE37xcem8Ph73h5duzHq3/t6X38+nZ4WmvezURUmUI6opGLk/f4kpX2icNIwG/g+Qx7Mqw+ezDr63g77983PugLz983H/WCD+2w12aa5Fumftxr5y9/8xOd3NtCE51rHEnFJk6gEbFIX5d4jzn4+S2FDGK12TeJblUcBjHeSlXOs6Jzqdk94ED64adG8wLffscnH16sK5x5Vh8uXpwr8sA4dvy3t/IRs2y6VRk8K7IItptG/c4OiyTSMTD/+I/Z1wtRH6zt+/dewA7YF5p+mXmFdA/El/a5/ecpWpy123j0FjkkCBp4b7dxC27fA2xwGGAxTXRox/GfB5mRZrCRKnZQUjZ5LqJbNZCyRg+QOMfEPDP0IJf9BgqzvQNgXF7CyZMwojzDBUWWUyMQrIV3AquAWvZYeO/qiWYYCZGyLcyo5yzG30/TvRFppzPoE1rxJhxPIeyrgMCTFwGcgl4o7pMKKfyObCRMEnCZjnfesEkCPMwA2ZWu00UdDyLqxYX8goJRiyDnEuRzvmTotNahad0bJD8v0fiWwQCPUfP1nna6ch0LuWfj9FyA6m8932baq8qDseElUhTmMDSTlvm1/MRdLs4VCaLuok5V0WeAfmXp5JXx9oODy5a6nntpjrfaI9gjcIrs1XS93AaQtPFcQXs4Ro1VevqWzX1eq0va89MNTbajQdaJ+faa37jfpUPl437tTy83JwFTSJ0sZU8HRMFjs+G24Rtom24aJUJncpPEQtQHOPGIOQqCimQ8qFe1HhiNkzZnGxRY8VoizFDIN0c0LOZiVbZvWeebSjqZG6tp9pA5QmX8CPeYSTyuwAXzrDQFVRAg2DBEqXHu+2XEHzuBzohS8zIOLsZa0WUl8nkyVdNCcZq26ZZwxCSLKIICTfG2vD0ZLz0VIIKa+7BToxihHbmU4Gmsn+CMadSLp3vL2fYfK08DTHjVC3FTNdKdHxBAty8PdYv++adDQKYDTG9iZMcgpnZEvIO+TGN7TW0zkQ88yTizdgz7hpSh+gUU+TTBMVReQYHnRevXsJeJoAVavIcRoWiQM8xfe2TqF2BpVKgsylhKcBCGoMSuiAUWXILklZWwBSEc5aHeZGVSPCywk69PAQR7BqXfBganCbAvVseaaDdtcewkLk+Cpg10c/vQUVU0VtN/cfYgKMEBoe3gPDhzZOcFoo5z/Mk5k0iyK6L/Nb4bGBX/WTg10llR8u2R7sGi+G3JFqiJsWISGatDSMDIsx5ypnkEscXWSpYHDY2HwzsxMBODK4KU1PkVXk7vSIPU7RSEbG0EjM36xuwu67gW7Dcne+iCZH8h9tHTDQ5weytSKWW6Bgw8q59abaaSxZYL2iju964lnor3RfSy05YdTAaN41t7b1erDaR1u2WyMbiq0ajDqO1MQM/aLyqiPBYGrA/2hrXtG5vyFYAKr2YX++eXErfXKm3/bD4RuXXhSTD7JgXKXLUxhSoKs9yQTuR/9FTv7e5jyp7Ntc0YL9WdnC2f8Ge7XU1jCtXHKFrdR1i2KIu7DcDLARjfep07dhqlo2O1HLawCBgMWZIlWAWoN4VGnuVFnOfsvErFDI1ZquEiY7r4Fb4hhz9GbP8zmLBqoJEmmnIWHN+E7ivsXHD/leuPnqsAGucyFOuxA3Puv62N4fR5yLJeawJY37bjyxbFm/sWedg6am731Qk4zNCHOgJmJPRqAx7zny/tu4aBx9E7osGtB4IrthTmpbU7dBselmOWUpVwWxWVmGY+T0AuiWIkSjSONtVRJaMR4pCqSO37dRTrufOOQ8MqW1MvS0C6+Y18Bti88rlFn3s2H5Yec/mhExi22JbJsQ9Q7zQwR9gQlxwJDheOx3CbbN7DLjNwZfhr+dGthHaG+/cTQ7bvu1G5IT+xp/sMe8RSEOuDH3nLEnZKEkTdQdi7BxNZ5sD2LXHiF2NlxXUg5Qe08cf080Ql6vraFF3BlkhWTtKOSiHevjp/NzMzS/y8suc/Ap8pLNylY6PU/FJNKxTsLJrq9QrafdkytXAVINQ8kv7/1FmVVhlsf01NtmdgkZs+ogL32F9inEbjbAvo68JtQ3tGk8E+lwfTm6S6IZQi/EYuUbfm+zpVkZ5MlNkRfk/A3Sa8GvNcaf15O54M9jfkSCTYlbR8eaNOdek4jpk9I0ltJ/Xg5EQSqqczQICanE2UQ46b75vw/fmy4Kxs+wC6JzE0U4krbPIfJLXX+eNMDWTKVcI/PGP+naK6zhM50lcdH5j2R32I1OG1ZuSmRgrXJNOJRu4LSeFoohAQIli4dkKvQPkPmjDFFs+zBu4utNnEs+DoFQXcp74H9DolC7TGQAA\\\\n    path: /opt/azure/containers/configure-swarmmode-cluster.sh\\\\n    permissions: \\\"0744\\\"\\\\n\\\\n')\\n        linuxConfiguration: {\\n          disablePasswordAuthentication: true\\n          ssh: {\\n            publicKeys: [\\n              {\\n                keyData: sshRSAPublicKey_var\\n                path: sshKeyPath\\n              }\\n            ]\\n          }\\n        }\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          offer: osImageOffer\\n          publisher: osImagePublisher\\n          sku: osImageSKU\\n          version: osImageVersion\\n        }\\n        osDisk: {\\n          name: '${masterVMNamePrefix_var}${i}_OSDisk'\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n          managedDisk: {\\n            storageAccountType: masterDiskType\\n          }\\n        }\\n      }\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Network/networkInterfaces', '${masterVMNamePrefix_var}nic-${i}')\\n      masterAvailabilitySet\\n    ]\\n  }\\n]\\n\\nresource masterVMNamePrefix_configuremaster 'Microsoft.Compute/virtualMachines/extensions@2019-07-01' = [\\n  for i in range(0, masterCount): {\\n    name: '${masterVMNamePrefix_var}${i}/configuremaster'\\n    location: location_var\\n    properties: {\\n      publisher: 'Microsoft.OSTCExtensions'\\n      autoUpgradeMinorVersion: true\\n      settings: {\\n        commandToExecute: masterCustomScript\\n      }\\n      type: 'CustomScriptForLinux'\\n      typeHandlerVersion: '1.4'\\n    }\\n    dependsOn: [\\n      resourceId('Microsoft.Compute/virtualMachines', concat(masterVMNamePrefix_var, i))\\n    ]\\n  }\\n]\\n\\noutput agentFQDN string = agentIPAddress.properties.dnsSettings.fqdn\\noutput masterFQDN string = masterPublicIPAddress.properties.dnsSettings.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"agentCount\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"agentEndpointDNSNamePrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"agentSubnet\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"agentVMSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    },\\n    \\\"firstConsecutiveStaticIP\\\": {\\n      \\\"value\\\": \\\"172.16.0.5\\\"\\n    },\\n    \\\"linuxAdminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"masterEndpointDNSNamePrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"masterSubnet\\\": {\\n      \\\"value\\\": \\\"172.16.0.0/24\\\"\\n    },\\n    \\\"masterVMSize\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"nameSuffix\\\": {\\n      \\\"value\\\": \\\"13957614\\\"\\n    },\\n    \\\"sshRSAPublicKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Username for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Your email address.')\\nparam adminEmail string\\n\\n@description('Hostname assigned to the Public IP, also used as the VM Name. Must be lowercase. It should match with the following regular expression: ^[a-z][a-z0-9-]{1,61}[a-z0-9]$ or it will raise an error.')\\nparam dnsLabelPrefix string\\n\\n@description('Client public key. Please install Trailbot Client in your personal computer, open it and it will generate a key you must paste here.')\\nparam clientPubKey string\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Default VM Size')\\nparam vmSize string = 'Standard_A1'\\n\\nvar imagePublisher = 'Canonical'\\nvar imageOffer = 'UbuntuServer'\\nvar imageSKU = '14.04.4-LTS'\\nvar nicName = 'TrailbotNic'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'TrailbotSubnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar storageAccountType = 'Standard_LRS'\\nvar storageAccountName = concat(uniqueString(resourceGroup().id, 'trailbot'))\\nvar publicIPAddressName = 'TrailbotPublicIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar vmName = dnsLabelPrefix\\nvar virtualNetworkName = 'TrailbotVNET'\\nvar scriptFolder = 'scripts'\\nvar scriptFileName = 'install.sh'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar networkSecurityGroupName = 'default-NSG'\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-01-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsLabelPrefix\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2020-07-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'default-allow-22'\\n        properties: {\\n          priority: 1000\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '22'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: imageSKU\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: reference(storageAccountName, '2021-01-01').primaryEndpoints.blob\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    storageAccount\\n  ]\\n}\\n\\nresource vmName_newuserscript 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: vm\\n  name: 'newuserscript'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        uri(_artifactsLocation, '${scriptFolder}/${scriptFileName}${_artifactsLocationSasToken}')\\n      ]\\n      commandToExecute: 'sh install.sh \\\"${adminEmail}\\\" ${clientPubKey}'\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminEmail\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsLabelPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"clientPubKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_A1\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the Virtual Machine')\\nparam vmName string\\n\\n@description('User name for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('The size of the virtual machines used when provisioning')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('The Ubuntu version for the VM. This will pick a fully patched image of this given Ubuntu version. Allowed values: 12.04.5-LTS, 14.04.5-LTS, 15.10.')\\n@allowed([\\n  '18.04-LTS'\\n])\\nparam ubuntuOSVersion string = '18.04-LTS'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar imagePublisher = 'Canonical'\\nvar imageOffer = 'UbuntuServer'\\nvar nicName = 'myVMNic'\\nvar nsgName = 'myNSG'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'Subnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar publicIPAddressName = 'myPublicIP'\\nvar virtualNetworkName = 'MyVNET'\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2022-09-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  sku: {\\n    name: 'Basic'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-09-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2022-09-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\n          }\\n        }\\n      }\\n    ]\\n    networkSecurityGroup: {\\n      id: nsg.id\\n    }\\n  }\\n  dependsOn: [\\n\\n    virtualNetwork\\n\\n  ]\\n}\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2022-09-01' = {\\n  name: nsgName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'SSH'\\n        properties: {\\n          description: 'Allow SSH'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '22'\\n          sourceAddressPrefix: 'Internet'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'RDP'\\n        properties: {\\n          description: 'Allow RDP'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '3389'\\n          sourceAddressPrefix: 'Internet'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 102\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2022-11-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: ubuntuOSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        osType: 'Linux'\\n        name: '${vmName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n        managedDisk: {\\n          storageAccountType: 'Premium_LRS'\\n        }\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource vmName_installscript 'Microsoft.Compute/virtualMachines/extensions@2022-11-01' = {\\n  parent: vm\\n  name: 'installscript'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        uri(_artifactsLocation, 'infra.sh${_artifactsLocationSasToken}')\\n      ]\\n      commandToExecute: 'bash infra.sh'\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"ubuntuOSVersion\\\": {\\n      \\\"value\\\": \\\"18.04-LTS\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Unique Storage Account name')\\nparam storagename string = 'labvmstrg${uniqueString(resourceGroup().id)}'\\n\\n@description('VM DNS Label prefix')\\nparam vm_dns string = 'labvm-${uniqueString(resourceGroup().id)}'\\n\\n@description('Admin Username for Lab VM')\\nparam adminUser string\\n\\n@description('Password for admin user')\\n@secure()\\nparam adminPassword string\\n\\n@description('VM Size for lab-vm')\\n@allowed([\\n  'Standard_D4s_v3'\\n  'Standard_D8s_v3'\\n  'Standard_D8s_v4'\\n])\\nparam vmsize string = 'Standard_D8s_v3'\\n\\n@description('Location to deploy current resource')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('SAS Token for accessing script path')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar scriptUrl = uri(_artifactsLocation, 'installscript.ps1${_artifactsLocationSasToken}')\\n\\nresource storagename_resource 'Microsoft.Storage/storageAccounts@2019-06-01' = {\\n  name: toLower(storagename)\\n  location: location\\n  sku: {\\n    name: 'Standard_LRS'\\n  }\\n  kind: 'Storage'\\n  tags: {\\n    displayName: 'VS LabVM Storage Account'\\n  }\\n}\\n\\nresource vslab_PublicIP 'Microsoft.Network/publicIPAddresses@2019-11-01' = {\\n  name: 'vslab-PublicIP'\\n  location: location\\n  tags: {\\n    displayName: 'PublicIPAddress'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n    dnsSettings: {\\n      domainNameLabel: vm_dns\\n    }\\n  }\\n}\\n\\nresource vslab_nsg 'Microsoft.Network/networkSecurityGroups@2020-04-01' = {\\n  name: 'vslab-nsg'\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'nsgRule1'\\n        properties: {\\n          description: 'description'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '3389'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vslab_VirtualNetwork 'Microsoft.Network/virtualNetworks@2020-04-01' = {\\n  name: 'vslab-VirtualNetwork'\\n  location: location\\n  tags: {\\n    displayName: 'vslab-VirtualNetwork'\\n  }\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        '10.0.0.0/16'\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: 'vslab-vnet-subnet'\\n        properties: {\\n          addressPrefix: '10.0.0.0/24'\\n          networkSecurityGroup: {\\n            id: vslab_nsg.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vslab_nic 'Microsoft.Network/networkInterfaces@2020-04-01' = {\\n  name: 'vslab-nic'\\n  location: location\\n  tags: {\\n    displayName: 'VSLab Network Interface'\\n  }\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipConfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: vslab_PublicIP.id\\n          }\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', 'vslab-VirtualNetwork', 'vslab-vnet-subnet')\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    vslab_VirtualNetwork\\n  ]\\n}\\n\\nresource vsLab 'Microsoft.Compute/virtualMachines@2019-07-01' = {\\n  name: 'vsLab'\\n  location: location\\n  tags: {\\n    displayName: 'VS2019 Lab VM'\\n  }\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmsize\\n    }\\n    osProfile: {\\n      computerName: 'LabVM'\\n      adminUsername: adminUser\\n      adminPassword: adminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: 'MicrosoftVisualStudio'\\n        offer: 'VisualStudio2019latest'\\n        sku: 'vs-2019-comm-latest-ws2019'\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: 'LabVMOSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: vslab_nic.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: reference(resourceId('Microsoft.Storage/storageAccounts/', storagename)).primaryEndpoints.blob\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    resourceId('Microsoft.Storage/storageAccounts', storagename)\\n  ]\\n}\\n\\nresource vsLab_installscript1 'Microsoft.Compute/virtualMachines/extensions@2019-07-01' = {\\n  parent: vsLab\\n  name: 'installscript1'\\n  location: location\\n  tags: {\\n    displayName: 'Install script for LabVM'\\n  }\\n  properties: {\\n    publisher: 'Microsoft.Compute'\\n    type: 'CustomScriptExtension'\\n    typeHandlerVersion: '1.10'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        scriptUrl\\n      ]\\n    }\\n    protectedSettings: {\\n      commandToExecute: 'powershell -ExecutionPolicy Bypass -file installscript.ps1 -UserName ${adminUser}'\\n    }\\n  }\\n}\\n\\noutput lab_vm_dns string = vslab_PublicIP.properties.dnsSettings.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"storagename\\\": {\\n      \\\"value\\\": \\\"labvmstrg${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"vm_dns\\\": {\\n      \\\"value\\\": \\\"labvm-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"adminUser\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmsize\\\": {\\n      \\\"value\\\": \\\"Standard_D8s_v3\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Storage Account type')\\n@allowed([\\n  'Standard_LRS'\\n  'Standard_GRS'\\n  'Standard_ZRS'\\n])\\nparam storageAccountType string = 'Standard_LRS'\\n\\n@description('Storage Account Name')\\nparam storageAccountName string = uniqueString(resourceGroup().id)\\n\\n@description('WordPress Site Name')\\nparam siteName string = storageAccountName\\n\\n@description('MySQL database password')\\n@secure()\\nparam mySqlPassword string\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nvar cpuCores = '0.5'\\nvar memoryInGb = '0.7'\\nvar wordpressContainerGroupName = 'wordpress-containerinstance'\\nvar wordpressShareName = 'wordpress-share'\\nvar mysqlShareName = 'mysql-share'\\nvar scriptName = 'createFileShare'\\nvar identityName = 'scratch'\\nvar roleDefinitionId = resourceId('microsoft.authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\\nvar roleAssignmentName = guid(identityName, roleDefinitionId, resourceGroup().id)\\nvar sqlScriptToExecute = 'Get-AzStorageAccount -StorageAccountName ${storageAccountName} -ResourceGroupName ${resourceGroup().name} | New-AzStorageShare -Name ${mysqlShareName}'\\nvar wpScriptToExecute = 'Get-AzStorageAccount -StorageAccountName ${storageAccountName} -ResourceGroupName ${resourceGroup().name} | New-AzStorageShare -Name ${wordpressShareName}'\\n\\nresource identity 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\\n  name: identityName\\n  location: location\\n}\\n\\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2020-04-01-preview' = {\\n  name: roleAssignmentName\\n  properties: {\\n    roleDefinitionId: roleDefinitionId\\n    principalId: identity.properties.principalId\\n    principalType: 'ServicePrincipal'\\n  }\\n}\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-04-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n  kind: 'StorageV2'\\n  dependsOn: [\\n    roleAssignment\\n  ]\\n}\\n\\nresource scriptName_wordpressShare 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\\n  name: '${scriptName}-${wordpressShareName}'\\n  location: location\\n  kind: 'AzurePowerShell'\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${identity.id}': {}\\n    }\\n  }\\n  properties: {\\n    azPowerShellVersion: '3.0'\\n    storageAccountSettings: {\\n      storageAccountName: storageAccountName\\n      storageAccountKey: listKeys(storageAccount.id, '2021-04-01').keys[0].value\\n    }\\n    scriptContent: wpScriptToExecute\\n    cleanupPreference: 'OnSuccess'\\n    retentionInterval: 'P1D'\\n    timeout: 'PT5M'\\n  }\\n}\\n\\nresource scriptName_mysqlShare 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\\n  name: '${scriptName}-${mysqlShareName}'\\n  location: location\\n  kind: 'AzurePowerShell'\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${identity.id}': {}\\n    }\\n  }\\n  properties: {\\n    azPowerShellVersion: '3.0'\\n    storageAccountSettings: {\\n      storageAccountName: storageAccountName\\n      storageAccountKey: listKeys(storageAccount.id, '2021-04-01').keys[0].value\\n    }\\n    scriptContent: sqlScriptToExecute\\n    cleanupPreference: 'OnSuccess'\\n    retentionInterval: 'P1D'\\n    timeout: 'PT5M'\\n  }\\n}\\n\\nresource wordpressContainerGroup 'Microsoft.ContainerInstance/containerGroups@2019-12-01' = {\\n  name: wordpressContainerGroupName\\n  location: location\\n  properties: {\\n    containers: [\\n      {\\n        name: 'wordpress'\\n        properties: {\\n          image: 'wordpress:4.9-apache'\\n          ports: [\\n            {\\n              protocol: 'TCP'\\n              port: 80\\n            }\\n          ]\\n          environmentVariables: [\\n            {\\n              name: 'WORDPRESS_DB_HOST'\\n              value: '127.0.0.1:3306'\\n            }\\n            {\\n              name: 'WORDPRESS_DB_PASSWORD'\\n              secureValue: mySqlPassword\\n            }\\n          ]\\n          volumeMounts: [\\n            {\\n              mountPath: '/var/www/html'\\n              name: 'wordpressfile'\\n            }\\n          ]\\n          resources: {\\n            requests: {\\n              cpu: cpuCores\\n              memoryInGB: memoryInGb\\n            }\\n          }\\n        }\\n      }\\n      {\\n        name: 'mysql'\\n        properties: {\\n          image: 'mysql:5.6'\\n          ports: [\\n            {\\n              protocol: 'TCP'\\n              port: 3306\\n            }\\n          ]\\n          environmentVariables: [\\n            {\\n              name: 'MYSQL_ROOT_PASSWORD'\\n              value: mySqlPassword\\n            }\\n          ]\\n          volumeMounts: [\\n            {\\n              mountPath: '/var/lib/mysql'\\n              name: 'mysqlfile'\\n            }\\n          ]\\n          resources: {\\n            requests: {\\n              cpu: cpuCores\\n              memoryInGB: memoryInGb\\n            }\\n          }\\n        }\\n      }\\n    ]\\n    volumes: [\\n      {\\n        azureFile: {\\n          shareName: wordpressShareName\\n          storageAccountKey: listKeys(storageAccount.id, '2021-04-01').keys[0].value\\n          storageAccountName: storageAccountName\\n        }\\n        name: 'wordpressfile'\\n      }\\n      {\\n        azureFile: {\\n          shareName: mysqlShareName\\n          storageAccountKey: listKeys(storageAccount.id, '2021-04-01').keys[0].value\\n          storageAccountName: storageAccountName\\n        }\\n        name: 'mysqlfile'\\n      }\\n    ]\\n    ipAddress: {\\n      ports: [\\n        {\\n          protocol: 'TCP'\\n          port: 80\\n        }\\n      ]\\n      type: 'Public'\\n      dnsNameLabel: siteName\\n    }\\n    osType: 'Linux'\\n  }\\n  dependsOn: [\\n    scriptName_mysqlShare\\n    scriptName_wordpressShare\\n  ]\\n}\\n\\noutput siteFQDN string = wordpressContainerGroup.properties.ipAddress.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"storageAccountType\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"uniqueString(resourceGroup().id)\\\"\\n    },\\n    \\\"siteName\\\": {\\n      \\\"value\\\": \\\"storageAccountName\\\"\\n    },\\n    \\\"mySqlPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The Linux distribution for the VM. This will pick a fully patched image of the selected distribution.')\\n@allowed([\\n  'Ubuntu 20.04-LTS'\\n  'Ubuntu 18.04-LTS'\\n  'Debian 10'\\n  'Debian 9'\\n  'CentOS 8.1'\\n])\\nparam OS string = 'Ubuntu 20.04-LTS'\\n\\n@description('Azul Zulu OpenJDK JVM for Azure package name')\\n@allowed([\\n  'Azul_Zulu_OpenJDK-7-JDK'\\n  'Azul_Zulu_OpenJDK-7-JRE'\\n  'Azul_Zulu_OpenJDK-7-JRE-Headless'\\n  'Azul_Zulu_OpenJDK-8-JDK'\\n  'Azul_Zulu_OpenJDK-8-JRE'\\n  'Azul_Zulu_OpenJDK-8-JRE-Headless'\\n  'Azul_Zulu_OpenJDK-11-JDK'\\n  'Azul_Zulu_OpenJDK-11-JRE'\\n  'Azul_Zulu_OpenJDK-11-JRE-Headless'\\n  'Azul_Zulu_OpenJDK-13-JDK'\\n  'Azul_Zulu_OpenJDK-13-JRE'\\n  'Azul_Zulu_OpenJDK-13-JRE-Headless'\\n])\\nparam javaPackageName string = 'Azul_Zulu_OpenJDK-8-JDK'\\n\\n@description('Size for the Virtual Machine.')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('Name for the Virtual Machine.')\\nparam vmName string = 'linux-zulu'\\n\\n@description('User name for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Type of authentication to use on the Virtual Machine.')\\n@allowed([\\n  'password'\\n  'sshPublicKey'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('Password or SSH key for the Virtual Machine.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Determines whether or not a new storage account should be provisioned.')\\nparam storageNewOrExisting string = 'new'\\n\\n@description('Name of the storage account')\\nparam storageAccountName string = 'storage${uniqueString(resourceGroup().id)}'\\n\\n@description('Storage account type')\\n@allowed([\\n  'Standard_LRS'\\n])\\nparam storageAccountType string = 'Standard_LRS'\\n\\n@description('Name of the resource group for the existing storage account')\\nparam storageAccountResourceGroupName string = resourceGroup().name\\n\\n@description('Determines whether or not a new virtual network should be provisioned.')\\nparam virtualNetworkNewOrExisting string = 'new'\\n\\n@description('Name of the virtual network')\\nparam virtualNetworkName string = 'VirtualNetwork'\\n\\n@description('Address prefix of the virtual network')\\nparam addressPrefixes array = [\\n  '10.0.0.0/16'\\n]\\n\\n@description('Name of the subnet')\\nparam subnetName string = 'default'\\n\\n@description('Subnet prefix of the virtual network')\\nparam subnetPrefix string = '10.0.0.0/24'\\n\\n@description('Name of the resource group for the existing virtual network')\\nparam virtualNetworkResourceGroupName string = resourceGroup().name\\n\\n@description('Determines whether or not a new public ip should be provisioned.')\\nparam publicIpNewOrExisting string = 'new'\\n\\n@description('Name of the public ip address')\\nparam publicIpName string = 'PublicIp'\\n\\n@description('DNS of the public ip address for the VM')\\nparam publicIpDns string = 'linux-vm-${uniqueString(resourceGroup().id)}'\\n\\n@description('Name of the resource group for the public ip address')\\nparam publicIpResourceGroupName string = resourceGroup().name\\n\\n@description('Allocation method for the public ip address')\\n@allowed([\\n  'Dynamic'\\n  'Static'\\n])\\nparam publicIpAllocationMethod string = 'Dynamic'\\n\\n@description('Name of the resource group for the public ip address')\\n@allowed([\\n  'Basic'\\n  'Standard'\\n])\\nparam publicIpSku string = 'Basic'\\n\\n@description('Location for the resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar imageReference = {\\n  'Ubuntu 20.04-LTS': {\\n    publisher: 'Canonical'\\n    offer: '0001-com-ubuntu-server-focal'\\n    sku: '20_04-lts'\\n    version: 'latest'\\n  }\\n  'Ubuntu 18.04-LTS': {\\n    publisher: 'Canonical'\\n    offer: 'UbuntuServer'\\n    sku: '18.04-LTS'\\n    version: 'latest'\\n  }\\n  'Debian 10': {\\n    publisher: 'Debian'\\n    offer: 'debian-10'\\n    sku: '10'\\n    version: 'latest'\\n  }\\n  'Debian 9': {\\n    publisher: 'credativ'\\n    offer: 'Debian'\\n    sku: '9'\\n    version: 'latest'\\n  }\\n  'CentOS 8.1': {\\n    publisher: 'OpenLogic'\\n    offer: 'CentOS'\\n    sku: '8_1'\\n    version: 'latest'\\n  }\\n}\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar networkSecurityGroupName = '${vmName}-nsg'\\nvar nicName = '${vmName}-nic'\\nvar publicIpAddressId = {\\n  id: resourceId(publicIpResourceGroupName, 'Microsoft.Network/publicIPAddresses', publicIpName)\\n}\\nvar scriptFile = {\\n  'Ubuntu 20.04-LTS': {\\n    scriptFileName: 'apt-zulu-install.sh'\\n  }\\n  'Ubuntu 18.04-LTS': {\\n    scriptFileName: 'apt-zulu-install.sh'\\n  }\\n  'Debian 9': {\\n    scriptFileName: 'apt-zulu-install.sh'\\n  }\\n  'Debian 10': {\\n    scriptFileName: 'apt-zulu-install.sh'\\n  }\\n  'CentOS 8.1': {\\n    scriptFileName: 'yum-zulu-install.sh'\\n  }\\n}\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2019-06-01' = if (storageNewOrExisting == 'new') {\\n  name: storageAccountName\\n  location: location\\n  kind: 'Storage'\\n  sku: {\\n    name: storageAccountType\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2019-11-01' = if (virtualNetworkNewOrExisting == 'new') {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: addressPrefixes\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIp 'Microsoft.Network/publicIPAddresses@2019-11-01' = if (publicIpNewOrExisting == 'new') {\\n  name: publicIpName\\n  location: location\\n  sku: {\\n    name: publicIpSku\\n  }\\n  properties: {\\n    publicIPAllocationMethod: publicIpAllocationMethod\\n    dnsSettings: {\\n      domainNameLabel: publicIpDns\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2019-11-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'AllowSSH'\\n        properties: {\\n          priority: 1000\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n          destinationPortRange: '22'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2019-11-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: resourceId(\\n              virtualNetworkResourceGroupName,\\n              'Microsoft.Network/virtualNetworks/subnets/',\\n              virtualNetworkName,\\n              subnetName\\n            )\\n          }\\n          publicIPAddress: ((publicIpNewOrExisting != 'none') ? publicIpAddressId : json('null'))\\n        }\\n      }\\n    ]\\n    networkSecurityGroup: {\\n      id: networkSecurityGroup.id\\n    }\\n  }\\n  dependsOn: [\\n    publicIp\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2019-12-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: imageReference[OS]\\n      osDisk: {\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: reference(\\n          resourceId(storageAccountResourceGroupName, 'Microsoft.Storage/storageAccounts/', storageAccountName),\\n          '2019-06-01'\\n        ).primaryEndpoints.blob\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    storageAccount\\n  ]\\n}\\n\\nresource vmName_installScript 'Microsoft.Compute/virtualMachines/extensions@2019-12-01' = {\\n  parent: vm\\n  name: 'installScript'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        uri(_artifactsLocation, 'scripts/${scriptFile[OS].scriptFileName}${_artifactsLocationSasToken}')\\n      ]\\n      commandToExecute: 'bash ${scriptFile[OS].scriptFileName} ${javaPackageName}'\\n    }\\n  }\\n}\\n\\noutput ssh_command string = ((publicIpNewOrExisting == 'none')\\n  ? 'no public ip'\\n  : 'ssh ${adminUsername}@${reference(resourceId(publicIpResourceGroupName,'Microsoft.Network/publicIPAddresses',publicIpName),'2019-11-01').dnsSettings.fqdn}')\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"OS\\\": {\\n      \\\"value\\\": \\\"Ubuntu 20.04-LTS\\\"\\n    },\\n    \\\"javaPackageName\\\": {\\n      \\\"value\\\": \\\"Azul_Zulu_OpenJDK-8-JDK\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"linux-zulu\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"storageNewOrExisting\\\": {\\n      \\\"value\\\": \\\"new\\\"\\n    },\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"storage${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"storageAccountType\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"storageAccountResourceGroupName\\\": {\\n      \\\"value\\\": \\\"resourceGroup().name\\\"\\n    },\\n    \\\"virtualNetworkNewOrExisting\\\": {\\n      \\\"value\\\": \\\"new\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"VirtualNetwork\\\"\\n    },\\n    \\\"addressPrefixes\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"default\\\"\\n    },\\n    \\\"subnetPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/24\\\"\\n    },\\n    \\\"virtualNetworkResourceGroupName\\\": {\\n      \\\"value\\\": \\\"resourceGroup().name\\\"\\n    },\\n    \\\"publicIpNewOrExisting\\\": {\\n      \\\"value\\\": \\\"new\\\"\\n    },\\n    \\\"publicIpName\\\": {\\n      \\\"value\\\": \\\"PublicIp\\\"\\n    },\\n    \\\"publicIpDns\\\": {\\n      \\\"value\\\": \\\"linux-vm-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"publicIpResourceGroupName\\\": {\\n      \\\"value\\\": \\\"resourceGroup().name\\\"\\n    },\\n    \\\"publicIpAllocationMethod\\\": {\\n      \\\"value\\\": \\\"Dynamic\\\"\\n    },\\n    \\\"publicIpSku\\\": {\\n      \\\"value\\\": \\\"Basic\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param alertName string\\n\\n@description('Application Gateway ResourceID example /subscriptions/subs-id/resourceGroups/rg-name/providers/Microsoft.Network/applicationGateways/agw-name')\\nparam applicationGatewayResourceID string\\n\\n@description('Action Group ResourceID example /subscriptions/subs-id/resourceGroups/rg-name/providers/microsoft.insights/actiongroups/action-group-name')\\nparam actionGroupResourceID string\\n\\nresource alert 'Microsoft.Insights/metricAlerts@2018-03-01' = {\\n  name: alertName\\n  location: 'global'\\n  properties: {\\n    severity: 2\\n    enabled: true\\n    scopes: [\\n      applicationGatewayResourceID\\n    ]\\n    evaluationFrequency: 'PT5M'\\n    windowSize: 'PT5M'\\n    criteria: {\\n      allOf: [\\n        {\\n          alertSensitivity: 'High'\\n          failingPeriods: {\\n            numberOfEvaluationPeriods: 4\\n            minFailingPeriodsToAlert: 4\\n          }\\n          name: 'Metric1'\\n          metricNamespace: 'Microsoft.Network/applicationGateways'\\n          metricName: 'BackendResponseStatus'\\n          dimensions: [\\n            {\\n              name: 'HttpStatusGroup'\\n              operator: 'Include'\\n              values: [\\n                '5xx'\\n              ]\\n            }\\n          ]\\n          operator: 'GreaterThan'\\n          timeAggregation: 'Total'\\n          criterionType: 'DynamicThresholdCriterion'\\n        }\\n      ]\\n      'odata.type': 'Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria'\\n    }\\n    autoMitigate: true\\n    targetResourceType: 'Microsoft.Network/applicationGateways'\\n    actions: [\\n      {\\n        actionGroupId: actionGroupResourceID\\n        webHookProperties: {}\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"alertName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"applicationGatewayResourceID\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"actionGroupResourceID\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Admin username for the backend servers')\\nparam adminUsername string\\n\\n@description('Password for the admin account on the backend servers')\\n@secure()\\nparam adminPassword string\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Size of the virtual machine.')\\nparam vmSize string = 'Standard_B2ms'\\n\\nvar virtualMachines_myVM_name = 'myVM'\\nvar virtualNetworks_myVNet_name = 'myVNet'\\nvar myNic_name = 'net-int'\\nvar ipconfig_name = 'ipconfig'\\nvar publicIPAddress_name = 'public_ip'\\nvar nsg_name = 'vm-nsg'\\nvar applicationGateways_myAppGateway_name = 'myAppGateway'\\nvar vnet_prefix = '10.0.0.0/16'\\nvar ag_subnet_prefix = '10.0.0.0/24'\\nvar backend_subnet_prefix = '10.0.1.0/24'\\nvar AppGW_AppFW_Pol_name = 'WafPol01'\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2021-08-01' = [for i in range(0, 2): {\\n  name: '${nsg_name}${(i + 1)}'\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'RDP'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '3389'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 300\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}]\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2021-08-01' = [for i in range(0, 3): {\\n  name: '${publicIPAddress_name}${i}'\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    publicIPAddressVersion: 'IPv4'\\n    publicIPAllocationMethod: 'Static'\\n    idleTimeoutInMinutes: 4\\n  }\\n}]\\n\\nresource myVNet 'Microsoft.Network/virtualNetworks@2021-08-01' = {\\n  name: virtualNetworks_myVNet_name\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnet_prefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: 'myAGSubnet'\\n        properties: {\\n          addressPrefix: ag_subnet_prefix\\n          privateEndpointNetworkPolicies: 'Enabled'\\n          privateLinkServiceNetworkPolicies: 'Enabled'\\n        }\\n      }\\n      {\\n        name: 'myBackendSubnet'\\n        properties: {\\n          addressPrefix: backend_subnet_prefix\\n          privateEndpointNetworkPolicies: 'Enabled'\\n          privateLinkServiceNetworkPolicies: 'Enabled'\\n        }\\n      }\\n    ]\\n    enableDdosProtection: false\\n    enableVmProtection: false\\n  }\\n}\\n\\nresource myVM 'Microsoft.Compute/virtualMachines@2021-11-01' = [for i in range(0, 2): {\\n  name: '${virtualMachines_myVM_name}${(i + 1)}'\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: 'MicrosoftWindowsServer'\\n        offer: 'WindowsServer'\\n        sku: '2019-Datacenter'\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        osType: 'Windows'\\n        createOption: 'FromImage'\\n        caching: 'ReadWrite'\\n        managedDisk: {\\n          storageAccountType: 'StandardSSD_LRS'\\n        }\\n        diskSizeGB: 127\\n      }\\n    }\\n    osProfile: {\\n      computerName: '${virtualMachines_myVM_name}${(i + 1)}'\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n      windowsConfiguration: {\\n        provisionVMAgent: true\\n        enableAutomaticUpdates: true\\n      }\\n      allowExtensionOperations: true\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: resourceId('Microsoft.Network/networkInterfaces', '${myNic_name}${(i + 1)}')\\n        }\\n      ]\\n    }\\n  }\\n  dependsOn: [\\n    myNic\\n  ]\\n}]\\n\\nresource myVM_IIS 'Microsoft.Compute/virtualMachines/extensions@2021-11-01' = [for i in range(0, 2): {\\n  name: '${virtualMachines_myVM_name}${(i + 1)}/IIS'\\n  location: location\\n  properties: {\\n    autoUpgradeMinorVersion: true\\n    publisher: 'Microsoft.Compute'\\n    type: 'CustomScriptExtension'\\n    typeHandlerVersion: '1.4'\\n    settings: {\\n      commandToExecute: 'powershell Add-WindowsFeature Web-Server; powershell Add-Content -Path \\\"C:\\\\\\\\inetpub\\\\\\\\wwwroot\\\\\\\\Default.htm\\\" -Value $($env:computername)'\\n    }\\n  }\\n  dependsOn: [\\n    myVM\\n  ]\\n}]\\n\\nresource myAppGateway 'Microsoft.Network/applicationGateways@2021-08-01' = {\\n  name: applicationGateways_myAppGateway_name\\n  location: location\\n  properties: {\\n    sku: {\\n      name: 'WAF_v2'\\n      tier: 'WAF_v2'\\n      capacity: 2\\n    }\\n    gatewayIPConfigurations: [\\n      {\\n        name: 'appGatewayIpConfig'\\n        properties: {\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworks_myVNet_name, 'myAGSubnet')\\n          }\\n        }\\n      }\\n    ]\\n    frontendIPConfigurations: [\\n      {\\n        name: 'appGwPublicFrontendIp'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: resourceId('Microsoft.Network/publicIPAddresses', '${publicIPAddress_name}0')\\n          }\\n        }\\n      }\\n    ]\\n    frontendPorts: [\\n      {\\n        name: 'port_80'\\n        properties: {\\n          port: 80\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: 'myBackendPool'\\n        properties: {}\\n      }\\n    ]\\n    backendHttpSettingsCollection: [\\n      {\\n        name: 'myHTTPSetting'\\n        properties: {\\n          port: 80\\n          protocol: 'Http'\\n          cookieBasedAffinity: 'Disabled'\\n          pickHostNameFromBackendAddress: false\\n          requestTimeout: 20\\n        }\\n      }\\n    ]\\n    httpListeners: [\\n      {\\n        name: 'myListener'\\n        properties: {\\n          firewallPolicy: {\\n            id: AppGW_AppFW_Pol.id\\n          }\\n          frontendIPConfiguration: {\\n            id: resourceId('Microsoft.Network/applicationGateways/frontendIPConfigurations', applicationGateways_myAppGateway_name, 'appGwPublicFrontendIp')\\n          }\\n          frontendPort: {\\n            id: resourceId('Microsoft.Network/applicationGateways/frontendPorts', applicationGateways_myAppGateway_name, 'port_80')\\n          }\\n          protocol: 'Http'\\n          requireServerNameIndication: false\\n        }\\n      }\\n    ]\\n    requestRoutingRules: [\\n      {\\n        name: 'myRoutingRule'\\n        properties: {\\n          ruleType: 'Basic'\\n          priority: 10\\n          httpListener: {\\n            id: resourceId('Microsoft.Network/applicationGateways/httpListeners', applicationGateways_myAppGateway_name, 'myListener')\\n          }\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/applicationGateways/backendAddressPools', applicationGateways_myAppGateway_name, 'myBackendPool')\\n          }\\n          backendHttpSettings: {\\n            id: resourceId('Microsoft.Network/applicationGateways/backendHttpSettingsCollection', applicationGateways_myAppGateway_name, 'myHTTPSetting')\\n          }\\n        }\\n      }\\n    ]\\n    enableHttp2: false\\n    firewallPolicy: {\\n      id: AppGW_AppFW_Pol.id\\n    }\\n  }\\n  dependsOn: [\\n    myVNet\\n    publicIPAddress\\n  ]\\n}\\n\\nresource AppGW_AppFW_Pol 'Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies@2021-08-01' = {\\n  name: AppGW_AppFW_Pol_name\\n  location: location\\n  properties: {\\n    customRules: [\\n      {\\n        name: 'CustRule01'\\n        priority: 100\\n        ruleType: 'MatchRule'\\n        action: 'Block'\\n        matchConditions: [\\n          {\\n            matchVariables: [\\n              {\\n                variableName: 'RemoteAddr'\\n              }\\n            ]\\n            operator: 'IPMatch'\\n            negationConditon: true\\n            matchValues: [\\n              '10.10.10.0/24'\\n            ]\\n          }\\n        ]\\n      }\\n    ]\\n    policySettings: {\\n      requestBodyCheck: true\\n      maxRequestBodySizeInKb: 128\\n      fileUploadLimitInMb: 100\\n      state: 'Enabled'\\n      mode: 'Prevention'\\n    }\\n    managedRules: {\\n      managedRuleSets: [\\n        {\\n          ruleSetType: 'OWASP'\\n          ruleSetVersion: '3.1'\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource myNic 'Microsoft.Network/networkInterfaces@2021-08-01' = [for i in range(0, 2): {\\n  name: '${myNic_name}${(i + 1)}'\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: '${ipconfig_name}${(i + 1)}'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: resourceId('Microsoft.Network/publicIPAddresses', '${publicIPAddress_name}${(i + 1)}')\\n          }\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworks_myVNet_name, 'myBackendSubnet')\\n          }\\n          primary: true\\n          privateIPAddressVersion: 'IPv4'\\n          applicationGatewayBackendAddressPools: [\\n            {\\n              id: resourceId('Microsoft.Network/applicationGateways/backendAddressPools', applicationGateways_myAppGateway_name, 'myBackendPool')\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n    enableAcceleratedNetworking: false\\n    enableIPForwarding: false\\n    networkSecurityGroup: {\\n      id: resourceId('Microsoft.Network/networkSecurityGroups', '${nsg_name}${(i + 1)}')\\n    }\\n  }\\n  dependsOn: [\\n    publicIPAddress\\n    myVNet\\n    myAppGateway\\n    nsg\\n  ]\\n}]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_B2ms\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location (region) for all resources.  Use the location value, not the display name, e.g. eastus, not East US 2')\\nparam location string = resourceGroup().location\\n\\n@description('Name of the ASE resource')\\nparam aseName string = 'ASE${uniqueString(resourceGroup().id)}'\\n\\n@description('The name of the vNet')\\nparam vnetResourceName string = 'virtualNetwork'\\n\\n@description('Name of the initial ASE App (without the FQDN)')\\nparam applicationName string = 'application1'\\n\\n@description('0 = public VIP only, 1 = only ports 80/443 are mapped to ILB VIP, 2 = only FTP ports are mapped to ILB VIP, 3 = both ports 80/443 and FTP ports are mapped to an ILB VIP.')\\n@allowed([\\n  0\\n  3\\n])\\nparam internalLoadBalancingMode int = 3\\n\\n@description('Subnet name which will contain the App Service Environment')\\nparam aseSubnetName string = 'ase-subnet'\\n\\n@description('Name of the app service')\\nparam serverFarmsAseAspName string = 'ase-asp'\\n\\n@description('The location of resources, such as templates and DSC modules, that the template depends on')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Address range for the virtual network in CIDR notation')\\nparam vnetAddressRange string = '10.0.0.0/16'\\n\\n@description('Address range for the ASE subnet in CIDR notation within the vnetAddress range')\\nparam aseSubnetAddressRange string = '10.0.0.0/24'\\n\\n@description('Name for the NSG attached to the ASE subnet')\\nparam aseNSGName string = 'ase-NSG'\\n\\n@description('Name of the Route Table attached to the ASE subnet')\\nparam aseRouteTableName string = 'ase-RouteTable'\\n\\n@description('Name of the Azure Firewall')\\nparam azureFirewallName string = 'azFirewall'\\n\\n@description('Toggle whether to deploy the Azure Firewall')\\nparam deployAzureFirewall bool = true\\n\\n@description('Name of the Azure Firewall Route Table')\\nparam azureFirewallRouteTableName string = 'azFirewall-RouteTable'\\n\\n@description('Address range that will be used by the Azure Firewall Subnet within the vnetAddress range')\\nparam azureFirewallSubnetAddressRange string = '10.0.1.0/24'\\n\\n@description('Name for the Azure Firewall public IP resource')\\nparam azureFirewallPublicIP string = 'AzFirewall-pip'\\n\\n@description('The collection of resource tags passed from parameters file')\\nparam tags object = {}\\n\\n@description('Service Endpoints enabled on the ASE subnet')\\nparam aseSubnetServiceEndpoints array = []\\n\\n@description('List of ASE management IP addresses')\\nparam aseManagementIps array = []\\n\\n@description('FQDNs to whitelist for Azure Monitor')\\nparam azureMonitorFQDNs array\\n\\nvar subnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', vnetResourceName, aseSubnetName)\\nvar nestedTemplateUri = uri(_artifactsLocation, 'nestedtemplates/vnet.json${_artifactsLocationSasToken}')\\n\\nmodule BuildOrUpdateASENetworking '?' /*TODO: replace with correct path to [variables('nestedTemplateUri')]*/ = {\\n  name: 'BuildOrUpdateASENetworking'\\n  params: {\\n    location: location\\n    vnetResourceName: vnetResourceName\\n    vnetAddressRange: vnetAddressRange\\n    aseSubnetName: aseSubnetName\\n    aseSubnetAddressRange: aseSubnetAddressRange\\n    aseNSGName: aseNSGName\\n    aseRouteTableName: aseRouteTableName\\n    azureFirewallName: azureFirewallName\\n    azureFirewallSubnetAddressRange: azureFirewallSubnetAddressRange\\n    azureFirewallRouteTableName: azureFirewallRouteTableName\\n    azureFirewallPublicIP: azureFirewallPublicIP\\n    deployAzureFirewall: deployAzureFirewall\\n    tags: tags\\n    aseSubnetServiceEndpoints: aseSubnetServiceEndpoints\\n    aseManagementIps: aseManagementIps\\n    azureMonitorFQDNs: azureMonitorFQDNs\\n  }\\n}\\n\\nresource ase 'Microsoft.Web/hostingEnvironments@2020-12-01' = {\\n  name: aseName\\n  location: location\\n  kind: 'ASEV2'\\n  tags: {\\n    displayName: 'Deploy ASE'\\n  }\\n  properties: {\\n    name: aseName\\n    location: location\\n    ipsslAddressCount: 0\\n    internalLoadBalancingMode: internalLoadBalancingMode\\n    virtualNetwork: {\\n      id: subnetId\\n    }\\n  }\\n  dependsOn: [\\n    BuildOrUpdateASENetworking\\n  ]\\n}\\n\\nresource serverFarmsAseAsp 'Microsoft.web/serverfarms@2020-12-01' = {\\n  name: serverFarmsAseAspName\\n  location: location\\n  sku: {\\n    name: 'I1'\\n    tier: 'Isolated'\\n  }\\n  tags: {\\n    displayName: 'Deploy App Service'\\n  }\\n  kind: 'app'\\n  properties: {\\n    name: serverFarmsAseAspName\\n    workerSize: '0'\\n    workerSizeId: '0'\\n    numberOfWorkers: '1'\\n    reserved: false\\n    hostingEnvironment: aseName\\n  }\\n  dependsOn: [\\n    ase\\n  ]\\n}\\n\\nresource application 'Microsoft.Web/sites@2020-12-01' = {\\n  name: applicationName\\n  location: location\\n  tags: {\\n    displayName: 'Deploy Web App'\\n  }\\n  kind: 'app'\\n  properties: {\\n    enabled: true\\n    serverFarmId: serverFarmsAseAsp.id\\n    reserved: false\\n    scmSiteAlsoStopped: false\\n    hostingEnvironmentProfile: {\\n      id: ase.id\\n    }\\n    clientAffinityEnabled: true\\n    clientCertEnabled: false\\n    hostNamesDisabled: false\\n    containerSize: 0\\n    dailyMemoryTimeQuota: 0\\n    httpsOnly: false\\n  }\\n}\\n\\nresource microsoft_insights_components_application 'microsoft.insights/components@2020-02-02-preview' = {\\n  name: applicationName\\n  location: location\\n  tags: {\\n    applicationType: 'web'\\n    displayName: 'Deploy Application Insights'\\n  }\\n  kind: 'web'\\n  properties: {\\n    Application_Type: 'web'\\n    Flow_Type: 'Redfield'\\n    Request_Source: 'AppServiceEnablementCreate'\\n  }\\n  dependsOn: [\\n    BuildOrUpdateASENetworking\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"aseName\\\": {\\n      \\\"value\\\": \\\"ASE${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"vnetResourceName\\\": {\\n      \\\"value\\\": \\\"virtualNetwork\\\"\\n    },\\n    \\\"applicationName\\\": {\\n      \\\"value\\\": \\\"application1\\\"\\n    },\\n    \\\"internalLoadBalancingMode\\\": {\\n      \\\"value\\\": 3\\n    },\\n    \\\"aseSubnetName\\\": {\\n      \\\"value\\\": \\\"ase-subnet\\\"\\n    },\\n    \\\"serverFarmsAseAspName\\\": {\\n      \\\"value\\\": \\\"ase-asp\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"vnetAddressRange\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"aseSubnetAddressRange\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/24\\\"\\n    },\\n    \\\"aseNSGName\\\": {\\n      \\\"value\\\": \\\"ase-NSG\\\"\\n    },\\n    \\\"aseRouteTableName\\\": {\\n      \\\"value\\\": \\\"ase-RouteTable\\\"\\n    },\\n    \\\"azureFirewallName\\\": {\\n      \\\"value\\\": \\\"azFirewall\\\"\\n    },\\n    \\\"deployAzureFirewall\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"azureFirewallRouteTableName\\\": {\\n      \\\"value\\\": \\\"azFirewall-RouteTable\\\"\\n    },\\n    \\\"azureFirewallSubnetAddressRange\\\": {\\n      \\\"value\\\": \\\"10.0.1.0/24\\\"\\n    },\\n    \\\"azureFirewallPublicIP\\\": {\\n      \\\"value\\\": \\\"AzFirewall-pip\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"aseSubnetServiceEndpoints\\\": {\\n      \\\"value\\\": \\\"[]\\\"\\n    },\\n    \\\"aseManagementIps\\\": {\\n      \\\"value\\\": \\\"[]\\\"\\n    },\\n    \\\"azureMonitorFQDNs\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specify the name of your Automation Account')\\nparam automationAccountName string\\n\\n@description('Default modules URI')\\nparam modulesUri string = 'https://devopsgallerystorage.blob.core.windows.net/packages/'\\n\\n@description('Specify the region for your automation account')\\n@allowed([\\n  'westeurope'\\n  'southeastasia'\\n  'eastus2'\\n  'southcentralus'\\n  'japaneast'\\n  'northeurope'\\n  'canadacentral'\\n  'australiasoutheast'\\n  'centralindia'\\n  'westcentralus'\\n  'usgovvirginia'\\n  'usgovtexas'\\n  'usgovarizona'\\n])\\nparam automationRegion string\\n\\n@description('URI to artifacts location')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar assets = {\\n  aaVariables: {\\n    AzureSubscriptionId: {\\n      name: 'AzureSubscriptionId'\\n      description: 'Azure subscription Id'\\n    }\\n  }\\n}\\nvar asrScripts = {\\n  runbooks: [\\n    {\\n      name: 'ASR-AddPublicIp'\\n      url: uri(_artifactsLocation, 'scripts/ASR-AddPublicIp.ps1${_artifactsLocationSasToken}')\\n      version: '1.0.0.0'\\n      type: 'PowerShell'\\n      description: 'ASR Runbook to enable public IP on every VM in a Recovery Plan'\\n    }\\n    {\\n      name: 'ASR-SQL-FailoverAG'\\n      url: uri(_artifactsLocation, 'scripts/ASR-SQL-FailoverAG.ps1${_artifactsLocationSasToken}')\\n      version: '1.0.0.0'\\n      type: 'PowerShellWorkflow'\\n      description: 'ASR Runbook to handle SQL Always On failover'\\n    }\\n    {\\n      name: 'ASR-AddSingleNSGPublicIp'\\n      url: uri(_artifactsLocation, 'scripts/ASR-AddSingleNSGPublicIp.ps1${_artifactsLocationSasToken}')\\n      version: '1.0.0.0'\\n      type: 'PowerShell'\\n      description: 'ASR Runbook to enable NSG and Public IP on every VM in a Recovery Plan'\\n    }\\n    {\\n      name: 'ASR-AddSingleLoadBalancer'\\n      url: uri(_artifactsLocation, 'scripts/ASR-AddSingleLoadBalancer.ps1${_artifactsLocationSasToken}')\\n      version: '1.0.0.0'\\n      type: 'PowerShell'\\n      description: 'ASR Runbook to enable a single Load Balancer for all the VMs in the recovery plan'\\n    }\\n    {\\n      name: 'ASR-AddMulitpleLoadBalancers'\\n      url: uri(_artifactsLocation, 'scripts/ASR-AddMultipleLoadBalancers.ps1${_artifactsLocationSasToken}')\\n      version: '1.0.0.0'\\n      type: 'PowerShell'\\n      description: 'ASR Runbook to enable multiple Load Balancers for selected VMs in the recovery plan'\\n    }\\n    {\\n      name: 'ASR-DNS-UpdateIP'\\n      url: uri(_artifactsLocation, 'scripts/ASR-DNS-UpdateIP.ps1${_artifactsLocationSasToken}')\\n      version: '1.0.0.0'\\n      type: 'PowerShellWorkflow'\\n      description: 'ASR Runbook to update DNS for VMs within the recovery plan'\\n    }\\n    {\\n      name: 'ASR-Wordpress-ChangeMysqlConfig'\\n      url: uri(_artifactsLocation, 'scripts/ASR-Wordpress-ChangeMysqlConfig.ps1${_artifactsLocationSasToken}')\\n      version: '1.0.0.0'\\n      type: 'PowerShellWorkflow'\\n      description: 'ASR Runbook to configure Mysql as part of a recovery plan'\\n    }\\n    {\\n      name: 'ASR-SQL-FailoverAGClassic'\\n      url: uri(_artifactsLocation, 'scripts/ASR-SQL-FailoverAGClassic.ps1${_artifactsLocationSasToken}')\\n      version: '1.0.0.0'\\n      type: 'PowerShellWorkflow'\\n      description: 'ASR Runbook to failover SQL Availability Groups'\\n    }\\n  ]\\n  modules: [\\n    {\\n      name: 'AzureRm.Compute'\\n      url: uri(modulesUri, 'azurerm.compute.2.8.0.nupkg')\\n    }\\n    {\\n      name: 'AzureRm.Resources'\\n      url: uri(modulesUri, 'azurerm.resources.3.7.0.nupkg')\\n    }\\n    {\\n      name: 'AzureRm.Network'\\n      url: uri(modulesUri, 'azurerm.network.3.6.0.nupkg')\\n    }\\n    {\\n      name: 'AzureRm.Automation'\\n      url: uri(modulesUri, 'azurerm.automation.1.0.3.nupkg')\\n    }\\n  ]\\n}\\nvar azureRmProfile = {\\n  name: 'AzureRm.Profile'\\n  url: uri(modulesUri, 'azurerm.profile.2.7.0.nupkg')\\n}\\n\\nresource automationAccount 'Microsoft.Automation/automationAccounts@2022-08-08' = {\\n  name: automationAccountName\\n  location: automationRegion\\n  properties: {\\n    sku: {\\n      name: 'Basic'\\n    }\\n  }\\n}\\n\\nresource automationAccountName_assets_aaVariables_AzureSubscriptionId_name 'Microsoft.Automation/automationAccounts/variables@2022-08-08' = {\\n  parent: automationAccount\\n  name: '${assets.aaVariables.AzureSubscriptionId.name}'\\n  properties: {\\n    description: assets.aaVariables.AzureSubscriptionId.description\\n    value: '\\\"${subscription().subscriptionId}\\\"'\\n  }\\n}\\n\\nresource automationAccountName_asrScripts_runbooks_0_asrScripts_runbooks 'Microsoft.Automation/automationAccounts/runbooks@2022-08-08' = [\\n  for i in range(0, length(range(0, length(asrScripts.runbooks)))): {\\n    name: '${automationAccountName}/${asrScripts.runbooks[range(0,length(asrScripts.runbooks))[i]].Name}'\\n    location: automationRegion\\n    properties: {\\n      description: asrScripts.runbooks[range(0, length(asrScripts.runbooks))[i]].description\\n      runbookType: asrScripts.runbooks[range(0, length(asrScripts.runbooks))[i]].type\\n      logProgress: false\\n      logVerbose: true\\n      publishContentLink: {\\n        uri: asrScripts.runbooks[range(0, length(asrScripts.runbooks))[i]].url\\n        version: asrScripts.runbooks[range(0, length(asrScripts.runbooks))[i]].version\\n      }\\n    }\\n    dependsOn: [\\n      automationAccount\\n    ]\\n  }\\n]\\n\\nresource automationAccountName_azureRmProfile_name 'Microsoft.Automation/automationAccounts/modules@2022-08-08' = {\\n  parent: automationAccount\\n  name: '${azureRmProfile.name}'\\n  location: automationRegion\\n  properties: {\\n    contentLink: {\\n      uri: azureRmProfile.url\\n    }\\n  }\\n}\\n\\nresource automationAccountName_asrScripts_modules_0_asrScripts_modules 'Microsoft.Automation/automationAccounts/modules@2022-08-08' = [\\n  for i in range(0, length(range(0, length(asrScripts.modules)))): {\\n    name: '${automationAccountName}/${asrScripts.modules[range(0,length(asrScripts.modules))[i]].Name}'\\n    location: automationRegion\\n    properties: {\\n      contentLink: {\\n        uri: asrScripts.modules[range(0, length(asrScripts.modules))[i]].url\\n      }\\n    }\\n    dependsOn: [\\n      automationAccount\\n      automationAccountName_azureRmProfile_name\\n    ]\\n  }\\n]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"automationAccountName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"modulesUri\\\": {\\n      \\\"value\\\": \\\"'https:\\\"\\n    },\\n    \\\"automationRegion\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Azure account SPN user name to authenticate inside controller VM.')\\nparam azureAccountUsername string\\n\\n@description('Azure account SPN password to authenticate inside controller VM.')\\n@secure()\\nparam azureAccountPassword string\\n\\n@description('Azure Subscription Tenant Id.')\\nparam tenantId string\\n\\n@description('Number of VMs to create.')\\nparam vmCount int = 2\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nvar imagePublisher = 'MicrosoftWindowsServer'\\nvar imageOffer = 'WindowsServer'\\nvar addressPrefix = '10.0.0.0/16'\\nvar location_var = location\\nvar subnetName = 'vsn${uniqueString(resourceGroup().id)}'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar storageAccountType = 'Standard_LRS'\\nvar publicIPAddressType = 'Dynamic'\\nvar publicIPAddressName = 'ip${uniqueString(resourceGroup().id)}'\\nvar uniqueDnsNameForPublicIP = 'dns${uniqueString(resourceGroup().id)}'\\nvar uniqueStorageAccountName = 'sa${uniqueString(resourceGroup().id)}'\\nvar uniqueStorageAccountContainerName = 'sc${uniqueString(resourceGroup().id)}'\\nvar adResourceID = 'null'\\nvar vmOsSku = '2012-R2-Datacenter'\\nvar vmAdminUsername = 'vmadministrator'\\nvar vmAdminPassword = 'pwd0a!8b7'\\nvar vmName = 'vm${uniqueString(resourceGroup().id)}'\\nvar vmOsDiskName = 'od${uniqueString(resourceGroup().id)}'\\nvar vmSize = 'Standard_A2'\\nvar vmNicName = 'nc${uniqueString(resourceGroup().id)}'\\nvar virtualNetworkName = 'vn${uniqueString(resourceGroup().id)}'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar nsgName = 'ng${uniqueString(resourceGroup().id)}'\\nvar nsgID = nsg.id\\nvar modulesPath = 'https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/demos/bootstorm-vm-boot-time/'\\nvar moduleVMBootAll = 'VMBootAll.zip'\\nvar modulesUrlVMBootAll = concat(modulesPath, moduleVMBootAll)\\nvar configurationFunctionVMBootAll = 'VMBootAll.ps1\\\\\\\\ConfigureVMBootAll'\\n\\nresource uniqueStorageAccount 'Microsoft.Storage/storageAccounts@2015-06-15' = {\\n  name: toLower(uniqueStorageAccountName)\\n  location: location_var\\n  properties: {\\n    accountType: storageAccountType\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2015-05-01-preview' = {\\n  name: publicIPAddressName\\n  location: location_var\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: uniqueDnsNameForPublicIP\\n    }\\n  }\\n}\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2015-05-01-preview' = {\\n  name: nsgName\\n  location: location_var\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'nsgsrule'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          destinationPortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 101\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2015-05-01-preview' = {\\n  name: virtualNetworkName\\n  location: location_var\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: nsgID\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vmNic 'Microsoft.Network/networkInterfaces@2015-05-01-preview' = {\\n  name: vmNicName\\n  location: location_var\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfigpublic'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource Microsoft_Network_networkInterfaces_vmNic 'Microsoft.Network/networkInterfaces@2015-05-01-preview' = [\\n  for i in range(0, vmCount): {\\n    name: concat(vmNicName, i)\\n    location: location_var\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfigprivate'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            subnet: {\\n              id: subnetRef\\n            }\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      virtualNetwork\\n    ]\\n  }\\n]\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2017-03-30' = {\\n  name: vmName\\n  location: location_var\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: vmAdminUsername\\n      adminPassword: vmAdminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: vmOsSku\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: vmNic.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: reference('Microsoft.Storage/storageAccounts/${uniqueStorageAccountName}', '2015-06-15').primaryEndpoints.blob\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    'Microsoft.Storage/storageAccounts/${uniqueStorageAccountName}'\\n  ]\\n}\\n\\nresource Microsoft_Compute_virtualMachines_vm 'Microsoft.Compute/virtualMachines@2017-03-30' = [\\n  for i in range(0, vmCount): {\\n    name: concat(vmName, i)\\n    location: location_var\\n    properties: {\\n      hardwareProfile: {\\n        vmSize: vmSize\\n      }\\n      osProfile: {\\n        computerName: vmName\\n        adminUsername: vmAdminUsername\\n        adminPassword: vmAdminPassword\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: imagePublisher\\n          offer: imageOffer\\n          sku: vmOsSku\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          name: '${vmName}${i}_OSDisk'\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n        }\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', concat(vmNicName, i))\\n          }\\n        ]\\n      }\\n      diagnosticsProfile: {\\n        bootDiagnostics: {\\n          enabled: true\\n          storageUri: reference('Microsoft.Storage/storageAccounts/${uniqueStorageAccountName}', '2015-06-15').primaryEndpoints.blob\\n        }\\n      }\\n    }\\n    dependsOn: [\\n      'Microsoft.Storage/storageAccounts/${uniqueStorageAccountName}'\\n      'Microsoft.Network/networkInterfaces/${vmNicName}${i}'\\n    ]\\n  }\\n]\\n\\nresource vmName_dscExtension 'Microsoft.Compute/virtualMachines/extensions@2015-06-15' = {\\n  parent: vm\\n  name: 'dscExtension'\\n  location: location_var\\n  properties: {\\n    publisher: 'Microsoft.Powershell'\\n    type: 'DSC'\\n    typeHandlerVersion: '2.15'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      modulesUrl: modulesUrlVMBootAll\\n      configurationFunction: configurationFunctionVMBootAll\\n      properties: {\\n        azureAccountUsername: azureAccountUsername\\n        azureAccountPassword: azureAccountPassword\\n        AdResourceID: adResourceID\\n        TenantId: tenantId\\n        VMName: vmName\\n        VMCount: vmCount\\n        VMAdminUserName: vmAdminUsername\\n        VMAdminPassword: vmAdminPassword\\n        AzureStorageAccount: uniqueStorageAccountName\\n        AzureStorageAccessKey: listKeys('Microsoft.Storage/storageAccounts/${uniqueStorageAccountName}', '2015-06-15').key1\\n      }\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"azureAccountUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"azureAccountPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"tenantId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmCount\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The HPC Pack cluster name. It must be unique in the location because it is also used as the public DNS name prefix for the cluster. For example, the public DNS name is \\\\'&lt;clustername&gt;.westus.cloudapp.azure.com\\\\' if the resource group location is \\\\'West US\\\\'. It must contain between 3 and 15 characters with lowercase letters and numbers, and must start with a letter.')\\n@minLength(3)\\n@maxLength(15)\\nparam clusterName string\\n\\n@description('The fully qualified domain name (FQDN) for the private domain forest which will be created by this template, for example \\\\'hpc.local\\\\'.')\\nparam privateDomainName string = 'hpc.local'\\n\\n@description('The VM size of the head node. Note that some VM sizes in the list are only available in some particular locations. Please check the availability and the price of the VM sizes at https://azure.microsoft.com/en-us/pricing/details/virtual-machines before deployment.')\\nparam headNodeVMSize string = 'Standard_D8s_v3'\\n\\n@description('The VM image of  the compute nodes')\\n@allowed([\\n  'ComputeNode'\\n  'ComputeNodeWithExcel'\\n])\\nparam computeNodeImage string = 'ComputeNode'\\n\\n@description('The name prefix of the compute nodes. It must be no more than 12 characters, begin with a letter, and contain only letters, numbers and hyphens. For example, if \\\\'IaaSCN-\\\\' is specified, the compute node names will be \\\\'IaaSCN-000\\\\', \\\\'IaaSCN-001\\\\', ...')\\n@minLength(1)\\n@maxLength(12)\\nparam computeNodeNamePrefix string = 'IaaSCN-'\\n\\n@description('The number of the compute nodes')\\n@minValue(1)\\n@maxValue(500)\\nparam computeNodeNumber int = 2\\n\\n@description('The VM size of the compute nodes. Note that some VM sizes in the list are only available in some particular locations. Please check the availability and the price of the VM sizes at https://azure.microsoft.com/en-us/pricing/details/virtual-machines before deployment.')\\nparam computeNodeVMSize string = 'Standard_D4s_v3'\\n\\n@description('Administrator user name for the virtual machines and the Active Directory domain.')\\nparam adminUsername string\\n\\n@description('Administrator password for the virtual machines and the Active Directory domain')\\n@secure()\\nparam adminPassword string\\n\\n@description('Optional URL of a public available PowerShell script you want to run on the head node after it is configured. The script will be run as the Local System account. You can also specify arguments for the script, for example \\\\'http://www.contoso.com/myhnpostscript.ps1 -Arg1 arg1 -Arg2 arg2\\\\'.')\\nparam headNodePostConfigScript string = ''\\n\\n@description('Optional URL of a public available PowerShell script you want to run on the compute nodes after they are configured. The script will be run as the Local System account. You can also specify arguments for the script, for example \\\\'http://www.contoso.com/mycnpostscript.ps1 -Arg1 arg1 -Arg2 arg2\\\\'.')\\nparam computeNodePostConfigScript string = ''\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The location of resources, such as templates and DSC modules, that the template depends on')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('Auto-generated token to access _artifactsLocation')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar virtualNetworkName = '${clusterName}VNet'\\nvar publicIPAddressName = '${clusterName}-PublicIP-HN'\\nvar computeNodeImageOsPlatform = 'Windows'\\nvar computeNodeImages = {\\n  ComputeNode: {\\n    publisher: 'MicrosoftWindowsServerHPCPack'\\n    offer: 'WindowsServerHPCPack'\\n    sku: '2012R2CN'\\n    version: 'latest'\\n  }\\n  ComputeNodeWithExcel: {\\n    publisher: 'MicrosoftWindowsServerHPCPack'\\n    offer: 'WindowsServerHPCPack'\\n    sku: '2012R2CNExcel'\\n    version: 'latest'\\n  }\\n}\\nvar currentComputeNodeImage = computeNodeImages[computeNodeImage]\\n\\nmodule mainTemplate '?' /*TODO: replace with correct path to [uri(parameters('_artifactsLocation'), concat('mainTemplate.json', parameters('_artifactsLocationSasToken')))]*/ = {\\n  name: 'mainTemplate'\\n  params: {\\n    clusterName: clusterName\\n    virtualNetworkName: virtualNetworkName\\n    privateDomainName: privateDomainName\\n    headNodeVMSize: headNodeVMSize\\n    headNodeDiskType: 'HDD'\\n    computeNodeImageOsPlatform: computeNodeImageOsPlatform\\n    computeNodeImagePublisher: currentComputeNodeImage.publisher\\n    computeNodeImageOffer: currentComputeNodeImage.offer\\n    computeNodeImageSku: currentComputeNodeImage.sku\\n    computeNodeNamePrefix: computeNodeNamePrefix\\n    computeNodeNumber: computeNodeNumber\\n    computeNodeDiskType: 'HDD'\\n    computeNodeVMSize: computeNodeVMSize\\n    publicIPName: publicIPAddressName\\n    publicIPRGName: resourceGroup().name\\n    publicIPNewOrExisting: 'new'\\n    publicIPDNSNameLabel: clusterName\\n    adminUsername: adminUsername\\n    adminPassword: adminPassword\\n    headNodePostConfigScript: trim(headNodePostConfigScript)\\n    computeNodePostConfigScript: trim(computeNodePostConfigScript)\\n    _artifactsLocation: _artifactsLocation\\n    _artifactsLocationSasToken: _artifactsLocationSasToken\\n    location: location\\n  }\\n}\\n\\noutput clusterDnsName string = mainTemplate.properties.outputs.clusterDNSName.value\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"clusterName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"privateDomainName\\\": {\\n      \\\"value\\\": \\\"hpc.local\\\"\\n    },\\n    \\\"headNodeVMSize\\\": {\\n      \\\"value\\\": \\\"Standard_D8s_v3\\\"\\n    },\\n    \\\"computeNodeImage\\\": {\\n      \\\"value\\\": \\\"ComputeNode\\\"\\n    },\\n    \\\"computeNodeNamePrefix\\\": {\\n      \\\"value\\\": \\\"IaaSCN-\\\"\\n    },\\n    \\\"computeNodeNumber\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"computeNodeVMSize\\\": {\\n      \\\"value\\\": \\\"Standard_D4s_v3\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"headNodePostConfigScript\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"computeNodePostConfigScript\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the DNS Zone to create or update.')\\nparam dnsZoneName string\\n\\n@description('Time to live value, in seconds')\\nparam ttl int = 3600\\n\\n@description('The base URI where artifacts required by this template are located.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('A delimited list that defines the resources to create, acceptable values are (mail,mdm, and sfb). A combination of all or just one of the values can be used.')\\nparam recordTypes array = [\\n  'mail'\\n  'mdm'\\n  'sfb'\\n]\\n\\nresource dnsZone 'Microsoft.Network/dnszones@2018-05-01' = {\\n  name: dnsZoneName\\n  location: 'global'\\n}\\n\\nmodule SettingUpDNSRecods_recordTypes '?' /*TODO: replace with correct path to [uri(parameters('_artifactsLocation'), concat(parameters('recordTypes')[copyIndex()],'.json',parameters('_artifactsLocationSasToken')))]*/ = [\\n  for item in recordTypes: {\\n    name: 'SettingUpDNSRecods-${item}'\\n    params: {\\n      dnsZoneName: dnsZoneName\\n      ttl: ttl\\n    }\\n    dependsOn: [\\n      dnsZone\\n    ]\\n  }\\n]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"dnsZoneName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"ttl\\\": {\\n      \\\"value\\\": 3600\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"recordTypes\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Username for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Password for the Virtual Machine.')\\n@secure()\\nparam adminPassword string\\n\\n@description('Unique DNS Name for the Public IP used to access the Virtual Machine.')\\nparam dnsNameForPublicIP string\\n\\n@description('Vitual machine\\\\'s unique name.')\\nparam vmName string = 'myVM'\\n\\n@description('Virtual machine size')\\nparam vmSize string = 'Standard_D2_v3'\\n\\n@description('The Windows version for the VM. This will pick a fully patched image of this given Windows version. Allowed values: 2008-R2-SP1, 2012-Datacenter, 2012-R2-Datacenter, Windows-Server-Technical-Preview.')\\n@allowed([\\n  '2008-R2-SP1'\\n  '2012-Datacenter'\\n  '2012-R2-Datacenter'\\n  'Windows-Server-Technical-Preview'\\n])\\nparam windowsOSVersion string = '2012-R2-Datacenter'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nvar imagePublisher = 'MicrosoftWindowsServer'\\nvar imageOffer = 'WindowsServer'\\nvar nicName = 'myVMNic'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'Subnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar diskStorageType = 'StandardSSD_LRS'\\nvar publicIPAddressName = 'myPublicIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar virtualNetworkName = 'MyVNET'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsNameForPublicIP\\n    }\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: windowsOSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n        managedDisk: {\\n          storageAccountType: diskStorageType\\n        }\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource vmName_fileSecurityExtension 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: vm\\n  name: 'fileSecurityExtension'\\n  location: location\\n  properties: {\\n    publisher: 'ESET'\\n    type: 'FileSecurity'\\n    typeHandlerVersion: '6.5'\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsNameForPublicIP\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"myVM\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    },\\n    \\\"windowsOSVersion\\\": {\\n      \\\"value\\\": \\\"2012-R2-Datacenter\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Prefix for the environment (2-5 characters)')\\nparam envPrefixName string = 'cust1'\\n\\n@description('SQL IaaS VM local administrator username')\\nparam username string\\n\\n@description('SQL IaaS VM local administrator password')\\n@secure()\\nparam password string\\n\\n@description('The size of the Web Server VMs Created')\\n@allowed([\\n  'Standard_D2s_v3'\\n])\\nparam webSrvVMSize string = 'Standard_D2s_v3'\\n\\n@description('Number of Web Servers')\\n@allowed([\\n  1\\n  2\\n])\\nparam numberOfWebSrvs int = 2\\n\\n@description('The size of the SQL VM Created')\\n@allowed([\\n  'Standard_D4s_v3'\\n])\\nparam sqlVMSize string = 'Standard_D4s_v3'\\n\\n@description('The type of the Storage Account created')\\n@allowed([\\n  'Standard_LRS'\\n  'StandardSSD_LRS'\\n  'Premium_LRS'\\n])\\nparam diskType string = 'Premium_LRS'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar virtualNetworkName = '${envPrefixName}Vnet'\\nvar addressPrefix = '10.0.0.0/16'\\nvar feSubnetPrefix = '10.0.0.0/24'\\nvar dbSubnetPrefix = '10.0.2.0/24'\\nvar feNSGName = 'feNsg'\\nvar dbNSGName = 'dbNsg'\\nvar sqlSrvDBName = '${envPrefixName}sqlSrv14'\\nvar sqlVmSize_var = sqlVMSize\\nvar sqlSrvDBNicName = '${sqlSrvDBName}Nic'\\nvar sqlPublicIPName = '${envPrefixName}SqlPip'\\nvar sqlImagePublisher = 'MicrosoftSQLServer'\\nvar sqlImageOffer = 'sql2022-ws2022'\\nvar sqlImageSku = 'standard-gen2'\\nvar webSrvName = '${envPrefixName}webSrv'\\nvar webSrvNicName = '${webSrvName}Nic'\\nvar webSrvPublicIPName = '${envPrefixName}websrvpip'\\nvar webSrvAvailabilitySetName = '${envPrefixName}webSrvAS'\\nvar webSrvNumbOfInstances = numberOfWebSrvs\\nvar webSrvDnsNameforLBIP = '${toLower(webSrvName)}lb'\\nvar webLbName = '${webSrvName}lb'\\nvar vmExtensionName = 'AzurePolicyforWindows'\\n\\nresource feNSG 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\\n  name: feNSGName\\n  location: location\\n  tags: {\\n    displayName: 'FrontEndNSG'\\n  }\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'web_rule'\\n        properties: {\\n          description: 'Allow WEB'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '80'\\n          sourceAddressPrefix: 'Internet'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 101\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource dbNSG 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\\n  name: dbNSGName\\n  location: location\\n  tags: {\\n    displayName: 'BackEndNSG'\\n  }\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'Allow_FE'\\n        properties: {\\n          description: 'Allow FE Subnet'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '1433'\\n          sourceAddressPrefix: '10.0.0.0/24'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'Block_FE'\\n        properties: {\\n          description: 'Block App Subnet'\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          destinationPortRange: '*'\\n          sourceAddressPrefix: '10.0.0.0/24'\\n          destinationAddressPrefix: '*'\\n          access: 'Deny'\\n          priority: 121\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'Block_Internet'\\n        properties: {\\n          description: 'Block Internet'\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          destinationPortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: 'Internet'\\n          access: 'Deny'\\n          priority: 200\\n          direction: 'Outbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2023-09-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  tags: {\\n    displayName: 'VirtualNetwork'\\n  }\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: 'FESubnetName'\\n        properties: {\\n          addressPrefix: feSubnetPrefix\\n          networkSecurityGroup: {\\n            id: feNSG.id\\n          }\\n        }\\n      }\\n      {\\n        name: 'DBSubnetName'\\n        properties: {\\n          addressPrefix: dbSubnetPrefix\\n          networkSecurityGroup: {\\n            id: dbNSG.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource sqlPublicIP 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\\n  name: sqlPublicIPName\\n  location: location\\n  tags: {\\n    displayName: 'SqlPIP'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n    idleTimeoutInMinutes: 4\\n  }\\n}\\n\\nresource sqlSrvDBNic 'Microsoft.Network/networkInterfaces@2023-09-01' = {\\n  name: sqlSrvDBNicName\\n  location: location\\n  tags: {\\n    displayName: 'SQLSrvDBNic'\\n  }\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, 'DBSubnetName')\\n          }\\n          publicIPAddress: {\\n            id: sqlPublicIP.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource envPrefixName_sqlSrv14 'Microsoft.Compute/virtualMachines@2023-09-01' = {\\n  name: '${envPrefixName}sqlSrv14'\\n  location: location\\n  tags: {\\n    displayName: 'SQL-Svr-DB'\\n  }\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: sqlVmSize_var\\n    }\\n    osProfile: {\\n      computerName: sqlSrvDBName\\n      adminUsername: username\\n      adminPassword: password\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: sqlImagePublisher\\n        offer: sqlImageOffer\\n        sku: sqlImageSku\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${sqlSrvDBName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n        managedDisk: {\\n          storageAccountType: diskType\\n        }\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: sqlSrvDBNic.id\\n        }\\n      ]\\n    }\\n  }\\n  dependsOn: [\\n    sqlPublicIP\\n  ]\\n}\\n\\nresource webSrvAvailabilitySet 'Microsoft.Compute/availabilitySets@2023-09-01' = {\\n  name: webSrvAvailabilitySetName\\n  location: location\\n  properties: {\\n    platformUpdateDomainCount: 20\\n    platformFaultDomainCount: 2\\n  }\\n  tags: {\\n    displayName: 'WebSrvAvailabilitySet'\\n  }\\n  sku: {\\n    name: 'Aligned'\\n  }\\n}\\n\\nresource webSrvPublicIP 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\\n  name: webSrvPublicIPName\\n  location: location\\n  tags: {\\n    displayName: 'WebSrvPIP for LB'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n    idleTimeoutInMinutes: 4\\n    dnsSettings: {\\n      domainNameLabel: webSrvDnsNameforLBIP\\n    }\\n  }\\n}\\n\\nresource webLb 'Microsoft.Network/loadBalancers@2023-09-01' = {\\n  name: webLbName\\n  location: location\\n  tags: {\\n    displayName: 'Web LB'\\n  }\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: 'LoadBalancerFrontEnd'\\n        properties: {\\n          publicIPAddress: {\\n            id: webSrvPublicIP.id\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: 'BackendPool1'\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        name: 'LBRule'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIPConfigurations',\\n              webLbName,\\n              'LoadBalancerFrontEnd'\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', webLbName, 'BackendPool1')\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 80\\n          backendPort: 80\\n          enableFloatingIP: false\\n          idleTimeoutInMinutes: 5\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', webLbName, 'tcpProbe')\\n          }\\n        }\\n      }\\n    ]\\n    probes: [\\n      {\\n        name: 'tcpProbe'\\n        properties: {\\n          protocol: 'Tcp'\\n          port: 80\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource webSrvNicName_0_webSrvNumbOfInstances 'Microsoft.Network/networkInterfaces@2023-09-01' = [\\n  for i in range(0, length(range(0, webSrvNumbOfInstances))): {\\n    name: '${webSrvNicName}${range(0,webSrvNumbOfInstances)[i]}'\\n    location: location\\n    tags: {\\n      displayName: 'WebSrvNic'\\n    }\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig1'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            subnet: {\\n              id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, 'FESubnetName')\\n            }\\n            loadBalancerBackendAddressPools: [\\n              {\\n                id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', webLbName, 'BackendPool1')\\n              }\\n            ]\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      virtualNetwork\\n      webLb\\n    ]\\n  }\\n]\\n\\nresource webSrvName_0_webSrvNumbOfInstances 'Microsoft.Compute/virtualMachines@2023-09-01' = [\\n  for i in range(0, length(range(0, webSrvNumbOfInstances))): {\\n    name: '${webSrvName}${range(0,webSrvNumbOfInstances)[i]}'\\n    location: location\\n    tags: {\\n      displayName: 'WebSrv'\\n    }\\n    identity: {\\n      type: 'SystemAssigned'\\n    }\\n    properties: {\\n      availabilitySet: {\\n        id: webSrvAvailabilitySet.id\\n      }\\n      hardwareProfile: {\\n        vmSize: webSrvVMSize\\n      }\\n      osProfile: {\\n        computerName: '${webSrvName}${range(0,webSrvNumbOfInstances)[i]}'\\n        adminUsername: username\\n        adminPassword: password\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: 'MicrosoftWindowsServer'\\n          offer: 'WindowsServer'\\n          sku: '2022-datacenter-azure-edition-core'\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          name: '${webSrvName}${range(0,webSrvNumbOfInstances)[i]}_OSDisk'\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n          managedDisk: {\\n            storageAccountType: diskType\\n          }\\n        }\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId(\\n              'Microsoft.Network/networkInterfaces',\\n              '${webSrvNicName}${range(0,webSrvNumbOfInstances)[range(0,webSrvNumbOfInstances)[i]]}'\\n            )\\n          }\\n        ]\\n      }\\n    }\\n    dependsOn: [\\n      webSrvAvailabilitySet\\n      resourceId(\\n        'Microsoft.Network/networkInterfaces',\\n        '${webSrvNicName}${range(0,webSrvNumbOfInstances)[range(0,webSrvNumbOfInstances)[i]]}'\\n      )\\n    ]\\n  }\\n]\\n\\nresource webSrvName_0_webSrvNumbOfInstances_0_webSrvNumbOfInstances_vmExtension 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = [\\n  for i in range(0, length(range(0, webSrvNumbOfInstances))): {\\n    name: '${webSrvName}${range(0,webSrvNumbOfInstances)[range(0,webSrvNumbOfInstances)[i]]}/${vmExtensionName}'\\n    location: location\\n    tags: {\\n      displayName: 'VM Extensions'\\n    }\\n    properties: {\\n      publisher: 'Microsoft.GuestConfiguration'\\n      type: 'ConfigurationforWindows'\\n      typeHandlerVersion: '1.0'\\n      autoUpgradeMinorVersion: true\\n      enableAutomaticUpgrade: true\\n    }\\n    dependsOn: [\\n      resourceId(\\n        'Microsoft.Compute/virtualMachines',\\n        '${webSrvName}${range(0,webSrvNumbOfInstances)[range(0,webSrvNumbOfInstances)[i]]}'\\n      )\\n    ]\\n  }\\n]\\n\\nresource webServerConfig 'Microsoft.GuestConfiguration/guestConfigurationAssignments@2022-01-25' = [\\n  for i in range(0, length(range(0, webSrvNumbOfInstances))): {\\n    scope: 'Microsoft.Compute/virtualMachines/${webSrvName}${range(0,webSrvNumbOfInstances)[range(0,webSrvNumbOfInstances)[i]]}'\\n    name: 'webServerConfig'\\n    location: location\\n    properties: {\\n      guestConfiguration: {\\n        name: 'WebServerConfig'\\n        version: '1.0.0'\\n        contentUri: uri(_artifactsLocation, 'scripts/WebServerConfig.zip?${_artifactsLocationSasToken}')\\n        contentHash: '018652dab6e4506ea3eb1370237cde8c692a8b9358942284a9ede13130303212'\\n        assignmentType: 'ApplyAndMonitor'\\n      }\\n    }\\n    dependsOn: [\\n      resourceId(\\n        'Microsoft.Compute/virtualMachines',\\n        '${webSrvName}${range(0,webSrvNumbOfInstances)[range(0,webSrvNumbOfInstances)[i]]}'\\n      )\\n    ]\\n  }\\n]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"envPrefixName\\\": {\\n      \\\"value\\\": \\\"cust1\\\"\\n    },\\n    \\\"username\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"password\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"webSrvVMSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"numberOfWebSrvs\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"sqlVMSize\\\": {\\n      \\\"value\\\": \\\"Standard_D4s_v3\\\"\\n    },\\n    \\\"diskType\\\": {\\n      \\\"value\\\": \\\"Premium_LRS\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the administrator of the new VM. Exclusion list: \\\\'admin\\\\',\\\\'administrator\\\\'')\\nparam adminUsername string\\n\\n@description('The password for the administrator account of the new VM')\\n@secure()\\nparam adminPassword string\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Size of VMs to deploy in VNET.')\\nparam vmSize string = 'Standard_A1'\\n\\nvar vnetv4AddressRange = '10.0.0.0/16'\\nvar vnetv6AddressRange = 'ace:cab:deca::/48'\\nvar subnetv4AddressRange = '10.0.0.0/24'\\nvar subnetv6AddressRange = 'ace:cab:deca:deed::/64'\\nvar subnetName = 'DualStackSubnet'\\nvar availabilitySetName = 'myavset'\\nvar numberOfInstances = 2\\nvar vmName = 'DsVM'\\nvar publicipName = 'RDPpublicIp'\\nvar imagePublisher = 'MicrosoftWindowsServer'\\nvar imageOffer = 'WindowsServer'\\nvar imageSku = '2019-Datacenter'\\n\\nresource publicip 'Microsoft.Network/publicIPAddresses@2020-07-01' = [\\n  for i in range(0, numberOfInstances): {\\n    name: concat(publicipName, i)\\n    location: location\\n    sku: {\\n      name: 'Standard'\\n    }\\n    properties: {\\n      publicIPAllocationMethod: 'Static'\\n    }\\n  }\\n]\\n\\nresource lbpublicip 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: 'lbpublicip'\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n  }\\n}\\n\\nresource lbpublicip_v6 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: 'lbpublicip-v6'\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n    publicIPAddressVersion: 'IPv6'\\n  }\\n}\\n\\nresource availabilitySet 'Microsoft.Compute/availabilitySets@2020-12-01' = {\\n  name: availabilitySetName\\n  location: location\\n  properties: {\\n    platformFaultDomainCount: 2\\n    platformUpdateDomainCount: 5\\n  }\\n  sku: {\\n    name: 'Aligned'\\n  }\\n}\\n\\nresource loadBalancer 'Microsoft.Network/loadBalancers@2020-07-01' = {\\n  name: 'loadBalancer'\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: 'LBFE'\\n        properties: {\\n          publicIPAddress: {\\n            id: lbpublicip.id\\n          }\\n        }\\n      }\\n      {\\n        name: 'LBFE-v6'\\n        properties: {\\n          publicIPAddress: {\\n            id: lbpublicip_v6.id\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: 'LBBAP'\\n      }\\n      {\\n        name: 'LBBAP-v6'\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIpConfigurations', 'loadBalancer', 'LBFE')\\n          }\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', 'loadBalancer', 'LBBAP')\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 80\\n          backendPort: 80\\n          idleTimeoutInMinutes: 15\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', 'loadBalancer', 'IPv4IPv6probe')\\n          }\\n        }\\n        name: 'lbrule'\\n      }\\n      {\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIpConfigurations', 'loadBalancer', 'LBFE-v6')\\n          }\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', 'loadBalancer', 'LBBAP-v6')\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 80\\n          backendPort: 80\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', 'loadBalancer', 'IPv4IPv6probe')\\n          }\\n        }\\n        name: 'lbrule-v6'\\n      }\\n    ]\\n    probes: [\\n      {\\n        name: 'IPv4IPv6probe'\\n        properties: {\\n          protocol: 'Tcp'\\n          port: 80\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource VNET 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: 'VNET'\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetv4AddressRange\\n        vnetv6AddressRange\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefixes: [\\n            subnetv4AddressRange\\n            subnetv6AddressRange\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource dsNsg 'Microsoft.Network/networkSecurityGroups@2020-07-01' = {\\n  name: 'dsNsg'\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'allow-HTTP-in'\\n        properties: {\\n          description: 'Allow HTTP'\\n          protocol: 'TCP'\\n          sourcePortRange: '80'\\n          destinationPortRange: '80'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 1001\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'allow-all-out'\\n        properties: {\\n          description: 'Allow out All'\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          destinationPortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 1002\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'allow-RDP-in'\\n        properties: {\\n          description: 'Allow RDP'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '3389'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 1003\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'allow-MyIpv6App-out'\\n        properties: {\\n          description: 'Allow My IPv6 App'\\n          protocol: 'Tcp'\\n          sourcePortRange: '33819-33829'\\n          destinationPortRange: '5000-6000'\\n          sourceAddressPrefix: 'ace:cab:deca:deed::/64'\\n          destinationAddressPrefixes: [\\n            'cab:cab:aaaa:bbbb::/64'\\n            'cab:cab:1111:2222::/64'\\n          ]\\n          access: 'Allow'\\n          priority: 1004\\n          direction: 'Outbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource v6routeTable 'Microsoft.Network/routeTables@2020-07-01' = {\\n  name: 'v6routeTable'\\n  location: location\\n  properties: {\\n    routes: [\\n      {\\n        name: 'v6route'\\n        properties: {\\n          addressPrefix: 'cab:cab::/96'\\n          nextHopType: 'VirtualAppliance'\\n          nextHopIpAddress: 'ace:cab:deca:f00d::1'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vm 'Microsoft.Network/networkInterfaces@2020-07-01' = [\\n  for i in range(0, numberOfInstances): {\\n    name: concat(vmName, i)\\n    location: location\\n    properties: {\\n      networkSecurityGroup: {\\n        id: dsNsg.id\\n      }\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig-v4'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            privateIPAddressVersion: 'IPv4'\\n            primary: true\\n            publicIPAddress: {\\n              id: resourceId('Microsoft.Network/publicIPAddresses', concat(publicipName, i))\\n            }\\n            subnet: {\\n              id: resourceId('Microsoft.Network/virtualNetworks/subnets', 'VNET', subnetName)\\n            }\\n            loadBalancerBackendAddressPools: [\\n              {\\n                id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', 'loadBalancer', 'LBBAP')\\n              }\\n            ]\\n          }\\n        }\\n        {\\n          name: 'ipconfig-v6'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            privateIPAddressVersion: 'IPv6'\\n            subnet: {\\n              id: resourceId('Microsoft.Network/virtualNetworks/subnets', 'VNET', subnetName)\\n            }\\n            loadBalancerBackendAddressPools: [\\n              {\\n                id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', 'loadBalancer', 'LBBAP-v6')\\n              }\\n            ]\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      VNET\\n      dsNsg\\n      loadBalancer\\n      publicip\\n    ]\\n  }\\n]\\n\\nresource Microsoft_Compute_virtualMachines_vm 'Microsoft.Compute/virtualMachines@2020-12-01' = [\\n  for i in range(0, numberOfInstances): {\\n    name: concat(vmName, i)\\n    location: location\\n    properties: {\\n      availabilitySet: {\\n        id: availabilitySet.id\\n      }\\n      hardwareProfile: {\\n        vmSize: vmSize\\n      }\\n      osProfile: {\\n        computerName: concat(vmName, i)\\n        adminUsername: adminUsername\\n        adminPassword: adminPassword\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: imagePublisher\\n          offer: imageOffer\\n          sku: imageSku\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          createOption: 'FromImage'\\n        }\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', concat(vmName, i))\\n          }\\n        ]\\n      }\\n    }\\n    dependsOn: [\\n      availabilitySet\\n      vm\\n    ]\\n  }\\n]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_A1\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Size of the VM that runs the test.')\\n@allowed([\\n  'Standard_A5'\\n  'Standard_A8'\\n  'Standard_D8_v3'\\n  'Standard_D16_v3'\\n  'Standard_D8s_v3'\\n  'Standard_D16s_v3'\\n  'Standard_D4_v3'\\n  'Standard_D32_v3'\\n  'Standard_D4s_v3'\\n  'Standard_D32s_v3'\\n])\\nparam vmSize string = 'Standard_D4_v3'\\n\\n@description('Data disk caching type for the test disk.')\\n@allowed([\\n  ''\\n  'ReadOnly'\\n  'ReadWrite'\\n])\\nparam dataDiskHostCaching string = 'ReadOnly'\\n\\n@description('Disk size in GB.')\\n@allowed([\\n  '128'\\n  '512'\\n  '1023'\\n])\\nparam diskSizeGB string = '1023'\\n\\n@description('Number of disks striped in RAID. Should not be greater than selected instance type allows.')\\n@minValue(1)\\n@maxValue(10)\\nparam disksInRAID int = 5\\n\\n@description('Disk test type to run. (rand: random, sequential otherwise; rw - read/write).')\\n@allowed([\\n  'read'\\n  'write'\\n  'randread'\\n  'randwrite'\\n  'randtrim'\\n  'rw'\\n  'readwrite'\\n  'randrw'\\n])\\nparam testType string = 'write'\\n\\n@description('Size of the file to test.')\\n@allowed([\\n  '32m'\\n  '64m'\\n  '128m'\\n  '256m'\\n  '512m'\\n  '1g'\\n  '2g'\\n  '10g'\\n  '30g'\\n])\\nparam testSize string = '1g'\\n\\n@description('Size of the block to test.')\\n@allowed([\\n  '4k'\\n  '8k'\\n  '16k'\\n  '32k'\\n  '64k'\\n  '128k'\\n  '256k'\\n])\\nparam testBlockSize string = '64k'\\n\\n@description('Number of seconds for the test to run.')\\nparam secondsToRunTest int = 30\\n\\n@description('Number of worker threads for the test to run.')\\n@minValue(1)\\n@maxValue(10)\\nparam threadsToRunTest int = 8\\n\\n@description('Username for the test VMs.')\\nparam adminUsername string\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\nvar osVersion = '14.04.5-LTS'\\nvar imagePublisher = 'Canonical'\\nvar imageOffer = 'UbuntuServer'\\nvar nicName = 'testVMNic'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'Subnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar storageAccountType = 'Standard_LRS'\\nvar publicIPAddressName = 'publicIP'\\nvar virtualNetworkName = 'testVNET'\\nvar scriptFolder = 'scripts'\\nvar storageAccountName = '${uniqueString(resourceGroup().id)}storage'\\nvar frontEndNSGName = 'webtestnsg-${uniqueString(resourceGroup().id)}'\\nvar vmName = 'testVM'\\nvar testScriptFileName = 'disktest.sh'\\nvar diskArray = [\\n  {\\n    diskSizeGB: diskSizeGB\\n    lun: 0\\n    caching: dataDiskHostCaching\\n    createOption: 'Empty'\\n  }\\n  {\\n    diskSizeGB: diskSizeGB\\n    lun: 1\\n    caching: dataDiskHostCaching\\n    createOption: 'Empty'\\n  }\\n  {\\n    diskSizeGB: diskSizeGB\\n    lun: 2\\n    caching: dataDiskHostCaching\\n    createOption: 'Empty'\\n  }\\n  {\\n    diskSizeGB: diskSizeGB\\n    lun: 3\\n    caching: dataDiskHostCaching\\n    createOption: 'Empty'\\n  }\\n  {\\n    diskSizeGB: diskSizeGB\\n    lun: 4\\n    caching: dataDiskHostCaching\\n    createOption: 'Empty'\\n  }\\n  {\\n    diskSizeGB: diskSizeGB\\n    lun: 5\\n    caching: dataDiskHostCaching\\n    createOption: 'Empty'\\n  }\\n  {\\n    diskSizeGB: diskSizeGB\\n    lun: 6\\n    caching: dataDiskHostCaching\\n    createOption: 'Empty'\\n  }\\n  {\\n    diskSizeGB: diskSizeGB\\n    lun: 7\\n    caching: dataDiskHostCaching\\n    createOption: 'Empty'\\n  }\\n  {\\n    diskSizeGB: diskSizeGB\\n    lun: 8\\n    caching: dataDiskHostCaching\\n    createOption: 'Empty'\\n  }\\n  {\\n    diskSizeGB: diskSizeGB\\n    lun: 9\\n    caching: dataDiskHostCaching\\n    createOption: 'Empty'\\n  }\\n]\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-01-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n  kind: 'Storage'\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2015-06-15' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2015-06-15' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2015-06-15' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource frontEndNSG 'Microsoft.Network/networkSecurityGroups@2015-06-15' = {\\n  name: frontEndNSGName\\n  location: location\\n  tags: {\\n    displayName: 'NSG'\\n  }\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'ssh-rule'\\n        properties: {\\n          description: 'Allow SSH'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '22'\\n          sourceAddressPrefix: 'Internet'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    publicIPAddress\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2016-04-30-preview' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: osVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n      dataDisks: take(diskArray, disksInRAID)\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: concat(reference(storageAccountName, '2021-01-01').primaryEndpoints.blob)\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    storageAccount\\n  ]\\n}\\n\\nresource vmName_CustomScriptExtension 'Microsoft.Compute/virtualMachines/extensions@2015-06-15' = {\\n  parent: vm\\n  name: 'CustomScriptExtension'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.OSTCExtensions'\\n    type: 'CustomScriptForLinux'\\n    typeHandlerVersion: '1.5'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        uri(_artifactsLocation, '${scriptFolder}/${testScriptFileName}${_artifactsLocationSasToken}')\\n      ]\\n      commandToExecute: 'sudo bash ${testScriptFileName} ${testSize} ${testType} ${secondsToRunTest} ${threadsToRunTest} ${testBlockSize} ${disksInRAID}'\\n    }\\n  }\\n}\\n\\noutput testresult string = trim(split(vmName_CustomScriptExtension.properties.instanceView.statuses[0].message, '\\\\n')[2])\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D4_v3\\\"\\n    },\\n    \\\"dataDiskHostCaching\\\": {\\n      \\\"value\\\": \\\"ReadOnly\\\"\\n    },\\n    \\\"diskSizeGB\\\": {\\n      \\\"value\\\": \\\"1023\\\"\\n    },\\n    \\\"disksInRAID\\\": {\\n      \\\"value\\\": 5\\n    },\\n    \\\"testType\\\": {\\n      \\\"value\\\": \\\"write\\\"\\n    },\\n    \\\"testSize\\\": {\\n      \\\"value\\\": \\\"1g\\\"\\n    },\\n    \\\"testBlockSize\\\": {\\n      \\\"value\\\": \\\"64k\\\"\\n    },\\n    \\\"secondsToRunTest\\\": {\\n      \\\"value\\\": 30\\n    },\\n    \\\"threadsToRunTest\\\": {\\n      \\\"value\\\": 8\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location for the resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Size of VMs in the VM Scale Set.')\\nparam vmSku string = 'Standard_A1'\\n\\n@description('The Windows version for the VM.')\\n@allowed([\\n  '2012-Datacenter'\\n  '2012-R2-Datacenter'\\n  '2016-Datacenter'\\n  '2016-Datacenter-Server-Core'\\n  '2016-Datacenter-with-Containers'\\n])\\nparam windowsOSVersion string = '2016-Datacenter'\\n\\n@description('String used as a base for naming resources. Must be 3-61 characters in length and globally unique across Azure.')\\n@minLength(3)\\n@maxLength(61)\\nparam vmssName string\\n\\n@description('Number of VM instances (1000 or less).')\\n@minValue(1)\\n@maxValue(1000)\\nparam instanceCount int = 2\\n\\n@description('Admin username.')\\nparam adminUsername string\\n\\n@description('Admin password.')\\n@secure()\\nparam adminPassword string\\n\\n@description('The minimum capacity.  Autoscale engine will ensure the instance count is at least this value.')\\n@minValue(1)\\n@maxValue(1000)\\nparam minimumCapacity int = 2\\n\\n@description('The maximum capacity.  Autoscale engine will ensure the instance count is not greater than this value.')\\n@minValue(1)\\n@maxValue(1000)\\nparam maximumCapacity int = 10\\n\\n@description('The default capacity.  Autoscale engine will preventively set the instance count to be this value if it can not find any metric data.')\\n@minValue(1)\\n@maxValue(1000)\\nparam defaultCapacity int = 10\\n\\n@description('The metric name.')\\nparam metricName string = 'Percentage CPU'\\n\\n@description('The metric upper threshold.  If the metric value is above this threshold then autoscale engine will initiate scale out action.')\\nparam metricThresholdToScaleOut int = 60\\n\\n@description('The metric lower threshold.  If the metric value is below this threshold then autoscale engine will initiate scale in action.')\\nparam metricThresholdToScaleIn int = 20\\n\\n@description('The percentage to increase the instance count when autoscale engine is initiating scale out action.')\\nparam changePercentScaleOut int = 20\\n\\n@description('The percentage to decrease the instance count when autoscale engine is initiating scale in action.')\\nparam changePercentScaleIn int = 10\\n\\n@description('A boolean to indicate whether the autoscale policy is enabled or disabled.')\\nparam autoscaleEnabled bool\\n\\nvar settingName = '${toLower(namingInfix_var)}-setting'\\nvar namingInfix_var = toLower(substring(concat(vmssName, uniqueString(resourceGroup().id)), 0, 9))\\nvar longNamingInfix = toLower(vmssName)\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar virtualNetworkName = '${namingInfix_var}vnet'\\nvar publicIPAddressName = '${namingInfix_var}pip'\\nvar subnetName = '${namingInfix_var}subnet'\\nvar loadBalancerName = '${namingInfix_var}lb'\\nvar natPoolName = '${namingInfix_var}natpool'\\nvar bePoolName = '${namingInfix_var}bepool'\\nvar natStartPort = 50000\\nvar natEndPort = 50119\\nvar natBackendPort = 3389\\nvar nicName = '${namingInfix_var}nic'\\nvar ipConfigName = '${namingInfix_var}ipconfig'\\nvar frontEndIPConfigID = resourceId(\\n  'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n  loadBalancerName,\\n  'loadBalancerFrontEnd'\\n)\\nvar osType = {\\n  publisher: 'MicrosoftWindowsServer'\\n  offer: 'WindowsServer'\\n  sku: windowsOSVersion\\n  version: 'latest'\\n}\\nvar imageReference = osType\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-11-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-11-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n    dnsSettings: {\\n      domainNameLabel: longNamingInfix\\n    }\\n  }\\n}\\n\\nresource loadBalancer 'Microsoft.Network/loadBalancers@2020-11-01' = {\\n  name: loadBalancerName\\n  location: location\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: 'LoadBalancerFrontEnd'\\n        properties: {\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: bePoolName\\n      }\\n    ]\\n    inboundNatPools: [\\n      {\\n        name: natPoolName\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: frontEndIPConfigID\\n          }\\n          protocol: 'Tcp'\\n          frontendPortRangeStart: natStartPort\\n          frontendPortRangeEnd: natEndPort\\n          backendPort: natBackendPort\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource namingInfix 'Microsoft.Compute/virtualMachineScaleSets@2020-12-01' = {\\n  name: namingInfix_var\\n  location: location\\n  sku: {\\n    name: vmSku\\n    tier: 'Standard'\\n    capacity: instanceCount\\n  }\\n  properties: {\\n    overprovision: true\\n    upgradePolicy: {\\n      mode: 'Manual'\\n    }\\n    virtualMachineProfile: {\\n      storageProfile: {\\n        osDisk: {\\n          createOption: 'FromImage'\\n          caching: 'ReadWrite'\\n        }\\n        imageReference: imageReference\\n      }\\n      osProfile: {\\n        computerNamePrefix: namingInfix_var\\n        adminUsername: adminUsername\\n        adminPassword: adminPassword\\n      }\\n      networkProfile: {\\n        networkInterfaceConfigurations: [\\n          {\\n            name: nicName\\n            properties: {\\n              primary: true\\n              ipConfigurations: [\\n                {\\n                  name: ipConfigName\\n                  properties: {\\n                    subnet: {\\n                      id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\n                    }\\n                    loadBalancerBackendAddressPools: [\\n                      {\\n                        id: resourceId(\\n                          'Microsoft.Network/loadBalancers/backendAddressPools',\\n                          loadBalancerName,\\n                          bePoolName\\n                        )\\n                      }\\n                    ]\\n                    loadBalancerInboundNatPools: [\\n                      {\\n                        id: resourceId('Microsoft.Network/loadBalancers/inboundNatPools', loadBalancerName, natPoolName)\\n                      }\\n                    ]\\n                  }\\n                }\\n              ]\\n            }\\n          }\\n        ]\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    loadBalancer\\n    virtualNetwork\\n  ]\\n}\\n\\nresource setting 'Microsoft.Insights/autoscalesettings@2015-04-01' = {\\n  name: settingName\\n  location: location\\n  properties: {\\n    profiles: [\\n      {\\n        name: 'DefaultAutoscaleProfile'\\n        capacity: {\\n          minimum: minimumCapacity\\n          maximum: maximumCapacity\\n          default: defaultCapacity\\n        }\\n        rules: [\\n          {\\n            metricTrigger: {\\n              metricName: metricName\\n              metricResourceUri: namingInfix.id\\n              timeGrain: 'PT5M'\\n              statistic: 'Average'\\n              timeWindow: 'PT10M'\\n              timeAggregation: 'Average'\\n              operator: 'GreaterThan'\\n              threshold: metricThresholdToScaleOut\\n            }\\n            scaleAction: {\\n              direction: 'Increase'\\n              type: 'PercentChangeCount'\\n              value: changePercentScaleOut\\n              cooldown: 'PT10M'\\n            }\\n          }\\n          {\\n            metricTrigger: {\\n              metricName: metricName\\n              metricResourceUri: namingInfix.id\\n              timeGrain: 'PT5M'\\n              statistic: 'Average'\\n              timeWindow: 'PT10M'\\n              timeAggregation: 'Average'\\n              operator: 'LessThan'\\n              threshold: metricThresholdToScaleIn\\n            }\\n            scaleAction: {\\n              direction: 'Decrease'\\n              type: 'PercentChangeCount'\\n              value: changePercentScaleIn\\n              cooldown: 'PT10M'\\n            }\\n          }\\n        ]\\n      }\\n    ]\\n    enabled: autoscaleEnabled\\n    targetResourceUri: namingInfix.id\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vmSku\\\": {\\n      \\\"value\\\": \\\"Standard_A1\\\"\\n    },\\n    \\\"windowsOSVersion\\\": {\\n      \\\"value\\\": \\\"2016-Datacenter\\\"\\n    },\\n    \\\"vmssName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"instanceCount\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"minimumCapacity\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"maximumCapacity\\\": {\\n      \\\"value\\\": 10\\n    },\\n    \\\"defaultCapacity\\\": {\\n      \\\"value\\\": 10\\n    },\\n    \\\"metricName\\\": {\\n      \\\"value\\\": \\\"Percentage CPU\\\"\\n    },\\n    \\\"metricThresholdToScaleOut\\\": {\\n      \\\"value\\\": 60\\n    },\\n    \\\"metricThresholdToScaleIn\\\": {\\n      \\\"value\\\": 20\\n    },\\n    \\\"changePercentScaleOut\\\": {\\n      \\\"value\\\": 20\\n    },\\n    \\\"changePercentScaleIn\\\": {\\n      \\\"value\\\": 10\\n    },\\n    \\\"autoscaleEnabled\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param nicName string\\nparam location string\\nparam subnetId string\\nparam pipId string = ''\\n\\n@allowed([\\n  'Dynamic'\\n  'Static'\\n])\\nparam ipAllocationMethod string = 'Dynamic'\\nparam staticIpAddress string = ''\\nparam enableIPForwarding bool = false\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-06-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig'\\n        properties: {\\n          primary: true\\n          privateIPAllocationMethod: ipAllocationMethod\\n          privateIPAddress: staticIpAddress\\n          subnet: {\\n            id: subnetId\\n          }\\n          publicIPAddress: ((pipId == '')\\n            ? null\\n            : {\\n                id: pipId\\n              })\\n        }\\n      }\\n    ]\\n    enableIPForwarding: enableIPForwarding\\n  }\\n}\\n\\noutput nicId string = nic.id\\noutput assignedIp string = reference(nic.id, '2020-06-01').ipConfigurations[0].properties.privateIPAddress\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"nicName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"pipId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"ipAllocationMethod\\\": {\\n      \\\"value\\\": \\\"Dynamic\\\"\\n    },\\n    \\\"staticIpAddress\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"enableIPForwarding\\\": {\\n      \\\"value\\\": false\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param udrName string\\nparam location string\\nparam addressPrefix string = ''\\nparam nextHopAddress string = ''\\n\\nresource udr 'Microsoft.Network/routeTables@2020-06-01' = {\\n  name: udrName\\n  location: location\\n  properties: {\\n    // conditionally deploy route\\n    routes: any(addressPrefix == '' ? null : [\\n      {\\n        name: 'Nested-VMs'\\n        properties: {\\n          addressPrefix: addressPrefix\\n          nextHopType: 'VirtualAppliance'\\n          nextHopIpAddress: nextHopAddress\\n        }\\n      }\\n    ])\\n  }\\n}\\n\\noutput udrId string = udr.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"udrName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"addressPrefix\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"nextHopAddress\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('workspace id.')\\nparam workspaceName string\\n\\n@description('User name for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('DNS Label for the Public IP. Must be lowercase. It should match with the following regular expression: ^[a-z][a-z0-9-]{1,61}[a-z0-9]$ or it will raise an error.')\\nparam dnsLabelPrefix string\\n\\n@description('The Ubuntu version for the VM. This will pick a fully patched image of this given Ubuntu version.')\\nparam ubuntuOSVersion string\\n\\n@description('The size of the VM.')\\nparam vmSize string\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The name of the NSG.')\\nparam nsgName string\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\nvar storageAccountName = '${uniqueString(resourceGroup().id)}standardsa'\\nvar imagePublisher = 'Canonical'\\nvar imageOffer = 'UbuntuServer'\\nvar nicName = 'myVMNic'\\nvar addressPrefix = '10.0.0.0/16'\\nvar nsgName_var = nsgName\\nvar subnetName = 'Subnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar storageAccountType = 'Standard_LRS'\\nvar publicIPAddressName = 'myPublicIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar vmName = 'MyUbuntuVM'\\nvar virtualNetworkName = 'MyVNET'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-02-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsLabelPrefix\\n    }\\n  }\\n}\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2020-11-01' = {\\n  name: nsgName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'AllowInternet'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          destinationPortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: 'Internet'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Outbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: nsg.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    resourceId('Microsoft.Network/networkSecurityGroups', nsgName_var)\\n  ]\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: ubuntuOSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: 'http://${storageAccountName}.blob.${environment().suffixes.storage}'\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    storageAccount\\n  ]\\n}\\n\\nresource vmName_OMSExtension 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: vm\\n  name: 'OMSExtension'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.EnterpriseCloud.Monitoring'\\n    type: 'OmsAgentForLinux'\\n    typeHandlerVersion: '1.10'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      workspaceId: reference(resourceId('Microsoft.OperationalInsights/workspaces/', workspaceName), '2020-08-01').customerId\\n    }\\n    protectedSettings: {\\n      workspaceKey: listKeys(resourceId('Microsoft.OperationalInsights/workspaces/', workspaceName), '2020-08-01').primarySharedKey\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"workspaceName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsLabelPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"ubuntuOSVersion\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"nsgName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies the location of AKS cluster.')\\nparam location string = resourceGroup().location\\n\\n@description('Specifies the name of the AKS cluster.')\\nparam aksClusterName string = 'aks-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specifies the DNS prefix specified when creating the managed cluster.')\\nparam aksClusterDnsPrefix string = aksClusterName\\n\\n@description('Specifies the tags of the AKS cluster.')\\nparam aksClusterTags object = {\\n  resourceType: 'AKS Cluster'\\n  createdBy: 'ARM Template'\\n}\\n\\n@allowed([\\n  'azure'\\n  'kubenet'\\n])\\n@description('Specifies the network plugin used for building Kubernetes network. - azure or kubenet.')\\nparam aksClusterNetworkPlugin string = 'azure'\\n\\n@allowed([\\n  'azure'\\n  'calico'\\n])\\n@description('Specifies the network policy used for building Kubernetes network. - calico or azure')\\nparam aksClusterNetworkPolicy string = 'azure'\\n\\n@description('Specifies the CIDR notation IP range from which to assign pod IPs when kubenet is used.')\\nparam aksClusterPodCidr string = '10.244.0.0/16'\\n\\n@description('A CIDR notation IP range from which to assign service cluster IPs. It must not overlap with any Subnet IP ranges.')\\nparam aksClusterServiceCidr string = '10.2.0.0/16'\\n\\n@description('Specifies the IP address assigned to the Kubernetes DNS service. It must be within the Kubernetes service address range specified in serviceCidr.')\\nparam aksClusterDnsServiceIP string = '10.2.0.10'\\n\\n@description('Specifies the CIDR notation IP range assigned to the Docker bridge network. It must not overlap with any Subnet IP ranges or the Kubernetes service address range.')\\nparam aksClusterDockerBridgeCidr string = '172.17.0.1/16'\\n\\n@allowed([\\n  'basic'\\n  'standard'\\n])\\n@description('Specifies the sku of the load balancer used by the virtual machine scale sets used by nodepools.')\\nparam aksClusterLoadBalancerSku string = 'standard'\\n\\n@allowed([\\n  'Paid'\\n  'Free'\\n])\\n@description('Specifies the tier of a managed cluster SKU: Paid or Free')\\nparam aksClusterSkuTier string = 'Paid'\\n\\n@description('Specifies the version of Kubernetes specified when creating the managed cluster.')\\nparam aksClusterKubernetesVersion string = '1.19.7'\\n\\n@description('Specifies the administrator username of Linux virtual machines.')\\nparam aksClusterAdminUsername string\\n\\n@description('Specifies the SSH RSA public key string for the Linux nodes.')\\nparam aksClusterSshPublicKey string\\n\\n@description('Specifies whether enabling AAD integration.')\\nparam aadEnabled bool = false\\n\\n@description('Specifies the tenant id of the Azure Active Directory used by the AKS cluster for authentication.')\\nparam aadProfileTenantId string = subscription().tenantId\\n\\n@description('Specifies the AAD group object IDs that will have admin role of the cluster.')\\nparam aadProfileAdminGroupObjectIDs array = []\\n\\n@description('Specifies whether to create the cluster as a private cluster or not.')\\nparam aksClusterEnablePrivateCluster bool = true\\n\\n@description('Specifies whether to enable managed AAD integration.')\\nparam aadProfileManaged bool = false\\n\\n@description('Specifies whether to  to enable Azure RBAC for Kubernetes authorization.')\\nparam aadProfileEnableAzureRBAC bool = false\\n\\n@description('Specifies the unique name of the node pool profile in the context of the subscription and resource group.')\\nparam nodePoolName string = 'nodepool1'\\n\\n@description('Specifies the vm size of nodes in the node pool.')\\nparam nodePoolVmSize string = 'Standard_DS3_v2'\\n\\n@description('Specifies the OS Disk Size in GB to be used to specify the disk size for every machine in this master/agent pool. If you specify 0, it will apply the default osDisk size according to the vmSize specified..')\\nparam nodePoolOsDiskSizeGB int = 100\\n\\n@description('Specifies the number of agents (VMs) to host docker containers. Allowed values must be in the range of 1 to 100 (inclusive). The default value is 1.')\\nparam nodePoolCount int = 3\\n\\n@allowed([\\n  'Linux'\\n  'Windows'\\n])\\n@description('Specifies the OS type for the vms in the node pool. Choose from Linux and Windows. Default to Linux.')\\nparam nodePoolOsType string = 'Linux'\\n\\n@description('Specifies the maximum number of pods that can run on a node. The maximum number of pods per node in an AKS cluster is 250. The default maximum number of pods per node varies between kubenet and Azure CNI networking, and the method of cluster deployment.')\\nparam nodePoolMaxPods int = 30\\n\\n@description('Specifies the maximum number of nodes for auto-scaling for the node pool.')\\nparam nodePoolMaxCount int = 5\\n\\n@description('Specifies the minimum number of nodes for auto-scaling for the node pool.')\\nparam nodePoolMinCount int = 3\\n\\n@description('Specifies whether to enable auto-scaling for the node pool.')\\nparam nodePoolEnableAutoScaling bool = true\\n\\n@allowed([\\n  'Spot'\\n  'Regular'\\n])\\n@description('Specifies the virtual machine scale set priority: Spot or Regular.')\\nparam nodePoolScaleSetPriority string = 'Regular'\\n\\n@description('Specifies the Agent pool node labels to be persisted across all nodes in agent pool.')\\nparam nodePoolNodeLabels object = {}\\n\\n@description('Specifies the taints added to new nodes during node pool create and scale. For example, key=value:NoSchedule. - string')\\nparam nodePoolNodeTaints array = []\\n\\n@allowed([\\n  'System'\\n  'User'\\n])\\n@description('Specifies the mode of an agent pool: System or User')\\nparam nodePoolMode string = 'System'\\n\\n@allowed([\\n  'VirtualMachineScaleSets'\\n  'AvailabilitySet'\\n])\\n@description('Specifies the type of a node pool: VirtualMachineScaleSets or AvailabilitySet')\\nparam nodePoolType string = 'VirtualMachineScaleSets'\\n\\n@description('Specifies the availability zones for nodes. Requirese the use of VirtualMachineScaleSets as node pool type.')\\nparam nodePoolAvailabilityZones array = []\\n\\n@description('Specifies the id of the virtual network.')\\nparam virtualNetworkId string\\n\\n@description('Specifies the name of the default subnet hosting the AKS cluster.')\\nparam aksSubnetName string = 'AksSubnet'\\n\\n@description('Specifies the name of the Log Analytics Workspace.')\\nparam logAnalyticsWorkspaceId string\\n\\nvar aadProfileConfiguration = {\\n  managed: aadProfileManaged\\n  enableAzureRBAC: aadProfileEnableAzureRBAC\\n  adminGroupObjectIDs: aadProfileAdminGroupObjectIDs\\n  tenantID: aadProfileTenantId\\n}\\n\\nvar virtualNetworkName = last(split(virtualNetworkId, '/'))\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-08-01' existing = {\\n  name: virtualNetworkName\\n}\\n\\nresource aksSubnet 'Microsoft.Network/virtualNetworks/subnets@2020-08-01' existing = {\\n  parent: virtualNetwork\\n  name: aksSubnetName\\n}\\n\\nresource aksCluster 'Microsoft.ContainerService/managedClusters@2021-02-01' = {\\n  name: aksClusterName\\n  location: location\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  tags: aksClusterTags\\n  sku: {\\n    name: 'Basic'\\n    tier: aksClusterSkuTier\\n  }\\n  properties: {\\n    kubernetesVersion: aksClusterKubernetesVersion\\n    dnsPrefix: aksClusterDnsPrefix\\n    //TODO nodeResourceGroup: ''\\n    agentPoolProfiles: [\\n      {\\n        name: toLower(nodePoolName)\\n        count: nodePoolCount\\n        vmSize: nodePoolVmSize\\n        osDiskSizeGB: nodePoolOsDiskSizeGB\\n        vnetSubnetID: aksSubnet.id\\n        maxPods: nodePoolMaxPods\\n        osType: nodePoolOsType\\n        maxCount: nodePoolMaxCount\\n        minCount: nodePoolMinCount\\n        scaleSetPriority: nodePoolScaleSetPriority\\n        enableAutoScaling: nodePoolEnableAutoScaling\\n        mode: nodePoolMode\\n        type: nodePoolType\\n        availabilityZones: any(empty(nodePoolAvailabilityZones) ? null : nodePoolAvailabilityZones)\\n        nodeLabels: nodePoolNodeLabels\\n        nodeTaints: nodePoolNodeTaints\\n      }\\n    ]\\n    linuxProfile: {\\n      adminUsername: aksClusterAdminUsername\\n      ssh: {\\n        publicKeys: [\\n          {\\n            keyData: aksClusterSshPublicKey\\n          }\\n        ]\\n      }\\n    }\\n    addonProfiles: {\\n      omsagent: {\\n        enabled: true\\n        config: {\\n          logAnalyticsWorkspaceResourceID: logAnalyticsWorkspaceId\\n        }\\n      }\\n    }\\n    enableRBAC: true\\n    networkProfile: {\\n      networkPlugin: aksClusterNetworkPlugin\\n      networkPolicy: aksClusterNetworkPolicy\\n      podCidr: aksClusterPodCidr\\n      serviceCidr: aksClusterServiceCidr\\n      dnsServiceIP: aksClusterDnsServiceIP\\n      dockerBridgeCidr: aksClusterDockerBridgeCidr\\n      loadBalancerSku: aksClusterLoadBalancerSku\\n    }\\n    aadProfile: (aadEnabled ? aadProfileConfiguration : null)\\n    apiServerAccessProfile: {\\n      enablePrivateCluster: aksClusterEnablePrivateCluster\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"aksClusterName\\\": {\\n      \\\"value\\\": \\\"aks-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"aksClusterDnsPrefix\\\": {\\n      \\\"value\\\": \\\"aksClusterName\\\"\\n    },\\n    \\\"aksClusterTags\\\": {\\n      \\\"value\\\": \\\"{\\\"\\n    },\\n    \\\"aksClusterNetworkPlugin\\\": {\\n      \\\"value\\\": \\\"azure\\\"\\n    },\\n    \\\"aksClusterNetworkPolicy\\\": {\\n      \\\"value\\\": \\\"azure\\\"\\n    },\\n    \\\"aksClusterPodCidr\\\": {\\n      \\\"value\\\": \\\"10.244.0.0/16\\\"\\n    },\\n    \\\"aksClusterServiceCidr\\\": {\\n      \\\"value\\\": \\\"10.2.0.0/16\\\"\\n    },\\n    \\\"aksClusterDnsServiceIP\\\": {\\n      \\\"value\\\": \\\"10.2.0.10\\\"\\n    },\\n    \\\"aksClusterDockerBridgeCidr\\\": {\\n      \\\"value\\\": \\\"172.17.0.1/16\\\"\\n    },\\n    \\\"aksClusterLoadBalancerSku\\\": {\\n      \\\"value\\\": \\\"standard\\\"\\n    },\\n    \\\"aksClusterSkuTier\\\": {\\n      \\\"value\\\": \\\"Paid\\\"\\n    },\\n    \\\"aksClusterKubernetesVersion\\\": {\\n      \\\"value\\\": \\\"1.19.7\\\"\\n    },\\n    \\\"aksClusterAdminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aksClusterSshPublicKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aadEnabled\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"aadProfileTenantId\\\": {\\n      \\\"value\\\": \\\"subscription().tenantId\\\"\\n    },\\n    \\\"aadProfileAdminGroupObjectIDs\\\": {\\n      \\\"value\\\": \\\"[]\\\"\\n    },\\n    \\\"aksClusterEnablePrivateCluster\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"aadProfileManaged\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"aadProfileEnableAzureRBAC\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"nodePoolName\\\": {\\n      \\\"value\\\": \\\"nodepool1\\\"\\n    },\\n    \\\"nodePoolVmSize\\\": {\\n      \\\"value\\\": \\\"Standard_DS3_v2\\\"\\n    },\\n    \\\"nodePoolOsDiskSizeGB\\\": {\\n      \\\"value\\\": 100\\n    },\\n    \\\"nodePoolCount\\\": {\\n      \\\"value\\\": 3\\n    },\\n    \\\"nodePoolOsType\\\": {\\n      \\\"value\\\": \\\"Linux\\\"\\n    },\\n    \\\"nodePoolMaxPods\\\": {\\n      \\\"value\\\": 30\\n    },\\n    \\\"nodePoolMaxCount\\\": {\\n      \\\"value\\\": 5\\n    },\\n    \\\"nodePoolMinCount\\\": {\\n      \\\"value\\\": 3\\n    },\\n    \\\"nodePoolEnableAutoScaling\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"nodePoolScaleSetPriority\\\": {\\n      \\\"value\\\": \\\"Regular\\\"\\n    },\\n    \\\"nodePoolNodeLabels\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"nodePoolNodeTaints\\\": {\\n      \\\"value\\\": \\\"[]\\\"\\n    },\\n    \\\"nodePoolMode\\\": {\\n      \\\"value\\\": \\\"System\\\"\\n    },\\n    \\\"nodePoolType\\\": {\\n      \\\"value\\\": \\\"VirtualMachineScaleSets\\\"\\n    },\\n    \\\"nodePoolAvailabilityZones\\\": {\\n      \\\"value\\\": \\\"[]\\\"\\n    },\\n    \\\"virtualNetworkId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aksSubnetName\\\": {\\n      \\\"value\\\": \\\"AksSubnet\\\"\\n    },\\n    \\\"logAnalyticsWorkspaceId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies the location of AKS cluster.')\\nparam location string = resourceGroup().location\\n\\n@description('Specifies the name of the Azure Bastion resource.')\\nparam bastionHostName string\\n\\n@description('Specifies the id of the Azure Bastion subnet resource id.')\\nparam bastionSubnetId string\\n\\nvar bastionPublicIpAddressName = '${bastionHostName}PublicIp'\\n\\nresource bastionPublicIpAddress 'Microsoft.Network/publicIPAddresses@2020-08-01' = {\\n  name: bastionPublicIpAddressName\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n  }\\n}\\n\\nresource bastionHost 'Microsoft.Network/bastionHosts@2020-08-01' = {\\n  name: bastionHostName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'IpConf'\\n        properties: {\\n          subnet: {\\n            id: bastionSubnetId\\n          }\\n          publicIPAddress: {\\n            id: bastionPublicIpAddress.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"bastionHostName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"bastionSubnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Define the project name or prefix for all objects.')\\n@minLength(1)\\n@maxLength(5)\\nparam projectName string\\n\\n@description('What is the username for the admin on VMs and SQL Server?')\\nparam adminUser string\\n\\n@description('What is the password for the admin on VMs and SQL Server?')\\n@secure()\\nparam adminPasswd string\\n\\n@description('The location for resources on template. By default, the same as resource group location')\\nparam location string = resourceGroup().location\\n\\n@description('TimeZone ID to be used on VMs. Get available timezones with powershell Get-TimeZone command.')\\nparam timeZoneID string = 'UTC'\\n\\n@description('External public DNS domain zone. NOT AD domain. This the external domain your certs will point to.')\\nparam externalDnsZone string = 'contosocorp.com'\\n\\n@description('This will trigger certificate request and HA deployment. If set to false, will not create HA deployment nor request certificates.')\\nparam deployHA bool = false\\n\\n@description('How many Domain Controllers would you like to deploy?')\\nparam dcCount int = 1\\n\\n@description('How many RD Connection Brokers would you like to deploy?')\\nparam rdcbCount int = 1\\n\\n@description('How many RD Web Access/Gateways would you like to deploy?')\\nparam rdwgCount int = 1\\n\\n@description('How many RD Session Hosts would you like to deploy?')\\nparam rdshCount int = 1\\n\\n@description('How many License/File Servers would you like to deploy?')\\nparam lsfsCount int = 1\\n\\n@description('What is the VM size for all VMs?')\\n@allowed([\\n  'Standard_A2_v2'\\n  'Standard_A4_v2'\\n  'Standard_A8_v2'\\n  'Standard_D2_v3'\\n  'Standard_D2_v3'\\n  'Standard_D4_v3'\\n  'Standard_D2_v3'\\n  'Standard_D4_v3'\\n  'Standard_D2s_v3'\\n  'Standard_D2s_v3'\\n])\\nparam vmSize string = 'Standard_A2_v2'\\n\\n@description('Create Azure Spot VMs?')\\nparam vmSpot bool = true\\n\\n@description('What is the SKU for the storage to VM managed disks?')\\n@allowed([\\n  'StandardSSD_LRS'\\n  'Standard_LRS'\\n])\\nparam vmStorageSkuType string = 'Standard_LRS'\\n\\n@description('What is the new forest/root Active Directory domain name?')\\nparam adDomainName string = 'contoso.com'\\n\\n@description('What is the prefix for the vnet and first subnet?')\\nparam vNetPrefix string = '10.100'\\n\\n@description('What is the vnet address space?')\\nparam vNetAddressSpace string = '${vNetPrefix}.0.0/16'\\n\\n@description('What is the subnet address prefix?')\\nparam vNetSubnetAddress string = '${vNetPrefix}.0.0/24'\\n\\n@description('Location of all scripts and DSC resources for RDS deployment.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('SAS storage token to access _artifactsLocation. No need to change unless you copy or fork this template.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar uniqueName = substring(uniqueString(resourceGroup().id, deployment().name), 0, 5)\\nvar dnsEntry = 'remoteapps'\\nvar brokerName = 'broker'\\nvar externalFqdn = '${dnsEntry}.${toLower(externalDnsZone)}'\\nvar brokerFqdn = '${brokerName}.${toLower(externalDnsZone)}'\\nvar vmNames = [\\n  '${toLower(projectName)}${uniqueName}dc'\\n  '${toLower(projectName)}${uniqueName}wg'\\n  '${toLower(projectName)}${uniqueName}cb'\\n  '${toLower(projectName)}${uniqueName}sh'\\n  '${toLower(projectName)}${uniqueName}lf'\\n]\\nvar vmProperties = [\\n  {\\n    name: vmNames[0]\\n    count: dcCount\\n    intLbBackEndPool: ''\\n    pubLbBackEndPool: ''\\n    dscFunction: 'DeployRDSLab.ps1\\\\\\\\CreateRootDomain'\\n  }\\n  {\\n    name: vmNames[1]\\n    count: rdwgCount\\n    intLbBackEndPool: 'rds-webgateways-int-pool'\\n    pubLbBackEndPool: 'rds-webgateways-pub-pool'\\n    dscFunction: 'DeployRDSLab.ps1\\\\\\\\RDWebGateway'\\n  }\\n  {\\n    name: vmNames[2]\\n    count: rdcbCount\\n    intLbBackEndPool: 'rds-brokers-int-pool'\\n    pubLbBackEndPool: ''\\n    dscFunction: 'DeployRDSLab.ps1\\\\\\\\RDSDeployment'\\n  }\\n  {\\n    name: vmNames[3]\\n    count: rdshCount\\n    intLbBackEndPool: ''\\n    pubLbBackEndPool: ''\\n    dscFunction: 'DeployRDSLab.ps1\\\\\\\\RDSessionHost'\\n  }\\n  {\\n    name: vmNames[4]\\n    count: lsfsCount\\n    intLbBackEndPool: ''\\n    pubLbBackEndPool: ''\\n    dscFunction: 'DeployRDSLab.ps1\\\\\\\\RDLicenseServer'\\n  }\\n]\\nvar diagStorageName = '${toLower(projectName)}${uniqueName}diag'\\nvar publicLbIpName = '${toLower(projectName)}lbpip'\\nvar diagStorageSkuType = 'Standard_LRS'\\nvar vNetName = '${projectName}vnet'\\nvar firstDcIP = '${vNetPrefix}.0.99'\\nvar nsgRef = projectName_nsg.id\\nvar subNetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', vNetName, '${projectName}main')\\nvar sqlServerName = '${toLower(projectName)}${uniqueName}sql'\\nvar rdsDBName = 'rdsdb'\\nvar dscScriptName = 'deployrdslab.zip'\\nvar scriptName = 'deploycertha.ps1'\\n\\nresource diagStorage 'Microsoft.Storage/storageAccounts@2021-04-01' = {\\n  location: location\\n  kind: 'StorageV2'\\n  name: diagStorageName\\n  sku: {\\n    name: diagStorageSkuType\\n    tier: 'Standard'\\n  }\\n}\\n\\nresource projectName_nsg 'Microsoft.Network/networkSecurityGroups@2020-07-01' = {\\n  location: location\\n  name: '${projectName}nsg'\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'Allow_RDP'\\n        properties: {\\n          access: 'Allow'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n          destinationPortRange: '3389'\\n          protocol: '*'\\n          direction: 'Inbound'\\n          priority: 1000\\n        }\\n      }\\n      {\\n        name: 'Allow_HTTP'\\n        properties: {\\n          access: 'Allow'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n          destinationPortRange: '80'\\n          protocol: 'Tcp'\\n          direction: 'Inbound'\\n          priority: 1001\\n        }\\n      }\\n      {\\n        name: 'Allow_HTTPS'\\n        properties: {\\n          access: 'Allow'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n          destinationPortRange: '443'\\n          protocol: 'Tcp'\\n          direction: 'Inbound'\\n          priority: 1002\\n        }\\n      }\\n      {\\n        name: 'Allow_UDP_3391'\\n        properties: {\\n          access: 'Allow'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n          destinationPortRange: '3391'\\n          protocol: 'Udp'\\n          direction: 'Inbound'\\n          priority: 1003\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource projectName_vnet 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  location: location\\n  name: '${projectName}vnet'\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vNetAddressSpace\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: '${projectName}main'\\n        properties: {\\n          addressPrefix: vNetSubnetAddress\\n          networkSecurityGroup: {\\n            id: nsgRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    nsgRef\\n  ]\\n}\\n\\nresource projectName_intlb 'Microsoft.Network/loadBalancers@2020-07-01' = {\\n  location: location\\n  name: '${projectName}intlb'\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: 'rds-brokers-frontend'\\n        properties: {\\n          privateIPAllocationMethod: 'Static'\\n          privateIPAddress: '${vNetPrefix}.0.4'\\n          privateIPAddressVersion: 'IPv4'\\n          subnet: {\\n            id: subNetRef\\n          }\\n        }\\n      }\\n      {\\n        name: 'rds-webgateways-frontend'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          privateIPAddressVersion: 'IPv4'\\n          subnet: {\\n            id: subNetRef\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: 'rds-brokers-int-pool'\\n        properties: {}\\n      }\\n      {\\n        name: 'rds-webgateways-int-pool'\\n        properties: {}\\n      }\\n    ]\\n    probes: [\\n      {\\n        name: 'rds-broker-probe'\\n        properties: {\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n          protocol: 'Tcp'\\n          port: 3389\\n        }\\n      }\\n      {\\n        name: 'rds-webgateway-probe'\\n        properties: {\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n          protocol: 'Tcp'\\n          port: 443\\n        }\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        name: 'rds-brokers-tcp-rule'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n              '${projectName}intlb',\\n              'rds-brokers-frontend'\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              '${projectName}intlb',\\n              'rds-brokers-int-pool'\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', '${projectName}intlb', 'rds-broker-probe')\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 3389\\n          backendPort: 3389\\n          idleTimeoutInMinutes: 4\\n        }\\n      }\\n      {\\n        name: 'rds-brokers-udp-rule'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n              '${projectName}intlb',\\n              'rds-brokers-frontend'\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              '${projectName}intlb',\\n              'rds-brokers-int-pool'\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', '${projectName}intlb', 'rds-broker-probe')\\n          }\\n          protocol: 'Udp'\\n          frontendPort: 3389\\n          backendPort: 3389\\n          idleTimeoutInMinutes: 4\\n        }\\n      }\\n      {\\n        name: 'rds-webgateway-http-rule'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n              '${projectName}intlb',\\n              'rds-webgateways-frontend'\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              '${projectName}intlb',\\n              'rds-webgateways-int-pool'\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', '${projectName}intlb', 'rds-webgateway-probe')\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 80\\n          backendPort: 80\\n          idleTimeoutInMinutes: 4\\n        }\\n      }\\n      {\\n        name: 'rds-webgateway-https-rule'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n              '${projectName}intlb',\\n              'rds-webgateways-frontend'\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              '${projectName}intlb',\\n              'rds-webgateways-int-pool'\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', '${projectName}intlb', 'rds-webgateway-probe')\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 443\\n          backendPort: 443\\n          idleTimeoutInMinutes: 4\\n        }\\n      }\\n      {\\n        name: 'rds-webgateway-udp-rule'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIpConfigurations',\\n              '${projectName}intlb',\\n              'rds-webgateways-frontend'\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              '${projectName}intlb',\\n              'rds-webgateways-int-pool'\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', '${projectName}intlb', 'rds-webgateway-probe')\\n          }\\n          protocol: 'Udp'\\n          frontendPort: 3391\\n          backendPort: 3391\\n          idleTimeoutInMinutes: 4\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    projectName_vnet\\n  ]\\n}\\n\\nresource publicLbIp 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: publicLbIpName\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n    dnsSettings: {\\n      domainNameLabel: publicLbIpName\\n    }\\n  }\\n}\\n\\nresource projectName_publb 'Microsoft.Network/loadBalancers@2020-07-01' = {\\n  name: '${projectName}publb'\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: 'rds-webgateways-frontend'\\n        properties: {\\n          publicIPAddress: {\\n            id: publicLbIp.id\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: 'rds-webgateways-pub-pool'\\n      }\\n    ]\\n    probes: [\\n      {\\n        name: 'rds-webgateways-probe'\\n        properties: {\\n          protocol: 'Tcp'\\n          port: 80\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        name: 'rds-webgateways-http-rule'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIPConfigurations',\\n              '${projectName}publb',\\n              'rds-webgateways-frontend'\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              '${projectName}publb',\\n              'rds-webgateways-pub-pool'\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', '${projectName}publb', 'rds-webgateways-probe')\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 80\\n          backendPort: 80\\n          enableFloatingIP: false\\n          idleTimeoutInMinutes: 5\\n        }\\n      }\\n      {\\n        name: 'rds-webgateways-https-rule'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIPConfigurations',\\n              '${projectName}publb',\\n              'rds-webgateways-frontend'\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              '${projectName}publb',\\n              'rds-webgateways-pub-pool'\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', '${projectName}publb', 'rds-webgateways-probe')\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 443\\n          backendPort: 443\\n          enableFloatingIP: false\\n          idleTimeoutInMinutes: 5\\n        }\\n      }\\n      {\\n        name: 'rds-webgateways-udp-rule'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/frontendIPConfigurations',\\n              '${projectName}publb',\\n              'rds-webgateways-frontend'\\n            )\\n          }\\n          backendAddressPool: {\\n            id: resourceId(\\n              'Microsoft.Network/loadBalancers/backendAddressPools',\\n              '${projectName}publb',\\n              'rds-webgateways-pub-pool'\\n            )\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', '${projectName}publb', 'rds-webgateways-probe')\\n          }\\n          protocol: 'Udp'\\n          frontendPort: 3391\\n          backendPort: 3391\\n          enableFloatingIP: false\\n          idleTimeoutInMinutes: 5\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    projectName_vnet\\n  ]\\n}\\n\\nresource sqlServer 'Microsoft.Sql/servers@2020-11-01-preview' = {\\n  name: sqlServerName\\n  location: location\\n  properties: {\\n    administratorLogin: adminUser\\n    administratorLoginPassword: adminPasswd\\n  }\\n}\\n\\nresource sqlServerName_AllowAllWindowsAzureIps 'Microsoft.Sql/servers/firewallRules@2020-11-01-preview' = {\\n  parent: sqlServer\\n  location: location\\n  name: 'AllowAllWindowsAzureIps'\\n  properties: {\\n    startIpAddress: '0.0.0.0'\\n    endIpAddress: '0.0.0.0'\\n  }\\n}\\n\\nresource sqlServerName_rdsDB 'Microsoft.Sql/servers/databases@2020-11-01-preview' = {\\n  parent: sqlServer\\n  name: '${rdsDBName}'\\n  location: location\\n  sku: {\\n    name: 'S2'\\n    tier: 'Standard'\\n  }\\n  properties: {\\n    collation: 'SQL_Latin1_General_CP1_CI_AS'\\n    maxSizeBytes: '1073741824'\\n  }\\n}\\n\\nmodule vmProperties_name_Deployment './nested_vmProperties_name_Deployment.bicep' = [\\n  for item in vmProperties: {\\n    name: '${item.name}Deployment'\\n    params: {\\n      location: location\\n      timeZoneID: timeZoneID\\n      loopCount: item.count\\n      storageDiagUrl: diagStorage.properties.primaryEndpoints.blob\\n      vmName: item.name\\n      subNetRef: subNetRef\\n      vmSize: vmSize\\n      vmSpot: vmSpot\\n      vmStorageSkuType: vmStorageSkuType\\n      adminUser: adminUser\\n      adminPasswd: adminPasswd\\n      intLbName: '${projectName}intlb'\\n      intLbBackEndPool: item.intLbBackEndPool\\n      intLbBrokerIP: projectName_intlb.properties.frontendIPConfigurations[0].properties.privateIPAddress\\n      intLbWebGWIP: projectName_intlb.properties.frontendIPConfigurations[1].properties.privateIPAddress\\n      pubLbName: '${projectName}publb'\\n      pubLbBackEndPool: item.pubLbBackEndPool\\n      adDomainName: adDomainName\\n      firstDcIP: firstDcIP\\n      dcName: vmProperties[0].name\\n      MainConnectionBroker: '${vmProperties[2].name}1'\\n      WebAccessServerName: vmProperties[1].name\\n      WebAccessServerCount: vmProperties[1].count\\n      SessionHostName: vmProperties[3].name\\n      SessionHostCount: vmProperties[3].count\\n      LicenseServerName: vmProperties[4].name\\n      LicenseServerCount: vmProperties[4].count\\n      externalFqdn: externalFqdn\\n      brokerFqdn: brokerFqdn\\n      externalDnsZone: externalDnsZone\\n      dscFunction: item.dscFunction\\n      dscLocation: _artifactsLocation\\n      dscScriptName: dscScriptName\\n      scriptName: scriptName\\n      deployHA: deployHA\\n      rdsDBName: rdsDBName\\n      azureSQLFqdn: sqlServer.properties.fullyQualifiedDomainName\\n      webGwName: dnsEntry\\n      _artifactsLocationSasToken: _artifactsLocationSasToken\\n    }\\n    dependsOn: [\\n      projectName_vnet\\n      projectName_intlb\\n      projectName_publb\\n      diagStorage\\n      sqlServerName_rdsDB\\n    ]\\n  }\\n]\\n\\noutput adminUser string = adminUser\\noutput WebAccessFQDN string = publicLbIp.properties.dnsSettings.fqdn\\noutput ExternalFQDN string = externalFqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"projectName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUser\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPasswd\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"timeZoneID\\\": {\\n      \\\"value\\\": \\\"UTC\\\"\\n    },\\n    \\\"externalDnsZone\\\": {\\n      \\\"value\\\": \\\"contosocorp.com\\\"\\n    },\\n    \\\"deployHA\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"dcCount\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"rdcbCount\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"rdwgCount\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"rdshCount\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"lsfsCount\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_A2_v2\\\"\\n    },\\n    \\\"vmSpot\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"vmStorageSkuType\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"adDomainName\\\": {\\n      \\\"value\\\": \\\"contoso.com\\\"\\n    },\\n    \\\"vNetPrefix\\\": {\\n      \\\"value\\\": \\\"10.100\\\"\\n    },\\n    \\\"vNetAddressSpace\\\": {\\n      \\\"value\\\": \\\"${vNetPrefix}.0.0/16\\\"\\n    },\\n    \\\"vNetSubnetAddress\\\": {\\n      \\\"value\\\": \\\"${vNetPrefix}.0.0/24\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('URL of a ZIP archive containing VHD images files. For example: https://provider.com/bin/support/azure-vhd.zip')\\n@secure()\\nparam Source string\\n\\n@description('URI of a Storage Account container with a writable SAS Token.')\\n@secure()\\nparam Destination string\\n\\n@description('Used to force the execution when redeploying the template with the same parameters. Default: [newGuid()]')\\nparam forceUpdateTag string = newGuid()\\n\\n@description('The location in which the resources should be deployed. Default: [resourceGroup().location]')\\nparam location string = resourceGroup().location\\n\\nvar urlVHDZipArchive = Source\\nvar uriWritableStorageAccountBlobContainerSasToken = Destination\\nvar deploymentScriptName = 'ImportVHD-FromZipArchive-${uniqueString(Source,uniqueString(Destination))}'\\nvar userAssignedIdentityName = 'ImportVHD-FromZipArchiveURL-worker-${uniqueString(resourceGroup().id)}'\\nvar roleAssignmentName = guid('${userAssignedIdentityName}${resourceGroup().id}contributor')\\nvar forceUpdateTag_var = forceUpdateTag\\n\\nresource userAssignedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\\n  name: userAssignedIdentityName\\n  location: location\\n}\\n\\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2018-09-01-preview' = {\\n  name: roleAssignmentName\\n  properties: {\\n    roleDefinitionId: resourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\\n    principalId: reference(userAssignedIdentity.id, '2015-08-31-preview').principalId\\n    scope: resourceGroup().id\\n    principalType: 'ServicePrincipal'\\n  }\\n}\\n\\nresource deploymentScript 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\\n  name: deploymentScriptName\\n  location: location\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${userAssignedIdentity.id}': {}\\n    }\\n  }\\n  kind: 'AzurePowerShell'\\n  properties: {\\n    azPowerShellVersion: '5.5'\\n    cleanupPreference: 'OnSuccess'\\n    environmentVariables: [\\n      {\\n        name: 'ResourceGroupName'\\n        value: resourceGroup().name\\n      }\\n      {\\n        name: 'Source'\\n        secureValue: urlVHDZipArchive\\n      }\\n      {\\n        name: 'Destination'\\n        secureValue: uriWritableStorageAccountBlobContainerSasToken\\n      }\\n    ]\\n    forceUpdateTag: forceUpdateTag_var\\n    retentionInterval: 'PT4H'\\n    scriptContent: '# 210602 \\\\n  \\\\n ##### Parameters \\\\n  \\\\n $urlVHDZipArchive = \\\\${Env:Source} \\\\n $uriWritableStorageAccountBlobContainerSasToken = \\\\${Env:Destination} \\\\n $ResourceGroupName = \\\\${Env:ResourceGroupName} \\\\n  \\\\n ##### Validate Parameters \\\\n  \\\\n if (! ([System.Uri]::IsWellFormedUriString($urlVHDZipArchive,[System.UriKind]::Absolute))) { \\\\n   Throw \\\\'The Source URL parameter is probably not well formatted. Please check and retry.\\\\' \\\\n } \\\\n  \\\\n if (! ([System.Uri]::IsWellFormedUriString($uriWritableStorageAccountBlobContainerSasToken,[System.UriKind]::Absolute))) { \\\\n   Throw \\\\'The Destination URI parameter is probably not well formatted. The URI of a Storage Account Container with a SAS Token is expected. Please check and retry.\\\\' \\\\n } \\\\n  \\\\n ##### Variables \\\\n  \\\\n $base_path=\\\\'/mnt/azscripts\\\\' \\\\n $temp_path=\\\\'{0}/temp\\\\' -f $base_path \\\\n New-Item -Type Directory -ErrorAction SilentlyContinue $temp_path \\\\n  \\\\n $timestamp = Get-Date -Format \\\\'yyMMddHHmmss\\\\' \\\\n  \\\\n ##### Prereqs \\\\n  \\\\n Write-Output \\\\'Increase file share quota to 4TB instead of 2GB before downloading and expanding\\\\' \\\\n $QuotaGiB = \\\\'4096\\\\' \\\\n Get-AzStorageAccount -ResourceGroupName $ResourceGroupName | Where-Object { $_.StorageAccountName -like \\\\'*azscripts\\\\' } | ForEach-Object { \\\\n   $StorageAccount = $_ \\\\n   Get-AzStorageShare -Context $StorageAccount.Context | ForEach-Object {  \\\\n     $Share = $_ \\\\n     Set-AzStorageShareQuota -ShareName $Share.Name -Context $StorageAccount.Context -Quota $QuotaGiB \\\\n   } \\\\n } \\\\n  \\\\n ##### Fetch and process \\\\n  \\\\n Write-Output \\\\'Download the ZIP archive\\\\' \\\\n $archive_path=\\\\'{0}/archive-{1}.zip\\\\' -f $temp_path,$timestamp \\\\n # Accelerate file download (initially using Invoke-WebRequest) \\\\n (New-Object System.Net.WebClient).DownloadFile($urlVHDZipArchive, $archive_path) \\\\n  \\\\n Write-Output \\\\'Expand locally\\\\' \\\\n $expanded_archive_path =\\\\'{0}/expanded-{1}\\\\' -f $temp_path,$timestamp \\\\n New-Item -Type Directory -ErrorAction SilentlyContinue $expanded_archive_path \\\\n Expand-Archive -Path $archive_path -DestinationPath $expanded_archive_path -Force \\\\n  \\\\n ##### Upload to Azure Storage account \\\\n  \\\\n Write-Output \\\\'Upload extracted VHD file(s)\\\\' \\\\n  \\\\n $DeploymentScriptOutputs = @{} \\\\n $DeploymentScriptOutputs[\\\\'vhdBlobUriList\\\\'] = @{} \\\\n $DeploymentScriptOutputs[\\\\'vhdBlobSHA256List\\\\'] = @{} \\\\n  \\\\n $StorageAccountContainerUri = ($uriWritableStorageAccountBlobContainerSasToken -split [Regex]::Escape(\\\\'?\\\\'))[0] \\\\n $StorageAccountName = (([System.Uri]$uriWritableStorageAccountBlobContainerSasToken).Host -split [Regex]::Escape(\\\\'.\\\\'))[0] \\\\n $ContainerName = ($StorageAccountContainerUri -split \\\\'/\\\\')[-1]  # Last element \\\\n $StorageAccountContainerSASToken = ($uriWritableStorageAccountBlobContainerSasToken -split [Regex]::Escape(\\\\'?\\\\'))[1] \\\\n $StorageAccountContext = New-AzStorageContext -StorageAccountName $StorageAccountName -SasToken $StorageAccountContainerSASToken \\\\n  \\\\n $vhd_filepath=\\\\'{0}/*.vhd\\\\' -f  $expanded_archive_path \\\\n  \\\\n Get-Item $vhd_filepath | ForEach-Object { \\\\n   $localFilePath = $_ \\\\n   $vhdBlobName = $localFilePath.Name \\\\n   $vhdBlobUri = \\\\'{0}/{1}\\\\' -f $StorageAccountContainerUri,$vhdBlobName \\\\n  \\\\n   $hash = (Get-FileHash -Algorithm SHA256 -Path $localFilePath).Hash \\\\n   $metadata = @{\\\\'SHA256\\\\' = $hash; } \\\\n  \\\\n   Write-Output \\\\'Uploading \\\\' + $vhdBlobName \\\\n   Set-AzStorageBlobContent -File $localFilePath -Context $StorageAccountContext -Container $ContainerName -Blob $vhdBlobName -BlobType Page -Metadata $metadata -Force \\\\n   $DeploymentScriptOutputs[\\\\'vhdBlobUriList\\\\'][$vhdBlobName] = $vhdBlobUri \\\\n   $DeploymentScriptOutputs[\\\\'vhdBlobSHA256List\\\\'][$vhdBlobName] = $hash \\\\n } \\\\n '\\n  }\\n  dependsOn: [\\n    roleAssignment\\n  ]\\n}\\n\\noutput vhdBlobUriList object = deploymentScript.properties.outputs.vhdBlobUriList\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"Source\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"Destination\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"forceUpdateTag\\\": {\\n      \\\"value\\\": \\\"newGuid()\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name for the Virtual Machine.')\\nparam virtualMachineName string\\n\\n@description('Username for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('The Git Url of the app')\\nparam appGitLocation string = 'https://github.com/evillgenius75/gbb-todo'\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Default VM Size')\\nparam vmSize string = 'Standard_F1'\\n\\nvar nicName = 'nicCard'\\nvar publicIPAddressName = 'publicIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar nsgName = 'nsg'\\nvar virtualNetworkName = 'vnet'\\nvar newStorageAccountName = 'storage${uniqueString(resourceGroup().id)}'\\nvar dnsNameForPublicIP = 'pip${uniqueString(resourceGroup().id)}'\\nvar customExtensionScriptFileName = 'mongo_nodejs.sh'\\nvar todoAppTags = {\\n  provider: 'NA'\\n}\\nvar quickstartTags = {\\n  name: 'todoApp'\\n}\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\n\\nresource newStorageAccount 'Microsoft.Storage/storageAccounts@2021-01-01' = {\\n  name: newStorageAccountName\\n  location: location\\n  tags: {\\n    displayName: 'Storage Account'\\n    quickstartName: quickstartTags.name\\n    provider: todoAppTags.provider\\n  }\\n  kind: 'Storage'\\n  sku: {\\n    name: 'Standard_LRS'\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  tags: {\\n    displayName: 'Public IP'\\n    quickstartName: quickstartTags.name\\n    provider: todoAppTags.provider\\n  }\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsNameForPublicIP\\n    }\\n  }\\n}\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2020-07-01' = {\\n  name: nsgName\\n  location: location\\n  tags: {\\n    displayName: 'Network Security Group'\\n    quickstartName: quickstartTags.name\\n    provider: todoAppTags.provider\\n  }\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'SSH-allow'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '22'\\n          sourceAddressPrefix: 'Internet'\\n          destinationAddressPrefix: '10.0.0.0/16'\\n          access: 'Allow'\\n          priority: 110\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'Nodejs-allow'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '8080'\\n          destinationAddressPrefix: '10.0.0.0/16'\\n          sourceAddressPrefix: 'Internet'\\n          access: 'Allow'\\n          priority: 120\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  tags: {\\n    displayName: 'Virtual Network'\\n    quickstartName: quickstartTags.name\\n    provider: todoAppTags.provider\\n  }\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        '10.0.0.0/16'\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: 'subnet'\\n        properties: {\\n          addressPrefix: '10.0.0.0/24'\\n          networkSecurityGroup: {\\n            id: nsg.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: nicName\\n  location: location\\n  tags: {\\n    displayName: 'Network Interface Card'\\n    quickstartName: quickstartTags.name\\n    provider: todoAppTags.provider\\n  }\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets/', virtualNetworkName, 'subnet')\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: virtualMachineName\\n  location: location\\n  tags: {\\n    displayName: 'Virtual Machine'\\n    quickstartName: quickstartTags.name\\n    provider: todoAppTags.provider\\n  }\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: virtualMachineName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: 'Canonical'\\n        offer: 'UbuntuServer'\\n        sku: '16.04.0-LTS'\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${virtualMachineName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n  dependsOn: [\\n    newStorageAccount\\n  ]\\n}\\n\\nresource virtualMachineName_customExtension 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: virtualMachine\\n  name: 'customExtension'\\n  location: location\\n  tags: {\\n    displayName: 'customExtension'\\n  }\\n  properties: {\\n    publisher: 'Microsoft.Azure.Extensions'\\n    type: 'CustomScript'\\n    typeHandlerVersion: '2.0'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      fileUris: [\\n        uri(_artifactsLocation, 'scripts/${customExtensionScriptFileName}${_artifactsLocationSasToken}')\\n      ]\\n      commandToExecute: 'sh ${customExtensionScriptFileName} ${appGitLocation}'\\n    }\\n  }\\n}\\n\\noutput adminUsername string = adminUsername\\noutput publicIP string = publicIPAddress.properties.dnsSettings.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"virtualMachineName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"appGitLocation\\\": {\\n      \\\"value\\\": \\\"'https:\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_F1\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location for all resources')\\nparam location string = resourceGroup().location\\n\\n@description('The username of the initial account to be created')\\nparam adminUsername string\\n\\n@description('The password of the initial account to be created')\\n@secure()\\nparam adminPassword string\\n\\n@description('The size of the datadisks to be striped. The total capacity will be this size multiplied by the number of data disks you specify.')\\n@allowed([\\n  32\\n  64\\n  128\\n  256\\n  512\\n  1024\\n  2048\\n  4095\\n])\\nparam sizeOfEachDataDiskInGB int = 1024\\n\\n@description('The number of data disks to include in the storage pool.')\\n@allowed([\\n  8\\n  16\\n  32\\n])\\nparam numberOfDisks int = 32\\n\\n@description('DNS name for the Public IP')\\nparam dnsName string = 'vm-data-disks-${uniqueString(resourceGroup().id)}'\\n\\n@description('VM Size, the list of sizes here all support premium and standard storage up to 32 data disks.')\\n@allowed([\\n  'Standard_D16s_v3'\\n  'Standard_D32s_v3'\\n  'Standard_D64s_v3'\\n])\\nparam vmSize string = 'Standard_D16s_v3'\\n\\n@description('Storage SKU type')\\n@allowed([\\n  'Premium_LRS'\\n  'StahdardSSD_LRS'\\n  'Standard_LRS'\\n])\\nparam storageType string = 'Premium_LRS'\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar vmName = 'vm-high-iops'\\nvar imagePublisher = 'MicrosoftWindowsServer'\\nvar imageOffer = 'WindowsServer'\\nvar imageSKU = '2016-Datacenter'\\nvar virtualNetworkName = 'highIopsVNET'\\nvar nicName = 'highIopsNIC'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnet1Name = 'Subnet-1'\\nvar subnet1Prefix = '10.0.0.0/24'\\nvar publicIPAddressName = 'highIopsPubIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar configurationFunction = 'StoragePool.ps1\\\\\\\\StoragePool'\\nvar modulesUrl = uri(_artifactsLocation, 'DSC/StoragePool.zip')\\nvar DscExtensionName = 'DscExtension'\\nvar subnet1Ref = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnet1Name)\\nvar networkSecurityGroupName = 'default-NSG'\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-08-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsName\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2019-08-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'default-allow-3389'\\n        properties: {\\n          priority: 1000\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '3389'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2018-04-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnet1Name\\n        properties: {\\n          addressPrefix: subnet1Prefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2018-04-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnet1Ref\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2017-03-30' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: imageSKU\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n        managedDisk: {\\n          storageAccountType: storageType\\n        }\\n      }\\n      dataDisks: [\\n        for j in range(0, numberOfDisks): {\\n          diskSizeGB: sizeOfEachDataDiskInGB\\n          lun: j\\n          name: '${vmName}_DataDisk${j}'\\n          createOption: 'Empty'\\n          managedDisk: {\\n            storageAccountType: storageType\\n          }\\n        }\\n      ]\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource vmName_DscExtension 'Microsoft.Compute/virtualMachines/extensions@2017-03-30' = {\\n  parent: vm\\n  name: '${DscExtensionName}'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Powershell'\\n    type: 'DSC'\\n    typeHandlerVersion: '2.19'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      ModulesUrl: modulesUrl\\n      SasToken: _artifactsLocationSasToken\\n      ConfigurationFunction: configurationFunction\\n      Properties: {\\n        MachineName: vmName\\n      }\\n    }\\n  }\\n}\\n\\noutput fqdn string = publicIPAddress.properties.dnsSettings.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sizeOfEachDataDiskInGB\\\": {\\n      \\\"value\\\": 1024\\n    },\\n    \\\"numberOfDisks\\\": {\\n      \\\"value\\\": 32\\n    },\\n    \\\"dnsName\\\": {\\n      \\\"value\\\": \\\"vm-data-disks-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D16s_v3\\\"\\n    },\\n    \\\"storageType\\\": {\\n      \\\"value\\\": \\\"Premium_LRS\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('DNS Name for the Public IP. Must be lowercase.')\\nparam dnsNameForPublicIP string\\n\\n@description('Admin username')\\nparam adminUsername string\\n\\n@description('Admin password')\\n@secure()\\nparam adminPassword string\\n\\n@description('Image Publisher')\\nparam imagePublisher string = 'MicrosoftWindowsServer'\\n\\n@description('Image Offer')\\nparam imageOffer string = 'WindowsServer'\\n\\n@description('Default location')\\nparam location string = resourceGroup().location\\n\\n@description('Image SKU')\\nparam imageSKU string = '2012-R2-Datacenter'\\n\\n@description('Size of the VM')\\nparam vmSize string = 'Standard_A2_v2'\\n\\n@description('Name of the VM')\\nparam vmName string = 'WinRmVm'\\n\\n@description('ResourceId of the KeyVault')\\nparam vaultResourceId string\\nparam certificateUrl string\\n\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnet1Name = 'Subnet-1'\\nvar subnet1Prefix = '10.0.0.0/24'\\nvar publicIPAddressName = 'myPublicIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar virtualNetworkName = 'myVNET'\\nvar nicName = 'myNIC'\\nvar subnet1Ref = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnet1Name)\\nvar networkSecurityGroupName = '${subnet1Name}-nsg'\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-08-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsNameForPublicIP\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2019-08-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'default-allow-3389'\\n        properties: {\\n          priority: 1000\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '3389'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2017-09-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnet1Name\\n        properties: {\\n          addressPrefix: subnet1Prefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2017-09-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnet1Ref\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2019-07-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n      secrets: [\\n        {\\n          sourceVault: {\\n            id: vaultResourceId\\n          }\\n          vaultCertificates: [\\n            {\\n              certificateUrl: certificateUrl\\n              certificateStore: 'My'\\n            }\\n          ]\\n        }\\n      ]\\n      windowsConfiguration: {\\n        provisionVMAgent: true\\n        winRM: {\\n          listeners: [\\n            {\\n              protocol: 'Http'\\n            }\\n            {\\n              protocol: 'Https'\\n              certificateUrl: certificateUrl\\n            }\\n          ]\\n        }\\n        enableAutomaticUpdates: true\\n      }\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: imageSKU\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"dnsNameForPublicIP\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"imagePublisher\\\": {\\n      \\\"value\\\": \\\"MicrosoftWindowsServer\\\"\\n    },\\n    \\\"imageOffer\\\": {\\n      \\\"value\\\": \\\"WindowsServer\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"imageSKU\\\": {\\n      \\\"value\\\": \\\"2012-R2-Datacenter\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_A2_v2\\\"\\n    },\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"WinRmVm\\\"\\n    },\\n    \\\"vaultResourceId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"certificateUrl\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Size of VMs in the VM Scale Set.')\\nparam vmSku string = 'Standard_A1_V2'\\n\\n@description('The Windows version for the VM. This will pick a fully patched image of this given Windows version. Allowed values: 2008-R2-SP1, 2012-Datacenter, 2012-R2-Datacenter.')\\n@allowed([\\n  '2008-R2-SP1'\\n  '2012-Datacenter'\\n  '2012-R2-Datacenter'\\n  '2016-Datacenter'\\n  '2019-Datacenter'\\n])\\nparam windowsOSVersion string = '2019-Datacenter'\\n\\n@description('String used as a base for naming resources. Must be 3-61 characters in length and globally unique across Azure. A hash is prepended to this string for some resources, and resource-specific information is appended.')\\n@maxLength(61)\\nparam vmssName string\\n\\n@description('Number of VM instances (100 or less).')\\n@minValue(2)\\n@maxValue(100)\\nparam instanceCount int\\n\\n@description('Admin username on all VMs.')\\nparam adminUsername string\\n\\n@description('Admin password on all VMs.')\\n@secure()\\nparam adminPassword string\\n\\n@description('Default location')\\nparam location string = resourceGroup().location\\n\\nvar namingInfix_var = toLower(substring(concat(vmssName, uniqueString(resourceGroup().id)), 0, 9))\\nvar longNamingInfix = toLower(vmssName)\\nvar jumpBoxName = '${namingInfix_var}jbox'\\nvar jumpBoxSAName = '${uniqueString('${resourceGroup().id}${newStorageAccountSuffix}jumpboxsa')}jb'\\nvar jumpBoxOSDiskName = '${jumpBoxName}_OSDisk'\\nvar jumpBoxIPConfigName = '${jumpBoxName}ipconfig'\\nvar jumpBoxNicName = '${jumpBoxName}nic'\\nvar newStorageAccountSuffix = '${namingInfix_var}sa'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar virtualNetworkName = '${namingInfix_var}vnet'\\nvar subnetName = '${namingInfix_var}subnet'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar publicIPAddressName = '${namingInfix_var}pip'\\nvar nicName = '${namingInfix_var}nic'\\nvar ipConfigName = '${namingInfix_var}ipconfig'\\nvar osType = {\\n  publisher: 'MicrosoftWindowsServer'\\n  offer: 'WindowsServer'\\n  sku: windowsOSVersion\\n  version: 'latest'\\n}\\nvar imageReference = osType\\nvar networkSecurityGroupName = 'default-NSG'\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2020-07-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'default-allow-3389'\\n        properties: {\\n          priority: 1000\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '3389'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource jumpBoxSA 'Microsoft.Storage/storageAccounts@2021-02-01' = {\\n  name: jumpBoxSAName\\n  location: location\\n  sku: {\\n    name: 'Standard_LRS'\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n    dnsSettings: {\\n      domainNameLabel: longNamingInfix\\n    }\\n  }\\n}\\n\\nresource jumpBoxNic 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: jumpBoxNicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: jumpBoxIPConfigName\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource jumpBox 'Microsoft.Compute/virtualMachines@2020-12-01' = {\\n  name: jumpBoxName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSku\\n    }\\n    osProfile: {\\n      computerName: jumpBoxName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n    }\\n    storageProfile: {\\n      imageReference: imageReference\\n      osDisk: {\\n        name: jumpBoxOSDiskName\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: jumpBoxNic.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: reference(jumpBoxSA.id, '2019-06-01').primaryEndpoints.blob\\n      }\\n    }\\n  }\\n}\\n\\nresource namingInfix 'Microsoft.Compute/virtualMachineScaleSets@2020-12-01' = {\\n  name: namingInfix_var\\n  location: location\\n  sku: {\\n    name: vmSku\\n    tier: 'Standard'\\n    capacity: instanceCount\\n  }\\n  properties: {\\n    overprovision: 'true'\\n    upgradePolicy: {\\n      mode: 'Manual'\\n    }\\n    virtualMachineProfile: {\\n      storageProfile: {\\n        osDisk: {\\n          createOption: 'FromImage'\\n          caching: 'ReadWrite'\\n        }\\n        imageReference: imageReference\\n      }\\n      osProfile: {\\n        computerNamePrefix: namingInfix_var\\n        adminUsername: adminUsername\\n        adminPassword: adminPassword\\n      }\\n      networkProfile: {\\n        networkInterfaceConfigurations: [\\n          {\\n            name: nicName\\n            properties: {\\n              primary: true\\n              ipConfigurations: [\\n                {\\n                  name: ipConfigName\\n                  properties: {\\n                    subnet: {\\n                      id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\n                    }\\n                  }\\n                }\\n              ]\\n            }\\n          }\\n        ]\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmSku\\\": {\\n      \\\"value\\\": \\\"Standard_A1_V2\\\"\\n    },\\n    \\\"windowsOSVersion\\\": {\\n      \\\"value\\\": \\\"2019-Datacenter\\\"\\n    },\\n    \\\"vmssName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"instanceCount\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"targetScope = 'managementGroup'\\n\\n@description('EnrollmentAccount used for subscription billing')\\nparam enrollmentAccount string\\n\\n@description('BillingAccount used for subscription billing')\\nparam billingAccount string\\n\\n@description('Alias to assign to the subscription')\\nparam subscriptionAlias string\\n\\n@description('Display name for the subscription')\\nparam subscriptionDisplayName string\\n\\n@description('Workload type for the subscription')\\n@allowed([\\n  'Production'\\n  'DevTest'\\n])\\nparam subscriptionWorkload string = 'Production'\\n\\nresource subscriptionAlias_resource 'Microsoft.Subscription/aliases@2020-09-01' = {\\n  scope: tenant()\\n  name: subscriptionAlias\\n  properties: {\\n    workload: subscriptionWorkload\\n    displayName: subscriptionDisplayName\\n    billingScope: tenantResourceId(\\n      'Microsoft.Billing/billingAccounts/enrollmentAccounts',\\n      billingAccount,\\n      enrollmentAccount\\n    )\\n  }\\n}\\n\\noutput subscriptionId string = subscriptionAlias_resource.properties.subscriptionId\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"enrollmentAccount\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"billingAccount\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subscriptionAlias\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subscriptionDisplayName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subscriptionWorkload\\\": {\\n      \\\"value\\\": \\\"Production\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"targetScope = 'subscription'\\n\\n@description('Name of the resourceGroup.')\\nparam resourceGroupName string\\n\\nparam location string = deployment().location\\n\\nresource rg 'Microsoft.Resources/resourceGroups@2021-04-01' = {\\n  name: resourceGroupName\\n  location: location\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"resourceGroupName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"deployment().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"targetScope = 'managementGroup'\\n\\n@description('Policy definition unique identifier')\\nparam policyDefinitionId string\\n\\nresource policyAssignment 'Microsoft.Authorization/policyAssignments@2020-09-01' = {\\n  name: 'location-lock'\\n  properties: {\\n    policyDefinitionId: policyDefinitionId\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"policyDefinitionId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of Azure CDN SKU')\\nparam skuName string\\n\\n@description('Name of the WAF policy to create.')\\nparam wafPolicyName string\\n\\n@description('Describes if it is in detection mode or prevention mode at policy level.')\\n@allowed([\\n  'Detection'\\n  'Prevention'\\n])\\nparam wafPolicyMode string\\n\\n@description('Describes if the policy needs to enabled or disabled.')\\nparam enableWAFPolicy bool\\n\\n@description('Response body to return on Block')\\nparam wafBlockResponseBody string\\n\\n@description('Response Code to return on Block. Default to 403')\\n@allowed([\\n  401\\n  403\\n])\\nparam wafBlockResponseCode int\\n\\n@description('Describes if request body should be checked.')\\nparam enableRequestBodyCheck bool\\n\\nresource wafPolicy 'Microsoft.Network/FrontDoorWebApplicationFirewallPolicies@2020-11-01' = {\\n  name: wafPolicyName\\n  location: 'Global'\\n  sku: {\\n    name: skuName\\n  }\\n  properties: {\\n    policySettings: {\\n      enabledState: (enableWAFPolicy ? 'Enabled' : 'Disabled')\\n      mode: wafPolicyMode\\n      customBlockResponseStatusCode: wafBlockResponseCode\\n      customBlockResponseBody: base64(wafBlockResponseBody)\\n      requestBodyCheck: (enableRequestBodyCheck ? 'Enabled' : 'Disabled')\\n    }\\n    customRules: {\\n      rules: [\\n        {\\n          name: 'BlockMethod'\\n          enabledState: 'Enabled'\\n          priority: 10\\n          ruleType: 'MatchRule'\\n          rateLimitDurationInMinutes: 1\\n          rateLimitThreshold: 100\\n          matchConditions: [\\n            {\\n              matchVariable: 'RequestMethod'\\n              operator: 'Equal'\\n              negateCondition: true\\n              matchValue: [\\n                'GET'\\n                'OPTIONS'\\n                'HEAD'\\n              ]\\n            }\\n          ]\\n          action: 'Block'\\n        }\\n      ]\\n    }\\n    managedRules: {\\n      managedRuleSets: [\\n        {\\n          ruleSetType: 'Microsoft_DefaultRuleSet'\\n          ruleSetVersion: '2.0'\\n          ruleSetAction: 'Log'\\n          ruleGroupOverrides: [\\n            {\\n              ruleGroupName: 'NODEJS'\\n              rules: [\\n                {\\n                  ruleId: '934100'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'General'\\n              rules: [\\n                {\\n                  ruleId: '200003'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '200002'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'PROTOCOL-ENFORCEMENT'\\n              rules: [\\n                {\\n                  ruleId: '920480'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920470'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920450'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920440'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920430'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920420'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920350'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920341'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920340'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920330'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920320'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920311'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920310'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920300'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920290'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920280'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920271'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920270'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920260'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920240'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920230'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920220'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920210'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920201'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920200'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920190'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920180'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920171'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920170'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920160'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920121'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920120'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '920100'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'METHOD-ENFORCEMENT'\\n              rules: [\\n                {\\n                  ruleId: '911100'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'JAVA'\\n              rules: [\\n                {\\n                  ruleId: '944250'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '944240'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '944210'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '944200'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '944130'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '944120'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '944110'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '944100'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'FIX'\\n              rules: [\\n                {\\n                  ruleId: '943120'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '943110'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '943100'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'SQLI'\\n              rules: [\\n                {\\n                  ruleId: '942510'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942500'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942480'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942470'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942450'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942440'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942430'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942410'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942400'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942390'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942380'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942370'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942361'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942360'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942350'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942340'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942330'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942320'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942310'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942300'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942290'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942280'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942270'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942260'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942250'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942240'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942230'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942220'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942210'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942200'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942190'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942180'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942170'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942160'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942150'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942140'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942120'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942110'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '942100'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'XSS'\\n              rules: [\\n                {\\n                  ruleId: '941380'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941370'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941360'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941350'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941340'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941330'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941320'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941310'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941300'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941290'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941280'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941270'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941260'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941250'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941240'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941230'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941220'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941210'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941200'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941190'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941180'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941170'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941160'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941150'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941140'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941130'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941120'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941110'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941101'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '941100'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'PHP'\\n              rules: [\\n                {\\n                  ruleId: '933210'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '933200'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '933180'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '933170'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '933160'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '933151'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '933150'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '933140'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '933130'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '933120'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '933110'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '933100'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'RCE'\\n              rules: [\\n                {\\n                  ruleId: '932180'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '932171'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '932170'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '932160'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '932150'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '932140'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '932130'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '932120'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '932115'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '932110'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '932105'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '932100'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'RFI'\\n              rules: [\\n                {\\n                  ruleId: '931130'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '931120'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '931110'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '931100'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'LFI'\\n              rules: [\\n                {\\n                  ruleId: '930130'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '930120'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '930110'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '930100'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'PROTOCOL-ATTACK'\\n              rules: [\\n                {\\n                  ruleId: '921151'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '921160'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '921150'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '921140'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '921130'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '921120'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '921110'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'MS-ThreatIntel-CVEs'\\n              rules: [\\n                {\\n                  ruleId: '99001016'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '99001015'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '99001014'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '99001001'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'MS-ThreatIntel-SQLI'\\n              rules: [\\n                {\\n                  ruleId: '99031002'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '99031001'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'MS-ThreatIntel-AppSec'\\n              rules: [\\n                {\\n                  ruleId: '99030002'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '99030001'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n            {\\n              ruleGroupName: 'MS-ThreatIntel-WebShells'\\n              rules: [\\n                {\\n                  ruleId: '99005006'\\n                  enabledState: 'Disabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '99005004'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '99005003'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n                {\\n                  ruleId: '99005002'\\n                  enabledState: 'Enabled'\\n                  action: 'Log'\\n                }\\n              ]\\n            }\\n          ]\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\noutput cdnWafId string = wafPolicy.id\\noutput cdnWafName string = wafPolicyName\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"skuName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"wafPolicyName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"wafPolicyMode\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"enableWAFPolicy\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"wafBlockResponseBody\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"wafBlockResponseCode\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"enableRequestBodyCheck\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Origin details')\\nparam origins array\\n\\n@description('Custom Domain Array')\\nparam customDomains array\\n\\n@description('Name of CDN Profile. For chaining, use output from parent module')\\nparam cdnProfileName string\\n\\n@description('Name of AFD endpoint')\\nparam afdEndpointName string\\n\\n@description('Rulesets List')\\nparam routeRuleSets array\\n\\n@description('Default Content to compress')\\nvar contentTypeCompressionList = [\\n  'application/eot'\\n  'application/font'\\n  'application/font-sfnt'\\n  'application/javascript'\\n  'application/json'\\n  'application/opentype'\\n  'application/otf'\\n  'application/pkcs7-mime'\\n  'application/truetype'\\n  'application/ttf'\\n  'application/vnd.ms-fontobject'\\n  'application/xhtml+xml'\\n  'application/xml'\\n  'application/xml+rss'\\n  'application/x-font-opentype'\\n  'application/x-font-truetype'\\n  'application/x-font-ttf'\\n  'application/x-httpd-cgi'\\n  'application/x-javascript'\\n  'application/x-mpegurl'\\n  'application/x-opentype'\\n  'application/x-otf'\\n  'application/x-perl'\\n  'application/x-ttf'\\n  'font/eot'\\n  'font/ttf'\\n  'font/otf'\\n  'font/opentype'\\n  'image/svg+xml'\\n  'text/css'\\n  'text/csv'\\n  'text/html'\\n  'text/javascript'\\n  'text/js'\\n  'text/plain'\\n  'text/richtext'\\n  'text/tab-separated-values'\\n  'text/xml'\\n  'text/x-script'\\n  'text/x-component'\\n  'text/x-java-source'\\n]\\n\\nresource cdn 'Microsoft.Cdn/profiles@2021-06-01' existing = {\\n  name: cdnProfileName\\n}\\n\\nresource afd_endpoint 'Microsoft.Cdn/profiles/afdendpoints@2021-06-01' existing = {\\n  parent: cdn\\n  name: afdEndpointName\\n}\\n\\nresource custom_domains 'Microsoft.Cdn/profiles/customdomains@2021-06-01' existing = [for config in customDomains: {\\n  parent: cdn\\n  name: replace(config.hostname, '.', '-')\\n}]\\n\\nresource origin_group 'Microsoft.Cdn/profiles/originGroups@2021-06-01' existing = [for (group, index) in origins: {\\n  parent: cdn\\n  name: group.originGroupName\\n}]\\n\\nresource origin_routes 'Microsoft.Cdn/profiles/afdendpoints/routes@2021-06-01' = [ for (group, index) in origins: {\\n  parent: afd_endpoint\\n  name: '${group.originGroupName}-route'\\n  properties: {\\n    cacheConfiguration: {\\n      compressionSettings: {\\n        isCompressionEnabled: true\\n        contentTypesToCompress: contentTypeCompressionList\\n      }\\n      queryStringCachingBehavior: 'UseQueryString'\\n    }\\n    customDomains: [ for (domain, cid) in customDomains: {\\n      id: custom_domains[cid].id\\n    }]\\n    originGroup: {\\n      id: origin_group[index].id\\n    }\\n    ruleSets: routeRuleSets\\n    supportedProtocols: [\\n      'Https'\\n    ]\\n    patternsToMatch: group.patternsToMatch\\n    forwardingProtocol: 'HttpsOnly'\\n    linkToDefaultDomain: 'Enabled'\\n    httpsRedirect: 'Enabled'\\n    enabledState: 'Enabled'\\n  }\\n}]\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"origins\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"customDomains\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"cdnProfileName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"afdEndpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"routeRuleSets\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the managed identity resource.')\\nparam managedIdentityName string\\n\\n@description('The IDs of the role definitions to assign to the managed identity. Each role assignment is created at the resource group scope. Role definition IDs are GUIDs. To find the GUID for built-in Azure role definitions, see https://docs.microsoft.com/azure/role-based-access-control/built-in-roles. You can also use IDs of custom role definitions.')\\nparam roleDefinitionIds array\\n\\n@description('An optional description to apply to each role assignment, such as the reason this managed identity needs to be granted the role.')\\nparam roleAssignmentDescription string = ''\\n\\n@description('The Azure location where the managed identity should be created.')\\nparam location string = resourceGroup().location\\n\\nvar roleAssignmentsToCreate = [for roleDefinitionId in roleDefinitionIds: {\\n  name: guid(managedIdentity.id, resourceGroup().id, roleDefinitionId)\\n  roleDefinitionId: roleDefinitionId\\n}]\\n\\nresource managedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\\n  name: managedIdentityName\\n  location: location\\n}\\n\\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2020-04-01-preview' = [for roleAssignmentToCreate in roleAssignmentsToCreate: {\\n  name: roleAssignmentToCreate.name\\n  scope: resourceGroup()\\n  properties: {\\n    description: roleAssignmentDescription\\n    principalId: managedIdentity.properties.principalId\\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', roleAssignmentToCreate.roleDefinitionId)\\n    principalType: 'ServicePrincipal' // See https://docs.microsoft.com/azure/role-based-access-control/role-assignments-template#new-service-principal to understand why this property is included.\\n  }\\n}]\\n\\n@description('The resource ID of the user-assigned managed identity.')\\noutput managedIdentityResourceId string = managedIdentity.id\\n\\n@description('The ID of the Azure AD application associated with the managed identity.')\\noutput managedIdentityClientId string = managedIdentity.properties.clientId\\n\\n@description('The ID of the Azure AD service principal associated with the managed identity.')\\noutput managedIdentityPrincipalId string = managedIdentity.properties.principalId\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"managedIdentityName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"roleDefinitionIds\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"roleAssignmentDescription\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the Azure Analysis Services server to create. Server name must begin with a letter, be lowercase alphanumeric, and between 3 and 63 characters in length. Server name must be unique per region.')\\nparam serverName string\\n\\n@description('Location of the Azure Analysis Services server. For supported regions, see https://docs.microsoft.com/en-us/azure/analysis-services/analysis-services-overview#availability-by-region')\\nparam location string = resourceGroup().location\\n\\n@description('The sku name of the Azure Analysis Services server to create. Choose from: B1, B2, D1, S0, S1, S2, S3, S4, S8, S9. Some skus are region specific. See https://docs.microsoft.com/en-us/azure/analysis-services/analysis-services-overview#availability-by-region')\\nparam skuName string = 'S0'\\n\\n@description('The total number of query replica scale-out instances. Scale-out of more than one instance is supported on selected regions only. See https://docs.microsoft.com/en-us/azure/analysis-services/analysis-services-overview#availability-by-region')\\nparam capacity int = 1\\n\\n@description('The inbound firewall rules to define on the server. If not specified, firewall is disabled.')\\nparam firewallSettings object = {\\n  firewallRules: [\\n    {\\n      firewallRuleName: 'AllowFromAll'\\n      rangeStart: '0.0.0.0'\\n      rangeEnd: '255.255.255.255'\\n    }\\n  ]\\n  enablePowerBIService: true\\n}\\n\\n@description('The SAS URI to a private Azure Blob Storage container with read, write and list permissions. Required only if you intend to use the backup/restore functionality. See https://docs.microsoft.com/en-us/azure/analysis-services/analysis-services-backup')\\nparam backupBlobContainerUri string = ''\\n\\nresource server 'Microsoft.AnalysisServices/servers@2017-08-01' = {\\n  name: serverName\\n  location: location\\n  sku: {\\n    name: skuName\\n    capacity: capacity\\n  }\\n  properties: {\\n    ipV4FirewallSettings: firewallSettings\\n    backupBlobContainerUri: backupBlobContainerUri\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"serverName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"skuName\\\": {\\n      \\\"value\\\": \\\"S0\\\"\\n    },\\n    \\\"capacity\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"firewallSettings\\\": {\\n      \\\"value\\\": \\\"{\\\"\\n    },\\n    \\\"backupBlobContainerUri\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The email address of the owner of the service')\\n@minLength(1)\\nparam publisherEmail string = 'constoso@contoso.com'\\n\\n@description('The name of the owner of the service')\\n@minLength(1)\\nparam publisherName string = 'apimPublisher'\\n\\n@description('The pricing tier of this API Management service')\\n@allowed([\\n  'Developer'\\n  'Premium'\\n])\\nparam sku string = 'Premium'\\n\\n@description('The instance size of this API Management service. This should be a multiple of the number of availability zones getting deployed.')\\nparam skuCount int = 2\\n\\n@description('Virtual network name')\\nparam virtualNetworkName string = 'apimvnet'\\n\\n@description('Address prefix')\\nparam virtualNetworkAddressPrefix string = '10.0.0.0/16'\\n\\n@description('Subnet prefix')\\nparam subnetPrefix string = '10.0.0.0/24'\\n\\n@description('Subnet name')\\nparam subnetName string = 'apim'\\n\\n@description('Service endpoints enabled on the API Management subnet')\\nparam apimSubnetServiceEndpoints array = [\\n  {\\n    service: 'Microsoft.Storage'\\n  }\\n  {\\n    service: 'Microsoft.Sql'\\n  }\\n  {\\n    service: 'Microsoft.EventHub'\\n  }\\n]\\n\\n@description('Azure region where the resources will be deployed')\\nparam location string = resourceGroup().location\\n\\n@description('Numbers for availability zones, for example, 1,2,3.')\\nparam availabilityZones array = [\\n  '1'\\n  '2'\\n]\\n\\n@description('Name for the public IP address used to access the API Management service.')\\nparam publicIpName string = 'myPublicIP'\\n\\n@description('SKU for the public IP address used to access the API Management service.')\\n@allowed([\\n  'Standard'\\n])\\nparam publicIpSku string = 'Standard'\\n\\n@description('Allocation method for the public IP address used to access the API Management service. Standard SKU public IP requires `Static` allocation.')\\n@allowed([\\n  'Static'\\n])\\nparam publicIPAllocationMethod string = 'Static'\\n\\n@description('Unique DNS name for the public IP address used to access the API management service.')\\nparam dnsLabelPrefix string = toLower('${publicIpName}-${uniqueString(resourceGroup().id)}')\\n\\nvar apiManagementName = 'apiservice${uniqueString(resourceGroup().id)}'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar nsgName = 'apimnsg${uniqueString(resourceGroup().id)}'\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2020-06-01' = {\\n  name: nsgName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'Client_communication_to_API_Management'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '80'\\n          sourceAddressPrefix: 'Internet'\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'Secure_Client_communication_to_API_Management'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '443'\\n          sourceAddressPrefix: 'Internet'\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 110\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'Management_endpoint_for_Azure_portal_and_Powershell'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '3443'\\n          sourceAddressPrefix: 'ApiManagement'\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 120\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'Dependency_on_Redis_Cache'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '6381-6383'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 130\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'Dependency_to_sync_Rate_Limit_Inbound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '4290'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 135\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'Dependency_on_Azure_SQL'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '1433'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'Sql'\\n          access: 'Allow'\\n          priority: 140\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'Dependency_for_Log_to_event_Hub_policy'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          destinationPortRange: '5671'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'EventHub'\\n          access: 'Allow'\\n          priority: 150\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'Dependency_on_Redis_Cache_outbound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '6381-6383'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 160\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'Depenedency_To_sync_RateLimit_Outbound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '4290'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 165\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'Dependency_on_Azure_File_Share_for_GIT'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '445'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'Storage'\\n          access: 'Allow'\\n          priority: 170\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'Azure_Infrastructure_Load_Balancer'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '6390'\\n          sourceAddressPrefix: 'AzureLoadBalancer'\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 180\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'Publish_DiagnosticLogs_And_Metrics'\\n        properties: {\\n          description: 'API Management logs and metrics for consumption by admins and your IT team are all part of the management plane'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'AzureMonitor'\\n          access: 'Allow'\\n          priority: 185\\n          direction: 'Outbound'\\n          destinationPortRanges: [\\n            '443'\\n            '12000'\\n            '1886'\\n          ]\\n        }\\n      }\\n      {\\n        name: 'Connect_To_SMTP_Relay_For_SendingEmails'\\n        properties: {\\n          description: 'APIM features the ability to generate email traffic as part of the data plane and the management plane'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'Internet'\\n          access: 'Allow'\\n          priority: 190\\n          direction: 'Outbound'\\n          destinationPortRanges: [\\n            '25'\\n            '587'\\n            '25028'\\n          ]\\n        }\\n      }\\n      {\\n        name: 'Authenticate_To_Azure_Active_Directory'\\n        properties: {\\n          description: 'Connect to Azure Active Directory for developer Portal authentication or for OAuth 2 flow during any proxy authentication'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'AzureActiveDirectory'\\n          access: 'Allow'\\n          priority: 200\\n          direction: 'Outbound'\\n          destinationPortRanges: [\\n            '80'\\n            '443'\\n          ]\\n        }\\n      }\\n      {\\n        name: 'Dependency_on_Azure_Storage'\\n        properties: {\\n          description: 'API Management service dependency on Azure blob and Azure table storage'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '443'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'Storage'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'Publish_Monitoring_Logs'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: '443'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'AzureCloud'\\n          access: 'Allow'\\n          priority: 300\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'Access_KeyVault'\\n        properties: {\\n          description: 'Allow API Management service control plane access to Azure Key Vault to refresh secrets'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'AzureKeyVault'\\n          access: 'Allow'\\n          priority: 350\\n          direction: 'Outbound'\\n          destinationPortRanges: [\\n            '443'\\n          ]\\n        }\\n      }\\n      {\\n        name: 'Deny_All_Internet_Outbound'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          destinationPortRange: '*'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationAddressPrefix: 'Internet'\\n          access: 'Deny'\\n          priority: 999\\n          direction: 'Outbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIp 'Microsoft.Network/publicIPAddresses@2020-05-01' = {\\n  name: publicIpName\\n  location: location\\n  sku: {\\n    name: publicIpSku\\n  }\\n  properties: {\\n    publicIPAllocationMethod: publicIPAllocationMethod\\n    publicIPAddressVersion: 'IPv4'\\n    dnsSettings: {\\n      domainNameLabel: dnsLabelPrefix\\n    }\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-06-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        virtualNetworkAddressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: nsg.id\\n          }\\n          serviceEndpoints: apimSubnetServiceEndpoints\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource apiManagement 'Microsoft.ApiManagement/service@2021-08-01' = {\\n  name: apiManagementName\\n  location: location\\n  sku: {\\n    name: sku\\n    capacity: skuCount\\n  }\\n  zones: ((length(availabilityZones) == 0) ? null : availabilityZones)\\n  properties: {\\n    publisherEmail: publisherEmail\\n    publisherName: publisherName\\n    virtualNetworkType: 'External'\\n    publicIpAddressId: publicIp.id\\n    virtualNetworkConfiguration: {\\n      subnetResourceId: subnetRef\\n    }\\n    customProperties: {\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30': 'false'\\n      'Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2': 'false'\\n    }\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"publisherEmail\\\": {\\n      \\\"value\\\": \\\"constoso@contoso.com\\\"\\n    },\\n    \\\"publisherName\\\": {\\n      \\\"value\\\": \\\"apimPublisher\\\"\\n    },\\n    \\\"sku\\\": {\\n      \\\"value\\\": \\\"Premium\\\"\\n    },\\n    \\\"skuCount\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"apimvnet\\\"\\n    },\\n    \\\"virtualNetworkAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"subnetPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/24\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"apim\\\"\\n    },\\n    \\\"apimSubnetServiceEndpoints\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"availabilityZones\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"publicIpName\\\": {\\n      \\\"value\\\": \\\"myPublicIP\\\"\\n    },\\n    \\\"publicIpSku\\\": {\\n      \\\"value\\\": \\\"Standard\\\"\\n    },\\n    \\\"publicIPAllocationMethod\\\": {\\n      \\\"value\\\": \\\"Static\\\"\\n    },\\n    \\\"dnsLabelPrefix\\\": {\\n      \\\"value\\\": \\\"toLower('${publicIpName}-${uniqueString(resourceGroup().id)}')\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The email address of the owner of the service')\\n@minLength(1)\\nparam publisherEmail string\\n\\n@description('The name of the owner of the service')\\n@minLength(1)\\nparam publisherName string\\n\\n@description('The pricing tier of this API Management service')\\n@allowed([\\n  'Basic'\\n  'Consumption'\\n  'Developer'\\n  'Standard'\\n  'Premium'\\n])\\nparam sku string = 'Developer'\\n\\n@description('The instance size of this API Management service.')\\nparam skuCount int = 1\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nresource apiservice_id 'Microsoft.ApiManagement/service@2021-08-01' = {\\n  name: 'apiservice${uniqueString(resourceGroup().id)}'\\n  location: location\\n  sku: {\\n    name: sku\\n    capacity: skuCount\\n  }\\n  properties: {\\n    publisherEmail: publisherEmail\\n    publisherName: publisherName\\n  }\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"publisherEmail\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"publisherName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sku\\\": {\\n      \\\"value\\\": \\\"Developer\\\"\\n    },\\n    \\\"skuCount\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The email address of the owner of the service')\\n@minLength(1)\\nparam apiManagementPublisherEmail string\\n\\n@description('The name of the owner of the service')\\n@minLength(1)\\nparam apiManagementPublisherName string\\n\\n@description('The pricing tier of this API Management service')\\n@allowed([\\n  'Developer'\\n  'Standard'\\n  'Premium'\\n])\\nparam apiManagementSku string = 'Developer'\\n\\n@description('The instance size of this API Management service.')\\nparam apiManagementSkuCount int = 1\\n\\n@description('Select the SKU for your workspace')\\n@allowed([\\n  'pergb2018'\\n  'Free'\\n  'Standalone'\\n  'PerNode'\\n  'Standard'\\n  'Premium'\\n])\\nparam omsSku string = 'PerNode'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nvar apiManagementServiceName = 'apiservice${uniqueString(resourceGroup().id)}'\\nvar omsWorkspaceName = 'omsworkspace${uniqueString(resourceGroup().id)}'\\n\\nresource apiManagementService 'Microsoft.ApiManagement/service@2021-08-01' = {\\n  name: apiManagementServiceName\\n  location: location\\n  sku: {\\n    name: apiManagementSku\\n    capacity: apiManagementSkuCount\\n  }\\n  properties: {\\n    publisherEmail: apiManagementPublisherEmail\\n    publisherName: apiManagementPublisherName\\n  }\\n}\\n\\nresource omsWorkspace 'Microsoft.OperationalInsights/workspaces@2020-08-01' = {\\n  name: omsWorkspaceName\\n  location: location\\n  properties: {\\n    sku: {\\n      name: omsSku\\n    }\\n  }\\n}\\n\\nresource apiManagementServiceName_Microsoft_Insights_service 'Microsoft.ApiManagement/service/providers/diagnosticSettings@2021-05-01-preview' = {\\n  name: '${apiManagementServiceName}/Microsoft.Insights/service'\\n  properties: {\\n    workspaceId: omsWorkspace.id\\n    logs: [\\n      {\\n        category: 'GatewayLogs'\\n        enabled: true\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    apiManagementService\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"apiManagementPublisherEmail\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"apiManagementPublisherName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"apiManagementSku\\\": {\\n      \\\"value\\\": \\\"Developer\\\"\\n    },\\n    \\\"apiManagementSkuCount\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"omsSku\\\": {\\n      \\\"value\\\": \\\"PerNode\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param eventHubNsName string\\nparam eventHubName string\\nparam eventHubSendPolicyName string = 'evt-hub-apim-send-policy'\\nparam eventHubListenPolicy string = 'evt-hub-app-consume-policy'\\nparam ehNsSkuName string = 'Standard'\\nparam ehNsSkuTier string = 'Standard'\\nparam ehNsSkuCapacity int = 1\\nparam ehNsIsAutoInflateEnabled bool = false\\nparam ehNsMaximumThroughputUnits int = 0\\nparam ehNsZoneRedundant bool = false\\n\\n@description('Number of days to retain messages in eventhub')\\nparam messageRetentionInDays int = 1\\nparam tags object = {}\\n\\n@description('Location for all resources.')\\nparam location string\\n\\nresource eventHubNs 'Microsoft.EventHub/namespaces@2022-01-01-preview' = {\\n  name: eventHubNsName\\n  location: location\\n  tags: tags\\n  sku: {\\n    name: ehNsSkuName\\n    tier: ehNsSkuTier\\n    capacity: ehNsSkuCapacity\\n  }\\n  properties: {\\n    isAutoInflateEnabled: ehNsIsAutoInflateEnabled\\n    maximumThroughputUnits: ehNsMaximumThroughputUnits\\n    zoneRedundant: ehNsZoneRedundant\\n  }\\n}\\n\\nresource eventHubNsName_eventHub 'Microsoft.EventHub/namespaces/eventhubs@2022-01-01-preview' = {\\n  parent: eventHubNs\\n  name: '${eventHubName}'\\n  properties: {\\n    messageRetentionInDays: messageRetentionInDays\\n    partitionCount: 2\\n    status: 'Active'\\n  }\\n}\\n\\nresource eventHubNsName_eventHubName_eventHubSendPolicy 'Microsoft.EventHub/namespaces/eventhubs/authorizationRules@2022-01-01-preview' = {\\n  parent: eventHubNsName_eventHub\\n  name: eventHubSendPolicyName\\n  properties: {\\n    rights: [\\n      'Send'\\n    ]\\n  }\\n}\\n\\nresource eventHubNsName_eventHubListenPolicy 'Microsoft.EventHub/namespaces/authorizationRules@2022-01-01-preview' = {\\n  parent: eventHubNs\\n  name: '${eventHubListenPolicy}'\\n  properties: {\\n    rights: [\\n      'Manage'\\n      'Listen'\\n      'Send'\\n    ]\\n  }\\n}\\n\\noutput eventHubNsName string = eventHubNsName\\noutput eventHubName string = eventHubName\\noutput eventHubSendPolicyName string = eventHubSendPolicyName\\noutput eventHubListenPolicy string = eventHubListenPolicy\\noutput eventHubSendResourceId string = eventHubNsName_eventHubName_eventHubSendPolicy.id\\noutput eventHubListenResourceId string = eventHubNsName_eventHubListenPolicy.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"eventHubNsName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"eventHubName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"eventHubSendPolicyName\\\": {\\n      \\\"value\\\": \\\"evt-hub-apim-send-policy\\\"\\n    },\\n    \\\"eventHubListenPolicy\\\": {\\n      \\\"value\\\": \\\"evt-hub-app-consume-policy\\\"\\n    },\\n    \\\"ehNsSkuName\\\": {\\n      \\\"value\\\": \\\"Standard\\\"\\n    },\\n    \\\"ehNsSkuTier\\\": {\\n      \\\"value\\\": \\\"Standard\\\"\\n    },\\n    \\\"ehNsSkuCapacity\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"ehNsIsAutoInflateEnabled\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"ehNsMaximumThroughputUnits\\\": {\\n      \\\"value\\\": 0\\n    },\\n    \\\"ehNsZoneRedundant\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"messageRetentionInDays\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name to be given to this new App Service. This value is used in DNS and must be unique.')\\nparam appServiceName string\\n\\n@description('The name of an existing App Service plan for which the App Service will be created')\\nparam appServicePlanName string\\n\\n@description('sets environment variable APIMEVENTS-EVENTHUB-NAME')\\nparam eventHubNamespace string\\n\\n@description('Sets environment variable APIMEVENTS-EVENTHUB-NAME')\\nparam eventHubName string\\n\\n@description('Name of Event Hubs Namespace listen policy. Found in EventHubNamespace/Settings/Shared access policies: eg \\\\'moesiflogaaaaaa-listen-policy\\\\'')\\nparam eventHubListenPolicy string\\n\\n@description('Sets environment variable APIMEVENTS-STORAGEACCOUNT-NAME')\\nparam apimEvtStorName string\\n\\n@description('Sets environment variable APIMEVENTS-MOESIF-APPLICATION-ID')\\nparam apimEvtMoesifApplicationId string\\n\\n@description('Sets environment variable APIMEVENTS-MOESIF-SESSION-TOKEN')\\nparam apimEvtMoesifSessionToken string = 'optional'\\n\\n@description('Sets environment variable APIMEVENTS-MOESIF-API-VERSION')\\nparam apimEvtMoesifApiVersion string = 'v1'\\n\\n@description('DNS name to use for azure webapp such as .azurewebsites.net')\\nparam azureWebsitesDomain string\\nparam tags object = {}\\n\\n@description('Location for all resources. eg \\\\'westus2\\\\'')\\nparam location string\\n\\nvar appServiceHostName = '${appServiceName}${azureWebsitesDomain}'\\n\\nresource appService 'Microsoft.Web/sites@2022-03-01' = {\\n  name: appServiceName\\n  location: location\\n  tags: tags\\n  kind: 'app'\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  properties: {\\n    enabled: true\\n    hostNameSslStates: [\\n      {\\n        name: appServiceHostName\\n        sslState: 'Disabled'\\n        hostType: 'Standard'\\n      }\\n      {\\n        name: '${appServiceName}.scm${azureWebsitesDomain}'\\n        sslState: 'Disabled'\\n        hostType: 'Repository'\\n      }\\n    ]\\n    serverFarmId: resourceId('Microsoft.Web/serverfarms', appServicePlanName)\\n    reserved: false\\n    isXenon: false\\n    hyperV: false\\n    siteConfig: {\\n      appSettings: [\\n        {\\n          name: 'APIMEVENTS-EVENTHUB-CONNECTIONSTRING'\\n          value: listKeys(resourceId('Microsoft.EventHub/namespaces/authorizationRules', eventHubNamespace, eventHubListenPolicy), '2021-11-01').primaryConnectionString\\n        }\\n        {\\n          name: 'APIMEVENTS-EVENTHUB-NAME'\\n          value: eventHubName\\n        }\\n        {\\n          name: 'APIMEVENTS-STORAGEACCOUNT-NAME'\\n          value: apimEvtStorName\\n        }\\n        {\\n          name: 'APIMEVENTS-STORAGEACCOUNT-KEY'\\n          value: listKeys(resourceId('Microsoft.Storage/storageAccounts', apimEvtStorName), '2021-02-01').keys[0].value\\n        }\\n        {\\n          name: 'APIMEVENTS-MOESIF-APPLICATION-ID'\\n          value: apimEvtMoesifApplicationId\\n        }\\n        {\\n          name: 'APIMEVENTS-MOESIF-SESSION-TOKEN'\\n          value: apimEvtMoesifSessionToken\\n        }\\n        {\\n          name: 'APIMEVENTS-MOESIF-API-VERSION'\\n          value: apimEvtMoesifApiVersion\\n        }\\n      ]\\n    }\\n    scmSiteAlsoStopped: false\\n    clientAffinityEnabled: true\\n    clientCertEnabled: false\\n    hostNamesDisabled: false\\n    containerSize: 0\\n    dailyMemoryTimeQuota: 0\\n    httpsOnly: true\\n    redundancyMode: 'None'\\n  }\\n}\\n\\nresource appServiceName_web 'Microsoft.Web/sites/config@2022-03-01' = {\\n  parent: appService\\n  name: 'web'\\n  properties: {\\n    netFrameworkVersion: 'v5.0'\\n    logsDirectorySizeLimit: 60\\n    numberOfWorkers: 1\\n    alwaysOn: true\\n    detailedErrorLoggingEnabled: true\\n    httpLoggingEnabled: true\\n    requestTracingEnabled: true\\n    ftpsState: 'Disabled'\\n    minTlsVersion: '1.2'\\n    defaultDocuments: [\\n      'Default.htm'\\n      'Default.html'\\n      'Default.asp'\\n      'index.htm'\\n      'index.html'\\n      'iisstart.htm'\\n      'default.aspx'\\n      'index.php'\\n      'hostingstart.html'\\n    ]\\n  }\\n  dependsOn: [\\n    appServiceName_appServiceHost\\n  ]\\n}\\n\\nresource appServiceName_appServiceHost 'Microsoft.Web/sites/hostNameBindings@2022-03-01' = {\\n  parent: appService\\n  name: appServiceHostName\\n  properties: {\\n    siteName: appServiceName\\n    hostNameType: 'Verified'\\n  }\\n}\\n\\noutput appServiceName string = appServiceName\\noutput appServiceHostName string = appServiceHostName\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"appServiceName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"appServicePlanName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"eventHubNamespace\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"eventHubName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"eventHubListenPolicy\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"apimEvtStorName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"apimEvtMoesifApplicationId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"apimEvtMoesifSessionToken\\\": {\\n      \\\"value\\\": \\\"optional\\\"\\n    },\\n    \\\"apimEvtMoesifApiVersion\\\": {\\n      \\\"value\\\": \\\"v1\\\"\\n    },\\n    \\\"azureWebsitesDomain\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the API Management service instance')\\nparam apiManagementServiceName string = 'apiservice${uniqueString(resourceGroup().id)}'\\n\\n@description('The email address of the owner of the service')\\n@minLength(1)\\nparam publisherEmail string\\n\\n@description('The name of the owner of the service')\\n@minLength(1)\\nparam publisherName string\\n\\n@description('The pricing tier of this API Management service')\\n@allowed([\\n  'Consumption'\\n  'Developer'\\n  'Basic'\\n  'Basicv2'\\n  'Standard'\\n  'Standardv2'\\n  'Premium'\\n])\\nparam sku string = 'Developer'\\n\\n@description('The instance size of this API Management service.')\\n@allowed([\\n  0\\n  1\\n  2\\n])\\nparam skuCount int = 1\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nresource apiManagementService 'Microsoft.ApiManagement/service@2023-05-01-preview' = {\\n  name: apiManagementServiceName\\n  location: location\\n  sku: {\\n    name: sku\\n    capacity: skuCount\\n  }\\n  properties: {\\n    publisherEmail: publisherEmail\\n    publisherName: publisherName\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"apiManagementServiceName\\\": {\\n      \\\"value\\\": \\\"apiservice${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"publisherEmail\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"publisherName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sku\\\": {\\n      \\\"value\\\": \\\"Developer\\\"\\n    },\\n    \\\"skuCount\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies the name of the container app.')\\nparam containerAppName string = 'containerapp-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specifies the name of the container app environment.')\\nparam containerAppEnvName string = 'containerapp-env-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specifies the name of the log analytics workspace.')\\nparam containerAppLogAnalyticsName string = 'containerapp-log-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specifies the location for all resources.')\\n@allowed([\\n  'northcentralusstage'\\n  'eastus'\\n  'northeurope'\\n  'canadacentral'\\n])\\nparam location string\\n\\n@description('Specifies the docker container image to deploy.')\\nparam frontendContainerImage string = 'mcr.microsoft.com/azuredocs/azure-vote-front:v1'\\n\\n@description('Specifies the docker container image to deploy for the Redis backend.')\\nparam backendContainerImage string = 'mcr.microsoft.com/oss/bitnami/redis:6.0.8'\\n\\n@description('Minimum number of replicas that will be deployed')\\n@minValue(0)\\n@maxValue(25)\\nparam minReplica int = 1\\n\\n@description('Maximum number of replicas that will be deployed')\\n@minValue(0)\\n@maxValue(25)\\nparam maxReplica int = 3\\n\\nresource logAnalytics 'Microsoft.OperationalInsights/workspaces@2021-06-01' = {\\n  name: containerAppLogAnalyticsName\\n  location: location\\n  properties: {\\n    sku: {\\n      name: 'PerGB2018'\\n    }\\n  }\\n}\\n\\nresource containerAppEnv 'Microsoft.App/managedEnvironments@2022-01-01-preview' = {\\n  name: containerAppEnvName\\n  location: location\\n  properties: {\\n    appLogsConfiguration: {\\n      destination: 'log-analytics'\\n      logAnalyticsConfiguration: {\\n        customerId: logAnalytics.properties.customerId\\n        sharedKey: logAnalytics.listKeys().primarySharedKey\\n      }\\n    }\\n  }\\n}\\n\\nresource containerApp 'Microsoft.App/containerApps@2022-01-01-preview' = {\\n  name: containerAppName\\n  location: location\\n  properties: {\\n    managedEnvironmentId: containerAppEnv.id\\n    configuration: {\\n      ingress: {\\n        external: true\\n        targetPort: 80\\n        allowInsecure: false\\n        traffic: [\\n          {\\n            latestRevision: true\\n            weight: 100\\n          }\\n        ]\\n      }\\n    }\\n    template: {\\n      revisionSuffix: 'firstrevision'\\n      containers: [\\n        {\\n          name: containerAppName\\n          image: frontendContainerImage\\n          env: [\\n            {\\n              name: 'REDIS'\\n              value: 'localhost'\\n            }\\n          ]\\n          resources: {\\n            cpu: json('.25')\\n            memory: '.5Gi'\\n          }\\n        }\\n        {\\n          name: 'redis'\\n          image: backendContainerImage\\n          env: [\\n            {\\n              name: 'ALLOW_EMPTY_PASSWORD'\\n              value: 'yes'\\n            }\\n          ]\\n          resources: {\\n            cpu: json('.25')\\n            memory: '.5Gi'\\n          }\\n        }\\n      ]\\n      scale: {\\n        minReplicas: minReplica\\n        maxReplicas: maxReplica\\n        rules: [\\n          {\\n            name: 'http-requests'\\n            http: {\\n              metadata: {\\n                concurrentRequests: '10'\\n              }\\n            }\\n          }\\n        ]\\n      }\\n    }\\n  }\\n}\\n\\noutput containerAppFQDN string = containerApp.properties.configuration.ingress.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"containerAppName\\\": {\\n      \\\"value\\\": \\\"containerapp-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"containerAppEnvName\\\": {\\n      \\\"value\\\": \\\"containerapp-env-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"containerAppLogAnalyticsName\\\": {\\n      \\\"value\\\": \\\"containerapp-log-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"frontendContainerImage\\\": {\\n      \\\"value\\\": \\\"mcr.microsoft.com/azuredocs/azure-vote-front:v1\\\"\\n    },\\n    \\\"backendContainerImage\\\": {\\n      \\\"value\\\": \\\"mcr.microsoft.com/oss/bitnami/redis:6.0.8\\\"\\n    },\\n    \\\"minReplica\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"maxReplica\\\": {\\n      \\\"value\\\": 3\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies the name of the container app.')\\nparam containerAppName string = 'app-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specifies the name of the container app environment.')\\nparam containerAppEnvName string = 'env-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specifies the name of the log analytics workspace.')\\nparam containerAppLogAnalyticsName string = 'log-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specifies the name of the virtual network.')\\nparam virtualNetworkName string = 'vnet-${uniqueString(resourceGroup().id)}'\\n\\n@description('Address prefix')\\nparam vnetAddressPrefix string = '10.0.0.0/16'\\n\\n@description('Container App environment subnet name')\\nparam containerAppEnvSubnetName string = 'Subnet1'\\n\\n@description('Container App environment subnet prefix')\\nparam containerAppEnvSubnetPrefix string = '10.0.0.0/23'\\n\\n@description('Specifies the location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Specifies the docker container image to deploy.')\\nparam containerImage string = 'mcr.microsoft.com/azuredocs/containerapps-helloworld:latest'\\n\\n@description('Specifies the container port.')\\nparam targetPort int = 80\\n\\n@description('Number of CPU cores the container can use. Can be with a maximum of two decimals.')\\n@allowed([\\n  '0.25'\\n  '0.5'\\n  '0.75'\\n  '1'\\n  '1.25'\\n  '1.5'\\n  '1.75'\\n  '2'\\n])\\nparam cpuCore string = '0.5'\\n\\n@description('Amount of memory (in gibibytes, GiB) allocated to the container up to 4GiB. Can be with a maximum of two decimals. Ratio with CPU cores must be equal to 2.')\\n@allowed([\\n  '0.5'\\n  '1'\\n  '1.5'\\n  '2'\\n  '3'\\n  '3.5'\\n  '4'\\n])\\nparam memorySize string = '1'\\n\\n@description('Minimum number of replicas that will be deployed')\\n@minValue(0)\\n@maxValue(25)\\nparam minReplicas int = 1\\n\\n@description('Maximum number of replicas that will be deployed')\\n@minValue(0)\\n@maxValue(25)\\nparam maxReplicas int = 3\\n\\nresource containerAppLogAnalytics 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {\\n  name: containerAppLogAnalyticsName\\n  location: location\\n  properties: {\\n    sku: {\\n      name: 'PerGB2018'\\n    }\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetAddressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: containerAppEnvSubnetName\\n        properties: {\\n          addressPrefix: containerAppEnvSubnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource containerAppEnv 'Microsoft.App/managedEnvironments@2022-03-01' = {\\n  name: containerAppEnvName\\n  location: location\\n  properties: {\\n    appLogsConfiguration: {\\n      destination: 'log-analytics'\\n      logAnalyticsConfiguration: {\\n        customerId: reference(containerAppLogAnalytics.id, '2022-10-01').customerId\\n        sharedKey: listKeys(containerAppLogAnalytics.id, '2022-10-01').primarySharedKey\\n      }\\n    }\\n    vnetConfiguration: {\\n      infrastructureSubnetId: reference(virtualNetwork.id, '2022-07-01').subnets[0].id\\n    }\\n  }\\n}\\n\\nresource containerApp 'Microsoft.App/containerApps@2022-03-01' = {\\n  name: containerAppName\\n  location: location\\n  properties: {\\n    managedEnvironmentId: containerAppEnv.id\\n    configuration: {\\n      ingress: {\\n        external: true\\n        targetPort: targetPort\\n        allowInsecure: false\\n        traffic: [\\n          {\\n            latestRevision: true\\n            weight: 100\\n          }\\n        ]\\n      }\\n    }\\n    template: {\\n      revisionSuffix: 'firstrevision'\\n      containers: [\\n        {\\n          name: containerAppName\\n          image: containerImage\\n          resources: {\\n            cpu: json(cpuCore)\\n            memory: '${memorySize}Gi'\\n          }\\n        }\\n      ]\\n      scale: {\\n        minReplicas: minReplicas\\n        maxReplicas: maxReplicas\\n      }\\n    }\\n  }\\n}\\n\\noutput containerAppFQDN string = reference(containerApp.id, '2022-03-01').configuration.ingress.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"containerAppName\\\": {\\n      \\\"value\\\": \\\"app-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"containerAppEnvName\\\": {\\n      \\\"value\\\": \\\"env-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"containerAppLogAnalyticsName\\\": {\\n      \\\"value\\\": \\\"log-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"vnet-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"vnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"containerAppEnvSubnetName\\\": {\\n      \\\"value\\\": \\\"Subnet1\\\"\\n    },\\n    \\\"containerAppEnvSubnetPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/23\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"containerImage\\\": {\\n      \\\"value\\\": \\\"mcr.microsoft.com/azuredocs/containerapps-helloworld:latest\\\"\\n    },\\n    \\\"targetPort\\\": {\\n      \\\"value\\\": 80\\n    },\\n    \\\"cpuCore\\\": {\\n      \\\"value\\\": \\\"0.5\\\"\\n    },\\n    \\\"memorySize\\\": {\\n      \\\"value\\\": \\\"1\\\"\\n    },\\n    \\\"minReplicas\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"maxReplicas\\\": {\\n      \\\"value\\\": 3\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies the name of the App Configuration store.')\\nparam configStoreName string = 'appconfig${uniqueString(resourceGroup().id)}'\\n\\n@description('Specifies the Azure location where the app configuration store should be created.')\\nparam location string = resourceGroup().location\\n\\n@description('Specifies the key of the feature flag.')\\nparam featureFlagKey string = 'FeatureFlagSample'\\n\\n@description('Specifies the label of the feature flag. The label is optional and can be left as empty.')\\nparam featureFlagLabel string = ''\\n\\nvar featureFlagValue = {\\n  id: featureFlagKey\\n  description: 'Your description.'\\n  enabled: true\\n}\\n\\nresource configStore 'Microsoft.AppConfiguration/configurationStores@2024-05-01' = {\\n  name: configStoreName\\n  location: location\\n  sku: {\\n    name: 'standard'\\n  }\\n  properties: {}\\n}\\n\\nresource configStoreName_appconfig_featureflag_2F_featureFlagKey_featureFlagLabel 'Microsoft.AppConfiguration/configurationStores/keyValues@2024-05-01' = {\\n  parent: configStore\\n  name: '.appconfig.featureflag~2F${featureFlagKey}$${featureFlagLabel}'\\n  properties: {\\n    value: string(featureFlagValue)\\n    contentType: 'application/vnd.microsoft.appconfig.ff+json;charset=utf-8'\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"configStoreName\\\": {\\n      \\\"value\\\": \\\"appconfig${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"featureFlagKey\\\": {\\n      \\\"value\\\": \\\"FeatureFlagSample\\\"\\n    },\\n    \\\"featureFlagLabel\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Specifies the base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation. When the template is deployed using the accompanying scripts, a sasToken will be automatically generated.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nvar _fxv_0 = {\\n  analysisServicesServers: 'as'\\n  apiManagementService: 'apim-'\\n  appConfigurationConfigurationStores: 'appcs-'\\n  appManagedEnvironments: 'cae-'\\n  appContainerApps: 'ca-'\\n  authorizationPolicyDefinitions: 'policy-'\\n  automationAutomationAccounts: 'aa-'\\n  blueprintBlueprints: 'bp-'\\n  blueprintBlueprintsArtifacts: 'bpa-'\\n  cacheRedis: 'redis-'\\n  cdnProfiles: 'cdnp-'\\n  cdnProfilesEndpoints: 'cdne-'\\n  cognitiveServicesAccounts: 'cog-'\\n  cognitiveServicesFormRecognizer: 'cog-fr-'\\n  cognitiveServicesTextAnalytics: 'cog-ta-'\\n  computeAvailabilitySets: 'avail-'\\n  computeCloudServices: 'cld-'\\n  computeDiskEncryptionSets: 'des'\\n  computeDisks: 'disk'\\n  computeDisksOs: 'osdisk'\\n  computeGalleries: 'gal'\\n  computeSnapshots: 'snap-'\\n  computeVirtualMachines: 'vm'\\n  computeVirtualMachineScaleSets: 'vmss-'\\n  containerInstanceContainerGroups: 'ci'\\n  containerRegistryRegistries: 'cr'\\n  containerServiceManagedClusters: 'aks-'\\n  databricksWorkspaces: 'dbw-'\\n  dataFactoryFactories: 'adf-'\\n  dataLakeAnalyticsAccounts: 'dla'\\n  dataLakeStoreAccounts: 'dls'\\n  dataMigrationServices: 'dms-'\\n  dBforMySQLServers: 'mysql-'\\n  dBforPostgreSQLServers: 'psql-'\\n  devicesIotHubs: 'iot-'\\n  devicesProvisioningServices: 'provs-'\\n  devicesProvisioningServicesCertificates: 'pcert-'\\n  documentDBDatabaseAccounts: 'cosmos-'\\n  eventGridDomains: 'evgd-'\\n  eventGridDomainsTopics: 'evgt-'\\n  eventGridEventSubscriptions: 'evgs-'\\n  eventHubNamespaces: 'evhns-'\\n  eventHubNamespacesEventHubs: 'evh-'\\n  hdInsightClustersHadoop: 'hadoop-'\\n  hdInsightClustersHbase: 'hbase-'\\n  hdInsightClustersKafka: 'kafka-'\\n  hdInsightClustersMl: 'mls-'\\n  hdInsightClustersSpark: 'spark-'\\n  hdInsightClustersStorm: 'storm-'\\n  hybridComputeMachines: 'arcs-'\\n  insightsActionGroups: 'ag-'\\n  insightsComponents: 'appi-'\\n  keyVaultVaults: 'kv-'\\n  kubernetesConnectedClusters: 'arck'\\n  kustoClusters: 'dec'\\n  kustoClustersDatabases: 'dedb'\\n  logicIntegrationAccounts: 'ia-'\\n  logicWorkflows: 'logic-'\\n  machineLearningServicesWorkspaces: 'mlw-'\\n  managedIdentityUserAssignedIdentities: 'id-'\\n  managementManagementGroups: 'mg-'\\n  migrateAssessmentProjects: 'migr-'\\n  networkApplicationGateways: 'agw-'\\n  networkApplicationSecurityGroups: 'asg-'\\n  networkAzureFirewalls: 'afw-'\\n  networkBastionHosts: 'bas-'\\n  networkConnections: 'con-'\\n  networkDnsZones: 'dnsz-'\\n  networkExpressRouteCircuits: 'erc-'\\n  networkFirewallPolicies: 'afwp-'\\n  networkFirewallPoliciesWebApplication: 'waf'\\n  networkFirewallPoliciesRuleGroups: 'wafrg'\\n  networkFrontDoors: 'fd-'\\n  networkFrontdoorWebApplicationFirewallPolicies: 'fdfp-'\\n  networkLoadBalancersExternal: 'lbe-'\\n  networkLoadBalancersInternal: 'lbi-'\\n  networkLoadBalancersInboundNatRules: 'rule-'\\n  networkLocalNetworkGateways: 'lgw-'\\n  networkNatGateways: 'ng-'\\n  networkNetworkInterfaces: 'nic-'\\n  networkNetworkSecurityGroups: 'nsg-'\\n  networkNetworkSecurityGroupsSecurityRules: 'nsgsr-'\\n  networkNetworkWatchers: 'nw-'\\n  networkPrivateDnsZones: 'pdnsz-'\\n  networkPrivateLinkServices: 'pl-'\\n  networkPublicIPAddresses: 'pip-'\\n  networkPublicIPPrefixes: 'ippre-'\\n  networkRouteFilters: 'rf-'\\n  networkRouteTables: 'rt-'\\n  networkRouteTablesRoutes: 'udr-'\\n  networkTrafficManagerProfiles: 'traf-'\\n  networkVirtualNetworkGateways: 'vgw-'\\n  networkVirtualNetworks: 'vnet-'\\n  networkVirtualNetworksSubnets: 'snet-'\\n  networkVirtualNetworksVirtualNetworkPeerings: 'peer-'\\n  networkVirtualWans: 'vwan-'\\n  networkVpnGateways: 'vpng-'\\n  networkVpnGatewaysVpnConnections: 'vcn-'\\n  networkVpnGatewaysVpnSites: 'vst-'\\n  notificationHubsNamespaces: 'ntfns-'\\n  notificationHubsNamespacesNotificationHubs: 'ntf-'\\n  operationalInsightsWorkspaces: 'log-'\\n  portalDashboards: 'dash-'\\n  powerBIDedicatedCapacities: 'pbi-'\\n  purviewAccounts: 'pview-'\\n  postgresServer: 'pg-'\\n  recoveryServicesVaults: 'rsv-'\\n  resourcesResourceGroups: 'rg-'\\n  searchSearchServices: 'srch-'\\n  serviceBusNamespaces: 'sb-'\\n  serviceBusNamespacesQueues: 'sbq-'\\n  serviceBusNamespacesTopics: 'sbt-'\\n  serviceEndPointPolicies: 'se-'\\n  serviceFabricClusters: 'sf-'\\n  signalRServiceSignalR: 'sigr'\\n  springApps: 'asa-'\\n  sqlManagedInstances: 'sqlmi-'\\n  sqlServers: 'sql-'\\n  sqlServersDataWarehouse: 'sqldw-'\\n  sqlServersDatabases: 'sqldb-'\\n  sqlServersDatabasesStretch: 'sqlstrdb-'\\n  storageStorageAccounts: 'st'\\n  storageStorageAccountsVm: 'stvm'\\n  storSimpleManagers: 'ssimp'\\n  streamAnalyticsCluster: 'asa-'\\n  synapseWorkspaces: 'syn'\\n  synapseWorkspacesAnalyticsWorkspaces: 'synw'\\n  synapseWorkspacesSqlPoolsDedicated: 'syndp'\\n  synapseWorkspacesSqlPoolsSpark: 'synsp'\\n  timeSeriesInsightsEnvironments: 'tsi-'\\n  webServerFarms: 'plan-'\\n  webSitesAppService: 'app-'\\n  webSitesAppServiceEnvironment: 'ase-'\\n  webSitesFunctions: 'func-'\\n  webStaticSites: 'stapp-'\\n}\\nvar abbrs = _fxv_0\\nvar resourceToken = toLower(uniqueString(subscription().id, resourceGroup().name, location))\\nvar asaInstanceName = '${abbrs.springApps}${resourceToken}'\\nvar adminServerAppName = 'admin-server'\\nvar customersServiceAppName = 'customers-service'\\nvar vetsServiceAppName = 'vets-service'\\nvar visitsServiceAppName = 'visits-service'\\nvar apiGatewayAppName = 'api-gateway'\\nvar logAnalyticsName = '${abbrs.operationalInsightsWorkspaces}${resourceToken}'\\nvar applicationInsightsName = '${abbrs.insightsComponents}${resourceToken}'\\nvar applicationInsightsDashboardName = '${abbrs.portalDashboards}${resourceToken}'\\nvar userAssignedManagedIdentityName = '${abbrs.managedIdentityUserAssignedIdentities}${resourceToken}'\\nvar const_ownerRole = '/subscriptions/${subscription().subscriptionId}/providers/Microsoft.Authorization/roleDefinitions/8e3af657-a8ff-443c-a75c-2fe8c4bcb635'\\nvar const_uploadScriptName = 'deploy-jar-to-asa.sh'\\nvar const_checkScriptName = 'check-provision-state.ps1'\\nvar const_checkingBuilderStateDeploymentName = 'checking-build-service-builder-state'\\nvar ref_identityId = userAssignedManagedIdentity.id\\nvar name_deploymentScriptName = 'asa-enterprise-deployment-script'\\nvar name_roleAssignmentName = guid('${resourceGroup().name}${ref_identityId}Role assignment in group${resourceGroup().name}')\\nvar tags = {\\n  'spring-cloud-azure': 'true'\\n  'deploy-to-azure-button': 'true'\\n}\\n\\nresource asaInstance 'Microsoft.AppPlatform/Spring@2023-05-01-preview' = {\\n  name: asaInstanceName\\n  location: location\\n  tags: tags\\n  sku: {\\n    name: 'E0'\\n    tier: 'Enterprise'\\n  }\\n}\\n\\nresource asaInstanceName_default 'Microsoft.AppPlatform/Spring/buildServices@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: 'default'\\n  properties: {\\n    resourceRequests: {\\n      cpu: '1000m'\\n      memory: '2000Mi'\\n    }\\n  }\\n}\\n\\nresource asaInstanceName_adminServerApp 'Microsoft.AppPlatform/Spring/apps@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: '${adminServerAppName}'\\n  location: location\\n  properties: {\\n    public: true\\n    httpsOnly: false\\n    temporaryDisk: {\\n      sizeInGB: 5\\n      mountPath: '/tmp'\\n    }\\n    persistentDisk: {\\n      sizeInGB: 0\\n      mountPath: '/persistent'\\n    }\\n    enableEndToEndTLS: false\\n    ingressSettings: {\\n      readTimeoutInSeconds: 300\\n      sendTimeoutInSeconds: 60\\n      sessionCookieMaxAge: 0\\n      sessionAffinity: 'None'\\n      backendProtocol: 'Default'\\n    }\\n  }\\n}\\n\\nresource asaInstanceName_customersServiceApp 'Microsoft.AppPlatform/Spring/apps@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: '${customersServiceAppName}'\\n  location: location\\n  properties: {\\n    httpsOnly: false\\n    temporaryDisk: {\\n      sizeInGB: 5\\n      mountPath: '/tmp'\\n    }\\n    persistentDisk: {\\n      sizeInGB: 0\\n      mountPath: '/persistent'\\n    }\\n    enableEndToEndTLS: false\\n    ingressSettings: {\\n      readTimeoutInSeconds: 300\\n      sendTimeoutInSeconds: 60\\n      sessionCookieMaxAge: 0\\n      sessionAffinity: 'None'\\n      backendProtocol: 'Default'\\n    }\\n  }\\n}\\n\\nresource asaInstanceName_vetsServiceApp 'Microsoft.AppPlatform/Spring/apps@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: '${vetsServiceAppName}'\\n  location: location\\n  properties: {\\n    httpsOnly: false\\n    temporaryDisk: {\\n      sizeInGB: 5\\n      mountPath: '/tmp'\\n    }\\n    persistentDisk: {\\n      sizeInGB: 0\\n      mountPath: '/persistent'\\n    }\\n    enableEndToEndTLS: false\\n    ingressSettings: {\\n      readTimeoutInSeconds: 300\\n      sendTimeoutInSeconds: 60\\n      sessionCookieMaxAge: 0\\n      sessionAffinity: 'None'\\n      backendProtocol: 'Default'\\n    }\\n  }\\n}\\n\\nresource asaInstanceName_visitsServiceApp 'Microsoft.AppPlatform/Spring/apps@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: '${visitsServiceAppName}'\\n  location: location\\n  properties: {\\n    httpsOnly: false\\n    temporaryDisk: {\\n      sizeInGB: 5\\n      mountPath: '/tmp'\\n    }\\n    persistentDisk: {\\n      sizeInGB: 0\\n      mountPath: '/persistent'\\n    }\\n    enableEndToEndTLS: false\\n    ingressSettings: {\\n      readTimeoutInSeconds: 300\\n      sendTimeoutInSeconds: 60\\n      sessionCookieMaxAge: 0\\n      sessionAffinity: 'None'\\n      backendProtocol: 'Default'\\n    }\\n  }\\n}\\n\\nresource asaInstanceName_apiGatewayApp 'Microsoft.AppPlatform/Spring/apps@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: '${apiGatewayAppName}'\\n  location: location\\n  properties: {\\n    public: true\\n    httpsOnly: false\\n    temporaryDisk: {\\n      sizeInGB: 5\\n      mountPath: '/tmp'\\n    }\\n    persistentDisk: {\\n      sizeInGB: 0\\n      mountPath: '/persistent'\\n    }\\n    enableEndToEndTLS: false\\n    ingressSettings: {\\n      readTimeoutInSeconds: 300\\n      sendTimeoutInSeconds: 60\\n      sessionCookieMaxAge: 0\\n      sessionAffinity: 'None'\\n      backendProtocol: 'Default'\\n    }\\n  }\\n}\\n\\nresource asaInstanceName_adminServerAppName_default 'Microsoft.AppPlatform/Spring/apps/deployments@2023-05-01-preview' = {\\n  parent: asaInstanceName_adminServerApp\\n  name: 'default'\\n  properties: {\\n    active: true\\n    deploymentSettings: {\\n      resourceRequests: {\\n        cpu: '1'\\n        memory: '2Gi'\\n      }\\n    }\\n    source: {\\n      type: 'BuildResult'\\n      buildResultId: '<default>'\\n    }\\n  }\\n}\\n\\nresource asaInstanceName_customersServiceAppName_default 'Microsoft.AppPlatform/Spring/apps/deployments@2023-05-01-preview' = {\\n  parent: asaInstanceName_customersServiceApp\\n  name: 'default'\\n  properties: {\\n    active: true\\n    deploymentSettings: {\\n      resourceRequests: {\\n        cpu: '1'\\n        memory: '2Gi'\\n      }\\n    }\\n    source: {\\n      type: 'BuildResult'\\n      buildResultId: '<default>'\\n    }\\n  }\\n}\\n\\nresource asaInstanceName_vetsServiceAppName_default 'Microsoft.AppPlatform/Spring/apps/deployments@2023-05-01-preview' = {\\n  parent: asaInstanceName_vetsServiceApp\\n  name: 'default'\\n  properties: {\\n    active: true\\n    deploymentSettings: {\\n      resourceRequests: {\\n        cpu: '1'\\n        memory: '2Gi'\\n      }\\n    }\\n    source: {\\n      type: 'BuildResult'\\n      buildResultId: '<default>'\\n    }\\n  }\\n}\\n\\nresource asaInstanceName_visitsServiceAppName_default 'Microsoft.AppPlatform/Spring/apps/deployments@2023-05-01-preview' = {\\n  parent: asaInstanceName_visitsServiceApp\\n  name: 'default'\\n  properties: {\\n    active: true\\n    deploymentSettings: {\\n      resourceRequests: {\\n        cpu: '1'\\n        memory: '2Gi'\\n      }\\n    }\\n    source: {\\n      type: 'BuildResult'\\n      buildResultId: '<default>'\\n    }\\n  }\\n}\\n\\nresource asaInstanceName_apiGatewayAppName_default 'Microsoft.AppPlatform/Spring/apps/deployments@2023-05-01-preview' = {\\n  parent: asaInstanceName_apiGatewayApp\\n  name: 'default'\\n  properties: {\\n    active: true\\n    deploymentSettings: {\\n      resourceRequests: {\\n        cpu: '1'\\n        memory: '2Gi'\\n      }\\n    }\\n    source: {\\n      type: 'BuildResult'\\n      buildResultId: '<default>'\\n    }\\n  }\\n}\\n\\nresource userAssignedManagedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2023-01-31' = {\\n  name: userAssignedManagedIdentityName\\n  location: location\\n  tags: tags\\n}\\n\\nresource name_roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  name: name_roleAssignmentName\\n  properties: {\\n    roleDefinitionId: const_ownerRole\\n    principalId: reference(ref_identityId).principalId\\n    principalType: 'ServicePrincipal'\\n    scope: resourceGroup().id\\n  }\\n  dependsOn: [\\n    asaInstance\\n  ]\\n}\\n\\nresource const_checkingBuilderStateDeployment 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\\n  name: const_checkingBuilderStateDeploymentName\\n  location: location\\n  kind: 'AzurePowerShell'\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${userAssignedManagedIdentity.id}': {}\\n    }\\n  }\\n  properties: {\\n    azPowerShellVersion: '9.7'\\n    primaryScriptUri: uri(_artifactsLocation, 'scripts/${const_checkScriptName}${_artifactsLocationSasToken}')\\n    environmentVariables: [\\n      {\\n        name: 'SUBSCRIPTION_ID'\\n        value: subscription().subscriptionId\\n      }\\n      {\\n        name: 'RESOURCE_GROUP'\\n        value: resourceGroup().name\\n      }\\n      {\\n        name: 'ASA_SERVICE_NAME'\\n        value: asaInstanceName\\n      }\\n    ]\\n    cleanupPreference: 'OnSuccess'\\n    retentionInterval: 'P1D'\\n  }\\n  dependsOn: [\\n    asaInstanceName_adminServerAppName_default\\n    asaInstanceName_apiGatewayAppName_default\\n    asaInstanceName_customersServiceAppName_default\\n    asaInstanceName_vetsServiceAppName_default\\n    asaInstanceName_visitsServiceAppName_default\\n    name_roleAssignment\\n  ]\\n}\\n\\nresource asaInstanceName_default_default_default 'Microsoft.AppPlatform/Spring/buildServices/builders/buildpackBindings@2023-05-01-preview' = {\\n  name: '${asaInstanceName}/default/default/default'\\n  properties: {\\n    bindingType: 'ApplicationInsights'\\n    launchProperties: {\\n      properties: {\\n        sampling_percentage: '10'\\n        connection_string: reference(applicationInsights.id, '2020-02-02').ConnectionString\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    const_checkingBuilderStateDeployment\\n  ]\\n}\\n\\nresource logAnalytics 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {\\n  name: logAnalyticsName\\n  location: location\\n  tags: tags\\n  properties: {\\n    retentionInDays: 30\\n    sku: {\\n      name: 'PerGB2018'\\n    }\\n  }\\n}\\n\\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\\n  name: applicationInsightsName\\n  location: location\\n  tags: tags\\n  kind: 'java'\\n  properties: {\\n    Application_Type: 'web'\\n    Flow_Type: 'Bluefield'\\n    Request_Source: 'CustomDeployment'\\n    RetentionInDays: 90\\n    WorkspaceResourceId: logAnalytics.id\\n    IngestionMode: 'Disabled'\\n    publicNetworkAccessForIngestion: 'Enabled'\\n    publicNetworkAccessForQuery: 'Enabled'\\n  }\\n}\\n\\nresource applicationInsightsDashboard 'Microsoft.Portal/dashboards@2020-09-01-preview' = {\\n  name: applicationInsightsDashboardName\\n  location: location\\n  tags: tags\\n  properties: {\\n    lenses: [\\n      {\\n        order: 0\\n        parts: [\\n          {\\n            position: {\\n              x: 0\\n              y: 0\\n              colSpan: 2\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'id'\\n                  value: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                }\\n                {\\n                  name: 'Version'\\n                  value: '1.0'\\n                }\\n              ]\\n              type: 'Extension/AppInsightsExtension/PartType/AspNetOverviewPinnedPart'\\n              asset: {\\n                idInputName: 'id'\\n                type: 'ApplicationInsights'\\n              }\\n              defaultMenuItemId: 'overview'\\n            }\\n          }\\n          {\\n            position: {\\n              x: 2\\n              y: 0\\n              colSpan: 1\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'ComponentId'\\n                  value: {\\n                    Name: applicationInsightsDashboardName\\n                    SubscriptionId: subscription().subscriptionId\\n                    ResourceGroup: resourceGroup().name\\n                  }\\n                }\\n                {\\n                  name: 'Version'\\n                  value: '1.0'\\n                }\\n              ]\\n              type: 'Extension/AppInsightsExtension/PartType/ProactiveDetectionAsyncPart'\\n              asset: {\\n                idInputName: 'ComponentId'\\n                type: 'ApplicationInsights'\\n              }\\n              defaultMenuItemId: 'ProactiveDetection'\\n            }\\n          }\\n          {\\n            position: {\\n              x: 3\\n              y: 0\\n              colSpan: 1\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'ComponentId'\\n                  value: {\\n                    Name: applicationInsightsDashboardName\\n                    SubscriptionId: subscription().subscriptionId\\n                    ResourceGroup: resourceGroup().name\\n                  }\\n                }\\n                {\\n                  name: 'ResourceId'\\n                  value: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                }\\n              ]\\n              type: 'Extension/AppInsightsExtension/PartType/QuickPulseButtonSmallPart'\\n              asset: {\\n                idInputName: 'ComponentId'\\n                type: 'ApplicationInsights'\\n              }\\n            }\\n          }\\n          {\\n            position: {\\n              x: 4\\n              y: 0\\n              colSpan: 1\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'ComponentId'\\n                  value: {\\n                    Name: applicationInsightsDashboardName\\n                    SubscriptionId: subscription().subscriptionId\\n                    ResourceGroup: resourceGroup().name\\n                  }\\n                }\\n                {\\n                  name: 'TimeContext'\\n                  value: {\\n                    durationMs: 86400000\\n                    createdTime: '2018-05-04T01:20:33.345Z'\\n                    isInitialTime: true\\n                    grain: 1\\n                    useDashboardTimeRange: false\\n                  }\\n                }\\n                {\\n                  name: 'Version'\\n                  value: '1.0'\\n                }\\n              ]\\n              type: 'Extension/AppInsightsExtension/PartType/AvailabilityNavButtonPart'\\n              asset: {\\n                idInputName: 'ComponentId'\\n                type: 'ApplicationInsights'\\n              }\\n            }\\n          }\\n          {\\n            position: {\\n              x: 5\\n              y: 0\\n              colSpan: 1\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'ComponentId'\\n                  value: {\\n                    Name: applicationInsightsDashboardName\\n                    SubscriptionId: subscription().subscriptionId\\n                    ResourceGroup: resourceGroup().name\\n                  }\\n                }\\n                {\\n                  name: 'TimeContext'\\n                  value: {\\n                    durationMs: 86400000\\n                    createdTime: '2018-05-08T18:47:35.237Z'\\n                    isInitialTime: true\\n                    grain: 1\\n                    useDashboardTimeRange: false\\n                  }\\n                }\\n                {\\n                  name: 'ConfigurationId'\\n                  value: '78ce933e-e864-4b05-a27b-71fd55a6afad'\\n                }\\n              ]\\n              type: 'Extension/AppInsightsExtension/PartType/AppMapButtonPart'\\n              asset: {\\n                idInputName: 'ComponentId'\\n                type: 'ApplicationInsights'\\n              }\\n            }\\n          }\\n          {\\n            position: {\\n              x: 0\\n              y: 1\\n              colSpan: 3\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: []\\n              type: 'Extension/HubsExtension/PartType/MarkdownPart'\\n              settings: {\\n                content: {\\n                  settings: {\\n                    content: '# Usage'\\n                  }\\n                }\\n              }\\n            }\\n          }\\n          {\\n            position: {\\n              x: 3\\n              y: 1\\n              colSpan: 1\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'ComponentId'\\n                  value: {\\n                    Name: applicationInsightsDashboardName\\n                    SubscriptionId: subscription().subscriptionId\\n                    ResourceGroup: resourceGroup().name\\n                  }\\n                }\\n                {\\n                  name: 'TimeContext'\\n                  value: {\\n                    durationMs: 86400000\\n                    createdTime: '2018-05-04T01:22:35.782Z'\\n                    isInitialTime: true\\n                    grain: 1\\n                    useDashboardTimeRange: false\\n                  }\\n                }\\n              ]\\n              type: 'Extension/AppInsightsExtension/PartType/UsageUsersOverviewPart'\\n              asset: {\\n                idInputName: 'ComponentId'\\n                type: 'ApplicationInsights'\\n              }\\n            }\\n          }\\n          {\\n            position: {\\n              x: 4\\n              y: 1\\n              colSpan: 3\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: []\\n              type: 'Extension/HubsExtension/PartType/MarkdownPart'\\n              settings: {\\n                content: {\\n                  settings: {\\n                    content: '# Reliability'\\n                  }\\n                }\\n              }\\n            }\\n          }\\n          {\\n            position: {\\n              x: 7\\n              y: 1\\n              colSpan: 1\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'ResourceId'\\n                  value: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                }\\n                {\\n                  name: 'DataModel'\\n                  value: {\\n                    version: '1.0.0'\\n                    timeContext: {\\n                      durationMs: 86400000\\n                      createdTime: '2018-05-04T23:42:40.072Z'\\n                      isInitialTime: false\\n                      grain: 1\\n                      useDashboardTimeRange: false\\n                    }\\n                  }\\n                  isOptional: true\\n                }\\n                {\\n                  name: 'ConfigurationId'\\n                  value: '8a02f7bf-ac0f-40e1-afe9-f0e72cfee77f'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/AppInsightsExtension/PartType/CuratedBladeFailuresPinnedPart'\\n              isAdapter: true\\n              asset: {\\n                idInputName: 'ResourceId'\\n                type: 'ApplicationInsights'\\n              }\\n              defaultMenuItemId: 'failures'\\n            }\\n          }\\n          {\\n            position: {\\n              x: 8\\n              y: 1\\n              colSpan: 3\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: []\\n              type: 'Extension/HubsExtension/PartType/MarkdownPart'\\n              settings: {\\n                content: {\\n                  settings: {\\n                    content: '# Responsiveness\\\\r\\\\n'\\n                  }\\n                }\\n              }\\n            }\\n          }\\n          {\\n            position: {\\n              x: 11\\n              y: 1\\n              colSpan: 1\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'ResourceId'\\n                  value: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                }\\n                {\\n                  name: 'DataModel'\\n                  value: {\\n                    version: '1.0.0'\\n                    timeContext: {\\n                      durationMs: 86400000\\n                      createdTime: '2018-05-04T23:43:37.804Z'\\n                      isInitialTime: false\\n                      grain: 1\\n                      useDashboardTimeRange: false\\n                    }\\n                  }\\n                  isOptional: true\\n                }\\n                {\\n                  name: 'ConfigurationId'\\n                  value: '2a8ede4f-2bee-4b9c-aed9-2db0e8a01865'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/AppInsightsExtension/PartType/CuratedBladePerformancePinnedPart'\\n              isAdapter: true\\n              asset: {\\n                idInputName: 'ResourceId'\\n                type: 'ApplicationInsights'\\n              }\\n              defaultMenuItemId: 'performance'\\n            }\\n          }\\n          {\\n            position: {\\n              x: 12\\n              y: 1\\n              colSpan: 3\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: []\\n              type: 'Extension/HubsExtension/PartType/MarkdownPart'\\n              settings: {\\n                content: {\\n                  settings: {\\n                    content: '# Browser'\\n                  }\\n                }\\n              }\\n            }\\n          }\\n          {\\n            position: {\\n              x: 15\\n              y: 1\\n              colSpan: 1\\n              rowSpan: 1\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'ComponentId'\\n                  value: {\\n                    Name: applicationInsightsDashboardName\\n                    SubscriptionId: subscription().subscriptionId\\n                    ResourceGroup: resourceGroup().name\\n                  }\\n                }\\n                {\\n                  name: 'MetricsExplorerJsonDefinitionId'\\n                  value: 'BrowserPerformanceTimelineMetrics'\\n                }\\n                {\\n                  name: 'TimeContext'\\n                  value: {\\n                    durationMs: 86400000\\n                    createdTime: '2018-05-08T12:16:27.534Z'\\n                    isInitialTime: false\\n                    grain: 1\\n                    useDashboardTimeRange: false\\n                  }\\n                }\\n                {\\n                  name: 'CurrentFilter'\\n                  value: {\\n                    eventTypes: [\\n                      4\\n                      1\\n                      3\\n                      5\\n                      2\\n                      6\\n                      13\\n                    ]\\n                    isPermissive: false\\n                  }\\n                }\\n                {\\n                  name: 'id'\\n                  value: {\\n                    Name: applicationInsightsDashboardName\\n                    SubscriptionId: subscription().subscriptionId\\n                    ResourceGroup: resourceGroup().name\\n                  }\\n                }\\n                {\\n                  name: 'Version'\\n                  value: '1.0'\\n                }\\n              ]\\n              type: 'Extension/AppInsightsExtension/PartType/MetricsExplorerBladePinnedPart'\\n              asset: {\\n                idInputName: 'ComponentId'\\n                type: 'ApplicationInsights'\\n              }\\n              defaultMenuItemId: 'browser'\\n            }\\n          }\\n          {\\n            position: {\\n              x: 0\\n              y: 2\\n              colSpan: 4\\n              rowSpan: 3\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'options'\\n                  value: {\\n                    chart: {\\n                      metrics: [\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'sessions/count'\\n                          aggregationType: 5\\n                          namespace: 'microsoft.insights/components/kusto'\\n                          metricVisualization: {\\n                            displayName: 'Sessions'\\n                            color: '#47BDF5'\\n                          }\\n                        }\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'users/count'\\n                          aggregationType: 5\\n                          namespace: 'microsoft.insights/components/kusto'\\n                          metricVisualization: {\\n                            displayName: 'Users'\\n                            color: '#7E58FF'\\n                          }\\n                        }\\n                      ]\\n                      title: 'Unique sessions and users'\\n                      visualization: {\\n                        chartType: 2\\n                        legendVisualization: {\\n                          isVisible: true\\n                          position: 2\\n                          hideSubtitle: false\\n                        }\\n                        axisVisualization: {\\n                          x: {\\n                            isVisible: true\\n                            axisType: 2\\n                          }\\n                          y: {\\n                            isVisible: true\\n                            axisType: 1\\n                          }\\n                        }\\n                      }\\n                      openBladeOnClick: {\\n                        openBlade: true\\n                        destinationBlade: {\\n                          extensionName: 'HubsExtension'\\n                          bladeName: 'ResourceMenuBlade'\\n                          parameters: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                            menuid: 'segmentationUsers'\\n                          }\\n                        }\\n                      }\\n                    }\\n                  }\\n                }\\n                {\\n                  name: 'sharedTimeRange'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/MonitorChartPart'\\n              settings: {}\\n            }\\n          }\\n          {\\n            position: {\\n              x: 4\\n              y: 2\\n              colSpan: 4\\n              rowSpan: 3\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'options'\\n                  value: {\\n                    chart: {\\n                      metrics: [\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'requests/failed'\\n                          aggregationType: 7\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Failed requests'\\n                            color: '#EC008C'\\n                          }\\n                        }\\n                      ]\\n                      title: 'Failed requests'\\n                      visualization: {\\n                        chartType: 3\\n                        legendVisualization: {\\n                          isVisible: true\\n                          position: 2\\n                          hideSubtitle: false\\n                        }\\n                        axisVisualization: {\\n                          x: {\\n                            isVisible: true\\n                            axisType: 2\\n                          }\\n                          y: {\\n                            isVisible: true\\n                            axisType: 1\\n                          }\\n                        }\\n                      }\\n                      openBladeOnClick: {\\n                        openBlade: true\\n                        destinationBlade: {\\n                          extensionName: 'HubsExtension'\\n                          bladeName: 'ResourceMenuBlade'\\n                          parameters: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                            menuid: 'failures'\\n                          }\\n                        }\\n                      }\\n                    }\\n                  }\\n                }\\n                {\\n                  name: 'sharedTimeRange'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/MonitorChartPart'\\n              settings: {}\\n            }\\n          }\\n          {\\n            position: {\\n              x: 8\\n              y: 2\\n              colSpan: 4\\n              rowSpan: 3\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'options'\\n                  value: {\\n                    chart: {\\n                      metrics: [\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'requests/duration'\\n                          aggregationType: 4\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Server response time'\\n                            color: '#00BCF2'\\n                          }\\n                        }\\n                      ]\\n                      title: 'Server response time'\\n                      visualization: {\\n                        chartType: 2\\n                        legendVisualization: {\\n                          isVisible: true\\n                          position: 2\\n                          hideSubtitle: false\\n                        }\\n                        axisVisualization: {\\n                          x: {\\n                            isVisible: true\\n                            axisType: 2\\n                          }\\n                          y: {\\n                            isVisible: true\\n                            axisType: 1\\n                          }\\n                        }\\n                      }\\n                      openBladeOnClick: {\\n                        openBlade: true\\n                        destinationBlade: {\\n                          extensionName: 'HubsExtension'\\n                          bladeName: 'ResourceMenuBlade'\\n                          parameters: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                            menuid: 'performance'\\n                          }\\n                        }\\n                      }\\n                    }\\n                  }\\n                }\\n                {\\n                  name: 'sharedTimeRange'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/MonitorChartPart'\\n              settings: {}\\n            }\\n          }\\n          {\\n            position: {\\n              x: 12\\n              y: 2\\n              colSpan: 4\\n              rowSpan: 3\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'options'\\n                  value: {\\n                    chart: {\\n                      metrics: [\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'browserTimings/networkDuration'\\n                          aggregationType: 4\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Page load network connect time'\\n                            color: '#7E58FF'\\n                          }\\n                        }\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'browserTimings/processingDuration'\\n                          aggregationType: 4\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Client processing time'\\n                            color: '#44F1C8'\\n                          }\\n                        }\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'browserTimings/sendDuration'\\n                          aggregationType: 4\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Send request time'\\n                            color: '#EB9371'\\n                          }\\n                        }\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'browserTimings/receiveDuration'\\n                          aggregationType: 4\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Receiving response time'\\n                            color: '#0672F1'\\n                          }\\n                        }\\n                      ]\\n                      title: 'Average page load time breakdown'\\n                      visualization: {\\n                        chartType: 3\\n                        legendVisualization: {\\n                          isVisible: true\\n                          position: 2\\n                          hideSubtitle: false\\n                        }\\n                        axisVisualization: {\\n                          x: {\\n                            isVisible: true\\n                            axisType: 2\\n                          }\\n                          y: {\\n                            isVisible: true\\n                            axisType: 1\\n                          }\\n                        }\\n                      }\\n                    }\\n                  }\\n                }\\n                {\\n                  name: 'sharedTimeRange'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/MonitorChartPart'\\n              settings: {}\\n            }\\n          }\\n          {\\n            position: {\\n              x: 0\\n              y: 5\\n              colSpan: 4\\n              rowSpan: 3\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'options'\\n                  value: {\\n                    chart: {\\n                      metrics: [\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'availabilityResults/availabilityPercentage'\\n                          aggregationType: 4\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Availability'\\n                            color: '#47BDF5'\\n                          }\\n                        }\\n                      ]\\n                      title: 'Average availability'\\n                      visualization: {\\n                        chartType: 3\\n                        legendVisualization: {\\n                          isVisible: true\\n                          position: 2\\n                          hideSubtitle: false\\n                        }\\n                        axisVisualization: {\\n                          x: {\\n                            isVisible: true\\n                            axisType: 2\\n                          }\\n                          y: {\\n                            isVisible: true\\n                            axisType: 1\\n                          }\\n                        }\\n                      }\\n                      openBladeOnClick: {\\n                        openBlade: true\\n                        destinationBlade: {\\n                          extensionName: 'HubsExtension'\\n                          bladeName: 'ResourceMenuBlade'\\n                          parameters: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                            menuid: 'availability'\\n                          }\\n                        }\\n                      }\\n                    }\\n                  }\\n                }\\n                {\\n                  name: 'sharedTimeRange'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/MonitorChartPart'\\n              settings: {}\\n            }\\n          }\\n          {\\n            position: {\\n              x: 4\\n              y: 5\\n              colSpan: 4\\n              rowSpan: 3\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'options'\\n                  value: {\\n                    chart: {\\n                      metrics: [\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'exceptions/server'\\n                          aggregationType: 7\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Server exceptions'\\n                            color: '#47BDF5'\\n                          }\\n                        }\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'dependencies/failed'\\n                          aggregationType: 7\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Dependency failures'\\n                            color: '#7E58FF'\\n                          }\\n                        }\\n                      ]\\n                      title: 'Server exceptions and Dependency failures'\\n                      visualization: {\\n                        chartType: 2\\n                        legendVisualization: {\\n                          isVisible: true\\n                          position: 2\\n                          hideSubtitle: false\\n                        }\\n                        axisVisualization: {\\n                          x: {\\n                            isVisible: true\\n                            axisType: 2\\n                          }\\n                          y: {\\n                            isVisible: true\\n                            axisType: 1\\n                          }\\n                        }\\n                      }\\n                    }\\n                  }\\n                }\\n                {\\n                  name: 'sharedTimeRange'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/MonitorChartPart'\\n              settings: {}\\n            }\\n          }\\n          {\\n            position: {\\n              x: 8\\n              y: 5\\n              colSpan: 4\\n              rowSpan: 3\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'options'\\n                  value: {\\n                    chart: {\\n                      metrics: [\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'performanceCounters/processorCpuPercentage'\\n                          aggregationType: 4\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Processor time'\\n                            color: '#47BDF5'\\n                          }\\n                        }\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'performanceCounters/processCpuPercentage'\\n                          aggregationType: 4\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Process CPU'\\n                            color: '#7E58FF'\\n                          }\\n                        }\\n                      ]\\n                      title: 'Average processor and process CPU utilization'\\n                      visualization: {\\n                        chartType: 2\\n                        legendVisualization: {\\n                          isVisible: true\\n                          position: 2\\n                          hideSubtitle: false\\n                        }\\n                        axisVisualization: {\\n                          x: {\\n                            isVisible: true\\n                            axisType: 2\\n                          }\\n                          y: {\\n                            isVisible: true\\n                            axisType: 1\\n                          }\\n                        }\\n                      }\\n                    }\\n                  }\\n                }\\n                {\\n                  name: 'sharedTimeRange'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/MonitorChartPart'\\n              settings: {}\\n            }\\n          }\\n          {\\n            position: {\\n              x: 12\\n              y: 5\\n              colSpan: 4\\n              rowSpan: 3\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'options'\\n                  value: {\\n                    chart: {\\n                      metrics: [\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'exceptions/browser'\\n                          aggregationType: 7\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Browser exceptions'\\n                            color: '#47BDF5'\\n                          }\\n                        }\\n                      ]\\n                      title: 'Browser exceptions'\\n                      visualization: {\\n                        chartType: 2\\n                        legendVisualization: {\\n                          isVisible: true\\n                          position: 2\\n                          hideSubtitle: false\\n                        }\\n                        axisVisualization: {\\n                          x: {\\n                            isVisible: true\\n                            axisType: 2\\n                          }\\n                          y: {\\n                            isVisible: true\\n                            axisType: 1\\n                          }\\n                        }\\n                      }\\n                    }\\n                  }\\n                }\\n                {\\n                  name: 'sharedTimeRange'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/MonitorChartPart'\\n              settings: {}\\n            }\\n          }\\n          {\\n            position: {\\n              x: 0\\n              y: 8\\n              colSpan: 4\\n              rowSpan: 3\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'options'\\n                  value: {\\n                    chart: {\\n                      metrics: [\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'availabilityResults/count'\\n                          aggregationType: 7\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Availability test results count'\\n                            color: '#47BDF5'\\n                          }\\n                        }\\n                      ]\\n                      title: 'Availability test results count'\\n                      visualization: {\\n                        chartType: 2\\n                        legendVisualization: {\\n                          isVisible: true\\n                          position: 2\\n                          hideSubtitle: false\\n                        }\\n                        axisVisualization: {\\n                          x: {\\n                            isVisible: true\\n                            axisType: 2\\n                          }\\n                          y: {\\n                            isVisible: true\\n                            axisType: 1\\n                          }\\n                        }\\n                      }\\n                    }\\n                  }\\n                }\\n                {\\n                  name: 'sharedTimeRange'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/MonitorChartPart'\\n              settings: {}\\n            }\\n          }\\n          {\\n            position: {\\n              x: 4\\n              y: 8\\n              colSpan: 4\\n              rowSpan: 3\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'options'\\n                  value: {\\n                    chart: {\\n                      metrics: [\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'performanceCounters/processIOBytesPerSecond'\\n                          aggregationType: 4\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Process IO rate'\\n                            color: '#47BDF5'\\n                          }\\n                        }\\n                      ]\\n                      title: 'Average process I/O rate'\\n                      visualization: {\\n                        chartType: 2\\n                        legendVisualization: {\\n                          isVisible: true\\n                          position: 2\\n                          hideSubtitle: false\\n                        }\\n                        axisVisualization: {\\n                          x: {\\n                            isVisible: true\\n                            axisType: 2\\n                          }\\n                          y: {\\n                            isVisible: true\\n                            axisType: 1\\n                          }\\n                        }\\n                      }\\n                    }\\n                  }\\n                }\\n                {\\n                  name: 'sharedTimeRange'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/MonitorChartPart'\\n              settings: {}\\n            }\\n          }\\n          {\\n            position: {\\n              x: 8\\n              y: 8\\n              colSpan: 4\\n              rowSpan: 3\\n            }\\n            metadata: {\\n              inputs: [\\n                {\\n                  name: 'options'\\n                  value: {\\n                    chart: {\\n                      metrics: [\\n                        {\\n                          resourceMetadata: {\\n                            id: '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Insights/components/${applicationInsightsDashboardName}'\\n                          }\\n                          name: 'performanceCounters/memoryAvailableBytes'\\n                          aggregationType: 4\\n                          namespace: 'microsoft.insights/components'\\n                          metricVisualization: {\\n                            displayName: 'Available memory'\\n                            color: '#47BDF5'\\n                          }\\n                        }\\n                      ]\\n                      title: 'Average available memory'\\n                      visualization: {\\n                        chartType: 2\\n                        legendVisualization: {\\n                          isVisible: true\\n                          position: 2\\n                          hideSubtitle: false\\n                        }\\n                        axisVisualization: {\\n                          x: {\\n                            isVisible: true\\n                            axisType: 2\\n                          }\\n                          y: {\\n                            isVisible: true\\n                            axisType: 1\\n                          }\\n                        }\\n                      }\\n                    }\\n                  }\\n                }\\n                {\\n                  name: 'sharedTimeRange'\\n                  isOptional: true\\n                }\\n              ]\\n              type: 'Extension/HubsExtension/PartType/MonitorChartPart'\\n              settings: {}\\n            }\\n          }\\n        ]\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    applicationInsights\\n  ]\\n}\\n\\nresource Microsoft_AppPlatform_Spring_monitoringSettings_asaInstanceName_default 'Microsoft.AppPlatform/Spring/monitoringSettings@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: 'default'\\n  properties: {\\n    traceEnabled: true\\n    appInsightsInstrumentationKey: reference(applicationInsights.id, '2020-02-02').InstrumentationKey\\n  }\\n}\\n\\nresource monitoring 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\\n  scope: asaInstance\\n  name: 'monitoring'\\n  properties: {\\n    workspaceId: logAnalytics.id\\n    logs: [\\n      {\\n        category: 'ApplicationConsole'\\n        enabled: true\\n        retentionPolicy: {\\n          days: 30\\n          enabled: false\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource Microsoft_AppPlatform_Spring_applicationAccelerators_asaInstanceName_default 'Microsoft.AppPlatform/Spring/applicationAccelerators@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: 'default'\\n}\\n\\nresource Microsoft_AppPlatform_Spring_applicationLiveViews_asaInstanceName_default 'Microsoft.AppPlatform/Spring/applicationLiveViews@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: 'default'\\n}\\n\\nresource Microsoft_AppPlatform_Spring_configurationServices_asaInstanceName_default 'Microsoft.AppPlatform/Spring/configurationServices@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: 'default'\\n  properties: {\\n    settings: {\\n      gitProperty: {\\n        repositories: [\\n          {\\n            name: 'default'\\n            patterns: [\\n              'application'\\n              'api-gateway'\\n              'admin-server'\\n              'customers-service'\\n              'vets-service'\\n              'visits-service'\\n            ]\\n            label: 'master'\\n            uri: 'https://github.com/Azure-Samples/spring-petclinic-microservices-config.git'\\n          }\\n        ]\\n      }\\n    }\\n    generation: 'Gen1'\\n  }\\n}\\n\\nresource Microsoft_AppPlatform_Spring_DevToolPortals_asaInstanceName_default 'Microsoft.AppPlatform/Spring/DevToolPortals@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: 'default'\\n  properties: {\\n    public: false\\n    features: {\\n      applicationAccelerator: {\\n        state: 'Enabled'\\n      }\\n      applicationLiveView: {\\n        state: 'Enabled'\\n      }\\n    }\\n  }\\n}\\n\\nresource Microsoft_AppPlatform_Spring_gateways_asaInstanceName_default 'Microsoft.AppPlatform/Spring/gateways@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: 'default'\\n  sku: {\\n    name: 'E0'\\n    tier: 'Enterprise'\\n    capacity: 2\\n  }\\n  properties: {\\n    public: false\\n    httpsOnly: false\\n    resourceRequests: {\\n      cpu: '1'\\n      memory: '2Gi'\\n    }\\n    clientAuth: {\\n      certificateVerification: 'Disabled'\\n    }\\n  }\\n}\\n\\nresource Microsoft_AppPlatform_Spring_serviceRegistries_asaInstanceName_default 'Microsoft.AppPlatform/Spring/serviceRegistries@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: 'default'\\n}\\n\\nresource Microsoft_AppPlatform_Spring_apiPortals_asaInstanceName_default 'Microsoft.AppPlatform/Spring/apiPortals@2023-05-01-preview' = {\\n  parent: asaInstance\\n  name: 'default'\\n  sku: {\\n    name: 'E0'\\n    tier: 'Enterprise'\\n    capacity: 1\\n  }\\n  properties: {\\n    public: false\\n    httpsOnly: false\\n    gatewayIds: [\\n      Microsoft_AppPlatform_Spring_gateways_asaInstanceName_default.id\\n    ]\\n  }\\n}\\n\\nresource asaInstanceName_default_default 'Microsoft.AppPlatform/Spring/buildServices/agentPools@2023-05-01-preview' = {\\n  parent: asaInstanceName_default\\n  name: 'default'\\n  properties: {\\n    poolSize: {\\n      name: 'S1'\\n    }\\n  }\\n}\\n\\nresource name_deploymentScript 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\\n  name: name_deploymentScriptName\\n  location: location\\n  kind: 'AzureCLI'\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${userAssignedManagedIdentity.id}': {}\\n    }\\n  }\\n  properties: {\\n    azCliVersion: '2.41.0'\\n    primaryScriptUri: uri(_artifactsLocation, 'scripts/${const_uploadScriptName}${_artifactsLocationSasToken}')\\n    environmentVariables: [\\n      {\\n        name: 'SUBSCRIPTION_ID'\\n        value: subscription().subscriptionId\\n      }\\n      {\\n        name: 'RESOURCE_GROUP'\\n        value: resourceGroup().name\\n      }\\n      {\\n        name: 'ASA_SERVICE_NAME'\\n        value: asaInstanceName\\n      }\\n    ]\\n    cleanupPreference: 'OnSuccess'\\n    retentionInterval: 'P1D'\\n  }\\n  dependsOn: [\\n    resourceId(\\n      'Microsoft.AppPlatform/Spring/buildServices/builders/buildpackBindings',\\n      split('${asaInstanceName}/default/default/default', '/')[0],\\n      split('${asaInstanceName}/default/default/default', '/')[1],\\n      split('${asaInstanceName}/default/default/default', '/')[2],\\n      split('${asaInstanceName}/default/default/default', '/')[3]\\n    )\\n    name_roleAssignment\\n  ]\\n}\\n\\noutput API_Gateway_URL string = reference(asaInstanceName_apiGatewayApp.id, '2023-05-01-preview').url\\noutput Admin_Server_URL string = reference(asaInstanceName_adminServerApp.id, '2023-05-01-preview').url\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Principal ID associated with the subscription ID.')\\nparam principalId string\\n\\n@description('Built In Role Type for the Virtual Machine')\\n@allowed([\\n  'Owner'\\n  'Contributor'\\n  'Reader'\\n  'Virtual Machine Contributor'\\n])\\nparam builtInRoleType string\\n\\n@description('Names of the virtual machine 1.')\\nparam virtualMachineName1 string\\n\\n@description('Names of the virtual machine 2.')\\nparam virtualMachineName2 string\\n\\nvar role = {\\n  Owner: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')\\n  Contributor: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\\n  Reader: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')\\n  'Virtual Machine Contributor': subscriptionResourceId(\\n    'Microsoft.Authorization/roleDefinitions',\\n    'd73bb868-a0df-4d4d-bd69-98a00b01fccb'\\n  )\\n}\\nvar roleAssignmentName1 = guid(\\n  resourceId('Microsoft.Compute/virtualMachines', virtualMachineName1),\\n  role[builtInRoleType],\\n  principalId\\n)\\nvar roleAssignmentName2 = guid(\\n  resourceId('Microsoft.Compute/virtualMachines', virtualMachineName2),\\n  role[builtInRoleType],\\n  principalId\\n)\\n\\nresource roleAssignment1 'Microsoft.Authorization/roleAssignments@2020-04-01-preview' = {\\n  scope: 'Microsoft.Compute/virtualMachines/${virtualMachineName1}'\\n  name: roleAssignmentName1\\n  properties: {\\n    roleDefinitionId: role[builtInRoleType]\\n    principalId: principalId\\n  }\\n}\\n\\nresource roleAssignment2 'Microsoft.Authorization/roleAssignments@2020-04-01-preview' = {\\n  scope: 'Microsoft.Compute/virtualMachines/${virtualMachineName2}'\\n  name: roleAssignmentName2\\n  properties: {\\n    roleDefinitionId: role[builtInRoleType]\\n    principalId: principalId\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"principalId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"builtInRoleType\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualMachineName1\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualMachineName2\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name for the AI resource and used to derive name of dependent resources.')\\n@minLength(2)\\n@maxLength(12)\\nparam aiHubName string = 'basic-hub'\\n\\n@description('Friendly name for your Azure AI resource')\\nparam aiHubFriendlyName string = 'Agents basic hub resource'\\n\\n@description('Description of your Azure AI resource dispayed in AI studio')\\nparam aiHubDescription string = 'A basic hub resource required for the agent setup.'\\n\\n@description('Name for the project')\\nparam aiProjectName string = 'basic-project'\\n\\n@description('Friendly name for your Azure AI project resource')\\nparam aiProjectFriendlyName string = 'Agents basic project resource'\\n\\n@description('Description of your Azure AI project resource dispayed in AI studio')\\nparam aiProjectDescription string = 'A basic project resource required for the agent setup.'\\n\\n@description('Azure region used for the deployment of all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Set of tags to apply to all resources.')\\nparam tags object = {}\\n\\n@description('Model name for deployment')\\nparam modelName string = 'gpt-4o-mini'\\n\\n@description('Model format for deployment')\\nparam modelFormat string = 'OpenAI'\\n\\n@description('Model version for deployment')\\nparam modelVersion string = '2024-07-18'\\n\\n@description('Model deployment SKU name')\\nparam modelSkuName string = 'GlobalStandard'\\n\\n@description('Model deployment capacity')\\nparam modelCapacity int = 50\\n\\n@description('Model deployment location. If you want to deploy an Azure AI resource/model in different location than the rest of the resources created.')\\nparam modelLocation string = ''\\n\\n@description('The AI Service Account full ARM Resource ID. This is an optional field, and if not provided, the resource will be created.')\\nparam aiServiceAccountResourceId string = ''\\n\\n@description('AI Service Account kind: either OpenAI or AIServices')\\nparam aiServiceKind string = 'AIServices'\\n\\n@description('Name of the storage account')\\nparam storageName string = 'agent-storage'\\n\\n@description('Name of the Azure AI Services account')\\nparam aiServicesName string = 'agent-ai-services'\\nparam deploymentTimestamp string = utcNow('yyyyMMddHHmmss')\\n\\nvar name = toLower(aiHubName)\\nvar projectName = toLower(aiProjectName)\\nvar uniqueSuffix = substring(uniqueString('${resourceGroup().id}-${deploymentTimestamp}'), 0, 4)\\nvar aiServiceExists = (aiServiceAccountResourceId != '')\\nvar aiServiceParts = split(aiServiceAccountResourceId, '/')\\nvar aiServiceAccountSubscriptionId = (aiServiceExists ? aiServiceParts[2] : subscription().subscriptionId)\\nvar aiServiceAccountResourceGroupName = (aiServiceExists ? aiServiceParts[4] : resourceGroup().name)\\nvar differentModelLocation = ((modelLocation != '') ? modelLocation : location)\\n\\nmodule dependencies_name_uniqueSuffix_deployment './nested_dependencies_name_uniqueSuffix_deployment.bicep' = {\\n  name: 'dependencies-${name}-${uniqueSuffix}-deployment'\\n  params: {\\n    aiServicesName: '${aiServicesName}${uniqueSuffix}'\\n    aiServiceAccountResourceId: aiServiceAccountResourceId\\n    storageName: '${storageName}${uniqueSuffix}'\\n    keyvaultName: 'kv-${name}-${uniqueSuffix}'\\n    location: location\\n    modelName: modelName\\n    modelFormat: modelFormat\\n    modelVersion: modelVersion\\n    modelSkuName: modelSkuName\\n    modelCapacity: modelCapacity\\n    modelLocation: differentModelLocation\\n  }\\n}\\n\\nmodule ai_name_uniqueSuffix_deployment './nested_ai_name_uniqueSuffix_deployment.bicep' = {\\n  name: 'ai-${name}-${uniqueSuffix}-deployment'\\n  params: {\\n    aiHubName: 'ai-${name}-${uniqueSuffix}'\\n    aiHubFriendlyName: aiHubFriendlyName\\n    aiHubDescription: aiHubDescription\\n    location: location\\n    keyVaultId: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.keyvaultId.value\\n    tags: tags\\n    aiServicesName: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiServicesName.value\\n    aiServiceKind: aiServiceKind\\n    aiServiceAccountResourceGroupName: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiServiceAccountResourceGroupName.value\\n    aiServiceAccountSubscriptionId: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiServiceAccountSubscriptionId.value\\n    storageAccountId: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.storageId.value\\n    aiServicesId: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiservicesID.value\\n    aiServicesTarget: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiservicesTarget.value\\n  }\\n}\\n\\nmodule ai_projectName_uniqueSuffix_deployment './nested_ai_projectName_uniqueSuffix_deployment.bicep' = {\\n  name: 'ai-${projectName}-${uniqueSuffix}-deployment'\\n  params: {\\n    aiProjectName: 'ai-${projectName}-${uniqueSuffix}'\\n    aiProjectFriendlyName: aiProjectFriendlyName\\n    aiProjectDescription: aiProjectDescription\\n    location: location\\n    tags: tags\\n    aiHubId: reference(ai_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiHubID.value\\n  }\\n}\\n\\nmodule ai_service_role_assignments_projectName_uniqueSuffix_deployment './nested_ai_service_role_assignments_projectName_uniqueSuffix_deployment.bicep' = {\\n  name: 'ai-service-role-assignments-${projectName}-${uniqueSuffix}-deployment'\\n  scope: resourceGroup(aiServiceAccountSubscriptionId, aiServiceAccountResourceGroupName)\\n  params: {\\n    aiServicesName: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiServicesName.value\\n    aiProjectPrincipalId: reference(ai_projectName_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiProjectPrincipalId.value\\n    aiProjectId: reference(ai_projectName_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiProjectResourceId.value\\n  }\\n}\\n\\noutput PROJECT_CONNECTION_STRING string = reference(ai_projectName_uniqueSuffix_deployment.id, '2022-09-01').outputs.projectConnectionString.value\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"aiHubName\\\": {\\n      \\\"value\\\": \\\"basic-hub\\\"\\n    },\\n    \\\"aiHubFriendlyName\\\": {\\n      \\\"value\\\": \\\"Agents basic hub resource\\\"\\n    },\\n    \\\"aiHubDescription\\\": {\\n      \\\"value\\\": \\\"A basic hub resource required for the agent setup.\\\"\\n    },\\n    \\\"aiProjectName\\\": {\\n      \\\"value\\\": \\\"basic-project\\\"\\n    },\\n    \\\"aiProjectFriendlyName\\\": {\\n      \\\"value\\\": \\\"Agents basic project resource\\\"\\n    },\\n    \\\"aiProjectDescription\\\": {\\n      \\\"value\\\": \\\"A basic project resource required for the agent setup.\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"modelName\\\": {\\n      \\\"value\\\": \\\"gpt-4o-mini\\\"\\n    },\\n    \\\"modelFormat\\\": {\\n      \\\"value\\\": \\\"OpenAI\\\"\\n    },\\n    \\\"modelVersion\\\": {\\n      \\\"value\\\": \\\"2024-07-18\\\"\\n    },\\n    \\\"modelSkuName\\\": {\\n      \\\"value\\\": \\\"GlobalStandard\\\"\\n    },\\n    \\\"modelCapacity\\\": {\\n      \\\"value\\\": 50\\n    },\\n    \\\"modelLocation\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"aiServiceAccountResourceId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"aiServiceKind\\\": {\\n      \\\"value\\\": \\\"AIServices\\\"\\n    },\\n    \\\"storageName\\\": {\\n      \\\"value\\\": \\\"agent-storage\\\"\\n    },\\n    \\\"aiServicesName\\\": {\\n      \\\"value\\\": \\\"agent-ai-services\\\"\\n    },\\n    \\\"deploymentTimestamp\\\": {\\n      \\\"value\\\": \\\"utcNow('yyyyMMddHHmmss')\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Creates an Azure AI resource with proxied endpoints for the Azure AI services provider\\n\\n@description('Azure region of the deployment')\\nparam location string\\n\\n@description('Tags to add to the resources')\\nparam tags object\\n\\n@description('AI hub name')\\nparam aiHubName string\\n\\n@description('AI hub display name')\\nparam aiHubFriendlyName string = aiHubName\\n\\n@description('AI hub description')\\nparam aiHubDescription string\\n\\n@description('Resource ID of the storage account resource for storing experimentation outputs')\\nparam storageAccountId string\\n\\n@description('Resource ID of the AI Services resource')\\nparam aiServicesId string\\n\\n@description('Resource ID of the AI Services endpoint')\\nparam aiServicesTarget string\\n\\n@description('Name AI Services resource')\\nparam aiServicesName string\\n\\n@description('Resource Group name of the AI Services resource')\\nparam aiServiceAccountResourceGroupName string\\n\\n@description('Subscription ID of the AI Services resource')\\nparam aiServiceAccountSubscriptionId string\\n\\n@description('AI Service Account kind: either OpenAI or AIServices')\\nparam aiServiceKind string \\n\\n@description('Resource ID of the key vault resource for storing connection strings')\\nparam keyVaultId string\\n\\nresource aiServices 'Microsoft.CognitiveServices/accounts@2023-05-01' existing = {\\n  name: aiServicesName\\n  scope: resourceGroup(aiServiceAccountSubscriptionId, aiServiceAccountResourceGroupName)\\n}\\n\\nresource aiHub 'Microsoft.MachineLearningServices/workspaces@2024-10-01-preview' = {\\n  name: aiHubName\\n  location: location\\n  tags: tags\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  properties: {\\n    // organization\\n    friendlyName: aiHubFriendlyName\\n    description: aiHubDescription\\n\\n    // dependent resources\\n    keyVault: keyVaultId\\n    storageAccount: storageAccountId\\n    systemDatastoresAuthMode: 'identity'\\n  }\\n  kind: 'hub'\\n\\n    resource aiServicesConnection 'connections@2024-10-01-preview' = {\\n    name: '${aiHubName}-connection-AIServices'\\n    properties: {\\n      category: aiServiceKind\\n      target: aiServicesTarget\\n      authType: 'AAD'\\n      isSharedToAll: true\\n      metadata: {\\n        ApiType: 'Azure'\\n        ResourceId: aiServicesId\\n        Location: aiServices.location\\n      }\\n    }\\n  }\\n\\n}\\noutput aiHubID string = aiHub.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiHubName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiHubFriendlyName\\\": {\\n      \\\"value\\\": \\\"aiHubName\\\"\\n    },\\n    \\\"aiHubDescription\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"storageAccountId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServicesId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServicesTarget\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServicesName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServiceAccountResourceGroupName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServiceAccountSubscriptionId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServiceKind\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyVaultId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Azure region of the deployment')\\nparam location string = resourceGroup().location\\n\\n@description('Tags to add to the resources')\\nparam tags object = {}\\n\\n@description('AI services name')\\nparam aiServicesName string\\n\\n@description('Model name for deployment')\\nparam modelName string\\n\\n@description('Model format for deployment')\\nparam modelFormat string\\n\\n@description('Model version for deployment')\\nparam modelVersion string\\n\\n@description('Model deployment SKU name')\\nparam modelSkuName string\\n\\n@description('Model deployment capacity')\\nparam modelCapacity int\\n\\n@description('Model/AI Resource deployment location')\\nparam modelLocation string\\n\\n@description('Name of the storage account')\\nparam storageName string\\n\\n@description('Storage SKU')\\n@allowed([\\n  'Standard_LRS'\\n  'Standard_ZRS'\\n  'Standard_GRS'\\n  'Standard_GZRS'\\n  'Standard_RAGRS'\\n  'Standard_RAGZRS'\\n  'Premium_LRS'\\n  'Premium_ZRS'\\n])\\nparam storageSkuName string = 'Standard_LRS'\\n\\nvar storageNameCleaned_var = replace(storageName, '-', '')\\n\\nresource aiServices 'Microsoft.CognitiveServices/accounts@2024-06-01-preview' = {\\n  name: aiServicesName\\n  location: modelLocation\\n  sku: {\\n    name: 'S0'\\n  }\\n  kind: 'AIServices'\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  properties: {\\n    customSubDomainName: toLower(toLower(aiServicesName))\\n    apiProperties: {\\n      statisticsEnabled: false\\n    }\\n    publicNetworkAccess: 'Enabled'\\n  }\\n}\\n\\nresource aiServicesName_model 'Microsoft.CognitiveServices/accounts/deployments@2024-06-01-preview' = {\\n  parent: aiServices\\n  name: '${modelName}'\\n  sku: {\\n    capacity: modelCapacity\\n    name: modelSkuName\\n  }\\n  properties: {\\n    model: {\\n      name: modelName\\n      format: modelFormat\\n      version: modelVersion\\n    }\\n  }\\n}\\n\\nresource storageNameCleaned 'Microsoft.Storage/storageAccounts@2023-05-01' = {\\n  name: storageNameCleaned_var\\n  location: location\\n  tags: tags\\n  sku: {\\n    name: storageSkuName\\n  }\\n  kind: 'StorageV2'\\n  properties: {\\n    accessTier: 'Hot'\\n    allowBlobPublicAccess: false\\n    allowCrossTenantReplication: false\\n    allowSharedKeyAccess: true\\n    encryption: {\\n      keySource: 'Microsoft.Storage'\\n      requireInfrastructureEncryption: false\\n      services: {\\n        blob: {\\n          enabled: true\\n          keyType: 'Account'\\n        }\\n        file: {\\n          enabled: true\\n          keyType: 'Account'\\n        }\\n        queue: {\\n          enabled: true\\n          keyType: 'Service'\\n        }\\n        table: {\\n          enabled: true\\n          keyType: 'Service'\\n        }\\n      }\\n    }\\n    isHnsEnabled: false\\n    isNfsV3Enabled: false\\n    keyPolicy: {\\n      keyExpirationPeriodInDays: 7\\n    }\\n    largeFileSharesState: 'Disabled'\\n    minimumTlsVersion: 'TLS1_2'\\n    networkAcls: {\\n      bypass: 'AzureServices'\\n      defaultAction: 'Deny'\\n    }\\n    supportsHttpsTrafficOnly: true\\n  }\\n}\\n\\noutput aiservicesID string = aiServices.id\\noutput aiservicesTarget string = reference(aiServices.id, '2024-06-01-preview').endpoint\\noutput storageId string = storageNameCleaned.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"aiServicesName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"modelName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"modelFormat\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"modelVersion\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"modelSkuName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"modelCapacity\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"modelLocation\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"storageName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"storageSkuName\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param UAIPrincipalId string\\nparam suffix string\\n\\nresource suffix_Microsoft_Authorization_roleDefinitions_b78c5d69_af96_48a3_bf8d_a8b4d589de94_id 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  name: guid(\\n    suffix,\\n    resourceId('Microsoft.Authorization/roleDefinitions', 'b78c5d69-af96-48a3-bf8d-a8b4d589de94'),\\n    resourceGroup().id\\n  )\\n  properties: {\\n    principalId: UAIPrincipalId\\n    roleDefinitionId: resourceId('Microsoft.Authorization/roleDefinitions', 'b78c5d69-af96-48a3-bf8d-a8b4d589de94')\\n    principalType: 'ServicePrincipal'\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"UAIPrincipalId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"suffix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param location string\\nparam userAssignedIdentityName string\\nparam uaiExists bool = false\\n\\nresource userAssignedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2023-07-31-preview' = {\\n  name: userAssignedIdentityName\\n  location: location\\n}\\n\\noutput uaiName string = (uaiExists ? userAssignedIdentityName : userAssignedIdentityName)\\noutput uaiId string = (uaiExists ? userAssignedIdentity.id : userAssignedIdentity.id)\\noutput uaiPrincipalId string = (uaiExists\\n  ? reference(userAssignedIdentity.id, '2023-07-31-preview').principalId\\n  : reference(userAssignedIdentity.id, '2023-07-31-preview').principalId)\\noutput uaiClientId string = (uaiExists\\n  ? reference(userAssignedIdentity.id, '2023-07-31-preview').clientId\\n  : reference(userAssignedIdentity.id, '2023-07-31-preview').clientId)\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"userAssignedIdentityName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"uaiExists\\\": {\\n      \\\"value\\\": false\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Assigns the necessary roles to the AI project\\n\\nparam keyvaultName string\\nparam UAIPrincipalId string\\nparam suffix string\\n\\nresource keyvault 'Microsoft.KeyVault/vaults@2022-07-01' existing = {\\n  name: keyvaultName\\n  scope: resourceGroup()\\n}\\n\\nresource keyVaultSecretOfficer 'Microsoft.Authorization/roleDefinitions@2022-04-01' existing = {\\n  name: 'b86a8fe4-44ce-4948-aee5-eccb2c155cd7'\\n  scope: keyvault\\n}\\n\\n// search roles\\nresource keyVaultContributor 'Microsoft.Authorization/roleDefinitions@2022-04-01' existing = {\\n  name: 'f25e0fa2-a7c8-4377-a976-54943a77a395'\\n  scope: resourceGroup()\\n}\\n\\nresource keyVaultContributorAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  scope: keyvault\\n  name: guid(suffix, keyVaultContributor.id, keyvault.id)\\n  properties: {\\n    principalId: UAIPrincipalId\\n    roleDefinitionId: keyVaultContributor.id\\n    principalType: 'ServicePrincipal'\\n  }\\n}\\n\\nresource keyVaultSecretOfficerAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  scope: keyvault\\n  name: guid(suffix, keyVaultSecretOfficer.id, keyvault.id)\\n  properties: {\\n    principalId: UAIPrincipalId\\n    roleDefinitionId: keyVaultSecretOfficer.id\\n    principalType: 'ServicePrincipal'\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"keyvaultName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"UAIPrincipalId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"suffix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name for the AI resource and used to derive name of dependent resources.')\\n@minLength(2)\\n@maxLength(12)\\nparam aiHubName string = 'hub-demo'\\n\\n@description('Friendly name for your Hub resource')\\nparam aiHubFriendlyName string = 'Agents Hub resource'\\n\\n@description('Description of your Azure AI resource displayed in AI studio')\\nparam aiHubDescription string = 'This is an example AI resource for use in Azure AI Studio.'\\n\\n@description('Name for the AI project resources.')\\nparam aiProjectName string = 'project-demo'\\n\\n@description('Friendly name for your Azure AI resource')\\nparam aiProjectFriendlyName string = 'Agents Project resource'\\n\\n@description('Description of your Azure AI resource displayed in AI studio')\\nparam aiProjectDescription string = 'This is an example AI Project resource for use in Azure AI Studio.'\\n\\n@description('Azure region used for the deployment of all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Set of tags to apply to all resources.')\\nparam tags object = {}\\n\\n@description('Name of the Azure AI Search account')\\nparam aiSearchName string = 'agent-ai-search'\\n\\n@description('Name for capabilityHost.')\\nparam capabilityHostName string = 'caphost1'\\n\\n@description('Name of the storage account')\\nparam storageName string = 'agent-storage'\\n\\n@description('Name of the Azure AI Services account')\\nparam aiServicesName string = 'agent-ai-services'\\n\\n@description('Model name for deployment')\\nparam modelName string = 'gpt-4o-mini'\\n\\n@description('Model format for deployment')\\nparam modelFormat string = 'OpenAI'\\n\\n@description('Model version for deployment')\\nparam modelVersion string = '2024-07-18'\\n\\n@description('Model deployment SKU name')\\nparam modelSkuName string = 'GlobalStandard'\\n\\n@description('Model deployment capacity')\\nparam modelCapacity int = 50\\n\\n@description('Model deployment location. If you want to deploy an Azure AI resource/model in different location than the rest of the resources created.')\\nparam modelLocation string = 'eastus'\\n\\n@description('AI Service Account kind: either AzureOpenAI or AIServices')\\nparam aiServiceKind string = 'AIServices'\\n\\n@description('The AI Service Account full ARM Resource ID. This is an optional field, and if not provided, the resource will be created.')\\nparam aiServiceAccountResourceId string = ''\\n\\n@description('The Ai Search Service full ARM Resource ID. This is an optional field, and if not provided, the resource will be created.')\\nparam aiSearchServiceResourceId string = ''\\n\\n@description('The Ai Storage Account full ARM Resource ID. This is an optional field, and if not provided, the resource will be created.')\\nparam aiStorageAccountResourceId string = ''\\nparam deploymentTimestamp string = utcNow('yyyyMMddHHmmss')\\n\\nvar name = toLower(aiHubName)\\nvar projectName = toLower(aiProjectName)\\nvar uniqueSuffix = substring(uniqueString('${resourceGroup().id}-${deploymentTimestamp}'), 0, 4)\\nvar aiServiceExists = (aiServiceAccountResourceId != '')\\nvar acsExists = (aiSearchServiceResourceId != '')\\nvar aiServiceParts = split(aiServiceAccountResourceId, '/')\\nvar aiServiceAccountSubscriptionId = (aiServiceExists ? aiServiceParts[2] : subscription().subscriptionId)\\nvar aiServiceAccountResourceGroupName = (aiServiceExists ? aiServiceParts[4] : resourceGroup().name)\\nvar acsParts = split(aiSearchServiceResourceId, '/')\\nvar aiSearchServiceSubscriptionId = (acsExists ? acsParts[2] : subscription().subscriptionId)\\nvar aiSearchServiceResourceGroupName = (acsExists ? acsParts[4] : resourceGroup().name)\\n\\nmodule dependencies_name_uniqueSuffix_deployment './nested_dependencies_name_uniqueSuffix_deployment.bicep' = {\\n  name: 'dependencies-${name}-${uniqueSuffix}-deployment'\\n  params: {\\n    location: location\\n    storageName: '${storageName}${uniqueSuffix}'\\n    keyvaultName: 'kv-${name}-${uniqueSuffix}'\\n    aiServicesName: '${aiServicesName}${uniqueSuffix}'\\n    aiSearchName: '${aiSearchName}-${uniqueSuffix}'\\n    tags: tags\\n    modelName: modelName\\n    modelFormat: modelFormat\\n    modelVersion: modelVersion\\n    modelSkuName: modelSkuName\\n    modelCapacity: modelCapacity\\n    modelLocation: modelLocation\\n    aiServiceAccountResourceId: aiServiceAccountResourceId\\n    aiSearchServiceResourceId: aiSearchServiceResourceId\\n    aiStorageAccountResourceId: aiStorageAccountResourceId\\n  }\\n}\\n\\nmodule name_uniqueSuffix_deployment './nested_name_uniqueSuffix_deployment.bicep' = {\\n  name: '${name}-${uniqueSuffix}-deployment'\\n  params: {\\n    aiHubName: '${name}-${uniqueSuffix}'\\n    aiHubFriendlyName: aiHubFriendlyName\\n    aiHubDescription: aiHubDescription\\n    location: location\\n    tags: tags\\n    aiSearchName: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiSearchName.value\\n    aiSearchId: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aisearchID.value\\n    aiSearchServiceResourceGroupName: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiSearchServiceResourceGroupName.value\\n    aiSearchServiceSubscriptionId: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiSearchServiceSubscriptionId.value\\n    aiServicesName: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiServicesName.value\\n    aiServiceKind: aiServiceKind\\n    aiServicesId: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiservicesID.value\\n    aiServicesTarget: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiservicesTarget.value\\n    aiServiceAccountResourceGroupName: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiServiceAccountResourceGroupName.value\\n    aiServiceAccountSubscriptionId: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiServiceAccountSubscriptionId.value\\n    keyVaultId: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.keyvaultId.value\\n    storageAccountId: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.storageId.value\\n  }\\n}\\n\\nmodule projectName_uniqueSuffix_deployment './nested_projectName_uniqueSuffix_deployment.bicep' = {\\n  name: '${projectName}-${uniqueSuffix}-deployment'\\n  params: {\\n    aiProjectName: '${projectName}-${uniqueSuffix}'\\n    aiProjectFriendlyName: aiProjectFriendlyName\\n    aiProjectDescription: aiProjectDescription\\n    location: location\\n    tags: tags\\n    aiHubId: reference(name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiHubID.value\\n  }\\n}\\n\\nmodule ai_service_role_assignments_projectName_uniqueSuffix_deployment './nested_ai_service_role_assignments_projectName_uniqueSuffix_deployment.bicep' = {\\n  name: 'ai-service-role-assignments-${projectName}-${uniqueSuffix}-deployment'\\n  scope: resourceGroup(aiServiceAccountSubscriptionId, aiServiceAccountResourceGroupName)\\n  params: {\\n    aiServicesName: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiServicesName.value\\n    aiProjectPrincipalId: reference(projectName_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiProjectPrincipalId.value\\n    aiProjectId: reference(projectName_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiProjectResourceId.value\\n  }\\n}\\n\\nmodule ai_search_role_assignments_projectName_uniqueSuffix_deployment './nested_ai_search_role_assignments_projectName_uniqueSuffix_deployment.bicep' = {\\n  name: 'ai-search-role-assignments-${projectName}-${uniqueSuffix}-deployment'\\n  scope: resourceGroup(aiSearchServiceSubscriptionId, aiSearchServiceResourceGroupName)\\n  params: {\\n    aiSearchName: reference(dependencies_name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiSearchName.value\\n    aiProjectPrincipalId: reference(projectName_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiProjectPrincipalId.value\\n    aiProjectId: reference(projectName_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiProjectResourceId.value\\n  }\\n}\\n\\nmodule capabilityHost_configuration_uniqueSuffix_deployment './nested_capabilityHost_configuration_uniqueSuffix_deployment.bicep' = {\\n  name: 'capabilityHost-configuration--${uniqueSuffix}-deployment'\\n  params: {\\n    capabilityHostName: '${uniqueSuffix}-${capabilityHostName}'\\n    aiHubName: reference(name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiHubName.value\\n    aiProjectName: reference(projectName_uniqueSuffix_deployment.id, '2022-09-01').outputs.aiProjectName.value\\n    acsConnectionName: reference(name_uniqueSuffix_deployment.id, '2022-09-01').outputs.acsConnectionName.value\\n    aoaiConnectionName: reference(name_uniqueSuffix_deployment.id, '2022-09-01').outputs.aoaiConnectionName.value\\n  }\\n  dependsOn: [\\n    extensionResourceId(\\n      '/subscriptions/${aiSearchServiceSubscriptionId}/resourceGroups/${aiSearchServiceResourceGroupName}',\\n      'Microsoft.Resources/deployments',\\n      'ai-search-role-assignments-${projectName}-${uniqueSuffix}-deployment'\\n    )\\n    extensionResourceId(\\n      '/subscriptions/${aiServiceAccountSubscriptionId}/resourceGroups/${aiServiceAccountResourceGroupName}',\\n      'Microsoft.Resources/deployments',\\n      'ai-service-role-assignments-${projectName}-${uniqueSuffix}-deployment'\\n    )\\n  ]\\n}\\n\\noutput PROJECT_CONNECTION_STRING string = reference(projectName_uniqueSuffix_deployment.id, '2022-09-01').outputs.projectConnectionString.value\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"aiHubName\\\": {\\n      \\\"value\\\": \\\"hub-demo\\\"\\n    },\\n    \\\"aiHubFriendlyName\\\": {\\n      \\\"value\\\": \\\"Agents Hub resource\\\"\\n    },\\n    \\\"aiHubDescription\\\": {\\n      \\\"value\\\": \\\"This is an example AI resource for use in Azure AI Studio.\\\"\\n    },\\n    \\\"aiProjectName\\\": {\\n      \\\"value\\\": \\\"project-demo\\\"\\n    },\\n    \\\"aiProjectFriendlyName\\\": {\\n      \\\"value\\\": \\\"Agents Project resource\\\"\\n    },\\n    \\\"aiProjectDescription\\\": {\\n      \\\"value\\\": \\\"This is an example AI Project resource for use in Azure AI Studio.\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"aiSearchName\\\": {\\n      \\\"value\\\": \\\"agent-ai-search\\\"\\n    },\\n    \\\"capabilityHostName\\\": {\\n      \\\"value\\\": \\\"caphost1\\\"\\n    },\\n    \\\"storageName\\\": {\\n      \\\"value\\\": \\\"agent-storage\\\"\\n    },\\n    \\\"aiServicesName\\\": {\\n      \\\"value\\\": \\\"agent-ai-services\\\"\\n    },\\n    \\\"modelName\\\": {\\n      \\\"value\\\": \\\"gpt-4o-mini\\\"\\n    },\\n    \\\"modelFormat\\\": {\\n      \\\"value\\\": \\\"OpenAI\\\"\\n    },\\n    \\\"modelVersion\\\": {\\n      \\\"value\\\": \\\"2024-07-18\\\"\\n    },\\n    \\\"modelSkuName\\\": {\\n      \\\"value\\\": \\\"GlobalStandard\\\"\\n    },\\n    \\\"modelCapacity\\\": {\\n      \\\"value\\\": 50\\n    },\\n    \\\"modelLocation\\\": {\\n      \\\"value\\\": \\\"eastus\\\"\\n    },\\n    \\\"aiServiceKind\\\": {\\n      \\\"value\\\": \\\"AIServices\\\"\\n    },\\n    \\\"aiServiceAccountResourceId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"aiSearchServiceResourceId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"aiStorageAccountResourceId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"deploymentTimestamp\\\": {\\n      \\\"value\\\": \\\"utcNow('yyyyMMddHHmmss')\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Azure region of the deployment')\\nparam location string\\n\\n@description('Tags to add to the resources')\\nparam tags object\\n\\n@description('AI Project name')\\nparam aiProjectName string\\n\\n@description('AI Project display name')\\nparam aiProjectFriendlyName string = aiProjectName\\n\\n@description('AI Project description')\\nparam aiProjectDescription string\\n\\n@description('Resource ID of the AI Hub resource')\\nparam aiHubId string\\n\\nvar subscriptionId = subscription().subscriptionId\\nvar resourceGroupName = resourceGroup().name\\nvar projectConnectionString = '${location}.api.azureml.ms;${subscriptionId};${resourceGroupName};${aiProjectName}'\\n\\nresource aiProject 'Microsoft.MachineLearningServices/workspaces@2024-10-01-preview' = {\\n  name: aiProjectName\\n  location: location\\n  tags: union(tags, {\\n    ProjectConnectionString: projectConnectionString\\n  })\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  properties: {\\n    friendlyName: aiProjectFriendlyName\\n    description: aiProjectDescription\\n    hubResourceId: aiHubId\\n  }\\n  kind: 'project'\\n}\\n\\nresource WaitForProjectDeployment 'Microsoft.Resources/deploymentScripts@2023-08-01' = {\\n  name: 'WaitForProjectDeployment'\\n  location: location\\n  kind: 'AzurePowerShell'\\n  properties: {\\n    azPowerShellVersion: '10.0'\\n    scriptContent: '      Write-Output \\\"Starting wait script...\\\"\\\\r\\\\n      Start-Sleep -Seconds 120  # Wait for 2 minutes\\\\r\\\\n      Write-Output \\\"Wait completed. Proceeding with deployment...\\\"\\\\r\\\\n    '\\n    retentionInterval: 'PT1H'\\n    cleanupPreference: 'OnSuccess'\\n  }\\n  dependsOn: [\\n    aiProject\\n  ]\\n}\\n\\noutput aiProjectName string = aiProjectName\\noutput aiProjectResourceId string = aiProject.id\\noutput aiProjectPrincipalId string = reference(aiProject.id, '2024-10-01-preview', 'full').identity.principalId\\noutput aiProjectWorkspaceId string = reference(aiProject.id, '2024-10-01-preview').workspaceId\\noutput projectConnectionString string = reference(aiProject.id, '2024-10-01-preview', 'full').tags.ProjectConnectionString\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiProjectName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiProjectFriendlyName\\\": {\\n      \\\"value\\\": \\\"aiProjectName\\\"\\n    },\\n    \\\"aiProjectDescription\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiHubId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"targetScope = 'subscription'\\n\\n@description('The resource group name where MSI and alert will be created')\\nparam resourceGroupName string = 'rg-sample-alert'\\n\\n@description('Name of the alert rule to be created for recovery point availability.')\\nparam alertRuleName string = 'ABCRecoveryPointAvailabilityAlert'\\n\\n@description('Description of the alert rule to be created for recovery point availability.')\\nparam alertRuleDescription string = 'Alert rule to be fired if the age of the latest recovery point is more than the time in days provided by the user.'\\n\\n@description('Severity of alert {0 - Critical, 1 - Error, 2 - Warning, 3 - Informational, 4 - Verbose}')\\n@allowed([\\n  0\\n  1\\n  2\\n  3\\n  4\\n])\\nparam alertSeverity int = 3\\n\\n@description('The interval over which datapoints are grouped by the aggregation type represented in ISO 8601 duration format. Please ensure this value is more or equal to alertEvaluationFrequency.')\\n@allowed([\\n  'P1D'\\n  'P2D'\\n])\\nparam alertAggregationGranularity string = 'P1D'\\n\\n@description('How often the metric alert is evaluated represented in ISO 8601 duration format. Please ensure that this value is less or equal to alertAggregationGranularity.')\\n@allowed([\\n  'PT6H'\\n  'P1D'\\n])\\nparam alertEvaluationFrequency string = 'PT6H'\\n\\n@description('Add latest recovery point age limit in days. If current time minus latest recovery point exceeds this value then an alert will be generated.')\\nparam LatestRPAgeThresholdInDays string = '2'\\n\\n@description('Name of the user-assigned managed identity (MSI) to associate with the alert rule. The template assigns the MSI reader access to the subscription so that the alert rule has access to query the required protected items and latest recovery point details.')\\n@minLength(3)\\n@maxLength(128)\\nparam MSIName string = 'ABCAlertsMSI'\\n\\n@description('Specify whether you are using an existing managed identity or creating a new managed identity for the alert rule.')\\n@allowed([\\n  'new'\\n  'existing'\\n])\\nparam newOrExistingMSI string\\n\\n@description('RoleDefinition Id for the role assignment to MSI - Default is for reader role. Please add a different role definition id for another role.')\\nparam roleDefinitionId string = 'acdd72a7-3385-48ef-bd42-f606fba81ae7'\\n\\nvar msiCreationTemplateName = 'MSI-creation-template'\\nvar msiRoleAssignmentTemplateName = 'MSI-role-assignment-template'\\nvar alertRuleCreationTemplateName = 'Alert-rule-creation-template'\\n\\nmodule msiCreationTemplate './nested_msiCreationTemplate.bicep' = if (newOrExistingMSI == 'new') {\\n  name: msiCreationTemplateName\\n  scope: resourceGroup(resourceGroupName)\\n  params: {\\n    MSIName: MSIName\\n    location: deployment().location\\n  }\\n}\\n\\nmodule msiRoleAssignmentTemplate './nested_msiRoleAssignmentTemplate.bicep' = if (newOrExistingMSI == 'new') {\\n  name: msiRoleAssignmentTemplateName\\n  params: {\\n    roleDefinitionId: roleDefinitionId\\n    MSIName: MSIName\\n    resourceGroupName: resourceGroupName\\n  }\\n  dependsOn: [\\n    msiCreationTemplate\\n  ]\\n}\\n\\nmodule alertRuleCreationTemplate './nested_alertRuleCreationTemplate.bicep' = {\\n  name: alertRuleCreationTemplateName\\n  scope: resourceGroup(resourceGroupName)\\n  params: {\\n    alertRuleName: alertRuleName\\n    alertRuleDescription: alertRuleDescription\\n    alertSeverity: alertSeverity\\n    alertEvaluationFrequency: alertEvaluationFrequency\\n    alertAggregationGranularity: alertAggregationGranularity\\n    MSIName: MSIName\\n    resourceGroupName: resourceGroupName\\n    location: deployment().location\\n    LatestRPAgeThresholdInDays: LatestRPAgeThresholdInDays\\n  }\\n  dependsOn: [\\n    msiRoleAssignmentTemplate\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"resourceGroupName\\\": {\\n      \\\"value\\\": \\\"rg-sample-alert\\\"\\n    },\\n    \\\"alertRuleName\\\": {\\n      \\\"value\\\": \\\"ABCRecoveryPointAvailabilityAlert\\\"\\n    },\\n    \\\"alertRuleDescription\\\": {\\n      \\\"value\\\": \\\"Alert rule to be fired if the age of the latest recovery point is more than the time in days provided by the user.\\\"\\n    },\\n    \\\"alertSeverity\\\": {\\n      \\\"value\\\": 3\\n    },\\n    \\\"alertAggregationGranularity\\\": {\\n      \\\"value\\\": \\\"P1D\\\"\\n    },\\n    \\\"alertEvaluationFrequency\\\": {\\n      \\\"value\\\": \\\"PT6H\\\"\\n    },\\n    \\\"LatestRPAgeThresholdInDays\\\": {\\n      \\\"value\\\": \\\"2\\\"\\n    },\\n    \\\"MSIName\\\": {\\n      \\\"value\\\": \\\"ABCAlertsMSI\\\"\\n    },\\n    \\\"newOrExistingMSI\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"roleDefinitionId\\\": {\\n      \\\"value\\\": \\\"acdd72a7-3385-48ef-bd42-f606fba81ae7\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param location string\\nparam aksClusterName string\\nparam aksAdminGroupObjectId string = ''\\nparam aksControlPlaneIP string\\n@maxValue(5)\\nparam aksControlPlaneNodeCount int = 1\\nparam aksControlPlaneNodeSize string = 'Standard_A4_v2'\\nparam aksPodCidr string = '10.244.0.0/16'\\nparam aksKubernetesVersion string = 'v1.26.6'\\nparam aksNodePoolName string\\nparam aksNodePoolNodeCount int = 1\\nparam aksNodePoolNodeSize string = 'Standard_A4_v2'\\n@allowed(['Linux', 'Windows'])\\nparam aksNodePoolOSType string = 'Linux'\\nparam sshPublicKey string\\nparam hciLogicalNetworkName string\\nparam hciCustomLocationName string\\n\\nvar customLocationId = resourceId('Microsoft.ExtendedLocation/customLocations', hciCustomLocationName) // full custom location ID\\n\\n// retrieve the existing logical network resource - ensures the logical network exists before creating cluster\\nresource logicalNetwork 'Microsoft.AzureStackHCI/logicalNetworks@2023-09-01-preview' existing = {\\n  name: hciLogicalNetworkName\\n}\\n\\n\\n// create the connected cluster - this is the Arc representation of the AKS cluster, used to create a Managed Identity for the provisioned cluster\\nresource connectedCluster 'Microsoft.Kubernetes/ConnectedClusters@2024-01-01' = {\\n  name: aksClusterName\\n  location: location\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  kind: 'ProvisionedCluster'\\n  properties: {\\n    agentPublicKeyCertificate: ''\\n    aadProfile: {\\n      enableAzureRBAC: false\\n      adminGroupObjectIDs: [aksAdminGroupObjectId]\\n    }\\n  }\\n}\\n\\n// create the provisioned cluster instance - this is the actual AKS cluster and provisioned on your HCI cluster via the Arc Resource Bridge\\nresource provisionedClusterInstance 'Microsoft.HybridContainerService/provisionedClusterInstances@2024-01-01' = {\\n  name: 'default'\\n  scope: connectedCluster\\n  extendedLocation: {\\n    type: 'CustomLocation'\\n    name: customLocationId\\n  }\\n  properties: {\\n    linuxProfile: {\\n      ssh: {\\n        publicKeys: [\\n          {\\n            keyData: sshPublicKey\\n          }\\n        ]\\n      }\\n    }\\n    controlPlane: {\\n      count: aksControlPlaneNodeCount\\n      controlPlaneEndpoint: {\\n        hostIP: aksControlPlaneIP\\n      }\\n      vmSize: aksControlPlaneNodeSize\\n    }\\n    kubernetesVersion: aksKubernetesVersion\\n    networkProfile: {\\n      loadBalancerProfile: {\\n        count: 0 // use MetalLB\\n      }\\n      networkPolicy: 'calico'\\n      podCidr: aksPodCidr\\n    }\\n    agentPoolProfiles: [\\n      {\\n        name: aksNodePoolName\\n        count: aksNodePoolNodeCount\\n        vmSize: aksNodePoolNodeSize\\n        osType: aksNodePoolOSType\\n      }\\n    ]\\n    cloudProviderProfile: {\\n      infraNetworkProfile: {\\n        vnetSubnetIds: [\\n          logicalNetwork.id\\n        ]\\n      }\\n    }\\n    storageProfile: {\\n      nfsCsiDriver: {\\n        enabled: false\\n      }\\n      smbCsiDriver: {\\n        enabled: false\\n      }\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aksClusterName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aksAdminGroupObjectId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"aksControlPlaneIP\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aksControlPlaneNodeCount\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"aksControlPlaneNodeSize\\\": {\\n      \\\"value\\\": \\\"Standard_A4_v2\\\"\\n    },\\n    \\\"aksPodCidr\\\": {\\n      \\\"value\\\": \\\"10.244.0.0/16\\\"\\n    },\\n    \\\"aksKubernetesVersion\\\": {\\n      \\\"value\\\": \\\"v1.26.6\\\"\\n    },\\n    \\\"aksNodePoolName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aksNodePoolNodeCount\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"aksNodePoolNodeSize\\\": {\\n      \\\"value\\\": \\\"Standard_A4_v2\\\"\\n    },\\n    \\\"aksNodePoolOSType\\\": {\\n      \\\"value\\\": \\\"Linux\\\"\\n    },\\n    \\\"sshPublicKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"hciLogicalNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"hciCustomLocationName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param customLocationName string\\nparam location string\\nparam imageName string\\n@allowed([ 'Windows' ])\\nparam osType string = 'Windows'\\n@allowed([ \\n  'microsoftwindowsserver:windowsserver:2022-datacenter-azure-edition-core'\\n  'microsoftwindowsserver:windowsserver:2022-datacenter-azure-edition'\\n  'microsoftwindowsserver:windowsserver:2022-datacenter-azure-edition-hotpatch'\\n  'microsoftwindowsdesktop:office-365:win11-21h2-avd-m365'\\n  'microsoftwindowsdesktop:office-365:win10-21h2-avd-m365-g2'\\n  'microsoftwindowsdesktop:windows-10:win10-21h2-avd-g2'\\n  'microsoftwindowsdesktop:windows-11:win11-21h2-avd'\\n  'microsoftwindowsdesktop:windows-11:win11-22h2-avd' ])\\nparam imageURN string\\nparam skuVersion string = 'latest'\\n@allowed([ 'v2' ])\\nparam hyperVGeneration string = 'v2'\\n\\n// as of 9/21/23, these are the only marketplace images supported on Azure Stack HCI\\n\\n// Windows Server 2022 Datacenter: Azure Editition Core - Gen2:                                           microsoftwindowsserver:windowsserver:2022-datacenter-azure-edition-core\\n// Windows Server 2022 Datacenter: Azure Editition - Gen2:                                                microsoftwindowsserver:windowsserver:2022-datacenter-azure-edition\\n// Windows Server 2022 Datacenter: Azure Editition Hotpatch - Gen2:                                       microsoftwindowsserver:windowsserver:2022-datacenter-azure-edition-hotpatch\\n// Windows 11 Enterprise multi-session + Microsoft 365 Apps, version 21H2 - Gen2:                         microsoftwindowsdesktop:office-365:win11-21h2-avd-m365\\n// Windows 10 Enterprise multi-session, version 21H2 + Microsoft 365 Apps - Gen2:                         microsoftwindowsdesktop:office-365:win10-21h2-avd-m365-g2\\n// Windows 10 Enterprise multi-session, version 21H2 - Gen2:                                              microsoftwindowsdesktop:windows-10:win10-21h2-avd-g2\\n// Windows 11 Enterprise multi-session, version 21h2 - Gen2:                                              microsoftwindowsdesktop:windows-11:win11-21h2-avd\\n// Windows 11 Enterprise multi-session, version 22h2 - Gen2:                                              microsoftwindowsdesktop:windows-11:win11-22h2-avd\\n\\nvar customLocationId = resourceId('Microsoft.ExtendedLocation/customLocations', customLocationName)\\nvar publisherId = split(imageURN, ':')[0]\\nvar offerId = split(imageURN, ':')[1]\\nvar planId = split(imageURN, ':')[2]\\n\\nresource image 'microsoft.azurestackhci/marketplacegalleryimages@2021-09-01-preview' = {\\n  extendedLocation: {\\n    name: customLocationId\\n    type: 'CustomLocation'\\n  }\\n  location: location\\n  name: imageName\\n  properties: {\\n    osType: osType\\n    resourceName: imageName\\n    hyperVGeneration: hyperVGeneration\\n    identifier: {\\n      publisher: publisherId\\n      offer: offerId\\n      sku: planId\\n    }\\n    version: {\\n      name: skuVersion\\n    }\\n  }\\n  tags: {}\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"customLocationName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"imageName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"osType\\\": {\\n      \\\"value\\\": \\\"Windows\\\"\\n    },\\n    \\\"imageURN\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"skuVersion\\\": {\\n      \\\"value\\\": \\\"latest\\\"\\n    },\\n    \\\"hyperVGeneration\\\": {\\n      \\\"value\\\": \\\"v2\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@maxLength(15)\\nparam name string\\nparam location string\\nparam vCPUCount int = 2\\nparam memoryMB int = 8192\\nparam adminUsername string\\n@description('The name of a Marketplace Gallery Image already downloaded to the Azure Stack HCI cluster. For example: winServer2022-01')\\nparam imageName string\\n@description('The name of an existing Logical Network in your HCI cluster - for example: vnet-compute-vlan240-dhcp')\\nparam hciLogicalNetworkName string\\n@description('The name of the custom location to use for the deployment. This name is specified during the deployment of the Azure Stack HCI cluster and can be found on the Azure Stack HCI cluster resource Overview in the Azure portal.')\\nparam customLocationName string\\n@secure()\\nparam adminPassword string\\n\\nvar nicName = 'nic-${name}' // name of the NIC to be created\\nvar customLocationId = resourceId('Microsoft.ExtendedLocation/customLocations', customLocationName) // full custom location ID\\nvar marketplaceGalleryImageId = resourceId('microsoft.azurestackhci/marketplaceGalleryImages', imageName) // full marketplace gallery image ID\\nvar logicalNetworkId = resourceId('microsoft.azurestackhci/logicalnetworks', hciLogicalNetworkName) // full logical network ID\\n\\n// precreate an Arc Connected Machine with an identity--used for zero-touch onboarding of the Arc VM during deployment\\nresource hybridComputeMachine 'Microsoft.HybridCompute/machines@2023-10-03-preview' = {\\n  name: name\\n  location: location\\n  kind: 'HCI'\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n}\\n\\nresource nic 'Microsoft.AzureStackHCI/networkInterfaces@2024-01-01' = {\\n  name: nicName\\n  location: location\\n  extendedLocation: {\\n    type: 'CustomLocation'\\n    name: customLocationId\\n  }\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          // uncomment to specify an IP, otherwise an IP address is dynamically allocated from the Logical Network's address pool\\n          // privateIPAddress: 'x.x.x.x'\\n          subnet: {\\n            id: logicalNetworkId\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualMachine 'Microsoft.AzureStackHCI/virtualMachineInstances@2024-01-01' = {\\n  name: 'default' // value must be 'default' per 2023-09-01-preview\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: 'Custom'\\n      processors: vCPUCount\\n      memoryMB: memoryMB\\n      // ### uncomment to use dymamic memory ###\\n      // dynamicMemoryConfig: {\\n      //   maximumMemoryMB: memoryMB\\n      //   minimumMemoryMB: 512\\n      //   targetMemoryBuffer: 20\\n      // }\\n    }\\n    osProfile: {\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n      computerName: name\\n      windowsConfiguration: {\\n        provisionVMAgent: true // mocguestagent\\n        provisionVMConfigAgent: true // azure arc connected machine agent\\n      }\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        id: marketplaceGalleryImageId\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n  extendedLocation: {\\n    type: 'CustomLocation'\\n    name: customLocationId\\n  }\\n  scope: hybridComputeMachine\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"name\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vCPUCount\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"memoryMB\\\": {\\n      \\\"value\\\": 8192\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"imageName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"hciLogicalNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"customLocationName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('batch acount name')\\nparam batchservice string\\n\\n@description('certificate securestring reference to keyvault')\\n@secure()\\nparam certdata string\\n\\n@description('keyvault certificate thumbprint')\\n@secure()\\nparam certthumbprint string\\n\\n@description('keyvault certificate pfx password')\\n@secure()\\nparam certpassword string\\n\\nvar certname_var = '${batchservice}/SHA1-${certthumbprint}'\\n\\nresource certname 'Microsoft.Batch/batchAccounts/certificates@2021-01-01' = {\\n  name: certname_var\\n  properties: {\\n    format: 'Pfx'\\n    thumbprint: certthumbprint\\n    thumbprintAlgorithm: 'SHA1'\\n    data: certdata\\n    password: certpassword\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"batchservice\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"certdata\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"certthumbprint\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"certpassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specify the name of the Azure Redis Cache to create.')\\nparam redisCacheName string = 'redisCache-${uniqueString(resourceGroup().id)}'\\n\\n@description('Location of all resources')\\nparam location string = resourceGroup().location\\n\\n@description('Specify the pricing tier of the new Azure Redis Cache.')\\n@allowed([\\n  'Basic'\\n  'Standard'\\n  'Premium'\\n])\\nparam redisCacheSKU string = 'Standard'\\n\\n@description('Specify the family for the sku. C = Basic/Standard, P = Premium.')\\n@allowed([\\n  'C'\\n  'P'\\n])\\nparam redisCacheFamily string = 'C'\\n\\n@description('Specify the size of the new Azure Redis Cache instance. Valid values: for C (Basic/Standard) family (0, 1, 2, 3, 4, 5, 6), for P (Premium) family (1, 2, 3, 4, 5)')\\n@allowed([\\n  0\\n  1\\n  2\\n  3\\n  4\\n  5\\n  6\\n])\\nparam redisCacheCapacity int = 1\\n\\n@description('Specify name of Built-In access policy to use as assignment.')\\n@allowed([\\n  'Data Owner'\\n  'Data Contributor'\\n  'Data Reader'\\n])\\nparam builtInAccessPolicyName string = 'Data Reader'\\n\\n@description('Specify name of custom access policy to create.')\\nparam builtInAccessPolicyAssignmentName string = 'builtInAccessPolicyAssignment-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specify the valid objectId(usually it is a GUID) of the Microsoft Entra Service Principal or Managed Identity or User Principal to which the built-in access policy would be assigned.')\\nparam builtInAccessPolicyAssignmentObjectId string = newGuid()\\n\\n@description('Specify human readable name of principal Id of the Microsoft Entra Application name or Managed Identity name used for built-in policy assignment.')\\nparam builtInAccessPolicyAssignmentObjectAlias string = 'builtInAccessPolicyApplication-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specify name of custom access policy to create.')\\nparam customAccessPolicyName string = 'customAccessPolicy-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specify the valid permissions for the customer access policy to create. For details refer to https://aka.ms/redis/ConfigureAccessPolicyPermissions')\\nparam customAccessPolicyPermissions string = '+@connection +get +hget allkeys'\\n\\n@description('Specify name of custom access policy to create.')\\nparam customAccessPolicyAssignmentName string = 'customAccessPolicyAssignment-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specify the valid objectId(usually it is a GUID) of the Microsoft Entra Service Principal or Managed Identity or User Principal to which the custom access policy would be assigned.')\\nparam customAccessPolicyAssignmentObjectId string = newGuid()\\n\\n@description('Specify human readable name of principal Id of the Microsoft Entra Application name or Managed Identity name used for custom policy assignment.')\\nparam customAccessPolicyAssignmentObjectAlias string = 'customAccessPolicyApplication-${uniqueString(resourceGroup().id)}'\\n\\nresource redisCache 'Microsoft.Cache/redis@2023-08-01' = {\\n  name: redisCacheName\\n  location: location\\n  properties: {\\n    enableNonSslPort: false\\n    minimumTlsVersion: '1.2'\\n    sku: {\\n      capacity: redisCacheCapacity\\n      family: redisCacheFamily\\n      name: redisCacheSKU\\n    }\\n    redisConfiguration: {\\n      'aad-enabled': 'true'\\n    }\\n  }\\n}\\n\\nresource redisCacheBuiltInAccessPolicyAssignment 'Microsoft.Cache/redis/accessPolicyAssignments@2023-08-01' = {\\n  name: builtInAccessPolicyAssignmentName\\n  parent: redisCache\\n  properties: {\\n    accessPolicyName: builtInAccessPolicyName\\n    objectId: builtInAccessPolicyAssignmentObjectId\\n    objectIdAlias: builtInAccessPolicyAssignmentObjectAlias\\n  }\\n}\\n\\nresource redisCacheCustomAccessPolicy 'Microsoft.Cache/redis/accessPolicies@2023-08-01' = {\\n  name: customAccessPolicyName\\n  parent: redisCache\\n  properties: {\\n    permissions: customAccessPolicyPermissions\\n  }\\n  dependsOn: [\\n    redisCacheBuiltInAccessPolicyAssignment\\n  ]\\n}\\n\\nresource redisCacheCustomAccessPolicyAssignment 'Microsoft.Cache/redis/accessPolicyAssignments@2023-08-01' = {\\n  name: customAccessPolicyAssignmentName\\n  parent: redisCache\\n  properties: {\\n    accessPolicyName: customAccessPolicyName\\n    objectId: customAccessPolicyAssignmentObjectId\\n    objectIdAlias: customAccessPolicyAssignmentObjectAlias\\n  }\\n  dependsOn: [\\n    redisCacheCustomAccessPolicy\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"redisCacheName\\\": {\\n      \\\"value\\\": \\\"redisCache-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"redisCacheSKU\\\": {\\n      \\\"value\\\": \\\"Standard\\\"\\n    },\\n    \\\"redisCacheFamily\\\": {\\n      \\\"value\\\": \\\"C\\\"\\n    },\\n    \\\"redisCacheCapacity\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"builtInAccessPolicyName\\\": {\\n      \\\"value\\\": \\\"Data Reader\\\"\\n    },\\n    \\\"builtInAccessPolicyAssignmentName\\\": {\\n      \\\"value\\\": \\\"builtInAccessPolicyAssignment-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"builtInAccessPolicyAssignmentObjectId\\\": {\\n      \\\"value\\\": \\\"newGuid()\\\"\\n    },\\n    \\\"builtInAccessPolicyAssignmentObjectAlias\\\": {\\n      \\\"value\\\": \\\"builtInAccessPolicyApplication-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"customAccessPolicyName\\\": {\\n      \\\"value\\\": \\\"customAccessPolicy-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"customAccessPolicyPermissions\\\": {\\n      \\\"value\\\": \\\"+@connection +get +hget allkeys\\\"\\n    },\\n    \\\"customAccessPolicyAssignmentName\\\": {\\n      \\\"value\\\": \\\"customAccessPolicyAssignment-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"customAccessPolicyAssignmentObjectId\\\": {\\n      \\\"value\\\": \\\"newGuid()\\\"\\n    },\\n    \\\"customAccessPolicyAssignmentObjectAlias\\\": {\\n      \\\"value\\\": \\\"customAccessPolicyApplication-${uniqueString(resourceGroup().id)}\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specify the name of the Azure Redis Cache to create.')\\nparam redisCacheName string\\n\\n@description('Name of the storage account.')\\nparam storageAccountName string\\n\\n@description('The location of the Redis Cache. For best performance, use the same location as the app to be used with the cache.')\\nparam location string = resourceGroup().location\\n\\n@description('Specify the pricing tier of the new Azure Redis Cache.')\\n@allowed([\\n  'Basic'\\n  'Standard'\\n  'Premium'\\n])\\nparam redisCacheSKU string = 'Premium'\\n\\n@description('Specify the family for the sku. C = Basic/Standard, P = Premium')\\n@allowed([\\n  'C'\\n  'P'\\n])\\nparam redisCacheFamily string = 'P'\\n\\n@description('Specify the size of the new Azure Redis Cache instance. Valid values: for C (Basic/Standard) family (0, 1, 2, 3, 4, 5, 6), for P (Premium) family (1, 2, 3, 4)')\\n@allowed([\\n  0\\n  1\\n  2\\n  3\\n  4\\n  5\\n  6\\n])\\nparam redisCacheCapacity int = 1\\n\\n@description('Specify a boolean value that indicates whether to allow access via non-SSL ports.')\\nparam enableNonSslPort bool = false\\n\\n@description('Specify a boolean value that indicates whether diagnostics should be saved to the specified storage account.')\\nparam diagnosticsEnabled bool = true\\n\\n@description('Specify an existing storage account for diagnostics.')\\nparam existingDiagnosticsStorageAccountId string\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-04-01' existing = {\\n  name: storageAccountName\\n}\\n\\nvar cacheAccountKey = storageAccount.listKeys().keys[0].value\\n\\nresource cache 'Microsoft.Cache/Redis@2020-06-01' = {\\n  name: redisCacheName\\n  location: location\\n  properties: {\\n    enableNonSslPort: enableNonSslPort\\n    minimumTlsVersion: '1.2'\\n    sku: {\\n      capacity: redisCacheCapacity\\n      family: redisCacheFamily\\n      name: redisCacheSKU\\n    }\\n    redisConfiguration: {\\n      'rdb-backup-enabled': 'true'\\n      'rdb-backup-frequency': '60'\\n      'rdb-backup-max-snapshot-count': '1'\\n      'rdb-storage-connection-string': 'DefaultEndpointsProtocol=https;BlobEndpoint=https://${storageAccount.name}.blob.${environment().suffixes.storage};AccountName=${storageAccount.name};AccountKey=${cacheAccountKey}'\\n    }\\n  }\\n}\\n\\nresource diagSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\\n  scope: cache\\n  name: redisCacheName\\n  properties: {\\n    storageAccountId: existingDiagnosticsStorageAccountId\\n    metrics: [\\n      {\\n        timeGrain: 'AllMetrics'\\n        enabled: diagnosticsEnabled\\n        retentionPolicy: {\\n          days: 90\\n          enabled: diagnosticsEnabled\\n        }\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"redisCacheName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"redisCacheSKU\\\": {\\n      \\\"value\\\": \\\"Premium\\\"\\n    },\\n    \\\"redisCacheFamily\\\": {\\n      \\\"value\\\": \\\"P\\\"\\n    },\\n    \\\"redisCacheCapacity\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"enableNonSslPort\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"diagnosticsEnabled\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"existingDiagnosticsStorageAccountId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the CDN Profile')\\nparam profileName string\\n\\n@description('Name of the CDN Endpoint, must be unique')\\nparam endpointName string\\n\\n@description('Url of the origin')\\nparam originUrl string\\n\\n@description('CDN SKU names')\\n@allowed([\\n  'Standard_Akamai'\\n  'Standard_Microsoft'\\n  'Standard_Verizon'\\n  'Premium_Verizon'\\n])\\nparam CDNSku string = 'Standard_Microsoft'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nresource profile 'Microsoft.Cdn/profiles@2021-06-01' = {\\n  name: profileName\\n  location: location\\n  sku: {\\n    name: CDNSku\\n  }\\n}\\n\\nresource profileName_endpoint 'Microsoft.Cdn/profiles/endpoints@2021-06-01' = {\\n  parent: profile\\n  name: '${endpointName}'\\n  location: location\\n  properties: {\\n    originHostHeader: originUrl\\n    isHttpAllowed: true\\n    isHttpsAllowed: true\\n    queryStringCachingBehavior: 'IgnoreQueryString'\\n    contentTypesToCompress: [\\n      'application/eot'\\n      'application/font'\\n      'application/font-sfnt'\\n      'application/javascript'\\n      'application/json'\\n      'application/opentype'\\n      'application/otf'\\n      'application/pkcs7-mime'\\n      'application/truetype'\\n      'application/ttf'\\n      'application/vnd.ms-fontobject'\\n      'application/xhtml+xml'\\n      'application/xml'\\n      'application/xml+rss'\\n      'application/x-font-opentype'\\n      'application/x-font-truetype'\\n      'application/x-font-ttf'\\n      'application/x-httpd-cgi'\\n      'application/x-javascript'\\n      'application/x-mpegurl'\\n      'application/x-opentype'\\n      'application/x-otf'\\n      'application/x-perl'\\n      'application/x-ttf'\\n      'font/eot'\\n      'font/ttf'\\n      'font/otf'\\n      'font/opentype'\\n      'image/svg+xml'\\n      'text/css'\\n      'text/csv'\\n      'text/html'\\n      'text/javascript'\\n      'text/js'\\n      'text/plain'\\n      'text/richtext'\\n      'text/tab-separated-values'\\n      'text/xml'\\n      'text/x-script'\\n      'text/x-component'\\n      'text/x-java-source'\\n    ]\\n    isCompressionEnabled: true\\n    origins: [\\n      {\\n        name: 'origin1'\\n        properties: {\\n          hostName: originUrl\\n        }\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"profileName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"endpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"originUrl\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"CDNSku\\\": {\\n      \\\"value\\\": \\\"Standard_Microsoft\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the CDN Profile')\\nparam profileName string\\n\\n@description('Name of the CDN Endpoint')\\nparam endpointName string\\n\\n@description('Url of the origin')\\nparam originUrl string\\n\\n@description('CDN SKU names')\\n@allowed([\\n  'Standard_Akamai'\\n  'Standard_Verizon'\\n  'Premium_Verizon'\\n  'Standard_Microsoft'\\n])\\nparam CDNSku string = 'Standard_Microsoft'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nresource profile 'Microsoft.Cdn/profiles@2021-06-01' = {\\n  name: profileName\\n  location: location\\n  sku: {\\n    name: CDNSku\\n  }\\n}\\n\\nresource endpoint 'Microsoft.Cdn/profiles/endpoints@2021-06-01' = {\\n  parent: profile\\n  location: location\\n  name: endpointName\\n  properties: {\\n    originHostHeader: originUrl\\n    isHttpAllowed: true\\n    isHttpsAllowed: true\\n    queryStringCachingBehavior: 'IgnoreQueryString'\\n    contentTypesToCompress: [\\n      'text/plain'\\n      'text/html'\\n      'text/css'\\n      'application/x-javascript'\\n      'text/javascript'\\n    ]\\n    isCompressionEnabled: true\\n    origins: [\\n      {\\n        name: 'origin1'\\n        properties: {\\n          hostName: originUrl\\n        }\\n      }\\n    ]\\n    deliveryPolicy: {\\n      description: 'Rewrite and Redirect'\\n      rules: [\\n        {\\n          name: 'PathRewriteBasedOnDeviceMatchCondition'\\n          order: 1\\n          conditions: [\\n            {\\n              name: 'IsDevice'\\n              parameters: {\\n                typeName: 'DeliveryRuleIsDeviceConditionParameters'\\n                operator: 'Equal'\\n                matchValues: [\\n                  'Mobile'\\n                ]\\n              }\\n            }\\n          ]\\n          actions: [\\n            {\\n              name: 'UrlRewrite'\\n              parameters: {\\n                typeName: 'DeliveryRuleUrlRewriteActionParameters'\\n                sourcePattern: '/standard'\\n                destination: '/mobile'\\n              }\\n            }\\n          ]\\n        }\\n        {\\n          name: 'HttpVersionBasedRedirect'\\n          order: 2\\n          conditions: [\\n            {\\n              name: 'RequestScheme'\\n              parameters: {\\n                typeName: 'DeliveryRuleRequestSchemeConditionParameters'\\n                operator: 'Equal'\\n                matchValues: [\\n                  'HTTP'\\n                ]\\n              }\\n            }\\n          ]\\n          actions: [\\n            {\\n              name: 'UrlRedirect'\\n              parameters: {\\n                typeName: 'DeliveryRuleUrlRedirectActionParameters'\\n                redirectType: 'Found'\\n                destinationProtocol: 'Https'\\n              }\\n            }\\n          ]\\n        }\\n      ]\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"profileName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"endpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"originUrl\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"CDNSku\\\": {\\n      \\\"value\\\": \\\"Standard_Microsoft\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the CDN WAF Policy')\\nparam policyName string\\n\\n@description('Name of the CDN Profile')\\nparam profileName string\\n\\n@description('Name of the CDN Endpoint')\\nparam endpointName string\\n\\n@description('Url of the origin')\\nparam originUrl string\\n\\n@description('The enforcement mode of the CDN WAF Policy')\\n@allowed([\\n  'Detection'\\n  'Prevention'\\n])\\nparam policyMode string = 'Detection'\\n\\n@description('Whether the CDN WAF Policy is enabled')\\n@allowed([\\n  'Enabled'\\n  'Disabled'\\n])\\nparam enabledState string = 'Enabled'\\n\\n@description('The redirect URL of the CDN WAF Policy')\\nparam redirectUrl string = 'https://contoso.com/login'\\n\\n@description('CDN SKU names')\\n@allowed([\\n  'Standard_Microsoft'\\n])\\nparam CDNSku string = 'Standard_Microsoft'\\n\\n@description('Location the CDN profile and endpoint.')\\nparam location string = resourceGroup().location\\n\\nresource policy 'Microsoft.Cdn/CdnWebApplicationFirewallPolicies@2020-09-01' = {\\n  name: policyName\\n  location: 'Global'\\n  sku: {\\n    name: CDNSku\\n  }\\n  properties: {\\n    policySettings: {\\n      enabledState: enabledState\\n      mode: policyMode\\n      defaultRedirectUrl: redirectUrl\\n    }\\n    rateLimitRules: {\\n      rules: [\\n        {\\n          name: 'BaseLimit'\\n          priority: 100\\n          enabledState: 'Enabled'\\n          rateLimitThreshold: 1000\\n          rateLimitDurationInMinutes: 1\\n          matchConditions: [\\n            {\\n              matchVariable: 'RequestMethod'\\n              operator: 'Any'\\n              negateCondition: false\\n            }\\n          ]\\n          action: 'Block'\\n        }\\n        {\\n          name: 'WriteLimit'\\n          priority: 50\\n          enabledState: 'Enabled'\\n          rateLimitThreshold: 100\\n          rateLimitDurationInMinutes: 1\\n          matchConditions: [\\n            {\\n              matchVariable: 'RequestMethod'\\n              operator: 'Equal'\\n              negateCondition: false\\n              matchValue: [\\n                'POST'\\n                'PUT'\\n                'PATCH'\\n              ]\\n            }\\n          ]\\n          action: 'Redirect'\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource profile 'Microsoft.Cdn/profiles@2019-06-15-preview' = {\\n  name: profileName\\n  location: location\\n  sku: {\\n    name: CDNSku\\n  }\\n}\\n\\nresource profileName_endpoint 'Microsoft.Cdn/profiles/endpoints@2019-06-15-preview' = {\\n  parent: profile\\n  location: location\\n  name: '${endpointName}'\\n  properties: {\\n    originHostHeader: originUrl\\n    isHttpAllowed: true\\n    isHttpsAllowed: true\\n    queryStringCachingBehavior: 'IgnoreQueryString'\\n    contentTypesToCompress: [\\n      'text/plain'\\n      'text/html'\\n      'text/css'\\n      'application/x-javascript'\\n      'text/javascript'\\n    ]\\n    isCompressionEnabled: true\\n    origins: [\\n      {\\n        name: 'origin1'\\n        properties: {\\n          hostName: originUrl\\n        }\\n      }\\n    ]\\n    webApplicationFirewallPolicyLink: {\\n      id: policy.id\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"policyName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"profileName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"endpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"originUrl\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"policyMode\\\": {\\n      \\\"value\\\": \\\"Detection\\\"\\n    },\\n    \\\"enabledState\\\": {\\n      \\\"value\\\": \\\"Enabled\\\"\\n    },\\n    \\\"redirectUrl\\\": {\\n      \\\"value\\\": \\\"'https:\\\"\\n    },\\n    \\\"CDNSku\\\": {\\n      \\\"value\\\": \\\"Standard_Microsoft\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The location into which the App Service resources should be deployed.')\\nparam location string\\n\\n@description('The name of the App Service application to create. This must be globally unique.')\\nparam appName string\\n\\n@description('The name of the SKU to use when creating the App Service plan. This must be a SKU that is compatible with private endpoints, i.e. P1v2 or better.')\\nparam appServicePlanSkuName string\\n\\n@description('The number of worker instances of your App Service plan that should be provisioned.')\\nparam appServicePlanCapacity int\\n\\nvar appServicePlanName = 'AppServicePlan'\\n\\nresource appServicePlan 'Microsoft.Web/serverfarms@2020-06-01' = {\\n  name: appServicePlanName\\n  location: location\\n  sku: {\\n    name: appServicePlanSkuName\\n    capacity: appServicePlanCapacity\\n  }\\n  kind: 'app'\\n}\\n\\nresource app 'Microsoft.Web/sites@2020-06-01' = {\\n  name: appName\\n  location: location\\n  kind: 'app'\\n  properties: {\\n    serverFarmId: appServicePlan.id\\n  }\\n}\\n\\noutput appHostName string = app.properties.defaultHostName\\noutput appServiceResourceId string = app.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"appName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"appServicePlanSkuName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"appServicePlanCapacity\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The location into which the Azure Storage resources should be deployed.')\\nparam location string\\n\\n@description('The name of the Azure Storage account to create. This must be globally unique.')\\nparam accountName string\\n\\n@description('The name of the SKU to use when creating the Azure Storage account.')\\n@allowed([\\n  'Standard_LRS'\\n  'Standard_GRS'\\n  'Standard_ZRS'\\n  'Premium_LRS'\\n])\\nparam skuName string\\n\\n@description('The name of the Azure Storage blob container to create.')\\nparam blobContainerName string\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\\n  name: accountName\\n  location: location\\n  kind: 'StorageV2'\\n  sku: {\\n    name: skuName\\n  }\\n  properties: {\\n    publicNetworkAccess: 'Disabled'\\n    allowBlobPublicAccess: true\\n    minimumTlsVersion: 'TLS1_2'\\n    supportsHttpsTrafficOnly: true\\n    networkAcls: {\\n      defaultAction: 'Deny'\\n    }\\n  }\\n\\n  resource defaultBlobService 'blobServices' existing = {\\n    name: 'default'\\n  }\\n}\\n\\nresource blobContainer 'Microsoft.Storage/storageAccounts/blobServices/containers@2021-08-01' = {\\n  name: blobContainerName\\n  parent: storageAccount::defaultBlobService\\n  properties:{\\n    publicAccess: 'Blob'\\n  }\\n}\\n\\noutput blobEndpointHostName string = replace(replace(storageAccount.properties.primaryEndpoints.blob, 'https://', ''), '/', '')\\noutput storageResourceId string = storageAccount.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"accountName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"skuName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"blobContainerName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The location into which the Private Link service resources should be deployed.')\\nparam location string\\n\\n@description('The resource ID of the virtual network subnet that the VM should be deployed into.')\\nparam subnetResourceId string\\n\\n@description('The name of the SKU to use when creating the virtual machine.')\\nparam vmSize string\\n\\n@description('The details of the image to deploy on the virtual machine.')\\nparam vmImageReference object\\n\\n@description('The type of disk and storage account to use for the virtual machine\\\\'s OS disk.')\\nparam vmOSDiskStorageAccountType string\\n\\n@description('The administrator username to use for the virtual machine.')\\nparam vmAdminUsername string\\n\\n@description('The administrator password to use for the virtual machine.')\\n@secure()\\nparam vmAdminPassword string\\n\\n@description('The resource ID of the load balancer\\\\'s backend address pool, which this virtual machine\\\\'s NIC will be added to.')\\nparam loadBalancerBackendAddressPoolResourceId string\\n\\nvar vmName = 'MyVM'\\nvar vmNicName = 'MyVM-NIC'\\nvar vmOSDiskName = 'MyVM-OSDisk'\\n\\nresource vmName_InstallCustomScript 'Microsoft.Compute/virtualMachines/extensions@2020-06-01' = {\\n  parent: vm\\n  name: 'InstallCustomScript'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Compute'\\n    type: 'CustomScriptExtension'\\n    typeHandlerVersion: '1.0'\\n    autoUpgradeMinorVersion: true\\n    protectedSettings: {\\n      commandToExecute: 'powershell -ExecutionPolicy Unrestricted Install-WindowsFeature -Name Web-Server'\\n    }\\n  }\\n}\\n\\nresource vmNic 'Microsoft.Network/networkInterfaces@2020-06-01' = {\\n  name: vmNicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipConfig'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: subnetResourceId\\n          }\\n          loadBalancerBackendAddressPools: [\\n            {\\n              id: loadBalancerBackendAddressPoolResourceId\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2020-06-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: vmAdminUsername\\n      adminPassword: vmAdminPassword\\n    }\\n    storageProfile: {\\n      imageReference: vmImageReference\\n      osDisk: {\\n        name: vmOSDiskName\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n        managedDisk: {\\n          storageAccountType: vmOSDiskStorageAccountType\\n        }\\n        diskSizeGB: 128\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: vmNic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetResourceId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmImageReference\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmOSDiskStorageAccountType\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmAdminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmAdminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"loadBalancerBackendAddressPoolResourceId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The location into which regional resources should be deployed.')\\nparam location string = resourceGroup().location\\n\\n@description('The name of the Front Door endpoint to create. This must be globally unique.')\\nparam endpointName string = 'afd-${uniqueString(resourceGroup().id)}'\\n\\n@description('The host name that should be used when connecting from Front Door to the origin.')\\nparam originHostName string\\n\\n@allowed([\\n  'Detection'\\n  'Prevention'\\n])\\n@description('The mode that the WAF should be deployed using. In \\\\'Prevention\\\\' mode, the WAF will block requests it detects as malicious. In \\\\'Detection\\\\' mode, the WAF will not block requests and will simply log the request.')\\nparam wafMode string = 'Prevention'\\n\\n@description('The list of managed rule sets to configure on the WAF.')\\nparam wafManagedRuleSets array = [\\n  {\\n    ruleSetType: 'Microsoft_DefaultRuleSet'\\n    ruleSetVersion: '1.1'\\n  }\\n  {\\n    ruleSetType: 'Microsoft_BotManagerRuleSet'\\n    ruleSetVersion: '1.0'\\n  }\\n]\\n\\n@description('The name of the Log Analytics workspace to create.')\\nparam logAnalyticsWorkspaceName string = 'la-${uniqueString(resourceGroup().id)}'\\n\\nvar skuName = 'Premium_AzureFrontDoor' // The Microsoft-managed WAF rule sets require the premium SKU of Front Door.\\nvar profileName = 'MyFrontDoor'\\nvar originGroupName = 'MyOriginGroup'\\nvar originName = 'MyOrigin'\\nvar routeName = 'MyRoute'\\nvar wafPolicyName = 'WafPolicy'\\nvar securityPolicyName = 'SecurityPolicy'\\n\\nresource profile 'Microsoft.Cdn/profiles@2021-06-01' = {\\n  name: profileName\\n  location: 'global'\\n  sku: {\\n    name: skuName\\n  }\\n}\\n\\nresource endpoint 'Microsoft.Cdn/profiles/afdEndpoints@2021-06-01' = {\\n  name: endpointName\\n  parent: profile\\n  location: 'global'\\n  properties: {\\n    enabledState: 'Enabled'\\n  }\\n}\\n\\nresource originGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\\n  name: originGroupName\\n  parent: profile\\n  properties: {\\n    loadBalancingSettings: {\\n      sampleSize: 4\\n      successfulSamplesRequired: 3\\n    }\\n    healthProbeSettings: {\\n      probePath: '/'\\n      probeRequestType: 'HEAD'\\n      probeProtocol: 'Http'\\n      probeIntervalInSeconds: 100\\n    }\\n  }\\n}\\n\\nresource origin 'Microsoft.Cdn/profiles/originGroups/origins@2021-06-01' = {\\n  name: originName\\n  parent: originGroup\\n  properties: {\\n    hostName: originHostName\\n    httpPort: 80\\n    httpsPort: 443\\n    originHostHeader: originHostName\\n    priority: 1\\n    weight: 1000\\n  }\\n}\\n\\nresource route 'Microsoft.Cdn/profiles/afdEndpoints/routes@2021-06-01' = {\\n  name: routeName\\n  parent: endpoint\\n  dependsOn:[\\n    origin // This explicit dependency is required to ensure that the origin group is not empty when the route is created.\\n  ]\\n  properties: {\\n    originGroup: {\\n      id: originGroup.id\\n    }\\n    supportedProtocols: [\\n      'Http'\\n      'Https'\\n    ]\\n    patternsToMatch: [\\n      '/*'\\n    ]\\n    forwardingProtocol: 'HttpsOnly'\\n    linkToDefaultDomain: 'Enabled'\\n    httpsRedirect: 'Enabled'\\n  }\\n}\\n\\nresource wafPolicy 'Microsoft.Network/FrontDoorWebApplicationFirewallPolicies@2020-11-01' = {\\n  name: wafPolicyName\\n  location: 'global'\\n  sku: {\\n    name: skuName\\n  }\\n  properties: {\\n    policySettings: {\\n      enabledState: 'Enabled'\\n      mode: wafMode\\n    }\\n    managedRules: {\\n      managedRuleSets: wafManagedRuleSets\\n    }\\n  }\\n}\\n\\nresource securityPolicy 'Microsoft.Cdn/profiles/securityPolicies@2021-06-01' = {\\n  parent: profile\\n  name: securityPolicyName\\n  properties: {\\n    parameters: {\\n      type: 'WebApplicationFirewall'\\n      wafPolicy: {\\n        id: wafPolicy.id\\n      }\\n      associations: [\\n        {\\n          domains: [\\n            {\\n              id: endpoint.id\\n            }\\n          ]\\n          patternsToMatch: [\\n            '/*'\\n          ]\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2021-06-01' = {\\n  name: logAnalyticsWorkspaceName\\n  location: location\\n  properties: {\\n    retentionInDays: 30\\n    sku: {\\n      name: 'PerGB2018'\\n    }\\n  }\\n}\\n\\nresource logAnalyticsWorkspaceDiagnostics 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\\n  scope: profile\\n  name: 'diagnosticSettings'\\n  properties: {\\n    workspaceId: logAnalyticsWorkspace.id\\n    logs: [\\n      {\\n        category: 'FrontDoorWebApplicationFirewallLog'\\n        enabled: true\\n        retentionPolicy: {\\n          days: 0\\n          enabled: true\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\noutput frontDoorEndpointHostName string = endpoint.properties.hostName\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"endpointName\\\": {\\n      \\\"value\\\": \\\"afd-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"originHostName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"wafMode\\\": {\\n      \\\"value\\\": \\\"Prevention\\\"\\n    },\\n    \\\"wafManagedRuleSets\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"logAnalyticsWorkspaceName\\\": {\\n      \\\"value\\\": \\\"la-${uniqueString(resourceGroup().id)}\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The host name that should be used when connecting to the origin for the API Management proxy gateway.')\\nparam proxyOriginHostName string\\n\\n@description('The host name that should be used when connecting to the origin for the API Management developer portal.')\\nparam developerPortalOriginHostName string\\n\\n@description('The name of the Front Door endpoint to create for the API Management proxy gateway. This must be globally unique.')\\nparam proxyEndpointName string\\n\\n@description('The name of the Front Door endpoint to create for the API Management developer portal. This must be globally unique.')\\nparam developerPortalEndpointName string\\n\\n@description('The name of the SKU to use when creating the Front Door profile. If you use Private Link this must be set to `Premium_AzureFrontDoor`.')\\n@allowed([\\n  'Standard_AzureFrontDoor'\\n  'Premium_AzureFrontDoor'\\n])\\nparam skuName string\\n\\nvar profileName = 'FrontDoor'\\nvar proxyOriginGroupName = 'Proxy'\\nvar developerPortalOriginGroupName = 'DeveloperPortal'\\nvar proxyOriginName = 'ApiManagementProxy'\\nvar developerPortalOriginName = 'ApiManagementDeveloperPortal'\\nvar proxyRouteName = 'ProxyRoute'\\nvar developerPortalRouteName = 'DeveloperPortalRoute'\\n\\nresource profile 'Microsoft.Cdn/profiles@2021-06-01' = {\\n  name: profileName\\n  location: 'global'\\n  sku: {\\n    name: skuName\\n  }\\n}\\n\\nresource profileName_proxyEndpoint 'Microsoft.Cdn/profiles/afdEndpoints@2021-06-01' = {\\n  parent: profile\\n  name: '${proxyEndpointName}'\\n  location: 'global'\\n  properties: {\\n    enabledState: 'Enabled'\\n  }\\n}\\n\\nresource profileName_proxyOriginGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\\n  parent: profile\\n  name: '${proxyOriginGroupName}'\\n  properties: {\\n    loadBalancingSettings: {\\n      sampleSize: 4\\n      successfulSamplesRequired: 3\\n    }\\n    healthProbeSettings: {\\n      probePath: '/'\\n      probeRequestType: 'HEAD'\\n      probeProtocol: 'Http'\\n      probeIntervalInSeconds: 100\\n    }\\n  }\\n}\\n\\nresource profileName_proxyOriginGroupName_proxyOrigin 'Microsoft.Cdn/profiles/originGroups/origins@2021-06-01' = {\\n  parent: profileName_proxyOriginGroup\\n  name: proxyOriginName\\n  properties: {\\n    hostName: proxyOriginHostName\\n    httpPort: 80\\n    httpsPort: 443\\n    originHostHeader: proxyOriginHostName\\n    priority: 1\\n    weight: 1000\\n  }\\n}\\n\\nresource profileName_proxyEndpointName_proxyRoute 'Microsoft.Cdn/profiles/afdEndpoints/routes@2021-06-01' = {\\n  parent: profileName_proxyEndpoint\\n  name: proxyRouteName\\n  properties: {\\n    originGroup: {\\n      id: profileName_proxyOriginGroup.id\\n    }\\n    supportedProtocols: [\\n      'Http'\\n      'Https'\\n    ]\\n    patternsToMatch: [\\n      '/*'\\n    ]\\n    forwardingProtocol: 'HttpsOnly'\\n    linkToDefaultDomain: 'Enabled'\\n    httpsRedirect: 'Enabled'\\n  }\\n  dependsOn: [\\n    profileName_proxyOriginGroupName_proxyOrigin\\n  ]\\n}\\n\\nresource profileName_developerPortalEndpoint 'Microsoft.Cdn/profiles/afdEndpoints@2021-06-01' = {\\n  parent: profile\\n  name: '${developerPortalEndpointName}'\\n  location: 'global'\\n  properties: {\\n    enabledState: 'Enabled'\\n  }\\n}\\n\\nresource profileName_developerPortalOriginGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\\n  parent: profile\\n  name: '${developerPortalOriginGroupName}'\\n  properties: {\\n    loadBalancingSettings: {\\n      sampleSize: 4\\n      successfulSamplesRequired: 3\\n    }\\n    healthProbeSettings: {\\n      probePath: '/'\\n      probeRequestType: 'HEAD'\\n      probeProtocol: 'Http'\\n      probeIntervalInSeconds: 100\\n    }\\n  }\\n}\\n\\nresource profileName_developerPortalOriginGroupName_developerPortalOrigin 'Microsoft.Cdn/profiles/originGroups/origins@2021-06-01' = {\\n  parent: profileName_developerPortalOriginGroup\\n  name: developerPortalOriginName\\n  properties: {\\n    hostName: developerPortalOriginHostName\\n    httpPort: 80\\n    httpsPort: 443\\n    originHostHeader: developerPortalOriginHostName\\n    priority: 1\\n    weight: 1000\\n  }\\n}\\n\\nresource profileName_developerPortalEndpointName_developerPortalRoute 'Microsoft.Cdn/profiles/afdEndpoints/routes@2021-06-01' = {\\n  parent: profileName_developerPortalEndpoint\\n  name: developerPortalRouteName\\n  properties: {\\n    originGroup: {\\n      id: profileName_developerPortalOriginGroup.id\\n    }\\n    supportedProtocols: [\\n      'Http'\\n      'Https'\\n    ]\\n    patternsToMatch: [\\n      '/*'\\n    ]\\n    forwardingProtocol: 'HttpsOnly'\\n    linkToDefaultDomain: 'Enabled'\\n    httpsRedirect: 'Enabled'\\n  }\\n  dependsOn: [\\n    profileName_developerPortalOriginGroupName_developerPortalOrigin\\n  ]\\n}\\n\\noutput frontDoorId string = profile.properties.frontDoorId\\noutput frontDoorProxyEndpointHostName string = profileName_proxyEndpoint.properties.hostName\\noutput frontDoorDeveloperPortalEndpointHostName string = profileName_developerPortalEndpoint.properties.hostName\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"proxyOriginHostName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"developerPortalOriginHostName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"proxyEndpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"developerPortalEndpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"skuName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The location into which regionally scoped resources should be deployed. Note that Front Door is a global resource.')\\nparam location string = resourceGroup().location\\n\\n@description('The IP address prefix (CIDR range) to use when deploying the virtual network.')\\nparam vnetIPPrefix string = '10.0.0.0/16'\\n\\n@description('The IP address prefix (CIDR range) to use when deploying the Application Gateway subnet within the virtual network.')\\nparam applicationGatewaySubnetIPPrefix string = '10.0.0.0/24'\\n\\n@description('The name of the Front Door endpoint to create. This must be globally unique.')\\nparam frontDoorEndpointName string = 'afd-${uniqueString(resourceGroup().id)}'\\n\\n@description('The host name that should be used when connecting from Application Gateway to the origin.')\\nparam originHostName string\\n\\n@description('The name of the SKU to use when creating the Front Door profile.')\\n@allowed([\\n  'Standard_AzureFrontDoor'\\n  'Premium_AzureFrontDoor'\\n])\\nparam frontDoorSkuName string = 'Standard_AzureFrontDoor'\\n\\nvar frontDoorProfileName = 'MyFrontDoor'\\nvar frontDoorOriginGroupName = 'MyOriginGroup'\\nvar frontDoorOriginName = 'MyOrigin'\\nvar frontDoorRouteName = 'MyRoute'\\nvar frontDoorToApplicationGatewayProtocol = 'HttpOnly'\\n\\nresource frontDoorProfile 'Microsoft.Cdn/profiles@2021-06-01' = {\\n  name: frontDoorProfileName\\n  location: 'global'\\n  sku: {\\n    name: frontDoorSkuName\\n  }\\n}\\n\\nresource frontDoorProfileName_frontDoorEndpoint 'Microsoft.Cdn/profiles/afdEndpoints@2021-06-01' = {\\n  parent: frontDoorProfile\\n  name: '${frontDoorEndpointName}'\\n  location: 'global'\\n  properties: {\\n    enabledState: 'Enabled'\\n  }\\n}\\n\\nresource frontDoorProfileName_frontDoorOriginGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\\n  parent: frontDoorProfile\\n  name: '${frontDoorOriginGroupName}'\\n  properties: {\\n    loadBalancingSettings: {\\n      sampleSize: 4\\n      successfulSamplesRequired: 3\\n    }\\n    healthProbeSettings: {\\n      probePath: '/'\\n      probeRequestType: 'HEAD'\\n      probeProtocol: 'Http'\\n      probeIntervalInSeconds: 100\\n    }\\n  }\\n}\\n\\nresource frontDoorProfileName_frontDoorOriginGroupName_frontDoorOrigin 'Microsoft.Cdn/profiles/originGroups/origins@2021-06-01' = {\\n  parent: frontDoorProfileName_frontDoorOriginGroup\\n  name: frontDoorOriginName\\n  properties: {\\n    hostName: reference(application_gateway.id, '2022-09-01').outputs.publicIPAddressHostName.value\\n    httpPort: 80\\n    httpsPort: 443\\n    originHostHeader: reference(application_gateway.id, '2022-09-01').outputs.publicIPAddressHostName.value\\n    priority: 1\\n    weight: 1000\\n  }\\n}\\n\\nresource frontDoorProfileName_frontDoorEndpointName_frontDoorRoute 'Microsoft.Cdn/profiles/afdEndpoints/routes@2021-06-01' = {\\n  parent: frontDoorProfileName_frontDoorEndpoint\\n  name: frontDoorRouteName\\n  properties: {\\n    originGroup: {\\n      id: frontDoorProfileName_frontDoorOriginGroup.id\\n    }\\n    supportedProtocols: [\\n      'Http'\\n      'Https'\\n    ]\\n    patternsToMatch: [\\n      '/*'\\n    ]\\n    forwardingProtocol: frontDoorToApplicationGatewayProtocol\\n    linkToDefaultDomain: 'Enabled'\\n    httpsRedirect: 'Enabled'\\n  }\\n  dependsOn: [\\n    frontDoorProfileName_frontDoorOriginGroupName_frontDoorOrigin\\n  ]\\n}\\n\\nmodule network './nested_network.bicep' = {\\n  name: 'network'\\n  params: {\\n    location: location\\n    vnetIPPrefix: vnetIPPrefix\\n    applicationGatewaySubnetIPPrefix: applicationGatewaySubnetIPPrefix\\n  }\\n}\\n\\nmodule application_gateway './nested_application_gateway.bicep' = {\\n  name: 'application-gateway'\\n  params: {\\n    location: location\\n    backendFqdn: originHostName\\n    pickHostNameFromBackendAddress: true\\n    subnetResourceId: reference(network.id, '2022-09-01').outputs.applicationGatewaySubnetResourceId.value\\n    frontDoorId: reference(frontDoorProfile.id, '2021-06-01').frontDoorId\\n  }\\n}\\n\\noutput applicationGatewayHostName string = reference(application_gateway.id, '2022-09-01').outputs.publicIPAddressHostName.value\\noutput frontDoorEndpointHostName string = reference(frontDoorProfileName_frontDoorEndpoint.id, '2021-06-01').hostName\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vnetIPPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"applicationGatewaySubnetIPPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/24\\\"\\n    },\\n    \\\"frontDoorEndpointName\\\": {\\n      \\\"value\\\": \\\"afd-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"originHostName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"frontDoorSkuName\\\": {\\n      \\\"value\\\": \\\"Standard_AzureFrontDoor\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The location into which regionally scoped resources should be deployed. Note that Front Door is a global resource.')\\nparam location string = resourceGroup().location\\n\\n@description('The IP address prefix (CIDR range) to use when deploying the virtual network.')\\nparam vnetIPPrefix string = '10.0.0.0/16'\\n\\n@description('The IP address prefix (CIDR range) to use when deploying the container group subnet within the virtual network.')\\nparam containerInstancesSubnetIPPrefix string = '10.0.0.0/24'\\n\\n@description('The IP address prefix (CIDR range) to use when deploying the Application Gateway subnet within the virtual network.')\\nparam applicationGatewaySubnetIPPrefix string = '10.0.1.0/24'\\n\\n@description('The name of the Front Door endpoint to create. This must be globally unique.')\\nparam frontDoorEndpointName string = 'afd-${uniqueString(resourceGroup().id)}'\\n\\n@description('The name of the SKU to use when creating the Front Door profile.')\\n@allowed([\\n  'Standard_AzureFrontDoor'\\n  'Premium_AzureFrontDoor'\\n])\\nparam frontDoorSkuName string = 'Standard_AzureFrontDoor'\\n\\nvar frontDoorProfileName = 'MyFrontDoor'\\nvar frontDoorOriginGroupName = 'MyOriginGroup'\\nvar frontDoorOriginName = 'MyAppServiceOrigin'\\nvar frontDoorRouteName = 'MyRoute'\\n\\nvar containerGroupName = 'HelloWorld'\\nvar containerName = 'helloworld'\\nvar containerImageUri = 'mcr.microsoft.com/azuredocs/aci-helloworld:latest'\\nvar containerGroupNetworkProfileName = 'aci-networkprofile'\\nvar containerGroupNetworkProfileInterfaceName = 'eth0'\\nvar containerGroupNetworkProfileInterfaceIPConfigurationName = 'ipconfigprofile1'\\n\\nmodule network 'modules/network.bicep' = {\\n  name: 'network'\\n  params: {\\n    location: location\\n    vnetIPPrefix: vnetIPPrefix\\n    containerInstancesSubnetIPPrefix: containerInstancesSubnetIPPrefix\\n    applicationGatewaySubnetIPPrefix: applicationGatewaySubnetIPPrefix\\n  }\\n}\\n\\nresource containerGroup 'Microsoft.ContainerInstance/containerGroups@2021-03-01' = {\\n  name: containerGroupName\\n  location: location\\n  properties: {\\n    containers: [\\n      {\\n        name: containerName\\n        properties: {\\n          image: containerImageUri\\n          ports: [\\n            {\\n              port: 80\\n            }\\n          ]\\n          resources: {\\n            requests: {\\n              cpu: 1\\n              memoryInGB: 4\\n            }\\n          }\\n        }\\n      }\\n    ]\\n    restartPolicy: 'OnFailure'\\n    osType: 'Linux'\\n    networkProfile: {\\n      id: containerGroupNetworkProfile.id\\n    }\\n  }\\n}\\n\\nresource containerGroupNetworkProfile 'Microsoft.Network/networkProfiles@2021-02-01' = {\\n  name: containerGroupNetworkProfileName\\n  location: location\\n  properties: {\\n    containerNetworkInterfaceConfigurations: [\\n      {\\n        name: containerGroupNetworkProfileInterfaceName\\n        properties: {\\n          ipConfigurations: [\\n            {\\n              name: containerGroupNetworkProfileInterfaceIPConfigurationName\\n              properties: {\\n                subnet: {\\n                  id: network.outputs.containerGroupSubnetResourceId\\n                }\\n              }\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nmodule applicationGateway 'modules/application-gateway.bicep' = {\\n  name: 'application-gateway'\\n  params: {\\n    location: location\\n    backendIPAddress: containerGroup.properties.ipAddress.ip\\n    subnetResourceId: network.outputs.applicationGatewaySubnetResourceId\\n    frontDoorId: frontDoorProfile.properties.frontDoorId\\n  }\\n}\\n\\nresource frontDoorProfile 'Microsoft.Cdn/profiles@2021-06-01' = {\\n  name: frontDoorProfileName\\n  location: 'global'\\n  sku: {\\n    name: frontDoorSkuName\\n  }\\n}\\n\\nresource frontDoorEndpoint 'Microsoft.Cdn/profiles/afdEndpoints@2021-06-01' = {\\n  name: frontDoorEndpointName\\n  parent: frontDoorProfile\\n  location: 'global'\\n  properties: {\\n    enabledState: 'Enabled'\\n  }\\n}\\n\\nresource frontDoorOriginGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\\n  name: frontDoorOriginGroupName\\n  parent: frontDoorProfile\\n  properties: {\\n    loadBalancingSettings: {\\n      sampleSize: 4\\n      successfulSamplesRequired: 3\\n    }\\n    healthProbeSettings: {\\n      probePath: '/'\\n      probeRequestType: 'HEAD'\\n      probeProtocol: 'Http'\\n      probeIntervalInSeconds: 100\\n    }\\n  }\\n}\\n\\nresource frontDoorOrigin 'Microsoft.Cdn/profiles/originGroups/origins@2021-06-01' = {\\n  name: frontDoorOriginName\\n  parent: frontDoorOriginGroup\\n  properties: {\\n    hostName: applicationGateway.outputs.publicIPAddressHostName\\n    httpPort: 80\\n    httpsPort: 443\\n    originHostHeader: applicationGateway.outputs.publicIPAddressHostName\\n    priority: 1\\n    weight: 1000\\n  }\\n}\\n\\nresource frontDoorRoute 'Microsoft.Cdn/profiles/afdEndpoints/routes@2021-06-01' = {\\n  name: frontDoorRouteName\\n  parent: frontDoorEndpoint\\n  dependsOn: [\\n    frontDoorOrigin // This explicit dependency is required to ensure that the origin group is not empty when the route is created.\\n  ]\\n  properties: {\\n    originGroup: {\\n      id: frontDoorOriginGroup.id\\n    }\\n    supportedProtocols: [\\n      'Http'\\n      'Https'\\n    ]\\n    patternsToMatch: [\\n      '/*'\\n    ]\\n    forwardingProtocol: 'HttpOnly'\\n    linkToDefaultDomain: 'Enabled'\\n    httpsRedirect: 'Enabled'\\n  }\\n}\\n\\noutput frontDoorEndpointHostName string = frontDoorEndpoint.properties.hostName\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vnetIPPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"containerInstancesSubnetIPPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/24\\\"\\n    },\\n    \\\"applicationGatewaySubnetIPPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.1.0/24\\\"\\n    },\\n    \\\"frontDoorEndpointName\\\": {\\n      \\\"value\\\": \\\"afd-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"frontDoorSkuName\\\": {\\n      \\\"value\\\": \\\"Standard_AzureFrontDoor\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the Front Door endpoint to create. This must be globally unique.')\\nparam endpointName string = 'afd-${uniqueString(resourceGroup().id)}'\\n\\n@description('The name of the SKU to use when creating the Front Door profile.')\\n@allowed([\\n  'Standard_AzureFrontDoor'\\n  'Premium_AzureFrontDoor'\\n])\\nparam skuName string = 'Standard_AzureFrontDoor'\\n\\n@description('The host name that should be used when connecting from Front Door to the origin.')\\nparam originHostName string\\n\\n@description('The custom domain name to associate with your Front Door endpoint.')\\nparam customDomainName string\\n\\nvar profileName = 'MyFrontDoor'\\nvar originGroupName = 'MyOriginGroup'\\nvar originName = 'MyOrigin'\\nvar routeName = 'MyRoute'\\nvar customDomainResourceName = replace(customDomainName, '.', '-')\\n\\nresource profile 'Microsoft.Cdn/profiles@2020-09-01' = {\\n  name: profileName\\n  location: 'global'\\n  sku: {\\n    name: skuName\\n  }\\n}\\n\\nresource profileName_endpoint 'Microsoft.Cdn/profiles/afdEndpoints@2020-09-01' = {\\n  parent: profile\\n  name: '${endpointName}'\\n  location: 'global'\\n  properties: {\\n    originResponseTimeoutSeconds: 240\\n    enabledState: 'Enabled'\\n  }\\n}\\n\\nresource profileName_originGroup 'Microsoft.Cdn/profiles/originGroups@2020-09-01' = {\\n  parent: profile\\n  name: '${originGroupName}'\\n  properties: {\\n    loadBalancingSettings: {\\n      sampleSize: 4\\n      successfulSamplesRequired: 3\\n    }\\n    healthProbeSettings: {\\n      probePath: '/'\\n      probeRequestType: 'HEAD'\\n      probeProtocol: 'Http'\\n      probeIntervalInSeconds: 100\\n    }\\n  }\\n}\\n\\nresource profileName_customDomainResource 'Microsoft.Cdn/profiles/customDomains@2020-09-01' = {\\n  parent: profile\\n  name: '${customDomainResourceName}'\\n  properties: {\\n    hostName: customDomainName\\n    tlsSettings: {\\n      certificateType: 'ManagedCertificate'\\n      minimumTlsVersion: 'TLS12'\\n    }\\n  }\\n}\\n\\nresource profileName_originGroupName_origin 'Microsoft.Cdn/profiles/originGroups/origins@2020-09-01' = {\\n  parent: profileName_originGroup\\n  name: originName\\n  properties: {\\n    hostName: originHostName\\n    httpPort: 80\\n    httpsPort: 443\\n    originHostHeader: originHostName\\n    priority: 1\\n    weight: 1000\\n  }\\n}\\n\\nresource profileName_endpointName_route 'Microsoft.Cdn/profiles/afdEndpoints/routes@2020-09-01' = {\\n  parent: profileName_endpoint\\n  name: routeName\\n  properties: {\\n    customDomains: [\\n      {\\n        id: profileName_customDomainResource.id\\n      }\\n    ]\\n    originGroup: {\\n      id: profileName_originGroup.id\\n    }\\n    supportedProtocols: [\\n      'Http'\\n      'Https'\\n    ]\\n    patternsToMatch: [\\n      '/*'\\n    ]\\n    queryStringCachingBehavior: 'IgnoreQueryString'\\n    forwardingProtocol: 'HttpsOnly'\\n    linkToDefaultDomain: 'Enabled'\\n    httpsRedirect: 'Enabled'\\n  }\\n  dependsOn: [\\n    profileName_originGroupName_origin\\n  ]\\n}\\n\\noutput customDomainValidationDnsTxtRecordName string = '_dnsauth.${reference(profileName_customDomainResource.id,'2020-09-01').hostName}'\\noutput customDomainValidationDnsTxtRecordValue string = reference(profileName_customDomainResource.id, '2020-09-01').validationProperties.validationToken\\noutput customDomainValidationExpiry string = reference(profileName_customDomainResource.id, '2020-09-01').validationProperties.expirationDate\\noutput frontDoorEndpointHostName string = reference(profileName_endpoint.id, '2020-09-01').hostName\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"endpointName\\\": {\\n      \\\"value\\\": \\\"afd-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"skuName\\\": {\\n      \\\"value\\\": \\\"Standard_AzureFrontDoor\\\"\\n    },\\n    \\\"originHostName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"customDomainName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The location into which regionally scoped resources should be deployed. Note that Front Door is a global resource.')\\nparam location string = resourceGroup().location\\n\\n@description('The name of the Azure Functions application to create. This must be globally unique.')\\nparam functionAppName string = 'fn-${uniqueString(resourceGroup().id)}'\\n\\n@description('The name of the SKU to use when creating the Azure Functions plan.')\\nparam functionPlanSkuName string = 'EP1'\\n\\n@description('The name of the Front Door endpoint to create. This must be globally unique.')\\nparam frontDoorEndpointName string = 'afd-${uniqueString(resourceGroup().id)}'\\n\\n@description('The name of the SKU to use when creating the Front Door profile.')\\n@allowed([\\n  'Standard_AzureFrontDoor'\\n  'Premium_AzureFrontDoor'\\n])\\nparam frontDoorSkuName string = 'Standard_AzureFrontDoor'\\n\\nvar frontDoorProfileName = 'MyFrontDoor'\\nvar frontDoorOriginGroupName = 'MyOriginGroup'\\nvar frontDoorOriginName = 'MyAppServiceOrigin'\\nvar frontDoorRouteName = 'MyRoute'\\n\\nresource frontDoorProfile 'Microsoft.Cdn/profiles@2021-06-01' = {\\n  name: frontDoorProfileName\\n  location: 'global'\\n  sku: {\\n    name: frontDoorSkuName\\n  }\\n}\\n\\nmodule functionApp 'modules/function.bicep' = {\\n  name: 'functionapp'\\n  params: {\\n    location: location\\n    appName: functionAppName\\n    functionPlanSkuName: functionPlanSkuName\\n    frontDoorId: frontDoorProfile.properties.frontDoorId\\n  }\\n}\\n\\nresource frontDoorEndpoint 'Microsoft.Cdn/profiles/afdEndpoints@2021-06-01' = {\\n  name: frontDoorEndpointName\\n  parent: frontDoorProfile\\n  location: 'global'\\n  properties: {\\n    enabledState: 'Enabled'\\n  }\\n}\\n\\nresource frontDoorOriginGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\\n  name: frontDoorOriginGroupName\\n  parent: frontDoorProfile\\n  properties: {\\n    loadBalancingSettings: {\\n      sampleSize: 4\\n      successfulSamplesRequired: 3\\n    }\\n    healthProbeSettings: {\\n      probePath: '/'\\n      probeRequestType: 'HEAD'\\n      probeProtocol: 'Http'\\n      probeIntervalInSeconds: 100\\n    }\\n  }\\n}\\n\\nresource frontDoorOrigin 'Microsoft.Cdn/profiles/originGroups/origins@2021-06-01' = {\\n  name: frontDoorOriginName\\n  parent: frontDoorOriginGroup\\n  properties: {\\n    hostName: functionApp.outputs.functionAppHostName\\n    httpPort: 80\\n    httpsPort: 443\\n    originHostHeader: functionApp.outputs.functionAppHostName\\n    priority: 1\\n    weight: 1000\\n  }\\n}\\n\\nresource frontDoorRoute 'Microsoft.Cdn/profiles/afdEndpoints/routes@2021-06-01' = {\\n  name: frontDoorRouteName\\n  parent: frontDoorEndpoint\\n  dependsOn: [\\n    frontDoorOrigin // This explicit dependency is required to ensure that the origin group is not empty when the route is created.\\n  ]\\n  properties: {\\n    originGroup: {\\n      id: frontDoorOriginGroup.id\\n    }\\n    supportedProtocols: [\\n      'Http'\\n      'Https'\\n    ]\\n    patternsToMatch: [\\n      '/*'\\n    ]\\n    forwardingProtocol: 'HttpsOnly'\\n    linkToDefaultDomain: 'Enabled'\\n    httpsRedirect: 'Enabled'\\n  }\\n}\\n\\noutput frontDoorEndpointFunctionUrl string = 'https://${frontDoorEndpoint.properties.hostName}/api/${functionApp.outputs.functionName}'\\noutput functionAppFunctionUrl string = 'https://${functionApp.outputs.functionAppHostName}/api/${functionApp.outputs.functionName}'\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"functionAppName\\\": {\\n      \\\"value\\\": \\\"fn-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"functionPlanSkuName\\\": {\\n      \\\"value\\\": \\\"EP1\\\"\\n    },\\n    \\\"frontDoorEndpointName\\\": {\\n      \\\"value\\\": \\\"afd-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"frontDoorSkuName\\\": {\\n      \\\"value\\\": \\\"Standard_AzureFrontDoor\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the Front Door endpoint to create. This must be globally unique.')\\nparam endpointName string = 'afd-${uniqueString(resourceGroup().id)}'\\n\\n@description('The name of the SKU to use when creating the Front Door profile.')\\n@allowed([\\n  'Standard_AzureFrontDoor'\\n  'Premium_AzureFrontDoor'\\n])\\nparam skuName string = 'Standard_AzureFrontDoor'\\n\\n@description('The host name that should be used when connecting from Front Door to the origin.')\\nparam originHostName string\\n\\nvar profileName = 'MyFrontDoor'\\nvar originGroupName = 'MyOriginGroup'\\nvar originName = 'MyOrigin'\\nvar routeName = 'MyRoute'\\nvar ruleSetName = 'MyRuleSet'\\nvar redirectSecureTrafficToMicrosoftRuleName = 'RedirectSecureTrafficToMicrosoft'\\n\\nresource profile 'Microsoft.Cdn/profiles@2021-06-01' = {\\n  name: profileName\\n  location: 'global'\\n  sku: {\\n    name: skuName\\n  }\\n}\\n\\nresource profileName_endpoint 'Microsoft.Cdn/profiles/afdEndpoints@2021-06-01' = {\\n  parent: profile\\n  name: '${endpointName}'\\n  location: 'global'\\n  properties: {\\n    enabledState: 'Enabled'\\n  }\\n}\\n\\nresource profileName_originGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\\n  parent: profile\\n  name: '${originGroupName}'\\n  properties: {\\n    loadBalancingSettings: {\\n      sampleSize: 4\\n      successfulSamplesRequired: 3\\n    }\\n    healthProbeSettings: {\\n      probePath: '/'\\n      probeRequestType: 'HEAD'\\n      probeProtocol: 'Http'\\n      probeIntervalInSeconds: 100\\n    }\\n  }\\n}\\n\\nresource profileName_originGroupName_origin 'Microsoft.Cdn/profiles/originGroups/origins@2021-06-01' = {\\n  parent: profileName_originGroup\\n  name: originName\\n  properties: {\\n    hostName: originHostName\\n    httpPort: 80\\n    httpsPort: 443\\n    originHostHeader: originHostName\\n    priority: 1\\n    weight: 1000\\n  }\\n}\\n\\nresource profileName_ruleSet 'Microsoft.Cdn/profiles/ruleSets@2021-06-01' = {\\n  parent: profile\\n  name: '${ruleSetName}'\\n}\\n\\nresource profileName_ruleSetName_redirectSecureTrafficToMicrosoftRule 'Microsoft.Cdn/profiles/ruleSets/rules@2021-06-01' = {\\n  parent: profileName_ruleSet\\n  name: redirectSecureTrafficToMicrosoftRuleName\\n  properties: {\\n    order: 1\\n    conditions: [\\n      {\\n        name: 'UrlPath'\\n        parameters: {\\n          operator: 'BeginsWith'\\n          negateCondition: false\\n          matchValues: [\\n            'secure/'\\n          ]\\n          transforms: [\\n            'Lowercase'\\n          ]\\n          typeName: 'DeliveryRuleUrlPathMatchConditionParameters'\\n        }\\n      }\\n    ]\\n    actions: [\\n      {\\n        name: 'UrlRedirect'\\n        parameters: {\\n          redirectType: 'TemporaryRedirect'\\n          destinationProtocol: 'Https'\\n          customHostname: 'microsoft.com'\\n          customPath: '/'\\n          typeName: 'DeliveryRuleUrlRedirectActionParameters'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource profileName_endpointName_route 'Microsoft.Cdn/profiles/afdEndpoints/routes@2021-06-01' = {\\n  parent: profileName_endpoint\\n  name: routeName\\n  properties: {\\n    originGroup: {\\n      id: profileName_originGroup.id\\n    }\\n    ruleSets: [\\n      {\\n        id: profileName_ruleSet.id\\n      }\\n    ]\\n    supportedProtocols: [\\n      'Http'\\n      'Https'\\n    ]\\n    patternsToMatch: [\\n      '/*'\\n    ]\\n    forwardingProtocol: 'HttpsOnly'\\n    linkToDefaultDomain: 'Enabled'\\n    httpsRedirect: 'Enabled'\\n  }\\n  dependsOn: [\\n    profileName_originGroupName_origin\\n  ]\\n}\\n\\noutput frontDoorEndpointHostName string = profileName_endpoint.properties.hostName\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"endpointName\\\": {\\n      \\\"value\\\": \\\"afd-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"skuName\\\": {\\n      \\\"value\\\": \\\"Standard_AzureFrontDoor\\\"\\n    },\\n    \\\"originHostName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The location into which regionally scoped resources should be deployed. Note that Front Door is a global resource.')\\nparam location string = resourceGroup().location\\n\\n@description('The name of the Azure Storage account to create. This must be globally unique.')\\nparam storageAccountName string = 'stor${uniqueString(resourceGroup().id)}'\\n\\n@description('The name of the SKU to use when creating the Azure Storage account.')\\n@allowed([\\n  'Standard_LRS'\\n  'Standard_GRS'\\n  'Standard_ZRS'\\n  'Standard_GZRS'\\n  'Premium_LRS'\\n])\\nparam storageSkuName string = 'Standard_LRS'\\n\\n@description('The name of the page to display when a user navigates to the root of your static website.')\\nparam storageStaticWebsiteIndexDocument string = 'index.html'\\n\\n@description('The name of the page to display when a user attempts to navigate to a page that does not exist in your static website.')\\nparam storageStaticWebsiteErrorDocument404Path string = 'error.html'\\n\\n@description('The name of the Front Door endpoint to create. This must be globally unique.')\\nparam frontDoorEndpointName string = 'afd-${uniqueString(resourceGroup().id)}'\\n\\n@description('The name of the SKU to use when creating the Front Door profile.')\\n@allowed([\\n  'Standard_AzureFrontDoor'\\n  'Premium_AzureFrontDoor'\\n])\\nparam frontDoorSkuName string = 'Standard_AzureFrontDoor'\\n\\nmodule storage 'modules/storage-static-website.bicep' = {\\n  name: 'storage'\\n  params: {\\n    location: location\\n    accountName: storageAccountName\\n    skuName: storageSkuName\\n    indexDocument: storageStaticWebsiteIndexDocument\\n    errorDocument404Path: storageStaticWebsiteErrorDocument404Path\\n  }\\n}\\n\\nmodule frontDoor 'modules/front-door.bicep' = {\\n  name: 'front-door'\\n  params: {\\n    skuName: frontDoorSkuName\\n    endpointName: frontDoorEndpointName\\n    originHostName: storage.outputs.staticWebsiteHostName\\n  }\\n}\\n\\noutput frontDoorEndpointHostName string = frontDoor.outputs.frontDoorEndpointHostName\\noutput storageStaticWebsiteHostName string = storage.outputs.staticWebsiteHostName\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"stor${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"storageSkuName\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"storageStaticWebsiteIndexDocument\\\": {\\n      \\\"value\\\": \\\"index.html\\\"\\n    },\\n    \\\"storageStaticWebsiteErrorDocument404Path\\\": {\\n      \\\"value\\\": \\\"error.html\\\"\\n    },\\n    \\\"frontDoorEndpointName\\\": {\\n      \\\"value\\\": \\\"afd-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"frontDoorSkuName\\\": {\\n      \\\"value\\\": \\\"Standard_AzureFrontDoor\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Display name of the Azure AI Vision resource')\\nparam aiServicesName string = 'computerVision-${uniqueString(resourceGroup().id)}'\\n\\n@description('SKU for Computer Vision API')\\n@allowed([\\n  'F0'\\n  'S1'\\n])\\nparam sku string = 'F0'\\n\\n@description('Location of the resource group.')\\nparam location string = resourceGroup().location\\n\\nresource aiServices 'Microsoft.CognitiveServices/accounts@2023-05-01' = {\\n  name: aiServicesName\\n  location: location\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  kind: 'ComputerVision'\\n  sku: {\\n    name: sku\\n  }\\n  properties: {\\n    publicNetworkAccess: 'Disabled'\\n    networkAcls: {\\n      defaultAction: 'Deny'\\n    }\\n    disableLocalAuth: true\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"aiServicesName\\\": {\\n      \\\"value\\\": \\\"computerVision-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"sku\\\": {\\n      \\\"value\\\": \\\"F0\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Admin password.')\\n@secure()\\nparam adminPassword string\\n\\n@description('Admin username.')\\nparam adminUsername string\\n\\n@description('DNS for Load Balancer IP.')\\nparam dnsNameforLBIP string\\n\\n@description('Security Type of the Virtual Machine.')\\n@allowed([\\n  'Standard'\\n  'TrustedLaunch'\\n])\\nparam securityType string = 'TrustedLaunch'\\n\\n@description('The Windows version for the VM. This will pick a fully patched image of this given Windows version.')\\n@allowed([\\n  '2016-datacenter-gensecond'\\n  '2016-datacenter-server-core-g2'\\n  '2016-datacenter-server-core-smalldisk-g2'\\n  '2016-datacenter-smalldisk-g2'\\n  '2016-datacenter-with-containers-g2'\\n  '2016-datacenter-zhcn-g2'\\n  '2019-datacenter-core-g2'\\n  '2019-datacenter-core-smalldisk-g2'\\n  '2019-datacenter-core-with-containers-g2'\\n  '2019-datacenter-core-with-containers-smalldisk-g2'\\n  '2019-datacenter-gensecond'\\n  '2019-datacenter-smalldisk-g2'\\n  '2019-datacenter-with-containers-g2'\\n  '2019-datacenter-with-containers-smalldisk-g2'\\n  '2019-datacenter-zhcn-g2'\\n  '2022-datacenter-azure-edition'\\n  '2022-datacenter-azure-edition-core'\\n  '2022-datacenter-azure-edition-core-smalldisk'\\n  '2022-datacenter-azure-edition-smalldisk'\\n  '2022-datacenter-core-g2'\\n  '2022-datacenter-core-smalldisk-g2'\\n  '2022-datacenter-g2'\\n  '2022-datacenter-smalldisk-g2'\\n])\\nparam OSVersion string = '2022-datacenter-azure-edition'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Name of storage account.')\\nparam storageAccountName string = 'storage${uniqueString(resourceGroup().id)}'\\n\\n@description('Size of the virtual machine.')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\nvar extensionName = 'GuestAttestation'\\nvar extensionPublisher = 'Microsoft.Azure.Security.WindowsAttestation'\\nvar extensionVersion = '1.0'\\nvar maaEndpoint = substring('emptystring', 0, 0)\\nvar maaTenantName = 'GuestAttestation'\\nvar securityProfileJson = {\\n  uefiSettings: {\\n    secureBootEnabled: true\\n    vTpmEnabled: true\\n  }\\n  securityType: securityType\\n}\\nvar addressPrefix = '10.0.0.0/16'\\nvar imageOffer = 'WindowsServer'\\nvar imagePublisher = 'MicrosoftWindowsServer'\\nvar imageSKU = OSVersion\\nvar lbName = 'myLB'\\nvar networkSecurityGroupName = '${subnetName}-nsg'\\nvar nic1Name = 'nic1'\\nvar nic2Name = 'nic2'\\nvar publicIPAddressName = 'myPublicIP'\\nvar publicIPAddressType = 'Dynamic'\\nvar storageAccountType = 'Standard_LRS'\\nvar subnetName = 'Subnet-1'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar vmName = 'myVM'\\nvar vnetName = 'myVNET'\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n  kind: 'StorageV2'\\n}\\n\\nresource lb 'Microsoft.Network/loadBalancers@2023-05-01' = {\\n  name: lbName\\n  location: location\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: 'LoadBalancerFrontEnd'\\n        properties: {\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: 'BackendPool1'\\n      }\\n    ]\\n    inboundNatRules: [\\n      {\\n        name: 'RDP-VM0'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', lbName, 'LoadBalancerFrontEnd')\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 50001\\n          backendPort: 3389\\n          enableFloatingIP: false\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource backendAddressPool 'Microsoft.Network/loadBalancers/backendAddressPools@2023-05-01' existing = {\\n  parent: lb\\n  name: 'BackendPool1'\\n}\\n\\nresource inboundNatRule 'Microsoft.Network/loadBalancers/inboundNatRules@2023-05-01' existing = {\\n  parent: lb\\n  name: 'RDP-VM0'\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2023-05-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {}\\n}\\n\\nresource nic1 'Microsoft.Network/networkInterfaces@2023-05-01' = {\\n  name: nic1Name\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: subnet.id\\n          }\\n          loadBalancerBackendAddressPools: [\\n            {\\n              id: backendAddressPool.id\\n            }\\n          ]\\n          loadBalancerInboundNatRules: [\\n            {\\n              id: inboundNatRule.id\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic2 'Microsoft.Network/networkInterfaces@2023-05-01' = {\\n  name: nic2Name\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: subnet.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2023-05-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsNameforLBIP\\n    }\\n  }\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2023-07-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: imageSKU\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        createOption: 'FromImage'\\n      }\\n    }\\n    securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          properties: {\\n            primary: true\\n          }\\n          id: nic1.id\\n        }\\n        {\\n          properties: {\\n            primary: false\\n          }\\n          id: nic2.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: storageAccount.properties.primaryEndpoints.blob\\n      }\\n    }\\n  }\\n}\\n\\nresource guestAttestation 'Microsoft.Compute/virtualMachines/extensions@2023-07-01' = if ((securityType == 'TrustedLaunch') && ((securityProfileJson.uefiSettings.secureBootEnabled == true) && (securityProfileJson.uefiSettings.vTpmEnabled == true))) {\\n  parent: vm\\n  name: 'GuestAttestation'\\n  location: location\\n  properties: {\\n    publisher: extensionPublisher\\n    type: extensionName\\n    typeHandlerVersion: extensionVersion\\n    autoUpgradeMinorVersion: true\\n    enableAutomaticUpgrade: true\\n    settings: {\\n      AttestationConfig: {\\n        MaaSettings: {\\n          maaEndpoint: maaEndpoint\\n          maaTenantName: maaTenantName\\n        }\\n      }\\n    }\\n  }\\n}\\n\\nresource vnet 'Microsoft.Network/virtualNetworks@2023-05-01' = {\\n  name: vnetName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2023-05-01' existing = {\\n  parent: vnet\\n  name: subnetName\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsNameforLBIP\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"securityType\\\": {\\n      \\\"value\\\": \\\"TrustedLaunch\\\"\\n    },\\n    \\\"OSVersion\\\": {\\n      \\\"value\\\": \\\"2022-datacenter-azure-edition\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"storage${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Admin username')\\nparam adminUsername string\\n\\n@description('Admin password')\\n@secure()\\nparam adminPassword string\\n\\n@description('Unique DNS name')\\nparam dnsNameforLBIP string = 'uniqueDnsNameforLBIP'\\n\\n@description('VM name prefix')\\nparam vmNamePrefix string = 'myVM'\\n\\n@description('Load Balancer name')\\nparam lbName string = 'myLB'\\n\\n@description('Network Interface Name Prefix')\\nparam nicNamePrefix string = 'nic'\\n\\n@description('Public IP Address Name')\\nparam publicIPAddressName string = 'myPublicIP'\\n\\n@description('VNET name')\\nparam vnetName string = 'myVNET'\\n\\n@description('Image Publisher')\\nparam imagePublisher string = 'MicrosoftWindowsServer'\\n\\n@description('Image Offer')\\nparam imageOffer string = 'WindowsServer'\\n\\n@description('Image SKU')\\nparam imageSKU string = '2012-R2-Datacenter'\\n\\n@description('VM Size')\\n@allowed([\\n  'Standard_A0'\\n  'Standard_A1'\\n  'Standard_A2'\\n  'Standard_A3'\\n  'Standard_A4'\\n])\\nparam vmSize string = 'Standard_A1'\\n\\n@description('Resource location')\\nparam location string = resourceGroup().location\\n\\nvar storageAccountType = 'Standard_LRS'\\nvar availabilitySetName = 'myAvSet'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'Subnet-1'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar publicIPAddressType = 'Dynamic'\\nvar numberOfInstances = 2\\nvar storageAccountName = uniqueString(resourceGroup().id)\\nvar networkSecurityGroupName = '${subnetName}-nsg'\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-01-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n}\\n\\nresource availabilitySet 'Microsoft.Compute/availabilitySets@2016-04-30-preview' = {\\n  name: availabilitySetName\\n  location: location\\n  properties: {\\n    platformFaultDomainCount: 2\\n    platformUpdateDomainCount: 2\\n    managed: true\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2015-06-15' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsNameforLBIP\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2019-08-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {}\\n}\\n\\nresource vnet 'Microsoft.Network/virtualNetworks@2015-06-15' = {\\n  name: vnetName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nicNamePrefix_resource 'Microsoft.Network/networkInterfaces@2020-11-01' = [\\n  for i in range(0, numberOfInstances): {\\n    name: concat(nicNamePrefix, i)\\n    location: location\\n    properties: {\\n      ipConfigurations: [\\n        {\\n          name: 'ipconfig1'\\n          properties: {\\n            privateIPAllocationMethod: 'Dynamic'\\n            subnet: {\\n              id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, subnetName)\\n            }\\n            loadBalancerBackendAddressPools: [\\n              {\\n                id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbName, 'LoadBalancerBackend')\\n              }\\n            ]\\n            loadBalancerInboundNatRules: [\\n              {\\n                id: resourceId('Microsoft.Network/loadBalancers/inboundNatRules', lbName, 'RDP-VM${i}')\\n              }\\n            ]\\n          }\\n        }\\n      ]\\n    }\\n    dependsOn: [\\n      vnet\\n      lb\\n      resourceId('Microsoft.Network/loadBalancers/inboundNatRules', lbName, 'RDP-VM${i}')\\n    ]\\n  }\\n]\\n\\nresource lb 'Microsoft.Network/loadBalancers@2020-11-01' = {\\n  name: lbName\\n  location: location\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: 'LoadBalancerFrontend'\\n        properties: {\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: 'LoadBalancerBackend'\\n      }\\n    ]\\n  }\\n}\\n\\nresource lbName_RDP_VM 'Microsoft.Network/loadBalancers/inboundNatRules@2020-11-01' = [\\n  for i in range(0, numberOfInstances): {\\n    name: '${lbName}/RDP-VM${i}'\\n    location: location\\n    properties: {\\n      frontendIPConfiguration: {\\n        id: resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', lbName, 'loadBalancerFrontend')\\n      }\\n      protocol: 'Tcp'\\n      frontendPort: (i + 5000)\\n      backendPort: 3389\\n      enableFloatingIP: false\\n    }\\n    dependsOn: [\\n      lb\\n    ]\\n  }\\n]\\n\\nresource vmNamePrefix_resource 'Microsoft.Compute/virtualMachines@2020-12-01' = [\\n  for i in range(0, numberOfInstances): {\\n    name: concat(vmNamePrefix, i)\\n    location: location\\n    properties: {\\n      availabilitySet: {\\n        id: availabilitySet.id\\n      }\\n      hardwareProfile: {\\n        vmSize: vmSize\\n      }\\n      osProfile: {\\n        computerName: concat(vmNamePrefix, i)\\n        adminUsername: adminUsername\\n        adminPassword: adminPassword\\n      }\\n      storageProfile: {\\n        imageReference: {\\n          publisher: imagePublisher\\n          offer: imageOffer\\n          sku: imageSKU\\n          version: 'latest'\\n        }\\n        osDisk: {\\n          createOption: 'FromImage'\\n        }\\n      }\\n      networkProfile: {\\n        networkInterfaces: [\\n          {\\n            id: resourceId('Microsoft.Network/networkInterfaces', concat(nicNamePrefix, i))\\n          }\\n        ]\\n      }\\n      diagnosticsProfile: {\\n        bootDiagnostics: {\\n          enabled: true\\n          storageUri: reference(storageAccountName, '2021-01-01').primaryEndpoints.blob\\n        }\\n      }\\n    }\\n    dependsOn: [\\n      storageAccount\\n      resourceId('Microsoft.Network/networkInterfaces', concat(nicNamePrefix, i))\\n      availabilitySet\\n    ]\\n  }\\n]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsNameforLBIP\\\": {\\n      \\\"value\\\": \\\"uniqueDnsNameforLBIP\\\"\\n    },\\n    \\\"vmNamePrefix\\\": {\\n      \\\"value\\\": \\\"myVM\\\"\\n    },\\n    \\\"lbName\\\": {\\n      \\\"value\\\": \\\"myLB\\\"\\n    },\\n    \\\"nicNamePrefix\\\": {\\n      \\\"value\\\": \\\"nic\\\"\\n    },\\n    \\\"publicIPAddressName\\\": {\\n      \\\"value\\\": \\\"myPublicIP\\\"\\n    },\\n    \\\"vnetName\\\": {\\n      \\\"value\\\": \\\"myVNET\\\"\\n    },\\n    \\\"imagePublisher\\\": {\\n      \\\"value\\\": \\\"MicrosoftWindowsServer\\\"\\n    },\\n    \\\"imageOffer\\\": {\\n      \\\"value\\\": \\\"WindowsServer\\\"\\n    },\\n    \\\"imageSKU\\\": {\\n      \\\"value\\\": \\\"2012-R2-Datacenter\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_A1\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the virtual machine')\\nparam vmName string\\n\\n@description('Volume type being decrypted')\\nparam volumeType string = 'Data'\\n\\n@description('Pass in an unique value like a GUID everytime the operation needs to be force run')\\nparam forceUpdateTag string = uniqueString(resourceGroup().id, deployment().name)\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nresource vmName_AzureDiskEncryptionForLinux 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  name: '${vmName}/AzureDiskEncryptionForLinux'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Security'\\n    type: 'AzureDiskEncryptionForLinux'\\n    typeHandlerVersion: '1.1'\\n    autoUpgradeMinorVersion: true\\n    forceUpdateTag: forceUpdateTag\\n    settings: {\\n      EncryptionOperation: 'DisableEncryption'\\n      VolumeType: volumeType\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"volumeType\\\": {\\n      \\\"value\\\": \\\"Data\\\"\\n    },\\n    \\\"forceUpdateTag\\\": {\\n      \\\"value\\\": \\\"uniqueString(resourceGroup().id, deployment().name)\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the virtual machine.')\\nparam vmName string\\n\\n@description('Admin user name for the virtual machine.')\\nparam adminUsername string\\n\\n@description('Admin user password for virtual machine.')\\n@secure()\\nparam adminPassword string\\n\\n@description('Default lovation')\\nparam location string = resourceGroup().location\\n\\n@description('Size of VM')\\nparam vmSize string = 'Standard_D2_v3'\\n\\n@description('Name of VNET to which the VM NIC belongs to')\\nparam virtualNetworkName string\\n\\n@description('Name of Subnet to which the VM NIC belongs to')\\nparam subnetName string\\n\\n@description('Name of the KeyVault to place the volume encryption key')\\nparam keyVaultName string\\n\\n@description('Specifies whether Azure Virtual Machines are permitted to retrieve certificates stored as secrets from the key vault.')\\nparam enabledForDeployment bool = true\\n\\n@description('Specifies whether Azure Disk Encryption is permitted to retrieve secrets from the vault and unwrap keys.')\\nparam enabledForDiskEncryption bool = true\\n\\n@description('Specifies whether Azure Resource Manager is permitted to retrieve secrets from the key vault.')\\nparam enabledForTemplateDeployment bool = true\\n\\n@description('Specifies the permissions to keys in the vault. Valid values are: all, encrypt, decrypt, wrapKey, unwrapKey, sign, verify, get, list, create, update, import, delete, backup, restore, recover, and purge.')\\nparam keysPermissions array = [\\n  'list'\\n  'get'\\n  'decrypt'\\n  'encrypt'\\n  'unwrapkey'\\n  'wrapkey'\\n]\\n\\n@description('Specifies the permissions to secrets in the vault. Valid values are: all, get, list, set, delete, backup, restore, recover, and purge.')\\nparam secretsPermissions array = [\\n  'list'\\n  'get'\\n]\\n\\n@description('Specifies whether the key vault is a standard vault or a premium vault.')\\n@allowed([\\n  'Standard'\\n  'Premium'\\n])\\nparam skuName string = 'Standard'\\n\\nvar imagePublisher = 'MicrosoftWindowsServer'\\nvar imageOffer = 'WindowsServer'\\nvar osSku = '2012-R2-Datacenter'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar dnsNameForPublicIP = toLower(vmName)\\nvar publicIPAddressName = toLower('publicIP${vmName}')\\nvar publicIPAddressType = 'Dynamic'\\nvar nicName = toLower('nic${vmName}')\\nvar keyVaultURL = 'https://${keyVaultName}${environment().suffixes.keyvaultDns}'\\nvar encryptionOperation = 'EnableEncryption'\\nvar keyVaultResourceId = keyVault.id\\n\\nresource virtualNetwork 'Microsoft.Network/VirtualNetworks@2019-09-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        '10.0.0.0/16'\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: '10.0.0.0/24'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2020-11-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: publicIPAddressType\\n    dnsSettings: {\\n      domainNameLabel: dnsNameForPublicIP\\n    }\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2020-11-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetRef\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2019-07-01' = {\\n  name: vmName\\n  location: location\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: imagePublisher\\n        offer: imageOffer\\n        sku: osSku\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        createOption: 'FromImage'\\n      }\\n      dataDisks: [\\n        {\\n          diskSizeGB: 512\\n          lun: 1\\n          name: 'DataDisk-01'\\n          createOption: 'empty'\\n          caching: 'None'\\n        }\\n      ]\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource keyVault 'Microsoft.KeyVault/vaults@2019-09-01' = {\\n  name: keyVaultName\\n  location: location\\n  properties: {\\n    enabledForDeployment: enabledForDeployment\\n    enabledForDiskEncryption: enabledForDiskEncryption\\n    enabledForTemplateDeployment: enabledForTemplateDeployment\\n    tenantId: subscription().tenantId\\n    accessPolicies: [\\n      {\\n        objectId: reference(vm.id, '2019-07-01', 'full').identity.principalId\\n        tenantId: subscription().tenantId\\n        permissions: {\\n          keys: keysPermissions\\n          secrets: secretsPermissions\\n        }\\n      }\\n    ]\\n    sku: {\\n      name: skuName\\n      family: 'A'\\n    }\\n    networkAcls: {\\n      defaultAction: 'Allow'\\n      bypass: 'AzureServices'\\n    }\\n  }\\n}\\n\\nresource vmName_diskEncryption 'Microsoft.Compute/virtualMachines/extensions@2020-12-01' = {\\n  parent: vm\\n  name: 'diskEncryption'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Security'\\n    type: 'AzureDiskEncryption'\\n    typeHandlerVersion: '2.2'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      EncryptionOperation: encryptionOperation\\n      KeyVaultURL: keyVaultURL\\n      KeyVaultResourceId: keyVaultResourceId\\n      VolumeType: 'All'\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyVaultName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"enabledForDeployment\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"enabledForDiskEncryption\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"enabledForTemplateDeployment\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"keysPermissions\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"secretsPermissions\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"skuName\\\": {\\n      \\\"value\\\": \\\"Standard\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the virtual machine')\\nparam vmName string\\n\\n@description('Name of the KeyVault to place the volume encryption key')\\nparam keyVaultName string\\n\\n@description('Resource group of the KeyVault')\\nparam keyVaultResourceGroup string\\n\\n@description('URL of the KeyEncryptionKey used to encrypt the volume encryption key')\\nparam keyEncryptionKeyURL string = ''\\n\\n@description('Type of the volume OS or Data to perform encryption operation')\\nparam volumeType string = 'All'\\n\\n@description('Pass in an unique value like a GUID everytime the operation needs to be force run')\\nparam forceUpdateTag string = '1.0'\\n\\n@description('Should the OS partition be resized to occupy full OS VHD before splitting system volume')\\nparam resizeOSDisk bool = false\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nvar extensionName = 'AzureDiskEncryption'\\nvar extensionVersion = '2.2'\\nvar encryptionOperation = 'EnableEncryption'\\nvar keyEncryptionAlgorithm = 'RSA-OAEP'\\nvar keyVaultResourceID = resourceId(keyVaultResourceGroup, 'Microsoft.KeyVault/vaults/', keyVaultName)\\n\\nresource vmName_extension 'Microsoft.Compute/virtualMachines/extensions@2020-06-01' = {\\n  name: '${vmName}/${extensionName}'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.Security'\\n    type: extensionName\\n    typeHandlerVersion: extensionVersion\\n    autoUpgradeMinorVersion: true\\n    forceUpdateTag: forceUpdateTag\\n    settings: {\\n      EncryptionOperation: encryptionOperation\\n      KeyVaultURL: reference(keyVaultResourceID, '2019-09-01').vaultUri\\n      KeyVaultResourceId: keyVaultResourceID\\n      KeyEncryptionKeyURL: keyEncryptionKeyURL\\n      KekVaultResourceId: keyVaultResourceID\\n      KeyEncryptionAlgorithm: keyEncryptionAlgorithm\\n      VolumeType: volumeType\\n      ResizeOSDisk: resizeOSDisk\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyVaultName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyVaultResourceGroup\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyEncryptionKeyURL\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"volumeType\\\": {\\n      \\\"value\\\": \\\"All\\\"\\n    },\\n    \\\"forceUpdateTag\\\": {\\n      \\\"value\\\": \\\"1.0\\\"\\n    },\\n    \\\"resizeOSDisk\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location for the VMs, only certain regions support zones.')\\nparam location string = resourceGroup().location\\n\\n@description('Username for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Unique DNS Name for the Public IP for the frontend load balancer.')\\nparam dnsName string\\n\\n@description('Operation System for the Virtual Machine.')\\n@allowed([\\n  'Windows'\\n  'Ubuntu'\\n])\\nparam windowsOrUbuntu string = 'Ubuntu'\\n\\n@description('Number of VMs to provision')\\n@minValue(1)\\n@maxValue(10)\\nparam numberOfVms int = 3\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Size of the virtual machine')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('Security Type of the Virtual Machine.')\\n@allowed([\\n  'Standard'\\n  'TrustedLaunch'\\n])\\nparam securityType string = 'TrustedLaunch'\\n\\n@description('The Windows version for the VM. This will pick a fully patched image of this given Windows version.')\\n@allowed([\\n  '2022-datacenter-azure-edition'\\n  '2022-datacenter-azure-edition-core'\\n  '2022-datacenter-azure-edition-core-smalldisk'\\n  '2022-datacenter-azure-edition-smalldisk'\\n  '2022-datacenter-core-g2'\\n  '2022-datacenter-core-smalldisk-g2'\\n  '2022-datacenter-g2'\\n  '2022-datacenter-smalldisk-g2'\\n])\\nparam OSVersion string = '2022-datacenter-azure-edition'\\n\\nvar extensionName = 'GuestAttestation'\\nvar extensionPublisherLin = 'Microsoft.Azure.Security.LinuxAttestation'\\nvar extensionPublisherWin = 'Microsoft.Azure.Security.WindowsAttestation'\\nvar extensionVersion = '1.0'\\nvar maaTenantName = 'GuestAttestation'\\nvar securityProfileJson = {\\n  uefiSettings: {\\n    secureBootEnabled: true\\n    vTpmEnabled: true\\n  }\\n  securityType: securityType\\n}\\nvar storageAccountName = 'diags${uniqueString(resourceGroup().id)}'\\nvar nicName = 'myVMNic'\\nvar subnetName = 'Subnet-1'\\nvar publicIPAddressName = 'myPublicIP'\\nvar virtualNetworkName = 'MyVNET'\\nvar networkSecurityGroupName = 'allowRemoting'\\nvar lbName = 'multiVMLB'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets/', virtualNetworkName, subnetName)\\nvar frontEndIPConfigID = resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', lbName, 'loadBalancerFrontend')\\nvar inboundNatRuleName = 'remoting'\\nvar windowsImage = {\\n  publisher: 'MicrosoftWindowsServer'\\n  offer: 'WindowsServer'\\n  sku: OSVersion\\n  version: 'latest'\\n}\\nvar linuxImage = {\\n  publisher: 'Canonical'\\n  offer: '0001-com-ubuntu-server-lunar-daily'\\n  sku: '23_04-daily-gen2'\\n  version: 'latest'\\n}\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: 'Standard_LRS'\\n  }\\n  kind: 'StorageV2'\\n  properties: {}\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n    dnsSettings: {\\n      domainNameLabel: dnsName\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'RemoteConnection'\\n        properties: {\\n          description: 'Allow RDP/SSH'\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          destinationPortRange: ((windowsOrUbuntu == 'Windows') ? '3389' : '22')\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2023-09-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        '10.0.0.0/16'\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: '10.0.0.0/24'\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2023-09-01' = [for i in range(0, numberOfVms): {\\n  name: '${nicName}${i}'\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: subnetRef\\n          }\\n          loadBalancerBackendAddressPools: [\\n            {\\n              id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbName, 'LoadBalancerBackend')\\n            }\\n          ]\\n          loadBalancerInboundNatRules: [\\n            {\\n              id: resourceId('Microsoft.Network/loadBalancers/inboundNatRules', lbName, '${inboundNatRuleName}${i}')\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n    lb\\n    inboundNatRule\\n  ]\\n}]\\n\\nresource lb 'Microsoft.Network/loadBalancers@2023-09-01' = {\\n  name: lbName\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: 'LoadBalancerFrontend'\\n        properties: {\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: 'LoadBalancerBackend'\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        name: 'port80'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: frontEndIPConfigID\\n          }\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbName, 'LoadBalancerBackend')\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 80\\n          backendPort: 80\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', lbName, 'tcpProbe')\\n          }\\n        }\\n      }\\n    ]\\n    probes: [\\n      {\\n        name: 'tcpProbe'\\n        properties: {\\n          protocol: 'Tcp'\\n          port: 80\\n          intervalInSeconds: 5\\n          numberOfProbes: 2\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource inboundNatRule 'Microsoft.Network/loadBalancers/inboundNatRules@2023-09-01' = [for i in range(0, numberOfVms): {\\n  parent: lb\\n  name: '${inboundNatRuleName}${i}'\\n  properties: {\\n    frontendIPConfiguration: {\\n      id: frontEndIPConfigID\\n    }\\n    protocol: 'Tcp'\\n    frontendPort: (i + 50000)\\n    backendPort: ((windowsOrUbuntu == 'Windows') ? 3389 : 22)\\n    enableFloatingIP: false\\n  }\\n\\n}]\\n\\nresource dns 'Microsoft.Compute/virtualMachines@2023-09-01' = [for i in range(0, numberOfVms): {\\n  name: '${dnsName}${i}'\\n  zones: split(string(((i % 3) + 1)), ',')\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: '${dnsName}${i}'\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: ((windowsOrUbuntu == 'Windows') ? windowsImage : linuxImage)\\n      osDisk: {\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: resourceId('Microsoft.Network/networkInterfaces', '${nicName}${i}')\\n        }\\n      ]\\n    }\\n    securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: storageAccount.properties.primaryEndpoints.blob\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    nic\\n  ]\\n}]\\n\\nresource guestAttestation 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = [for i in range(0, numberOfVms): if ((securityType == 'TrustedLaunch') && ((securityProfileJson.uefiSettings.secureBootEnabled == true) && (securityProfileJson.uefiSettings.vTpmEnabled == true))) {\\n  parent: dns[i]\\n  name: 'guestAttestation'\\n  location: location\\n  properties: {\\n    publisher: ((windowsOrUbuntu == 'Windows') ? extensionPublisherWin : extensionPublisherLin)\\n    type: extensionName\\n    typeHandlerVersion: extensionVersion\\n    autoUpgradeMinorVersion: true\\n    enableAutomaticUpgrade: true\\n    settings: {\\n      AttestationConfig: {\\n        MaaSettings: {\\n          maaEndpoint: ''\\n          maaTenantName: maaTenantName\\n        }\\n        AscSettings: {\\n          ascReportingEndpoint: ''\\n          ascReportingFrequency: ''\\n        }\\n        useCustomToken: 'false'\\n        disableAlerts: 'false'\\n      }\\n    }\\n  }\\n}]\\n\\noutput hostname string = publicIPAddress.properties.dnsSettings.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"windowsOrUbuntu\\\": {\\n      \\\"value\\\": \\\"Ubuntu\\\"\\n    },\\n    \\\"numberOfVms\\\": {\\n      \\\"value\\\": 3\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"securityType\\\": {\\n      \\\"value\\\": \\\"TrustedLaunch\\\"\\n    },\\n    \\\"OSVersion\\\": {\\n      \\\"value\\\": \\\"2022-datacenter-azure-edition\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the Azure Compute Gallery.')\\nparam galleryName string\\n\\n@description('Name of the Image Definition.')\\nparam galleryImageDefinitionName string\\n\\n@description('Location of the Azure Compute Gallery.')\\nparam location string = resourceGroup().location\\n\\nresource galleryName_galleryImageDefinition 'Microsoft.Compute/galleries/images@2019-12-01' = {\\n  name: '${galleryName}/${galleryImageDefinitionName}'\\n  location: location\\n  properties: {\\n    description: 'Sample Gallery Image Description'\\n    osType: 'Linux'\\n    osState: 'Generalized'\\n    endOfLifeDate: '2030-01-01'\\n    identifier: {\\n      publisher: 'myPublisher'\\n      offer: 'myOffer'\\n      sku: 'mySku'\\n    }\\n    recommended: {\\n      vCPUs: {\\n        min: '1'\\n        max: '64'\\n      }\\n      memory: {\\n        min: '2048'\\n        max: '307720'\\n      }\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"galleryName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"galleryImageDefinitionName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Username for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Authentication type')\\n@allowed([\\n  'password'\\n  'sshPublicKey'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('OS Admin password or SSH Key depending on value of authentication type')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('The Location For the resources')\\nparam location string = resourceGroup().location\\n\\n@description('The size of the VM to create')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Operating system to use for the virtual machine.')\\n@allowed([\\n  'UbuntuServer_18.04-LTS'\\n  'UbuntuServer_16.04-LTS'\\n  'WindowsServer_2016-DataCenter'\\n])\\nparam operatingSystem string = 'UbuntuServer_18.04-LTS'\\n\\nvar isWindowsOs = contains(toLower(operatingSystem), 'windows')\\nvar script1Command = (isWindowsOs\\n  ? 'powershell -ExecutionPolicy Unrestricted -File  .\\\\\\\\script-1.ps1 '\\n  : './script-1.sh ')\\nvar script2Command = (isWindowsOs\\n  ? 'powershell -ExecutionPolicy Unrestricted -File  .\\\\\\\\script-2.ps1 '\\n  : './script-2.sh ')\\nvar script1File = (isWindowsOs ? 'script-1.ps1' : 'script-1.sh')\\nvar script2File = (isWindowsOs ? 'script-2.ps1' : 'script-2.sh')\\nvar vmName = 'vm'\\nvar storageAccountName = concat(vmName, uniqueString(resourceGroup().id))\\nvar networkSecurityGroupName = 'nsg'\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetName = 'Subnet'\\nvar subnetPrefix = '10.0.0.0/24'\\nvar virtualNetworkName = 'vnet'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar createVMUrl = uri(_artifactsLocation, 'nestedtemplates/vm.json${_artifactsLocationSasToken}')\\nvar extensionUrl = uri(_artifactsLocation, 'nestedtemplates/customScriptExtension.json${_artifactsLocationSasToken}')\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-01-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: 'Standard_LRS'\\n  }\\n  kind: 'Storage'\\n  properties: {}\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2018-07-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2018-07-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'allow-remote-access'\\n        properties: {\\n          priority: 1000\\n          sourceAddressPrefix: '*'\\n          protocol: 'Tcp'\\n          destinationPortRange: (contains(toLower(operatingSystem), 'windows') ? 3389 : 22)\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nmodule creatingVM '?' /*TODO: replace with correct path to [variables('createVMUrl')]*/ = {\\n  name: 'creatingVM'\\n  params: {\\n    adminPasswordOrKey: adminPasswordOrKey\\n    adminUsername: adminUsername\\n    authenticationType: authenticationType\\n    operatingSystem: operatingSystem\\n    location: location\\n    nsgId: networkSecurityGroup.id\\n    storageAccountId: storageAccount.id\\n    subnetRef: subnetRef\\n    vmSize: vmSize\\n    vmName: vmName\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nmodule firstExtensionRun '?' /*TODO: replace with correct path to [variables('extensionUrl')]*/ = {\\n  name: 'firstExtensionRun'\\n  params: {\\n    location: location\\n    extensionName: 'cse'\\n    vmName: vmName\\n    fileUris: [\\n      uri(_artifactsLocation, concat(script1File, _artifactsLocationSasToken))\\n    ]\\n    commandToExecute: script1Command\\n    isWindowsOS: isWindowsOs\\n  }\\n  dependsOn: [\\n    creatingVM\\n  ]\\n}\\n\\nmodule secondExtensionRun '?' /*TODO: replace with correct path to [variables('extensionUrl')]*/ = {\\n  name: 'secondExtensionRun'\\n  params: {\\n    location: location\\n    extensionName: 'cse'\\n    vmName: vmName\\n    fileUris: [\\n      uri(_artifactsLocation, concat(script2File, _artifactsLocationSasToken))\\n    ]\\n    commandToExecute: '${script2Command}\\\"${split(string((isWindowsOs?firstExtensionRun.properties.outputs.instanceView.value.substatuses[0].message:firstExtensionRun.properties.outputs.instanceView.value.statuses[0].message)),'#DATA#')[1]}\\\"'\\n    isWindowsOS: isWindowsOs\\n  }\\n}\\n\\noutput sample object = firstExtensionRun.properties.outputs.instanceView.value\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"operatingSystem\\\": {\\n      \\\"value\\\": \\\"UbuntuServer_18.04-LTS\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Principal ID to set the access for')\\nparam principalId string\\n\\n@description('The storage account to set access for')\\nparam storageAccountName string\\n\\nvar scope = resourceId('Microsoft.Storage/storageAccounts', storageAccountName)\\nvar RBACResourceName = guid(scope, contributorRoleDefinition.id, principalId)\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' existing = {\\n  name: storageAccountName\\n}\\nresource storageAccountName_Microsoft_Authorization_RBACResource 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  scope: storageAccount\\n  name: RBACResourceName\\n  properties: {\\n    roleDefinitionId: contributorRoleDefinition.id\\n    principalId: principalId\\n    principalType: 'ServicePrincipal'\\n  }\\n}\\n\\nresource contributorRoleDefinition 'Microsoft.Authorization/roleDefinitions@2022-05-01-preview' existing = {\\n  scope: subscription()\\n  name: 'b24988ac-6180-42a0-ab88-20f7382dd24c' //Azure contributor role\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"principalId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location to for the resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Name for the Virtual Machine.')\\nparam vmName string = 'linux-vm'\\n\\n@description('User name for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Type of authentication to use on the Virtual Machine.')\\n@allowed([\\n  'password'\\n  'sshPublicKey'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('Password or ssh key for the Virtual Machine.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Size for the Virtual Machine.')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('Determines whether or not a new storage account should be provisioned.')\\nparam storageNewOrExisting string = 'new'\\n\\n@description('Name of the storage account')\\nparam storageAccountName string = 'storage${uniqueString(resourceGroup().id)}'\\n\\n@description('Storage account type')\\nparam storageAccountType string = 'Standard_LRS'\\n\\n@description('Name of the resource group for the existing storage account')\\nparam storageAccountResourceGroupName string = resourceGroup().name\\n\\n@description('Determines whether or not a new virtual network should be provisioned.')\\nparam virtualNetworkNewOrExisting string = 'new'\\n\\n@description('Name of the virtual network')\\nparam virtualNetworkName string = 'VirtualNetwork'\\n\\n@description('Address prefix of the virtual network')\\nparam addressPrefixes array = [\\n  '10.0.0.0/16'\\n]\\n\\n@description('Name of the subnet')\\nparam subnetName string = 'default'\\n\\n@description('Subnet prefix of the virtual network')\\nparam subnetPrefix string = '10.0.0.0/24'\\n\\n@description('Name of the resource group for the existing virtual network')\\nparam virtualNetworkResourceGroupName string = resourceGroup().name\\n\\n@description('Determines whether or not a new public ip should be provisioned.')\\n@allowed([\\n  'new'\\n  'existing'\\n  'none'\\n])\\nparam publicIpNewOrExisting string = 'new'\\n\\n@description('Name of the public ip address')\\nparam publicIpName string = 'PublicIp'\\n\\n@description('DNS of the public ip address for the VM')\\nparam publicIpDns string = 'linux-vm-${uniqueString(resourceGroup().id)}'\\n\\n@description('Name of the resource group for the public ip address')\\nparam publicIpResourceGroupName string = resourceGroup().name\\n\\n@description('Security Type of the Virtual Machine.')\\n@allowed([\\n  'Standard'\\n  'TrustedLaunch'\\n])\\nparam securityType string = 'TrustedLaunch'\\n\\n@description('The offer of the Ubuntu image from which to launch the Virtual Machine.')\\nparam imageOffer string = '0001-com-ubuntu-server-jammy'\\n\\n@description('The SKU of the Ubuntu image from which to launch the Virtual Machine.')\\nparam imageSku string = '22_04-lts-gen2'\\n\\nvar securityProfileJson = {\\n  uefiSettings: {\\n    secureBootEnabled: true\\n    vTpmEnabled: true\\n  }\\n  securityType: securityType\\n}\\nvar extensionName = 'GuestAttestation'\\nvar extensionPublisher = 'Microsoft.Azure.Security.LinuxAttestation'\\nvar extensionVersion = '1.0'\\nvar maaTenantName = 'GuestAttestation'\\nvar nicName = '${vmName}-nic'\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar publicIpAddressId = {\\n  id: resourceId(publicIpResourceGroupName, 'Microsoft.Network/publicIPAddresses', publicIpName)\\n}\\nvar networkSecurityGroupName = 'default-NSG'\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = if (storageNewOrExisting == 'new') {\\n  name: storageAccountName\\n  location: location\\n  kind: 'Storage'\\n  sku: {\\n    name: storageAccountType\\n  }\\n}\\n\\nresource publicIp 'Microsoft.Network/publicIPAddresses@2023-05-01' = if (publicIpNewOrExisting == 'new') {\\n  name: publicIpName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n    dnsSettings: {\\n      domainNameLabel: publicIpDns\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2023-05-01' = if (virtualNetworkNewOrExisting == 'new') {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'default-allow-22'\\n        properties: {\\n          priority: 1000\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '22'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2023-05-01' = if (virtualNetworkNewOrExisting == 'new') {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: addressPrefixes\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2023-05-01' = {\\n  name: nicName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: resourceId(\\n              virtualNetworkResourceGroupName,\\n              'Microsoft.Network/virtualNetworks/subnets/',\\n              virtualNetworkName,\\n              subnetName\\n            )\\n          }\\n          publicIPAddress: ((publicIpNewOrExisting != 'none') ? publicIpAddressId : null)\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    publicIp\\n    virtualNetwork\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2023-07-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: 'Canonical'\\n        offer: imageOffer\\n        sku: imageSku\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n        storageUri: reference(\\n          resourceId(storageAccountResourceGroupName, 'Microsoft.Storage/storageAccounts/', storageAccountName),\\n          '2020-08-01-preview'\\n        ).primaryEndpoints.blob\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    storageAccount\\n  ]\\n}\\n\\nresource vmName_GuestAttestation 'Microsoft.Compute/virtualMachines/extensions@2023-07-01' = if ((securityType == 'TrustedLaunch') && ((securityProfileJson.uefiSettings.secureBootEnabled == true) && (securityProfileJson.uefiSettings.vTpmEnabled == true))) {\\n  parent: vm\\n  name: 'GuestAttestation'\\n  location: location\\n  properties: {\\n    publisher: extensionPublisher\\n    type: extensionName\\n    typeHandlerVersion: extensionVersion\\n    autoUpgradeMinorVersion: true\\n    enableAutomaticUpgrade: true\\n    settings: {\\n      AttestationConfig: {\\n        MaaSettings: {\\n          maaEndpoint: ''\\n          maaTenantName: maaTenantName\\n        }\\n        AscSettings: {\\n          ascReportingEndpoint: ''\\n          ascReportingFrequency: ''\\n        }\\n        useCustomToken: 'false'\\n        disableAlerts: 'false'\\n      }\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"linux-vm\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"storageNewOrExisting\\\": {\\n      \\\"value\\\": \\\"new\\\"\\n    },\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"storage${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"storageAccountType\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"storageAccountResourceGroupName\\\": {\\n      \\\"value\\\": \\\"resourceGroup().name\\\"\\n    },\\n    \\\"virtualNetworkNewOrExisting\\\": {\\n      \\\"value\\\": \\\"new\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"VirtualNetwork\\\"\\n    },\\n    \\\"addressPrefixes\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"default\\\"\\n    },\\n    \\\"subnetPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/24\\\"\\n    },\\n    \\\"virtualNetworkResourceGroupName\\\": {\\n      \\\"value\\\": \\\"resourceGroup().name\\\"\\n    },\\n    \\\"publicIpNewOrExisting\\\": {\\n      \\\"value\\\": \\\"new\\\"\\n    },\\n    \\\"publicIpName\\\": {\\n      \\\"value\\\": \\\"PublicIp\\\"\\n    },\\n    \\\"publicIpDns\\\": {\\n      \\\"value\\\": \\\"linux-vm-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"publicIpResourceGroupName\\\": {\\n      \\\"value\\\": \\\"resourceGroup().name\\\"\\n    },\\n    \\\"securityType\\\": {\\n      \\\"value\\\": \\\"TrustedLaunch\\\"\\n    },\\n    \\\"imageOffer\\\": {\\n      \\\"value\\\": \\\"0001-com-ubuntu-server-jammy\\\"\\n    },\\n    \\\"imageSku\\\": {\\n      \\\"value\\\": \\\"22_04-lts-gen2\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of your Virtual Machine.')\\nparam vmName string = 'simpleLinuxVM'\\n\\n@description('Username for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'password'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Unique DNS Name for the Public IP used to access the Virtual Machine.')\\nparam dnsLabelPrefix string = toLower('${vmName}-${uniqueString(resourceGroup().id)}')\\n\\n@description('The Ubuntu version for the VM. This will pick a fully patched image of this given Ubuntu version.')\\n@allowed([\\n  'Ubuntu-2004'\\n  'Ubuntu-2204'\\n])\\nparam ubuntuOSVersion string = 'Ubuntu-2004'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The size of the VM')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('Name of the VNET')\\nparam virtualNetworkName string = 'vNet'\\n\\n@description('Name of the subnet in the virtual network')\\nparam subnetName string = 'Subnet'\\n\\n@description('Name of the Network Security Group')\\nparam networkSecurityGroupName string = 'SecGroupNet'\\n\\n@description('Security Type of the Virtual Machine.')\\n@allowed([\\n  'Standard'\\n  'TrustedLaunch'\\n])\\nparam securityType string = 'TrustedLaunch'\\n\\nvar imageReference = {\\n  'Ubuntu-2004': {\\n    publisher: 'Canonical'\\n    offer: '0001-com-ubuntu-server-focal'\\n    sku: '20_04-lts-gen2'\\n    version: 'latest'\\n  }\\n  'Ubuntu-2204': {\\n    publisher: 'Canonical'\\n    offer: '0001-com-ubuntu-server-jammy'\\n    sku: '22_04-lts-gen2'\\n    version: 'latest'\\n  }\\n}\\nvar publicIPAddressName = '${vmName}PublicIP'\\nvar networkInterfaceName = '${vmName}NetInt'\\nvar osDiskType = 'Standard_LRS'\\nvar subnetAddressPrefix = '10.1.0.0/24'\\nvar addressPrefix = '10.1.0.0/16'\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\nvar securityProfileJson = {\\n  uefiSettings: {\\n    secureBootEnabled: true\\n    vTpmEnabled: true\\n  }\\n  securityType: securityType\\n}\\nvar extensionName = 'GuestAttestation'\\nvar extensionPublisher = 'Microsoft.Azure.Security.LinuxAttestation'\\nvar extensionVersion = '1.0'\\nvar maaTenantName = 'GuestAttestation'\\nvar maaEndpoint = substring('emptystring', 0, 0)\\n\\nresource networkInterface 'Microsoft.Network/networkInterfaces@2023-09-01' = {\\n  name: networkInterfaceName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          subnet: {\\n            id: virtualNetwork.properties.subnets[0].id\\n          }\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n        }\\n      }\\n    ]\\n    networkSecurityGroup: {\\n      id: networkSecurityGroup.id\\n    }\\n  }\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'SSH'\\n        properties: {\\n          priority: 1000\\n          protocol: 'Tcp'\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n          destinationPortRange: '22'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2023-09-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          networkSecurityGroup: {\\n            id: networkSecurityGroup.id\\n          }\\n          addressPrefix: subnetAddressPrefix\\n          privateEndpointNetworkPolicies: 'Enabled'\\n          privateLinkServiceNetworkPolicies: 'Enabled'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\\n  name: publicIPAddressName\\n  location: location\\n  sku: {\\n    name: 'Basic'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n    publicIPAddressVersion: 'IPv4'\\n    dnsSettings: {\\n      domainNameLabel: dnsLabelPrefix\\n    }\\n    idleTimeoutInMinutes: 4\\n  }\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2023-09-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    storageProfile: {\\n      osDisk: {\\n        createOption: 'FromImage'\\n        managedDisk: {\\n          storageAccountType: osDiskType\\n        }\\n      }\\n      imageReference: imageReference[ubuntuOSVersion]\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: networkInterface.id\\n        }\\n      ]\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\\n    }\\n    securityProfile: (securityType == 'TrustedLaunch') ? securityProfileJson : null\\n  }\\n}\\n\\nresource vmExtension 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = if (securityType == 'TrustedLaunch' && securityProfileJson.uefiSettings.secureBootEnabled && securityProfileJson.uefiSettings.vTpmEnabled) {\\n  parent: vm\\n  name: extensionName\\n  location: location\\n  properties: {\\n    publisher: extensionPublisher\\n    type: extensionName\\n    typeHandlerVersion: extensionVersion\\n    autoUpgradeMinorVersion: true\\n    enableAutomaticUpgrade: true\\n    settings: {\\n      AttestationConfig: {\\n        MaaSettings: {\\n          maaEndpoint: maaEndpoint\\n          maaTenantName: maaTenantName\\n        }\\n      }\\n    }\\n  }\\n}\\n\\noutput adminUsername string = adminUsername\\noutput hostname string = publicIPAddress.properties.dnsSettings.fqdn\\noutput sshCommand string = 'ssh ${adminUsername}@${publicIPAddress.properties.dnsSettings.fqdn}'\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"simpleLinuxVM\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"password\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dnsLabelPrefix\\\": {\\n      \\\"value\\\": \\\"toLower('${vmName}-${uniqueString(resourceGroup().id)}')\\\"\\n    },\\n    \\\"ubuntuOSVersion\\\": {\\n      \\\"value\\\": \\\"Ubuntu-2004\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"vNet\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"Subnet\\\"\\n    },\\n    \\\"networkSecurityGroupName\\\": {\\n      \\\"value\\\": \\\"SecGroupNet\\\"\\n    },\\n    \\\"securityType\\\": {\\n      \\\"value\\\": \\\"TrustedLaunch\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of you Virtual Machine.')\\nparam vmName string = 'simpleWinVS'\\n\\n@description('The size of the VM')\\nparam VmSize string = 'Standard_D2_v3'\\n\\n@description('Username for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Password for the Virtual Machine. The password must be at least 12 characters long and have lower case, upper characters, digit and a special character (Regex match)')\\n@secure()\\nparam adminPassword string\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Unique DNS Name for the Public IP used to access the Virtual Machine.')\\nparam dnsLabelPrefix string = toLower('simplewinvs-${uniqueString(resourceGroup().id)}')\\n\\n@description('Specify whether to create a new or existing NSG and vNet.')\\n@allowed([\\n  'new'\\n  'existing'\\n])\\nparam sharedResources string = 'new'\\n\\n@description('Name of the VNET')\\nparam virtualNetworkName string = 'vNet'\\n\\n@description('Name of the subnet in the virtual network')\\nparam subnetName string = 'Subnet'\\n\\n@description('Name of the Network Security Group')\\nparam networkSecurityGroupName string = 'SecGroupNet'\\n\\nvar publicIpAddressName = '${vmName}PublicIP'\\nvar networkInterfaceName = '${vmName}NetInt'\\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar osDiskType = 'StandardSSD_LRS'\\nvar subnetAddressPrefix = '10.1.0.0/24'\\nvar addressPrefix = '10.1.0.0/16'\\n\\nresource networkInterface 'Microsoft.Network/networkInterfaces@2020-05-01' = {\\n  name: networkInterfaceName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          subnet: {\\n            id: subnetRef\\n          }\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIpAddress.id\\n          }\\n        }\\n      }\\n    ]\\n    networkSecurityGroup: {\\n      id: networkSecurityGroup.id\\n    }\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2020-05-01' = if (sharedResources == 'new') {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'RDP'\\n        properties: {\\n          protocol: 'TCP'\\n          sourcePortRange: '*'\\n          destinationPortRange: '3389'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 300\\n          direction: 'Inbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-05-01' = if (sharedResources == 'new') {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetAddressPrefix\\n          privateEndpointNetworkPolicies: 'Enabled'\\n          privateLinkServiceNetworkPolicies: 'Enabled'\\n        }\\n      }\\n    ]\\n    enableDdosProtection: false\\n    enableVmProtection: false\\n  }\\n}\\n\\nresource publicIpAddress 'Microsoft.Network/publicIpAddresses@2020-05-01' = {\\n  name: publicIpAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n    dnsSettings: {\\n      domainNameLabel: dnsLabelPrefix\\n    }\\n    publicIPAddressVersion: 'IPv4'\\n    idleTimeoutInMinutes: 4\\n  }\\n  sku: {\\n    name: 'Basic'\\n    tier: 'Regional'\\n  }\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2019-12-01' = {\\n  name: vmName\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: VmSize\\n    }\\n    storageProfile: {\\n      osDisk: {\\n        createOption: 'fromImage'\\n        managedDisk: {\\n          storageAccountType: osDiskType\\n        }\\n      }\\n      imageReference: {\\n        publisher: 'MicrosoftVisualStudio'\\n        offer: 'visualstudio2019latest'\\n        sku: 'vs-2019-comm-latest-ws2019'\\n        version: 'latest'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: networkInterface.id\\n        }\\n      ]\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n      windowsConfiguration: {\\n        enableAutomaticUpdates: true\\n        provisionVMAgent: true\\n      }\\n    }\\n  }\\n}\\n\\noutput adminUsername string = adminUsername\\noutput virtualNetworkName string = virtualNetworkName\\noutput networkSecurityGroupName string = networkSecurityGroupName\\noutput hostname string = publicIpAddress.properties.dnsSettings.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"simpleWinVS\\\"\\n    },\\n    \\\"VmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"dnsLabelPrefix\\\": {\\n      \\\"value\\\": \\\"toLower('simplewinvs-${uniqueString(resourceGroup().id)}')\\\"\\n    },\\n    \\\"sharedResources\\\": {\\n      \\\"value\\\": \\\"new\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"vNet\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"Subnet\\\"\\n    },\\n    \\\"networkSecurityGroupName\\\": {\\n      \\\"value\\\": \\\"SecGroupNet\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The Azure region where resources in the template should be deployed.')\\nparam location string\\n\\n@description('Name for the subnet in the virtual network where the network interface is connected.')\\nparam subnetName string = 'subnet'\\n\\n@description('Name of the network security group that sets rules for the network environment.')\\nparam networkSecurityGroupName string = 'nsg'\\n\\n@description('Name of the virtual network.')\\nparam virtualNetworkName string = 'network'\\n\\n@description('Network subnet and prefix.')\\nparam addressPrefix string = '10.2.0.0/16'\\n\\n@description('Name for the Public IP used to access the Virtual Machine.')\\nparam publicIpName string = 'myPublicIP'\\n\\n@description('Allocation method for the Public IP used to access the Virtual Machine.')\\n@allowed([\\n  'Dynamic'\\n  'Static'\\n])\\nparam publicIPAllocationMethod string = 'Static'\\n\\n@description('Name of the virtual machine.')\\nparam vmName string\\n\\n@description('The Windows version for the VM. This will pick a fully patched image of this given Windows version.')\\n@allowed([\\n  '2012-R2-Datacenter'\\n  '2016-Datacenter'\\n  '2019-Datacenter'\\n  '2019-Datacenter-Core'\\n  '2019-Datacenter-Core-smalldisk'\\n  '2019-Datacenter-smalldisk'\\n  '2022-datacenter'\\n  '2022-datacenter-azure-edition-smalldisk'\\n  '2022-datacenter-core'\\n  '2022-datacenter-core-g2'\\n  '2022-datacenter-core-smalldisk'\\n  '2022-datacenter-core-smalldisk-g2'\\n  '2022-datacenter-g2'\\n  '2022-datacenter-smalldisk'\\n  '2022-datacenter-smalldisk-g2'\\n])\\nparam OSVersion string = '2022-datacenter-azure-edition-smalldisk'\\n\\n@description('Specifies the storage account type for OS and data disk.')\\n@allowed([\\n  'Premium_LRS'\\n  'StandardSSD_LRS'\\n  'Standard_LRS'\\n  'UltraSSD_LRS'\\n])\\nparam osDiskStorageAccountType string = 'Standard_LRS'\\n\\n@description('Size of the virtual machine.')\\nparam vmSize string = 'Standard_D2s_v3'\\n\\n@description('Availability zone number.')\\n@allowed([\\n  '1'\\n  '2'\\n  '3'\\n])\\nparam zone string = '1'\\n\\n@description('Username for the Virtual Machine.')\\nparam adminUsername string\\n\\n@description('Password for the Virtual Machine.')\\n@minLength(12)\\n@secure()\\nparam adminPassword string\\n\\n@description('Enable accelerated networking.')\\nparam enableAcceleratedNetworking bool = true\\n\\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2021-05-01' = {\\n  name: networkSecurityGroupName\\n  location: location\\n}\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2021-05-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: addressPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIpAddress 'Microsoft.Network/publicIpAddresses@2021-05-01' = {\\n  name: publicIpName\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  zones: [\\n    zone\\n  ]\\n  properties: {\\n    publicIPAllocationMethod: publicIPAllocationMethod\\n  }\\n}\\n\\nresource networkInterface 'Microsoft.Network/networkInterfaces@2021-05-01' = {\\n  name: '${vmName}-nic'\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          subnet: {\\n            id: virtualNetwork.properties.subnets[0].id\\n          }\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIpAddress.id\\n          }\\n        }\\n      }\\n    ]\\n    enableAcceleratedNetworking: enableAcceleratedNetworking\\n    networkSecurityGroup: {\\n      id: networkSecurityGroup.id\\n    }\\n  }\\n}\\n\\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2021-07-01' = {\\n  name: vmName\\n  location: location\\n  zones: [\\n    zone\\n  ]\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: 'MicrosoftWindowsServer'\\n        offer: 'WindowsServer'\\n        sku: OSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        createOption: 'FromImage'\\n        managedDisk: {\\n          storageAccountType: osDiskStorageAccountType\\n        }\\n      }\\n      dataDisks: [\\n        {\\n          diskSizeGB: 1023\\n          lun: 0\\n          createOption: 'Empty'\\n        }\\n      ]\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: networkInterface.id\\n        }\\n      ]\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n      windowsConfiguration: {\\n        enableAutomaticUpdates: true\\n    }\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n      }\\n    }\\n  }\\n}\\n\\nresource guestConfigExtension 'Microsoft.Compute/virtualMachines/extensions@2021-07-01' = {\\n  parent: virtualMachine\\n  name: 'AzurePolicyforWindows'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.GuestConfiguration'\\n    type: 'ConfigurationforWindows'\\n    typeHandlerVersion: '1.0'\\n    autoUpgradeMinorVersion: true\\n    enableAutomaticUpgrade: true\\n  }\\n}\\n\\nresource configuration 'Microsoft.GuestConfiguration/guestConfigurationAssignments@2020-06-25' = {\\n  name: 'AzureWindowsBaseline'\\n  scope: virtualMachine\\n  location: location\\n  properties: {\\n    guestConfiguration: {\\n      assignmentType: 'ApplyAndMonitor'\\n      name: 'AzureWindowsBaseline'\\n      version: '1.*'\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"subnet\\\"\\n    },\\n    \\\"networkSecurityGroupName\\\": {\\n      \\\"value\\\": \\\"nsg\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"network\\\"\\n    },\\n    \\\"addressPrefix\\\": {\\n      \\\"value\\\": \\\"10.2.0.0/16\\\"\\n    },\\n    \\\"publicIpName\\\": {\\n      \\\"value\\\": \\\"myPublicIP\\\"\\n    },\\n    \\\"publicIPAllocationMethod\\\": {\\n      \\\"value\\\": \\\"Static\\\"\\n    },\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"OSVersion\\\": {\\n      \\\"value\\\": \\\"2022-datacenter-azure-edition-smalldisk\\\"\\n    },\\n    \\\"osDiskStorageAccountType\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"zone\\\": {\\n      \\\"value\\\": \\\"1\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"enableAcceleratedNetworking\\\": {\\n      \\\"value\\\": true\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param virtualMachineName string\\nparam vmSize string\\nparam adminUserName string\\n\\n@secure()\\nparam adminPassword string\\nparam existingVnetLocation string\\nparam subnetId string\\nparam nsgId string\\n\\nvar nicName = '${virtualMachineName}Nic'\\nvar publicIPAddressName = '${virtualMachineName}-ip'\\n\\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2022-05-01' = {\\n  name: publicIPAddressName\\n  location: existingVnetLocation\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n  }\\n}\\n\\nresource nic 'Microsoft.Network/networkInterfaces@2022-05-01' = {\\n  name: nicName\\n  location: existingVnetLocation\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIPAddress.id\\n          }\\n          subnet: {\\n            id: subnetId\\n          }\\n        }\\n      }\\n    ]\\n    networkSecurityGroup: {\\n      id: nsgId\\n    }\\n  }\\n}\\n\\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2022-08-01' = {\\n  name: virtualMachineName\\n  location: existingVnetLocation\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: virtualMachineName\\n      adminUsername: adminUserName\\n      adminPassword: adminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: 'MicrosoftWindowsServer'\\n        offer: 'WindowsServer'\\n        sku: '2022-Datacenter'\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${virtualMachineName}_OSDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: nic.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"virtualMachineName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUserName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingVnetLocation\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"nsgId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Size of VMs in the VM Scale Set.')\\nparam vmSku string = 'Standard_D2s_v3'\\n\\n@description('The Windows version for the VM. This will pick a fully patched image of this given Windows version.')\\n@allowed([\\n  '2016-datacenter-gensecond'\\n  '2016-datacenter-server-core-g2'\\n  '2016-datacenter-server-core-smalldisk-g2'\\n  '2016-datacenter-smalldisk-g2'\\n  '2016-datacenter-with-containers-g2'\\n  '2016-datacenter-zhcn-g2'\\n  '2019-datacenter-core-g2'\\n  '2019-datacenter-core-smalldisk-g2'\\n  '2019-datacenter-core-with-containers-g2'\\n  '2019-datacenter-core-with-containers-smalldisk-g2'\\n  '2019-datacenter-gensecond'\\n  '2019-datacenter-smalldisk-g2'\\n  '2019-datacenter-with-containers-g2'\\n  '2019-datacenter-with-containers-smalldisk-g2'\\n  '2019-datacenter-zhcn-g2'\\n  '2022-datacenter-azure-edition'\\n  '2022-datacenter-azure-edition-core'\\n  '2022-datacenter-azure-edition-core-smalldisk'\\n  '2022-datacenter-azure-edition-smalldisk'\\n  '2022-datacenter-core-g2'\\n  '2022-datacenter-core-smalldisk-g2'\\n  '2022-datacenter-g2'\\n  '2022-datacenter-smalldisk-g2'\\n])\\nparam windowsOSVersion string = '2022-datacenter-azure-edition'\\n\\n@description('Security Type of the Virtual Machine.')\\n@allowed([\\n  'Standard'\\n  'TrustedLaunch'\\n])\\nparam securityType string = 'TrustedLaunch'\\n\\n@description('String used as a base for naming resources. Must be 3-57 characters in length and globally unique across Azure. A hash is prepended to this string for some resources, and resource-specific information is appended.')\\n@maxLength(57)\\nparam vmssName string\\n\\n@description('Number of VM instances (1000 or less).')\\n@minValue(3)\\n@maxValue(1000)\\nparam instanceCount int\\n\\n@description('Admin username on all VMs.')\\nparam adminUsername string\\n\\n@description('Default location')\\nparam location string = resourceGroup().location\\n\\n@description('Admin password on all VMs.')\\n@secure()\\nparam adminPassword string\\n\\nvar securityProfileJson = {\\n  uefiSettings: {\\n    secureBootEnabled: true\\n    vTpmEnabled: true\\n  }\\n  securityType: securityType\\n}\\nvar vmScaleSetName = toLower(substring('${vmssName}${uniqueString(resourceGroup().id)}', 0, 9))\\nvar addressPrefix = '10.0.0.0/16'\\nvar subnetPrefix = '10.0.8.0/21'\\nvar virtualNetworkName = '${vmScaleSetName}vnet'\\nvar subnetName = '${vmScaleSetName}subnet'\\nvar nicName = '${vmScaleSetName}nic'\\nvar ipConfigName = '${vmScaleSetName}ipconfig'\\nvar imageReference = {\\n  publisher: 'MicrosoftWindowsServer'\\n  offer: 'WindowsServer'\\n  sku: windowsOSVersion\\n  version: 'latest'\\n}\\nvar appGwPublicIPAddressName = '${vmScaleSetName}appGwPip'\\nvar appGwName = '${vmScaleSetName}appGw'\\nvar appGwSubnetName = '${vmScaleSetName}appGwSubnet'\\nvar appGwSubnetPrefix = '10.0.1.0/24'\\nvar appGwFrontendPort = 80\\nvar appGwBackendPort = 80\\nvar appGwBePoolName = '${vmScaleSetName}appGwBepool'\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-11-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        addressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetPrefix\\n        }\\n      }\\n      {\\n        name: appGwSubnetName\\n        properties: {\\n          addressPrefix: appGwSubnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource appGwPublicIPAddress 'Microsoft.Network/publicIPAddresses@2022-11-01' = {\\n  name: appGwPublicIPAddressName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n  }\\n}\\n\\nresource appGw 'Microsoft.Network/applicationGateways@2022-11-01' = {\\n  name: appGwName\\n  location: location\\n  properties: {\\n    sku: {\\n      name: 'Standard_Large'\\n      tier: 'Standard'\\n      capacity: 10\\n    }\\n    gatewayIPConfigurations: [\\n      {\\n        name: 'appGwIpConfig'\\n        properties: {\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, appGwSubnetName)\\n          }\\n        }\\n      }\\n    ]\\n    frontendIPConfigurations: [\\n      {\\n        name: 'appGwFrontendIP'\\n        properties: {\\n          publicIPAddress: {\\n            id: appGwPublicIPAddress.id\\n          }\\n        }\\n      }\\n    ]\\n    frontendPorts: [\\n      {\\n        name: 'appGwFrontendPort'\\n        properties: {\\n          port: appGwFrontendPort\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: appGwBePoolName\\n      }\\n    ]\\n    backendHttpSettingsCollection: [\\n      {\\n        name: 'appGwBackendHttpSettings'\\n        properties: {\\n          port: appGwBackendPort\\n          protocol: 'Http'\\n          cookieBasedAffinity: 'Disabled'\\n        }\\n      }\\n    ]\\n    httpListeners: [\\n      {\\n        name: 'appGwHttpListener'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId('Microsoft.Network/applicationGateways/frontendIPConfigurations', appGwName, 'appGwFrontendIP')\\n          }\\n          frontendPort: {\\n            id: resourceId('Microsoft.Network/applicationGateways/frontendPorts', appGwName, 'appGwFrontendPort')\\n          }\\n          protocol: 'Http'\\n        }\\n      }\\n    ]\\n    requestRoutingRules: [\\n      {\\n        name: 'rule1'\\n        properties: {\\n          ruleType: 'Basic'\\n          httpListener: {\\n            id: resourceId('Microsoft.Network/applicationGateways/httpListeners', appGwName, 'appGwHttpListener')\\n          }\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/applicationGateways/backendAddressPools/', appGwName, appGwBePoolName)\\n          }\\n          backendHttpSettings: {\\n            id: resourceId('Microsoft.Network/applicationGateways/backendHttpSettingsCollection/', appGwName, 'appGwBackendHttpSettings')\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n\\n  ]\\n}\\n\\nresource vmScaleSet 'Microsoft.Compute/virtualMachineScaleSets@2023-03-01' = {\\n  name: vmScaleSetName\\n  location: location\\n  sku: {\\n    name: vmSku\\n    tier: 'Standard'\\n    capacity: instanceCount\\n  }\\n  properties: {\\n    overprovision: true\\n    singlePlacementGroup: false\\n    upgradePolicy: {\\n      mode: 'Automatic'\\n    }\\n    virtualMachineProfile: {\\n      storageProfile: {\\n        osDisk: {\\n          caching: 'ReadWrite'\\n          createOption: 'FromImage'\\n        }\\n        imageReference: imageReference\\n      }\\n      osProfile: {\\n        computerNamePrefix: vmScaleSetName\\n        adminUsername: adminUsername\\n        adminPassword: adminPassword\\n      }\\n      securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\\n      networkProfile: {\\n        networkInterfaceConfigurations: [\\n          {\\n            name: nicName\\n            properties: {\\n              primary: true\\n              ipConfigurations: [\\n                {\\n                  name: ipConfigName\\n                  properties: {\\n                    subnet: {\\n                      id: resourceId('Microsoft.Network/virtualNetworks/subnets/', virtualNetworkName, subnetName)\\n                    }\\n                    applicationGatewayBackendAddressPools: [\\n                      {\\n                        id: resourceId('Microsoft.Network/applicationGateways/backendAddressPools/', appGwName, appGwBePoolName)\\n                      }\\n                    ]\\n                  }\\n                }\\n              ]\\n            }\\n          }\\n        ]\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    virtualNetwork\\n    appGw\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmSku\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"windowsOSVersion\\\": {\\n      \\\"value\\\": \\\"2022-datacenter-azure-edition\\\"\\n    },\\n    \\\"securityType\\\": {\\n      \\\"value\\\": \\\"TrustedLaunch\\\"\\n    },\\n    \\\"vmssName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"instanceCount\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name for the container group')\\nparam name string\\n\\n@description('Name for the container')\\nparam containerName string = 'container1'\\n\\n@description('Name for the image')\\nparam imageName string = 'containerinstance/helloworld:ssl'\\n\\n@description('Name for the secret volume')\\nparam volumeName string = 'volume1'\\n\\n@description('The DSN name label')\\nparam dnsNameLabel string\\n\\n@description('Base-64 encoded authentication PFX certificate.')\\n@secure()\\nparam sslCertificateData string\\n\\n@description('Base-64 encoded password of authentication PFX certificate.')\\n@secure()\\nparam sslCertificatePwd string\\n\\n@description('Port to open on the container and the public IP address.')\\nparam port int = 443\\n\\n@description('The number of CPU cores to allocate to the container.')\\nparam cpuCores int = 1\\n\\n@description('The amount of memory to allocate to the container in gigabytes.')\\nparam memoryInGb int = 2\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nresource containergroup 'Microsoft.ContainerInstance/containerGroups@2020-11-01' = {\\n  name: name\\n  location: location\\n  properties: {\\n    containers: [\\n      {\\n        name: containerName\\n        properties: {\\n          image: imageName\\n          ports: [\\n            {\\n              port: port\\n            }\\n          ]\\n          resources: {\\n            requests: {\\n              cpu: cpuCores\\n              memoryInGB: memoryInGb\\n            }\\n          }\\n          volumeMounts: [\\n            {\\n              name: volumeName\\n              mountPath: '/mnt/secrets'\\n              readOnly: false\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n    osType: 'Linux'\\n    ipAddress: {\\n      type: 'Public'\\n      dnsNameLabel: dnsNameLabel\\n      ports: [\\n        {\\n          protocol: 'TCP'\\n          port: port\\n        }\\n      ]\\n    }\\n    volumes: [\\n      {\\n        name: volumeName\\n        secret: {\\n          sslCertificateData: sslCertificateData\\n          sslCertificatePwd: base64(sslCertificatePwd)\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\noutput containerIPAddressFqdn string = containergroup.properties.ipAddress.fqdn\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"name\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"containerName\\\": {\\n      \\\"value\\\": \\\"container1\\\"\\n    },\\n    \\\"imageName\\\": {\\n      \\\"value\\\": \\\"containerinstance/helloworld:ssl\\\"\\n    },\\n    \\\"volumeName\\\": {\\n      \\\"value\\\": \\\"volume1\\\"\\n    },\\n    \\\"dnsNameLabel\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sslCertificateData\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sslCertificatePwd\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"port\\\": {\\n      \\\"value\\\": 443\\n    },\\n    \\\"cpuCores\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"memoryInGb\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param location string\\nparam prefix string\\n\\nparam apiKey string\\nparam autoGeneratedDomainNameLabelScope string\\nparam deterministicOutboundIP string\\nparam grafanaMajorVersion string\\nparam grafanaSkuName string\\nparam publicNetworkAccess string\\nparam smtp bool\\nparam zoneRedundancy string\\nparam privateDnsZoneName string\\nparam privateLinkServiceUrl string\\nparam virtualNetworkId string\\nparam virtualNetworkName string\\nparam subnetId string\\nparam helmOutput string\\n\\nparam  privateLinkResourceId string = '/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Network/privateLinkServices/${helmOutput}'\\n\\n\\n\\nresource grafana 'Microsoft.Dashboard/grafana@2023-09-01' = {\\n  name: '${prefix}-grafana'\\n  location: location\\n  sku: {\\n    name: grafanaSkuName\\n  }\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  properties: {\\n    apiKey: apiKey\\n    autoGeneratedDomainNameLabelScope: autoGeneratedDomainNameLabelScope\\n    deterministicOutboundIP: deterministicOutboundIP\\n    grafanaConfigurations: {\\n      smtp: {\\n        enabled: smtp\\n      }\\n    }\\n    grafanaMajorVersion: grafanaMajorVersion\\n    publicNetworkAccess: publicNetworkAccess\\n    zoneRedundancy: zoneRedundancy\\n  }\\n}\\n\\nresource grafana1RoleDefinition 'Microsoft.Authorization/roleDefinitions@2022-05-01-preview' existing = {\\n  name: '43d0d8ad-25c7-4714-9337-8ba259a9fe05'\\n  scope: subscription()\\n}\\n\\nresource grafana1RoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  name: guid(subscription().id, resourceGroup().id, grafana.id, '1')\\n  scope: resourceGroup()\\n  properties: {\\n    principalId: grafana.identity.principalId\\n    roleDefinitionId: grafana1RoleDefinition.id//'7f951dda-4ed3-4680-a7ca-43fe172d538d'\\n  }\\n}\\n\\nresource privateDNSZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  location: 'global'\\n  name: privateDnsZoneName\\n  properties: {}\\n}\\n\\nresource virtualNetworkLinks 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: privateDNSZone\\n  location: 'global'\\n  name: toLower(virtualNetworkName)\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: virtualNetworkId\\n    }\\n  }\\n}\\n\\nresource grafanaPrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\\n  location: location\\n  name: '${grafana.name}-pe'\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: '${grafana.name}-pe'\\n        properties: {\\n          privateLinkServiceId: grafana.id\\n          groupIds: [\\n            split(split(grafana.type, '/')[1], '@')[0]\\n          ]\\n          privateLinkServiceConnectionState: {\\n            description: 'Auto-Approved'\\n            status: 'Approved'\\n          }\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: subnetId\\n    }\\n  }\\n}\\n\\nresource privateDnsZoneGroups 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-11-01' = {\\n  parent: grafanaPrivateEndpoint\\n  name: '${grafana.name}-dnszonegroup'\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: replace(privateDNSZone.name, '.', '-')\\n        properties: {\\n          privateDnsZoneId: privateDNSZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource grafanaManagedEndpoint 'Microsoft.Dashboard/grafana/managedPrivateEndpoints@2023-09-01' = {\\n  parent: grafana\\n  location: location\\n  name: 'prometheusManagedPls'\\n  properties: {\\n    privateLinkResourceId: privateLinkResourceId\\n    privateLinkServiceUrl: privateLinkServiceUrl\\n    requestMessage: 'Please approve my connection'\\n  }\\n\\n  dependsOn: [\\n    grafanaPrivateEndpoint\\n  ]\\n}\\n\\nmodule privateLinkApproval 'privatelinkapproval.bicep' = {\\n  name: 'PrivateLinkApprovalScripts'\\n  params: {\\n    location: location\\n    privateLinkServicenName: 'prometheusManagedPls'\\n    helmOutput: helmOutput\\n  }\\n\\n  dependsOn: [\\n    grafanaManagedEndpoint\\n  ]\\n}\\n\\noutput grafaneEndpoint string = grafana.properties.endpoint\\noutput mpeplsEndpoint string = grafanaManagedEndpoint.properties.privateLinkServiceUrl\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"prefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"apiKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"autoGeneratedDomainNameLabelScope\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"deterministicOutboundIP\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"grafanaMajorVersion\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"grafanaSkuName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"publicNetworkAccess\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"smtp\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"zoneRedundancy\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"privateDnsZoneName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"privateLinkServiceUrl\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualNetworkId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"helmOutput\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"privateLinkResourceId\\\": {\\n      \\\"value\\\": \\\"/subscriptions/${subscription().subscriptionId}/resourceGroups/${resourceGroup().name}/providers/Microsoft.Network/privateLinkServices/${helmOutput}\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Copyright (c) Microsoft Corporation.\\n// Licensed under the MIT License.\\n\\nimport { getHubTags, HubCoreConfig } from 'hub-types.bicep'\\n\\n\\n//==============================================================================\\n// Parameters\\n//==============================================================================\\n\\n// @description('Required. Name of the FinOps hub instance.')\\n// param hubName string\\n\\n@description('Required. FinOps hub configuration settings.')\\nparam coreConfig HubCoreConfig\\n\\n\\n//==============================================================================\\n// Resources\\n//==============================================================================\\n\\n//------------------------------------------------------------------------------\\n// Storage DNS zones\\n//------------------------------------------------------------------------------\\n\\n// Required for the Azure portal and Storage Explorer\\nresource blobPrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = if (coreConfig.network.isPrivate) {\\n  name: coreConfig.network.dnsZones.blob.name\\n  location: 'global'\\n  tags: getHubTags(coreConfig, 'Microsoft.Storage/privateDnsZones')\\n  properties: {}\\n\\n  resource blobPrivateDnsZoneLink 'virtualNetworkLinks' = {\\n    name: '${replace(blobPrivateDnsZone.name, '.', '-')}-link'\\n    location: 'global'\\n    tags: getHubTags(coreConfig, 'Microsoft.Network/privateDnsZones/virtualNetworkLinks')\\n    properties: {\\n      registrationEnabled: false\\n      virtualNetwork: {\\n        id: coreConfig.network.id\\n      }\\n    }\\n  }\\n}\\n\\n// Required for Power BI\\nresource dfsPrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = if (coreConfig.network.isPrivate) {\\n  name: coreConfig.network.dnsZones.dfs.name\\n  location: 'global'\\n  tags: getHubTags(coreConfig, 'Microsoft.Storage/privateDnsZones')\\n  properties: {}\\n\\n  resource dfsPrivateDnsZoneLink 'virtualNetworkLinks' = {\\n    name: '${replace(dfsPrivateDnsZone.name, '.', '-')}-link'\\n    location: 'global'\\n    tags: getHubTags(coreConfig, 'Microsoft.Network/privateDnsZones/virtualNetworkLinks')\\n    properties: {\\n      registrationEnabled: false\\n      virtualNetwork: {\\n        id: coreConfig.network.id\\n      }\\n    }\\n  }\\n}\\n\\n// Required for Azure Data Explorer\\nresource queuePrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = if (coreConfig.network.isPrivate) {\\n  name: coreConfig.network.dnsZones.queue.name\\n  location: 'global'\\n  tags: getHubTags(coreConfig, 'Microsoft.Storage/privateDnsZones')\\n  properties: {}\\n  \\n  resource queuePrivateDnsZoneLink 'virtualNetworkLinks' = {\\n    name: '${replace(queuePrivateDnsZone.name, '.', '-')}-link'\\n    location: 'global'\\n    tags: getHubTags(coreConfig, 'Microsoft.Network/privateDnsZones/virtualNetworkLinks')\\n    properties: {\\n      registrationEnabled: false\\n      virtualNetwork: {\\n        id: coreConfig.network.id\\n      }\\n    }\\n  }\\n}\\n\\n// Required for Azure Data Explorer\\nresource tablePrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = if (coreConfig.network.isPrivate) {\\n  name: coreConfig.network.dnsZones.table.name\\n  location: 'global'\\n  tags: getHubTags(coreConfig, 'Microsoft.Storage/privateDnsZones')\\n  properties: {}\\n  \\n  resource tablePrivateDnsZoneLink 'virtualNetworkLinks' = {\\n    name: '${replace(tablePrivateDnsZone.name, '.', '-')}-link'\\n    location: 'global'\\n    tags: getHubTags(coreConfig, 'Microsoft.Network/privateDnsZones/virtualNetworkLinks')\\n    properties: {\\n      registrationEnabled: false\\n      virtualNetwork: {\\n        id: coreConfig.network.id\\n      }\\n    }\\n  }\\n}\\n\\n//------------------------------------------------------------------------------\\n// Script storage\\n//------------------------------------------------------------------------------\\n\\nresource scriptStorageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' = if (coreConfig.network.isPrivate) {\\n  name: coreConfig.deployment.storage\\n  location: coreConfig.hub.location\\n  sku: {\\n    name: 'Standard_LRS'\\n  }\\n  kind: 'StorageV2'\\n  tags: getHubTags(coreConfig, 'Microsoft.Storage/storageAccounts')\\n  properties: {\\n    supportsHttpsTrafficOnly: true\\n    allowSharedKeyAccess: true\\n    isHnsEnabled: false\\n    minimumTlsVersion: 'TLS1_2'\\n    allowBlobPublicAccess: false\\n    publicNetworkAccess: 'Enabled'\\n    networkAcls: {\\n      bypass: 'AzureServices'\\n      defaultAction: 'Deny'\\n      virtualNetworkRules: [\\n        {\\n          id: coreConfig.network.subnets.scripts\\n          action: 'Allow'\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource scriptEndpoint 'Microsoft.Network/privateEndpoints@2023-11-01' = if (coreConfig.network.isPrivate) {\\n  name: '${scriptStorageAccount.name}-blob-ep'\\n  location: coreConfig.hub.location\\n  tags: getHubTags(coreConfig, 'Microsoft.Network/privateEndpoints')\\n  properties: {\\n    subnet: {\\n      id: coreConfig.network.subnets.storage\\n    }\\n    privateLinkServiceConnections: [\\n      {\\n        name: 'scriptLink'\\n        properties: {\\n          privateLinkServiceId: scriptStorageAccount.id\\n          groupIds: ['blob']\\n        }\\n      }\\n    ]\\n  }\\n  \\n  resource scriptPrivateDnsZoneGroup 'privateDnsZoneGroups' = {\\n    name: 'blob-endpoint-zone'\\n    properties: {\\n      privateDnsZoneConfigs: [\\n        {\\n          name: blobPrivateDnsZone.name\\n          properties: {\\n            privateDnsZoneId: blobPrivateDnsZone.id\\n          }\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\n\\n//==============================================================================\\n// Output\\n//==============================================================================\\n\\noutput config HubCoreConfig = coreConfig\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"hubName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"coreConfig\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Copyright (c) Microsoft Corporation.\\n// Licensed under the MIT License.\\n\\n//==============================================================================\\n// Parameters\\n//==============================================================================\\n\\n@description('Required. Name of the storage container to create or update.')\\nparam container string\\n\\n@description('Optional. Dictionary of key/value pairs for the files to upload to the specified container. The key is the target path under the container and the value is the contents of the file. Default: {} (no files to upload).')\\nparam files object = {}\\n\\n//------------------------------------------------------------------------------\\n// Hub context\\n//------------------------------------------------------------------------------\\n\\n@description('Required. Name of the publisher-specific storage account to create or update.')\\nparam storageAccountName string\\n\\n@description('Optional. Azure location where all resources should be created. See https://aka.ms/azureregions. Default: (resource group location).')\\nparam location string = resourceGroup().location\\n\\n@description('Optional. Tags to apply to all resources.')\\nparam tags object = {}\\n\\n@description('Optional. Tags to apply to resources based on their resource type. Resource type specific tags will be merged with tags for all resources.')\\nparam tagsByResource object = {}\\n\\n@description('Optional. The name of the managed identity to use for uploading files.')\\nparam blobManagerIdentityName string = ''\\n\\n@description('Required. Indicates whether public access should be enabled.')\\nparam enablePublicAccess bool\\n\\n@description('Optional. The name of the storage account used for deployment scripts.')\\nparam scriptStorageAccountName string = ''\\n\\n@description('Optional. Resource ID of the virtual network for running deployment scripts.')\\nparam scriptSubnetId string = ''\\n\\n\\n//==============================================================================\\n// Variables\\n//==============================================================================\\n\\nvar fileCount = length(items(files))\\nvar hasFiles = fileCount > 0\\n\\n\\n//==============================================================================\\n// Resources\\n//==============================================================================\\n\\n// Get storage account instance\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' existing = {\\n  name: storageAccountName\\n  \\n  resource blobService 'blobServices@2022-09-01' = {\\n    name: 'default'\\n\\n    resource targetContainer 'containers@2022-09-01' = {\\n      name: container\\n      properties: {\\n        publicAccess: 'None'\\n        metadata: {}\\n      }\\n    }\\n  }\\n}\\n\\n// TODO: Enforce retention\\n\\n//------------------------------------------------------------------------------\\n// Upload schema file to storage\\n//------------------------------------------------------------------------------\\n\\nresource scriptStorageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' existing =  if (hasFiles && !enablePublicAccess) {\\n  name: scriptStorageAccountName\\n}\\n\\nresource blobManagerIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2023-01-31' existing = if (hasFiles) {\\n  name: blobManagerIdentityName\\n}\\n\\nresource uploadFiles 'Microsoft.Resources/deploymentScripts@2023-08-01' = if (hasFiles) {\\n  name: '${storageAccountName}_uploadFiles'\\n  kind: 'AzurePowerShell'\\n  // cSpell:ignore chinaeast\\n  // chinaeast2 is the only region in China that supports deployment scripts\\n  location: startsWith(location, 'china') ? 'chinaeast2' : location\\n  tags: union(tags, tagsByResource[?'Microsoft.Resources/deploymentScripts'] ?? {})\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${blobManagerIdentity.id}': {}\\n    }\\n  }\\n  dependsOn: []\\n  properties: union(enablePublicAccess ? {} : {\\n    storageAccountSettings: {\\n      storageAccountName: scriptStorageAccount.name\\n    }\\n    containerSettings: {\\n      containerGroupName: '${scriptStorageAccount.name}cg'\\n      subnetIds: [\\n        {\\n          id: scriptSubnetId\\n        }\\n      ]\\n    }\\n  }, {\\n    azPowerShellVersion: '9.0'\\n    retentionInterval: 'PT1H'\\n    environmentVariables: [\\n      {\\n        name: 'storageAccountName'\\n        value: storageAccount.name\\n      }\\n      {\\n        name: 'containerName'\\n        value: container\\n      }\\n      {\\n        name: 'files'\\n        value: string(files)\\n      }\\n    ]\\n    scriptContent: loadTextContent('./scripts/Upload-StorageFile.ps1')\\n  })\\n}\\n\\n\\n//==============================================================================\\n// Outputs\\n//==============================================================================\\n\\n@description('The name of the storage container.')\\noutput containerName string = storageAccount::blobService::targetContainer.name\\n\\n@description('The number of files uploaded to the storage container.')\\noutput filesUploaded int = fileCount\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"container\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"files\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"tagsByResource\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"blobManagerIdentityName\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"enablePublicAccess\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"scriptStorageAccountName\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"scriptSubnetId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Copyright (c) Microsoft Corporation.\\n// Licensed under the MIT License.\\n\\n//==============================================================================\\n// Parameters\\n//==============================================================================\\n\\n@description('Optional. Array of private endpoint connections. Pending ones will be approved.')\\nparam privateEndpointConnections array = []\\n\\n@description('Required. Name of the storage account.')\\nparam storageAccountName string\\n\\n//==============================================================================\\n// Resources\\n//==============================================================================\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-04-01' existing = {\\n  name: storageAccountName\\n}\\n\\nresource privateEndpointConnection 'Microsoft.Storage/storageAccounts/privateEndpointConnections@2023-04-01' =  [ for privateEndpointConnection in privateEndpointConnections : if (privateEndpointConnection.properties.privateLinkServiceConnectionState.status == 'Pending') {\\n  name: last(array(split(privateEndpointConnection.id, '/')))\\n  parent: storageAccount\\n  properties: {\\n    privateLinkServiceConnectionState: {\\n      status: 'Approved'\\n      description: 'Approved-by-pipeline'\\n      actionRequired: 'None'\\n    }\\n  }\\n}]\\n\\n//==============================================================================\\n// Outputs\\n//==============================================================================\\n\\noutput privateEndpointConnections array = storageAccount.properties.privateEndpointConnections\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"privateEndpointConnections\\\": {\\n      \\\"value\\\": \\\"[]\\\"\\n    },\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the SQL logical server')\\nparam serverName string = uniqueString('sql', resourceGroup().id)\\n\\n@description('Location for all resources')\\nparam location string = resourceGroup().location\\n\\n@description('The administrator username of the SQL logical server')\\nparam administratorLogin string\\n\\n@description('The administrator password of the SQL logical server')\\n@secure()\\nparam administratorLoginPassword string\\n\\n@description('The name of the key vault')\\nparam keyVaultName string = uniqueString('akv', resourceGroup().id)\\n\\nresource server 'Microsoft.Sql/servers@2023-08-01-preview' = {\\n  name: serverName\\n  location: location\\n  properties: {\\n    administratorLogin: administratorLogin\\n    administratorLoginPassword: administratorLoginPassword\\n    version: '12.0'\\n  }\\n}\\n\\nresource keyVault 'Microsoft.KeyVault/vaults@2023-07-01' = {\\n  name: keyVaultName\\n  location: location\\n  properties: {\\n    enabledForDeployment: false\\n    enabledForDiskEncryption: false\\n    enabledForTemplateDeployment: false\\n    enableRbacAuthorization: true\\n    tenantId: subscription().tenantId\\n    sku: {\\n      name: 'standard'\\n      family: 'A'\\n    }\\n    networkAcls: {\\n      defaultAction: 'Deny'\\n    }\\n  }\\n}\\n\\noutput logicalServerSubscriptionId string = subscription().subscriptionId\\noutput logicalServerResourceGroupName string = resourceGroup().name\\noutput logicalServerName string = serverName\\noutput keyVaultSubscriptionId string = subscription().subscriptionId\\noutput keyVaultResourceGroupName string = resourceGroup().name\\noutput keyVaultName string = keyVaultName\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"serverName\\\": {\\n      \\\"value\\\": \\\"uniqueString('sql', resourceGroup().id)\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"administratorLogin\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"administratorLoginPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyVaultName\\\": {\\n      \\\"value\\\": \\\"uniqueString('akv', resourceGroup().id)\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies whether to deploy Azure Databricks workspace with Secure Cluster Connectivity (No Public IP) enabled or not')\\nparam disablePublicIp bool = true\\n\\n@description('The name of the Azure Databricks workspace to create.')\\nparam workspaceName string\\n\\n@description('The pricing tier of workspace.')\\n@allowed([\\n  'standard'\\n  'premium'\\n])\\nparam pricingTier string = 'premium'\\n\\n@description('The first 2 octets of the virtual network /16 address range (e.g., \\\\'10.139\\\\' for the address range 10.139.0.0/16).')\\nparam vnetAddressPrefix string = '10.139'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nvar managedResourceGroupName = 'databricks-rg-${workspaceName}-${uniqueString(workspaceName, resourceGroup().id)}'\\nvar trimmedMRGName = substring(managedResourceGroupName, 0, min(length(managedResourceGroupName), 90))\\nvar managedResourceGroupId = '${subscription().id}/resourceGroups/${trimmedMRGName}'\\n\\nresource workspace 'Microsoft.Databricks/workspaces@2024-05-01' = {\\n  name: workspaceName\\n  location: location\\n  sku: {\\n    name: pricingTier\\n  }\\n  properties: {\\n    managedResourceGroupId: managedResourceGroupId\\n    parameters: {\\n      vnetAddressPrefix: {\\n        value: vnetAddressPrefix\\n      }\\n      enableNoPublicIp: {\\n        value: disablePublicIp\\n      }\\n    }\\n  }\\n}\\n\\noutput workspace object = workspace.properties\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"disablePublicIp\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"workspaceName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"pricingTier\\\": {\\n      \\\"value\\\": \\\"premium\\\"\\n    },\\n    \\\"vnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.139\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param principalId string\\nparam tenantId string\\n\\n@description('The Azure Key Vault name.')\\nparam keyVaultName string\\n\\nresource keyVaultName_add 'Microsoft.KeyVault/vaults/accessPolicies@2022-07-01' = {\\n  name: '${keyVaultName}/add'\\n  properties: {\\n    accessPolicies: [\\n      {\\n        objectId: principalId\\n        tenantId: tenantId\\n        permissions: {\\n          keys: [\\n            'get'\\n            'wrapKey'\\n            'unwrapKey'\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"principalId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"tenantId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyVaultName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"targetScope = 'subscription'\\n\\n@description('Specify the name of the resource group in which the datadog resource will be created')\\nparam resourceGroupName string\\n\\n@description('Specify a name for the Datadog resource')\\nparam monitorName string = 'Datadog-${uniqueString(subscription().id)}'\\n\\n@description('Specify the region for the monitor resource')\\n@allowed([\\n  'westus2'\\n])\\nparam location string = 'westus2'\\n\\nvar guidValue = guid(deployment().name, 'datadog')\\nvar monitorDeploymentName = 'DatadogMonitor_${substring(guidValue, 0, 8)}'\\nvar roleAssignmentName = guidValue\\n\\nresource resourceGroup 'Microsoft.Resources/resourceGroups@2023-07-01' = {\\n  name: resourceGroupName\\n  location: location\\n  properties: {}\\n}\\n\\nmodule monitorDeployment './nested_monitorDeployment.bicep' = {\\n  name: monitorDeploymentName\\n  scope: resourceGroup\\n  params: {\\n    monitorName: monitorName\\n    location: location\\n    skuName: 'payg_v2_Monthly@TIDgmz7xq9ge3py'\\n    singleSignOnState: 'Initial'\\n    tagRulesProperties: {\\n      metricRules: {\\n        filteringTags: []\\n      }\\n      logRules: {\\n        sendSubscriptionLogs: true\\n        sendResourceLogs: true\\n        filteringTags: []\\n      }\\n      automuting: true\\n    }\\n    monitorTags: {}\\n    cspm: false\\n  }\\n}\\n\\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  name: roleAssignmentName\\n  properties: {\\n    roleDefinitionId: monitoringReaderRoleDefinition.id\\n    principalId: monitorDeployment.outputs.monitorPrincipalId\\n    principalType: 'ServicePrincipal'\\n  }\\n}\\n\\nresource monitoringReaderRoleDefinition 'Microsoft.Authorization/roleDefinitions@2022-04-01' existing = {\\n  scope: subscription()\\n  name: '43d0d8ad-25c7-4714-9337-8ba259a9fe05' //Azure monitoring reader role\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"resourceGroupName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"monitorName\\\": {\\n      \\\"value\\\": \\\"Datadog-${uniqueString(subscription().id)}\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"westus2\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the Data Lake Store account to create.')\\nparam accountName string\\n\\n@description('The location in which to create the Data Lake Store account.')\\nparam location string = resourceGroup().location\\n\\nresource dataLake 'Microsoft.DataLakeStore/accounts@2016-11-01' = {\\n  name: accountName\\n  location: location\\n  properties: {\\n    newTier: 'Consumption'\\n    encryptionState: 'Enabled'\\n    encryptionConfig: {\\n      type: 'ServiceManaged'\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"accountName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the Vault')\\nparam vaultName string = 'BackupVault'\\n\\n@description('Change Vault Storage Type (not allowed if the vault has registered backups)')\\n@allowed([\\n  'LocallyRedundant'\\n  'GeoRedundant'\\n])\\nparam vaultStorageRedundancy string = 'GeoRedundant'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nresource backupVault 'Microsoft.DataProtection/BackupVaults@2024-04-01' = {\\n  name: vaultName\\n  location: location\\n  identity: {\\n    type: 'systemAssigned'\\n  }\\n  properties: {\\n    storageSettings: [\\n      {\\n        datastoreType: 'VaultStore'\\n        type: vaultStorageRedundancy\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vaultName\\\": {\\n      \\\"value\\\": \\\"BackupVault\\\"\\n    },\\n    \\\"vaultStorageRedundancy\\\": {\\n      \\\"value\\\": \\\"GeoRedundant\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Server Name for Azure database for MySQL')\\nparam serverName string\\n\\n@description('Database administrator login name')\\n@minLength(1)\\nparam administratorLogin string\\n\\n@description('Database administrator password')\\n@minLength(8)\\n@secure()\\nparam administratorLoginPassword string\\n\\n@description('Azure database for MySQL compute capacity in vCores (2,4,8,16,32)')\\nparam skuCapacity int = 2\\n\\n@description('Azure database for MySQL sku name ')\\nparam skuName string = 'GP_Gen5_2'\\n\\n@description('Azure database for MySQL Sku Size ')\\nparam SkuSizeMB int = 5120\\n\\n@description('Azure database for MySQL pricing tier')\\n@allowed([\\n  'Basic'\\n  'GeneralPurpose'\\n  'MemoryOptimized'\\n])\\nparam SkuTier string = 'GeneralPurpose'\\n\\n@description('Azure database for MySQL sku family')\\nparam skuFamily string = 'Gen5'\\n\\n@description('MySQL version')\\n@allowed([\\n  '5.6'\\n  '5.7'\\n  '8.0'\\n])\\nparam mysqlVersion string = '8.0'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('MySQL Server backup retention days')\\nparam backupRetentionDays int = 7\\n\\n@description('Geo-Redundant Backup setting')\\nparam geoRedundantBackup string = 'Disabled'\\n\\n@description('Virtual Network Name')\\nparam virtualNetworkName string = 'azure_mysql_vnet'\\n\\n@description('Subnet Name')\\nparam subnetName string = 'azure_mysql_subnet'\\n\\n@description('Virtual Network RuleName')\\nparam virtualNetworkRuleName string = 'AllowSubnet'\\n\\n@description('Virtual Network Address Prefix')\\nparam vnetAddressPrefix string = '10.0.0.0/16'\\n\\n@description('Subnet Address Prefix')\\nparam subnetPrefix string = '10.0.0.0/16'\\n\\nvar firewallrules = [\\n  {\\n    Name: 'rule1'\\n    StartIpAddress: '0.0.0.0'\\n    EndIpAddress: '255.255.255.255'\\n  }\\n  {\\n    Name: 'rule2'\\n    StartIpAddress: '0.0.0.0'\\n    EndIpAddress: '255.255.255.255'\\n  }\\n]\\n\\nresource vnet 'Microsoft.Network/virtualNetworks@2023-09-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetAddressPrefix\\n      ]\\n    }\\n  }\\n}\\n\\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2023-09-01' = {\\n  parent: vnet\\n  name: subnetName\\n  properties: {\\n    addressPrefix: subnetPrefix\\n  }\\n}\\n\\nresource mysqlDbServer 'Microsoft.DBforMySQL/servers@2017-12-01' = {\\n  name: serverName\\n  location: location\\n  sku: {\\n    name: skuName\\n    tier: SkuTier\\n    capacity: skuCapacity\\n    size: '${SkuSizeMB}'  //a string is expected here but a int for the storageProfile...\\n    family: skuFamily\\n  }\\n  properties: {\\n    createMode: 'Default'\\n    version: mysqlVersion\\n    administratorLogin: administratorLogin\\n    administratorLoginPassword: administratorLoginPassword\\n    storageProfile: {\\n      storageMB: SkuSizeMB\\n      backupRetentionDays: backupRetentionDays\\n      geoRedundantBackup: geoRedundantBackup\\n    }\\n    minimalTlsVersion: 'TLS1_2'\\n    sslEnforcement: 'Enabled'\\n  }\\n\\n  resource virtualNetworkRule 'virtualNetworkRules@2017-12-01' = {\\n    name: virtualNetworkRuleName\\n    properties: {\\n      virtualNetworkSubnetId: subnet.id\\n      ignoreMissingVnetServiceEndpoint: true\\n    }\\n  }\\n}\\n\\n@batchSize(1)\\nresource firewallRules 'Microsoft.DBforMySQL/servers/firewallRules@2017-12-01' = [for rule in firewallrules: {\\n  parent: mysqlDbServer\\n  name: rule.Name\\n  properties: {\\n    startIpAddress: rule.StartIpAddress\\n    endIpAddress: rule.EndIpAddress\\n  }\\n}]\\n\\noutput location string = location\\noutput name string = mysqlDbServer.name\\noutput resourceGroupName string = resourceGroup().name\\noutput resourceId string = mysqlDbServer.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"serverName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"administratorLogin\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"administratorLoginPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"skuCapacity\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"skuName\\\": {\\n      \\\"value\\\": \\\"GP_Gen5_2\\\"\\n    },\\n    \\\"SkuSizeMB\\\": {\\n      \\\"value\\\": 5120\\n    },\\n    \\\"SkuTier\\\": {\\n      \\\"value\\\": \\\"GeneralPurpose\\\"\\n    },\\n    \\\"skuFamily\\\": {\\n      \\\"value\\\": \\\"Gen5\\\"\\n    },\\n    \\\"mysqlVersion\\\": {\\n      \\\"value\\\": \\\"8.0\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"backupRetentionDays\\\": {\\n      \\\"value\\\": 7\\n    },\\n    \\\"geoRedundantBackup\\\": {\\n      \\\"value\\\": \\\"Disabled\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"azure_mysql_vnet\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"azure_mysql_subnet\\\"\\n    },\\n    \\\"virtualNetworkRuleName\\\": {\\n      \\\"value\\\": \\\"AllowSubnet\\\"\\n    },\\n    \\\"vnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"subnetPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param location string\\nparam fslogixEnabled bool\\n\\nparam subnetId string\\nparam numberOfSessionHost int = 2\\nparam virtualMachine object\\n@secure()\\nparam adminUsername string\\n@secure()\\nparam adminPassword string\\nparam hostPoolName string\\nparam activeDirectoryAuthenticationEnabled bool\\nparam DomainName string?\\nparam DomainJoinOUPath string?\\nparam ADAdministratorAccountUsername string?\\n@secure()\\nparam ADAdministratorAccountPassword string?\\nparam artifactsLocation string\\nparam hostPoolRegistrationInfoToken string\\n\\nresource networkInterface 'Microsoft.Network/networkInterfaces@2024-01-01' = [for i in range(0, numberOfSessionHost) : {\\n  location: location\\n  name: '${virtualMachine.name}-nic${i + 1}'\\n  properties: {\\n    enableAcceleratedNetworking: true\\n    ipConfigurations: [\\n      {\\n        name: 'ipConfig'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: subnetId\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}]\\n\\nresource vms 'Microsoft.Compute/virtualMachines@2024-03-01' = [for i in range(0, numberOfSessionHost) : {\\n  location: location\\n  name: '${virtualMachine.name}${i + 1}'\\n  properties: {\\n    licenseType: virtualMachine.licenseType\\n    hardwareProfile: {\\n      vmSize: virtualMachine.vmSize\\n    }\\n    storageProfile: {\\n      osDisk: {\\n        createOption: virtualMachine.osDisk.createOption\\n        managedDisk: {\\n          storageAccountType: virtualMachine.osDisk.storageAccountType\\n        }\\n        deleteOption: virtualMachine.osDisk.deleteOption\\n      }\\n      imageReference: {\\n        publisher: virtualMachine.imageReference.publisher\\n        offer: virtualMachine.imageReference.offer\\n        sku: virtualMachine.imageReference.sku\\n        version: virtualMachine.imageReference.version\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: networkInterface[i].id\\n          properties: {\\n            deleteOption: 'Delete'\\n          }\\n        }\\n      ]\\n    }\\n    securityProfile: {\\n      securityType: 'TrustedLaunch'\\n      uefiSettings: {\\n        secureBootEnabled: true\\n        vTpmEnabled: true\\n      }\\n    }\\n    additionalCapabilities: {\\n      hibernationEnabled: false\\n    }\\n    osProfile: {\\n      computerName: '${virtualMachine.name}${i + 1}'\\n      adminUsername: adminUsername\\n      adminPassword: adminPassword\\n    }\\n    diagnosticsProfile: {\\n      bootDiagnostics: {\\n        enabled: true\\n      }\\n    }\\n  }\\n}]\\n\\nresource entraIdJoin 'Microsoft.Compute/virtualMachines/extensions@2024-03-01' = [for i in range(0, numberOfSessionHost) : if (!activeDirectoryAuthenticationEnabled || !fslogixEnabled) {\\n  parent: vms[i]\\n  name: 'AADLoginForWindows'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Azure.ActiveDirectory'\\n    type: 'AADLoginForWindows'\\n    typeHandlerVersion: '1.0'\\n    autoUpgradeMinorVersion: true\\n    enableAutomaticUpgrade: false\\n  }\\n}]\\n\\nresource dcs 'Microsoft.Compute/virtualMachines/extensions@2024-03-01' = [for i in range(0, numberOfSessionHost) : {\\n  parent: vms[i]\\n  name: 'MicrosoftPowershellDSC'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Powershell'\\n    type: 'DSC'\\n    typeHandlerVersion: '2.83'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      modulesUrl: artifactsLocation\\n      configurationFunction: 'Configuration.ps1\\\\\\\\AddSessionHost'\\n      properties: {\\n        hostPoolName: hostPoolName\\n        aadJoin: true\\n      }\\n    }\\n    protectedSettings: {\\n      properties: {\\n        registrationInfoToken: hostPoolRegistrationInfoToken\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    entraIdJoin\\n  ]\\n}]\\n\\nresource adomainJoin 'Microsoft.Compute/virtualMachines/extensions@2024-03-01' = [for i in range(0, numberOfSessionHost) :if (activeDirectoryAuthenticationEnabled || fslogixEnabled)  {\\n  parent: vms[i]\\n  name: 'ActiveDirectoryDomainJoin'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Compute'\\n    type: 'JsonADDomainExtension'\\n    typeHandlerVersion: '1.3'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      name: DomainName\\n      ouPath: DomainJoinOUPath\\n      user: ADAdministratorAccountUsername\\n      restart: true\\n      options: 3\\n    }\\n    protectedSettings: {\\n      password: ADAdministratorAccountPassword\\n    }\\n  }\\n  dependsOn: [\\n    dcs\\n  ]\\n}]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"fslogixEnabled\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"numberOfSessionHost\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"virtualMachine\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"adminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"hostPoolName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"activeDirectoryAuthenticationEnabled\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"DomainName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"DomainJoinOUPath\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"ADAdministratorAccountUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"ADAdministratorAccountPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"artifactsLocation\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"hostPoolRegistrationInfoToken\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"targetScope = 'subscription'\\n\\nparam devCenterName string\\nparam resourceGroupName string\\nparam guidSeed string\\n\\nresource devcenter 'Microsoft.DevCenter/devcenters@2023-04-01' existing = {\\n  scope: resourceGroup(resourceGroupName)\\n  name: devCenterName\\n}\\n\\nresource roleAssignment1 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  name: guid('User Access Administrator', guidSeed)\\n  properties: {\\n    description: 'Lets you manage user access to Azure resources.'\\n    principalId: devcenter.identity.principalId\\n    principalType: 'ServicePrincipal'\\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')\\n  }\\n}\\n\\nresource roleAssignment2 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  name: guid('Contributor', guidSeed)\\n  properties: {\\n    description: 'Grants full access to manage all resources, but does not allow you to assign roles in Azure RBAC, manage assignments in Azure Blueprints, or share image galleries.'\\n    principalId: devcenter.identity.principalId\\n    principalType: 'ServicePrincipal'\\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"devCenterName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"resourceGroupName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"guidSeed\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param toolsRoot string\\nparam sourcesDriveRoot string\\nparam defenderExclusions bool\\nparam userDefenderExclusions array\\nparam defenderExclusionPathList string\\nparam allParamsForLogging object\\nparam credentialProvider object\\nparam osDriveMinSizeGB int\\nparam disableAllDiskWriteCacheFlushing bool\\nparam installLatestWinGet bool\\n\\n@description('This will create a separate volume, format it with Dev Drive and place all repos and caches to that volume. Requires October 2023 patched Win11-22H2 or Win11-23H2 base image.')\\nparam createDevDrive bool\\n\\nparam devDriveOptions object = {}\\n\\nvar updateWindowsArtifact = {\\n  name: 'WindowsUpdate'\\n}\\n\\nvar defaultDevDriveOptions = {\\n  // Whether to enable the PrjFlt minifilter on the Dev Drive. This slows down the\\n  // Dev Drive but allows enlisting repos that use GVFS/VFSForGit.\\n  EnableGVFS: false\\n\\n  // Whether to enable filesystem minifilters that support mounting Windows containers\\n  // on the Dev Drive. This slows down the Dev Drive.\\n  EnableContainers: false\\n}\\n// Fill in missing Dev Drive config values with defaults.\\nvar devDriveWithDefaults = union(defaultDevDriveOptions, devDriveOptions)\\n\\nvar optionalSetDevDriveConfiguration = createDevDrive && (devDriveWithDefaults.EnableGVFS || devDriveWithDefaults.EnableContainers)\\n  ? [\\n      {\\n        name: 'windows-set-DevDriveConfiguration'\\n        parameters: {\\n          EnableGVFS: devDriveWithDefaults.EnableGVFS\\n          EnableContainers: devDriveWithDefaults.EnableContainers\\n        }\\n      }\\n    ]\\n  : []\\n\\nvar optionalInstallLatestWinGet = installLatestWinGet\\n  ? [\\n      {\\n        name: 'windows-install-winget'\\n      }\\n    ]\\n  : []\\n\\nvar optionalConfigureWinGetForUser = installLatestWinGet\\n  ? [\\n      {\\n        Task: 'configure-winget'\\n      }\\n    ]\\n  : []\\n\\nvar runBeforeAll = concat(\\n  [\\n    {\\n      // Resize drive C: to the maximum possible size\\n      name: 'windows-expandOSdisk'\\n    }\\n  ],\\n\\n  [\\n    // Fetch all updates before pulling anything else on the box. If needed, the VM will be automatically restarted after updates are installed.\\n    updateWindowsArtifact\\n  ],\\n\\n  optionalSetDevDriveConfiguration,\\n\\n  optionalInstallLatestWinGet,\\n\\n  [\\n    {\\n      // Disable 'Reserved Storage' Windows feature that intends to help 'Windows Update' to reserve enough disk space and improve its reliability.\\n      // This operation showed to cost about 15-20 minutes of disk I/O in some cases.\\n      // Given that DevBox is supposed to be used as an ephemeral VM, it is OK to disable this feature and get VM creation time down\\n      name: 'windows-disable-reservedstorage'\\n    }\\n    {\\n      // Enable and disable setting in Windows update.\\n      name: 'windows-update-settings'\\n    }\\n    {\\n      // Enable curl retries for the image build user to improve artifact install resilience. File is written to C:\\\\Users\\\\packer\\\\.curlrc and cleaned up automatically during sysprep.\\n      Name: 'windows-powershell-invokecommand'\\n      Parameters: {\\n        Script: 'Set-Content -Path `$env:USERPROFILE\\\\\\\\.curlrc -Value `\\\"--retry 7`\\\"; Get-Content -Path `$env:USERPROFILE\\\\\\\\.curlrc'\\n      }\\n    }\\n    {\\n      Name: 'windows-enable-long-paths'\\n    }\\n    {\\n      // Reboot after long path registry update\\n      Name: 'WindowsRestart'\\n    }\\n  ]\\n)\\n\\nvar optionalCreateDevDrive = createDevDrive\\n  ? [\\n      {\\n        // Create Dev Drive volume before installing anything else.\\n        Name: 'windows-create-ReFS'\\n        Parameters: {\\n          DevBoxRefsDrive: substring(sourcesDriveRoot, 0, 1)\\n          OsDriveMinSizeGB: osDriveMinSizeGB\\n          IsDevDrive: createDevDrive\\n        }\\n      }\\n    ]\\n  : []\\n\\nvar optionalDisableAllDiskWriteCacheFlushing = disableAllDiskWriteCacheFlushing\\n  ? [\\n      {\\n        Name: 'windows-disable-write-cache-flushing'\\n      }\\n    ]\\n  : []\\n\\nvar runInstalls = [\\n  {\\n    // Install git and configure 'manager-core' as system credential.helper\\n    name: 'windows-gitinstall'\\n    parameters: {\\n      SetCredHelper: 'true'\\n    }\\n  }\\n  {\\n    // Consumed by many tools, e.g. MSBuild, dotnet, and NuGet (https://github.com/Microsoft/artifacts-credprovider)\\n    name: 'windows-install-artifacts-credprovider'\\n    parameters: {\\n      addNetFx: 'true'\\n      installNet6: credentialProvider.installNet6\\n      version: credentialProvider.version\\n      optionalCopyNugetPluginsRoot: toolsRoot\\n    }\\n  }\\n]\\n\\nvar optionalDefenderExclusions = defenderExclusions\\n  ? [\\n      {\\n        name: 'windows-defender-exclusions'\\n        parameters: {\\n          ExclusionPaths: defenderExclusionPathList\\n        }\\n      }\\n    ]\\n  : []\\n\\nvar userDefenderTaskId = uniqueString(reduce(userDefenderExclusions, '', (cur, next) => '${cur}${next}'))\\nvar userDefenderLogonTasks = empty(userDefenderExclusions)\\n  ? []\\n  : [\\n      {\\n        Task: 'add-defender-exclusions'\\n        UniqueID: 'defender-exclusions-${userDefenderTaskId}'\\n        Parameters: {\\n          DirsToExclude: userDefenderExclusions\\n        }\\n      }\\n    ]\\n\\n// While creating Dev Drive, unallocated partition may get created if the image disk size is smaller\\n// than the storage assigned for Dev Box definition that is using the image.\\n// On first user logon this script will assign any unallocated space to last partition D on that VM.\\nvar codeDriveUserLogonTasksAssignUnallocatedSpaceAndReassignDriveLetter = createDevDrive\\n  ? [\\n      {\\n        Task: 'assign-unallocated-space'\\n        Parameters: {\\n          DriveLetter: 'D'\\n        }\\n      }\\n      {\\n        // CloudPC will reassign the Dev Drive code drive to D:, remap to the drive letter\\n        // originally used for repo enlistments to preserve build caches and build outputs\\n        // that rely on full paths.\\n        Task: 'remap-code-drive'\\n        Parameters: {\\n          ToDriveLetter: substring(sourcesDriveRoot, 0, 1)\\n        }\\n      }\\n    ]\\n  : []\\n\\nvar addUserProfileDefenderExclusionsTask = defenderExclusions\\n  ? [\\n      {\\n        Task: 'add-defender-exclusions'\\n        UniqueID: 'defender-exclusions-msbuild'\\n        Parameters: {\\n          DirsToExclude: [\\n            '%TEMP%\\\\\\\\NuGetScratch'\\n            '%TEMP%\\\\\\\\MSBuildTemp%USERNAME%'\\n          ]\\n        }\\n      }\\n    ]\\n  : []\\n\\nvar firstLogonTasks = concat(\\n  // Make code drive ready first to allow other steps to access it if needed\\n  codeDriveUserLogonTasksAssignUnallocatedSpaceAndReassignDriveLetter,\\n  userDefenderLogonTasks,\\n  addUserProfileDefenderExclusionsTask,\\n  optionalConfigureWinGetForUser\\n)\\n\\n// Desktop sync is disabled by default because when multiple Dev Box VMs are used, OneDrive synchronizes its content b/w all of them.\\n// This can cause having multiple copies of a shortcut or a file on desktop when they are created by an app installer or build env init scripts.\\nvar disableOneDriveDesktopSync = [{ name: 'windows-configure-onedrive-sync' }]\\n\\nvar runAfterAll = concat(\\n  [\\n    {\\n      // Write image build information to file on the VM desktop and json in .tools folder\\n      name: 'windows-imagelog'\\n      Parameters: {\\n        BicepInfo: base64(string(allParamsForLogging))\\n      }\\n    }\\n    {\\n      // Enable Virtual Machine Platform feature.\\n      // Script suppresses reboot which is ok as this will be done later in the image capture anyway.\\n      // This change should reduce VM provisioning time on the image by 3 mins on avg and upto 10 mins at P99\\n      // by reducing the need to enable the feature and reboot.\\n      name: 'windows-enable-optionalfeatures'\\n      Parameters: {\\n        FeatureName: 'VirtualMachinePlatform'\\n      }\\n    }\\n    {\\n      name: 'windows-configure-user-tasks'\\n      parameters: {\\n        FirstLogonTasksBase64: base64(string(firstLogonTasks))\\n      }\\n    }\\n    // Fetch any updates that could be available for the installed software. If needed, the VM will be automatically restarted after updates are installed.\\n    updateWindowsArtifact\\n  ],\\n  // Run as late as possible in case there were any OneDrive updates installed that could have re-enabled OneDrive Desktop Sync\\n  disableOneDriveDesktopSync,\\n  [\\n    {\\n      Name: 'WindowsRestart'\\n    }\\n    {\\n      name: 'windows-prepare-for-sysprep'\\n    }\\n  ]\\n)\\n\\noutput artifacts object = {\\n  runBeforeAll: runBeforeAll\\n  optionalCreateDevDrive: optionalCreateDevDrive\\n  optionalDisableAllDiskWriteCacheFlushing: optionalDisableAllDiskWriteCacheFlushing\\n  runInstalls: runInstalls\\n  optionalDefenderExclusions: optionalDefenderExclusions\\n  runAfterAll: runAfterAll\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"toolsRoot\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sourcesDriveRoot\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"defenderExclusions\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"userDefenderExclusions\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"defenderExclusionPathList\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"allParamsForLogging\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"credentialProvider\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"osDriveMinSizeGB\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"disableAllDiskWriteCacheFlushing\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"installLatestWinGet\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"createDevDrive\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"devDriveOptions\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param ntfsDriveRoot string\\nparam sourcesDriveRoot string\\nparam sourcesDirWithoutDriveLetter string\\nparam shortcutDriveRoot string\\nparam toolsRoot string\\nparam credentialProvider object\\nparam repos array = []\\n\\nvar reposWithDefaults = [\\n  for repo in repos: {\\n    Url: repo.Url\\n\\n    // If SourceControl is not specified, default to git\\n    SourceControl: repo.?SourceControl ?? 'git'\\n\\n    Branch: repo.?Branch ?? ''\\n    Commit: repo.?Commit ?? ''\\n    Kind: repo.?Kind ?? 'Data'\\n    RestoreScriptEnvVars: repo.?RestoreScriptEnvVars ?? {}\\n    RestoreScript: repo.?RestoreScript ?? ''\\n    AdditionalRepoFeeds: repo.?AdditionalRepoFeeds ?? []\\n    Build: repo.?Build ?? {}\\n    HistoryDepth: repo.?HistoryDepth ?? 0\\n    DesktopShortcutEnableStr: contains(repo, 'DesktopShortcutEnable') ? '${repo.DesktopShortcutEnable}' : ''\\n    DesktopShortcutScriptPath: repo.?DesktopShortcutScriptPath ?? ''\\n    DesktopShortcutRunAsAdmin: repo.?DesktopShortcutRunAsAdmin ?? false\\n    DesktopShortcutIconPath: repo.?DesktopShortcutIconPath ?? ''\\n    DesktopShortcutName: repo.?DesktopShortcutName ?? ''\\n    EnableGitCommitGraph: repo.?EnableGitCommitGraph ?? true\\n    SparseCheckoutFolders: repo.?SparseCheckoutFolders ?? []\\n    RecurseSubmodules: repo.?RecurseSubmodules ?? false\\n\\n    // Allow controlling whether to place the repo on a separate DevDrive, if it is created for the image. \\n    AvoidDevDrive: repo.?AvoidDevDrive ?? false\\n\\n    // Allow selecting custom directory for the repo root. Useful when hitting max path issues with the default root path.\\n    RepoRootWithoutDriveLetter: repo.?RepoRootWithoutDriveLetter ?? ''\\n\\n    // Only used with Custom repo kind\\n    CustomScript: repo.?CustomScript ?? ''\\n    PackagesFeed: repo.?PackagesFeed ?? ''\\n  }\\n]\\n\\nmodule modules 'artifacts-repo.bicep' = [\\n  for (repo, i) in reposWithDefaults: {\\n    name: 'artifacts-repo-${i}-${uniqueString(deployment().name, resourceGroup().name)}'\\n    params: {\\n      sourcesDriveRoot: sourcesDriveRoot\\n      sourcesDirWithoutDriveLetter: sourcesDirWithoutDriveLetter\\n      shortcutDriveRoot: shortcutDriveRoot\\n\\n      ntfsDriveRoot: ntfsDriveRoot\\n      avoidDevDrive: repo.AvoidDevDrive\\n      repoRootWithoutDriveLetter: repo.RepoRootWithoutDriveLetter\\n\\n      repoUrl: repo.Url\\n      repoSourceControl: repo.SourceControl\\n      repoBranch: repo.Branch\\n      repoCommit: repo.Commit\\n      repoKind: repo.Kind\\n      customScript: repo.CustomScript\\n      restoreScriptEnvVars: repo.RestoreScriptEnvVars\\n      restoreScript: repo.RestoreScript\\n      packagesFeed: repo.PackagesFeed\\n      additionalRepoFeeds: repo.AdditionalRepoFeeds\\n      build: repo.Build\\n      historyDepth: repo.HistoryDepth\\n      // By default, enable desktop shortcut for all repos except Data\\n      desktopShortcutEnable: empty(repo.DesktopShortcutEnableStr)\\n        ? repo.Kind != 'Data'\\n        : bool(repo.DesktopShortcutEnableStr)\\n      desktopShortcutScriptPath: repo.DesktopShortcutScriptPath\\n      desktopShortcutRunAsAdmin: repo.DesktopShortcutRunAsAdmin\\n      desktopShortcutIconPath: repo.DesktopShortcutIconPath\\n      desktopShortcutName: repo.DesktopShortcutName\\n      enableGitCommitGraph: repo.EnableGitCommitGraph\\n      recurseSubmodules: repo.RecurseSubmodules\\n      sparseCheckoutFolders: repo.SparseCheckoutFolders\\n    }\\n  }\\n]\\n\\noutput repoSetupSourcesObjects array = [\\n  for i in range(0, length(repos)): {\\n    Artifacts: modules[i].outputs.setupSources\\n  }\\n]\\n\\noutput repoWarmupObjects array = [\\n  for i in range(0, length(repos)): {\\n    Artifacts: modules[i].outputs.warmup\\n  }\\n]\\n\\nmodule packagesConfig 'artifacts-packages-config.bicep' = {\\n  name: 'packagesConfig-${uniqueString(deployment().name, resourceGroup().name)}'\\n  params: {\\n    toolsRoot: toolsRoot\\n    credentialProvider: credentialProvider\\n  }\\n}\\n\\noutput commonArtifacts array = packagesConfig.outputs.setStableEnvVars\\n\\nvar avoidDevDriveRepos = filter(reposWithDefaults, repo => repo.AvoidDevDrive == true)\\noutput anyAvoidDevDriveRepos bool = (length(avoidDevDriveRepos) > 0)\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"ntfsDriveRoot\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sourcesDriveRoot\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sourcesDirWithoutDriveLetter\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"shortcutDriveRoot\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"toolsRoot\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"credentialProvider\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"repos\\\": {\\n      \\\"value\\\": \\\"[]\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of Dev Center e.g. dc-devbox-test')\\nparam devcenterName string = 'dc-devbox-test'\\n\\n@description('The name of Network Connection e.g. con-devbox-test')\\nparam networkConnectionName string = 'con-devbox-test'\\n\\n@description('The name of Dev Center project e.g. dcprj-devbox-test')\\nparam projectName string = 'dcprj-devbox-test'\\n\\n@description('The subnet resource id if the user wants to use existing subnet')\\nparam existingSubnetId string = ''\\n\\n@description('Primary location for all resources e.g. eastus')\\nparam location string = resourceGroup().location\\n\\n@description('The name of the Virtual Network e.g. vnet-dcprj-devbox-test-eastus')\\nparam vnetName string = 'vnet-${projectName}-${location}'\\n\\n@description('the subnet name of Dev Box e.g. default')\\nparam subnetName string = 'default'\\n\\n@description('The vnet address prefixes of Dev Box e.g. 10.4.0.0/16')\\nparam vnetAddressPrefixes string = '10.4.0.0/16'\\n\\n@description('The subnet address prefixes of Dev Box e.g. 10.4.0.0/24')\\nparam subnetAddressPrefixes string = '10.4.0.0/24'\\n\\n@description('The user or group id that will be granted to Devcenter Dev Box User role')\\nparam principalId string = ''\\n\\n@description('The type of principal id: User, Group or ServicePrincipal')\\nparam principalType string = 'User'\\n\\nvar abbrs = loadJsonContent('./abbreviations.json')\\nvar resourceToken = toLower(uniqueString(resourceGroup().id, location))\\nvar ncName = !empty(networkConnectionName) ? networkConnectionName : '${abbrs.networkConnections}${resourceToken}'\\n\\nmodule vnet 'modules/vnet.bicep' = if(empty(existingSubnetId)) {\\n  name: 'vnet'\\n  params: {\\n    location: location\\n    vnetAddressPrefixes: vnetAddressPrefixes\\n    vnetName: !empty(vnetName) ? vnetName : '${abbrs.networkVirtualNetworks}${resourceToken}'\\n    subnetAddressPrefixes: subnetAddressPrefixes\\n    subnetName: !empty(subnetName) ? subnetName : '${abbrs.networkVirtualNetworksSubnets}${resourceToken}'\\n  }\\n}\\n\\nmodule devcenter 'modules/devcenter.bicep' = {\\n  name: 'devcenter'\\n  params: {\\n    location: location\\n    devcenterName: !empty(devcenterName) ? devcenterName : '${abbrs.devcenter}${resourceToken}'\\n    subnetId: !empty(existingSubnetId) ? existingSubnetId : vnet.outputs.subnetId\\n    networkConnectionName: ncName\\n    projectName: !empty(projectName) ? projectName : '${abbrs.devcenterProject}${resourceToken}'\\n    networkingResourceGroupName: '${abbrs.devcenterNetworkingResourceGroup}${ncName}-${location}'\\n    principalId: principalId\\n    principalType: principalType\\n  }\\n}\\n\\noutput vnetName string = empty(existingSubnetId) ? vnet.outputs.vnetName : ''\\noutput subnetName string = empty(existingSubnetId) ? vnet.outputs.subnetName : ''\\n\\noutput devcetnerName string = devcenter.outputs.devcenterName\\noutput projectName string = devcenter.outputs.projectName\\noutput networkConnectionName string = devcenter.outputs.networkConnectionName\\noutput definitions array = devcenter.outputs.definitions\\noutput pools array = devcenter.outputs.poolNames\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"devcenterName\\\": {\\n      \\\"value\\\": \\\"dc-devbox-test\\\"\\n    },\\n    \\\"networkConnectionName\\\": {\\n      \\\"value\\\": \\\"con-devbox-test\\\"\\n    },\\n    \\\"projectName\\\": {\\n      \\\"value\\\": \\\"dcprj-devbox-test\\\"\\n    },\\n    \\\"existingSubnetId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vnetName\\\": {\\n      \\\"value\\\": \\\"vnet-${projectName}-${location}\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"default\\\"\\n    },\\n    \\\"vnetAddressPrefixes\\\": {\\n      \\\"value\\\": \\\"10.4.0.0/16\\\"\\n    },\\n    \\\"subnetAddressPrefixes\\\": {\\n      \\\"value\\\": \\\"10.4.0.0/24\\\"\\n    },\\n    \\\"principalId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"principalType\\\": {\\n      \\\"value\\\": \\\"User\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the Virtual Network')\\nparam vnetName string\\n\\n@description('the app subnet name of Dev Box')\\nparam subnetName string\\n\\n@description('The address prefixes of the vnet')\\nparam vnetAddressPrefixes string \\n\\n@description('The subnet address prefixes for Dev Box')\\nparam subnetAddressPrefixes string\\n\\n@description('The location of the resource')\\nparam location string\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-11-01' = {\\n  name: vnetName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetAddressPrefixes\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetAddressPrefixes\\n        }\\n      }\\n    ]\\n  }\\n\\n  resource subnet 'subnets' existing = {\\n    name: subnetName\\n  }\\n}\\n\\noutput vnetName string = virtualNetwork.name\\noutput subnetName string = virtualNetwork::subnet.name\\noutput subnetId string = virtualNetwork::subnet.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vnetName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vnetAddressPrefixes\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetAddressPrefixes\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The location into which the Azure Storage resources should be deployed.')\\n@allowed([\\n  'westcentralus'\\n  'westus2'\\n  'northeurope'\\n  'australiaeast'\\n  'westeurope'\\n  'eastus'\\n  'southcentralus'\\n  'southeastasia'\\n  'uksouth'\\n  'eastus2'\\n])\\nparam location string\\n\\n@description('Azure Digital Twins instance name')\\nparam digitalTwinsInstanceName string = 'digitaltwins-${uniqueString(resourceGroup().id)}'\\n\\n@description('Azure function name')\\n@maxLength(16)\\nparam functionName string = uniqueString(resourceGroup().id)\\n\\n@description('Virtual Network name')\\nparam virtualNetworkName string = 'vnet-${uniqueString(resourceGroup().id)}'\\n\\n@description('Virtual Network Address Prefix')\\nparam vnetAddressPrefix string = '10.0.0.0/22'\\n\\n@description('Function Subnet Address Prefix')\\nparam functionAddressPrefix string = '10.0.0.0/24'\\n\\n@description('Private Link Subnet Address Prefix')\\nparam privateLinkAddressPrefix string = '10.0.1.0/24'\\n\\nvar privateLinkSubnetName = 'PrivateLinkSubnet'\\nvar functionSubnetName = 'FunctionSubnet'\\n\\nmodule digitaltwins 'modules/digitaltwins.bicep' = {\\n  name: 'digitaltwins'\\n  params: {\\n    digitalTwinsInstanceName: digitalTwinsInstanceName\\n    digitalTwinsInstanceLocation: location\\n  }\\n}\\n\\nmodule network 'modules/network.bicep' = {\\n  name: 'network'\\n  params: {\\n    virtualNetworkName: virtualNetworkName\\n    virtualNetworkLocation: location\\n    virtualNetworkAddressPrefix: vnetAddressPrefix\\n    functionSubnetName: functionSubnetName\\n    functionSubnetPrefix: functionAddressPrefix\\n    privateLinkSubnetName: privateLinkSubnetName\\n    privateLinkSubnetPrefix: privateLinkAddressPrefix\\n  }\\n}\\n\\nmodule privatelink 'modules/privatelink.bicep' = {\\n  name: 'privatelink'\\n  params: {\\n    privateLinkName: 'PrivateLinkToDigitalTwins'\\n    location: location\\n    privateLinkServiceResourceId: digitaltwins.outputs.id\\n    groupId: 'API'\\n    privateLinkSubnetName: privateLinkSubnetName\\n    privateDnsZoneName: 'privatelink.digitaltwins.azure.net'\\n    virtualNetworkResourceName: virtualNetworkName\\n  }\\n}\\n\\nmodule function 'modules/function.bicep' = {\\n  name: 'function'\\n  params: {\\n    location: location\\n    virtualNetworkName: virtualNetworkName\\n    storageAccountName: '${uniqueString(resourceGroup().id)}stg'\\n    functionAppName: functionName\\n    serverFarmName: functionName\\n    functionsSubnetName: functionSubnetName\\n    applicationInsightsName: '${functionName}ai'\\n    digitalTwinsEndpoint: digitaltwins.outputs.endpoint\\n  }\\n}\\n\\nmodule roleassignment 'modules/roleassignment.bicep' = {\\n  name: 'roleassignment'\\n  params: {\\n    principalId: function.outputs.functionIdentityPrincipalId\\n    roleId: 'bcd981a7-7f74-457b-83e1-cceb9e632ffe'\\n    digitalTwinsInstanceName: digitalTwinsInstanceName\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"digitalTwinsInstanceName\\\": {\\n      \\\"value\\\": \\\"digitaltwins-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"functionName\\\": {\\n      \\\"value\\\": \\\"uniqueString(resourceGroup().id)\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"vnet-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"vnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/22\\\"\\n    },\\n    \\\"functionAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/24\\\"\\n    },\\n    \\\"privateLinkAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.1.0/24\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name given to Azure Data Explorer cluster resource')\\nparam adxClusterName string\\n\\n@description('Name given to database')\\nparam databaseName string\\n\\n@description('Azure Data Explorer cluster SKU option')\\nparam clusterPlan string\\n\\n@description('Azure Data Explorer cluster capacity')\\nparam clusterCapacity int\\n\\n@description('Azure Data Explorer cluster tier')\\nparam clusterTier string\\n\\n@description('The time to keep database data in cache')\\nparam hotCachePeriod string\\n\\n@description('The time data is kept in database')\\nparam softDeletePeriod string\\n\\n@description('Location of to be created resources')\\nparam location string\\n\\n// Creates Azure Data Explorer cluster\\nresource adxCluster 'Microsoft.Kusto/Clusters@2022-11-11' = {\\n  name: adxClusterName\\n  location: location\\n  sku: {\\n    capacity: clusterCapacity\\n    name: clusterPlan\\n    tier: clusterTier\\n  }\\n  identity: {\\n    type: 'None'\\n  }\\n  properties: {\\n    enableAutoStop: false\\n  }\\n}\\n\\n// Creates database under the Azure Data Explorer cluster\\nresource database 'Microsoft.Kusto/clusters/databases@2022-11-11' = {\\n  name: '${adxCluster.name}/${databaseName}'\\n  location: location\\n  kind: 'ReadWrite'\\n  properties: {\\n    hotCachePeriod: hotCachePeriod\\n    softDeletePeriod: softDeletePeriod\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"adxClusterName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"databaseName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"clusterPlan\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"clusterCapacity\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"clusterTier\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"hotCachePeriod\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"softDeletePeriod\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of your CosmosDB account')\\nparam name string = uniqueString('cosmosdb', resourceGroup().id)\\n\\n@description('Location for your CosmosDB account')\\nparam location string = resourceGroup().location\\n\\n@description('CosmosDB account tier')\\nparam tier string = 'Standard'\\n\\nresource dbaccount 'Microsoft.DocumentDB/databaseAccounts@2023-04-15' = {\\n  name: name\\n  location: location\\n  properties: {\\n    locations: [\\n      {\\n        locationName: location\\n      }\\n    ]\\n    databaseAccountOfferType: tier\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"name\\\": {\\n      \\\"value\\\": \\\"uniqueString('cosmosdb', resourceGroup().id)\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"tier\\\": {\\n      \\\"value\\\": \\\"Standard\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Virtual network name')\\nparam virtualNetworkName string\\n\\n@description('Cosmos DB account name (must contain only lowercase letters, digits, and hyphens)')\\n@maxLength(44)\\n@minLength(3)\\nparam accountName string\\n\\n@description('Enable public network traffic to access the account; if set to Disabled, public network traffic will be blocked even before the private endpoint is created')\\n@allowed([\\n  'Enabled'\\n  'Disabled'\\n])\\nparam publicNetworkAccess string = 'Enabled'\\n\\n@description('Private endpoint name')\\nparam privateEndpointName string\\n\\nvar subnetName = 'default'\\nvar locations = [\\n  {\\n    locationName: location\\n    failoverPriority: 0\\n    isZoneRedundant: false\\n  }\\n]\\n\\nresource virtualNetwork 'Microsoft.Network/VirtualNetworks@2021-08-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        '172.20.0.0/16'\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: '172.20.0.0/24'\\n          privateEndpointNetworkPolicies: 'Disabled'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource databaseAccount 'Microsoft.DocumentDB/databaseAccounts@2022-05-15' = {\\n  name: accountName\\n  location: location\\n  kind: 'GlobalDocumentDB'\\n  properties: {\\n    consistencyPolicy: {\\n      defaultConsistencyLevel: 'Session'\\n    }\\n    locations: locations\\n    databaseAccountOfferType: 'Standard'\\n    enableAutomaticFailover: false\\n    enableMultipleWriteLocations: false\\n    publicNetworkAccess: publicNetworkAccess\\n  }\\n}\\n\\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2021-08-01' = {\\n  name: privateEndpointName\\n  location: location\\n  properties: {\\n    subnet: {\\n      id: resourceId('Microsoft.Network/VirtualNetworks/subnets', virtualNetworkName, subnetName)\\n    }\\n    privateLinkServiceConnections: [\\n      {\\n        name: 'MyConnection'\\n        properties: {\\n          privateLinkServiceId: databaseAccount.id\\n          groupIds: [\\n            'Sql'\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"accountName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"publicNetworkAccess\\\": {\\n      \\\"value\\\": \\\"Enabled\\\"\\n    },\\n    \\\"privateEndpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Cosmos DB account name, max length 44 characters')\\nparam accountName string = 'sql-${toLower(uniqueString(resourceGroup().id))}'\\n\\n@description('Location for the Cosmos DB account.')\\nparam location string = resourceGroup().location\\n\\n@allowed([\\n  'Eventual'\\n  'ConsistentPrefix'\\n  'Session'\\n  'BoundedStaleness'\\n  'Strong'\\n])\\n@description('The default consistency level of the Cosmos DB account.')\\nparam defaultConsistencyLevel string = 'Session'\\n\\n@minValue(10)\\n@maxValue(2147483647)\\n@description('Max stale requests. Required for BoundedStaleness. Valid ranges, Single Region: 10 to 2147483647. Multi Region: 100000 to 2147483647.')\\nparam maxStalenessPrefix int = 100000\\n\\n@minValue(5)\\n@maxValue(86400)\\n@description('Max lag time (minutes). Required for BoundedStaleness. Valid ranges, Single Region: 5 to 84600. Multi Region: 300 to 86400.')\\nparam maxIntervalInSeconds int = 300\\n\\nvar consistencyPolicy = {\\n  Eventual: {\\n    defaultConsistencyLevel: 'Eventual'\\n  }\\n  ConsistentPrefix: {\\n    defaultConsistencyLevel: 'ConsistentPrefix'\\n  }\\n  Session: {\\n    defaultConsistencyLevel: 'Session'\\n  }\\n  BoundedStaleness: {\\n    defaultConsistencyLevel: 'BoundedStaleness'\\n    maxStalenessPrefix: maxStalenessPrefix\\n    maxIntervalInSeconds: maxIntervalInSeconds\\n  }\\n  Strong: {\\n    defaultConsistencyLevel: 'Strong'\\n  }\\n}\\n\\nresource account 'Microsoft.DocumentDB/databaseAccounts@2022-05-15' = {\\n  name: accountName\\n  location: location\\n  kind: 'GlobalDocumentDB'\\n  properties: {\\n    databaseAccountOfferType: 'Standard'\\n    consistencyPolicy: consistencyPolicy[defaultConsistencyLevel]\\n    locations: [\\n      {\\n        locationName: location\\n        failoverPriority: 0\\n        isZoneRedundant: false\\n      }\\n    ]\\n    capabilities: [\\n      {\\n        name: 'EnableServerless'\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"accountName\\\": {\\n      \\\"value\\\": \\\"sql-${toLower(uniqueString(resourceGroup().id))}\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"defaultConsistencyLevel\\\": {\\n      \\\"value\\\": \\\"Session\\\"\\n    },\\n    \\\"maxStalenessPrefix\\\": {\\n      \\\"value\\\": 100000\\n    },\\n    \\\"maxIntervalInSeconds\\\": {\\n      \\\"value\\\": 300\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The location into which the Azure Functions resources should be deployed.')\\nparam location string = resourceGroup().location\\n\\n@description('The name of the Azure Functions application to create. This must be globally unique.')\\nparam appName string = 'fn-${uniqueString(resourceGroup().id)}'\\n\\n@description('The runtime to deploy onto the Azure Functions application.')\\nparam functionRuntime string = 'dotnet'\\n\\n@description('The name of the SKU to use when creating the Azure Functions plan. Common SKUs include Y1 (consumption) and EP1, EP2, and EP3 (premium).')\\nparam functionPlanSkuName string = 'Y1'\\n\\nvar appServicePlanName = 'FunctionPlan'\\nvar appInsightsName = 'AppInsights'\\nvar storageAccountName = 'fnstor${uniqueString(resourceGroup().id, appName)}'\\nvar functionPlanKind = (functionPlanSkuName == 'Y1') ? 'functionapp' : 'elastic'\\nvar functionName = 'MyHttpTriggeredFunction'\\nvar contributorRoleDefinitionId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c') // as per https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#:~:text=b24988ac-6180-42a0-ab88-20f7382dd24c\\nvar managedIdentityName = 'EventGridFunctionEnabler'\\nvar deploymentScriptName = 'GetFunctionAppEventGridKey'\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-09-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: 'Standard_LRS'\\n  }\\n  kind: 'StorageV2'\\n  properties: {\\n    supportsHttpsTrafficOnly: true\\n    encryption: {\\n      services: {\\n        file: {\\n          keyType: 'Account'\\n          enabled: true\\n        }\\n        blob: {\\n          keyType: 'Account'\\n          enabled: true\\n        }\\n      }\\n      keySource: 'Microsoft.Storage'\\n    }\\n    accessTier: 'Hot'\\n  }\\n}\\n\\nresource appInsights 'Microsoft.Insights/components@2020-02-02' = {\\n  name: appInsightsName\\n  location: location\\n  kind: 'web'\\n  properties: {\\n    Application_Type: 'web'\\n    publicNetworkAccessForIngestion: 'Enabled'\\n    publicNetworkAccessForQuery: 'Enabled'\\n  }\\n}\\n\\nresource functionPlan 'Microsoft.Web/serverFarms@2020-06-01' = {\\n  name: appServicePlanName\\n  location: location\\n  kind: functionPlanKind\\n  sku: {\\n    name: functionPlanSkuName\\n  }\\n  properties: {}\\n}\\n\\nresource functionApp 'Microsoft.Web/sites@2020-06-01' = {\\n  name: appName\\n  location: location\\n  kind: 'functionapp'\\n  properties: {\\n    serverFarmId: functionPlan.id\\n    siteConfig: {\\n      appSettings: [\\n        {\\n          name: 'AzureWebJobsStorage'\\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccount.name};EndpointSuffix=${environment().suffixes.storage};AccountKey=${listKeys(storageAccount.id, storageAccount.apiVersion).keys[0].value}'\\n        }\\n        {\\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccount.name};EndpointSuffix=${environment().suffixes.storage};AccountKey=${listKeys(storageAccount.id, storageAccount.apiVersion).keys[0].value}'\\n        }\\n        {\\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\\n          value: appInsights.properties.InstrumentationKey\\n        }\\n        {\\n          name: 'APPLICATIONINSIGHTS_CONNECTION_STRING'\\n          value: 'InstrumentationKey=${appInsights.properties.InstrumentationKey}'\\n        }\\n        {\\n          name: 'FUNCTIONS_WORKER_RUNTIME'\\n          value: functionRuntime\\n        }\\n        {\\n          name: 'FUNCTIONS_EXTENSION_VERSION'\\n          value: '~3'\\n        }\\n        {\\n          name: 'AzureWebJobsDisableHomepage' // This hides the default Azure Functions homepage, which means that Front Door health probe traffic is significantly reduced.\\n          value: 'true'\\n        }\\n      ]\\n    }\\n    httpsOnly: true\\n  }\\n}\\n\\nresource function 'Microsoft.Web/sites/functions@2020-06-01' = {\\n  name: '${functionApp.name}/${functionName}'\\n  properties: {\\n    config: {\\n      disabled: false\\n      bindings: [\\n        {\\n          name: 'eventGridEvent'\\n          type: 'eventGridTrigger'\\n          direction: 'in'\\n        }\\n      ]\\n    }\\n    files: {\\n      'run.csx': '''\\n      #r \\\"Microsoft.Azure.EventGrid\\\"\\n      using Microsoft.Azure.EventGrid.Models;\\n      using Microsoft.Extensions.Logging;\\n\\n      public static void Run(EventGridEvent eventGridEvent, ILogger log)\\n      {\\n          log.LogInformation(eventGridEvent.Data.ToString());\\n      }\\n      '''\\n    }\\n  }\\n}\\n\\nresource managedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\\n  name: managedIdentityName\\n  location: location\\n}\\n\\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2020-04-01-preview' = {\\n  scope: functionApp\\n  name: guid(resourceGroup().id, managedIdentity.id, contributorRoleDefinitionId)\\n  properties: {\\n    roleDefinitionId: contributorRoleDefinitionId\\n    principalId: managedIdentity.properties.principalId\\n    principalType: 'ServicePrincipal'\\n  }\\n}\\n\\nresource deploymentScript 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\\n  name: deploymentScriptName\\n  location: location\\n  kind: 'AzurePowerShell'\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${managedIdentity.id}': {}\\n    }\\n  }\\n  dependsOn: [\\n    roleAssignment\\n  ]\\n  properties: {\\n    azPowerShellVersion: '5.4'\\n    scriptContent: '''\\n    param([string] $FunctionHostResourceId)\\n\\n    $ErrorActionPreference = 'Stop'\\n\\n    # Try to get the key. If this fails, retry up to 5 times.\\n    $loopAttempts = 0\\n    while ($loopAttempts -lt 5)\\n    {\\n      $listKeysOutput = Invoke-AzResourceAction -ResourceId $FunctionHostResourceId -Action listKeys -ApiVersion 2020-06-01 -Force\\n      $eventGridKey = $listKeysOutput.systemKeys.eventgrid_extension\\n      if ($null -ne $eventGridKey)\\n      {\\n        break\\n      }\\n\\n      $loopAttempts += 1\\n      Write-Output 'Event Grid key is not included in response. Sleeping for 5 seconds.'\\n      Start-Sleep -Seconds 5\\n    }\\n\\n    if ($null -eq $eventGridKey)\\n    {\\n      Write-Error 'Event Grid key could not be obtained.'\\n      return 1\\n    }\\n\\n    # Propagate to the deployment script output.\\n    $DeploymentScriptOutputs = @{}\\n    $DeploymentScriptOutputs['eventGridExtensionSystemKey'] = $eventGridKey\\n    '''\\n    cleanupPreference: 'OnSuccess'\\n    retentionInterval: 'PT4H'\\n    arguments: '-FunctionHostResourceId ${functionApp.id}/host/default'\\n  }\\n}\\n\\noutput functionUrl string = 'https://${functionApp.properties.defaultHostName}/runtime/webhooks/EventGrid?functionName=${functionName}&code=${deploymentScript.properties.outputs.eventGridExtensionSystemKey}'\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"appName\\\": {\\n      \\\"value\\\": \\\"fn-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"functionRuntime\\\": {\\n      \\\"value\\\": \\\"dotnet\\\"\\n    },\\n    \\\"functionPlanSkuName\\\": {\\n      \\\"value\\\": \\\"Y1\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies a project name that is used to generate the Event Hub name and the Namespace name.')\\nparam projectName string\\n\\n@description('Specifies the Azure location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Specifies the messaging tier for Event Hub Namespace.')\\n@allowed([\\n  'Basic'\\n  'Standard'\\n])\\nparam eventHubSku string = 'Standard'\\n\\nvar eventHubNamespaceName = '${projectName}ns'\\nvar eventHubName = projectName\\n\\nresource eventHubNamespace 'Microsoft.EventHub/namespaces@2021-11-01' = {\\n  name: eventHubNamespaceName\\n  location: location\\n  sku: {\\n    name: eventHubSku\\n    tier: eventHubSku\\n    capacity: 1\\n  }\\n  properties: {\\n    isAutoInflateEnabled: false\\n    maximumThroughputUnits: 0\\n  }\\n}\\n\\nresource eventHub 'Microsoft.EventHub/namespaces/eventhubs@2021-11-01' = {\\n  parent: eventHubNamespace\\n  name: eventHubName\\n  properties: {\\n    messageRetentionInDays: 7\\n    partitionCount: 1\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"projectName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"eventHubSku\\\": {\\n      \\\"value\\\": \\\"Standard\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the service.')\\nparam serviceName string\\n\\n@description('Location of Azure API for FHIR')\\n@allowed([\\n  'australiaeast'\\n  'eastus'\\n  'eastus2'\\n  'japaneast'\\n  'northcentralus'\\n  'northeurope'\\n  'southcentralus'\\n  'southeastasia'\\n  'uksouth'\\n  'ukwest'\\n  'westcentralus'\\n  'westeurope'\\n  'westus2'\\n])\\nparam location string\\n\\nresource service 'Microsoft.HealthcareApis/services@2021-11-01' = {\\n  name: serviceName\\n  location: location\\n  kind: 'fhir-R4'\\n  properties: {\\n    authenticationConfiguration: {\\n      audience: 'https://${serviceName}.azurehealthcareapis.com'\\n      authority: uri(environment().authentication.loginEndpoint, subscription().tenantId)\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"serviceName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Enter response time threshold in seconds.')\\n@minValue(1)\\n@maxValue(10000)\\nparam responseTimeThreshold int = 3\\n\\n@description('Name of the workspace where the data will be stored.')\\nparam workspaceName string = 'myWorkspace'\\n\\n@description('Name of the application insights resource.')\\nparam applicationInsightsName string = 'myApplicationInsights'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nvar responseAlertName = 'ResponseTime-${toLower(applicationInsightsName)}'\\n\\nresource workspace 'Microsoft.OperationalInsights/workspaces@2020-10-01' = {\\n  name: workspaceName\\n  location: location\\n  properties: {\\n    sku: {\\n      name: 'PerGB2018'\\n    }\\n  }\\n}\\n\\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02-preview' = {\\n  name: applicationInsightsName\\n  location: location\\n  kind: 'web'\\n  properties: {\\n    Application_Type: 'web'\\n    WorkspaceResourceId: workspace.id\\n  }\\n}\\n\\nresource metricAlert 'Microsoft.Insights/metricAlerts@2018-03-01' = {\\n  name: responseAlertName\\n  location: 'global'\\n  properties: {\\n    description: 'Response time alert'\\n    severity: 0\\n    enabled: true\\n    scopes: [\\n      applicationInsights.id\\n    ]\\n    evaluationFrequency: 'PT1M'\\n    windowSize: 'PT5M'\\n    criteria: {\\n      'odata.type': 'Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria'\\n      allOf: [\\n        {\\n          name: '1st criterion'\\n          metricName: 'requests/duration'\\n          operator: 'GreaterThan'\\n          threshold: responseTimeThreshold\\n          timeAggregation: 'Average'\\n          criterionType: 'StaticThresholdCriterion'\\n        }\\n      ]\\n    }\\n    actions: [\\n      {\\n        actionGroupId: emailActionGroup.id\\n      }\\n    ]\\n  }\\n}\\n\\nresource emailActionGroup 'microsoft.insights/actionGroups@2019-06-01' = {\\n  name: 'emailActionGroup'\\n  location: 'global'\\n  properties: {\\n    groupShortName: 'string'\\n    enabled: true\\n    emailReceivers: [\\n      {\\n        name: 'Example'\\n        emailAddress: 'example@test.com'\\n        useCommonAlertSchema: true\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"responseTimeThreshold\\\": {\\n      \\\"value\\\": 3\\n    },\\n    \\\"workspaceName\\\": {\\n      \\\"value\\\": \\\"myWorkspace\\\"\\n    },\\n    \\\"applicationInsightsName\\\": {\\n      \\\"value\\\": \\\"myApplicationInsights\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param roleAssignmentName string\\n\\nparam roleDefinitionId string\\n\\nparam principalId string\\n\\nparam keyVaultName string\\n\\nresource keyVault 'Microsoft.KeyVault/vaults@2021-10-01' existing = {\\n  name: keyVaultName\\n}\\n\\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2020-10-01-preview' = {\\n  name: roleAssignmentName\\n  scope: keyVault\\n  properties: {\\n    roleDefinitionId: roleDefinitionId\\n    principalId: principalId\\n    principalType: 'ServicePrincipal'\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"roleAssignmentName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"roleDefinitionId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"principalId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyVaultName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location of all resources to be deployed')\\nparam location string = resourceGroup().location\\n\\n@description('The base URI where artifacts required by this template are located')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access artifacts')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\nparam clusterName string = ''\\n\\nparam utcValue string = utcNow()\\n\\n@description('Public Helm Repo Name')\\nparam helmRepo string = 'azure-marketplace'\\n\\n@description('Public Helm Repo URL')\\nparam helmRepoURL string = 'https://marketplace.azurecr.io/helm/v1/repo'\\n\\n@description('Public Helm App')\\nparam helmApp string = 'azure-marketplace/wordpress'\\n\\n@description('Public Helm App Name')\\nparam helmAppName string = 'my-wordpress'\\n\\nvar installScriptUri = uri(_artifactsLocation, 'scripts/helm.sh${_artifactsLocationSasToken}')\\n\\nvar identityName       = 'scratch${uniqueString(resourceGroup().id)}'\\nvar roleDefinitionId   = resourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\\nvar roleAssignmentName = guid(roleDefinitionId, managedIdentity.id, resourceGroup().id)\\n\\nresource managedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\\n  name: identityName\\n  location: location\\n}\\n\\nresource identityRoleAssignDeployment 'Microsoft.Authorization/roleAssignments@2020-04-01-preview' = {\\n  scope: resourceGroup()\\n  name: roleAssignmentName\\n  properties: {\\n    roleDefinitionId: roleDefinitionId \\n    principalId     : managedIdentity.properties.principalId\\n    principalType   : 'ServicePrincipal'\\n  }\\n}\\n\\nresource customScript 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\\n  name: 'customScript'\\n  location: location\\n  dependsOn: [\\n    identityRoleAssignDeployment\\n  ]\\n  kind: 'AzureCLI'\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${managedIdentity.id}': {}\\n    }\\n  }\\n  properties: {\\n    forceUpdateTag: utcValue\\n    azCliVersion: '2.10.1'\\n    timeout: 'PT30M'\\n    environmentVariables: [\\n      {\\n        name: 'RESOURCEGROUP'\\n        secureValue: resourceGroup().name\\n      }\\n      {\\n        name: 'CLUSTER_NAME'\\n        secureValue: clusterName\\n      }\\n      {\\n        name: 'HELM_REPO'\\n        secureValue: helmRepo\\n      }\\n      {\\n        name: 'HELM_REPO_URL'\\n        secureValue: helmRepoURL\\n      }\\n      {\\n        name: 'HELM_APP'\\n        secureValue: helmApp\\n      }\\n      {\\n        name: 'HELM_APP_NAME'\\n        secureValue: helmAppName\\n      }\\n    ]\\n    primaryScriptUri: installScriptUri\\n    cleanupPreference: 'OnExpiration'\\n    retentionInterval: 'P1D'\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"clusterName\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"utcValue\\\": {\\n      \\\"value\\\": \\\"utcNow()\\\"\\n    },\\n    \\\"helmRepo\\\": {\\n      \\\"value\\\": \\\"azure-marketplace\\\"\\n    },\\n    \\\"helmRepoURL\\\": {\\n      \\\"value\\\": \\\"'https:\\\"\\n    },\\n    \\\"helmApp\\\": {\\n      \\\"value\\\": \\\"azure-marketplace/wordpress\\\"\\n    },\\n    \\\"helmAppName\\\": {\\n      \\\"value\\\": \\\"my-wordpress\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Location for all resources')\\nparam location string = resourceGroup().location\\n\\n@description('Name of the cluster')\\nparam clusterName string = 'kusto${uniqueString(resourceGroup().id)}'\\n\\n@description('Name of the sku')\\nparam skuName string = 'Standard_D12_v2'\\n\\n@description('# of nodes')\\n@minValue(2)\\n@maxValue(1000)\\nparam skuCapacity int = 2\\n\\n@description('Name of the database')\\nparam databaseName string = 'kustodb'\\n\\n@description('Name of Event Hub\\\\'s namespace')\\nparam eventHubNamespaceName string = 'eventHub${uniqueString(resourceGroup().id)}'\\n\\n@description('Name of Event Hub')\\nparam eventHubName string = 'kustoHub'\\n\\nresource eventHubNamespace 'Microsoft.EventHub/namespaces@2021-11-01' = {\\n  name: eventHubNamespaceName\\n  location: location\\n  sku: {\\n    capacity: 1\\n    name: 'Standard'\\n    tier: 'Standard'\\n  }\\n  properties: {}\\n\\n  resource eventHub 'eventhubs' = {\\n    name: eventHubName\\n    properties: {\\n      messageRetentionInDays: 2\\n      partitionCount: 2\\n    }\\n\\n    resource kustoConsumerGroup 'consumergroups' = {\\n      name: 'kustoConsumerGroup'\\n      properties: {}\\n    }\\n  }\\n}\\n\\nresource cluster 'Microsoft.Kusto/clusters@2022-02-01' = {\\n  name: clusterName\\n  location: location\\n  sku: {\\n    'name': skuName\\n    'tier': 'Standard'\\n    'capacity': skuCapacity\\n  }\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n\\n  resource kustoDb 'databases' = {\\n    name: databaseName\\n    location: location\\n    kind: 'ReadWrite'\\n\\n    resource kustoScript 'scripts' = {\\n      name: 'db-script'\\n      properties: {\\n        scriptContent: loadTextContent('script.kql')\\n        continueOnErrors: false\\n      }\\n    }\\n\\n    resource eventConnection 'dataConnections' = {\\n      name: 'eventConnection'\\n      location: location\\n      //  Here we need to explicitely declare dependencies\\n      //  Since we do not use those resources in the event connection\\n      //  but we do need them to be deployed first\\n      dependsOn: [\\n        //  We need the table to be present in the database\\n        kustoScript\\n        //  We need the cluster to be receiver on the Event Hub\\n        clusterEventHubAuthorization\\n      ]\\n      kind: 'EventHub'\\n      properties: {\\n        compression: 'None'\\n        consumerGroup:  eventHubNamespace::eventHub::kustoConsumerGroup.name\\n        dataFormat: 'MULTIJSON'\\n        eventHubResourceId: eventHubNamespace::eventHub.id\\n        eventSystemProperties: [\\n          'x-opt-enqueued-time'\\n        ]\\n        managedIdentityResourceId: cluster.id\\n        mappingRuleName: 'DirectJson'\\n        tableName: 'RawEvents'\\n      }\\n    }\\n  }\\n}\\n\\n\\n//  We need to authorize the cluster to read the event hub by assigning the role\\n//  \\\"Azure Event Hubs Data Receiver\\\"\\n//  Role list:  https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles\\nvar dataReceiverId = 'a638d3c7-ab3a-418d-83e6-5f17a39d4fde'\\nvar fullDataReceiverId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', dataReceiverId)\\nvar eventHubRoleAssignmentName = '${resourceGroup().id}${cluster.name}${dataReceiverId}${eventHubNamespace::eventHub.name}'\\nvar roleAssignmentName = guid(eventHubRoleAssignmentName, eventHubName, dataReceiverId, clusterName)\\n\\nresource clusterEventHubAuthorization 'Microsoft.Authorization/roleAssignments@2021-04-01-preview' = {\\n  name: roleAssignmentName\\n  //  See https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/scope-extension-resources\\n  //  for scope for extension\\n  scope: eventHubNamespace::eventHub\\n  properties: {\\n    description: 'Give \\\"Azure Event Hubs Data Receiver\\\" to the cluster'\\n    principalId: cluster.identity.principalId\\n    //  Required in case principal not ready when deploying the assignment\\n    principalType: 'ServicePrincipal'\\n    roleDefinitionId: fullDataReceiverId\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"clusterName\\\": {\\n      \\\"value\\\": \\\"kusto${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"skuName\\\": {\\n      \\\"value\\\": \\\"Standard_D12_v2\\\"\\n    },\\n    \\\"skuCapacity\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"databaseName\\\": {\\n      \\\"value\\\": \\\"kustodb\\\"\\n    },\\n    \\\"eventHubNamespaceName\\\": {\\n      \\\"value\\\": \\\"eventHub${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"eventHubName\\\": {\\n      \\\"value\\\": \\\"kustoHub\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Execute this main file to depoy Azure AI Foundry resources in the basic security configuraiton\\n\\n// Parameters\\n@minLength(2)\\n@maxLength(12)\\n@description('Name for the AI resource and used to derive name of dependent resources.')\\nparam aiHubName string = 'demo'\\n\\n@description('Friendly name for your Azure AI resource')\\nparam aiHubFriendlyName string = 'Demo AI resource'\\n\\n@description('Description of your Azure AI resource dispayed in AI Foundry')\\nparam aiHubDescription string = 'This is an example AI resource for use in Azure AI Foundry.'\\n\\n@description('Azure region used for the deployment of all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Set of tags to apply to all resources.')\\nparam tags object = {}\\n\\n// Variables\\nvar name = toLower('${aiHubName}')\\n\\n// Create a short, unique suffix, that will be unique to each resource group\\nvar uniqueSuffix = substring(uniqueString(resourceGroup().id), 0, 4)\\n\\n// Dependent resources for the Azure Machine Learning workspace\\nmodule aiDependencies 'modules/dependent-resources.bicep' = {\\n  name: 'dependencies-${name}-${uniqueSuffix}-deployment'\\n  params: {\\n    location: location\\n    storageName: 'st${name}${uniqueSuffix}'\\n    keyvaultName: 'kv-${name}-${uniqueSuffix}'\\n    applicationInsightsName: 'appi-${name}-${uniqueSuffix}'\\n    containerRegistryName: 'cr${name}${uniqueSuffix}'\\n    aiServicesName: 'ais${name}${uniqueSuffix}'\\n    tags: tags\\n  }\\n}\\n\\nmodule aiHub 'modules/ai-hub.bicep' = {\\n  name: 'ai-${name}-${uniqueSuffix}-deployment'\\n  params: {\\n    // workspace organization\\n    aiHubName: 'aih-${name}-${uniqueSuffix}'\\n    aiHubFriendlyName: aiHubFriendlyName\\n    aiHubDescription: aiHubDescription\\n    location: location\\n    tags: tags\\n\\n    // dependent resources\\n    aiServicesId: aiDependencies.outputs.aiservicesID\\n    aiServicesTarget: aiDependencies.outputs.aiservicesTarget\\n    applicationInsightsId: aiDependencies.outputs.applicationInsightsId\\n    containerRegistryId: aiDependencies.outputs.containerRegistryId\\n    keyVaultId: aiDependencies.outputs.keyvaultId\\n    storageAccountId: aiDependencies.outputs.storageId\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"aiHubName\\\": {\\n      \\\"value\\\": \\\"demo\\\"\\n    },\\n    \\\"aiHubFriendlyName\\\": {\\n      \\\"value\\\": \\\"Demo AI resource\\\"\\n    },\\n    \\\"aiHubDescription\\\": {\\n      \\\"value\\\": \\\"This is an example AI resource for use in Azure AI Foundry.\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Creates an Azure AI Hub resource with proxied endpoints for the Azure AI services provider\\n\\n@description('Azure region used for the deployment of the Azure AI Hub.')\\nparam location string\\n\\n@description('Set of tags to apply to the Azure AI Hub.')\\nparam tags object\\n\\n@description('Name for the Azure AI Hub resource.')\\nparam aiHubName string\\n\\n@description('Friendly name for your Azure AI Hub resource, displayed in the Foundry UI.')\\nparam aiHubFriendlyName string = aiHubName\\n\\n@description('Description of your Azure AI Hub resource, displayed in the Foundry UI.')\\nparam aiHubDescription string\\n\\n@description('Resource ID of the Azure Application Insights resource for storing diagnostics logs.')\\nparam applicationInsightsId string\\n\\n@description('Resource ID of the Azure Container Registry resource for storing Docker images for models.')\\nparam containerRegistryId string\\n\\n@description('Resource ID of the Azure Key Vault resource for storing connection strings.')\\nparam keyVaultId string\\n\\n@description('Resource ID of the Azure Storage Account resource for storing workspace data.')\\nparam storageAccountId string\\n\\n@description('Resource ID of the Azure AI Services resource for connecting AI capabilities.')\\nparam aiServicesId string\\n\\n@description('Target endpoint for the Azure AI Services resource to link to the Azure AI Hub.')\\nparam aiServicesTarget string\\n\\n@description('The object ID of a Microsoft Entra ID users to be granted necessary role assignments to access the Azure AI Hub.')\\nparam userObjectId string = ''\\n\\nresource aiHub 'Microsoft.MachineLearningServices/workspaces@2024-04-01-preview' = {\\n  name: aiHubName\\n  location: location\\n  tags: tags\\n  kind: 'Hub'\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  properties: {\\n    // organization\\n    friendlyName: aiHubFriendlyName\\n    description: aiHubDescription\\n\\n    // dependent resources\\n    keyVault: keyVaultId\\n    storageAccount: storageAccountId\\n    applicationInsights: applicationInsightsId\\n    containerRegistry: containerRegistryId\\n    systemDatastoresAuthMode: 'identity'\\n  }\\n\\n  resource aiServicesConnection 'connections@2024-04-01-preview' = {\\n    name: '${aiHubName}-connection'\\n    properties: {\\n      category: 'AIServices'\\n      target: aiServicesTarget\\n      authType: 'AAD'\\n      isSharedToAll: true\\n      metadata: {\\n        ApiType: 'Azure'\\n        ResourceId: aiServicesId\\n      }\\n    }\\n  }\\n}\\n\\nresource azureMLDataScientistRole 'Microsoft.Authorization/roleDefinitions@2022-05-01-preview' existing = if (userObjectId != '') {\\n  name: 'f6c7c914-8db3-469d-8ca1-694a8f32e121'\\n  scope: resourceGroup()\\n}\\n\\nresource azureMLDataScientistRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = if (userObjectId != '') {\\n  name: guid(aiHub.id, userObjectId, azureMLDataScientistRole.id)\\n  scope: aiHub\\n  properties: {\\n    principalId: userObjectId\\n    roleDefinitionId: azureMLDataScientistRole.id\\n    principalType: 'User'\\n  }\\n}\\n\\noutput aiHubId string = aiHub.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiHubName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiHubFriendlyName\\\": {\\n      \\\"value\\\": \\\"aiHubName\\\"\\n    },\\n    \\\"aiHubDescription\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"applicationInsightsId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"containerRegistryId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyVaultId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"storageAccountId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServicesId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServicesTarget\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"userObjectId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Azure region of the deployment')\\nparam location string\\n\\n@description('Tags to add to the resources')\\nparam tags object\\n\\n@description('Name of the AI service')\\nparam aiServiceName string\\n\\n@description('Name of the AI service private link endpoint for cognitive services')\\nparam aiServicesPleName string\\n\\n@description('Resource ID of the subnet')\\nparam subnetId string\\n\\n@description('Resource ID of the virtual network')\\nparam virtualNetworkId string\\n\\n@allowed([\\n  'S0'\\n])\\n@description('AI service SKU')\\nparam aiServiceSkuName string = 'S0'\\n\\nvar aiServiceNameCleaned = replace(aiServiceName, '-', '')\\n\\nvar cognitiveServicesPrivateDnsZoneName = 'privatelink.cognitiveservices.azure.com'\\nvar openAiPrivateDnsZoneName = 'privatelink.openai.azure.com'\\n\\nresource aiServices 'Microsoft.CognitiveServices/accounts@2023-05-01' = {\\n  name: aiServiceNameCleaned\\n  location: location\\n  sku: {\\n    name: aiServiceSkuName\\n  }\\n  kind: 'AIServices'\\n  properties: {\\n    publicNetworkAccess: 'Disabled'\\n    disableLocalAuth: false\\n    apiProperties: {\\n      statisticsEnabled: false\\n    }\\n    networkAcls: {\\n      defaultAction: 'Deny'\\n      virtualNetworkRules: [\\n        {\\n          id: subnetId\\n          ignoreMissingVnetServiceEndpoint: true\\n        }\\n      ]\\n    }\\n    customSubDomainName: aiServiceNameCleaned\\n  }\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n}\\n\\nresource aiServicesPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-11-01' = {\\n  name: aiServicesPleName\\n  location: location\\n  tags: tags\\n  properties: {\\n    privateLinkServiceConnections: [\\n      { \\n        name: aiServicesPleName\\n        properties: {\\n          groupIds: [\\n            'account'\\n          ]\\n          privateLinkServiceId: aiServices.id\\n          privateLinkServiceConnectionState: {\\n            status: 'Approved'\\n            description: 'Auto-Approved'\\n            actionsRequired: 'None'\\n          }\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: subnetId\\n    }\\n  }\\n}\\n\\nresource cognitiveServicesPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: cognitiveServicesPrivateDnsZoneName\\n  location: 'global'\\n}\\n\\nresource openAiPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: openAiPrivateDnsZoneName\\n  location: 'global'\\n}\\n\\nresource cognitiveServicesVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: cognitiveServicesPrivateDnsZone\\n  name: uniqueString(virtualNetworkId)\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: virtualNetworkId\\n    }\\n  }\\n}\\n\\nresource openAiVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: openAiPrivateDnsZone\\n  name: uniqueString(virtualNetworkId)\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: virtualNetworkId\\n    }\\n  }\\n}\\n\\nresource aiServicesPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-11-01' = {\\n  parent: aiServicesPrivateEndpoint\\n  name: 'default'\\n  properties:{\\n    privateDnsZoneConfigs: [\\n      {\\n        name: replace(openAiPrivateDnsZoneName, '.', '-')\\n        properties:{\\n          privateDnsZoneId: openAiPrivateDnsZone.id\\n        }\\n      }\\n      {\\n        name: replace(cognitiveServicesPrivateDnsZoneName, '.', '-')\\n        properties:{\\n          privateDnsZoneId: cognitiveServicesPrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\noutput aiServicesId string = aiServices.id\\noutput aiServicesEndpoint string = aiServices.properties.endpoint\\noutput aiServicesName string = aiServices.name\\noutput aiServicesPrincipalId string = aiServices.identity.principalId\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServiceName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServicesPleName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualNetworkId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServiceSkuName\\\": {\\n      \\\"value\\\": \\\"S0\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Parameters\\n@description('Specifies the name of the Azure AI Services account.')\\nparam name string\\n\\n@description('Specifies the location.')\\nparam location string = resourceGroup().location\\n\\n@description('Specifies the resource model definition representing SKU.')\\nparam sku object = {\\n  name: 'S0'\\n}\\n\\n@description('Specifies the identity of the aiServices resource.')\\nparam identity object = {\\n  type: 'SystemAssigned'\\n}\\n\\n@description('Specifies the resource tags.')\\nparam tags object\\n\\n@description('Specifies an optional subdomain name used for token-based authentication.')\\nparam customSubDomainName string = ''\\n\\n@description('Specifies whether disable the local authentication via API key.')\\nparam disableLocalAuth bool = true\\n\\n@description('Specifies whether or not public endpoint access is allowed for this account..')\\n@allowed([\\n  'Enabled'\\n  'Disabled'\\n])\\nparam publicNetworkAccess string = 'Enabled'\\n\\n@description('Specifies the OpenAI deployments to create.')\\nparam deployments array = []\\n\\n@description('Specifies the workspace id of the Log Analytics used to monitor the Application Gateway.')\\nparam workspaceId string\\n\\n@description('Specifies the object id of a Miccrosoft Entra ID user. In general, this the object id of the system administrator who deploys the Azure resources.')\\nparam userObjectId string = ''\\n\\n// Variables\\nvar diagnosticSettingsName = 'diagnosticSettings'\\nvar aiServicesLogCategories = [\\n  'Audit'\\n  'RequestResponse'\\n  'Trace'\\n]\\nvar aiServicesMetricCategories = [\\n  'AllMetrics'\\n]\\nvar aiServicesLogs = [\\n  for category in aiServicesLogCategories: {\\n    category: category\\n    enabled: true\\n  }\\n]\\nvar aiServicesMetrics = [\\n  for category in aiServicesMetricCategories: {\\n    category: category\\n    enabled: true\\n  }\\n]\\n\\n// Resources\\nresource aiServices 'Microsoft.CognitiveServices/accounts@2024-04-01-preview' = {\\n  name: name\\n  location: location\\n  sku: sku\\n  kind: 'AIServices'\\n  identity: identity\\n  tags: tags\\n  properties: {\\n    customSubDomainName: customSubDomainName\\n    disableLocalAuth: disableLocalAuth\\n    publicNetworkAccess: publicNetworkAccess\\n  }\\n}\\n\\n@batchSize(1)\\nresource model 'Microsoft.CognitiveServices/accounts/deployments@2023-05-01' = [\\n  for deployment in deployments: {\\n    name: deployment.model.name\\n    parent: aiServices\\n    sku: {\\n      capacity: deployment.sku.capacity ?? 100\\n      name: empty(deployment.sku.name) ? 'Standard' : deployment.sku.name\\n    }\\n    properties: {\\n      model: {\\n        format: 'OpenAI'\\n        name: deployment.model.name\\n        version: deployment.model.version\\n      }\\n    }\\n  }\\n]\\n\\nresource cognitiveServicesContributorRoleDefinition 'Microsoft.Authorization/roleDefinitions@2022-04-01' existing = {\\n  name: '25fbc0a9-bd7c-42a3-aa1a-3b75d497ee68'\\n  scope: subscription()\\n}\\n\\n// This role assignment grants the user the required permissions to eventually delete and purge the Azure AI Services account\\nresource cognitiveServicesContributorRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = if (!empty(userObjectId)) {\\n  name: guid(aiServices.id, cognitiveServicesContributorRoleDefinition.id, userObjectId)\\n  scope: aiServices\\n  properties: {\\n    roleDefinitionId: cognitiveServicesContributorRoleDefinition.id\\n    principalType: 'User'\\n    principalId: userObjectId\\n  }\\n}\\n\\nresource cognitiveServicesUserRoleDefinition 'Microsoft.Authorization/roleDefinitions@2022-04-01' existing = {\\n  name: 'a97b65f3-24c7-4388-baec-2e87135dc908'\\n  scope: subscription()\\n}\\n\\n// This role assignment grants the Azure AI Services managed identity the required permissions to access the AI services such as Azure OpenAI. \\nresource cognitiveServicesUserIdentityRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  name: guid(aiServices.id, cognitiveServicesUserRoleDefinition.id, 'aiServices')\\n  scope: aiServices\\n  properties: {\\n    roleDefinitionId: cognitiveServicesUserRoleDefinition.id\\n    principalType: 'ServicePrincipal'\\n    principalId: aiServices.identity.principalId\\n  }\\n}\\n\\n// This role assignment grants the user the Cognitive Services User role on the Azure AI Services account\\nresource cognitiveServicesUserUserRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = if (!empty(userObjectId)) {\\n  name: guid(aiServices.id, cognitiveServicesUserRoleDefinition.id, userObjectId)\\n  scope: aiServices\\n  properties: {\\n    roleDefinitionId: cognitiveServicesUserRoleDefinition.id\\n    principalType: 'User'\\n    principalId: userObjectId\\n  }\\n}\\n\\nresource aiServicesDiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\\n  name: diagnosticSettingsName\\n  scope: aiServices\\n  properties: {\\n    workspaceId: workspaceId\\n    logs: aiServicesLogs\\n    metrics: aiServicesMetrics\\n  }\\n}\\n\\n// Outputs\\noutput id string = aiServices.id\\noutput name string = aiServices.name\\noutput endpoint string = aiServices.properties.endpoint\\noutput openAiEndpoint string = aiServices.properties.endpoints['OpenAI Language Model Instance API']\\noutput principalId string = aiServices.identity.principalId\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"name\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"sku\\\": {\\n      \\\"value\\\": \\\"{\\\"\\n    },\\n    \\\"identity\\\": {\\n      \\\"value\\\": \\\"{\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"customSubDomainName\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"disableLocalAuth\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"publicNetworkAccess\\\": {\\n      \\\"value\\\": \\\"Enabled\\\"\\n    },\\n    \\\"deployments\\\": {\\n      \\\"value\\\": \\\"[]\\\"\\n    },\\n    \\\"workspaceId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"userObjectId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Imports\\nimport {getVirtualNetworkIdFromSubnetId, getVirtualNetworkNameFromSubnetId} from './functions.bicep'\\n\\n// Parameters\\n@description('Specifies the resource ID of the subnet where private endpoints will be created.')\\nparam subnetId string\\n\\n@description('Specifies the name of the private endpoint to the blob storage account.')\\nparam blobStorageAccountPrivateEndpointName string\\n\\n@description('Specifies the name of the private endpoint to the file storage account.')\\nparam fileStorageAccountPrivateEndpointName string\\n\\n@description('Specifies the resource id of the Azure Storage Account.')\\nparam storageAccountId string\\n\\n@description('Specifies the name of the private endpoint to the Key Vault.')\\nparam keyVaultPrivateEndpointName string\\n\\n@description('Specifies the resource id of the Azure Key vault.')\\nparam keyVaultId string\\n\\n@description('Specifies the resource id of the Azure Hub Workspace.')\\nparam hubWorkspaceId string\\n\\n@description('Specifies the resource id of the Azure AI Services.')\\nparam aiServicesId string\\n\\n@description('Specifies whether to create a private endpoint for the Azure Container Registry')\\nparam createAcrPrivateEndpoint bool = false\\n\\n@description('Specifies the name of the private endpoint to the Azure Container Registry.')\\nparam acrPrivateEndpointName string\\n\\n@description('Specifies the resource id of the Azure Container Registry.')\\nparam acrId string\\n\\n@description('Specifies the name of the private endpoint to the Azure Hub Workspace.')\\nparam hubWorkspacePrivateEndpointName string\\n\\n@description('Specifies the name of the private endpoint to the Azure AI Services.')\\nparam aiServicesPrivateEndpointName string\\n\\n@description('Specifies the location.')\\nparam location string = resourceGroup().location\\n\\n@description('Specifies the resource tags.')\\nparam tags object\\n\\n// Variables\\nvar virtualNetworkName = getVirtualNetworkNameFromSubnetId(subnetId)\\n\\n// Existing virtual network\\nresource vnet 'Microsoft.Network/virtualNetworks@2023-04-01' existing = {\\n  name: virtualNetworkName\\n}\\n\\n// Private DNS Zones\\nresource acrPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: 'privatelink.${toLower(environment().name) == 'azureusgovernment' ? 'azurecr.us' : 'azurecr.io'}'\\n  location: 'global'\\n  tags: tags\\n}\\n\\nresource blobPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: 'privatelink.blob.${environment().suffixes.storage}'\\n  location: 'global'\\n  tags: tags\\n}\\n\\nresource filePrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: 'privatelink.file.${environment().suffixes.storage}'\\n  location: 'global'\\n  tags: tags\\n}\\n\\nresource keyVaultPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: 'privatelink.${toLower(environment().name) == 'azureusgovernment' ? 'vaultcore.usgovcloudapi.net' : 'vaultcore.azure.net'}'\\n  location: 'global'\\n  tags: tags\\n}\\n\\nresource mlApiPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: 'privatelink.api.${toLower(environment().name) == 'azureusgovernment' ? 'ml.azure.us' : 'azureml.ms'}'\\n  location: 'global'\\n  tags: tags\\n}\\n\\nresource mlNotebooksPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: 'privatelink.notebooks.${toLower(environment().name) == 'azureusgovernment' ? 'usgovcloudapi.net' : 'azureml.net'}'\\n  location: 'global'\\n  tags: tags\\n}\\n\\nresource cognitiveServicesPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: 'privatelink.cognitiveservices.${toLower(environment().name) == 'azureusgovernment' ? 'azure.us' : 'azure.com'}'\\n  location: 'global'\\n  tags: tags\\n}\\n\\nresource openAiPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: 'privatelink.openai.${toLower(environment().name) == 'azureusgovernment' ? 'azure.us' : 'azure.com'}'\\n  location: 'global'\\n  tags: tags\\n}\\n\\n// Virtual Network Links\\nresource acrPrivateDnsZoneVirtualNetworkLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: acrPrivateDnsZone\\n  name: 'link_to_${toLower(virtualNetworkName)}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: vnet.id\\n    }\\n  }\\n}\\n\\nresource blobPrivateDnsZoneVirtualNetworkLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: blobPrivateDnsZone\\n  name: 'link_to_${toLower(virtualNetworkName)}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: vnet.id\\n    }\\n  }\\n}\\n\\nresource filePrivateDnsZoneVirtualNetworkLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: filePrivateDnsZone\\n  name: 'link_to_${toLower(virtualNetworkName)}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: vnet.id\\n    }\\n  }\\n}\\n\\nresource keyVaultPrivateDnsZoneVirtualNetworkLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: keyVaultPrivateDnsZone\\n  name: 'link_to_${toLower(virtualNetworkName)}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: vnet.id\\n    }\\n  }\\n}\\n\\nresource mlApiPrivateDnsZoneVirtualNetworkLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: mlApiPrivateDnsZone\\n  name: 'link_to_${toLower(virtualNetworkName)}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: vnet.id\\n    }\\n  }\\n}\\n\\nresource mlNotebooksPrivateDnsZoneVirtualNetworkLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: mlNotebooksPrivateDnsZone\\n  name: 'link_to_${toLower(virtualNetworkName)}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: vnet.id\\n    }\\n  }\\n}\\n\\nresource cognitiveServicesPrivateDnsZoneVirtualNetworkLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: cognitiveServicesPrivateDnsZone\\n  name: 'link_to_${toLower(virtualNetworkName)}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: vnet.id\\n    }\\n  }\\n}\\n\\nresource openAiPrivateDnsZoneVirtualNetworkLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: openAiPrivateDnsZone\\n  name: 'link_to_${toLower(virtualNetworkName)}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: vnet.id\\n    }\\n  }\\n}\\n\\n// Private Endpoints\\nresource blobStorageAccountPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-04-01' = {\\n  name: blobStorageAccountPrivateEndpointName\\n  location: location\\n  tags: tags\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: blobStorageAccountPrivateEndpointName\\n        properties: {\\n          privateLinkServiceId: storageAccountId\\n          groupIds: [\\n            'blob'\\n          ]\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: subnetId\\n    }\\n  }\\n}\\n\\nresource blobStorageAccountPrivateDnsZoneGroupName 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-04-01' = {\\n  parent: blobStorageAccountPrivateEndpoint\\n  name: 'PrivateDnsZoneGroupName'\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: 'dnsConfig'\\n        properties: {\\n          privateDnsZoneId: blobPrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource fileStorageAccountPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-04-01' = {\\n  name: fileStorageAccountPrivateEndpointName\\n  location: location\\n  tags: tags\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: fileStorageAccountPrivateEndpointName\\n        properties: {\\n          privateLinkServiceId: storageAccountId\\n          groupIds: [\\n            'file'\\n          ]\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: subnetId\\n    }\\n  }\\n}\\n\\nresource fileStorageAccountPrivateDnsZoneGroupName 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-04-01' = {\\n  parent: fileStorageAccountPrivateEndpoint\\n  name: 'PrivateDnsZoneGroupName'\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: 'dnsConfig'\\n        properties: {\\n          privateDnsZoneId: filePrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource keyVaultPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-04-01' = {\\n  name: keyVaultPrivateEndpointName\\n  location: location\\n  tags: tags\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: keyVaultPrivateEndpointName\\n        properties: {\\n          privateLinkServiceId: keyVaultId\\n          groupIds: [\\n            'vault'\\n          ]\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: subnetId\\n    }\\n  }\\n}\\n\\nresource keyVaultPrivateDnsZoneGroupName 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-04-01' = {\\n  parent: keyVaultPrivateEndpoint\\n  name: 'PrivateDnsZoneGroupName'\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: 'dnsConfig'\\n        properties: {\\n          privateDnsZoneId: keyVaultPrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource acrPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-04-01' = if (createAcrPrivateEndpoint) {\\n  name: acrPrivateEndpointName\\n  location: location\\n  tags: tags\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: acrPrivateEndpointName\\n        properties: {\\n          privateLinkServiceId: acrId\\n          groupIds: [\\n            'registry'\\n          ]\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: subnetId\\n    }\\n  }\\n}\\n\\nresource acrPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-04-01' = if (createAcrPrivateEndpoint) {\\n  parent: acrPrivateEndpoint\\n  name: 'acrPrivateDnsZoneGroup'\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: 'dnsConfig'\\n        properties: {\\n          privateDnsZoneId: acrPrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource hubWorkspacePrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-11-01' = {\\n  name: hubWorkspacePrivateEndpointName\\n  location: location\\n  tags: tags\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: hubWorkspacePrivateEndpointName\\n        properties: {\\n          privateLinkServiceId: hubWorkspaceId\\n          groupIds: [\\n            'amlworkspace'\\n          ]\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: subnetId\\n    }\\n  }\\n}\\n\\nresource hubWorkspacePrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-11-01' = {\\n  parent: hubWorkspacePrivateEndpoint\\n  name: 'hubWorkspacePrivateDnsZoneGroup'\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: replace(mlApiPrivateDnsZone.name, '.', '-')\\n        properties: {\\n            privateDnsZoneId: mlApiPrivateDnsZone.id\\n        }\\n      }\\n      {\\n        name: replace(mlNotebooksPrivateDnsZone.name, '.', '-')\\n        properties: {\\n            privateDnsZoneId: mlNotebooksPrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    mlApiPrivateDnsZoneVirtualNetworkLink\\n    mlNotebooksPrivateDnsZoneVirtualNetworkLink\\n  ]\\n}\\n\\nresource aiServicesPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-11-01' = {\\n  name: aiServicesPrivateEndpointName\\n  location: location\\n  tags: tags\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: aiServicesPrivateEndpointName\\n        properties: {\\n          privateLinkServiceId: aiServicesId\\n          groupIds: [\\n            'account'\\n          ]\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: subnetId\\n    }\\n  }\\n}\\n\\nresource aiServicesPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-11-01' = {\\n  parent: aiServicesPrivateEndpoint\\n  name: 'default'\\n  properties:{\\n    privateDnsZoneConfigs: [\\n      {\\n        name: replace(cognitiveServicesPrivateDnsZone.name, '.', '-')\\n        properties:{\\n          privateDnsZoneId: cognitiveServicesPrivateDnsZone.id\\n        }\\n      }\\n      {\\n        name: replace(openAiPrivateDnsZone.name, '.', '-')\\n        properties:{\\n          privateDnsZoneId: openAiPrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"subnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"blobStorageAccountPrivateEndpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"fileStorageAccountPrivateEndpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"storageAccountId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyVaultPrivateEndpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyVaultId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"hubWorkspaceId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServicesId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"createAcrPrivateEndpoint\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"acrPrivateEndpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"acrId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"hubWorkspacePrivateEndpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServicesPrivateEndpointName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy the Build Your Own Copilot Solution Accelerator using only the required parameters: Sandbox configuration with default parameter values"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/sa/build-your-own-copilot:0.1.0\", \"name\": \"buildYourOwnCopilot\"}], \"rationale\": \"AVM pattern module for sa.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module buildYourOwnCopilot 'br/public:avm/ptn/sa/build-your-own-copilot:0.1.0' = {\\n name: 'buildYourOwnCopilotDeployment'\\n params: {\\n // Required parameters\\n azureAiServiceLocation: '<azureAiServiceLocation>'\\n enableMonitoring: true\\n enablePrivateNetworking: true\\n enablePurgeProtection: true\\n enableRedundancy: true\\n enableScalability: true\\n // Non-required parameters\\n enableTelemetry: true\\n vmAdminPassword: '<vmAdminPassword>'\\n vmAdminUsername: 'adminuser'\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a multi-region hub network in Azure: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/network/hub-networking:0.5.0\", \"name\": \"hubNetworking\"}], \"rationale\": \"AVM pattern module for network.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module hubNetworking 'br/public:avm/ptn/network/hub-networking:0.5.0' = {\\n name: 'hubNetworkingDeployment'\\n params: {\\n hubVirtualNetworks: {\\n hub1: {\\n addressPrefixes: '<addressPrefixes>'\\n azureFirewallSettings: {\\n azureSkuTier: 'Standard'\\n diagnosticSettings: [\\n {\\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n eventHubName: '<eventHubName>'\\n storageAccountResourceId: '<storageAccountResourceId>'\\n workspaceResourceId: '<workspaceResourceId>'\\n }\\n ]\\n location: '<location>'\\n publicIPAddressObject: {\\n name: 'hub1PublicIp'\\n }\\n threatIntelMode: 'Deny'\\n zones: [\\n 1\\n 2\\n 3\\n ]\\n }\\n bastionHost: {\\n disableCopyPaste: true\\n enableFileCopy: false\\n enableIpConnect: false\\n enableShareableLink: false\\n scaleUnits: 2\\n skuName: 'Standard'\\n }\\n diagnosticSettings: [\\n {\\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n eventHubName: '<eventHubName>'\\n metricCategories: [\\n {\\n category: 'AllMetrics'\\n }\\n ]\\n name: 'customSetting'\\n storageAccountResourceId: '<storageAccountResourceId>'\\n workspaceResourceId: '<workspaceResourceId>'\\n }\\n ]\\n dnsServers: [\\n '10.0.1.6'\\n '10.0.1.7'\\n ]\\n enableAzureFirewall: true\\n enableBastion: true\\n enablePeering: false\\n flowTimeoutInMinutes: 30\\n location: '<location>'\\n routes: [\\n {\\n name: 'defaultRoute'\\n properties: {\\n addressPrefix: '0.0.0.0/0'\\n nextHopType: 'Internet'\\n }\\n }\\n ]\\n subnets: [\\n {\\n addressPrefix: '<addressPrefix>'\\n name: 'GatewaySubnet'\\n }\\n {\\n addressPrefix: '<addressPrefix>'\\n name: 'AzureFirewallSubnet'\\n }\\n {\\n addressPrefix: '<addressPrefix>'\\n name: 'AzureBastionSubnet'\\n }\\n ]\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n vnetEncryption: false\\n vnetEncryptionEnforcement: 'AllowUnencrypted'\\n }\\n }\\n location: '<location>'\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy the module with the minimum set of required parameters: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/ptn/data/private-analytical-workspace:0.1.0\", \"name\": \"privateAnalyticalWorkspace\"}], \"rationale\": \"AVM pattern module for data.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module privateAnalyticalWorkspace 'br/public:avm/ptn/data/private-analytical-workspace:0.1.0' = {\\n name: 'UC3'\\n params: {\\n // Required parameters\\n name: 'pawuc3'\\n // Non-required parameters\\n virtualNetworkResourceId: '/subscriptions/{SUBSCRIPTION-ID}/resourceGroups/{NAME-OF-RG}/providers/Microsoft.Network/virtualNetworks/{NAME-OF-VNET}'\\n logAnalyticsWorkspaceResourceId: '/subscriptions/{SUBSCRIPTION-ID}/resourceGroups/{NAME-OF-RG}/providers/Microsoft.OperationalInsights/workspaces/{NAME-OF-LOG}'\\n keyVaultResourceId: '/subscriptions/{SUBSCRIPTION-ID}/resourceGroups/{NAME-OF-RG}/providers/Microsoft.KeyVault/vaults/{NAME-OF-KV}'\\n enableDatabricks: true // Part of the solution will be new instance of the Azure Databricks\\n solutionAdministrators: [\\n {\\n principalId: <EntraGroupId> // Specified group will have enough permissions to manage the solution\\n principalType: 'Group' // Group and/or User type can be specified\\n }\\n ]\\n advancedOptions: {\\n networkAcls: { ipRules: [<AllowedPublicIPAddress>] } // Which public IP addresses of the end users can access the solution (enables public endpoints for some services)\\n }\\n tags: { Owner: 'Contoso', 'Cost Center': '2345-324' }\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy an Azure Stack HCI network interface: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/azure-stack-hci/network-interface:0.1.0\", \"name\": \"networkInterface\"}], \"rationale\": \"AVM module for azure-stack-hci.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module networkInterface 'br/public:avm/res/azure-stack-hci/network-interface:0.1.0' = {\\n name: 'networkInterfaceDeployment'\\n params: {\\n // Required parameters\\n customLocationResourceId: '<customLocationResourceId>'\\n ipConfigurations: [\\n {\\n properties: {\\n subnet: {\\n id: '<id>'\\n }\\n }\\n }\\n ]\\n name: 'ashniwafnetworkinterface'\\n // Non-required parameters\\n dnsServers: [\\n '172.20.0.1'\\n ]\\n enableTelemetry: true\\n location: '<location>'\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy a Policy Assignment at a Resource Group scope: Using only defaults (Resource Group scope)"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/authorization/policy-assignment/rg-scope:0.1.0\", \"name\": \"policyAssignment\"}], \"rationale\": \"AVM module for authorization.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module policyAssignment 'br/public:avm/res/authorization/policy-assignment/rg-scope:0.1.0' = {\\n name: 'policyAssignmentDeployment'\\n params: {\\n // Required parameters\\n name: 'rapargwaf001'\\n policyDefinitionId: '/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d'\\n // Non-required parameters\\n additionalResourceGroupResourceIDsToAssignRbacTo: [\\n '<id>'\\n ]\\n metadata: {\\n assignedBy: 'Bicep'\\n }\\n roleDefinitionIds: [\\n '/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c'\\n ]\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Deploy an Analysis Services Server: Using only defaults"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:avm/res/analysis-services/server:0.3.0\", \"name\": \"server\"}], \"rationale\": \"AVM module for analysis-services.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"module server 'br/public:avm/res/analysis-services/server:0.3.0' = {\\n name: 'serverDeployment'\\n params: {\\n // Required parameters\\n name: 'asswaf'\\n // Non-required parameters\\n diagnosticSettings: [\\n {\\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\\n eventHubName: '<eventHubName>'\\n logCategoriesAndGroups: [\\n {\\n category: 'Engine'\\n }\\n {\\n category: 'Service'\\n }\\n ]\\n metricCategories: [\\n {\\n category: 'AllMetrics'\\n }\\n ]\\n name: 'customSetting'\\n storageAccountResourceId: '<storageAccountResourceId>'\\n workspaceResourceId: '<workspaceResourceId>'\\n }\\n ]\\n firewallSettings: {\\n enablePowerBIService: true\\n firewallRules: [\\n {\\n firewallRuleName: 'AllowFromAll'\\n rangeEnd: '255.255.255.255'\\n rangeStart: '0.0.0.0'\\n }\\n ]\\n }\\n location: '<location>'\\n lock: {\\n kind: 'CanNotDelete'\\n name: 'myCustomLockName'\\n }\\n skuCapacity: 1\\n skuName: 'S0'\\n tags: {\\n Environment: 'Non-Prod'\\n 'hidden-title': 'This is visible in the resource name'\\n Role: 'DeploymentValidation'\\n }\\n }\\n}\\n\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies the name of the Azure Machine Learning workspace which will hold this data asset.')\\nparam workspaceName string\\n\\n@description('Specifies the name of the data container asset.')\\nparam dataContainerName string\\n\\n@description('Specifies the name of the data version.')\\nparam dataVersionName string = '1'\\n\\n@description('Specifies the type of data: mltable, uri_file, or uri_folder.')\\n@allowed([\\n  'mltable'\\n  'uri_file'\\n  'uri_folder'\\n])\\nparam dataType string = 'uri_file'\\n\\n@description('Specifies a URI for the data, for testing purposes use: https://azbotstorage.blob.core.windows.net/sample-artifacts/yellow_tripdata_2022-04.parquet')\\nparam dataUri string\\n\\n@description('Optional: Description of the data asset.')\\nparam dataDescription string = 'Sample data asset'\\n\\n@description('Optional: Is the asset archived?')\\nparam isArchived bool = false\\n\\nresource dc 'Microsoft.MachineLearningServices/workspaces/data@2022-05-01' = {\\n  name: '${workspaceName}/${dataContainerName}'\\n  properties: {\\n    dataType: dataType\\n    isArchived: isArchived\\n  }\\n}\\n\\nresource dv 'Microsoft.MachineLearningServices/workspaces/data/versions@2022-05-01' = {\\n  name: '${workspaceName}/${dataContainerName}/${dataVersionName}'\\n  dependsOn: [dc]\\n  properties: {\\n    dataType: dataType\\n    dataUri: dataUri\\n    isArchived: isArchived\\n    description: dataDescription    \\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"workspaceName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dataContainerName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dataVersionName\\\": {\\n      \\\"value\\\": \\\"1\\\"\\n    },\\n    \\\"dataType\\\": {\\n      \\\"value\\\": \\\"uri_file\\\"\\n    },\\n    \\\"dataUri\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dataDescription\\\": {\\n      \\\"value\\\": \\\"Sample data asset\\\"\\n    },\\n    \\\"isArchived\\\": {\\n      \\\"value\\\": false\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Creates a KeyVault with Private Link Endpoint\\n@description('The Azure Region to deploy the resources into')\\nparam location string = resourceGroup().location\\n\\n@description('Tags to apply to the Key Vault Instance')\\nparam tags object = {}\\n\\n@description('The name of the Key Vault')\\nparam keyvaultName string\\n\\n@description('The name of the Key Vault private link endpoint')\\nparam keyvaultPleName string\\n\\n@description('The Subnet ID where the Key Vault Private Link is to be created')\\nparam subnetId string\\n\\n@description('The VNet ID where the Key Vault Private Link is to be created')\\nparam virtualNetworkId string\\n\\nvar privateDnsZoneName = 'privatelink${environment().suffixes.keyvaultDns}'\\n\\nresource keyVault 'Microsoft.KeyVault/vaults@2021-10-01' = {\\n  name: keyvaultName\\n  location: location\\n  tags: tags\\n  properties: {\\n    createMode: 'default'\\n    enabledForDeployment: false\\n    enabledForDiskEncryption: false\\n    enabledForTemplateDeployment: false\\n    enableSoftDelete: true\\n    enableRbacAuthorization: true\\n    enablePurgeProtection: true\\n    networkAcls: {\\n      bypass: 'AzureServices'\\n      defaultAction: 'Deny'\\n    }\\n    sku: {\\n      family: 'A'\\n      name: 'standard'\\n    }\\n    softDeleteRetentionInDays: 7\\n    tenantId: subscription().tenantId\\n  }\\n}\\n\\nresource keyVaultPrivateEndpoint 'Microsoft.Network/privateEndpoints@2022-01-01' = {\\n  name: keyvaultPleName\\n  location: location\\n  tags: tags\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: keyvaultPleName\\n        properties: {\\n          groupIds: [\\n            'vault'\\n          ]\\n          privateLinkServiceId: keyVault.id\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: subnetId\\n    }\\n  }\\n}\\n\\nresource keyVaultPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: privateDnsZoneName\\n  location: 'global'\\n}\\n\\nresource privateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-01-01' = {\\n  name: '${keyVaultPrivateEndpoint.name}/vault-PrivateDnsZoneGroup'\\n  properties:{\\n    privateDnsZoneConfigs: [\\n      {\\n        name: privateDnsZoneName\\n        properties:{\\n          privateDnsZoneId: keyVaultPrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource keyVaultPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  name: '${keyVaultPrivateDnsZone.name}/${uniqueString(keyVault.id)}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: virtualNetworkId\\n    }\\n  }\\n}\\n\\noutput keyvaultId string = keyVault.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"keyvaultName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyvaultPleName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualNetworkId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Creates a virtual network\\n@description('Azure region of the deployment')\\nparam location string = resourceGroup().location\\n\\n@description('Tags to add to the resources')\\nparam tags object = {}\\n\\n@description('Name of the virtual network resource')\\nparam virtualNetworkName string\\n\\n@description('Group ID of the network security group')\\nparam networkSecurityGroupId string\\n\\n@description('Virtual network address prefix')\\nparam vnetAddressPrefix string = '192.168.0.0/16'\\n\\n@description('Training subnet address prefix')\\nparam trainingSubnetPrefix string = '192.168.0.0/24'\\n\\n@description('Scoring subnet address prefix')\\nparam scoringSubnetPrefix string = '192.168.1.0/24'\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-01-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  tags: tags\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetAddressPrefix\\n      ]\\n    }\\n    subnets: [\\n      { \\n        name: 'snet-training'\\n        properties: {\\n          addressPrefix: trainingSubnetPrefix\\n          privateEndpointNetworkPolicies: 'Disabled'\\n          privateLinkServiceNetworkPolicies: 'Disabled'\\n          networkSecurityGroup: {\\n            id: networkSecurityGroupId\\n          }\\n        }\\n      }\\n      { \\n        name: 'snet-scoring'\\n        properties: {\\n          addressPrefix: scoringSubnetPrefix\\n          privateEndpointNetworkPolicies: 'Disabled'\\n          privateLinkServiceNetworkPolicies: 'Disabled'\\n          serviceEndpoints: [\\n            {\\n              service: 'Microsoft.KeyVault'\\n            }\\n            {\\n              service: 'Microsoft.ContainerRegistry'\\n            }\\n            {\\n              service: 'Microsoft.Storage'\\n            }\\n          ]\\n          networkSecurityGroup: {\\n            id: networkSecurityGroupId\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\noutput id string = virtualNetwork.id\\noutput name string = virtualNetwork.name\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"{}\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"networkSecurityGroupId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"192.168.0.0/16\\\"\\n    },\\n    \\\"trainingSubnetPrefix\\\": {\\n      \\\"value\\\": \\\"192.168.0.0/24\\\"\\n    },\\n    \\\"scoringSubnetPrefix\\\": {\\n      \\\"value\\\": \\\"192.168.1.0/24\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Creates a machine learning workspace, private endpoints and compute resources\\n// Compute resources include a GPU cluster, CPU cluster, compute instance and attached private AKS cluster\\n@description('Prefix for resource names')\\nparam prefix string\\n\\n@description('Azure region of the deployment')\\nparam location string\\n\\n@description('Tags to add to the resources')\\nparam tags object\\n\\n@description('Machine learning workspace name')\\nparam machineLearningName string\\n\\n@description('Machine learning workspace display name')\\nparam machineLearningFriendlyName string = machineLearningName\\n\\n@description('Machine learning workspace description')\\nparam machineLearningDescription string\\n\\n@description('Name of the Azure Kubernetes services resource to create and attached to the machine learning workspace')\\nparam mlAksName string\\n\\n@description('Resource ID of the application insights resource')\\nparam applicationInsightsId string\\n\\n@description('Resource ID of the container registry resource')\\nparam containerRegistryId string\\n\\n@description('Resource ID of the key vault resource')\\nparam keyVaultId string\\n\\n@description('Resource ID of the storage account resource')\\nparam storageAccountId string\\n\\n@description('Resource ID of the subnet resource')\\nparam subnetId string\\n\\n@description('Resource ID of the compute subnet')\\nparam computeSubnetId string\\n\\n@description('Resource ID of the Azure Kubernetes services resource')\\nparam aksSubnetId string\\n\\n@description('Resource ID of the virtual network')\\nparam virtualNetworkId string\\n\\n@description('Machine learning workspace private link endpoint name')\\nparam machineLearningPleName string\\n\\n@description('Enable public IP for Azure Machine Learning compute nodes')\\nparam amlComputePublicIp bool = true\\n\\n@description('VM size for the default compute cluster')\\nparam vmSizeParam string\\n \\nresource machineLearning 'Microsoft.MachineLearningServices/workspaces@2022-05-01' = {\\n  name: machineLearningName\\n  location: location\\n  tags: tags\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  properties: {\\n    // workspace organization\\n    friendlyName: machineLearningFriendlyName\\n    description: machineLearningDescription\\n\\n    // dependent resources\\n    applicationInsights: applicationInsightsId\\n    containerRegistry: containerRegistryId\\n    keyVault: keyVaultId\\n    storageAccount: storageAccountId\\n\\n    // configuration for workspaces with private link endpoint\\n    imageBuildCompute: 'cluster001'\\n    publicNetworkAccess: 'Disabled'\\n    v1LegacyMode: true\\n  }\\n}\\n\\nmodule machineLearningPrivateEndpoint 'machinelearningnetworking.bicep' = {\\n  name: 'machineLearningNetworking'\\n  scope: resourceGroup()\\n  params: {\\n    location: location\\n    tags: tags\\n    virtualNetworkId: virtualNetworkId\\n    workspaceArmId: machineLearning.id\\n    subnetId: subnetId\\n    machineLearningPleName: machineLearningPleName\\n  }\\n}\\n\\nmodule machineLearningCompute 'machinelearningcompute.bicep' = {\\n  name: 'machineLearningComputes'\\n  scope: resourceGroup()\\n  params: {\\n    machineLearning: machineLearningName\\n    location: location\\n    computeSubnetId:computeSubnetId\\n    aksName: mlAksName\\n    aksSubnetId: aksSubnetId\\n    prefix: prefix\\n    tags: tags\\n    amlComputePublicIp: amlComputePublicIp\\n    vmSizeParam: vmSizeParam\\n  }\\n  dependsOn: [\\n    machineLearning\\n    machineLearningPrivateEndpoint\\n  ]\\n}\\n\\noutput machineLearningId string = machineLearning.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"prefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"machineLearningName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"machineLearningFriendlyName\\\": {\\n      \\\"value\\\": \\\"machineLearningName\\\"\\n    },\\n    \\\"machineLearningDescription\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"mlAksName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"applicationInsightsId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"containerRegistryId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"keyVaultId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"storageAccountId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"computeSubnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aksSubnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualNetworkId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"machineLearningPleName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"amlComputePublicIp\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"vmSizeParam\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies the name of the Azure Machine Learning workspace where job will be created.')\\nparam workspaceName string\\n\\n@description('Specifies the name of the Azure Machine Learning compute instance/cluster on which job will be run.')\\nparam computeName string\\n\\n@description('Specifies the name of the Azure Machine Learning experiment under which job will be created.')\\nparam experimentName string\\n\\n@description('Specifies the name of the Azure Machine Learning job to be created.')\\nparam jobName string\\n\\n@description('The base URI where artifacts required by this template are located including a trailing \\\\'/\\\\'.')\\nparam _artifactsLocation string = deployment().properties.templateLink.uri\\n\\n@description('The sasToken required to access _artifactsLocation.')\\n@secure()\\nparam _artifactsLocationSasToken string = ''\\n\\n@description('Specifies execution contraints for the job.')\\nparam limitSettings object = {\\n  maxTrials: 5\\n  maxConcurrentTrials: 1\\n  maxCoresPerTrial: -1\\n  enableEarlyTermination: true\\n  timeout: 'PT10H'\\n  trialTimeout: 'PT20M'\\n}\\n\\n@description('Specifies training related configuration for the job.')\\nparam trainingSettings object = {\\n  blockedTrainingAlgorithms: [\\n    'LogisticRegression'\\n  ]\\n  enableModelExplainability: true\\n  enableOnnxCompatibleModels: false\\n  enableStackEnsemble: true\\n  enableVoteEnsemble: true\\n  ensembleModelDownloadTimeout: 'PT5M'\\n  enableDnnTraining: false\\n}\\n\\nvar compute = resourceId('Microsoft.MachineLearningServices/workspaces/computes', workspaceName, computeName)\\n\\nresource jobResource 'Microsoft.MachineLearningServices/workspaces/jobs@2022-06-01-preview' = {\\n  name: '${workspaceName}/${jobName}'\\n  properties: {\\n    jobType: 'AutoML'\\n    tags: {\\n      referenceNotebook: 'https://github.com/Azure/azureml-examples/blob/main/sdk/jobs/automl-standalone-jobs/automl-classification-task-bankmarketing'\\n    }\\n    experimentName: experimentName\\n    computeId: compute\\n    taskDetails: {\\n      logVerbosity: 'Info'\\n      taskType: 'Classification'\\n      primaryMetric: 'Accuracy'\\n      targetColumnName: 'y'\\n      trainingData: {\\n        uri: uri(_artifactsLocation, 'data/training-mltable-folder/${_artifactsLocationSasToken}')\\n        jobInputType: 'MLTable'\\n      }\\n      validationData: {\\n        uri: uri(_artifactsLocation, 'data/validation-mltable-folder/${_artifactsLocationSasToken}')\\n        jobInputType: 'MLTable'\\n      }\\n      featurizationSettings: {\\n        mode: 'auto'\\n      }\\n      limitSettings: limitSettings\\n      trainingSettings: trainingSettings\\n    }\\n  }\\n}\\n\\noutput Job_Studio_Endpoint string = jobResource.properties.services.Studio.endpoint\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"workspaceName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"computeName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"experimentName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"jobName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"_artifactsLocation\\\": {\\n      \\\"value\\\": \\\"deployment().properties.templateLink.uri\\\"\\n    },\\n    \\\"_artifactsLocationSasToken\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"limitSettings\\\": {\\n      \\\"value\\\": \\\"{\\\"\\n    },\\n    \\\"trainingSettings\\\": {\\n      \\\"value\\\": \\\"{\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// Creates AI services resources, private endpoints, and DNS zones\\n@description('Azure region of the deployment')\\nparam location string\\n\\n@description('Tags to add to the resources')\\nparam tags object\\n\\n@description('Name of the AI service')\\nparam aiServiceName string\\n\\n@description('Name of the AI service private link endpoint for cognitive services')\\nparam aiServicesPleName string\\n\\n@description('Resource ID of the subnet')\\nparam subnetId string\\n\\n@description('Resource ID of the virtual network')\\nparam virtualNetworkId string\\n\\n@allowed([\\n  'S0'\\n])\\n\\n@description('AI service SKU')\\nparam aiServiceSkuName string = 'S0'\\n\\nvar aiServiceNameCleaned = replace(aiServiceName, '-', '')\\n\\nvar cognitiveServicesPrivateDnsZoneName = 'privatelink.cognitiveservices.azure.com'\\nvar openAiPrivateDnsZoneName = 'privatelink.openai.azure.com'\\n\\nresource aiServices 'Microsoft.CognitiveServices/accounts@2023-05-01' = {\\n  name: aiServiceNameCleaned\\n  location: location\\n  sku: {\\n    name: aiServiceSkuName\\n  }\\n  kind: 'AIServices'\\n  properties: {\\n    publicNetworkAccess: 'Disabled'\\n    disableLocalAuth: true\\n    apiProperties: {\\n      statisticsEnabled: false\\n    }\\n    networkAcls: {\\n      defaultAction: 'Deny'\\n      virtualNetworkRules: [\\n        {\\n          id: subnetId\\n          ignoreMissingVnetServiceEndpoint: true\\n        }\\n      ]\\n    }\\n    customSubDomainName: aiServiceNameCleaned\\n  }\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n}\\n\\nresource aiServicesPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-11-01' = {\\n  name: aiServicesPleName\\n  location: location\\n  tags: tags\\n  properties: {\\n    privateLinkServiceConnections: [\\n      { \\n        name: aiServicesPleName\\n        properties: {\\n          groupIds: [\\n            'account'\\n          ]\\n          privateLinkServiceId: aiServices.id\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: subnetId\\n    }\\n  }\\n}\\n\\nresource cognitiveServicesPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: cognitiveServicesPrivateDnsZoneName\\n  location: 'global'\\n}\\n\\nresource openAiPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\\n  name: openAiPrivateDnsZoneName\\n  location: 'global'\\n}\\n\\nresource cognitiveServicesVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: cognitiveServicesPrivateDnsZone\\n  name: uniqueString(virtualNetworkId)\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: virtualNetworkId\\n    }\\n  }\\n}\\n\\nresource openAiVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\\n  parent: openAiPrivateDnsZone\\n  name: uniqueString(virtualNetworkId)\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: virtualNetworkId\\n    }\\n  }\\n}\\n\\nresource aiServicesPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-11-01' = {\\n  parent: aiServicesPrivateEndpoint\\n  name: 'default'\\n  properties:{\\n    privateDnsZoneConfigs: [\\n      {\\n        name: replace(openAiPrivateDnsZoneName, '.', '-')\\n        properties:{\\n          privateDnsZoneId: openAiPrivateDnsZone.id\\n        }\\n      }\\n      {\\n        name: replace(cognitiveServicesPrivateDnsZoneName, '.', '-')\\n        properties:{\\n          privateDnsZoneId: cognitiveServicesPrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\noutput aiServicesId string = aiServices.id\\noutput aiServicesEndpoint string = aiServices.properties.endpoint\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"tags\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServiceName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServicesPleName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualNetworkId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aiServiceSkuName\\\": {\\n      \\\"value\\\": \\\"S0\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies the name of the deployment.')\\nparam name string\\n\\n@description('Specifies the name of the environment.')\\nparam environment string\\n\\n@description('Specifies the location of the Azure Machine Learning workspace and dependent resources.')\\n@allowed([\\n  'australiaeast'\\n  'brazilsouth'\\n  'canadacentral'\\n  'centralus'\\n  'eastasia'\\n  'eastus'\\n  'eastus2'\\n  'francecentral'\\n  'japaneast'\\n  'koreacentral'\\n  'northcentralus'\\n  'northeurope'\\n  'southeastasia'\\n  'southcentralus'\\n  'uksouth'\\n  'westcentralus'\\n  'westus'\\n  'westus2'\\n  'westeurope'\\n  'usgovvirginia'\\n])\\nparam location string\\n\\nvar tenantId = subscription().tenantId\\nvar storageAccountName = 'st${name}${environment}'\\nvar keyVaultName = 'kv-${name}-${environment}'\\nvar applicationInsightsName = 'appi-${name}-${environment}'\\nvar containerRegistryName = 'cr${name}${environment}'\\nvar workspaceName = 'mlw${name}${environment}'\\nvar storageAccountId = storageAccount.id\\nvar keyVaultId = vault.id\\nvar applicationInsightId = applicationInsight.id\\nvar containerRegistryId = registry.id\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: 'Standard_RAGRS'\\n  }\\n  kind: 'StorageV2'\\n  properties: {\\n    encryption: {\\n      services: {\\n        blob: {\\n          enabled: true\\n        }\\n        file: {\\n          enabled: true\\n        }\\n      }\\n      keySource: 'Microsoft.Storage'\\n    }\\n    supportsHttpsTrafficOnly: true\\n    minimumTlsVersion: 'TLS1_2'\\n    allowBlobPublicAccess: false\\n    networkAcls: {\\n      defaultAction: 'Deny'\\n    }\\n  }\\n}\\n\\nresource vault 'Microsoft.KeyVault/vaults@2022-07-01' = {\\n  name: keyVaultName\\n  location: location\\n  properties: {\\n    tenantId: tenantId\\n    sku: {\\n      name: 'standard'\\n      family: 'A'\\n    }\\n    accessPolicies: []\\n    enableSoftDelete: true\\n  }\\n}\\n\\nresource applicationInsight 'Microsoft.Insights/components@2020-02-02' = {\\n  name: applicationInsightsName\\n  location: location\\n  kind: 'web'\\n  properties: {\\n    Application_Type: 'web'\\n  }\\n}\\n\\nresource registry 'Microsoft.ContainerRegistry/registries@2022-02-01-preview' = {\\n  sku: {\\n    name: 'Standard'\\n  }\\n  name: containerRegistryName\\n  location: location\\n  properties: {\\n    adminUserEnabled: false\\n  }\\n}\\n\\nresource workspace 'Microsoft.MachineLearningServices/workspaces@2022-10-01' = {\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  name: workspaceName\\n  location: location\\n  properties: {\\n    friendlyName: workspaceName\\n    storageAccount: storageAccountId\\n    keyVault: keyVaultId\\n    applicationInsights: applicationInsightId\\n    containerRegistry: containerRegistryId\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"name\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"environment\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name for your Azure Maps account. This value must be globally unique.')\\nparam accountName string = uniqueString(resourceGroup().id)\\n\\n@description('Specifies the location for all the resources.')\\n@allowed([\\n  'westeurope'\\n  'eastus'\\n  'westus2'\\n  'northeurope'\\n  'westcentralus'\\n  'usgovvirginia'\\n  'usgovarizona'\\n])\\nparam location string\\n\\n@description('The pricing tier SKU for the account.')\\n@allowed([\\n  'G2'\\n])\\nparam pricingTier string = 'G2'\\n\\n@description('The pricing tier for the account.')\\n@allowed([\\n  'Gen2'\\n])\\nparam kind string = 'Gen2'\\n\\nresource account 'Microsoft.Maps/accounts@2023-06-01' = {\\n  name: accountName\\n  location: location\\n  sku: {\\n    name: pricingTier\\n  }\\n  kind: kind\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"accountName\\\": {\\n      \\\"value\\\": \\\"uniqueString(resourceGroup().id)\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"pricingTier\\\": {\\n      \\\"value\\\": \\\"G2\\\"\\n    },\\n    \\\"kind\\\": {\\n      \\\"value\\\": \\\"Gen2\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Region where the Mobile Network will be deployed (must match the resource group region)')\\nparam location string = resourceGroup().location\\n\\n@description('The name for the private mobile network')\\nparam mobileNetworkName string\\n\\n@description('The mobile country code for the private mobile network')\\nparam mobileCountryCode string = '001'\\n\\n@description('The mobile network code for the private mobile network')\\nparam mobileNetworkCode string = '01'\\n\\n@description('The name for the AzureStackEdgeName')\\nparam azureStackEdgeName string\\n\\n@description('The name of the data network')\\nparam dataNetworkName string = 'internet'\\n\\nresource exampleAzureStackEdge 'Microsoft.DataBoxEdge/DataBoxEdgeDevices@2022-03-01' = {\\n  name: azureStackEdgeName\\n  location: location\\n  sku: {\\n    name: 'Management'\\n    tier: 'Standard'\\n  }\\n}\\n\\n#disable-next-line BCP081\\nresource exampleMobileNetwork 'Microsoft.MobileNetwork/mobileNetworks@2023-09-01' = {\\n  name: mobileNetworkName\\n  location: location\\n  properties: {\\n    publicLandMobileNetworkIdentifier: {\\n      mcc: mobileCountryCode\\n      mnc: mobileNetworkCode\\n    }\\n  }\\n}\\n\\n#disable-next-line BCP081\\nresource exampleDataNetwork 'Microsoft.MobileNetwork/mobileNetworks/dataNetworks@2023-09-01' = {\\n  parent: exampleMobileNetwork\\n  name: dataNetworkName\\n  location: location\\n  properties: {}\\n}\\n\\noutput aseID string = exampleAzureStackEdge.id\\noutput existingMobileNetworkName string = mobileNetworkName\\noutput existingDataNetworkName string = dataNetworkName\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"mobileNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"mobileCountryCode\\\": {\\n      \\\"value\\\": \\\"001\\\"\\n    },\\n    \\\"mobileNetworkCode\\\": {\\n      \\\"value\\\": \\\"01\\\"\\n    },\\n    \\\"azureStackEdgeName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dataNetworkName\\\": {\\n      \\\"value\\\": \\\"internet\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Security Type of the Virtual Machine.')\\n@allowed([\\n  'Standard'\\n  'TrustedLaunch'\\n])\\nparam securityType string = 'TrustedLaunch'\\n\\n@description('Specifies the location of AKS cluster.')\\nparam location string = resourceGroup().location\\n\\n@description('Specifies the name of the AKS cluster.')\\nparam aksClusterName string = 'aks-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specifies the DNS prefix specified when creating the managed cluster.')\\nparam aksClusterDnsPrefix string = aksClusterName\\n\\n@description('Specifies the tags of the AKS cluster.')\\nparam aksClusterTags object = {\\n  resourceType: 'AKS Cluster'\\n  createdBy: 'ARM Template'\\n}\\n\\n@description('Specifies the network plugin used for building Kubernetes network. - azure or kubenet.')\\n@allowed([\\n  'azure'\\n  'kubenet'\\n])\\nparam aksClusterNetworkPlugin string = 'azure'\\n\\n@description('Specifies the network policy used for building Kubernetes network. - calico or azure')\\n@allowed([\\n  'azure'\\n  'calico'\\n])\\nparam aksClusterNetworkPolicy string = 'azure'\\n\\n@description('Specifies the CIDR notation IP range from which to assign pod IPs when kubenet is used.')\\nparam aksClusterPodCidr string = '10.244.0.0/16'\\n\\n@description('A CIDR notation IP range from which to assign service cluster IPs. It must not overlap with any Subnet IP ranges.')\\nparam aksClusterServiceCidr string = '10.3.0.0/16'\\n\\n@description('Specifies the IP address assigned to the Kubernetes DNS service. It must be within the Kubernetes service address range specified in serviceCidr.')\\nparam aksClusterDnsServiceIP string = '10.3.0.10'\\n\\n@description('Specifies the sku of the load balancer used by the virtual machine scale sets used by nodepools.')\\n@allowed([\\n  'basic'\\n  'standard'\\n])\\nparam aksClusterLoadBalancerSku string = 'standard'\\n\\n@description('Specifies outbound (egress) routing method. - loadBalancer or userDefinedRouting.')\\n@allowed([\\n  'loadBalancer'\\n  'userDefinedRouting'\\n])\\nparam aksClusterOutboundType string = 'loadBalancer'\\n\\n@description('Specifies the tier of a managed cluster SKU: Automatic or Base')\\n@allowed([\\n  'Automatic'\\n  'Base'\\n])\\nparam aksClusterSkuName string = 'Base'\\n\\n@description('Specifies the tier of a managed cluster SKU: Free, Premium or Standard')\\n@allowed([\\n  'Free'\\n  'Premium'\\n  'Standard'\\n])\\nparam aksClusterSkuTier string = 'Standard'\\n\\n@description('Specifies the administrator username of Linux virtual machines.')\\nparam aksClusterAdminUsername string\\n\\n@description('Specifies the SSH RSA public key string for the Linux nodes.')\\nparam aksClusterSshPublicKey string\\n\\n@description('Specifies whether to create the cluster as a private cluster or not.')\\nparam aksClusterEnablePrivateCluster bool = false\\n\\n@description('Specifies the unique name of of the system node pool profile in the context of the subscription and resource group.')\\nparam systemNodePoolName string = 'system'\\n\\n@description('Specifies the vm size of nodes in the system node pool.')\\nparam systemNodePoolVmSize string = 'Standard_D16s_v3'\\n\\n@description('Specifies the OS Disk Size in GB to be used to specify the disk size for every machine in the system agent pool. If you specify 0, it will apply the default osDisk size according to the vmSize specified..')\\nparam systemNodePoolOsDiskSizeGB int = 100\\n\\n@description('Specifies the number of agents (VMs) to host docker containers in the system node pool. Allowed values must be in the range of 1 to 100 (inclusive). The default value is 1.')\\nparam systemNodePoolAgentCount int = 3\\n\\n@description('Specifies the OS type for the vms in the system node pool. Choose from Linux and Windows. Default to Linux.')\\n@allowed([\\n  'Linux'\\n  'Windows'\\n])\\nparam systemNodePoolOsType string = 'Linux'\\n\\n@description('Specifies the maximum number of pods that can run on a node in the system node pool. The maximum number of pods per node in an AKS cluster is 250. The default maximum number of pods per node varies between kubenet and Azure CNI networking, and the method of cluster deployment.')\\nparam systemNodePoolMaxPods int = 30\\n\\n@description('Specifies the maximum number of nodes for auto-scaling for the system node pool.')\\nparam systemNodePoolMaxCount int = 5\\n\\n@description('Specifies the minimum number of nodes for auto-scaling for the system node pool.')\\nparam systemNodePoolMinCount int = 3\\n\\n@description('Specifies whether to enable auto-scaling for the system node pool.')\\nparam systemNodePoolEnableAutoScaling bool = true\\n\\n@description('Specifies the virtual machine scale set priority in the system node pool: Spot or Regular.')\\n@allowed([\\n  'Spot'\\n  'Regular'\\n])\\nparam systemNodePoolScaleSetPriority string = 'Regular'\\n\\n@description('Specifies the ScaleSetEvictionPolicy to be used to specify eviction policy for spot virtual machine scale set. Default to Delete. Allowed values are Delete or Deallocate.')\\n@allowed([\\n  'Delete'\\n  'Deallocate'\\n])\\nparam systemNodePoolScaleSetEvictionPolicy string = 'Delete'\\n\\n@description('Specifies the type for the system node pool: VirtualMachineScaleSets or AvailabilitySet')\\n@allowed([\\n  'VirtualMachineScaleSets'\\n  'AvailabilitySet'\\n])\\nparam systemNodePoolType string = 'VirtualMachineScaleSets'\\n\\n@description('Specifies the unique name of of the user node pool profile in the context of the subscription and resource group.')\\nparam userNodePoolName string = 'user'\\n\\n@description('Specifies the vm size of nodes in the user node pool.')\\nparam userNodePoolVmSize string = 'Standard_D16s_v3'\\n\\n@description('Specifies the OS Disk Size in GB to be used to specify the disk size for every machine in the system agent pool. If you specify 0, it will apply the default osDisk size according to the vmSize specified..')\\nparam userNodePoolOsDiskSizeGB int = 100\\n\\n@description('Specifies the number of agents (VMs) to host docker containers in the user node pool. Allowed values must be in the range of 1 to 100 (inclusive). The default value is 1.')\\nparam userNodePoolAgentCount int = 3\\n\\n@description('Specifies the OS type for the vms in the user node pool. Choose from Linux and Windows. Default to Linux.')\\n@allowed([\\n  'Linux'\\n  'Windows'\\n])\\nparam userNodePoolOsType string = 'Linux'\\n\\n@description('Specifies the maximum number of pods that can run on a node in the user node pool. The maximum number of pods per node in an AKS cluster is 250. The default maximum number of pods per node varies between kubenet and Azure CNI networking, and the method of cluster deployment.')\\nparam userNodePoolMaxPods int = 30\\n\\n@description('Specifies the maximum number of nodes for auto-scaling for the user node pool.')\\nparam userNodePoolMaxCount int = 5\\n\\n@description('Specifies the minimum number of nodes for auto-scaling for the user node pool.')\\nparam userNodePoolMinCount int = 3\\n\\n@description('Specifies whether to enable auto-scaling for the user node pool.')\\nparam userNodePoolEnableAutoScaling bool = true\\n\\n@description('Specifies the virtual machine scale set priority in the user node pool: Spot or Regular.')\\n@allowed([\\n  'Spot'\\n  'Regular'\\n])\\nparam userNodePoolScaleSetPriority string = 'Regular'\\n\\n@description('Specifies the ScaleSetEvictionPolicy to be used to specify eviction policy for spot virtual machine scale set. Default to Delete. Allowed values are Delete or Deallocate.')\\n@allowed([\\n  'Delete'\\n  'Deallocate'\\n])\\nparam userNodePoolScaleSetEvictionPolicy string = 'Delete'\\n\\n@description('Specifies the type for the user node pool: VirtualMachineScaleSets or AvailabilitySet')\\n@allowed([\\n  'VirtualMachineScaleSets'\\n  'AvailabilitySet'\\n])\\nparam userNodePoolType string = 'VirtualMachineScaleSets'\\n\\n@description('Specifies whether the httpApplicationRouting add-on is enabled or not.')\\nparam httpApplicationRoutingEnabled bool = false\\n\\n@description('Specifies whether the aciConnectorLinux add-on is enabled or not.')\\nparam aciConnectorLinuxEnabled bool = false\\n\\n@description('Specifies whether the azurepolicy add-on is enabled or not.')\\nparam azurePolicyEnabled bool = true\\n\\n@description('Specifies whether the kubeDashboard add-on is enabled or not.')\\nparam kubeDashboardEnabled bool = false\\n\\n@description('Specifies whether the pod identity addon is enabled..')\\nparam podIdentityProfileEnabled bool = false\\n\\n@description('Specifies the scan interval of the auto-scaler of the AKS cluster.')\\nparam autoScalerProfileScanInterval string = '10s'\\n\\n@description('Specifies the scale down delay after add of the auto-scaler of the AKS cluster.')\\nparam autoScalerProfileScaleDownDelayAfterAdd string = '10m'\\n\\n@description('Specifies the scale down delay after delete of the auto-scaler of the AKS cluster.')\\nparam autoScalerProfileScaleDownDelayAfterDelete string = '20s'\\n\\n@description('Specifies scale down delay after failure of the auto-scaler of the AKS cluster.')\\nparam autoScalerProfileScaleDownDelayAfterFailure string = '3m'\\n\\n@description('Specifies the scale down unneeded time of the auto-scaler of the AKS cluster.')\\nparam autoScalerProfileScaleDownUnneededTime string = '10m'\\n\\n@description('Specifies the scale down unready time of the auto-scaler of the AKS cluster.')\\nparam autoScalerProfileScaleDownUnreadyTime string = '20m'\\n\\n@description('Specifies the utilization threshold of the auto-scaler of the AKS cluster.')\\nparam autoScalerProfileUtilizationThreshold string = '0.5'\\n\\n@description('Specifies the max graceful termination time interval in seconds for the auto-scaler of the AKS cluster.')\\nparam autoScalerProfileMaxGracefulTerminationSec string = '600'\\n\\n@description('Specifies the name of the virtual network.')\\nparam virtualNetworkName string = '${aksClusterName}Vnet'\\n\\n@description('Specifies the address prefixes of the virtual network.')\\nparam virtualNetworkAddressPrefixes string = '10.0.0.0/8'\\n\\n@description('Specifies the name of the subnet hosting the system node pool of the AKS cluster.')\\nparam aksSubnetName string = 'AksSubnet'\\n\\n@description('Specifies the address prefix of the subnet hosting the system node pool of the AKS cluster.')\\nparam aksSubnetAddressPrefix string = '10.0.0.0/16'\\n\\n@description('Specifies the name of the Log Analytics Workspace.')\\nparam logAnalyticsWorkspaceName string = '${aksClusterName}Workspace'\\n\\n@description('Specifies the service tier of the workspace: Free, Standalone, PerNode, Per-GB.')\\n@allowed([\\n  'Free'\\n  'Standalone'\\n  'PerNode'\\n  'PerGB2018'\\n])\\nparam logAnalyticsSku string = 'PerGB2018'\\n\\n@description('Specifies the workspace data retention in days. -1 means Unlimited retention for the Unlimited Sku. 730 days is the maximum allowed for all other Skus.')\\nparam logAnalyticsRetentionInDays int = 60\\n\\n@description('Specifies the name of the subnet which contains the virtual machine.')\\nparam vmSubnetName string = 'VmSubnet'\\n\\n@description('Specifies the address prefix of the subnet which contains the virtual machine.')\\nparam vmSubnetAddressPrefix string = '10.1.0.0/16'\\n\\n@description('Specifies the name of the subnet which contains the the Application Gateway.')\\nparam applicationGatewaySubnetName string = 'AppGatewaySubnet'\\n\\n@description('Specifies the address prefix of the subnet which contains the Application Gateway.')\\nparam applicationGatewaySubnetAddressPrefix string = '10.2.0.0/24'\\n\\n@description('Specifies the name of the virtual machine.')\\nparam vmName string = 'TestVm'\\n\\n@description('Specifies the size of the virtual machine.')\\nparam vmSize string = 'Standard_D4s_v3'\\n\\n@description('The publisher of the image from which to launch the virtual machine.')\\nparam imagePublisher string = 'Canonical'\\n\\n@description('The offer of the image from which to launch the virtual machine.')\\nparam imageOffer string = '0001-com-ubuntu-server-jammy'\\n\\n@description('The SKU of the image from which to launch the virtual machine.')\\nparam imageSku string = '22_04-lts-gen2'\\n\\n@description('Specifies the type of authentication when accessing the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'password'\\n\\n@description('Specifies the name of the administrator account of the virtual machine.')\\nparam vmAdminUsername string\\n\\n@description('Specifies the SSH Key or password for the virtual machine. SSH key is recommended.')\\n@secure()\\nparam vmAdminPasswordOrKey string\\n\\n@description('Specifies the storage account type for OS and data disk.')\\n@allowed([\\n  'Premium_LRS'\\n  'Premium_ZRS'\\n  'StandardSSD_LRS'\\n  'StandardSSD_ZRS'\\n  'Standard_LRS'\\n])\\nparam diskStorageAccounType string = 'Premium_LRS'\\n\\n@description('Specifies the number of data disks of the virtual machine.')\\n@minValue(0)\\n@maxValue(64)\\nparam numDataDisks int = 1\\n\\n@description('Specifies the size in GB of the OS disk of the VM.')\\nparam osDiskSize int = 50\\n\\n@description('Specifies the size in GB of the OS disk of the virtual machine.')\\nparam dataDiskSize int = 50\\n\\n@description('Specifies the caching requirements for the data disks.')\\nparam dataDiskCaching string = 'ReadWrite'\\n\\n@description('Specifies the globally unique name for the storage account used to store the boot diagnostics logs of the virtual machine.')\\nparam blobStorageAccountName string = 'boot${uniqueString(resourceGroup().id)}'\\n\\n@description('Specifies the name of the private link to the boot diagnostics storage account.')\\nparam blobStorageAccountPrivateEndpointName string = 'BlobStorageAccountPrivateEndpoint'\\n\\n@description('Specifies the name of the private link to the Azure Container Registry.')\\nparam acrPrivateEndpointName string = 'AcrPrivateEndpoint'\\n\\n@description('Name of your Azure Container Registry')\\n@minLength(5)\\n@maxLength(50)\\nparam acrName string = 'acr${uniqueString(resourceGroup().id)}'\\n\\n@description('Enable admin user that have push / pull permission to the registry.')\\nparam acrAdminUserEnabled bool = false\\n\\n@description('The default action of allow or deny when no other rules match. Allowed values: Allow or Deny')\\n@allowed([\\n  'Allow'\\n  'Deny'\\n])\\nparam acrNetworkRuleSetDefaultAction string = 'Deny'\\n\\n@description('Whether or not public network access is allowed for the container registry. Allowed values: Enabled or Disabled')\\n@allowed([\\n  'Enabled'\\n  'Disabled'\\n])\\nparam acrPublicNetworkAccess string = 'Enabled'\\n\\n@description('Tier of your Azure Container Registry.')\\n@allowed([\\n  'Basic'\\n  'Standard'\\n  'Premium'\\n])\\nparam acrSku string = 'Premium'\\n\\n@description('Specifies the Bastion subnet IP prefix. This prefix must be within vnet IP prefix address space.')\\nparam bastionSubnetAddressPrefix string = '10.2.1.0/24'\\n\\n@description('Specifies the name of the Azure Bastion resource.')\\nparam bastionHostName string = '${aksClusterName}Bastion'\\n\\n@description('Specifies the name of the private link to the Key Vault.')\\nparam keyVaultPrivateEndpointName string = 'KeyVaultPrivateEndpoint'\\n\\n@description('Specifies the name of the Key Vault resource.')\\nparam keyVaultName string = 'keyvault-${uniqueString(resourceGroup().id)}'\\n\\n@description('The default action of allow or deny when no other rules match. Allowed values: Allow or Deny')\\n@allowed([\\n  'Allow'\\n  'Deny'\\n])\\nparam keyVaultNetworkRuleSetDefaultAction string = 'Deny'\\n\\n@description('Specifies the name of the Application Gateway.')\\nparam applicationGatewayName string = 'appgw-${uniqueString(resourceGroup().id)}'\\n\\n@description('Specifies the name of the WAF policy')\\nparam wafPolicyName string = '${applicationGatewayName}WafPolicy'\\n\\n@description('Specifies the mode of the WAF policy.')\\n@allowed([\\n  'Detection'\\n  'Prevention'\\n])\\nparam wafPolicyMode string = 'Prevention'\\n\\n@description('Specifies the state of the WAF policy.')\\n@allowed([\\n  'Enabled'\\n  'Disabled '\\n])\\nparam wafPolicyState string = 'Enabled'\\n\\n@description('Specifies the maximum file upload size in Mb for the WAF policy.')\\nparam wafPolicyFileUploadLimitInMb int = 100\\n\\n@description('Specifies the maximum request body size in Kb for the WAF policy.')\\nparam wafPolicyMaxRequestBodySizeInKb int = 128\\n\\n@description('Specifies the whether to allow WAF to check request Body.')\\nparam wafPolicyRequestBodyCheck bool = true\\n\\n@description('Specifies the rule set type.')\\nparam wafPolicyRuleSetType string = 'OWASP'\\n\\n@description('Specifies the rule set version.')\\nparam wafPolicyRuleSetVersion string = '3.1'\\n\\n\\n@description('Unique name (within the Resource Group) for the Action group.')\\nparam actionGroupName string = 'actiongroup${uniqueString(resourceGroup().id)}'\\n\\n@description('Short name (maximum 12 characters) for the Action group.')\\nparam actionGroupShortName string = 'actiongroup'\\n\\n@description('The list of email receivers that are part of this action group.')\\nparam emailReceivers array = [\\n  {\\n    name: 'contosoEmail'\\n    emailAddress: 'devops@contoso.com'\\n  }\\n]\\n\\n@description('The list of SMS receivers that are part of this action group.')\\nparam smsReceivers array = [\\n  {\\n    name: 'smsReceiver'\\n    countryCode: '1'\\n    phoneNumber: '2134567891'\\n  }\\n]\\n\\n@description('The list of voice receivers that are part of this action group.')\\nparam voiceReceivers array = [\\n  {\\n    name: 'voiceReceiver'\\n    countryCode: '1'\\n    phoneNumber: '2134567891'\\n  }\\n]\\n\\n\\nvar securityProfileJson = {\\n  uefiSettings: {\\n    secureBootEnabled: true\\n    vTpmEnabled: true\\n  }\\n  securityType: securityType\\n}\\nvar extensionName = 'GuestAttestation'\\nvar extensionPublisher = 'Microsoft.Azure.Security.LinuxAttestation'\\nvar extensionVersion = '1.0'\\nvar maaTenantName = 'GuestAttestation'\\nvar readerRoleDefinitionName = 'acdd72a7-3385-48ef-bd42-f606fba81ae7'\\nvar contributorRoleDefinitionName = 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\nvar acrPullRoleDefinitionName = '7f951dda-4ed3-4680-a7ca-43fe172d538d'\\nvar aksClusterUserDefinedManagedIdentityName = '${aksClusterName}ManagedIdentity'\\nvar aadPodIdentityUserDefinedManagedIdentityName = '${aksClusterName}AadPodManagedIdentity'\\nvar vmNicName = '${vmName}Nic'\\nvar blobPublicDNSZoneForwarder = 'blob.${environment().suffixes.storage}'\\nvar blobPrivateDnsZoneName = 'privatelink.${blobPublicDNSZoneForwarder}'\\nvar blobStorageAccountPrivateEndpointGroupName = 'blob'\\nvar blobPrivateDnsZoneGroupName = '${blobStorageAccountPrivateEndpointGroupName}PrivateDnsZoneGroup'\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${vmAdminUsername}/.ssh/authorized_keys'\\n        keyData: vmAdminPasswordOrKey\\n      }\\n    ]\\n  }\\n  provisionVMAgent: true\\n}\\n\\nvar workspaceId = monitoring.outputs.logAnalyticsWorkspaceId\\nvar readerRoleId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', readerRoleDefinitionName)\\nvar contributorRoleId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', contributorRoleDefinitionName)\\nvar acrPullRoleId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', acrPullRoleDefinitionName)\\n\\nvar containerInsightsSolutionName = 'ContainerInsights(${logAnalyticsWorkspaceName})'\\nvar acrPublicDNSZoneForwarder = ((toLower(environment().name) == 'azureusgovernment') ? 'azurecr.us' : 'azurecr.io')\\nvar acrPrivateDnsZoneName = 'privatelink.${acrPublicDNSZoneForwarder}'\\nvar acrPrivateEndpointGroupName = 'registry'\\nvar acrPrivateDnsZoneGroupName = '${acrPrivateEndpointGroupName}PrivateDnsZoneGroup'\\n\\nvar keyVaultPublicDNSZoneForwarder = ((toLower(environment().name) == 'azureusgovernment')\\n  ? '.vaultcore.usgovcloudapi.net'\\n  : '.vaultcore.azure.net')\\nvar keyVaultPrivateDnsZoneName = 'privatelink${keyVaultPublicDNSZoneForwarder}'\\nvar keyVaultPrivateEndpointGroupName = 'vault'\\nvar keyVaultPrivateDnsZoneGroupName = '${keyVaultPrivateEndpointGroupName}PrivateDnsZoneGroup'\\n\\nmodule monitoring 'modules/monitoring/monitoring.bicep' = {\\n  name: 'monitoringComponent'\\n  params: {\\n    location: location\\n    logAnalyticsWorkspaceName: logAnalyticsWorkspaceName\\n    logAnalyticsSku: logAnalyticsSku\\n    logAnalyticsRetentionInDays: logAnalyticsRetentionInDays\\n    containerInsightsSolutionName: containerInsightsSolutionName\\n    actionGroupName: actionGroupName\\n    actionGroupShortName: actionGroupShortName\\n    emailReceivers: emailReceivers\\n    smsReceivers: smsReceivers\\n    voiceReceivers: voiceReceivers\\n  }\\n}\\n\\nmodule identity 'modules/identity/identity.bicep' = {\\n  name: 'identityComponent'\\n  params: {\\n    location: location\\n    applicationGatewayName: applicationGatewayName\\n    aksClusterUserDefinedManagedIdentityName: aksClusterUserDefinedManagedIdentityName\\n    aadPodIdentityUserDefinedManagedIdentityName: aadPodIdentityUserDefinedManagedIdentityName\\n  }\\n}\\n\\nmodule network 'modules/networks/main.bicep' = {\\n  name: 'networkComponent'\\n  params: {\\n    location: location\\n    virtualNetworkName: virtualNetworkName\\n    virtualNetworkAddressPrefixes: virtualNetworkAddressPrefixes\\n    aksSubnetName: aksSubnetName\\n    aksSubnetAddressPrefix: aksSubnetAddressPrefix\\n    vmSubnetName: vmSubnetName\\n    vmSubnetAddressPrefix: vmSubnetAddressPrefix\\n    applicationGatewaySubnetName: applicationGatewaySubnetName\\n    applicationGatewaySubnetAddressPrefix: applicationGatewaySubnetAddressPrefix\\n    bastionSubnetAddressPrefix: bastionSubnetAddressPrefix\\n    bastionHostName: bastionHostName\\n    workspaceId: workspaceId\\n  }\\n}\\n\\nmodule keyvault 'modules/security/keyvault.bicep' = {\\n  name: 'keyVaultComponent'\\n  params: {\\n    location: location\\n    keyVaultName: keyVaultName\\n    aadPodIdentityUserDefinedManagedIdentityTenantId: identity.outputs.aadPodIdentityUserDefinedManagedIdentityTenantId\\n    aadPodIdentityUserDefinedManagedIdentityPrincipalId: identity.outputs.aadPodIdentityUserDefinedManagedIdentityPrincipalId\\n    applicationGatewayUserDefinedManagedIdentityTenantId: identity.outputs.applicationGatewayUserDefinedManagedIdentityTenantId\\n    applicationGatewayUserDefinedManagedIdentityPrincipalId: identity.outputs.applicationGatewayUserDefinedManagedIdentityPrincipalId\\n    keyVaultNetworkRuleSetDefaultAction: keyVaultNetworkRuleSetDefaultAction\\n    workspaceId: workspaceId\\n    readerRoleId: readerRoleId\\n    keyVaultPrivateDnsZoneName: keyVaultPrivateDnsZoneName\\n    virtualNetworkName: virtualNetworkName\\n    virtualNetworkId: network.outputs.virtualNetworkId\\n    privateEndpointSubnetId: network.outputs.vmSubnetId\\n    keyVaultPrivateEndpointName: keyVaultPrivateEndpointName\\n    keyVaultPrivateEndpointGroupName: keyVaultPrivateEndpointGroupName\\n    keyVaultPrivateDnsZoneGroupName: keyVaultPrivateDnsZoneGroupName\\n  }\\n}\\n\\nmodule compute 'modules/computes/virtualmachine.bicep' = {\\n  name: 'virtualMachineComponent'\\n  params: {\\n    location: location\\n    virtualNetworkId: network.outputs.virtualNetworkId\\n    blobStorageAccountName: blobStorageAccountName\\n    blobPrivateDnsZoneName: blobPrivateDnsZoneName\\n    blobStorageAccountPrivateEndpointName: blobStorageAccountPrivateEndpointName\\n    blobStorageAccountPrivateEndpointGroupName: blobStorageAccountPrivateEndpointGroupName\\n    blobPrivateDnsZoneGroupName: blobPrivateDnsZoneGroupName\\n    vmNicName: vmNicName\\n    vmSubnetId: network.outputs.vmSubnetId\\n    vmName: vmName\\n    vmSize: vmSize\\n    vmAdminUsername: vmAdminUsername\\n    vmAdminPasswordOrKey: vmAdminPasswordOrKey\\n    authenticationType: authenticationType\\n    linuxConfiguration: linuxConfiguration\\n    securityType: securityType\\n    securityProfileJson: securityProfileJson\\n    imagePublisher: imagePublisher\\n    imageOffer: imageOffer\\n    imageSku: imageSku\\n    osDiskSize: osDiskSize\\n    diskStorageAccounType: diskStorageAccounType\\n    numDataDisks: numDataDisks\\n    dataDiskCaching: dataDiskCaching\\n    dataDiskSize: dataDiskSize\\n    extensionPublisher: extensionPublisher\\n    extensionName: extensionName\\n    extensionVersion: extensionVersion\\n    maaTenantName: maaTenantName\\n  }\\n}\\n\\nmodule applicateGateway 'modules/networks/applicationgateway.bicep' = {\\n  name: 'applicationGatewayComponent'\\n  params: {\\n    location: location\\n    workspaceId: workspaceId\\n    applicationGatewayName: applicationGatewayName\\n    applicationGatewaySubnetId: network.outputs.applicationGatewaySubnetId\\n    wafPolicyName: wafPolicyName\\n    wafPolicyMode: wafPolicyMode\\n    wafPolicyState: wafPolicyState\\n    wafPolicyFileUploadLimitInMb: wafPolicyFileUploadLimitInMb\\n    wafPolicyMaxRequestBodySizeInKb: wafPolicyMaxRequestBodySizeInKb\\n    wafPolicyRequestBodyCheck: wafPolicyRequestBodyCheck\\n    wafPolicyRuleSetType: wafPolicyRuleSetType\\n    wafPolicyRuleSetVersion: wafPolicyRuleSetVersion\\n    applicationGatewayUserDefinedManagedIdentityId: identity.outputs.applicationGatewayUserDefinedManagedIdentityId\\n  }\\n}\\n\\nmodule kubernetes 'modules/containerservices/kubernetes.bicep' = {\\n  name: 'kubernetesComponent'\\n  params: {\\n    location: location\\n    aksClusterUserDefinedManagedIdentityPrincipalId: identity.outputs.aksClusterUserDefinedManagedIdentityPrincipalId\\n    aksClusterUserDefinedManagedIdentityId: identity.outputs.aksClusterUserDefinedManagedIdentityId\\n    contributorRoleId: contributorRoleId\\n    workspaceId: workspaceId\\n    aksClusterName: aksClusterName\\n    aksClusterTags: aksClusterTags\\n    aksClusterDnsPrefix: aksClusterDnsPrefix\\n    aksClusterSkuName: aksClusterSkuName\\n    aksClusterSkuTier: aksClusterSkuTier\\n    systemNodePoolName: systemNodePoolName\\n    systemNodePoolAgentCount: systemNodePoolAgentCount\\n    systemNodePoolVmSize: systemNodePoolVmSize\\n    systemNodePoolOsDiskSizeGB: systemNodePoolOsDiskSizeGB\\n    aksSubnetId: network.outputs.aksSubnetId\\n    systemNodePoolMaxPods: systemNodePoolMaxPods\\n    systemNodePoolOsType: systemNodePoolOsType\\n    systemNodePoolMaxCount: systemNodePoolMaxCount\\n    systemNodePoolMinCount: systemNodePoolMinCount\\n    systemNodePoolScaleSetPriority: systemNodePoolScaleSetPriority\\n    systemNodePoolScaleSetEvictionPolicy: systemNodePoolScaleSetEvictionPolicy\\n    systemNodePoolEnableAutoScaling: systemNodePoolEnableAutoScaling\\n    systemNodePoolType: systemNodePoolType\\n    userNodePoolName: userNodePoolName\\n    userNodePoolAgentCount: userNodePoolAgentCount\\n    userNodePoolVmSize: userNodePoolVmSize\\n    userNodePoolOsDiskSizeGB: userNodePoolOsDiskSizeGB\\n    userNodePoolMaxPods: userNodePoolMaxPods\\n    userNodePoolOsType: userNodePoolOsType\\n    userNodePoolMaxCount: userNodePoolMaxCount\\n    userNodePoolMinCount: userNodePoolMinCount\\n    userNodePoolScaleSetPriority: userNodePoolScaleSetPriority\\n    userNodePoolScaleSetEvictionPolicy: userNodePoolScaleSetEvictionPolicy\\n    userNodePoolEnableAutoScaling: userNodePoolEnableAutoScaling\\n    userNodePoolType: userNodePoolType\\n    aksClusterAdminUsername: aksClusterAdminUsername\\n    aksClusterSshPublicKey: aksClusterSshPublicKey\\n    httpApplicationRoutingEnabled: httpApplicationRoutingEnabled\\n    aciConnectorLinuxEnabled: aciConnectorLinuxEnabled\\n    azurePolicyEnabled: azurePolicyEnabled\\n    kubeDashboardEnabled: kubeDashboardEnabled\\n    applicationGatewayId: applicateGateway.outputs.applicationGatewayId\\n    podIdentityProfileEnabled: podIdentityProfileEnabled\\n    aksClusterNetworkPlugin: aksClusterNetworkPlugin\\n    aksClusterNetworkPolicy: aksClusterNetworkPolicy\\n    aksClusterPodCidr: aksClusterPodCidr\\n    aksClusterServiceCidr: aksClusterServiceCidr\\n    aksClusterDnsServiceIP: aksClusterDnsServiceIP\\n    aksClusterOutboundType: aksClusterOutboundType\\n    aksClusterLoadBalancerSku: aksClusterLoadBalancerSku\\n    autoScalerProfileScanInterval: autoScalerProfileScanInterval\\n    autoScalerProfileScaleDownDelayAfterAdd: autoScalerProfileScaleDownDelayAfterAdd\\n    autoScalerProfileScaleDownDelayAfterDelete: autoScalerProfileScaleDownDelayAfterDelete\\n    autoScalerProfileScaleDownDelayAfterFailure: autoScalerProfileScaleDownDelayAfterFailure\\n    autoScalerProfileScaleDownUnneededTime: autoScalerProfileScaleDownUnneededTime\\n    autoScalerProfileScaleDownUnreadyTime: autoScalerProfileScaleDownUnreadyTime\\n    autoScalerProfileUtilizationThreshold: autoScalerProfileUtilizationThreshold\\n    autoScalerProfileMaxGracefulTerminationSec: autoScalerProfileMaxGracefulTerminationSec\\n    aksClusterEnablePrivateCluster: aksClusterEnablePrivateCluster\\n  }\\n}\\n\\nmodule containerRegistry 'modules/containerservices/containerregistry.bicep' = {\\n  name: 'containerRegistryComponent'\\n  params: {\\n    location: location\\n    acrName: acrName\\n    acrSku: acrSku\\n    acrAdminUserEnabled: acrAdminUserEnabled\\n    acrNetworkRuleSetDefaultAction: acrNetworkRuleSetDefaultAction\\n    acrPublicNetworkAccess: acrPublicNetworkAccess\\n    acrPullRoleId: acrPullRoleId\\n    aksClusterKubeletidentityObjectId: kubernetes.outputs.aksClusterKubeletidentityObjectId\\n    workspaceId: workspaceId\\n    acrPrivateDnsZoneName: acrPrivateDnsZoneName\\n    virtualNetworkId: network.outputs.virtualNetworkId\\n    acrPrivateEndpointName: acrPrivateEndpointName\\n    acrPrivateEndpointGroupName: acrPrivateEndpointGroupName\\n    privateEndpointSubnetId: network.outputs.vmSubnetId\\n    acrPrivateDnsZoneGroupName: acrPrivateDnsZoneGroupName\\n  }\\n}\\n\\nmodule roleAssignment 'modules/roleassignment/roleassignment.bicep' = {\\n  name: 'roleAssignmentComponent'\\n  params: {\\n    applicationGatewayUserDefinedManagedIdentityId: identity.outputs.applicationGatewayUserDefinedManagedIdentityId\\n    applicationGatewayId: applicateGateway.outputs.applicationGatewayId\\n    aksClusterIngressApplicationGatewayObjectId: kubernetes.outputs.aksClusteringressApplicationGatewayIdentity\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"securityType\\\": {\\n      \\\"value\\\": \\\"TrustedLaunch\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"aksClusterName\\\": {\\n      \\\"value\\\": \\\"aks-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"aksClusterDnsPrefix\\\": {\\n      \\\"value\\\": \\\"aksClusterName\\\"\\n    },\\n    \\\"aksClusterTags\\\": {\\n      \\\"value\\\": \\\"{\\\"\\n    },\\n    \\\"aksClusterNetworkPlugin\\\": {\\n      \\\"value\\\": \\\"azure\\\"\\n    },\\n    \\\"aksClusterNetworkPolicy\\\": {\\n      \\\"value\\\": \\\"azure\\\"\\n    },\\n    \\\"aksClusterPodCidr\\\": {\\n      \\\"value\\\": \\\"10.244.0.0/16\\\"\\n    },\\n    \\\"aksClusterServiceCidr\\\": {\\n      \\\"value\\\": \\\"10.3.0.0/16\\\"\\n    },\\n    \\\"aksClusterDnsServiceIP\\\": {\\n      \\\"value\\\": \\\"10.3.0.10\\\"\\n    },\\n    \\\"aksClusterLoadBalancerSku\\\": {\\n      \\\"value\\\": \\\"standard\\\"\\n    },\\n    \\\"aksClusterOutboundType\\\": {\\n      \\\"value\\\": \\\"loadBalancer\\\"\\n    },\\n    \\\"aksClusterSkuName\\\": {\\n      \\\"value\\\": \\\"Base\\\"\\n    },\\n    \\\"aksClusterSkuTier\\\": {\\n      \\\"value\\\": \\\"Standard\\\"\\n    },\\n    \\\"aksClusterAdminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aksClusterSshPublicKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aksClusterEnablePrivateCluster\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"systemNodePoolName\\\": {\\n      \\\"value\\\": \\\"system\\\"\\n    },\\n    \\\"systemNodePoolVmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D16s_v3\\\"\\n    },\\n    \\\"systemNodePoolOsDiskSizeGB\\\": {\\n      \\\"value\\\": 100\\n    },\\n    \\\"systemNodePoolAgentCount\\\": {\\n      \\\"value\\\": 3\\n    },\\n    \\\"systemNodePoolOsType\\\": {\\n      \\\"value\\\": \\\"Linux\\\"\\n    },\\n    \\\"systemNodePoolMaxPods\\\": {\\n      \\\"value\\\": 30\\n    },\\n    \\\"systemNodePoolMaxCount\\\": {\\n      \\\"value\\\": 5\\n    },\\n    \\\"systemNodePoolMinCount\\\": {\\n      \\\"value\\\": 3\\n    },\\n    \\\"systemNodePoolEnableAutoScaling\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"systemNodePoolScaleSetPriority\\\": {\\n      \\\"value\\\": \\\"Regular\\\"\\n    },\\n    \\\"systemNodePoolScaleSetEvictionPolicy\\\": {\\n      \\\"value\\\": \\\"Delete\\\"\\n    },\\n    \\\"systemNodePoolType\\\": {\\n      \\\"value\\\": \\\"VirtualMachineScaleSets\\\"\\n    },\\n    \\\"userNodePoolName\\\": {\\n      \\\"value\\\": \\\"user\\\"\\n    },\\n    \\\"userNodePoolVmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D16s_v3\\\"\\n    },\\n    \\\"userNodePoolOsDiskSizeGB\\\": {\\n      \\\"value\\\": 100\\n    },\\n    \\\"userNodePoolAgentCount\\\": {\\n      \\\"value\\\": 3\\n    },\\n    \\\"userNodePoolOsType\\\": {\\n      \\\"value\\\": \\\"Linux\\\"\\n    },\\n    \\\"userNodePoolMaxPods\\\": {\\n      \\\"value\\\": 30\\n    },\\n    \\\"userNodePoolMaxCount\\\": {\\n      \\\"value\\\": 5\\n    },\\n    \\\"userNodePoolMinCount\\\": {\\n      \\\"value\\\": 3\\n    },\\n    \\\"userNodePoolEnableAutoScaling\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"userNodePoolScaleSetPriority\\\": {\\n      \\\"value\\\": \\\"Regular\\\"\\n    },\\n    \\\"userNodePoolScaleSetEvictionPolicy\\\": {\\n      \\\"value\\\": \\\"Delete\\\"\\n    },\\n    \\\"userNodePoolType\\\": {\\n      \\\"value\\\": \\\"VirtualMachineScaleSets\\\"\\n    },\\n    \\\"httpApplicationRoutingEnabled\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"aciConnectorLinuxEnabled\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"azurePolicyEnabled\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"kubeDashboardEnabled\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"podIdentityProfileEnabled\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"autoScalerProfileScanInterval\\\": {\\n      \\\"value\\\": \\\"10s\\\"\\n    },\\n    \\\"autoScalerProfileScaleDownDelayAfterAdd\\\": {\\n      \\\"value\\\": \\\"10m\\\"\\n    },\\n    \\\"autoScalerProfileScaleDownDelayAfterDelete\\\": {\\n      \\\"value\\\": \\\"20s\\\"\\n    },\\n    \\\"autoScalerProfileScaleDownDelayAfterFailure\\\": {\\n      \\\"value\\\": \\\"3m\\\"\\n    },\\n    \\\"autoScalerProfileScaleDownUnneededTime\\\": {\\n      \\\"value\\\": \\\"10m\\\"\\n    },\\n    \\\"autoScalerProfileScaleDownUnreadyTime\\\": {\\n      \\\"value\\\": \\\"20m\\\"\\n    },\\n    \\\"autoScalerProfileUtilizationThreshold\\\": {\\n      \\\"value\\\": \\\"0.5\\\"\\n    },\\n    \\\"autoScalerProfileMaxGracefulTerminationSec\\\": {\\n      \\\"value\\\": \\\"600\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"${aksClusterName}Vnet\\\"\\n    },\\n    \\\"virtualNetworkAddressPrefixes\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/8\\\"\\n    },\\n    \\\"aksSubnetName\\\": {\\n      \\\"value\\\": \\\"AksSubnet\\\"\\n    },\\n    \\\"aksSubnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"logAnalyticsWorkspaceName\\\": {\\n      \\\"value\\\": \\\"${aksClusterName}Workspace\\\"\\n    },\\n    \\\"logAnalyticsSku\\\": {\\n      \\\"value\\\": \\\"PerGB2018\\\"\\n    },\\n    \\\"logAnalyticsRetentionInDays\\\": {\\n      \\\"value\\\": 60\\n    },\\n    \\\"vmSubnetName\\\": {\\n      \\\"value\\\": \\\"VmSubnet\\\"\\n    },\\n    \\\"vmSubnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.1.0.0/16\\\"\\n    },\\n    \\\"applicationGatewaySubnetName\\\": {\\n      \\\"value\\\": \\\"AppGatewaySubnet\\\"\\n    },\\n    \\\"applicationGatewaySubnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.2.0.0/24\\\"\\n    },\\n    \\\"vmName\\\": {\\n      \\\"value\\\": \\\"TestVm\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D4s_v3\\\"\\n    },\\n    \\\"imagePublisher\\\": {\\n      \\\"value\\\": \\\"Canonical\\\"\\n    },\\n    \\\"imageOffer\\\": {\\n      \\\"value\\\": \\\"0001-com-ubuntu-server-jammy\\\"\\n    },\\n    \\\"imageSku\\\": {\\n      \\\"value\\\": \\\"22_04-lts-gen2\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"password\\\"\\n    },\\n    \\\"vmAdminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmAdminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"diskStorageAccounType\\\": {\\n      \\\"value\\\": \\\"Premium_LRS\\\"\\n    },\\n    \\\"numDataDisks\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"osDiskSize\\\": {\\n      \\\"value\\\": 50\\n    },\\n    \\\"dataDiskSize\\\": {\\n      \\\"value\\\": 50\\n    },\\n    \\\"dataDiskCaching\\\": {\\n      \\\"value\\\": \\\"ReadWrite\\\"\\n    },\\n    \\\"blobStorageAccountName\\\": {\\n      \\\"value\\\": \\\"boot${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"blobStorageAccountPrivateEndpointName\\\": {\\n      \\\"value\\\": \\\"BlobStorageAccountPrivateEndpoint\\\"\\n    },\\n    \\\"acrPrivateEndpointName\\\": {\\n      \\\"value\\\": \\\"AcrPrivateEndpoint\\\"\\n    },\\n    \\\"acrName\\\": {\\n      \\\"value\\\": \\\"acr${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"acrAdminUserEnabled\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"acrNetworkRuleSetDefaultAction\\\": {\\n      \\\"value\\\": \\\"Deny\\\"\\n    },\\n    \\\"acrPublicNetworkAccess\\\": {\\n      \\\"value\\\": \\\"Enabled\\\"\\n    },\\n    \\\"acrSku\\\": {\\n      \\\"value\\\": \\\"Premium\\\"\\n    },\\n    \\\"bastionSubnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"10.2.1.0/24\\\"\\n    },\\n    \\\"bastionHostName\\\": {\\n      \\\"value\\\": \\\"${aksClusterName}Bastion\\\"\\n    },\\n    \\\"keyVaultPrivateEndpointName\\\": {\\n      \\\"value\\\": \\\"KeyVaultPrivateEndpoint\\\"\\n    },\\n    \\\"keyVaultName\\\": {\\n      \\\"value\\\": \\\"keyvault-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"keyVaultNetworkRuleSetDefaultAction\\\": {\\n      \\\"value\\\": \\\"Deny\\\"\\n    },\\n    \\\"applicationGatewayName\\\": {\\n      \\\"value\\\": \\\"appgw-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"wafPolicyName\\\": {\\n      \\\"value\\\": \\\"${applicationGatewayName}WafPolicy\\\"\\n    },\\n    \\\"wafPolicyMode\\\": {\\n      \\\"value\\\": \\\"Prevention\\\"\\n    },\\n    \\\"wafPolicyState\\\": {\\n      \\\"value\\\": \\\"Enabled\\\"\\n    },\\n    \\\"wafPolicyFileUploadLimitInMb\\\": {\\n      \\\"value\\\": 100\\n    },\\n    \\\"wafPolicyMaxRequestBodySizeInKb\\\": {\\n      \\\"value\\\": 128\\n    },\\n    \\\"wafPolicyRequestBodyCheck\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"wafPolicyRuleSetType\\\": {\\n      \\\"value\\\": \\\"OWASP\\\"\\n    },\\n    \\\"wafPolicyRuleSetVersion\\\": {\\n      \\\"value\\\": \\\"3.1\\\"\\n    },\\n    \\\"actionGroupName\\\": {\\n      \\\"value\\\": \\\"actiongroup${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"actionGroupShortName\\\": {\\n      \\\"value\\\": \\\"actiongroup\\\"\\n    },\\n    \\\"emailReceivers\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"smsReceivers\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"voiceReceivers\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies the location of AKS cluster.')\\nparam location string\\n\\n@description('Specifies the name of the virtual network.')\\nparam virtualNetworkName string\\n\\n@description('Specifies the address prefixes of the virtual network.')\\nparam virtualNetworkAddressPrefixes string\\n\\n@description('Specifies the name of the subnet hosting the system node pool of the AKS cluster.')\\nparam aksSubnetName string\\n\\n@description('Specifies the address prefix of the subnet hosting the system node pool of the AKS cluster.')\\nparam aksSubnetAddressPrefix string\\n\\n@description('Specifies the name of the subnet which contains the virtual machine.')\\nparam vmSubnetName string\\n\\n@description('Specifies the address prefix of the subnet which contains the virtual machine.')\\nparam vmSubnetAddressPrefix string\\n\\n@description('Specifies the name of the subnet which contains the the Application Gateway.')\\nparam applicationGatewaySubnetName string\\n\\n@description('Specifies the address prefix of the subnet which contains the Application Gateway.')\\nparam applicationGatewaySubnetAddressPrefix string\\n\\n@description('Specifies the Bastion subnet IP prefix. This prefix must be within vnet IP prefix address space.')\\nparam bastionSubnetAddressPrefix string\\n\\n@description('Specifies the name of the Azure Bastion resource.')\\nparam bastionHostName string\\n\\n@description('Specifies the resource ID of the log analytics workspace')\\nparam workspaceId string\\n\\nvar bastionSubnetName = 'AzureBastionSubnet'\\nvar bastionPublicIpAddressName = '${bastionHostName}PublicIp'\\n\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2024-01-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        virtualNetworkAddressPrefixes\\n      ]\\n    }\\n    enableDdosProtection: false\\n    enableVmProtection: false\\n\\n    subnets: [\\n      {\\n        name: aksSubnetName\\n        properties: {\\n          addressPrefix: aksSubnetAddressPrefix\\n          privateEndpointNetworkPolicies: 'Disabled'\\n          privateLinkServiceNetworkPolicies: 'Enabled'\\n        }\\n      }\\n      {\\n        name: vmSubnetName\\n        properties: {\\n          addressPrefix: vmSubnetAddressPrefix\\n          privateEndpointNetworkPolicies: 'Disabled'\\n          privateLinkServiceNetworkPolicies: 'Enabled'\\n          networkSecurityGroup: {\\n            id: vmSubnetNsg.id\\n          }\\n        }\\n      }\\n      {\\n        name: applicationGatewaySubnetName\\n        properties: {\\n          addressPrefix: applicationGatewaySubnetAddressPrefix\\n          privateEndpointNetworkPolicies: 'Disabled'\\n          privateLinkServiceNetworkPolicies: 'Enabled'\\n        }\\n      }\\n      {\\n        name: bastionSubnetName\\n        properties: {\\n          addressPrefix: bastionSubnetAddressPrefix\\n          networkSecurityGroup: {\\n            id: bastionSubnetNsg.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource bastionPublicIpAddress 'Microsoft.Network/publicIPAddresses@2024-01-01' = {\\n  name: bastionPublicIpAddressName\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n  }\\n}\\n\\nresource bastionSubnetNsg 'Microsoft.Network/networkSecurityGroups@2024-01-01' = {\\n  name: '${bastionHostName}Nsg'\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'AllowHttpsInBound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'Internet'\\n          destinationPortRange: '443'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'AllowGatewayManagerInBound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'GatewayManager'\\n          destinationPortRange: '443'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 110\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'AllowLoadBalancerInBound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'AzureLoadBalancer'\\n          destinationPortRange: '443'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 120\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'AllowBastionHostCommunicationInBound'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationPortRanges: [\\n            '8080'\\n            '5701'\\n          ]\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 130\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'DenyAllInBound'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationPortRange: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Deny'\\n          priority: 1000\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'AllowSshRdpOutBound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationPortRanges: [\\n            '22'\\n            '3389'\\n          ]\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'AllowAzureCloudCommunicationOutBound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationPortRange: '443'\\n          destinationAddressPrefix: 'AzureCloud'\\n          access: 'Allow'\\n          priority: 110\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'AllowBastionHostCommunicationOutBound'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationPortRanges: [\\n            '8080'\\n            '5701'\\n          ]\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 120\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'AllowGetSessionInformationOutBound'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: 'Internet'\\n          destinationPortRanges: [\\n            '80'\\n            '443'\\n          ]\\n          access: 'Allow'\\n          priority: 130\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'DenyAllOutBound'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          destinationPortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Deny'\\n          priority: 1000\\n          direction: 'Outbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vmSubnetNsg 'Microsoft.Network/networkSecurityGroups@2024-01-01' = {\\n  name: '${vmSubnetName}Nsg'\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'AllowSshInbound'\\n        properties: {\\n          priority: 100\\n          access: 'Allow'\\n          direction: 'Inbound'\\n          destinationPortRange: '22'\\n          protocol: 'Tcp'\\n          sourceAddressPrefix: '*'\\n          sourcePortRange: '*'\\n          destinationAddressPrefix: '*'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource bastionHost 'Microsoft.Network/bastionHosts@2024-01-01' = {\\n  name: bastionHostName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'IpConf'\\n        properties: {\\n          subnet: {\\n            id: virtualNetwork.id != '' ? resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, bastionSubnetName) : ''\\n          }\\n          publicIPAddress: {\\n            id: bastionPublicIpAddress.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource bastionSubnetNsgDiag 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\\n  scope: bastionSubnetNsg\\n  name: '${bastionHostName}Nsg-Diag'\\n  properties: {\\n    workspaceId: workspaceId\\n    logs: [\\n      {\\n        category: 'NetworkSecurityGroupEvent'\\n        enabled: true\\n        retentionPolicy: {\\n          enabled: false\\n          days: 0\\n        }\\n      }\\n      {\\n        category: 'NetworkSecurityGroupRuleCounter'\\n        enabled: true\\n        retentionPolicy: {\\n          enabled: false\\n          days: 0\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vmSubnetNsgDiag 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\\n  scope: vmSubnetNsg\\n  name: '${vmSubnetName}Nsg-Diag'\\n  properties: {\\n    workspaceId: workspaceId\\n    logs: [\\n      {\\n        category: 'NetworkSecurityGroupEvent'\\n        enabled: true\\n        retentionPolicy: {\\n          enabled: false\\n          days: 0\\n        }\\n      }\\n      {\\n        category: 'NetworkSecurityGroupRuleCounter'\\n        enabled: true\\n        retentionPolicy: {\\n          enabled: false\\n          days: 0\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource bastionHostDiag 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\\n  scope: bastionHost\\n  name: '${bastionHostName}-Diag'\\n  properties: {\\n    workspaceId: workspaceId\\n    logs: [\\n      {\\n        category: 'BastionAuditLogs'\\n        enabled: true\\n      }\\n    ]\\n  }\\n}\\n\\noutput virtualNetworkId string = virtualNetwork.id\\noutput aksSubnetId string = virtualNetwork.id != '' ? resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, aksSubnetName) : ''\\noutput vmSubnetId string = virtualNetwork.id != '' ? resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, vmSubnetName) : ''\\noutput applicationGatewaySubnetId string = virtualNetwork.id != '' ? resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, applicationGatewaySubnetName) : ''\\noutput bastionSubnetId string = virtualNetwork.id != '' ? resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, bastionSubnetName) : ''\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualNetworkAddressPrefixes\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aksSubnetName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"aksSubnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSubnetName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSubnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"applicationGatewaySubnetName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"applicationGatewaySubnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"bastionSubnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"bastionHostName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"workspaceId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of new or existing vnet to which Azure Bastion should be deployed')\\nparam vnetName string = 'vnet01'\\n\\n@description('IP prefix for available addresses in vnet address space')\\nparam vnetIpPrefix string = '10.1.0.0/16'\\n\\n@description('Specify whether to provision new vnet or deploy to existing vnet')\\n@allowed([\\n  'new'\\n  'existing'\\n])\\nparam vnetNewOrExisting string = 'new'\\n\\n@description('Bastion subnet IP prefix MUST be within vnet IP prefix address space')\\nparam bastionSubnetIpPrefix string = '10.1.1.0/26'\\n\\n@description('Name of Azure Bastion resource')\\nparam bastionHostName string\\n\\n@description('Azure region for Bastion and virtual network')\\nparam location string = resourceGroup().location\\n\\nvar publicIpAddressName = '${bastionHostName}-pip'\\nvar bastionSubnetName = 'AzureBastionSubnet'\\nvar nsgName = '${bastionHostName}-nsg'\\n\\nresource publicIp 'Microsoft.Network/publicIPAddresses@2022-07-01' = {\\n  name: publicIpAddressName\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n  }\\n}\\n\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2022-07-01' = {\\n  name: nsgName\\n  location: location\\n  properties: {\\n    securityRules: [\\n      {\\n        name: 'AllowHttpsInBound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'Internet'\\n          destinationPortRange: '443'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'AllowGatewayManagerInBound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'GatewayManager'\\n          destinationPortRange: '443'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 110\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'AllowLoadBalancerInBound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'AzureLoadBalancer'\\n          destinationPortRange: '443'\\n          destinationAddressPrefix: '*'\\n          access: 'Allow'\\n          priority: 120\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'AllowBastionHostCommunicationInBound'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationPortRanges: [\\n            '8080'\\n            '5701'\\n          ]\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 130\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'DenyAllInBound'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationPortRange: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Deny'\\n          priority: 1000\\n          direction: 'Inbound'\\n        }\\n      }\\n      {\\n        name: 'AllowSshRdpOutBound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationPortRanges: [\\n            '22'\\n            '3389'\\n          ]\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 100\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'AllowAzureCloudCommunicationOutBound'\\n        properties: {\\n          protocol: 'Tcp'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationPortRange: '443'\\n          destinationAddressPrefix: 'AzureCloud'\\n          access: 'Allow'\\n          priority: 110\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'AllowBastionHostCommunicationOutBound'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: 'VirtualNetwork'\\n          destinationPortRanges: [\\n            '8080'\\n            '5701'\\n          ]\\n          destinationAddressPrefix: 'VirtualNetwork'\\n          access: 'Allow'\\n          priority: 120\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'AllowGetSessionInformationOutBound'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: 'Internet'\\n          destinationPortRanges: [\\n            '80'\\n            '443'\\n          ]\\n          access: 'Allow'\\n          priority: 130\\n          direction: 'Outbound'\\n        }\\n      }\\n      {\\n        name: 'DenyAllOutBound'\\n        properties: {\\n          protocol: '*'\\n          sourcePortRange: '*'\\n          destinationPortRange: '*'\\n          sourceAddressPrefix: '*'\\n          destinationAddressPrefix: '*'\\n          access: 'Deny'\\n          priority: 1000\\n          direction: 'Outbound'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\n// if vnetNewOrExisting == 'new', create a new vnet and subnet\\nresource newVirtualNetwork 'Microsoft.Network/virtualNetworks@2022-07-01' = if (vnetNewOrExisting == 'new') {\\n  name: vnetName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetIpPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: bastionSubnetName\\n        properties: {\\n          addressPrefix: bastionSubnetIpPrefix\\n          networkSecurityGroup: {\\n            id: nsg.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\n// if vnetNewOrExisting == 'existing', reference an existing vnet and create a new subnet under it\\nresource existingVirtualNetwork 'Microsoft.Network/virtualNetworks@2022-07-01' existing = if (vnetNewOrExisting == 'existing') {\\n  name: vnetName\\n}\\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2022-07-01' = if (vnetNewOrExisting == 'existing') {\\n  parent: existingVirtualNetwork\\n  name: bastionSubnetName\\n  properties: {\\n    addressPrefix: bastionSubnetIpPrefix\\n    networkSecurityGroup: {\\n      id: nsg.id\\n    }\\n  }\\n}\\n\\nresource bastionHost 'Microsoft.Network/bastionHosts@2022-07-01' = {\\n  name: bastionHostName\\n  location: location\\n  dependsOn: [\\n    newVirtualNetwork\\n    existingVirtualNetwork\\n  ]\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'IpConf'\\n        properties: {\\n          subnet: {\\n            id: subnet.id\\n          }\\n          publicIPAddress: {\\n            id: publicIp.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vnetName\\\": {\\n      \\\"value\\\": \\\"vnet01\\\"\\n    },\\n    \\\"vnetIpPrefix\\\": {\\n      \\\"value\\\": \\\"10.1.0.0/16\\\"\\n    },\\n    \\\"vnetNewOrExisting\\\": {\\n      \\\"value\\\": \\\"new\\\"\\n    },\\n    \\\"bastionSubnetIpPrefix\\\": {\\n      \\\"value\\\": \\\"10.1.1.0/26\\\"\\n    },\\n    \\\"bastionHostName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Size of virtual machine sizes')\\nparam vmSize string = 'Standard_B2s'\\n\\n@description('Username for remote access')\\nparam remoteAccessUsername string\\n\\n@description('Password for remote access')\\n@secure()\\nparam remoteAccessPassword string\\n\\n@description('The Windows version for the VM. This will pick a fully patched image of this given Windows version.')\\n@allowed([\\n  '2016-datacenter-gensecond'\\n  '2016-datacenter-server-core-g2'\\n  '2016-datacenter-server-core-smalldisk-g2'\\n  '2016-datacenter-smalldisk-g2'\\n  '2016-datacenter-with-containers-g2'\\n  '2016-datacenter-zhcn-g2'\\n  '2019-datacenter-core-g2'\\n  '2019-datacenter-core-smalldisk-g2'\\n  '2019-datacenter-core-with-containers-g2'\\n  '2019-datacenter-core-with-containers-smalldisk-g2'\\n  '2019-datacenter-gensecond'\\n  '2019-datacenter-smalldisk-g2'\\n  '2019-datacenter-with-containers-g2'\\n  '2019-datacenter-with-containers-smalldisk-g2'\\n  '2019-datacenter-zhcn-g2'\\n  '2022-datacenter-azure-edition'\\n  '2022-datacenter-azure-edition-core'\\n  '2022-datacenter-azure-edition-core-smalldisk'\\n  '2022-datacenter-azure-edition-smalldisk'\\n  '2022-datacenter-core-g2'\\n  '2022-datacenter-core-smalldisk-g2'\\n  '2022-datacenter-g2'\\n  '2022-datacenter-smalldisk-g2'\\n])\\nparam OSVersion string = '2022-datacenter-azure-edition'\\n\\n@description('Secure Boot setting of the virtual machine.')\\nparam secureBoot bool = true\\n\\n@description('vTPM setting of the virtual machine.')\\nparam vTPM bool = true\\n\\n@description('Deployment location')\\nparam location string = resourceGroup().location\\n\\n@description('Intruder Detection - Signature Overrodes Id 1')\\nparam sigOverrideParam1 string = '2024897'\\n\\n@description('Intruder Detection - Signature Overrodes Id 2')\\nparam sigOverrideParam2 string = '2024898'\\n\\nvar vnetAddressSpace = '10.0.0.0/16'\\nvar workerAddressSpace = '10.0.10.0/24'\\nvar workerPrivateIPAddress = '10.0.10.10'\\nvar bastionAddressSpace = '10.0.20.0/24'\\nvar firewallAddressSpace = '10.0.100.0/24'\\nvar firewallPrivateIPAddress = '10.0.100.4'\\nvar keyVaultName = 'fw-quick-${uniqueString(subscription().id, resourceGroup().id)}'\\nvar keyVaultCASecretName = 'CACert'\\nvar extensionName = 'GuestAttestation'\\nvar extensionPublisher = 'Microsoft.Azure.Security.WindowsAttestation'\\nvar extensionVersion = '1.0'\\nvar maaTenantName = 'GuestAttestation'\\n\\nresource CreateAndDeployCertificates 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\\n  name: 'CreateAndDeployCertificates'\\n  location: location\\n  kind: 'AzurePowerShell'\\n  properties: {\\n    forceUpdateTag: '2'\\n    azPowerShellVersion: '3.0'\\n    scriptContent: '# Write the config to file\\\\n$opensslConfig=@\\\\'\\\\n[ req ]\\\\ndefault_bits        = 4096\\\\ndistinguished_name  = req_distinguished_name\\\\nstring_mask         = utf8only\\\\ndefault_md          = sha512\\\\n\\\\n[ req_distinguished_name ]\\\\ncountryName                     = Country Name (2 letter code)\\\\nstateOrProvinceName             = State or Province Name\\\\nlocalityName                    = Locality Name\\\\n0.organizationName              = Organization Name\\\\norganizationalUnitName          = Organizational Unit Name\\\\ncommonName                      = Common Name\\\\nemailAddress                    = Email Address\\\\n\\\\n[ rootCA_ext ]\\\\nsubjectKeyIdentifier = hash\\\\nauthorityKeyIdentifier = keyid:always,issuer\\\\nbasicConstraints = critical, CA:true\\\\nkeyUsage = critical, digitalSignature, cRLSign, keyCertSign\\\\n\\\\n[ interCA_ext ]\\\\nsubjectKeyIdentifier = hash\\\\nauthorityKeyIdentifier = keyid:always,issuer\\\\nbasicConstraints = critical, CA:true, pathlen:1\\\\nkeyUsage = critical, digitalSignature, cRLSign, keyCertSign\\\\n\\\\n[ server_ext ]\\\\nsubjectKeyIdentifier = hash\\\\nauthorityKeyIdentifier = keyid:always,issuer\\\\nbasicConstraints = critical, CA:false\\\\nkeyUsage = critical, digitalSignature\\\\nextendedKeyUsage = serverAuth\\\\n\\\\'@\\\\n\\\\nSet-Content -Path openssl.cnf -Value $opensslConfig\\\\n\\\\n# Create root CA\\\\nopenssl req -x509 -new -nodes -newkey rsa:4096 -keyout rootCA.key -sha256 -days 3650 -out rootCA.crt -subj \\\\'/C=US/ST=US/O=Self Signed/CN=Self Signed Root CA\\\\' -config openssl.cnf -extensions rootCA_ext\\\\n\\\\n# Create intermediate CA request\\\\nopenssl req -new -nodes -newkey rsa:4096 -keyout interCA.key -sha256 -out interCA.csr -subj \\\\'/C=US/ST=US/O=Self Signed/CN=Self Signed Intermediate CA\\\\'\\\\n\\\\n# Sign on the intermediate CA\\\\nopenssl x509 -req -in interCA.csr -CA rootCA.crt -CAkey rootCA.key -CAcreateserial -out interCA.crt -days 3650 -sha256 -extfile openssl.cnf -extensions interCA_ext\\\\n\\\\n# Export the intermediate CA into PFX\\\\nopenssl pkcs12 -export -out interCA.pfx -inkey interCA.key -in interCA.crt -password \\\\'pass:\\\\'\\\\n\\\\n# Convert the PFX and public key into base64\\\\n$interCa = [Convert]::ToBase64String((Get-Content -Path interCA.pfx -AsByteStream -Raw))\\\\n$rootCa = [Convert]::ToBase64String((Get-Content -Path rootCA.crt -AsByteStream -Raw))\\\\n\\\\n# Assign outputs\\\\n$DeploymentScriptOutputs = @{}\\\\n$DeploymentScriptOutputs[\\\\'interca\\\\'] = $interCa\\\\n$DeploymentScriptOutputs[\\\\'rootca\\\\'] = $rootCa\\\\n'\\n    timeout: 'PT5M'\\n    cleanupPreference: 'OnSuccess'\\n    retentionInterval: 'P1D'\\n  }\\n}\\n\\nresource DemoIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\\n  name: 'DemoIdentity'\\n  location: location\\n}\\n\\nresource keyVault 'Microsoft.KeyVault/vaults@2019-09-01' = {\\n  name: keyVaultName\\n  location: location\\n  properties: {\\n    enabledForDeployment: false\\n    enabledForDiskEncryption: false\\n    enabledForTemplateDeployment: false\\n    tenantId: subscription().tenantId\\n    accessPolicies: [\\n      {\\n        objectId: DemoIdentity.properties.principalId\\n        tenantId: DemoIdentity.properties.tenantId\\n        permissions: {\\n          secrets: [\\n            'get'\\n            'list'\\n          ]\\n        }\\n      }\\n    ]\\n    sku: {\\n      name: 'standard'\\n      family: 'A'\\n    }\\n  }\\n}\\n\\nresource keyVaultName_keyVaultCASecret 'Microsoft.KeyVault/vaults/secrets@2019-09-01' = {\\n  parent: keyVault\\n  name: keyVaultCASecretName\\n  location: location\\n  properties: {\\n    value: CreateAndDeployCertificates.properties.outputs.interca\\n  }\\n}\\n\\nresource WorkerRoute 'Microsoft.Network/routeTables@2020-05-01' = {\\n  name: 'WorkerRoute'\\n  location: location\\n  properties: {\\n    routes: [\\n      {\\n        name: 'WorkerRouteFirewall'\\n        properties: {\\n          addressPrefix: '0.0.0.0/0'\\n          nextHopType: 'VirtualAppliance'\\n          nextHopIpAddress: firewallPrivateIPAddress\\n        }\\n      }\\n    ]\\n    disableBgpRoutePropagation: false\\n  }\\n}\\n\\nresource DemoVnet 'Microsoft.Network/virtualNetworks@2020-07-01' = {\\n  name: 'DemoVnet'\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetAddressSpace\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: 'WorkerSubnet'\\n        properties: {\\n          addressPrefix: workerAddressSpace\\n          routeTable: {\\n            id: WorkerRoute.id\\n          }\\n        }\\n      }\\n      {\\n        name: 'AzureBastionSubnet'\\n        properties: {\\n          addressPrefix: bastionAddressSpace\\n        }\\n      }\\n      {\\n        name: 'AzureFirewallSubnet'\\n        properties: {\\n          addressPrefix: firewallAddressSpace\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource WorkerNIC 'Microsoft.Network/networkInterfaces@2020-07-01' = {\\n  name: 'WorkerNIC'\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'WorkerIPConfiguration'\\n        properties: {\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', 'DemoVnet', 'WorkerSubnet')\\n          }\\n          privateIPAllocationMethod: 'Static'\\n          privateIPAddress: workerPrivateIPAddress\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    DemoVnet\\n  ]\\n}\\n\\nresource WorkerVM 'Microsoft.Compute/virtualMachines@2021-03-01' = {\\n  name: 'WorkerVM'\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: 'MicrosoftWindowsServer'\\n        offer: 'WindowsServer'\\n        sku: OSVersion\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        createOption: 'FromImage'\\n      }\\n    }\\n    osProfile: {\\n      computerName: 'WorkerVM'\\n      adminUsername: remoteAccessUsername\\n      adminPassword: remoteAccessPassword\\n    }\\n    securityProfile: {\\n      uefiSettings: {\\n        secureBootEnabled: secureBoot\\n        vTpmEnabled: vTPM\\n      }\\n      securityType: 'TrustedLaunch'\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: WorkerNIC.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource WorkerVM_extension 'Microsoft.Compute/virtualMachines/extensions@2022-03-01' = if (vTPM && secureBoot) {\\n  parent: WorkerVM\\n  name: extensionName\\n  location: location\\n  properties: {\\n    publisher: extensionPublisher\\n    type: extensionName\\n    typeHandlerVersion: extensionVersion\\n    autoUpgradeMinorVersion: true\\n    enableAutomaticUpgrade: true\\n    settings: {\\n      AttestationConfig: {\\n        MaaSettings: {\\n          maaEndpoint: ''\\n          maaTenantName: maaTenantName\\n        }\\n        AscSettings: {\\n          ascReportingEndpoint: ''\\n          ascReportingFrequency: ''\\n        }\\n        useCustomToken: 'false'\\n        disableAlerts: 'false'\\n      }\\n    }\\n  }\\n}\\n\\nresource WorkerVM_Bootstrap 'Microsoft.Compute/virtualMachines/extensions@2020-06-01' = {\\n  parent: WorkerVM\\n  name: 'Bootstrap'\\n  location: location\\n  properties: {\\n    publisher: 'Microsoft.Compute'\\n    type: 'CustomScriptExtension'\\n    typeHandlerVersion: '1.7'\\n    autoUpgradeMinorVersion: true\\n    settings: {\\n      commandToExecute: 'echo ${CreateAndDeployCertificates.properties.outputs.rootca} > c:\\\\\\\\root.pem.base64 && powershell \\\"Set-Content -Path c:\\\\\\\\root.pem -Value ([Text.Encoding]::UTF8.GetString([convert]::FromBase64String((Get-Content -Path c:\\\\\\\\root.pem.base64))))\\\" && certutil -addstore root c:\\\\\\\\root.pem'\\n    }\\n  }\\n}\\n\\nresource BastionPublicIP 'Microsoft.Network/publicIpAddresses@2020-07-01' = {\\n  name: 'BastionPublicIP'\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n  }\\n}\\n\\nresource DemoBastion 'Microsoft.Network/bastionHosts@2020-07-01' = {\\n  name: 'DemoBastion'\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'BastionIpConfiguration'\\n        properties: {\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', 'DemoVnet', 'AzureBastionSubnet')\\n          }\\n          publicIPAddress: {\\n            id: BastionPublicIP.id\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    DemoVnet\\n\\n  ]\\n}\\n\\nresource FirewallPublicIP 'Microsoft.Network/publicIpAddresses@2020-07-01' = {\\n  name: 'FirewallPublicIP'\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n  }\\n}\\n\\nresource DemoFirewallPolicy 'Microsoft.Network/firewallPolicies@2020-07-01' = {\\n  name: 'DemoFirewallPolicy'\\n  location: location\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${DemoIdentity.id}': {}\\n    }\\n  }\\n  properties: {\\n    sku: {\\n      tier: 'Premium'\\n    }\\n    transportSecurity: {\\n      certificateAuthority: {\\n        name: keyVaultCASecretName\\n        keyVaultSecretId: '${keyVault.properties.vaultUri}secrets/${keyVaultCASecretName}/'\\n      }\\n    }\\n    intrusionDetection: {\\n      mode: 'Alert'\\n      configuration: {\\n        signatureOverrides: [\\n          {\\n            id: sigOverrideParam1\\n            mode: 'Deny'\\n          }\\n          {\\n            id: sigOverrideParam2\\n            mode: 'Alert'\\n          }\\n        ]\\n        bypassTrafficSettings: [\\n          {\\n            name: 'SecretBypass'\\n            protocol: 'TCP'\\n            sourceAddresses: [\\n              '*'\\n            ]\\n            destinationAddresses: [\\n              '1.1.1.1'\\n            ]\\n            destinationPorts: [\\n              '80'\\n            ]\\n          }\\n        ]\\n      }\\n    }\\n  }\\n  dependsOn: [\\n    keyVaultName_keyVaultCASecret\\n\\n  ]\\n}\\n\\nresource DemoFirewallPolicy_PolicyRules 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2020-07-01' = {\\n  parent: DemoFirewallPolicy\\n  name: 'PolicyRules'\\n  location: location\\n  properties: {\\n    priority: 200\\n    ruleCollections: [\\n      {\\n        name: 'AllowWeb'\\n        priority: 101\\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\\n        action: {\\n          type: 'Allow'\\n        }\\n        rules: [\\n          {\\n            ruleType: 'ApplicationRule'\\n            name: 'AllowAzure'\\n            protocols: [\\n              {\\n                protocolType: 'Https'\\n                port: 443\\n              }\\n            ]\\n            targetFqdns: [\\n              '*azure.com'\\n              '*microsoft.com'\\n            ]\\n            sourceAddresses: [\\n              '*'\\n            ]\\n            terminateTLS: true\\n          }\\n          {\\n            ruleType: 'ApplicationRule'\\n            name: 'AllowNews'\\n            protocols: [\\n              {\\n                protocolType: 'Https'\\n                port: 443\\n              }\\n            ]\\n            webCategories: [\\n              'business'\\n              'webbasedemail'\\n            ]\\n            sourceAddresses: [\\n              '*'\\n            ]\\n            terminateTLS: true\\n          }\\n        ]\\n      }\\n      {\\n        name: 'BlockPage'\\n        priority: 100\\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\\n        action: {\\n          type: 'Deny'\\n        }\\n        rules: [\\n          {\\n            ruleType: 'ApplicationRule'\\n            name: 'BlockAzureEvents'\\n            protocols: [\\n              {\\n                protocolType: 'Https'\\n                port: 443\\n              }\\n            ]\\n            targetUrls: [\\n              'azure.microsoft.com/en-us/community/events'\\n              'azure.microsoft.com/en-us/community/events/*'\\n            ]\\n            sourceAddresses: [\\n              '*'\\n            ]\\n            terminateTLS: true\\n          }\\n        ]\\n      }\\n    ]\\n  }\\n}\\n\\nresource DemoFirewall 'Microsoft.Network/azureFirewalls@2020-07-01' = {\\n  name: 'DemoFirewall'\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'FirewallIPConfiguration'\\n        properties: {\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', 'DemoVnet', 'AzureFirewallSubnet')\\n          }\\n          publicIPAddress: {\\n            id: FirewallPublicIP.id\\n          }\\n        }\\n      }\\n    ]\\n    firewallPolicy: {\\n      id: DemoFirewallPolicy.id\\n    }\\n    sku: {\\n      name: 'AZFW_VNet'\\n      tier: 'Premium'\\n    }\\n  }\\n  dependsOn: [\\n    DemoVnet\\n\\n    DemoFirewallPolicy_PolicyRules\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_B2s\\\"\\n    },\\n    \\\"remoteAccessUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"remoteAccessPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"OSVersion\\\": {\\n      \\\"value\\\": \\\"2022-datacenter-azure-edition\\\"\\n    },\\n    \\\"secureBoot\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"vTPM\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"sigOverrideParam1\\\": {\\n      \\\"value\\\": \\\"2024897\\\"\\n    },\\n    \\\"sigOverrideParam2\\\": {\\n      \\\"value\\\": \\\"2024898\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('This is the name of the ExpressRoute circuit')\\nparam circuitName string\\n\\n@description('This is the name of the ExpressRoute Service Provider. It must exactly match one of the Service Providers from List ExpressRoute Service Providers API call.')\\nparam serviceProviderName string\\n\\n@description('This is the name of the peering location and not the ARM resource location. It must exactly match one of the available peering locations from List ExpressRoute Service Providers API call.')\\nparam peeringLocation string\\n\\n@description('This is the bandwidth in Mbps of the circuit being created. It must exactly match one of the available bandwidth offers List ExpressRoute Service Providers API call.')\\nparam bandwidthInMbps int\\n\\n@description('Chosen SKU Tier of ExpressRoute circuit. Choose from Premium or Standard SKU tiers.')\\n@allowed([\\n  'Standard'\\n  'Premium'\\n])\\nparam skuTier string = 'Standard'\\n\\n@description('Chosen SKU family of ExpressRoute circuit. Choose from MeteredData or UnlimitedData SKU families.')\\n@allowed([\\n  'MeteredData'\\n  'UnlimitedData'\\n])\\nparam skuFamily string = 'MeteredData'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nresource circuit 'Microsoft.Network/expressRouteCircuits@2021-02-01' = {\\n  name: circuitName\\n  location: location\\n  sku: {\\n    name: '${skuTier}_${skuFamily}'\\n    tier: skuTier\\n    family: skuFamily\\n  }\\n  properties: {\\n    serviceProviderProperties: {\\n      serviceProviderName: serviceProviderName\\n      peeringLocation: peeringLocation\\n      bandwidthInMbps: bandwidthInMbps\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"circuitName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"serviceProviderName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"peeringLocation\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"bandwidthInMbps\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"skuTier\\\": {\\n      \\\"value\\\": \\\"Standard\\\"\\n    },\\n    \\\"skuFamily\\\": {\\n      \\\"value\\\": \\\"MeteredData\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the WAF policy')\\nparam wafPolicyName string\\n\\n@description('Describes if it is in detection mode or prevention mode at policy level.')\\n@allowed([\\n  'Detection'\\n  'Prevention'\\n])\\nparam wafMode string = 'Detection'\\n\\n\\nresource wafPolicy 'Microsoft.Network/FrontDoorWebApplicationFirewallPolicies@2020-11-01' = {\\n  name: wafPolicyName\\n  location: 'global'\\n  properties: {\\n    policySettings: {\\n      mode: wafMode\\n      enabledState: 'Enabled'\\n    }\\n    managedRules: {\\n      managedRuleSets: [\\n        {\\n          ruleSetType: 'DefaultRuleSet'\\n          ruleSetVersion: '1.0'\\n        }\\n      ]\\n    }\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"wafPolicyName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"wafMode\\\": {\\n      \\\"value\\\": \\\"Detection\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the virtual machine')\\nparam vmname string = 'vm-1'\\n\\n@description('Size of the virtual machine')\\nparam vmsize string = 'Standard_D2s_v3'\\n\\n@description('Name of the virtual network')\\nparam vnetname string = 'vnet-1'\\n\\n@description('Name of the subnet for virtual network')\\nparam subnetname string = 'subnet-1'\\n\\n@description('Address space for virtual network')\\nparam vnetaddressspace string = '10.0.0.0/16'\\n\\n@description('Subnet prefix for virtual network')\\nparam vnetsubnetprefix string = '10.0.0.0/24'\\n\\n@description('Name of the NAT gateway')\\nparam natgatewayname string = 'nat-gateway'\\n\\n@description('Name of the virtual machine nic')\\nparam networkinterfacename string = 'nic-1'\\n\\n@description('Name of the NAT gateway public IP')\\nparam publicipname string = 'public-ip-nat'\\n\\n@description('Name of the Bastion host')\\nparam bastionName string = 'bastion-host'\\n\\n@description('Name of the virtual machine NSG')\\nparam nsgname string = 'nsg-1'\\n\\n@description('Administrator username for virtual machine')\\nparam adminusername string\\n\\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\\n@allowed([\\n  'sshPublicKey'\\n  'password'\\n])\\nparam authenticationType string = 'sshPublicKey'\\n\\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\\n@secure()\\nparam adminPasswordOrKey string\\n\\n@description('Name of resource group')\\nparam location string = resourceGroup().location\\n\\nvar linuxConfiguration = {\\n  disablePasswordAuthentication: true\\n  ssh: {\\n    publicKeys: [\\n      {\\n        path: '/home/${adminusername}/.ssh/authorized_keys'\\n        keyData: adminPasswordOrKey\\n      }\\n    ]\\n  }\\n}\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2024-01-01' = {\\n  name: nsgname\\n  location: location\\n  properties: {}\\n}\\n\\nresource publicip 'Microsoft.Network/publicIPAddresses@2024-01-01' = {\\n  name: publicipname\\n  location: location\\n  sku: {\\n    name: 'StandardV2'\\n  }\\n  properties: {\\n    publicIPAddressVersion: 'IPv4'\\n    publicIPAllocationMethod: 'Static'\\n    idleTimeoutInMinutes: 4\\n  }\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2023-09-01' = {\\n  name: vmname\\n  location: location\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmsize\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: 'Canonical'\\n        offer: '0001-com-ubuntu-server-jammy'\\n        sku: '22_04-lts-gen2'\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        osType: 'Linux'\\n        name: '${vmname}_disk1'\\n        createOption: 'FromImage'\\n        caching: 'ReadWrite'\\n        managedDisk: {\\n          storageAccountType: 'Premium_LRS'\\n        }\\n        diskSizeGB: 30\\n      }\\n    }\\n    osProfile: {\\n      computerName: vmname\\n      adminUsername: adminusername\\n      adminPassword: adminPasswordOrKey\\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: networkinterface.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource vnet 'Microsoft.Network/virtualNetworks@2024-01-01' = {\\n  name: vnetname\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetaddressspace\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetname\\n        properties: {\\n          addressPrefix: vnetsubnetprefix\\n          natGateway: {\\n            id: natgateway.id\\n          }\\n          privateEndpointNetworkPolicies: 'Enabled'\\n          privateLinkServiceNetworkPolicies: 'Enabled'\\n        }\\n      }\\n    ]\\n    enableDdosProtection: false\\n    enableVmProtection: false\\n  }\\n}\\n\\nresource natgateway 'Microsoft.Network/natGateways@2024-01-01' = {\\n  name: natgatewayname\\n  location: location\\n  sku: {\\n    name: 'StandardV2'\\n  }\\n  properties: {\\n    idleTimeoutInMinutes: 4\\n    publicIpAddresses: [\\n      {\\n        id: publicip.id\\n      }\\n    ]\\n  }\\n}\\n\\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2024-01-01' = {\\n  parent: vnet\\n  name: 'subnet-1'\\n  properties: {\\n    addressPrefix: vnetsubnetprefix\\n    natGateway: {\\n      id: natgateway.id\\n    }\\n    privateEndpointNetworkPolicies: 'Enabled'\\n    privateLinkServiceNetworkPolicies: 'Enabled'\\n  }\\n}\\n\\nresource networkinterface 'Microsoft.Network/networkInterfaces@2024-01-01' = {\\n  name: networkinterfacename\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipconfig-1'\\n        properties: {\\n          privateIPAddress: '10.0.0.4'\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: subnet.id\\n          }\\n          primary: true\\n          privateIPAddressVersion: 'IPv4'\\n        }\\n      }\\n    ]\\n    enableAcceleratedNetworking: false\\n    enableIPForwarding: false\\n    networkSecurityGroup: {\\n      id: nsg.id\\n    }\\n  }\\n}\\n\\nresource bastionHost 'Microsoft.Network/bastionHosts@2024-01-01' = {\\n  name: bastionName\\n  location: location\\n  sku: {\\n    name: 'Developer'\\n  }\\n  properties: {\\n    virtualNetwork: {\\n      id: vnet.id\\n    }\\n  }\\n}\\n\\noutput location string = location\\noutput name string = natgateway.name\\noutput resourceGroupName string = resourceGroup().name\\noutput resourceId string = natgateway.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmname\\\": {\\n      \\\"value\\\": \\\"vm-1\\\"\\n    },\\n    \\\"vmsize\\\": {\\n      \\\"value\\\": \\\"Standard_D2s_v3\\\"\\n    },\\n    \\\"vnetname\\\": {\\n      \\\"value\\\": \\\"vnet-1\\\"\\n    },\\n    \\\"subnetname\\\": {\\n      \\\"value\\\": \\\"subnet-1\\\"\\n    },\\n    \\\"vnetaddressspace\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/16\\\"\\n    },\\n    \\\"vnetsubnetprefix\\\": {\\n      \\\"value\\\": \\\"10.0.0.0/24\\\"\\n    },\\n    \\\"natgatewayname\\\": {\\n      \\\"value\\\": \\\"nat-gateway\\\"\\n    },\\n    \\\"networkinterfacename\\\": {\\n      \\\"value\\\": \\\"nic-1\\\"\\n    },\\n    \\\"publicipname\\\": {\\n      \\\"value\\\": \\\"public-ip-nat\\\"\\n    },\\n    \\\"bastionName\\\": {\\n      \\\"value\\\": \\\"bastion-host\\\"\\n    },\\n    \\\"nsgname\\\": {\\n      \\\"value\\\": \\\"nsg-1\\\"\\n    },\\n    \\\"adminusername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"authenticationType\\\": {\\n      \\\"value\\\": \\\"sshPublicKey\\\"\\n    },\\n    \\\"adminPasswordOrKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Network security group name')\\nparam nsgName string = uniqueString(resourceGroup().id)\\n\\n@description('Network security group location')\\nparam location string = resourceGroup().location\\n\\n@description('Array containing security rules. For properties format refer to https://docs.microsoft.com/en-us/azure/templates/microsoft.network/networksecuritygroups?tabs=bicep#securityrulepropertiesformat')\\nparam securityRules array = []\\n\\n@description('Enable delete lock')\\nparam enableDeleteLock bool = false\\n\\n@description('Enable diagnostic logs')\\nparam enableDiagnostics bool = false\\n\\n@description('Storage account resource id. Only required if enableDiagnostics is set to true.')\\nparam diagnosticStorageAccountId string = ''\\n\\n@description('Log analytics workspace resource id. Only required if enableDiagnostics is set to true.')\\nparam logAnalyticsWorkspaceId string = ''\\n\\nvar lockName = '${nsg.name}-lck'\\nvar diagnosticsName = '${nsg.name}-dgs'\\n\\nresource nsg 'Microsoft.Network/networkSecurityGroups@2021-02-01' = {\\n  name: nsgName\\n  location: location\\n  properties: {\\n    securityRules: [for rule in securityRules: {\\n      name: rule.name\\n      properties: rule.properties\\n    }]\\n  }\\n}\\n\\nresource diagnostics 'microsoft.insights/diagnosticSettings@2021-05-01-preview' = if (enableDiagnostics) {\\n  scope: nsg\\n  name: diagnosticsName\\n  properties: {\\n    workspaceId: empty(logAnalyticsWorkspaceId) ? null : logAnalyticsWorkspaceId\\n    storageAccountId: empty(diagnosticStorageAccountId) ? null : diagnosticStorageAccountId\\n    logs: [\\n      {\\n        category: 'NetworkSecurityGroupEvent'\\n        enabled: true\\n      }\\n      {\\n        category: 'NetworkSecurityGroupRuleCounter'\\n        enabled: true\\n      }\\n    ]\\n  }\\n}\\n\\nresource lock 'Microsoft.Authorization/locks@2017-04-01' = if (enableDeleteLock) {\\n  scope: nsg\\n  name: lockName\\n  properties: {\\n    level: 'CanNotDelete'\\n  }\\n}\\n\\noutput name string = nsg.name\\noutput id string = nsg.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"nsgName\\\": {\\n      \\\"value\\\": \\\"uniqueString(resourceGroup().id)\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"securityRules\\\": {\\n      \\\"value\\\": \\\"[]\\\"\\n    },\\n    \\\"enableDeleteLock\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"enableDiagnostics\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"diagnosticStorageAccountId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    },\\n    \\\"logAnalyticsWorkspaceId\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Username for the Virtual Machine.')\\nparam vmAdminUsername string\\n\\n@description('Password for the Virtual Machine. The password must be at least 12 characters long and have lower case, upper characters, digit and a special character (Regex match)')\\n@secure()\\nparam vmAdminPassword string\\n\\n@description('The size of the VM')\\nparam vmSize string = 'Standard_D2_v3'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nvar vnetName = 'myVirtualNetwork'\\nvar vnetConsumerName = 'myPEVnet'\\nvar vnetAddressPrefix = '10.0.0.0/16'\\nvar frontendSubnetPrefix = '10.0.1.0/24'\\nvar frontendSubnetName = 'frontendSubnet'\\nvar backendSubnetPrefix = '10.0.2.0/24'\\nvar backendSubnetName = 'backendSubnet'\\nvar consumerSubnetPrefix = '10.0.0.0/24'\\nvar consumerSubnetName = 'myPESubnet'\\nvar loadbalancerName = 'myILB'\\nvar backendPoolName = 'myBackEndPool'\\nvar loadBalancerFrontEndIpConfigurationName = 'myFrontEnd'\\nvar healthProbeName = 'myHealthProbe'\\nvar privateEndpointName = 'myPrivateEndpoint'\\nvar vmName = take('myVm${uniqueString(resourceGroup().id)}', 15)\\nvar networkInterfaceName = '${vmName}NetInt'\\nvar vmConsumerName = take('myConsumerVm${uniqueString(resourceGroup().id)}', 15)\\nvar publicIpAddressConsumerName = '${vmConsumerName}PublicIP'\\nvar networkInterfaceConsumerName = '${vmConsumerName}NetInt'\\nvar osDiskType = 'StandardSSD_LRS'\\nvar privatelinkServiceName = 'myPLS'\\nvar loadbalancerId = loadbalancer.id\\n\\nresource vnet 'Microsoft.Network/virtualNetworks@2021-05-01' = {\\n  name: vnetName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetAddressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: frontendSubnetName\\n        properties: {\\n          addressPrefix: frontendSubnetPrefix\\n          privateLinkServiceNetworkPolicies: 'Disabled'\\n        }\\n      }\\n      {\\n        name: backendSubnetName\\n        properties: {\\n          addressPrefix: backendSubnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource loadbalancer 'Microsoft.Network/loadBalancers@2021-05-01' = {\\n  name: loadbalancerName\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    frontendIPConfigurations: [\\n      {\\n        name: loadBalancerFrontEndIpConfigurationName\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, frontendSubnetName)\\n          }\\n        }\\n      }\\n    ]\\n    backendAddressPools: [\\n      {\\n        name: backendPoolName\\n      }\\n    ]\\n    inboundNatRules: [\\n      {\\n        name: 'RDP-VM0'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIpConfigurations', loadbalancerName, loadBalancerFrontEndIpConfigurationName)\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 3389\\n          backendPort: 3389\\n          enableFloatingIP: false\\n        }\\n      }\\n    ]\\n    loadBalancingRules: [\\n      {\\n        name: 'myHTTPRule'\\n        properties: {\\n          frontendIPConfiguration: {\\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIpConfigurations', loadbalancerName, loadBalancerFrontEndIpConfigurationName)\\n          }\\n          backendAddressPool: {\\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadbalancerName, backendPoolName)\\n          }\\n          probe: {\\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadbalancerName, healthProbeName)\\n          }\\n          protocol: 'Tcp'\\n          frontendPort: 80\\n          backendPort: 80\\n          idleTimeoutInMinutes: 15\\n        }\\n      }\\n    ]\\n    probes: [\\n      {\\n        properties: {\\n          protocol: 'Tcp'\\n          port: 80\\n          intervalInSeconds: 15\\n          numberOfProbes: 2\\n        }\\n        name: healthProbeName\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    vnet\\n  ]\\n}\\n\\nresource networkInterface 'Microsoft.Network/networkInterfaces@2021-05-01' = {\\n  name: networkInterfaceName\\n  location: location\\n  tags: {\\n    displayName: networkInterfaceName\\n  }\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipConfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, backendSubnetName)\\n          }\\n          loadBalancerBackendAddressPools: [\\n            {\\n              id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadbalancerName, backendPoolName)\\n            }\\n          ]\\n          loadBalancerInboundNatRules: [\\n            {\\n              id: resourceId('Microsoft.Network/loadBalancers/inboundNatRules/', loadbalancerName, 'RDP-VM0')\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    loadbalancer\\n  ]\\n}\\n\\nresource vm 'Microsoft.Compute/virtualMachines@2021-11-01' = {\\n  name: vmName\\n  location: location\\n  tags: {\\n    displayName: vmName\\n  }\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmName\\n      adminUsername: vmAdminUsername\\n      adminPassword: vmAdminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: 'MicrosoftWindowsServer'\\n        offer: 'WindowsServer'\\n        sku: '2019-Datacenter'\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmName}OsDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n        managedDisk: {\\n          storageAccountType: osDiskType\\n        }\\n        diskSizeGB: 128\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: networkInterface.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource vmExtension 'Microsoft.Compute/virtualMachines/extensions@2021-11-01' = {\\n  parent: vm\\n  name: 'installcustomscript'\\n  location: location\\n  tags: {\\n    displayName: 'install software for Windows VM'\\n  }\\n  properties: {\\n    publisher: 'Microsoft.Compute'\\n    type: 'CustomScriptExtension'\\n    typeHandlerVersion: '1.9'\\n    autoUpgradeMinorVersion: true\\n    protectedSettings: {\\n      commandToExecute: 'powershell -ExecutionPolicy Unrestricted Install-WindowsFeature -Name Web-Server'\\n    }\\n  }\\n}\\n\\nresource privatelinkService 'Microsoft.Network/privateLinkServices@2021-05-01' = {\\n  name: privatelinkServiceName\\n  location: location\\n  properties: {\\n    enableProxyProtocol: false\\n    loadBalancerFrontendIpConfigurations: [\\n      {\\n        id: resourceId('Microsoft.Network/loadBalancers/frontendIpConfigurations', loadbalancerName, loadBalancerFrontEndIpConfigurationName)\\n      }\\n    ]\\n    ipConfigurations: [\\n      {\\n        name: 'snet-provider-default-1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          privateIPAddressVersion: 'IPv4'\\n          subnet: {\\n            id: reference(loadbalancerId, '2019-06-01').frontendIPConfigurations[0].properties.subnet.id\\n          }\\n          primary: false\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vnetConsumer 'Microsoft.Network/virtualNetworks@2021-05-01' = {\\n  name: vnetConsumerName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetAddressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: consumerSubnetName\\n        properties: {\\n          addressPrefix: consumerSubnetPrefix\\n          privateEndpointNetworkPolicies: 'Disabled'\\n        }\\n      }\\n      {\\n        name: backendSubnetName\\n        properties: {\\n          addressPrefix: backendSubnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource publicIpAddressConsumer 'Microsoft.Network/publicIPAddresses@2021-05-01' = {\\n  name: publicIpAddressConsumerName\\n  location: location\\n  tags: {\\n    displayName: publicIpAddressConsumerName\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n    dnsSettings: {\\n      domainNameLabel: toLower(vmConsumerName)\\n    }\\n  }\\n}\\n\\nresource networkInterfaceConsumer 'Microsoft.Network/networkInterfaces@2021-05-01' = {\\n  name: networkInterfaceConsumerName\\n  location: location\\n  tags: {\\n    displayName: networkInterfaceConsumerName\\n  }\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'ipConfig1'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          publicIPAddress: {\\n            id: publicIpAddressConsumer.id\\n          }\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetConsumerName, consumerSubnetName)\\n          }\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    vnetConsumer\\n  ]\\n}\\n\\nresource vmConsumer 'Microsoft.Compute/virtualMachines@2021-11-01' = {\\n  name: vmConsumerName\\n  location: location\\n  tags: {\\n    displayName: vmConsumerName\\n  }\\n  properties: {\\n    hardwareProfile: {\\n      vmSize: vmSize\\n    }\\n    osProfile: {\\n      computerName: vmConsumerName\\n      adminUsername: vmAdminUsername\\n      adminPassword: vmAdminPassword\\n    }\\n    storageProfile: {\\n      imageReference: {\\n        publisher: 'MicrosoftWindowsServer'\\n        offer: 'WindowsServer'\\n        sku: '2019-Datacenter'\\n        version: 'latest'\\n      }\\n      osDisk: {\\n        name: '${vmConsumerName}OsDisk'\\n        caching: 'ReadWrite'\\n        createOption: 'FromImage'\\n        managedDisk: {\\n          storageAccountType: osDiskType\\n        }\\n        diskSizeGB: 128\\n      }\\n    }\\n    networkProfile: {\\n      networkInterfaces: [\\n        {\\n          id: networkInterfaceConsumer.id\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2021-05-01' = {\\n  name: privateEndpointName\\n  location: location\\n  properties: {\\n    subnet: {\\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetConsumerName, consumerSubnetName)\\n    }\\n    privateLinkServiceConnections: [\\n      {\\n        name: privateEndpointName\\n        properties: {\\n          privateLinkServiceId: privatelinkService.id\\n        }\\n      }\\n    ]\\n  }\\n  dependsOn: [\\n    vnetConsumer\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"vmAdminUsername\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmAdminPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"vmSize\\\": {\\n      \\\"value\\\": \\\"Standard_D2_v3\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Relative DNS name for the traffic manager profile, resulting FQDN will be <uniqueDnsName>.trafficmanager.net, must be globally unique.')\\nparam uniqueDnsName string\\n\\n@description('Relative DNS name for the WebApps, must be globally unique.  An index will be appended for each Web App.')\\nparam uniqueDnsNameForWebApp string\\n\\n@description('Name of the App Service Plan that is being created')\\nparam appServicePlanName string\\nparam location string = resourceGroup().location\\n\\n@description('Name of the trafficManager being created')\\nparam trafficManagerName string\\n\\nresource appServicePlan 'Microsoft.Web/serverFarms@2020-12-01' = {\\n  name: appServicePlanName\\n  location: location\\n  sku: {\\n    name: 'S1'\\n    tier: 'Standard'\\n  }\\n}\\n\\nresource webSite 'Microsoft.Web/sites@2020-12-01' = {\\n  name: uniqueDnsNameForWebApp\\n  location: location\\n  properties: {\\n    serverFarmId: appServicePlan.id\\n  }\\n}\\n\\nresource trafficManagerProfile 'Microsoft.Network/trafficManagerProfiles@2018-08-01' = {\\n  name: trafficManagerName\\n  location: 'global'\\n  properties: {\\n    profileStatus: 'Enabled'\\n    trafficRoutingMethod: 'Priority'\\n    dnsConfig: {\\n      relativeName: uniqueDnsName\\n      ttl: 30\\n    }\\n    monitorConfig: {\\n      protocol: 'HTTPS'\\n      port: 443\\n      path: '/'\\n    }\\n    endpoints: [\\n      {\\n        name: uniqueDnsNameForWebApp\\n        type: 'Microsoft.Network/trafficManagerProfiles/azureEndpoints'\\n        properties: {\\n          targetResourceId: webSite.id\\n          endpointStatus: 'Enabled'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"uniqueDnsName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"uniqueDnsNameForWebApp\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"appServicePlanName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"trafficManagerName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"param logAnalyticsWorkspaceName string\\nparam location string\\nparam logAnalyticsWorkspaceSKU string\\n//param logAnalyticsWorkspaceRetentionDays int\\n\\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {\\n  name: logAnalyticsWorkspaceName\\n  location: location\\n  properties: {\\n    sku: {\\n      name: logAnalyticsWorkspaceSKU\\n    }\\n    //retentionInDays: logAnalyticsWorkspaceRetentionDays\\n    features: {\\n      enableLogAccessUsingOnlyResourcePermissions: true\\n    }\\n    workspaceCapping: {\\n      dailyQuotaGb: -1\\n    }\\n    publicNetworkAccessForIngestion: 'Enabled'\\n    publicNetworkAccessForQuery: 'Enabled'\\n  }\\n}\\n\\noutput LogAnalyticsWorkspaceID string = logAnalyticsWorkspace.id \\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"logAnalyticsWorkspaceName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"logAnalyticsWorkspaceSKU\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"logAnalyticsWorkspaceRetentionDays\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The shared key used to establish connection between the two vNet Gateways.')\\n@secure()\\nparam sharedKey string\\n\\n@description('The SKU for the VPN Gateway. Cannot be Basic SKU.')\\n@allowed([\\n  'Standard'\\n  'HighPerformance'\\n  'VpnGw1'\\n  'VpnGw2'\\n  'VpnGw3'\\n])\\nparam gatewaySku string = 'VpnGw1'\\n\\n@description('Location of the resources')\\nparam location string = resourceGroup().location\\n\\nvar vnet1cfg = {\\n  name: 'vNet1-${location}'\\n  addressSpacePrefix: '10.0.0.0/23'\\n  subnetName: 'subnet1'\\n  subnetPrefix: '10.0.0.0/24'\\n  gatewayName: 'vNet1-Gateway'\\n  gatewaySubnetPrefix: '10.0.1.224/27'\\n  gatewayPublicIPName: 'gw1pip${uniqueString(resourceGroup().id)}'\\n  connectionName: 'vNet1-to-vNet2'\\n  asn: 65010\\n}\\nvar vnet2cfg = {\\n  name: 'vnet2-${location}'\\n  addressSpacePrefix: '10.0.2.0/23'\\n  subnetName: 'subnet1'\\n  subnetPrefix: '10.0.2.0/24'\\n  gatewayName: 'vnet2-Gateway'\\n  gatewaySubnetPrefix: '10.0.3.224/27'\\n  gatewayPublicIPName: 'gw2pip${uniqueString(resourceGroup().id)}'\\n  connectionName: 'vnet2-to-vnet1'\\n  asn: 65050\\n}\\n\\nresource vnet1 'Microsoft.Network/virtualNetworks@2020-06-01' = {\\n  name: vnet1cfg.name\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnet1cfg.addressSpacePrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: vnet1cfg.subnetName\\n        properties: {\\n          addressPrefix: vnet1cfg.subnetPrefix\\n        }\\n      }\\n      {\\n        name: 'GatewaySubnet'\\n        properties: {\\n          addressPrefix: vnet1cfg.gatewaySubnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource vnet2 'Microsoft.Network/virtualNetworks@2020-06-01' = {\\n  name: vnet2cfg.name\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnet2cfg.addressSpacePrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: vnet2cfg.subnetName\\n        properties: {\\n          addressPrefix: vnet2cfg.subnetPrefix\\n        }\\n      }\\n      {\\n        name: 'GatewaySubnet'\\n        properties: {\\n          addressPrefix: vnet2cfg.gatewaySubnetPrefix\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource gw1pip 'Microsoft.Network/publicIPAddresses@2020-06-01' = {\\n  name: vnet1cfg.gatewayPublicIPName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n  }\\n}\\n\\nresource gw2pip 'Microsoft.Network/publicIPAddresses@2020-06-01' = {\\n  name: vnet2cfg.gatewayPublicIPName\\n  location: location\\n  properties: {\\n    publicIPAllocationMethod: 'Dynamic'\\n  }\\n}\\n\\nresource vnet1Gateway 'Microsoft.Network/virtualNetworkGateways@2020-06-01' = {\\n  name: vnet1cfg.gatewayName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'vnet1GatewayConfig'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets',vnet1.name , 'GatewaySubnet')\\n          }\\n          publicIPAddress: {\\n            id: gw1pip.id\\n          }\\n        }\\n      }\\n    ]\\n    gatewayType: 'Vpn'\\n    sku: {\\n      name: gatewaySku\\n      tier: gatewaySku\\n    }\\n    vpnType: 'RouteBased'\\n    enableBgp: true\\n    bgpSettings: {\\n      asn: vnet1cfg.asn\\n    }\\n  }\\n}\\n\\nresource vnet2Gateway 'Microsoft.Network/virtualNetworkGateways@2020-05-01' = {\\n  name: vnet2cfg.gatewayName\\n  location: location\\n  properties: {\\n    ipConfigurations: [\\n      {\\n        name: 'vNet2GatewayConfig'\\n        properties: {\\n          privateIPAllocationMethod: 'Dynamic'\\n          subnet: {\\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets',vnet2.name , 'GatewaySubnet')\\n          }\\n          publicIPAddress: {\\n            id: gw2pip.id\\n          }\\n        }\\n      }\\n    ]\\n    gatewayType: 'Vpn'\\n    sku: {\\n      name: gatewaySku\\n      tier: gatewaySku\\n    }\\n    vpnType: 'RouteBased'\\n    enableBgp: true\\n    bgpSettings: {\\n      asn: vnet2cfg.asn\\n    }\\n  }\\n}\\n\\nresource vpn1to2Connection 'Microsoft.Network/connections@2020-05-01' = {\\n  name: vnet1cfg.connectionName\\n  location: location\\n  properties: {\\n    virtualNetworkGateway1: {\\n      id: vnet1Gateway.id\\n      properties: {}\\n    }\\n    virtualNetworkGateway2: {\\n      id: vnet2Gateway.id\\n      properties: {}\\n    }\\n    connectionType: 'Vnet2Vnet'\\n    routingWeight: 3\\n    sharedKey: sharedKey\\n    enableBgp: true\\n  }\\n}\\n\\nresource vpn2to1Connection 'Microsoft.Network/connections@2020-05-01' = {\\n  name: vnet2cfg.connectionName\\n  location: location\\n  properties: {\\n    virtualNetworkGateway1: {\\n      id: vnet2Gateway.id\\n      properties: {}\\n    }\\n    virtualNetworkGateway2: {\\n      id: vnet1Gateway.id\\n      properties: {}\\n    }\\n    connectionType: 'Vnet2Vnet'\\n    routingWeight: 3\\n    sharedKey: sharedKey\\n    enableBgp: true\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"sharedKey\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"gatewaySku\\\": {\\n      \\\"value\\\": \\\"VpnGw1\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the Existing Recovery Services Vault (Vault and VM to be protected must be in same GEO)')\\nparam existingRecoveryServicesVaultName string\\n\\n@description('Array of iaasvm protection containers. This will take different input for classic and ARM vms. e.g. iaasvmcontainer;iaasvmcontainerv2;my-resource-group;my-arm-vm for ARM vm and iaasvmcontainer;iaasvmcontainer;my-classic-vm;my-classic-vm for classic vm')\\nparam existingProtectionContainers array\\n\\n@description('Array of iaasvm protectable items. This will take different input for classic and ARM vms. e.g. vm;iaasvmcontainerv2;my-resource-group;my-arm-vm for ARM vm and vm;iaasvmcontainer;my-classic-vm;my-classic-vm for classic vm')\\nparam existingProtectableItems array\\n\\n@description('Array of resourceid of iaasvm protectable items. Provide resourceids of each VMs for which you want to configure protection. e.g. /subscriptions/subscriptionid/resourceGroups/resourceGroupName/providers/Microsoft.Compute/virtualMachines/vmName')\\nparam existingSourceResourceIds array\\n\\n@description('Name of existing Backup Policy in same Recovery Services Vault.')\\nparam existingBackupPolicyName string\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nvar backupFabric = 'Azure'\\nvar protectedItemType = 'Microsoft.ClassicCompute/virtualMachines'\\n\\nresource protectedItems 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems@2016-06-01' = [for (item, i) in existingProtectableItems: {\\n  name: '${existingRecoveryServicesVaultName}/${backupFabric}/${existingProtectionContainers[i]}/${item}'\\n  location: location\\n  properties: {\\n    protectedItemType: protectedItemType\\n    policyId: resourceId('Microsoft.RecoveryServices/vaults/backupPolicies', existingRecoveryServicesVaultName, existingBackupPolicyName)\\n    sourceResourceId: existingSourceResourceIds[i]\\n  }\\n}]\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"existingRecoveryServicesVaultName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingProtectionContainers\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingProtectableItems\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingSourceResourceIds\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"existingBackupPolicyName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Email addresses to which the notifications should be sent. Should be specified as an array of strings, for example, [\\\"user1@contoso.com\\\", \\\"user2@contoso.com\\\"].')\\nparam emailAddress array\\n\\n@description('An action group is the channel to which a notification is sent, for example, email. Edit this field if you wish to use a custom name for the action group, otherwise, you can leave this unchanged. An action group name can have a length of 1-260 characters. You cannot use :,<,>,+,/,&,%,\\\\\\\\,? or control characters. The name cannot end with a space or period.')\\nparam actionGroupName string = 'ActionGroup-${resourceGroup().name}'\\n\\n@description('Short name of the action group used for display purposes. Can be 1-12 characters in length.')\\n@maxLength(12)\\nparam actionGroupShortName string = 'ag-${((length(resourceGroup().name) >= 9) ? substring(resourceGroup().name, 0, 9) : resourceGroup().name)}'\\n\\n@description('An alert processing rule lets you associate alerts to action groups. Edit this field if you wish to use a custom name for the alert processing rule, otherwise, you can leave this unchanged. An alert processing rule name can have a length of 1-260 characters. You cannot use <,>,*,%,&,:,\\\\\\\\,?,+,/,#,@,{,}.')\\nparam alertProcessingRuleName string = 'AlertProcessingRule-${resourceGroup().name}'\\n\\n@description('Description of the alert processing rule.')\\nparam alertProcessingRuleDescription string = 'Sample alert processing rule'\\n\\n@description('The scope of resources for which the alert processing rule will apply. You can leave this field unchanged if you wish to apply the rule for all Recovery Services vault within the subscription. If you wish to apply the rule on smaller scopes, you can specify an array of ARM URLs representing the scopes, eg. [\\\\'/subscriptions/<sub-id>/resourceGroups/RG1\\\\', \\\\'/subscriptions/<sub-id>/resourceGroups/RG2\\\\']')\\nparam alertProcessingRuleScope array = [\\n  subscription().id\\n]\\n\\nresource actionGroup 'Microsoft.Insights/actionGroups@2021-09-01' = {\\n  name: actionGroupName\\n  location: 'Global'\\n  properties: {\\n    emailReceivers: [for item in emailAddress: {\\n      name: 'emailReceivers-${uniqueString(item)}'\\n      emailAddress: item\\n      useCommonAlertSchema: true\\n    }]\\n    groupShortName: actionGroupShortName\\n    enabled: true\\n  }\\n}\\n\\nresource alertProcessingRule 'Microsoft.AlertsManagement/actionRules@2021-08-08' = {\\n  name: alertProcessingRuleName\\n  location: 'Global'\\n  properties: {\\n    scopes: alertProcessingRuleScope\\n    conditions: [\\n      {\\n        field: 'TargetResourceType'\\n        operator: 'Equals'\\n        values: [\\n          'microsoft.recoveryservices/vaults'\\n        ]\\n      }\\n    ]\\n    description: alertProcessingRuleDescription\\n    enabled: true\\n    actions: [\\n      {\\n        actionGroupIds: [\\n          actionGroup.id\\n        ]\\n        actionType: 'AddActionGroups'\\n      }\\n    ]\\n  }\\n}\\n\\noutput actionGroupId string = actionGroup.id\\noutput alertProcessingRuleId string = alertProcessingRule.id\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"emailAddress\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"actionGroupName\\\": {\\n      \\\"value\\\": \\\"ActionGroup-${resourceGroup().name}\\\"\\n    },\\n    \\\"actionGroupShortName\\\": {\\n      \\\"value\\\": \\\"ag-${((length(resourceGroup().name) >= 9) ? substring(resourceGroup().name, 0, 9) : resourceGroup().name)}\\\"\\n    },\\n    \\\"alertProcessingRuleName\\\": {\\n      \\\"value\\\": \\\"AlertProcessingRule-${resourceGroup().name}\\\"\\n    },\\n    \\\"alertProcessingRuleDescription\\\": {\\n      \\\"value\\\": \\\"Sample alert processing rule\\\"\\n    },\\n    \\\"alertProcessingRuleScope\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n\\n// Required parameters\\n@description('Location of the recovery service Vault for disaster recovery')\\nparam replicationLocation string = 'eastus'\\n\\n@description('Virtual network resource name.')\\nparam virtualNetworkName string\\n@description('Virtual network resource Address Space.')\\nparam virtualNetworkAddressSpace string = '10.100.0.0/16'\\n@description('Virtual network resource Subnet 1 name.')\\nparam subnetName1 string\\n@description('Virtual network resource Subnet 2 name.')\\nparam subnetName2 string\\n@description('Virtual network resource Subnet 1 Address Prefix.')\\nparam subnetAddressPrefix1 string = '10.100.0.0/24'\\n@description('Virtual network resource Subnet 2 Address Prefix.')\\nparam subnetAddressPrefix2 string = '10.100.1.0/24'\\n@description('Storage account name')\\nparam storageAccountName string = 'storage${uniqueString(subscription().id)}'\\n@description('Azure recovery service vault name')\\nparam recoveryServiceVaultName string = 'rsv-${uniqueString(subscription().id)}'\\nparam replicationPolicyName string = 'DailyPolicy-${uniqueString(resourceGroup().id)}'\\n\\n\\n@description('Set to true is disaster recovery vm replication should be enabled on the VM')\\nparam disasterRecoveryEnabled bool = false\\n\\n@description('Provide the virtual network ID for replication secondary region')\\nparam recoveryNetworkId string = 'none'\\n\\n@description('Resource ID of the Virtual machine that needs replication')\\nparam virtualMachineId string = 'none'\\n\\n@description('Resource group ID of where the virtual machine will be replicated to')\\nparam recoveryResourceGroupId string = 'none'\\nvar blobPrivateDnsZoneName = 'privatelink.blob.${environment().suffixes.storage}'\\nvar filePrivateDnsZoneName = 'privatelink.file.${environment().suffixes.storage}'\\nvar queuePrivateDnsZoneName = 'privatelink.queue.${environment().suffixes.storage}'\\nvar roleDefinitionContributorId = resourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\\nvar roleDefinitionStorageBlobDataContributorId = resourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')\\nvar rsvPrivateDnsZoneName = 'privatelink.siterecovery.windowsazure.com'\\nvar instanceType = 'A2A'\\n\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2024-01-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [virtualNetworkAddressSpace]\\n    }\\n  }\\n}\\n\\nresource computeSubnet 'Microsoft.Network/virtualNetworks/subnets@2024-01-01' = {\\n  parent: virtualNetwork\\n  name: subnetName1\\n  properties: {\\n    addressPrefix: subnetAddressPrefix1\\n    privateEndpointNetworkPolicies: 'Enabled'\\n  }\\n}\\n\\nresource privateEndpointSubnet 'Microsoft.Network/virtualNetworks/subnets@2024-01-01' = {\\n  parent: virtualNetwork\\n  name: subnetName2\\n  properties: {\\n    addressPrefix: subnetAddressPrefix2\\n    privateEndpointNetworkPolicies: 'Enabled'\\n  }\\n\\n  dependsOn: [\\n    computeSubnet\\n  ]\\n}\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-05-01' = {\\n  name: toLower(storageAccountName)\\n  location: location\\n  sku: {\\n    name: 'Standard_GRS'\\n  }\\n  kind: 'StorageV2'\\n  properties: {\\n    accessTier: 'Hot'\\n    allowBlobPublicAccess: false\\n    minimumTlsVersion: 'TLS1_2'\\n    supportsHttpsTrafficOnly: true\\n    networkAcls: {\\n      bypass: 'AzureServices'\\n      defaultAction: 'Deny'\\n    }\\n  }\\n}\\n\\nresource blobPrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = {\\n  name: blobPrivateDnsZoneName\\n  location: 'global'\\n}\\n\\nresource filePrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = {\\n  name: filePrivateDnsZoneName\\n  location: 'global'\\n}\\n\\nresource queuePrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = {\\n  name: queuePrivateDnsZoneName\\n  location: 'global'\\n}\\n\\nresource blobPrivateDnsZoneNameVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01' = {\\n  parent: blobPrivateDnsZone\\n  name: 'link_to_${toLower(split(virtualNetwork.id, '/')[8])}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: virtualNetwork.id\\n    }\\n  }\\n}\\n\\nresource filePrivateDnsZoneNameVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01' = {\\n  parent: filePrivateDnsZone\\n  name: 'link_to_${toLower(split(virtualNetwork.id, '/')[8])}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: virtualNetwork.id\\n    }\\n  }\\n}\\n\\nresource queuePrivateDnsZoneNameVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01' = {\\n  parent: queuePrivateDnsZone\\n  name: 'link_to_${toLower(split(virtualNetwork.id, '/')[8])}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: virtualNetwork.id\\n    }\\n  }\\n}\\n\\nresource blobPrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\\n  name: '${storageAccount.name}-blob-pe'\\n  location: location\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: '${storageAccount.name}-blob-pe'\\n        properties: {\\n          privateLinkServiceId: storageAccount.id\\n          groupIds: [\\n            'blob'\\n          ]\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: privateEndpointSubnet.id\\n    }\\n  }\\n}\\n\\nresource filePrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\\n  name: '${storageAccount.name}-file-pe'\\n  location: location\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: '${storageAccount.name}-file-pe'\\n        properties: {\\n          privateLinkServiceId: storageAccount.id\\n          groupIds: [\\n            'file'\\n          ]\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: privateEndpointSubnet.id\\n    }\\n  }\\n}\\n\\nresource queuePrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\\n  name: '${storageAccount.name}-queue-pe'\\n  location: location\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: '${storageAccount.name}-queue-pe'\\n        properties: {\\n          privateLinkServiceId: storageAccount.id\\n          groupIds: [\\n            'queue'\\n          ]\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: privateEndpointSubnet.id\\n    }\\n  }\\n}\\n\\nresource blobPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2024-01-01' = {\\n  parent: blobPrivateEndpoint\\n  name: 'blob'\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: 'dnsConfig'\\n        properties: {\\n          privateDnsZoneId: blobPrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource filePrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2024-01-01' = {\\n  parent: filePrivateEndpoint\\n  name: 'file'\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: 'dnsConfig'\\n        properties: {\\n          privateDnsZoneId: filePrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource queuePrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2024-01-01' = {\\n  parent: queuePrivateEndpoint\\n  name: 'queue'\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: 'dnsConfig'\\n        properties: {\\n          privateDnsZoneId: queuePrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource recoveryServiceVault 'Microsoft.RecoveryServices/vaults@2024-04-30-preview' = {\\n  name: recoveryServiceVaultName\\n  location: replicationLocation\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  sku: {\\n    name: 'RS0'\\n    tier: 'Standard'\\n  }\\n  properties: {\\n    redundancySettings: {\\n      crossRegionRestore: 'Disabled'\\n      standardTierStorageRedundancy: 'GeoRedundant'\\n    }\\n    publicNetworkAccess: 'Enabled'\\n  }\\n}\\n\\nresource roleAssignmentContributor 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  scope: storageAccount\\n  name: guid(resourceGroup().id, storageAccount.id, 'Contributor')\\n  properties: {\\n    roleDefinitionId: roleDefinitionContributorId\\n    principalType: 'ServicePrincipal'\\n    principalId: recoveryServiceVault.identity.principalId\\n  }\\n}\\n\\nresource roleAssignmentStorageBlobDataContributor 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\\n  scope: storageAccount\\n  name: guid(resourceGroup().id, storageAccount.id, 'Storage Blob Data Contributor')\\n  properties: {\\n    roleDefinitionId: roleDefinitionStorageBlobDataContributorId\\n    principalType: 'ServicePrincipal'\\n    principalId: recoveryServiceVault.identity.principalId\\n  }\\n}\\n\\nresource rsvPrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = {\\n  name: rsvPrivateDnsZoneName\\n  location: 'global'\\n}\\n\\nresource rsvPrivateDnsZoneNameVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01' = {\\n  parent: rsvPrivateDnsZone\\n  name: 'link_to_${toLower(split(virtualNetwork.id, '/')[8])}'\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: virtualNetwork.id\\n    }\\n  }\\n}\\n\\nresource rsvPrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\\n  name: '${recoveryServiceVault.name}-rsv-pe'\\n  location: location\\n  properties: {\\n    privateLinkServiceConnections: [\\n      {\\n        name: '${recoveryServiceVault.name}-rsv-pe'\\n        properties: {\\n          privateLinkServiceId: recoveryServiceVault.id\\n          groupIds: [\\n            'AzureSiteRecovery'\\n          ]\\n        }\\n      }\\n    ]\\n    subnet: {\\n      id: privateEndpointSubnet.id\\n    }\\n  }\\n}\\n\\nresource rsvPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2024-01-01' = {\\n  parent: rsvPrivateEndpoint\\n  name: 'AzureSiteRecovery'\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: 'dnsConfig'\\n        properties: {\\n          privateDnsZoneId: rsvPrivateDnsZone.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource replicationPolicies 'Microsoft.RecoveryServices/vaults/replicationPolicies@2024-04-01' = {\\n  parent: recoveryServiceVault\\n  name: replicationPolicyName\\n  properties: {\\n    providerSpecificInput: {\\n      instanceType: instanceType\\n      appConsistentFrequencyInMinutes: 4 * 60\\n      crashConsistentFrequencyInMinutes: 5\\n      multiVmSyncStatus: 'Enable'\\n      recoveryPointHistory: 24 * 60\\n    }\\n  }\\n}\\n\\nresource primaryRSVFabric 'Microsoft.RecoveryServices/vaults/replicationFabrics@2024-04-01' = {\\n  parent: recoveryServiceVault\\n  name: 'Primary-Fabric'\\n  properties: {\\n    customDetails: {\\n      instanceType: 'Azure'\\n      location: location\\n    }\\n  }\\n}\\n\\nresource secondaryRSVFabric 'Microsoft.RecoveryServices/vaults/replicationFabrics@2024-04-01' = {\\n  parent: recoveryServiceVault\\n  name: 'Secondary-Fabric'\\n  properties: {\\n    customDetails: {\\n      instanceType: 'Azure'\\n      location: recoveryServiceVault.location\\n    }\\n  }\\n}\\n\\nresource primaryRSVFabricProtectionContainers 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers@2024-04-01' = {\\n  parent: primaryRSVFabric\\n  name: 'Primary-Protection-Container'\\n  properties: {\\n    providerSpecificInput: [\\n      {\\n        instanceType: instanceType\\n      }\\n    ]\\n  }\\n}\\n\\nresource secondaryRSVFabricProtectionContainers 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers@2024-04-01' = {\\n  parent: secondaryRSVFabric\\n  name: 'Secondary-Protection-Container'\\n  properties: {\\n    providerSpecificInput: [\\n      {\\n        instanceType: instanceType\\n      }\\n    ]\\n  }\\n}\\n\\nresource protectionContainerMappings 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers/replicationProtectionContainerMappings@2024-04-01' = {\\n  parent: primaryRSVFabricProtectionContainers\\n  name: 'Primary-Container-Mapping'\\n  properties: {\\n    policyId: replicationPolicies.id\\n    providerSpecificInput: {\\n      instanceType: instanceType\\n    }\\n    targetProtectionContainerId: secondaryRSVFabricProtectionContainers.id\\n  }\\n}\\n\\nresource primaryReplicationNetworkMappings 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationNetworks/replicationNetworkMappings@2024-04-01' = if(disasterRecoveryEnabled) {\\n  name: format('{0}/{1}/{2}/{3}',recoveryServiceVault.name, primaryRSVFabric.name, 'azureNetwork', 'Source-Network-Mapping')\\n  properties: {\\n    fabricSpecificDetails: {\\n      instanceType: 'AzureToAzure'\\n      primaryNetworkId: virtualNetwork.id\\n    }\\n    recoveryFabricName: secondaryRSVFabric.name\\n    recoveryNetworkId: recoveryNetworkId\\n  }\\n}\\n\\nresource secondaryReplicationNetworkMappings 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationNetworks/replicationNetworkMappings@2024-04-01' = if(disasterRecoveryEnabled) {\\n  name: format('{0}/{1}/{2}/{3}',recoveryServiceVault.name, secondaryRSVFabric.name, 'azureNetwork', 'Target-Network-Mapping')\\n  properties: {\\n    fabricSpecificDetails: {\\n      instanceType: 'AzureToAzure'\\n      primaryNetworkId: recoveryNetworkId\\n    }\\n    recoveryFabricName: primaryRSVFabric.name\\n    recoveryNetworkId: virtualNetwork.id\\n  }\\n}\\n\\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2024-07-01' existing = if(disasterRecoveryEnabled) {\\n  scope: az.resourceGroup(split(virtualMachineId, '/')[4])\\n  name: split(virtualMachineId, '/')[8]\\n}\\n\\nresource replicationProtectedItems 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers/replicationProtectedItems@2024-04-01' = if(disasterRecoveryEnabled) {\\n  parent: primaryRSVFabricProtectionContainers\\n  name: virtualMachine.name\\n  properties: {\\n    policyId: replicationPolicies.id\\n    providerSpecificDetails: {\\n      instanceType: instanceType\\n      autoProtectionOfDataDisk: 'Enabled'\\n      fabricObjectId: virtualMachine.id\\n      recoveryResourceGroupId: recoveryResourceGroupId\\n      recoveryContainerId: secondaryRSVFabricProtectionContainers.id\\n      recoveryAzureNetworkId: recoveryNetworkId\\n      recoverySubnetName: computeSubnet.name\\n      vmManagedDisks: [\\n        {\\n          diskId: virtualMachine.id\\n          primaryStagingAzureStorageAccountId: storageAccount.id\\n          recoveryReplicaDiskAccountType: virtualMachine.properties.storageProfile.osDisk.managedDisk.storageAccountType\\n          recoveryTargetDiskAccountType: virtualMachine.properties.storageProfile.osDisk.managedDisk.storageAccountType\\n          recoveryResourceGroupId: recoveryResourceGroupId\\n        }\\n      ]\\n    }\\n  }\\n\\n  dependsOn: [\\n    protectionContainerMappings\\n    primaryReplicationNetworkMappings\\n    secondaryReplicationNetworkMappings\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"replicationLocation\\\": {\\n      \\\"value\\\": \\\"eastus\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"virtualNetworkAddressSpace\\\": {\\n      \\\"value\\\": \\\"10.100.0.0/16\\\"\\n    },\\n    \\\"subnetName1\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetName2\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"subnetAddressPrefix1\\\": {\\n      \\\"value\\\": \\\"10.100.0.0/24\\\"\\n    },\\n    \\\"subnetAddressPrefix2\\\": {\\n      \\\"value\\\": \\\"10.100.1.0/24\\\"\\n    },\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"storage${uniqueString(subscription().id)}\\\"\\n    },\\n    \\\"recoveryServiceVaultName\\\": {\\n      \\\"value\\\": \\\"rsv-${uniqueString(subscription().id)}\\\"\\n    },\\n    \\\"replicationPolicyName\\\": {\\n      \\\"value\\\": \\\"DailyPolicy-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"disasterRecoveryEnabled\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"recoveryNetworkId\\\": {\\n      \\\"value\\\": \\\"none\\\"\\n    },\\n    \\\"virtualMachineId\\\": {\\n      \\\"value\\\": \\\"none\\\"\\n    },\\n    \\\"recoveryResourceGroupId\\\": {\\n      \\\"value\\\": \\\"none\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [{\"resourceType\": \"br/public:deployment-scripts/wait:1.0.1\", \"name\": \"rbacPropagationDelay\"}], \"rationale\": \"AVM module deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the Azure Application Gateway')\\nparam agwName string = 'agw-${uniqueString(resourceGroup().id)}'\\n\\n@description('The name of the Azure Application Gateway Managed Identity')\\nparam agwIdName string = 'id-${agwName}'\\n\\n@description('The name of the Azure Key Vault')\\nparam akvName string\\n\\n@secure()\\n@description('The URI of the frontend KeyVault Certificate Secret Id')\\nparam frontEndCertificateSecretId string\\n\\n@description('This is the IP address the web application is hosted on')\\nparam backendIpAddress string\\n\\n@description('The location to deploy the resources to')\\nparam location string = resourceGroup().location\\n\\nvar appgwSubnetAddress = '10.0.1.0/24'\\nvar frontendAgwCertificateName = 'frontend'\\n\\nvar appgwResourceId = resourceId('Microsoft.Network/applicationGateways', '${agwName}')\\nvar frontendAgwCertificateId = '${appgwResourceId}/sslCertificates/${frontendAgwCertificateName}'\\n\\nvar keyVaultSecretsUserRole = resourceId('Microsoft.Authorization/roleDefinitions', '4633458b-17de-408a-b874-0445c86b69e6')\\n\\nresource akv 'Microsoft.KeyVault/vaults@2021-11-01-preview' existing = {\\n  name: akvName\\n}\\n\\nresource vnet 'Microsoft.Network/virtualNetworks@2021-05-01' = {\\n  name: 'vnet-${uniqueString(resourceGroup().id)}'\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        appgwSubnetAddress\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: 'agw'\\n        properties: {\\n          addressPrefix: appgwSubnetAddress\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource agwId 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\\n  name: agwIdName\\n  location: location\\n}\\n\\nresource agw 'Microsoft.Network/applicationGateways@2021-08-01' = {\\n  name: agwName\\n  location: location\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${agwId.id}': {}\\n    }\\n  }\\n  dependsOn: [\\n    rbacPropagationDelay\\n  ]\\n  properties: {\\n      sslCertificates: [\\n        {\\n          name: frontendAgwCertificateName\\n          properties: {\\n            keyVaultSecretId: frontEndCertificateSecretId\\n          }\\n        }\\n      ]\\n      sku: {\\n        capacity: 1\\n        tier: 'Standard_v2'\\n        name: 'Standard_v2'\\n      }\\n      gatewayIPConfigurations: [\\n        {\\n          name: 'besubnet'\\n          properties: {\\n            subnet: {\\n              id: vnet.properties.subnets[0].id\\n            }\\n          }\\n        }\\n      ]\\n      frontendIPConfigurations: [{\\n        properties: {\\n          publicIPAddress: {\\n            id: appgwpip.id\\n          }\\n        }\\n        name: 'appGatewayFrontendIP'\\n      }]\\n      frontendPorts: [\\n        {\\n          name: 'appGatewayFrontendPort'\\n          properties: {\\n            port: 443\\n          }\\n        }\\n      ]\\n      backendAddressPools: [\\n        {\\n          name: 'defaultaddresspool'\\n          properties: {\\n            backendAddresses: [\\n              {\\n                ipAddress: backendIpAddress\\n              }\\n            ]\\n          }\\n        }\\n      ]\\n      backendHttpSettingsCollection: [\\n        {\\n          name: 'defaulthttpsetting'\\n          properties: {\\n            port: 80\\n            protocol: 'Http'\\n            cookieBasedAffinity: 'Disabled'\\n            requestTimeout: 30\\n            pickHostNameFromBackendAddress: true\\n          }\\n        }\\n      ]\\n      httpListeners: [\\n        {\\n          name: 'hlisten'\\n          properties: {\\n            frontendIPConfiguration: {\\n              id: '${appgwResourceId}/frontendIPConfigurations/appGatewayFrontendIP'\\n            }\\n            frontendPort: {\\n              id: '${appgwResourceId}/frontendPorts/appGatewayFrontendPort'\\n            }\\n            protocol: 'Https'\\n            sslCertificate: {\\n              id: frontendAgwCertificateId\\n            }\\n          }\\n        }\\n      ]\\n      requestRoutingRules: [\\n        {\\n          name: 'appGwRoutingRuleName'\\n          properties: {\\n            ruleType: 'Basic'\\n            priority: 100\\n            httpListener: {\\n              id: '${appgwResourceId}/httpListeners/hlisten'\\n            }\\n            backendAddressPool: {\\n              id: '${appgwResourceId}/backendAddressPools/defaultaddresspool'\\n            }\\n            backendHttpSettings: {\\n              id: '${appgwResourceId}/backendHttpSettingsCollection/defaulthttpsetting'\\n            }\\n          }\\n        }\\n      ]\\n  }\\n}\\n\\nresource appgwpip 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\\n  name: 'pip-${agwName}'\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {\\n    publicIPAllocationMethod: 'Static'\\n  }\\n}\\noutput agwPip string = appgwpip.properties.ipAddress\\n\\nresource kvAppGwSecretsUserRole 'Microsoft.Authorization/roleAssignments@2020-08-01-preview' = {\\n  scope: akv\\n  name: guid(agwId.id, akv.id, keyVaultSecretsUserRole)\\n  properties: {\\n    roleDefinitionId: keyVaultSecretsUserRole\\n    principalType: 'ServicePrincipal'\\n    principalId: agwId.properties.principalId\\n  }\\n}\\n\\nmodule rbacPropagationDelay 'br/public:deployment-scripts/wait:1.0.1' = {\\n  name: 'DeploymentDelay'\\n  dependsOn: [\\n    kvAppGwSecretsUserRole\\n  ]\\n  params: {\\n    waitSeconds: 60\\n    location: location\\n  }\\n}\\n\\noutput agwId string = agw.id\\noutput agwName string = agw.name\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"agwName\\\": {\\n      \\\"value\\\": \\\"agw-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"agwIdName\\\": {\\n      \\\"value\\\": \\\"id-${agwName}\\\"\\n    },\\n    \\\"akvName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"frontEndCertificateSecretId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"backendIpAddress\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the Service Bus namespace')\\nparam serviceBusNamespaceName string\\n\\n@description('Name of the Queue')\\nparam serviceBusQueueName string\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\nresource serviceBusNamespace 'Microsoft.ServiceBus/namespaces@2022-01-01-preview' = {\\n  name: serviceBusNamespaceName\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n  }\\n  properties: {}\\n}\\n\\nresource serviceBusQueue 'Microsoft.ServiceBus/namespaces/queues@2022-01-01-preview' = {\\n  parent: serviceBusNamespace\\n  name: serviceBusQueueName\\n  properties: {\\n    lockDuration: 'PT5M'\\n    maxSizeInMegabytes: 1024\\n    requiresDuplicateDetection: false\\n    requiresSession: false\\n    defaultMessageTimeToLive: 'P10675199DT2H48M5.4775807S'\\n    deadLetteringOnMessageExpiration: false\\n    duplicateDetectionHistoryTimeWindow: 'PT10M'\\n    maxDeliveryCount: 10\\n    autoDeleteOnIdle: 'P10675199DT2H48M5.4775807S'\\n    enablePartitioning: false\\n    enableExpress: false\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"serviceBusNamespaceName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"serviceBusQueueName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the SQL logical server.')\\nparam serverName string = uniqueString('sql', resourceGroup().id)\\n\\n@description('The name of the SQL Database.')\\nparam sqlDBName string = 'SampleDB'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('The administrator username of the SQL logical server.')\\nparam administratorLogin string\\n\\n@description('The administrator password of the SQL logical server.')\\n@secure()\\nparam administratorLoginPassword string\\n\\nresource sqlServer 'Microsoft.Sql/servers@2022-05-01-preview' = {\\n  name: serverName\\n  location: location\\n  properties: {\\n    administratorLogin: administratorLogin\\n    administratorLoginPassword: administratorLoginPassword\\n  }\\n}\\n\\nresource sqlDB 'Microsoft.Sql/servers/databases@2022-05-01-preview' = {\\n  parent: sqlServer\\n  name: sqlDBName\\n  location: location\\n  sku: {\\n    name: 'Standard'\\n    tier: 'Standard'\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"serverName\\\": {\\n      \\\"value\\\": \\\"uniqueString('sql', resourceGroup().id)\\\"\\n    },\\n    \\\"sqlDBName\\\": {\\n      \\\"value\\\": \\\"SampleDB\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"administratorLogin\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"administratorLoginPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies the name of the Azure Storage account.')\\nparam storageAccountName string\\n\\n@description('Specifies the name of the blob container.')\\nparam containerName string\\n\\n@description('Specifies the location in which the Azure Storage resources should be deployed.')\\nparam location string = resourceGroup().location\\n\\nresource sa 'Microsoft.Storage/storageAccounts@2023-01-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: 'Standard_LRS'\\n  }\\n  kind: 'StorageV2'\\n  properties: {\\n    accessTier: 'Hot'\\n  }\\n}\\n\\nresource blobServices 'Microsoft.Storage/storageAccounts/blobServices@2023-01-01' = {\\n  parent: sa\\n  name: 'default'\\n}\\n\\nresource container 'Microsoft.Storage/storageAccounts/blobServices/containers@2023-01-01' = {\\n  parent: blobServices\\n  name: containerName\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"containerName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"// This template deploys an Azure Storage account, and then configures it to support static website hosting.\\n// Enabling static website hosting isn't possible directly in Bicep or an ARM template,\\n// so this sample uses a deployment script to enable the feature.\\n\\n@description('The location into which the resources should be deployed.')\\nparam location string = resourceGroup().location\\n\\n@description('The name of the storage account to use for site hosting.')\\nparam storageAccountName string = 'stor${uniqueString(resourceGroup().id)}'\\n\\n@allowed([\\n  'Standard_LRS'\\n  'Standard_GRS'\\n  'Standard_ZRS'\\n  'Premium_LRS'\\n])\\n@description('The storage account sku name.')\\nparam storageSku string = 'Standard_LRS'\\n\\n@description('The path to the web index document.')\\nparam indexDocumentPath string = 'index.html'\\n\\n@description('The contents of the web index document.')\\nparam indexDocumentContents string = '<h1>Example static website</h1>'\\n\\n@description('The path to the web error document.')\\nparam errorDocument404Path string = 'error.html'\\n\\n@description('The contents of the web error document.')\\nparam errorDocument404Contents string = '<h1>Example 404 error page</h1>'\\n\\nresource contributorRoleDefinition 'Microsoft.Authorization/roleDefinitions@2018-01-01-preview' existing = {\\n  scope: subscription()\\n  // This is the Storage Account Contributor role, which is the minimum role permission we can give. See https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#:~:text=17d1049b-9a84-46fb-8f53-869881c3d3ab\\n  name: '17d1049b-9a84-46fb-8f53-869881c3d3ab'\\n}\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-06-01' = {\\n  name: storageAccountName\\n  location: location\\n  kind: 'StorageV2'\\n  sku: {\\n    name: storageSku\\n  }\\n}\\n\\nresource managedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\\n  name: 'DeploymentScript'\\n  location: location\\n}\\n\\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2020-04-01-preview' = {\\n  scope: storageAccount\\n  name: guid(resourceGroup().id, managedIdentity.id, contributorRoleDefinition.id)\\n  properties: {\\n    roleDefinitionId: contributorRoleDefinition.id\\n    principalId: managedIdentity.properties.principalId\\n    principalType: 'ServicePrincipal'\\n  }\\n}\\n\\nresource deploymentScript 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\\n  name: 'deploymentScript'\\n  location: location\\n  kind: 'AzurePowerShell'\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${managedIdentity.id}': {}\\n    }\\n  }\\n  dependsOn: [\\n    // we need to ensure we wait for the role assignment to be deployed before trying to access the storage account\\n    roleAssignment\\n  ]\\n  properties: {\\n    azPowerShellVersion: '3.0'\\n    scriptContent: loadTextContent('./scripts/enable-static-website.ps1')\\n    retentionInterval: 'PT4H'\\n    environmentVariables: [\\n      {\\n        name: 'ResourceGroupName'\\n        value: resourceGroup().name\\n      }\\n      {\\n        name: 'StorageAccountName'\\n        value: storageAccount.name\\n      }\\n      {\\n        name: 'IndexDocumentPath'\\n        value: indexDocumentPath\\n      }\\n      {\\n        name: 'IndexDocumentContents'\\n        value: indexDocumentContents\\n      }\\n      {\\n        name: 'ErrorDocument404Path'\\n        value: errorDocument404Path\\n      }\\n      {\\n        name: 'ErrorDocument404Contents'\\n        value: errorDocument404Contents\\n      }\\n    ]\\n  }\\n}\\n\\noutput staticWebsiteUrl string = storageAccount.properties.primaryEndpoints.web\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"storageAccountName\\\": {\\n      \\\"value\\\": \\\"stor${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"storageSku\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"indexDocumentPath\\\": {\\n      \\\"value\\\": \\\"index.html\\\"\\n    },\\n    \\\"indexDocumentContents\\\": {\\n      \\\"value\\\": \\\"<h1>Example static website</h1>\\\"\\n    },\\n    \\\"errorDocument404Path\\\": {\\n      \\\"value\\\": \\\"error.html\\\"\\n    },\\n    \\\"errorDocument404Contents\\\": {\\n      \\\"value\\\": \\\"<h1>Example 404 error page</h1>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Web App name.')\\n@minLength(2)\\nparam appServiceWebAppName string = 'webApp-${uniqueString(resourceGroup().id)}'\\n\\n@description('App Service Plan name.')\\n@minLength(2)\\nparam appServicePlanName string = 'webApp-${uniqueString(resourceGroup().id)}'\\nparam skuTier string = 'P1v3'\\nparam location string = resourceGroup().location\\n\\nresource appServiceWebApp 'Microsoft.Web/sites@2023-01-01' = {\\n  name: appServiceWebAppName\\n  location: location\\n  tags: {\\n    'hidden-related:${appServicePlan.id}': 'empty'\\n  }\\n  properties: {\\n    siteConfig: {\\n      appSettings: [\\n        {\\n          name: 'PORT'\\n          value: '8080'\\n        }\\n      ]\\n      appCommandLine: ''\\n      windowsFxVersion: 'DOCKER|mcr.microsoft.com/dotnet/samples:aspnetapp'\\n    }\\n    serverFarmId: appServicePlan.id \\n  }\\n}\\n\\nresource appServicePlan 'Microsoft.Web/serverfarms@2023-01-01' = {\\n  name: appServicePlanName\\n  location: location\\n  sku: {\\n    name: skuTier\\n  }\\n  kind: 'windows'\\n  properties: {\\n    hyperV: true\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"appServiceWebAppName\\\": {\\n      \\\"value\\\": \\\"webApp-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"appServicePlanName\\\": {\\n      \\\"value\\\": \\\"webApp-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"skuTier\\\": {\\n      \\\"value\\\": \\\"P1v3\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the function app that you wish to create.')\\nparam appName string = 'fnapp${uniqueString(resourceGroup().id)}'\\n\\n@description('Storage Account type')\\n@allowed([\\n  'Standard_LRS'\\n  'Standard_GRS'\\n  'Standard_RAGRS'\\n])\\nparam storageAccountType string = 'Standard_LRS'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Location for Application Insights')\\nparam appInsightsLocation string\\n\\n@description('The language worker runtime to load in the function app.')\\n@allowed([\\n  'node'\\n  'dotnet'\\n  'java'\\n])\\nparam runtime string = 'node'\\n\\nvar functionAppName = appName\\nvar hostingPlanName = appName\\nvar applicationInsightsName = appName\\nvar storageAccountName = '${uniqueString(resourceGroup().id)}azfunctions'\\nvar functionWorkerRuntime = runtime\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n  kind: 'Storage'\\n}\\n\\nresource hostingPlan 'Microsoft.Web/serverfarms@2023-01-01' = {\\n  name: hostingPlanName\\n  location: location\\n  sku: {\\n    name: 'Y1'\\n    tier: 'Dynamic'\\n  }\\n}\\n\\nresource functionApp 'Microsoft.Web/sites@2023-01-01' = {\\n  name: functionAppName\\n  location: location\\n  kind: 'functionapp'\\n  properties: {\\n    serverFarmId: hostingPlan.id\\n    siteConfig: {\\n      appSettings: [\\n        {\\n          name: 'AzureWebJobsStorage'\\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\\n        }\\n        {\\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\\n        }\\n        {\\n          name: 'WEBSITE_CONTENTSHARE'\\n          value: toLower(functionAppName)\\n        }\\n        {\\n          name: 'FUNCTIONS_EXTENSION_VERSION'\\n          value: '~4'\\n        }\\n        {\\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\\n          value: '~14'\\n        }\\n        {\\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\\n          value: applicationInsights.properties.InstrumentationKey\\n        }\\n        {\\n          name: 'FUNCTIONS_WORKER_RUNTIME'\\n          value: functionWorkerRuntime\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource deploymentSlot 'Microsoft.Web/sites/slots@2023-01-01' = {\\n  parent: functionApp\\n  name: 'deployment'\\n  kind: 'functionapp'\\n  location: location\\n  properties: {\\n    serverFarmId: hostingPlan.id\\n    siteConfig: {\\n      appSettings: [\\n        {\\n          name: 'AzureWebJobsStorage'\\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${listKeys(storageAccount.id, '2019-06-01').keys[0].value}'\\n        }\\n        {\\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${listKeys(storageAccount.id, '2019-06-01').keys[0].value}'\\n        }\\n        {\\n          name: 'FUNCTIONS_EXTENSION_VERSION'\\n          value: '~3'\\n        }\\n        {\\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\\n          value: '~10'\\n        }\\n        {\\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\\n          value: applicationInsights.properties.InstrumentationKey\\n        }\\n        {\\n          name: 'FUNCTIONS_WORKER_RUNTIME'\\n          value: functionWorkerRuntime\\n        }\\n      ]\\n    }\\n  }\\n}\\n\\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\\n  name: applicationInsightsName\\n  location: appInsightsLocation\\n  tags: {\\n    'hidden-link:${resourceId('Microsoft.Web/sites', applicationInsightsName)}': 'Resource'\\n  }\\n  kind: 'web'\\n  properties: {\\n    Application_Type: 'web'\\n    Request_Source: 'IbizaWebAppExtensionCreate'\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"appName\\\": {\\n      \\\"value\\\": \\\"fnapp${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"storageAccountType\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"appInsightsLocation\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"runtime\\\": {\\n      \\\"value\\\": \\\"node\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The name of the Azure Function app.')\\nparam functionAppName string = 'func-${uniqueString(resourceGroup().id)}'\\n\\n@description('Storage Account type')\\n@allowed([\\n  'Standard_LRS'\\n  'Standard_GRS'\\n  'Standard_RAGRS'\\n])\\nparam storageAccountType string = 'Standard_LRS'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Location for Application Insights')\\nparam appInsightsLocation string = resourceGroup().location\\n\\n@description('The language worker runtime to load in the function app.')\\n@allowed([\\n  'dotnet'\\n  'node'\\n  'python'\\n  'java'\\n])\\nparam functionWorkerRuntime string = 'node'\\n\\n@description('Specifies the OS used for the Azure Function hosting plan.')\\n@allowed([\\n  'Windows'\\n  'Linux'\\n])\\nparam functionPlanOS string = 'Windows'\\n\\n@description('Specifies the Azure Function hosting plan SKU.')\\n@allowed([\\n  'EP1'\\n  'EP2'\\n  'EP3'\\n])\\nparam functionAppPlanSku string = 'EP1'\\n\\n@description('The name of the virtual network to be created.')\\nparam vnetName string = 'vnet-${uniqueString(resourceGroup().id)}'\\n\\n@description('The name of the subnet to be created within the virtual network.')\\nparam subnetName string = 'subnet-${uniqueString(resourceGroup().id)}'\\n\\n@description('Only required for Linux app to represent runtime stack in the format of \\\\'runtime|runtimeVersion\\\\'. For example: \\\\'python|3.9\\\\'')\\nparam linuxFxVersion string = ''\\n\\nvar vnetAddressPrefix = '10.0.0.0/16'\\nvar subnetAddressPrefix = '10.0.0.0/24'\\nvar hostingPlanName = functionAppName\\nvar applicationInsightsName = functionAppName\\nvar storageAccountName = '${uniqueString(resourceGroup().id)}azfunctions'\\nvar isReserved = ((functionPlanOS == 'Linux') ? true : false)\\n\\nresource vnet 'Microsoft.Network/virtualNetworks@2022-05-01' = {\\n  name: vnetName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        vnetAddressPrefix\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetName\\n        properties: {\\n          addressPrefix: subnetAddressPrefix\\n          delegations: [\\n            {\\n              name: 'delegation'\\n              properties: {\\n                serviceName: 'Microsoft.Web/serverFarms'\\n              }\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\\n  name: storageAccountName\\n  location: location\\n  sku: {\\n    name: storageAccountType\\n  }\\n  kind: 'Storage'\\n}\\n\\nresource hostingPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\\n  name: hostingPlanName\\n  location: location\\n  sku: {\\n    tier: 'ElasticPremium'\\n    name: functionAppPlanSku\\n    family: 'EP'\\n  }\\n  properties: {\\n    maximumElasticWorkerCount: 20\\n    reserved: isReserved\\n  }\\n  kind: 'elastic'\\n}\\n\\nresource insight 'Microsoft.Insights/components@2020-02-02' = {\\n  name: applicationInsightsName\\n  location: appInsightsLocation\\n  tags: {\\n    'hidden-link:${resourceId('Microsoft.Web/sites', applicationInsightsName)}': 'Resource'\\n  }\\n  properties: {\\n    Application_Type: 'web'\\n  }\\n  kind: 'web'\\n}\\n\\nresource site 'Microsoft.Web/sites@2022-03-01' = {\\n  name: functionAppName\\n  location: location\\n  kind: (isReserved ? 'functionapp,linux' : 'functionapp')\\n  properties: {\\n    reserved: isReserved\\n    serverFarmId: hostingPlan.id\\n    siteConfig: {\\n      linuxFxVersion: (isReserved ? linuxFxVersion : json('null'))\\n      appSettings: [\\n        {\\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\\n          value: insight.properties.InstrumentationKey\\n        }\\n        {\\n          name: 'AzureWebJobsStorage'\\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix= ${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\\n        }\\n        {\\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value};'\\n        }\\n        {\\n          name: 'WEBSITE_CONTENTSHARE'\\n          value: toLower(functionAppName)\\n        }\\n        {\\n          name: 'FUNCTIONS_EXTENSION_VERSION'\\n          value: '~4'\\n        }\\n        {\\n          name: 'FUNCTIONS_WORKER_RUNTIME'\\n          value: functionWorkerRuntime\\n        }\\n        {\\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\\n          value: '~14'\\n        }\\n      ]\\n    }\\n  }\\n  dependsOn: [\\n    vnet\\n  ]\\n}\\n\\nresource functionAppName_virtualNetwork 'Microsoft.Web/sites/networkConfig@2022-03-01' = {\\n  parent: site\\n  name: 'virtualNetwork'\\n  properties: {\\n    subnetResourceId: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, subnetName)\\n    swiftSupported: true\\n  }\\n  dependsOn: [\\n    vnet\\n  ]\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"functionAppName\\\": {\\n      \\\"value\\\": \\\"func-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"storageAccountType\\\": {\\n      \\\"value\\\": \\\"Standard_LRS\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"appInsightsLocation\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"functionWorkerRuntime\\\": {\\n      \\\"value\\\": \\\"node\\\"\\n    },\\n    \\\"functionPlanOS\\\": {\\n      \\\"value\\\": \\\"Windows\\\"\\n    },\\n    \\\"functionAppPlanSku\\\": {\\n      \\\"value\\\": \\\"EP1\\\"\\n    },\\n    \\\"vnetName\\\": {\\n      \\\"value\\\": \\\"vnet-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"subnet-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"linuxFxVersion\\\": {\\n      \\\"value\\\": \\\"\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Required. Use existing virtual network and subnet.')\\nparam useExistingVnetandSubnet bool = false\\n\\n@description('Required. Resource Group name of virtual network if using existing vnet and subnet.')\\nparam vNetResourceGroupName string = resourceGroup().name\\n\\n@description('Required. The Virtual Network (vNet) Name.')\\nparam virtualNetworkName string = 'vnet-asev3'\\n\\n@description('Required. Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Required. An Array of 1 or more IP Address Prefixes for the Virtual Network.')\\nparam vNetAddressPrefixes array = [\\n  '172.16.0.0/16'\\n]\\n\\n@description('Required. The subnet Name of ASEv3.')\\nparam subnetAddressPrefix string = '172.16.0.0/24'\\n\\n@description('Required. The subnet Name of ASEv3.')\\nparam subnetName string = 'snet-asev3'\\n\\n@description('Required. The subnet properties.')\\nparam subnets array = [\\n  {\\n    name: 'snet-asev3'\\n    addressPrefix: '172.16.0.0/24'\\n    delegations: [\\n      {\\n        name: 'Microsoft.Web.hostingEnvironments'\\n        properties: {\\n          serviceName: 'Microsoft.Web/hostingEnvironments'\\n        }\\n      }\\n    ]\\n    privateEndpointNetworkPolicies: 'Enabled'\\n    privateLinkServiceNetworkPolicies: 'Enabled'\\n    networkSecurityGroupName: 'nsg-asev3'\\n  }\\n]\\n\\n@description('Required. Name of ASEv3.')\\nparam aseName string\\n\\n@description('Required. Dedicated host count of ASEv3.')\\nparam dedicatedHostCount string = '0'\\n\\n@description('Required. Zone redundant of ASEv3.')\\nparam zoneRedundant bool = false\\n\\n@description('Optional. Create a private DNS zone for ASEv3.')\\nparam createPrivateDNS bool = true\\n@description('Required. Load balancer mode: 0-external load balancer, 3-internal load balancer for ASEv3.')\\n@allowed([\\n  0\\n  3\\n])\\nparam internalLoadBalancingMode int = 3\\n\\n@description('Required. Name of the Network Security Group.')\\n@minLength(1)\\nparam networkSecurityGroupName string = 'nsg-asev3'\\n\\n@description('Required. Array of Security Rules to deploy to the Network Security Group.')\\nparam networkSecurityGroupSecurityRules array = []\\n\\nvar uniStr = uniqueString(resourceGroup().id)\\nvar virtualNetworkId = resourceId(vNetResourceGroupName, 'Microsoft.Network/virtualNetworks', virtualNetworkName)\\nvar subnetId = resourceId(vNetResourceGroupName, 'Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\\nvar privateDNSZoneName = asev3.properties.dnsSuffix\\n\\nresource networksecuritygroup 'Microsoft.Network/networkSecurityGroups@2020-11-01' = if (!useExistingVnetandSubnet) {\\n  name: networkSecurityGroupName\\n  location: location\\n  properties: {\\n    securityRules: [for item in networkSecurityGroupSecurityRules: {\\n      name: item.name\\n      properties: {\\n        description: item.properties.description\\n        access: item.properties.access\\n        destinationAddressPrefix: ((item.properties.destinationAddressPrefix == '') ? json('null') : item.properties.destinationAddressPrefix)\\n        destinationAddressPrefixes: ((length(item.properties.destinationAddressPrefixes) == 0) ? json('null') : item.properties.destinationAddressPrefixes)\\n        destinationPortRanges: ((length(item.properties.destinationPortRanges) == 0) ? json('null') : item.properties.destinationPortRanges)\\n        destinationPortRange: ((item.properties.destinationPortRange == '') ? json('null') : item.properties.destinationPortRange)\\n        direction: item.properties.direction\\n        priority: int(item.properties.priority)\\n        protocol: item.properties.protocol\\n        sourceAddressPrefix: ((item.properties.sourceAddressPrefix == '') ? json('null') : item.properties.sourceAddressPrefix)\\n        sourcePortRanges: ((length(item.properties.sourcePortRanges) == 0) ? json('null') : item.properties.sourcePortRanges)\\n        sourcePortRange: item.properties.sourcePortRange\\n      }\\n    }]\\n  }\\n}\\n\\nresource virtualnetwork 'Microsoft.Network/virtualNetworks@2020-11-01' = if (!useExistingVnetandSubnet) {\\n  name: virtualNetworkName\\n  location: location\\n  dependsOn: [\\n    networksecuritygroup\\n  ]\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: vNetAddressPrefixes\\n    }\\n    subnets: [for item in subnets: {\\n      name: item.name\\n      properties: {\\n        addressPrefix: item.addressPrefix\\n        networkSecurityGroup: (empty(item.networkSecurityGroupName) ? json('null') : json('{\\\"id\\\": \\\"${resourceId('Microsoft.Network/networkSecurityGroups', item.networkSecurityGroupName)}\\\"}'))\\n        delegations: item.delegations\\n      }\\n    }]\\n  }\\n}\\n\\nmodule subnet 'modules/subnet.bicep' = if (useExistingVnetandSubnet) {\\n  name: '${subnetName}-subnet-delegation-${uniStr}'\\n  scope: resourceGroup(vNetResourceGroupName)\\n  params: {\\n    virtualNetworkName: virtualNetworkName\\n    subnetName: subnetName\\n    subnetAddressPrefix: subnetAddressPrefix\\n  }\\n}\\n\\nresource asev3 'Microsoft.Web/hostingEnvironments@2020-12-01' = {\\n  name: aseName\\n  location: location\\n  kind: 'ASEV3'\\n  dependsOn: [\\n    virtualnetwork\\n  ] \\n  properties: {\\n    dedicatedHostCount: dedicatedHostCount\\n    zoneRedundant: zoneRedundant\\n    internalLoadBalancingMode: internalLoadBalancingMode\\n    virtualNetwork: {\\n      id: subnetId\\n    } \\n  }\\n}\\n\\nmodule privatednszone 'modules/privatednszone.bicep' = if (createPrivateDNS && internalLoadBalancingMode == 3) {\\n  name: 'private-dns-zone-deployment-${uniStr}'\\n  params: {\\n    privateDNSZoneName: privateDNSZoneName\\n    virtualNetworkId: virtualNetworkId\\n    aseName: aseName\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"useExistingVnetandSubnet\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"vNetResourceGroupName\\\": {\\n      \\\"value\\\": \\\"resourceGroup().name\\\"\\n    },\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"vnet-asev3\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"vNetAddressPrefixes\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"subnetAddressPrefix\\\": {\\n      \\\"value\\\": \\\"172.16.0.0/24\\\"\\n    },\\n    \\\"subnetName\\\": {\\n      \\\"value\\\": \\\"snet-asev3\\\"\\n    },\\n    \\\"subnets\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"aseName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dedicatedHostCount\\\": {\\n      \\\"value\\\": \\\"0\\\"\\n    },\\n    \\\"zoneRedundant\\\": {\\n      \\\"value\\\": false\\n    },\\n    \\\"createPrivateDNS\\\": {\\n      \\\"value\\\": true\\n    },\\n    \\\"internalLoadBalancingMode\\\": {\\n      \\\"value\\\": 3\\n    },\\n    \\\"networkSecurityGroupName\\\": {\\n      \\\"value\\\": \\\"nsg-asev3\\\"\\n    },\\n    \\\"networkSecurityGroupSecurityRules\\\": {\\n      \\\"value\\\": \\\"[]\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Specifies region for all resources')\\nparam location string = resourceGroup().location\\n\\n@description('Specifies app plan SKU')\\nparam skuName string = 'F1'\\n\\n@description('Specifies app plan capacity')\\nparam skuCapacity int = 1\\n\\n@description('Specifies sql admin login')\\nparam sqlAdministratorLogin string\\n\\n@description('Specifies sql admin password')\\n@secure()\\nparam sqlAdministratorPassword string\\n\\n@description('Specifies managed identity name')\\nparam managedIdentityName string\\n\\nvar databaseName = 'sampledb'\\n\\n// Data resources\\nresource sqlserver 'Microsoft.Sql/servers@2020-11-01-preview' = {\\n  name: 'sqlserver${uniqueString(resourceGroup().id)}'\\n  location: location\\n  properties: {\\n    administratorLogin: sqlAdministratorLogin\\n    administratorLoginPassword: sqlAdministratorPassword\\n    version: '12.0'\\n  }\\n\\n  resource database 'databases@2020-08-01-preview' = {\\n    name: databaseName\\n    location: location\\n    sku: {\\n      name: 'Basic'\\n    }\\n    properties: {\\n      collation: 'SQL_Latin1_General_CP1_CI_AS'\\n      maxSizeBytes: 1073741824\\n    }\\n  }\\n\\n  resource firewallRule 'firewallRules@2020-11-01-preview' = {\\n    name: 'AllowAllWindowsAzureIps'\\n    properties: {\\n      endIpAddress: '0.0.0.0'\\n      startIpAddress: '0.0.0.0'\\n    }\\n  }\\n}\\n\\n// Web App resources\\nresource hostingPlan 'Microsoft.Web/serverfarms@2020-12-01' = {\\n  name: 'hostingplan${uniqueString(resourceGroup().id)}'\\n  location: location\\n  sku: {\\n    name: skuName\\n    capacity: skuCapacity\\n  }\\n}\\n\\nresource webSite 'Microsoft.Web/sites@2020-12-01' = {\\n  name: 'webSite${uniqueString(resourceGroup().id)}'\\n  location: location\\n  tags: {\\n    'hidden-related:${hostingPlan.id}': 'empty'\\n    displayName: 'Website'\\n  }\\n  properties: {\\n    serverFarmId: hostingPlan.id\\n  }\\n  identity: {\\n    type: 'UserAssigned'\\n    userAssignedIdentities: {\\n      '${msi.id}': {}\\n    }\\n  }\\n\\n  resource connectionString 'config@2020-12-01' = {\\n    name: 'connectionstrings'\\n    properties: {\\n      DefaultConnection: {\\n        value: 'Data Source=tcp:${sqlserver.properties.fullyQualifiedDomainName},1433;Initial Catalog=${sqlserver::database.name};User Id=${sqlserver.properties.administratorLogin}@${sqlserver.properties.fullyQualifiedDomainName};Password=${sqlAdministratorPassword};'\\n        type: 'SQLAzure'\\n      }\\n    }\\n  }\\n}\\n\\n// Managed Identity resources\\nresource msi 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\\n  name: managedIdentityName\\n  location: location\\n}\\n\\nresource roleassignment 'Microsoft.Authorization/roleAssignments@2020-04-01-preview' = {\\n  name: guid(msi.id, resourceGroup().id, 'b24988ac-6180-42a0-ab88-20f7382dd24c')\\n  properties: {\\n    principalType: 'ServicePrincipal'\\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\\n    principalId: msi.properties.principalId\\n  }\\n}\\n\\n// Monitor\\nresource appInsights 'Microsoft.Insights/components@2020-02-02' = {\\n  name: 'AppInsights${webSite.name}'\\n  location: location\\n  tags: {\\n    'hidden-link:${webSite.id}': 'Resource'\\n    displayName: 'AppInsightsComponent'\\n  }\\n  kind: 'web'\\n  properties: {\\n    Application_Type: 'web'\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"skuName\\\": {\\n      \\\"value\\\": \\\"F1\\\"\\n    },\\n    \\\"skuCapacity\\\": {\\n      \\\"value\\\": 1\\n    },\\n    \\\"sqlAdministratorLogin\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"sqlAdministratorPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"managedIdentityName\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches?"}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('The unique name of your website.')\\nparam siteName string = uniqueString(resourceGroup().id)\\n\\n@description('Database administrator login name')\\n@minLength(1)\\nparam administratorLogin string\\n\\n@description('Database administrator password')\\n@minLength(8)\\n@secure()\\nparam administratorLoginPassword string\\n\\n@description('Azure database for mySQL compute capacity in vCores (2,4,8,16,32)')\\n@allowed([\\n  2\\n  4\\n  8\\n  16\\n  32\\n])\\nparam dbSkucapacity int = 2\\n\\n@description('Azure database for mySQL sku name ')\\n@allowed([\\n  'GP_Gen5_2'\\n  'GP_Gen5_4'\\n  'GP_Gen5_8'\\n  'GP_Gen5_16'\\n  'GP_Gen5_32'\\n  'MO_Gen5_2'\\n  'MO_Gen5_4'\\n  'MO_Gen5_8'\\n  'MO_Gen5_16'\\n  'MO_Gen5_32'\\n])\\nparam dbSkuName string = 'GP_Gen5_2'\\n\\n@description('Azure database for mySQL Sku Size ')\\n@allowed([\\n  102400\\n  51200\\n])\\nparam dbSkuSizeMB int = 51200\\n\\n@description('Azure database for mySQL pricing tier')\\n@allowed([\\n  'GeneralPurpose'\\n  'MemoryOptimized'\\n])\\nparam dbSkuTier string = 'GeneralPurpose'\\n\\n@description('MySQL version')\\n@allowed([\\n  '5.6'\\n  '5.7'\\n])\\nparam mysqlVersion string = '5.7'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('Azure database for mySQL sku family')\\nparam databaseskuFamily string = 'Gen5'\\n\\nvar databaseName = uniqueString(resourceGroup().id)\\nvar mysqlserverName = uniqueString(resourceGroup().id)\\nvar hostingPlanName = uniqueString(resourceGroup().id)\\n\\nresource hostingPlan 'Microsoft.Web/serverfarms@2020-06-01' = {\\n  name: hostingPlanName\\n  location: location\\n  sku: {\\n    tier: 'Standard'\\n    name: 'S1'\\n  }\\n  kind: 'linux'\\n  properties: {\\n    reserved: true\\n  }\\n}\\n\\nresource site 'Microsoft.Web/sites@2021-02-01' = {\\n  name: siteName\\n  location: location\\n  identity: {\\n    type: 'SystemAssigned'\\n  }\\n  properties: {\\n    siteConfig: {\\n      linuxFxVersion: 'php|7.0'\\n      ftpsState: 'FtpsOnly'\\n      minTlsVersion: '1.2'\\n      scmMinTlsVersion: '1.2'\\n      connectionStrings: [\\n        {\\n          name: 'defaultConnection'\\n          connectionString: 'Database=${databaseName};Data Source=${mysqlserver.properties.fullyQualifiedDomainName};User Id=${administratorLogin}@${mysqlserverName};Password=${administratorLoginPassword}'\\n          type: 'MySql'\\n        }\\n      ]\\n    }\\n    serverFarmId: hostingPlan.id\\n    httpsOnly: true\\n  }     \\n}\\n\\nresource mysqlserver 'Microsoft.DBforMySQL/servers@2017-12-01' = {\\n  name: mysqlserverName\\n  location: location\\n  sku: {\\n    name: dbSkuName\\n    tier: dbSkuTier\\n    capacity: dbSkucapacity\\n    family: databaseskuFamily\\n  }\\n  properties: {\\n    createMode: 'Default'\\n    version: mysqlVersion\\n    administratorLogin: administratorLogin\\n    administratorLoginPassword: administratorLoginPassword\\n    storageProfile: {\\n      storageMB: dbSkuSizeMB\\n      backupRetentionDays: 7\\n      geoRedundantBackup: 'Disabled'\\n    }\\n    sslEnforcement: 'Disabled'\\n  }\\n}\\n\\nresource serverName_AllowAzureIPs 'Microsoft.DBforMySQL/servers/firewallrules@2017-12-01' = {\\n  parent: mysqlserver\\n  name: 'AllowAzureIPs'\\n  properties: {\\n    startIpAddress: '0.0.0.0'\\n    endIpAddress: '255.255.255.255'\\n  }\\n}\\n\\nresource mysqlserverName_databaseName 'Microsoft.DBforMySQL/servers/databases@2017-12-01' = {\\n  parent: mysqlserver\\n  name: databaseName\\n  properties: {\\n    charset: 'utf8'\\n    collation: 'utf8_general_ci'\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"siteName\\\": {\\n      \\\"value\\\": \\\"uniqueString(resourceGroup().id)\\\"\\n    },\\n    \\\"administratorLogin\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"administratorLoginPassword\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"dbSkucapacity\\\": {\\n      \\\"value\\\": 2\\n    },\\n    \\\"dbSkuName\\\": {\\n      \\\"value\\\": \\\"GP_Gen5_2\\\"\\n    },\\n    \\\"dbSkuSizeMB\\\": {\\n      \\\"value\\\": 51200\\n    },\\n    \\\"dbSkuTier\\\": {\\n      \\\"value\\\": \\\"GeneralPurpose\\\"\\n    },\\n    \\\"mysqlVersion\\\": {\\n      \\\"value\\\": \\\"5.7\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"databaseskuFamily\\\": {\\n      \\\"value\\\": \\\"Gen5\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"@description('Name of the VNet')\\nparam virtualNetworkName string = 'ntier-vnet'\\n\\n@description('Name of the Web Farm')\\nparam serverFarmName string = 'serverfarm'\\n\\n@description('Backend Web App name must be unique DNS name worldwide')\\nparam webAppNameBackend string = 'backend-${uniqueString(resourceGroup().id)}'\\n\\n@description('Frontend Web App name must be unique DNS name worldwide')\\nparam webAppNameFrontend string = 'frontend-${uniqueString(resourceGroup().id)}'\\n\\n@description('CIDR of your VNet')\\nparam virtualNetworkCidr string = '10.200.0.0/16'\\n\\n@description('Name of the backend subnet')\\nparam subnetNamePrivateEndpoint string = 'PrivateEndpointSubnet'\\n\\n@description('Name of the frontend subnet')\\nparam subnetNameVnetIntegration string = 'VnetIntegrationSubnet'\\n\\n@description('CIDR of your backend subnet')\\nparam subnetCidrPrivateEndpoint string = '10.200.1.0/24'\\n\\n@description('CIDR of your frontend subnet')\\nparam subnetCidrVnetIntegration string = '10.200.2.0/24'\\n\\n@description('Location for all resources.')\\nparam location string = resourceGroup().location\\n\\n@description('SKU name')\\n@allowed([\\n  'P1v2'\\n  'P2v2'\\n  'P3v2'\\n])\\nparam skuName string = 'P1v2'\\n\\n@description('SKU size')\\n@allowed([\\n  'P1v2'\\n  'P2v2'\\n  'P3v2'\\n])\\nparam skuSize string = 'P1v2'\\n\\n@description('SKU family')\\n@allowed([\\n  'P1v2'\\n  'P2v2'\\n  'P3v2'\\n])\\nparam skuFamily string = 'P1v2'\\n\\n@description('Name of your Private Endpoint')\\nparam privateEndpointName string = 'PrivateEndpoint1'\\n\\n@description('Name of your slot Private Endpoint')\\nparam privateEndpointSlotName string = 'PrivateEndpoint2'\\n\\n@description('Link name between your Private Endpoint and your Web App')\\nparam privateLinkConnectionName string = 'PrivateEndpointLink1'\\n\\n@description('Link name between your Private Endpoint and your Web App slot')\\nparam privateLinkConnectionSlotName string = 'PrivateEndpointLink2'\\n\\nvar webappDnsName = '.azurewebsites.net'\\nvar privateDNSZoneName = 'privatelink.azurewebsites.net'\\nvar skuTier = 'PremiumV2'\\n\\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-06-01' = {\\n  name: virtualNetworkName\\n  location: location\\n  properties: {\\n    addressSpace: {\\n      addressPrefixes: [\\n        virtualNetworkCidr\\n      ]\\n    }\\n    subnets: [\\n      {\\n        name: subnetNamePrivateEndpoint\\n        properties: {\\n          addressPrefix: subnetCidrPrivateEndpoint\\n          privateEndpointNetworkPolicies: 'Disabled'\\n        }\\n      }\\n      {\\n        name: subnetNameVnetIntegration\\n        properties: {\\n          addressPrefix: subnetCidrVnetIntegration\\n          delegations: [\\n            {\\n              name: 'delegation'\\n              properties: {\\n                serviceName: 'Microsoft.Web/serverfarms'\\n              }\\n            }\\n          ]\\n          privateEndpointNetworkPolicies: 'Enabled'\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource serverFarm 'Microsoft.Web/serverfarms@2020-06-01' = {\\n  name: serverFarmName\\n  location: location\\n  sku: {\\n    name: skuName\\n    tier: skuTier\\n    size: skuSize\\n    family: skuFamily\\n    capacity: 1\\n  }\\n  kind: 'app'\\n  properties: {\\n    reserved: true\\n  }\\n}\\n\\nresource webAppBackend 'Microsoft.Web/sites@2022-03-01' = {\\n  name: webAppNameBackend\\n  location: location\\n  kind: 'app'\\n  properties: {\\n    serverFarmId: serverFarm.id\\n    httpsOnly: true\\n    siteConfig: {\\n      detailedErrorLoggingEnabled: true\\n      httpLoggingEnabled: true\\n      requestTracingEnabled: true\\n      ftpsState: 'Disabled'\\n      minTlsVersion: '1.2'\\n    }\\n  }\\n}\\n\\nresource ftpPolicyBackend 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\\n  name: 'ftp'\\n  location: location\\n  kind: 'string'\\n  parent: webAppBackend\\n  properties: {\\n    allow: false\\n  }\\n}\\n\\nresource scmPolicyBackend 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\\n  name: 'scm'\\n  location: location\\n  kind: 'string'\\n  parent: webAppBackend\\n  properties: {\\n    allow: false\\n  }\\n}\\n\\nresource webAppSlotBackend 'Microsoft.Web/sites/slots@2022-03-01' = {\\n  name: '${webAppNameBackend}/stage'\\n  location: location\\n  kind: 'app'\\n  dependsOn: [\\n    webAppBackend\\n  ]\\n  properties: {\\n    serverFarmId: serverFarm.id\\n    httpsOnly: true\\n    siteConfig: {\\n      detailedErrorLoggingEnabled: true\\n      httpLoggingEnabled: true\\n      requestTracingEnabled: true\\n      ftpsState: 'Disabled'\\n      minTlsVersion: '1.2'\\n    }\\n  }\\n}\\n\\nresource ftpPolicySlotBackend 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\\n  name: 'ftp'\\n  location: location\\n  kind: 'string'\\n  parent: webAppSlotBackend\\n  properties: {\\n    allow: false\\n  }\\n}\\n\\nresource scmPolicySlotBackend 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\\n  name: 'scm'\\n  location: location\\n  kind: 'string'\\n  parent: webAppSlotBackend\\n  properties: {\\n    allow: false\\n  }\\n}\\n\\nresource webAppFrontend 'Microsoft.Web/sites@2022-03-01' = {\\n  name: webAppNameFrontend\\n  location: location\\n  kind: 'app'\\n  properties: {\\n    serverFarmId: serverFarm.id\\n    httpsOnly: true\\n    virtualNetworkSubnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, subnetNameVnetIntegration)\\n    vnetRouteAllEnabled: true\\n    siteConfig: {\\n      detailedErrorLoggingEnabled: true\\n      httpLoggingEnabled: true\\n      requestTracingEnabled: true\\n      ftpsState: 'Disabled'\\n      minTlsVersion: '1.2'\\n    }\\n  }\\n}\\n\\nresource ftpPolicyFrontend 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\\n  name: 'ftp'\\n  location: location\\n  kind: 'string'\\n  parent: webAppFrontend\\n  properties: {\\n    allow: false\\n  }\\n}\\n\\nresource scmPolicyFrontend 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\\n  name: 'scm'\\n  location: location\\n  kind: 'string'\\n  parent: webAppFrontend\\n  properties: {\\n    allow: false\\n  }\\n}\\n\\nresource webAppSlotFrontend 'Microsoft.Web/sites/slots@2022-03-01' = {\\n  name: '${webAppNameFrontend}/stage'\\n  location: location\\n  kind: 'app'\\n  dependsOn: [\\n    webAppFrontend\\n  ]\\n  properties: {\\n    serverFarmId: serverFarm.id\\n    httpsOnly: true\\n    virtualNetworkSubnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, subnetNameVnetIntegration)\\n    vnetRouteAllEnabled: true\\n    siteConfig: {\\n      detailedErrorLoggingEnabled: true\\n      httpLoggingEnabled: true\\n      requestTracingEnabled: true\\n      ftpsState: 'Disabled'\\n      minTlsVersion: '1.2'\\n    }\\n  }\\n}\\n\\nresource ftpPolicySlotFrontend 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\\n  name: 'ftp'\\n  location: location\\n  kind: 'string'\\n  parent: webAppSlotFrontend\\n  properties: {\\n    allow: false\\n  }\\n}\\n\\nresource scmPolicySlotFrontend 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\\n  name: 'scm'\\n  location: location\\n  kind: 'string'\\n  parent: webAppSlotFrontend\\n  properties: {\\n    allow: false\\n  }\\n}\\n\\nresource webAppBindingBackend 'Microsoft.Web/sites/hostNameBindings@2019-08-01' = {\\n  name: '${webAppBackend.name}${webappDnsName}'\\n  parent: webAppBackend\\n  properties: {\\n    siteName: webAppBackend.name\\n    hostNameType: 'Verified'\\n  }\\n}\\n\\nresource webAppBindingFrontend 'Microsoft.Web/sites/hostNameBindings@2019-08-01' = {\\n  name: '${webAppFrontend.name}${webappDnsName}'\\n  parent: webAppFrontend\\n  properties: {\\n    siteName: webAppFrontend.name\\n    hostNameType: 'Verified'\\n  }\\n}\\n\\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2020-06-01' = {\\n  name: privateEndpointName\\n  location: location\\n  properties: {\\n    subnet: {\\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, subnetNamePrivateEndpoint)\\n    }\\n    privateLinkServiceConnections: [\\n      {\\n        name: privateLinkConnectionName\\n        properties: {\\n          privateLinkServiceId: webAppBackend.id\\n          groupIds: [\\n            'sites'\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource privateEndpointSlot 'Microsoft.Network/privateEndpoints@2020-06-01' = {\\n  name: privateEndpointSlotName\\n  location: location\\n  dependsOn: [\\n    webAppSlotBackend\\n  ]\\n  properties: {\\n    subnet: {\\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, subnetNamePrivateEndpoint)\\n    }\\n    privateLinkServiceConnections: [\\n      {\\n        name: privateLinkConnectionSlotName\\n        properties: {\\n          privateLinkServiceId: webAppBackend.id\\n          groupIds: [\\n            'sites-stage'\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource privateDnsZones 'Microsoft.Network/privateDnsZones@2018-09-01' = {\\n  name: privateDNSZoneName\\n  location: 'global'\\n  dependsOn: [\\n    virtualNetwork\\n  ]\\n}\\n\\nresource privateDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2018-09-01' = {\\n  name: '${privateDnsZones.name}-link'\\n  parent: privateDnsZones\\n  location: 'global'\\n  properties: {\\n    registrationEnabled: false\\n    virtualNetwork: {\\n      id: virtualNetwork.id\\n    }\\n  }\\n}\\n\\nresource privateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2020-03-01' = {\\n  name: 'dnsgroupname'\\n  parent: privateEndpoint\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: 'config1'\\n        properties: {\\n          privateDnsZoneId: privateDnsZones.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\\nresource privateDnsZoneGroupSlot 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2020-03-01' = {\\n  name: 'slotdnsgroupname'\\n  parent: privateEndpointSlot\\n  properties: {\\n    privateDnsZoneConfigs: [\\n      {\\n        name: 'config2'\\n        properties: {\\n          privateDnsZoneId: privateDnsZones.id\\n        }\\n      }\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"virtualNetworkName\\\": {\\n      \\\"value\\\": \\\"ntier-vnet\\\"\\n    },\\n    \\\"serverFarmName\\\": {\\n      \\\"value\\\": \\\"serverfarm\\\"\\n    },\\n    \\\"webAppNameBackend\\\": {\\n      \\\"value\\\": \\\"backend-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"webAppNameFrontend\\\": {\\n      \\\"value\\\": \\\"frontend-${uniqueString(resourceGroup().id)}\\\"\\n    },\\n    \\\"virtualNetworkCidr\\\": {\\n      \\\"value\\\": \\\"10.200.0.0/16\\\"\\n    },\\n    \\\"subnetNamePrivateEndpoint\\\": {\\n      \\\"value\\\": \\\"PrivateEndpointSubnet\\\"\\n    },\\n    \\\"subnetNameVnetIntegration\\\": {\\n      \\\"value\\\": \\\"VnetIntegrationSubnet\\\"\\n    },\\n    \\\"subnetCidrPrivateEndpoint\\\": {\\n      \\\"value\\\": \\\"10.200.1.0/24\\\"\\n    },\\n    \\\"subnetCidrVnetIntegration\\\": {\\n      \\\"value\\\": \\\"10.200.2.0/24\\\"\\n    },\\n    \\\"location\\\": {\\n      \\\"value\\\": \\\"resourceGroup().location\\\"\\n    },\\n    \\\"skuName\\\": {\\n      \\\"value\\\": \\\"P1v2\\\"\\n    },\\n    \\\"skuSize\\\": {\\n      \\\"value\\\": \\\"P1v2\\\"\\n    },\\n    \\\"skuFamily\\\": {\\n      \\\"value\\\": \\\"P1v2\\\"\\n    },\\n    \\\"privateEndpointName\\\": {\\n      \\\"value\\\": \\\"PrivateEndpoint1\\\"\\n    },\\n    \\\"privateEndpointSlotName\\\": {\\n      \\\"value\\\": \\\"PrivateEndpoint2\\\"\\n    },\\n    \\\"privateLinkConnectionName\\\": {\\n      \\\"value\\\": \\\"PrivateEndpointLink1\\\"\\n    },\\n    \\\"privateLinkConnectionSlotName\\\": {\\n      \\\"value\\\": \\\"PrivateEndpointLink2\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"targetScope = 'subscription'\\n\\n@description('Array of actions for the roleDefinition')\\nparam actions array = [\\n  'Microsoft.Resources/subscriptions/resourceGroups/read'\\n]\\n\\n@description('Array of notActions for the roleDefinition')\\nparam notActions array = []\\n\\n@description('Friendly name of the role definition')\\nparam roleName string = 'Custom Role - RG Reader'\\n\\n@description('Detailed description of the role definition')\\nparam roleDescription string = 'Subscription Level Deployment of a Role Definition'\\n\\nvar roleDefName = guid(roleName)\\n\\nresource roleDef 'Microsoft.Authorization/roleDefinitions@2022-04-01' = {\\n  name: roleDefName\\n  properties: {\\n    roleName: roleName\\n    description: roleDescription\\n    type: 'customRole'\\n    permissions: [\\n      {\\n        actions: actions\\n        notActions: notActions\\n      }\\n    ]\\n    assignableScopes: [\\n      subscription().id\\n    ]\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"actions\\\": {\\n      \\\"value\\\": \\\"[\\\"\\n    },\\n    \\\"notActions\\\": {\\n      \\\"value\\\": \\\"[]\\\"\\n    },\\n    \\\"roleName\\\": {\\n      \\\"value\\\": \\\"Custom Role - RG Reader\\\"\\n    },\\n    \\\"roleDescription\\\": {\\n      \\\"value\\\": \\\"Subscription Level Deployment of a Role Definition\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
{"messages": [{"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules."}, {"role": "assistant", "content": "{\"plan\": {\"resources\": [], \"rationale\": \"Bicep deployment.\"}, \"files\": [{\"path\": \"main.bicep\", \"language\": \"bicep\", \"content\": \"targetScope = 'subscription'\\n\\n@description('principalId if the user that will be given contributor access to the resourceGroup')\\nparam principalId string\\n\\n@description('roleDefinition for the assignment - default is contributor')\\nparam roleDefinitionId string = 'b24988ac-6180-42a0-ab88-20f7382dd24c'\\n\\n// this creates an idempotent GUID for the role assignment\\nvar roleAssignmentName = guid(subscription().id, principalId, roleDefinitionId)\\n\\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2020-08-01-preview' = {\\n  name: roleAssignmentName\\n  properties: {\\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', roleDefinitionId)\\n    principalId: principalId\\n  }\\n}\\n\"}, {\"path\": \"parameters.json\", \"language\": \"json\", \"content\": \"{\\n  \\\"$schema\\\": \\\"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#\\\",\\n  \\\"contentVersion\\\": \\\"1.0.0.0\\\",\\n  \\\"parameters\\\": {\\n    \\\"principalId\\\": {\\n      \\\"value\\\": \\\"<YOUR_VALUE_HERE>\\\"\\n    },\\n    \\\"roleDefinitionId\\\": {\\n      \\\"value\\\": \\\"b24988ac-6180-42a0-ab88-20f7382dd24c\\\"\\n    }\\n  }\\n}\"}], \"warnings\": []}"}]}
