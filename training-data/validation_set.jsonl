{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an Microsoft Entra Domain Services (Azure AD DS) instance: WAF-aligned"}, {"role": "assistant", "content": "module domainService 'br/public:avm/res/aad/domain-service:0.5.0' = {\n name: 'domainServiceDeployment'\n params: {\n // Required parameters\n domainName: 'onmicrosoft.com'\n // Non-required parameters\n additionalRecipients: [\n '@noreply.github.com'\n ]\n diagnosticSettings: [\n {\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\n eventHubName: '<eventHubName>'\n logCategoriesAndGroups: [\n {\n categoryGroup: 'allLogs'\n }\n ]\n metricCategories: [\n {\n category: 'AllMetrics'\n }\n ]\n name: 'customSetting'\n storageAccountResourceId: '<storageAccountResourceId>'\n workspaceResourceId: '<workspaceResourceId>'\n }\n ]\n externalAccess: 'Enabled'\n ldaps: 'Enabled'\n location: '<location>'\n lock: {\n kind: 'None'\n name: 'myCustomLockName'\n notes: 'This is a custom lock for the deployment'\n }\n name: 'aaddswaf001'\n pfxCertificate: '<pfxCertificate>'\n pfxCertificatePassword: '<pfxCertificatePassword>'\n replicaSets: [\n {\n location: '<location>'\n subnetId: '<subnetId>'\n }\n {\n location: '<location>'\n subnetId: '<subnetId>'\n }\n ]\n tags: {\n Environment: 'Non-Prod'\n 'hidden-title': 'This is visible in the resource name'\n Role: 'DeploymentValidation'\n }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy the Azure Image Builder service publishing to an Azure Compute Gallery: Using small parameter set"}, {"role": "assistant", "content": "module azureImageBuilder 'br/public:avm/ptn/virtual-machine-images/azure-image-builder:0.2.0' = {\n name: 'azureImageBuilderDeployment'\n params: {\n // Required parameters\n computeGalleryImageDefinitionName: '<computeGalleryImageDefinitionName>'\n computeGalleryImageDefinitions: '<computeGalleryImageDefinitions>'\n computeGalleryName: '<computeGalleryName>'\n imageTemplateImageSource: {\n offer: 'ubuntu-24_04-lts'\n publisher: 'canonical'\n sku: 'server'\n type: 'PlatformImage'\n version: 'latest'\n }\n // Non-required parameters\n deploymentScriptManagedIdentityName: '<deploymentScriptManagedIdentityName>'\n deploymentScriptStorageAccountName: '<deploymentScriptStorageAccountName>'\n deploymentScriptSubnetName: '<deploymentScriptSubnetName>'\n deploymentsToPerform: 'Only image'\n imageContainerInstanceSubnetName: ''\n imageManagedIdentityName: '<imageManagedIdentityName>'\n imageSubnetName: '<imageSubnetName>'\n imageTemplateCustomizationSteps: [\n {\n name: 'Example script'\n scriptUri: '<scriptUri>'\n type: 'Shell'\n }\n ]\n imageTemplateResourceGroupName: '<imageTemplateResourceGroupName>'\n location: '<location>'\n resourceGroupName: '<resourceGroupName>'\n virtualNetworkName: '<virtualNetworkName>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy Azure Service Health Alerts to notify you of service issues, planned maintenance, and health advisories that may affect your Azure services: Deploying multiple service health alerts."}, {"role": "assistant", "content": "module serviceHealthAlerts 'br/public:avm/ptn/subscription/service-health-alerts:0.1.0' = {\n name: 'serviceHealthAlertsDeployment'\n params: {\n location: '<location>'\n serviceHealthAlerts: [\n {\n actionGroup: {\n enabled: true\n existingActionGroupResourceId: '<existingActionGroupResourceId>'\n }\n alertDescription: 'Service Health Advisory'\n isEnabled: true\n serviceHealthAlert: 'Service Health Advisory'\n }\n {\n actionGroup: {\n enabled: true\n existingActionGroupResourceId: '<existingActionGroupResourceId>'\n }\n alertDescription: 'Service Health Incident'\n isEnabled: true\n serviceHealthAlert: 'Service Health Incident'\n }\n ]\n serviceHealthAlertsResourceGroupName: '<serviceHealthAlertsResourceGroupName>'\n subscriptionId: '<subscriptionId>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an Azure Security Center (Defender for Cloud) Configuration: Using default parameter set"}, {"role": "assistant", "content": "module securityCenter 'br/public:avm/ptn/security/security-center:0.1.0' = {\n name: 'securityCenterDeployment'\n params: {\n // Required parameters\n scope: '<scope>'\n workspaceResourceId: '<workspaceResourceId>'\n // Non-required parameters\n location: '<location>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy the Build Your Own Copilot Solution Accelerator using only the required parameters: Sandbox configuration with default parameter values"}, {"role": "assistant", "content": "module buildYourOwnCopilot 'br/public:avm/ptn/sa/build-your-own-copilot:0.1.0' = {\n name: 'buildYourOwnCopilotDeployment'\n params: {\n // Required parameters\n azureAiServiceLocation: '<azureAiServiceLocation>'\n enableMonitoring: true\n enablePrivateNetworking: true\n enablePurgeProtection: true\n enableRedundancy: true\n enableScalability: true\n // Non-required parameters\n enableTelemetry: true\n vmAdminPassword: '<vmAdminPassword>'\n vmAdminUsername: 'adminuser'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy the Content Processing Solution Accelerator using only the required parameters: Waf-aligned configuration with default parameter values"}, {"role": "assistant", "content": "module contentProcessing 'br/public:avm/ptn/sa/content-processing:0.1.0' = {\n name: 'contentProcessingDeployment'\n params: {\n // Required parameters\n contentUnderstandingLocation: '<contentUnderstandingLocation>'\n environmentName: 'scpmin'\n gptDeploymentCapacity: 1\n // Non-required parameters\n enablePrivateNetworking: false\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy the [Conversation Knowledge Mining Solution Accelerator](https://github: Sandbox configuration with default parameter values"}, {"role": "assistant", "content": "module conversationKnowledgeMining 'br/public:avm/ptn/sa/conversation-knowledge-mining:0.1.0' = {\n name: 'conversationKnowledgeMiningDeployment'\n params: {\n solutionPrefix: 'sbxdft'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy the Document Knowledge Mining Solution Accelerator using parameters that deploy the enterprise-grade configuration: Default configuration with enterprise-grade parameter values"}, {"role": "assistant", "content": "module documentKnowledgeMining 'br/public:avm/ptn/sa/document-knowledge-mining:0.1.0' = {\n name: 'documentKnowledgeMiningDeployment'\n params: {\n // Required parameters\n aiDeploymentsLocation: '<aiDeploymentsLocation>'\n enableMonitoring: false\n enablePrivateNetworking: false\n enableRedundancy: false\n enableScalability: false\n // Non-required parameters\n createdBy: 'AVM_Pipeline'\n enableTelemetry: true\n location: '<location>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy the [Modernize Your Code Solution Accelerator](https://github: Default configuration with enterprise-grade parameter values"}, {"role": "assistant", "content": "module modernizeYourCode 'br/public:avm/ptn/sa/modernize-your-code:0.1.0' = {\n name: 'modernizeYourCodeDeployment'\n params: {\n // Required parameters\n solutionName: 'samycmin001'\n // Non-required parameters\n location: '<location>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy the [Multi-Agent Custom Automation Engine solution accelerator](https://github: Default configuration with WAF aligned parameter values"}, {"role": "assistant", "content": "module multiAgentCustomAutomationEngine 'br/public:avm/ptn/sa/multi-agent-custom-automation-engine:0.1.0' = {\n name: 'multiAgentCustomAutomationEngineDeployment'\n params: {\n solutionPrefix: 'macaemin'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Policy Insights Remediation: Policy Remediation (Management Group scope - defaults)"}, {"role": "assistant", "content": "module remediation 'br/public:avm/ptn/policy-insights/remediation:0.2.0' = {\n name: 'remediationDeployment'\n params: {\n // Required parameters\n name: 'pirsubmax001'\n policyAssignmentId: '<policyAssignmentId>'\n // Non-required parameters\n failureThresholdPercentage: '0.5'\n filtersLocations: []\n filtersResourceIds: []\n location: '<location>'\n parallelDeployments: 1\n policyDefinitionReferenceId: 'Prerequisite_DeployExtensionWindows'\n resourceCount: 10\n resourceDiscoveryMode: 'ReEvaluateCompliance'\n subscriptionId: '<subscriptionId>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a multi-region hub network in Azure: Using only defaults"}, {"role": "assistant", "content": "module hubNetworking 'br/public:avm/ptn/network/hub-networking:0.5.0' = {\n name: 'hubNetworkingDeployment'\n params: {\n hubVirtualNetworks: {\n hub1: {\n addressPrefixes: '<addressPrefixes>'\n azureFirewallSettings: {\n azureSkuTier: 'Standard'\n diagnosticSettings: [\n {\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\n eventHubName: '<eventHubName>'\n storageAccountResourceId: '<storageAccountResourceId>'\n workspaceResourceId: '<workspaceResourceId>'\n }\n ]\n location: '<location>'\n publicIPAddressObject: {\n name: 'hub1PublicIp'\n }\n threatIntelMode: 'Deny'\n zones: [\n 1\n 2\n 3\n ]\n }\n bastionHost: {\n disableCopyPaste: true\n enableFileCopy: false\n enableIpConnect: false\n enableShareableLink: false\n scaleUnits: 2\n skuName: 'Standard'\n }\n diagnosticSettings: [\n {\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\n eventHubName: '<eventHubName>'\n metricCategories: [\n {\n category: 'AllMetrics'\n }\n ]\n name: 'customSetting'\n storageAccountResourceId: '<storageAccountResourceId>'\n workspaceResourceId: '<workspaceResourceId>'\n }\n ]\n dnsServers: [\n '10.0.1.6'\n '10.0.1.7'\n ]\n enableAzureFirewall: true\n enableBastion: true\n enablePeering: false\n flowTimeoutInMinutes: 30\n location: '<location>'\n routes: [\n {\n name: 'defaultRoute'\n properties: {\n addressPrefix: '0.0.0.0/0'\n nextHopType: 'Internet'\n }\n }\n ]\n subnets: [\n {\n addressPrefix: '<addressPrefix>'\n name: 'GatewaySubnet'\n }\n {\n addressPrefix: '<addressPrefix>'\n name: 'AzureFirewallSubnet'\n }\n {\n addressPrefix: '<addressPrefix>'\n name: 'AzureBastionSubnet'\n }\n ]\n tags: {\n Environment: 'Non-Prod'\n 'hidden-title': 'This is visible in the resource name'\n Role: 'DeploymentValidation'\n }\n vnetEncryption: false\n vnetEncryptionEnforcement: 'AllowUnencrypted'\n }\n }\n location: '<location>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy the module with the minimum set of required parameters: Using only defaults"}, {"role": "assistant", "content": "module privateLinkPrivateDnsZones 'br/public:avm/ptn/network/private-link-private-dns-zones:0.7.0' = {\n name: 'privateLinkPrivateDnsZonesDeployment'\n params: {\n virtualNetworkLinks: [\n {\n registrationEnabled: false\n virtualNetworkResourceId: '<virtualNetworkResourceId>'\n }\n ]\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy subscriptions to management groups: Using only defaults."}, {"role": "assistant", "content": "module subscriptionPlacement 'br/public:avm/ptn/mgmt-groups/subscription-placement:0.3.0' = {\n name: 'subscriptionPlacementDeployment'\n params: {\n parSubscriptionPlacement: [\n {\n disableSubscriptionPlacement: false\n managementGroupId: '<managementGroupId>'\n subscriptionIds: [\n ''\n '<subVendingSubscriptionId>'\n ]\n }\n {\n disableSubscriptionPlacement: true\n managementGroupId: '<managementGroupId>'\n subscriptionIds: [\n '<subVendingSubscriptionId>'\n ]\n }\n ]\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a subscription to accelerate deployment of landing zones: Multiple virtual networks."}, {"role": "assistant", "content": "module subVending 'br/public:avm/ptn/lz/sub-vending:0.4.0' = {\n name: 'subVendingDeployment'\n params: {\n deploymentScriptLocation: '<deploymentScriptLocation>'\n deploymentScriptManagedIdentityName: '<deploymentScriptManagedIdentityName>'\n deploymentScriptName: 'ds-ssawan'\n deploymentScriptNetworkSecurityGroupName: '<deploymentScriptNetworkSecurityGroupName>'\n deploymentScriptResourceGroupName: '<deploymentScriptResourceGroupName>'\n deploymentScriptStorageAccountName: '<deploymentScriptStorageAccountName>'\n deploymentScriptVirtualNetworkName: '<deploymentScriptVirtualNetworkName>'\n hubNetworkResourceId: '<hubNetworkResourceId>'\n resourceProviders: {}\n roleAssignmentEnabled: true\n roleAssignments: [\n {\n definition: '/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7'\n description: 'Network contributor role'\n principalId: '<principalId>'\n relativeScope: '<relativeScope>'\n }\n ]\n subscriptionAliasEnabled: true\n subscriptionAliasName: '<subscriptionAliasName>'\n subscriptionBillingScope: '<subscriptionBillingScope>'\n subscriptionDisplayName: '<subscriptionDisplayName>'\n subscriptionManagementGroupAssociationEnabled: true\n subscriptionManagementGroupId: 'bicep-lz-vending-automation-child'\n subscriptionTags: {\n namePrefix: '<namePrefix>'\n serviceShort: '<serviceShort>'\n }\n subscriptionWorkload: 'Production'\n virtualNetworkAddressSpace: [\n '10.210.0.0/16'\n ]\n virtualNetworkEnabled: true\n virtualNetworkLocation: '<virtualNetworkLocation>'\n virtualNetworkName: '<virtualNetworkName>'\n virtualNetworkPeeringEnabled: true\n virtualNetworkResourceGroupLockEnabled: false\n virtualNetworkResourceGroupName: '<virtualNetworkResourceGroupName>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Finops hub from the Finops toolkit: Using only defaults"}, {"role": "assistant", "content": "module finopsHub 'br/public:avm/ptn/finops-toolkit/finops-hub:0.1.0' = {\n name: 'finopsHubDeployment'\n params: {\n // Required parameters\n hubName: 'finops-hub-finmin'\n // Non-required parameters\n location: '<location>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy self-hosted agents and runners for Azure DevOps and GitHub on Azure Container Instances and/or Azure Container Apps: Using only defaults for Azure DevOps self-hosted agents using both Azure Container Instances and Azure Container Apps."}, {"role": "assistant", "content": "module cicdAgentsAndRunners 'br/public:avm/ptn/dev-ops/cicd-agents-and-runners:0.3.0' = {\n name: 'cicdAgentsAndRunnersDeployment'\n params: {\n // Required parameters\n computeTypes: [\n 'azure-container-instance'\n ]\n namingPrefix: '<namingPrefix>'\n networkingConfiguration: {\n addressSpace: '10.0.0.0/16'\n networkType: 'createNew'\n virtualNetworkName: 'vnet-aci'\n }\n selfHostedConfig: {\n githubOrganization: 'githHubOrganization'\n githubRepository: 'dummyRepo'\n personalAccessToken: '<personalAccessToken>'\n selfHostedType: 'github'\n }\n // Non-required parameters\n location: '<location>'\n privateNetworking: true\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an image to an Azure Container Registry: Using only defaults"}, {"role": "assistant", "content": "module importImageToAcr 'br/public:avm/ptn/deployment-script/import-image-to-acr:0.4.0' = {\n name: 'importImageToAcrDeployment'\n params: {\n // Required parameters\n acrName: '<acrName>'\n image: 'mcr.microsoft.com/k8se/quickstart-jobs:latest'\n name: 'dsiitawaf001'\n // Non-required parameters\n location: '<location>'\n managedIdentities: '<managedIdentities>'\n overwriteExistingImage: true\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy the module with the minimum set of required parameters: Using only defaults"}, {"role": "assistant", "content": "module privateAnalyticalWorkspace 'br/public:avm/ptn/data/private-analytical-workspace:0.1.0' = {\n name: 'UC3'\n params: {\n // Required parameters\n name: 'pawuc3'\n // Non-required parameters\n virtualNetworkResourceId: '/subscriptions/{SUBSCRIPTION-ID}/resourceGroups/{NAME-OF-RG}/providers/Microsoft.Network/virtualNetworks/{NAME-OF-VNET}'\n logAnalyticsWorkspaceResourceId: '/subscriptions/{SUBSCRIPTION-ID}/resourceGroups/{NAME-OF-RG}/providers/Microsoft.OperationalInsights/workspaces/{NAME-OF-LOG}'\n keyVaultResourceId: '/subscriptions/{SUBSCRIPTION-ID}/resourceGroups/{NAME-OF-RG}/providers/Microsoft.KeyVault/vaults/{NAME-OF-KV}'\n enableDatabricks: true // Part of the solution will be new instance of the Azure Databricks\n solutionAdministrators: [\n {\n principalId: <EntraGroupId> // Specified group will have enough permissions to manage the solution\n principalType: 'Group' // Group and/or User type can be specified\n }\n ]\n advancedOptions: {\n networkAcls: { ipRules: [<AllowedPublicIPAddress>] } // Which public IP addresses of the end users can access the solution (enables public endpoints for some services)\n }\n tags: { Owner: 'Contoso', 'Cost Center': '2345-324' }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a container app in an Azure Container App environment: Using only defaults"}, {"role": "assistant", "content": "module acrContainerApp 'br/public:avm/ptn/azd/acr-container-app:0.2.0' = {\n name: 'acrContainerAppDeployment'\n params: {\n // Required parameters\n containerAppsEnvironmentName: '<containerAppsEnvironmentName>'\n name: 'acaprb001'\n // Non-required parameters\n containerProbes: [\n {\n httpGet: {\n httpHeaders: [\n {\n name: 'Custom-Header'\n value: 'Awesome'\n }\n ]\n path: '/health'\n port: 8080\n }\n initialDelaySeconds: 3\n periodSeconds: 3\n type: 'Liveness'\n }\n ]\n location: '<location>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Redis Enterprise or Azure Managed Redis cache: Active geo-replication"}, {"role": "assistant", "content": "module redisEnterprise 'br/public:avm/res/cache/redis-enterprise:0.3.0' = {\n name: 'redisEnterpriseDeployment'\n params: {\n // Required parameters\n name: 'crewaf001'\n // Non-required parameters\n availabilityZones: [\n 1\n 2\n 3\n ]\n database: {\n diagnosticSettings: [\n {\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\n eventHubName: '<eventHubName>'\n logCategoriesAndGroups: [\n {\n categoryGroup: 'allLogs'\n }\n ]\n name: 'customSettingDatabase'\n storageAccountResourceId: '<storageAccountResourceId>'\n workspaceResourceId: '<workspaceResourceId>'\n }\n ]\n persistence: {\n frequency: '1h'\n type: 'rdb'\n }\n }\n diagnosticSettings: [\n {\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\n eventHubName: '<eventHubName>'\n metricCategories: [\n {\n category: 'AllMetrics'\n }\n ]\n name: 'customSettingCluster'\n storageAccountResourceId: '<storageAccountResourceId>'\n workspaceResourceId: '<workspaceResourceId>'\n }\n ]\n privateEndpoints: [\n {\n privateDnsZoneGroup: {\n privateDnsZoneGroupConfigs: [\n {\n privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\n }\n ]\n }\n subnetResourceId: '<subnetResourceId>'\n tags: {\n Environment: 'Non-Prod'\n 'hidden-title': 'This is visible in the resource name'\n Role: 'DeploymentValidation'\n }\n }\n ]\n skuName: 'Balanced_B10'\n tags: {\n Environment: 'Non-Prod'\n 'hidden-title': 'This is visible in the resource name'\n Role: 'DeploymentValidation'\n }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Batch Account: Using only defaults"}, {"role": "assistant", "content": "module batchAccount 'br/public:avm/res/batch/batch-account:0.11.0' = {\n name: 'batchAccountDeployment'\n params: {\n // Required parameters\n name: 'bbawaf001'\n storageAccountResourceId: '<storageAccountResourceId>'\n // Non-required parameters\n diagnosticSettings: [\n {\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\n eventHubName: '<eventHubName>'\n storageAccountResourceId: '<storageAccountResourceId>'\n workspaceResourceId: '<workspaceResourceId>'\n }\n ]\n managedIdentities: {\n systemAssigned: true\n }\n poolAllocationMode: 'BatchService'\n privateEndpoints: [\n {\n privateDnsZoneGroup: {\n privateDnsZoneGroupConfigs: [\n {\n privateDnsZoneResourceId: '<privateDnsZoneResourceId>'\n }\n ]\n }\n service: 'batchAccount'\n subnetResourceId: '<subnetResourceId>'\n }\n ]\n storageAccessIdentityResourceId: '<storageAccessIdentityResourceId>'\n storageAuthenticationMode: 'BatchAccountManagedIdentity'\n tags: {\n Environment: 'Non-Prod'\n 'hidden-title': 'This is visible in the resource name'\n Role: 'DeploymentValidation'\n }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an Azure Stack HCI Cluster on the provided Arc Machines: Deploy Azure Stack HCI Cluster in Azure with a 2 node switched configuration"}, {"role": "assistant", "content": "module cluster 'br/public:avm/res/azure-stack-hci/cluster:<version>' = {\n name: 'clusterDeployment'\n params: {\n // Required parameters\n deploymentSettings: {\n bitlockerBootVolume: true\n bitlockerDataVolumes: true\n clusterNodeNames: '<clusterNodeNames>'\n clusterWitnessStorageAccountName: '<clusterWitnessStorageAccountName>'\n customLocationName: 'ashcwaf-location'\n defaultGateway: '192.168.1.1'\n deploymentPrefix: '<deploymentPrefix>'\n dnsServers: [\n '192.168.1.254'\n ]\n domainFqdn: 'jumpstart.local'\n domainOUPath: '<domainOUPath>'\n driftControlEnforced: true\n enableStorageAutoIp: true\n endingIPAddress: '192.168.1.65'\n keyVaultName: '<keyVaultName>'\n networkIntents: [\n {\n adapter: [\n 'FABRIC'\n 'FABRIC2'\n ]\n adapterPropertyOverrides: {\n jumboPacket: '9014'\n networkDirect: 'Disabled'\n networkDirectTechnology: 'iWARP'\n }\n name: 'ManagementCompute'\n overrideAdapterProperty: true\n overrideQosPolicy: false\n overrideVirtualSwitchConfiguration: false\n qosPolicyOverrides: {\n bandwidthPercentageSMB: '50'\n priorityValue8021ActionCluster: '7'\n priorityValue8021ActionSMB: '3'\n }\n trafficType: [\n 'Compute'\n 'Management'\n ]\n virtualSwitchConfigurationOverrides: {\n enableIov: 'true'\n loadBalancingAlgorithm: 'Dynamic'\n }\n }\n {\n adapter: [\n 'StorageA'\n 'StorageB'\n ]\n adapterPropertyOverrides: {\n jumboPacket: '9014'\n networkDirect: 'Disabled'\n networkDirectTechnology: 'iWARP'\n }\n name: 'Storage'\n overrideAdapterProperty: true\n overrideQosPolicy: true\n overrideVirtualSwitchConfiguration: false\n qosPolicyOverrides: {\n bandwidthPercentageSMB: '50'\n priorityValue8021ActionCluster: '7'\n priorityValue8021ActionSMB: '3'\n }\n trafficType: [\n 'Storage'\n ]\n virtualSwitchConfigurationOverrides: {\n enableIov: 'true'\n loadBalancingAlgorithm: 'Dynamic'\n }\n }\n ]\n sideChannelMitigationEnforced: true\n smbClusterEncryption: true\n smbSigningEnforced: true\n startingIPAddress: '192.168.1.55'\n storageConnectivitySwitchless: false\n storageNetworks: [\n {\n adapterName: 'StorageA'\n name: 'Storage1Network'\n vlan: '711'\n }\n {\n adapterName: 'StorageB'\n name: 'Storage2Network'\n vlan: '712'\n }\n ]\n subnetMask: '255.255.255.0'\n }\n hciResourceProviderObjectId: '<hciResourceProviderObjectId>'\n name: '<name>'\n // Non-required parameters\n deploymentUser: 'deployUser'\n deploymentUserPassword: '<deploymentUserPassword>'\n localAdminPassword: '<localAdminPassword>'\n localAdminUser: 'Administrator'\n servicePrincipalId: '<servicePrincipalId>'\n servicePrincipalSecret: '<servicePrincipalSecret>'\n tags: {\n Environment: 'Non-Prod'\n 'hidden-title': 'This is visible in the resource name'\n Role: 'DeploymentValidation'\n }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an Azure Stack HCI Logical Network: Using only defaults"}, {"role": "assistant", "content": "module logicalNetwork 'br/public:avm/res/azure-stack-hci/logical-network:0.2.0' = {\n name: 'logicalNetworkDeployment'\n params: {\n // Required parameters\n customLocationResourceId: '<customLocationResourceId>'\n name: 'ashlnwaflogicalnetwork'\n vmSwitchName: '<vmSwitchName>'\n // Non-required parameters\n addressPrefix: '192.168.1.0/24'\n defaultGateway: '192.168.1.1'\n dnsServers: [\n '192.168.1.254'\n ]\n ipAllocationMethod: 'Static'\n ipPools: [\n {\n end: '192.168.1.190'\n start: '192.168.1.171'\n }\n ]\n routeName: 'default'\n tags: {\n Environment: 'Non-Prod'\n 'hidden-title': 'This is visible in the resource name'\n Role: 'DeploymentValidation'\n }\n vlanId: '<vlanId>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an Azure Stack HCI Marketplace Gallery Image: Using only defaults"}, {"role": "assistant", "content": "module marketplaceGalleryImage 'br/public:avm/res/azure-stack-hci/marketplace-gallery-image:0.1.0' = {\n name: 'marketplaceGalleryImageDeployment'\n params: {\n // Required parameters\n customLocationResourceId: '<customLocationResourceId>'\n identifier: {\n offer: 'WindowsServer'\n publisher: 'MicrosoftWindowsServer'\n sku: '2022-datacenter-azure-edition'\n }\n name: 'ashmgiwafmarketplaceimage'\n osType: 'Windows'\n version: {\n name: '20348.2461.240510'\n }\n // Non-required parameters\n cloudInitDataSource: 'Azure'\n containerResourceId: '<containerResourceId>'\n hyperVGeneration: 'V2'\n tags: {\n Environment: 'Test'\n 'hidden-title': 'This is visible in the resource name'\n Purpose: 'MarketplaceGalleryImage'\n }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an Azure Stack HCI network interface: Using only defaults"}, {"role": "assistant", "content": "module networkInterface 'br/public:avm/res/azure-stack-hci/network-interface:0.1.0' = {\n name: 'networkInterfaceDeployment'\n params: {\n // Required parameters\n customLocationResourceId: '<customLocationResourceId>'\n ipConfigurations: [\n {\n properties: {\n subnet: {\n id: '<id>'\n }\n }\n }\n ]\n name: 'ashniwafnetworkinterface'\n // Non-required parameters\n dnsServers: [\n '172.20.0.1'\n ]\n enableTelemetry: true\n location: '<location>'\n tags: {\n Environment: 'Non-Prod'\n 'hidden-title': 'This is visible in the resource name'\n Role: 'DeploymentValidation'\n }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an Azure Stack HCI virtual hard disk: Using only defaults"}, {"role": "assistant", "content": "module virtualHardDisk 'br/public:avm/res/azure-stack-hci/virtual-hard-disk:0.1.0' = {\n name: 'virtualHardDiskDeployment'\n params: {\n // Required parameters\n customLocationResourceId: '<customLocationResourceId>'\n diskSizeGB: 4\n dynamic: true\n name: 'ashvdwaf1'\n // Non-required parameters\n location: '<location>'\n tags: {\n Environment: 'Non-Prod'\n 'hidden-title': 'This is visible in the resource name'\n Role: 'DeploymentValidation'\n }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an Azure Stack HCI virtual machine: Using default config"}, {"role": "assistant", "content": "module virtualMachineInstance 'br/public:avm/res/azure-stack-hci/virtual-machine-instance:0.1.0' = {\n name: 'virtualMachineInstanceDeployment'\n params: {\n // Required parameters\n customLocationResourceId: '<customLocationResourceId>'\n hardwareProfile: {\n dynamicMemoryConfig: {\n maximumMemoryMB: 8192\n minimumMemoryMB: 512\n targetMemoryBuffer: 20\n }\n memoryMB: 4096\n processors: 2\n vmSize: 'Custom'\n }\n name: '<name>'\n networkProfile: {}\n osProfile: {\n adminPassword: '<adminPassword>'\n adminUsername: 'Administrator'\n computerName: 'ashvmiwafvm'\n linuxConfiguration: {}\n windowsConfiguration: {\n enableAutomaticUpdates: true\n provisionVMAgent: true\n provisionVMConfigAgent: true\n }\n }\n storageProfile: {\n imageReference: '<imageReference>'\n osDisk: {\n osType: 'Windows'\n }\n }\n // Non-required parameters\n adminPassword: '<adminPassword>'\n location: '<location>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Role Assignment at a Management Group scope: Using only defaults (Management Group scope)"}, {"role": "assistant", "content": "module roleAssignment 'br/public:avm/res/authorization/role-assignment/mg-scope:0.1.0' = {\n name: 'roleAssignmentDeployment'\n params: {\n // Required parameters\n principalId: '<principalId>'\n roleDefinitionIdOrName: 'Resource Policy Contributor'\n // Non-required parameters\n location: '<location>'\n principalType: 'ServicePrincipal'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Role Assignment at a Resource Group scope: Using only defaults (Resource Group scope)"}, {"role": "assistant", "content": "module roleAssignment 'br/public:avm/res/authorization/role-assignment/rg-scope:0.1.0' = {\n name: 'roleAssignmentDeployment'\n params: {\n // Required parameters\n principalId: '<principalId>'\n roleDefinitionIdOrName: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'\n // Non-required parameters\n principalType: 'ServicePrincipal'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Role Assignment at a Subscription scope: Using only defaults (Subscription scope)"}, {"role": "assistant", "content": "module roleAssignment 'br/public:avm/res/authorization/role-assignment/sub-scope:0.1.0' = {\n name: 'roleAssignmentDeployment'\n params: {\n // Required parameters\n principalId: '<principalId>'\n roleDefinitionIdOrName: '<roleDefinitionIdOrName>'\n // Non-required parameters\n principalType: 'ServicePrincipal'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Policy Assignment at a Management Group scope: Using only defaults (Management Group scope)"}, {"role": "assistant", "content": "module policyAssignment 'br/public:avm/res/authorization/policy-assignment/mg-scope:0.1.0' = {\n name: 'policyAssignmentDeployment'\n params: {\n // Required parameters\n name: 'rapamgwaf001'\n policyDefinitionId: '/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d'\n // Non-required parameters\n additionalManagementGroupsIDsToAssignRbacTo: [\n '<name>'\n ]\n metadata: {\n assignedBy: 'Bicep'\n }\n roleDefinitionIds: [\n '/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c'\n ]\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Policy Assignment at a Resource Group scope: Using only defaults (Resource Group scope)"}, {"role": "assistant", "content": "module policyAssignment 'br/public:avm/res/authorization/policy-assignment/rg-scope:0.1.0' = {\n name: 'policyAssignmentDeployment'\n params: {\n // Required parameters\n name: 'rapargwaf001'\n policyDefinitionId: '/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d'\n // Non-required parameters\n additionalResourceGroupResourceIDsToAssignRbacTo: [\n '<id>'\n ]\n metadata: {\n assignedBy: 'Bicep'\n }\n roleDefinitionIds: [\n '/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c'\n ]\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Policy Assignment at a Subscription scope: Using only defaults (Subscription scope)"}, {"role": "assistant", "content": "module policyAssignment 'br/public:avm/res/authorization/policy-assignment/sub-scope:0.1.0' = {\n name: 'policyAssignmentDeployment'\n params: {\n // Required parameters\n name: 'rapasubwaf001'\n policyDefinitionId: '/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d'\n // Non-required parameters\n additionalSubscriptionIDsToAssignRbacTo: [\n '<subscriptionId>'\n ]\n metadata: {\n assignedBy: 'Bicep'\n }\n roleDefinitionIds: [\n '/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c'\n ]\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an App Configuration Store: Using only defaults"}, {"role": "assistant", "content": "module configurationStore 'br/public:avm/res/app-configuration/configuration-store:0.9.0' = {\n name: 'configurationStoreDeployment'\n params: {\n // Required parameters\n name: 'accwaf001'\n // Non-required parameters\n createMode: 'Default'\n diagnosticSettings: [\n {\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\n eventHubName: '<eventHubName>'\n storageAccountResourceId: '<storageAccountResourceId>'\n workspaceResourceId: '<workspaceResourceId>'\n }\n ]\n disableLocalAuth: '<disableLocalAuth>'\n enablePurgeProtection: false\n keyValues: [\n {\n contentType: 'contentType'\n name: 'keyName'\n value: 'valueName'\n }\n ]\n replicaLocations: [\n {\n replicaLocation: 'centralus'\n }\n {\n replicaLocation: 'westus'\n }\n ]\n softDeleteRetentionInDays: 1\n tags: {\n Environment: 'Non-Prod'\n 'hidden-title': 'This is visible in the resource name'\n Role: 'DeploymentValidation'\n }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Container App: Using only defaults"}, {"role": "assistant", "content": "module containerApp 'br/public:avm/res/app/container-app:0.19.0' = {\n name: 'containerAppDeployment'\n params: {\n // Required parameters\n containers: [\n {\n image: 'mcr.microsoft.com/k8se/quickstart:latest'\n name: 'simple-hello-world-container'\n probes: [\n {\n httpGet: {\n httpHeaders: [\n {\n name: 'Custom-Header'\n value: 'Awesome'\n }\n ]\n path: '/health'\n port: 8080\n }\n initialDelaySeconds: 3\n periodSeconds: 3\n type: 'Liveness'\n }\n ]\n resources: {\n cpu: '<cpu>'\n memory: '0.5Gi'\n }\n }\n ]\n environmentResourceId: '<environmentResourceId>'\n name: 'acawaf001'\n // Non-required parameters\n diagnosticSettings: [\n {\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\n eventHubName: '<eventHubName>'\n logCategoriesAndGroups: []\n metricCategories: [\n {\n category: 'AllMetrics'\n }\n ]\n storageAccountResourceId: '<storageAccountResourceId>'\n workspaceResourceId: '<workspaceResourceId>'\n }\n ]\n ingressAllowInsecure: false\n ingressExternal: false\n managedIdentities: {\n userAssignedResourceIds: [\n '<managedIdentityResourceId>'\n ]\n }\n tags: {\n Env: 'test'\n 'hidden-title': 'This is visible in the resource name'\n }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Container App Job: Using a consumption plan"}, {"role": "assistant", "content": "module job 'br/public:avm/res/app/job:0.7.0' = {\n name: 'jobDeployment'\n params: {\n // Required parameters\n containers: [\n {\n image: 'mcr.microsoft.com/azuredocs/containerapps-helloworld:latest'\n name: 'simple-hello-world-container'\n probes: [\n {\n httpGet: {\n httpHeaders: [\n {\n name: 'Custom-Header'\n value: 'Awesome'\n }\n ]\n path: '/health'\n port: 8080\n }\n initialDelaySeconds: 3\n periodSeconds: 3\n type: 'Liveness'\n }\n ]\n resources: {\n cpu: '0.25'\n memory: '0.5Gi'\n }\n }\n ]\n environmentResourceId: '<environmentResourceId>'\n name: 'ajwaf001'\n triggerType: 'Schedule'\n // Non-required parameters\n location: '<location>'\n scheduleTriggerConfig: {\n cronExpression: '0 0 * * *'\n }\n tags: {\n Env: 'test'\n 'hidden-title': 'This is visible in the resource name'\n }\n workloadProfileName: '<workloadProfileName>'\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an App Managed Environment (also known as a Container App Environment): No App Logging"}, {"role": "assistant", "content": "module managedEnvironment 'br/public:avm/res/app/managed-environment:0.11.0' = {\n name: 'managedEnvironmentDeployment'\n params: {\n // Required parameters\n name: 'amewaf001'\n // Non-required parameters\n appLogsConfiguration: {\n destination: 'log-analytics'\n logAnalyticsConfiguration: {\n customerId: '<customerId>'\n sharedKey: '<sharedKey>'\n }\n }\n dockerBridgeCidr: '172.16.0.1/28'\n infrastructureResourceGroupName: '<infrastructureResourceGroupName>'\n infrastructureSubnetResourceId: '<infrastructureSubnetResourceId>'\n internal: true\n platformReservedCidr: '172.17.17.0/24'\n platformReservedDnsIP: '172.17.17.17'\n tags: {\n Env: 'test'\n 'hidden-title': 'This is visible in the resource name'\n }\n workloadProfiles: [\n {\n maximumCount: 3\n minimumCount: 0\n name: 'CAW01'\n workloadProfileType: 'D4'\n }\n ]\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy a Container App Session Pool: Using only defaults"}, {"role": "assistant", "content": "module sessionPool 'br/public:avm/res/app/session-pool:0.2.0' = {\n name: 'sessionPoolDeployment'\n params: {\n // Required parameters\n containerType: 'PythonLTS'\n name: 'aspwaf001'\n // Non-required parameters\n location: '<location>'\n sessionNetworkStatus: 'EgressDisabled'\n tags: {\n resourceType: 'Session Pool'\n }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an Analysis Services Server: Using only defaults"}, {"role": "assistant", "content": "module server 'br/public:avm/res/analysis-services/server:0.3.0' = {\n name: 'serverDeployment'\n params: {\n // Required parameters\n name: 'asswaf'\n // Non-required parameters\n diagnosticSettings: [\n {\n eventHubAuthorizationRuleResourceId: '<eventHubAuthorizationRuleResourceId>'\n eventHubName: '<eventHubName>'\n logCategoriesAndGroups: [\n {\n category: 'Engine'\n }\n {\n category: 'Service'\n }\n ]\n metricCategories: [\n {\n category: 'AllMetrics'\n }\n ]\n name: 'customSetting'\n storageAccountResourceId: '<storageAccountResourceId>'\n workspaceResourceId: '<workspaceResourceId>'\n }\n ]\n firewallSettings: {\n enablePowerBIService: true\n firewallRules: [\n {\n firewallRuleName: 'AllowFromAll'\n rangeEnd: '255.255.255.255'\n rangeStart: '0.0.0.0'\n }\n ]\n }\n location: '<location>'\n lock: {\n kind: 'CanNotDelete'\n name: 'myCustomLockName'\n }\n skuCapacity: 1\n skuName: 'S0'\n tags: {\n Environment: 'Non-Prod'\n 'hidden-title': 'This is visible in the resource name'\n Role: 'DeploymentValidation'\n }\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Deploy an Alert Processing Rule: Using small parameter set"}, {"role": "assistant", "content": "module actionRule 'br/public:avm/res/alerts-management/action-rule:0.2.0' = {\n name: 'actionRuleDeployment'\n params: {\n // Required parameters\n name: 'aprwaf001'\n // Non-required parameters\n actions: [\n {\n actionGroupIds: [\n '<actionGroupResourceId>'\n ]\n actionType: 'AddActionGroups'\n }\n ]\n aprDescription: 'Test deployment of the module with the waf aligned set of parameters.'\n location: '<location>'\n scopes: [\n '<id>'\n ]\n }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1104?"}, {"role": "assistant", "content": "// Parameters\n@description('Specifies the name of the virtual machine.')\nparam vmName string = 'TestVm'\n\n@description('Specifies the size of the virtual machine.')\nparam vmSize string = 'Standard_DS3_v2'\n\n@description('Specifies the resource id of the subnet hosting the virtual machine.')\nparam vmSubnetId string\n\n@description('Specifies the name of the storage account where the bootstrap diagnostic logs of the virtual machine are stored.')\nparam storageAccountName string\n\n@description('Specifies the image publisher of the disk image used to create the virtual machine.')\nparam imagePublisher string = 'MicrosoftWindowsServer'\n\n@description('Specifies the offer of the platform image or marketplace image used to create the virtual machine.')\nparam imageOffer string = 'WindowsServer'\n\n@description('Specifies the image version for the virtual machine.')\nparam imageSku string = '2022-datacenter-azure-edition'\n\n@description('Specifies the type of authentication when accessing the Virtual Machine. SSH key is recommended.')\n@allowed([\n  'sshPublicKey'\n  'password'\n])\nparam authenticationType string = 'password'\n\n@description('Specifies the name of the administrator account of the virtual machine.')\nparam vmAdminUsername string\n\n@description('Specifies the SSH Key or password for the virtual machine. SSH key is recommended.')\n@secure()\nparam vmAdminPasswordOrKey string\n\n@description('Specifies the storage account type for OS and data disk.')\n@allowed([\n  'Premium_LRS'\n  'StandardSSD_LRS'\n  'Standard_LRS'\n  'UltraSSD_LRS'\n])\nparam diskStorageAccountType string = 'Premium_LRS'\n\n@description('Specifies the number of data disks of the virtual machine.')\n@minValue(0)\n@maxValue(64)\nparam numDataDisks int = 1\n\n@description('Specifies the size in GB of the OS disk of the VM.')\nparam osDiskSize int = 128\n\n@description('Specifies the size in GB of the OS disk of the virtual machine.')\nparam dataDiskSize int = 50\n\n@description('Specifies the caching requirements for the data disks.')\nparam dataDiskCaching string = 'ReadWrite'\n\n@description('Specifies whether enabling Microsoft Entra ID authentication on the virtual machine.')\nparam enableMicrosoftEntraIdAuth bool = true\n\n@description('Specifies whether enabling accelerated networking on the virtual machine.')\nparam enableAcceleratedNetworking bool = true\n\n@description('Specifies the name of the network interface of the virtual machine.')\nparam vmNicName string\n\n@description('Specifies the object id of a Miccrosoft Entra ID user. In general, this the object id of the system administrator who deploys the Azure resources.')\nparam userObjectId string = ''\n\n@description('Specifies the location.')\nparam location string = resourceGroup().location\n\n@description('Specifies the resource id of the Log Analytics workspace.')\nparam workspaceId string\n\n@description('Specifies the resource tags.')\nparam tags object\n\n// Variables\nvar linuxConfiguration = {\n  disablePasswordAuthentication: true\n  ssh: {\n    publicKeys: [\n      {\n        path: '/home/${vmAdminUsername}/.ssh/authorized_keys'\n        keyData: vmAdminPasswordOrKey\n      }\n    ]\n  }\n  provisionVMAgent: true\n}\n\n// Resources\nresource virtualMachineNic 'Microsoft.Network/networkInterfaces@2023-11-01' = {\n  name: vmNicName\n  location: location\n  tags: tags\n  properties: {\n    enableAcceleratedNetworking: enableAcceleratedNetworking\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: vmSubnetId\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-05-01' existing = {\n  name: storageAccountName\n}\n\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2024-07-01' = {\n  name: vmName\n  location: location\n  tags: tags\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: vmName\n      adminUsername: vmAdminUsername\n      adminPassword: vmAdminPasswordOrKey\n      linuxConfiguration: (authenticationType == 'password') ? null : linuxConfiguration\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: imagePublisher\n        offer: imageOffer\n        sku: imageSku\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${vmName}_OSDisk'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        diskSizeGB: osDiskSize\n        managedDisk: {\n          storageAccountType: diskStorageAccountType\n        }\n      }\n      dataDisks: [\n        for j in range(0, numDataDisks): {\n          caching: dataDiskCaching\n          diskSizeGB: dataDiskSize\n          lun: j\n          name: '${vmName}-DataDisk${j}'\n          createOption: 'Empty'\n          managedDisk: {\n            storageAccountType: diskStorageAccountType\n          }\n        }\n      ]\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: virtualMachineNic.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: storageAccount.properties.primaryEndpoints.blob\n      }\n    }\n  }\n}\n\nresource dependencyExtension 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = {\n  name: 'DependencyAgentWindows'\n  parent: virtualMachine\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Monitoring.DependencyAgent'\n    type: 'DependencyAgentWindows'\n    typeHandlerVersion: '9.4'\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n  }\n}\n\nresource amaExtension 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = {\n  name: 'AzureMonitorWindowsAgent'\n  parent: virtualMachine\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Monitor'\n    type: 'AzureMonitorWindowsAgent'\n    typeHandlerVersion: '1.0'\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n  }\n  dependsOn: [\n    dependencyExtension\n  ]\n}\n\nresource entraExtension 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = if (enableMicrosoftEntraIdAuth) {\n  name: 'AADLoginForWindows'\n  parent: virtualMachine\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.ActiveDirectory'\n    type: 'AADLoginForWindows'\n    typeHandlerVersion: '1.0'\n    autoUpgradeMinorVersion: false\n    enableAutomaticUpgrade: false\n  }\n  dependsOn: [\n    amaExtension\n  ]\n}\n\nresource dcrEventLogs 'Microsoft.Insights/dataCollectionRules@2023-03-11' = {\n  name: 'DCR-Win-Event-Logs-to-LAW'\n  location: location\n  kind: 'Windows'\n  properties: {\n    dataFlows: [\n      {\n        destinations: [\n          'logAnalytics'\n        ]\n        streams: [\n          'Microsoft-Event'\n        ]\n      }\n    ]\n    dataSources: {\n      windowsEventLogs: [\n        {\n          streams: [\n            'Microsoft-Event'\n          ]\n          xPathQueries: [\n            'Application!*[System[(Level=1 or Level=2 or Level=3 or or Level=0) ]]'\n            'Security!*[System[(band(Keywords,13510798882111488))]]'\n            'System!*[System[(Level=1 or Level=2 or Level=3 or or Level=0)]]'\n          ]\n          name: 'eventLogsDataSource'\n        }\n      ]\n    }\n    description: 'Collect Windows Event Logs and send to Azure Monitor Logs'\n    destinations: {\n      logAnalytics: [\n        {\n          name: 'logAnalytics'\n          workspaceResourceId: workspaceId\n        }\n      ]\n    }\n  }\n  dependsOn: [\n    entraExtension\n  ]\n}\n\nresource dcrPerfLaw 'Microsoft.Insights/dataCollectionRules@2023-03-11' = {\n  name: 'DCR-Win-Perf-to-LAW'\n  location: location\n  kind: 'Windows'\n  properties: {\n    dataFlows: [\n      {\n        destinations: [\n          'logAnalytics'\n        ]\n        streams: [\n          'Microsoft-Perf'\n        ]\n      }\n    ]\n    dataSources: {\n      performanceCounters: [\n        {\n          counterSpecifiers: [\n            '\\\\Processor Information(_Total)\\\\% Processor Time'\n            '\\\\Processor Information(_Total)\\\\% Privileged Time'\n            '\\\\Processor Information(_Total)\\\\% User Time'\n            '\\\\Processor Information(_Total)\\\\Processor Frequency'\n            '\\\\System\\\\Processes'\n            '\\\\Process(_Total)\\\\Thread Count'\n            '\\\\Process(_Total)\\\\Handle Count'\n            '\\\\System\\\\System Up Time'\n            '\\\\System\\\\Context Switches/sec'\n            '\\\\System\\\\Processor Queue Length'\n            '\\\\Memory\\\\% Committed Bytes In Use'\n            '\\\\Memory\\\\Available Bytes'\n            '\\\\Memory\\\\Committed Bytes'\n            '\\\\Memory\\\\Cache Bytes'\n            '\\\\Memory\\\\Pool Paged Bytes'\n            '\\\\Memory\\\\Pool Nonpaged Bytes'\n            '\\\\Memory\\\\Pages/sec'\n            '\\\\Memory\\\\Page Faults/sec'\n            '\\\\Process(_Total)\\\\Working Set'\n            '\\\\Process(_Total)\\\\Working Set - Private'\n            '\\\\LogicalDisk(_Total)\\\\% Disk Time'\n            '\\\\LogicalDisk(_Total)\\\\% Disk Read Time'\n            '\\\\LogicalDisk(_Total)\\\\% Disk Write Time'\n            '\\\\LogicalDisk(_Total)\\\\% Idle Time'\n            '\\\\LogicalDisk(_Total)\\\\Disk Bytes/sec'\n            '\\\\LogicalDisk(_Total)\\\\Disk Read Bytes/sec'\n            '\\\\LogicalDisk(_Total)\\\\Disk Write Bytes/sec'\n            '\\\\LogicalDisk(_Total)\\\\Disk Transfers/sec'\n            '\\\\LogicalDisk(_Total)\\\\Disk Reads/sec'\n            '\\\\LogicalDisk(_Total)\\\\Disk Writes/sec'\n            '\\\\LogicalDisk(_Total)\\\\Avg. Disk sec/Transfer'\n            '\\\\LogicalDisk(_Total)\\\\Avg. Disk sec/Read'\n            '\\\\LogicalDisk(_Total)\\\\Avg. Disk sec/Write'\n            '\\\\LogicalDisk(_Total)\\\\Avg. Disk Queue Length'\n            '\\\\LogicalDisk(_Total)\\\\Avg. Disk Read Queue Length'\n            '\\\\LogicalDisk(_Total)\\\\Avg. Disk Write Queue Length'\n            '\\\\LogicalDisk(_Total)\\\\% Free Space'\n            '\\\\LogicalDisk(_Total)\\\\Free Megabytes'\n            '\\\\Network Interface(*)\\\\Bytes Total/sec'\n            '\\\\Network Interface(*)\\\\Bytes Sent/sec'\n            '\\\\Network Interface(*)\\\\Bytes Received/sec'\n            '\\\\Network Interface(*)\\\\Packets/sec'\n            '\\\\Network Interface(*)\\\\Packets Sent/sec'\n            '\\\\Network Interface(*)\\\\Packets Received/sec'\n            '\\\\Network Interface(*)\\\\Packets Outbound Errors'\n            '\\\\Network Interface(*)\\\\Packets Received Errors'\n          ]\n          name: 'perfCounterDataSource60'\n          samplingFrequencyInSeconds: 60\n          streams: [\n            'Microsoft-Perf'\n          ]\n        }\n      ]\n    }\n    description: 'Collect Performance Counters and send to Azure Monitor Logs.'\n    destinations: {\n      logAnalytics: [\n        {\n          name: 'logAnalytics'\n          workspaceResourceId: workspaceId\n        }\n      ]\n    }\n  }\n  dependsOn: [\n    entraExtension\n  ]\n}\n\nresource dcrEventLogsAssociation 'Microsoft.Insights/dataCollectionRuleAssociations@2023-03-11' = {\n  name: 'DCRA-VMSS-WEL-LAW'\n  scope: virtualMachine\n  properties: {\n    description: 'Association of data collection rule. Deleting this association will break the data collection for this virtual machine.'\n    dataCollectionRuleId: dcrEventLogs.id\n  }\n}\n\nresource dcrPerfLawAssociation 'Microsoft.Insights/dataCollectionRuleAssociations@2023-03-11' = {\n  name: 'DCRA-VM-PC-LAW'\n  scope: virtualMachine\n  properties: {\n    description: 'Association of data collection rule. Deleting this association will break the data collection for this virtual machine.'\n    dataCollectionRuleId: dcrPerfLaw.id\n  }\n}\n\nresource virtualMachineAdministratorLoginRoleDefinition 'Microsoft.Authorization/roleDefinitions@2022-04-01' existing = {\n  name: '1c0163c0-47e6-4577-8991-ea5c82e286e4'\n  scope: subscription()\n}\n\n// This role assignment grants the Virtual Machine Administrator Login role to the current user. \nresource virtualMachineAdministratorLoginUserRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = if (enableMicrosoftEntraIdAuth && !empty(userObjectId)) {\n  name: guid(virtualMachine.id, virtualMachineAdministratorLoginRoleDefinition.id, userObjectId)\n  scope: virtualMachine\n  properties: {\n    roleDefinitionId: virtualMachineAdministratorLoginRoleDefinition.id\n    principalType: 'User'\n    principalId: userObjectId\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1105."}, {"role": "assistant", "content": "// Parameters\n@description('Specifies the name of the virtual network.')\nparam virtualNetworkName string\n\n@description('Specifies the address prefixes of the virtual network.')\nparam virtualNetworkAddressPrefixes string = '10.0.0.0/8'\n\n@description('Specifies the name of the subnet which contains the virtual machine.')\nparam vmSubnetName string = 'VmSubnet'\n\n@description('Specifies the address prefix of the subnet which contains the virtual machine.')\nparam vmSubnetAddressPrefix string = '10.3.1.0/24'\n\n@description('Specifies the name of the network security group associated to the subnet hosting the virtual machine.')\nparam vmSubnetNsgName string = 'VmSubnetNsg'\n\n@description('Specifies the Bastion subnet IP prefix. This prefix must be within vnet IP prefix address space.')\nparam bastionSubnetAddressPrefix string = '10.3.2.0/24'\n\n@description('Specifies the name of the network security group associated to the subnet hosting Azure Bastion.')\nparam bastionSubnetNsgName string = 'AzureBastionNsg'\n\n@description('Specifies whether Azure Bastion should be created.')\nparam bastionHostEnabled bool = true\n\n@description('Specifies the name of the Azure Bastion resource.')\nparam bastionHostName string\n\n@description('Enable/Disable Copy/Paste feature of the Bastion Host resource.')\nparam bastionHostDisableCopyPaste bool = true\n\n@description('Enable/Disable File Copy feature of the Bastion Host resource.')\nparam bastionHostEnableFileCopy bool = true\n\n@description('Enable/Disable IP Connect feature of the Bastion Host resource.')\nparam bastionHostEnableIpConnect bool = true\n\n@description('Enable/Disable Shareable Link of the Bastion Host resource.')\nparam bastionHostEnableShareableLink bool = true\n\n@description('Enable/Disable Tunneling feature of the Bastion Host resource.')\nparam bastionHostEnableTunneling bool = true\n\n@description('Specifies the name of the Azure Public IP Address used by the Azure Bastion Host.')\nparam bastionPublicIpAddressName string\n\n@description('Specifies the name of the Azure Bastion Host SKU.')\nparam bastionHostSkuName string = 'Standard'\n\n@description('Specifies the name of the Azure NAT Gateway.')\nparam natGatewayName string\n\n@description('Specifies a list of availability zones denoting the zone in which Nat Gateway should be deployed.')\nparam natGatewayZones array = []\n\n@description('Specifies the number of Public IPs to create for the Azure NAT Gateway.')\nparam natGatewayPublicIps int = 1\n\n@description('Specifies the idle timeout in minutes for the Azure NAT Gateway.')\nparam natGatewayIdleTimeoutMins int = 30\n\n@description('Specifies the resource id of the Log Analytics workspace.')\nparam workspaceId string\n\n@description('Specifies the location.')\nparam location string = resourceGroup().location\n\n@description('Specifies the resource tags.')\nparam tags object\n\n// Variables\nvar diagnosticSettingsName = 'diagnosticSettings'\nvar nsgLogCategories = [\n  'NetworkSecurityGroupEvent'\n  'NetworkSecurityGroupRuleCounter'\n]\nvar nsgLogs = [for category in nsgLogCategories: {\n  category: category\n  enabled: true\n  retentionPolicy: {\n    enabled: true\n    days: 0\n  }\n}]\nvar vnetLogCategories = [\n  'VMProtectionAlerts'\n]\nvar vnetMetricCategories = [\n  'AllMetrics'\n]\nvar vnetLogs = [for category in vnetLogCategories: {\n  category: category\n  enabled: true\n  retentionPolicy: {\n    enabled: true\n    days: 0\n  }\n}]\nvar vnetMetrics = [for category in vnetMetricCategories: {\n  category: category\n  enabled: true\n  retentionPolicy: {\n    enabled: true\n    days: 0\n  }\n}]\nvar bastionLogCategories = [\n  'BastionAuditLogs'\n]\nvar bastionMetricCategories = [\n  'AllMetrics'\n]\nvar bastionLogs = [for category in bastionLogCategories: {\n  category: category\n  enabled: true\n  retentionPolicy: {\n    enabled: true\n    days: 0\n  }\n}]\nvar bastionMetrics = [for category in bastionMetricCategories: {\n  category: category\n  enabled: true\n  retentionPolicy: {\n    enabled: true\n    days: 0\n  }\n}]\nvar bastionSubnetName = 'AzureBastionSubnet'\n\n// Virtual Network\nresource vnet 'Microsoft.Network/virtualNetworks@2023-11-01' = {\n  name: virtualNetworkName\n  location: location\n  tags: tags\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        virtualNetworkAddressPrefixes\n      ]\n    }\n    subnets: [\n      {\n        name: vmSubnetName\n        properties: {\n          addressPrefix: vmSubnetAddressPrefix\n          networkSecurityGroup: {\n            id: vmSubnetNsg.id\n          }\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Disabled'\n          natGateway: {\n            id: natGateway.id\n          }\n        }\n      }\n      {\n        name: bastionSubnetName\n        properties: {\n          addressPrefix: bastionSubnetAddressPrefix\n          networkSecurityGroup: {\n            id: bastionSubnetNsg.id\n          }\n        }\n      }\n    ]\n  }\n}\n\n// Network Security Groups\nresource bastionSubnetNsg 'Microsoft.Network/networkSecurityGroups@2023-04-01' = if (bastionHostEnabled) {\n  name: bastionSubnetNsgName\n  location: location\n  tags: tags\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowHttpsInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'Internet'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 100\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowGatewayManagerInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'GatewayManager'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 110\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowLoadBalancerInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'AzureLoadBalancer'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 120\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowBastionHostCommunicationInBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationPortRanges: [\n            '8080'\n            '5701'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 130\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'DenyAllInBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRange: '*'\n          destinationAddressPrefix: '*'\n          access: 'Deny'\n          priority: 1000\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowSshRdpOutBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRanges: [\n            '22'\n            '3389'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 100\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowAzureCloudCommunicationOutBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRange: '443'\n          destinationAddressPrefix: 'AzureCloud'\n          access: 'Allow'\n          priority: 110\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowBastionHostCommunicationOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationPortRanges: [\n            '8080'\n            '5701'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 120\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowGetSessionInformationOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'Internet'\n          destinationPortRanges: [\n            '80'\n            '443'\n          ]\n          access: 'Allow'\n          priority: 130\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'DenyAllOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          destinationPortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Deny'\n          priority: 1000\n          direction: 'Outbound'\n        }\n      }\n    ]\n  }\n}\n\nresource vmSubnetNsg 'Microsoft.Network/networkSecurityGroups@2023-04-01' = {\n  name: vmSubnetNsgName\n  location: location\n  tags: tags\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowSshInbound'\n        properties: {\n          priority: 100\n          access: 'Allow'\n          direction: 'Inbound'\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '22'\n          sourceAddressPrefix: '*'          \n          destinationAddressPrefix: '*'\n        }\n      }\n      {\n        name: 'AllowRDP'\n        properties: {\n          priority: 101\n          access: 'Allow'\n          direction: 'Inbound'\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '3389'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n        }\n      }\n    ]\n  }\n}\n\n// NAT Gateway\nresource natGatewayPublicIp 'Microsoft.Network/publicIPAddresses@2023-04-01' =  [for i in range(0, natGatewayPublicIps): {\n  name: natGatewayPublicIps == 1 ? '${natGatewayName}PublicIp' : '${natGatewayName}PublicIp${i + 1}'\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  zones: !empty(natGatewayZones) ? natGatewayZones : []\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}]\n\nresource natGateway 'Microsoft.Network/natGateways@2023-11-01' = {\n  name: natGatewayName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  zones: !empty(natGatewayZones) ? natGatewayZones : []\n  properties: {\n    publicIpAddresses: [for i in range(0, natGatewayPublicIps): {\n      id: natGatewayPublicIp[i].id\n    }]\n    idleTimeoutInMinutes: natGatewayIdleTimeoutMins\n  }\n  dependsOn: [\n    natGatewayPublicIp\n  ]\n}\n\n// Azure Bastion Host\nresource bastionPublicIpAddress 'Microsoft.Network/publicIPAddresses@2023-04-01' = if (bastionHostEnabled) {\n  name: bastionPublicIpAddressName\n  location: location\n  tags: tags\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource bastionHost 'Microsoft.Network/bastionHosts@2023-04-01' = if (bastionHostEnabled) {\n  name: bastionHostName\n  location: location\n  tags: tags\n  sku: {\n    name: bastionHostSkuName\n  }\n  properties: {\n    disableCopyPaste: bastionHostDisableCopyPaste\n    enableFileCopy: bastionHostEnableFileCopy\n    enableIpConnect: bastionHostEnableIpConnect\n    enableShareableLink: bastionHostEnableShareableLink\n    enableTunneling: bastionHostEnableTunneling\n    ipConfigurations: [\n      {\n        name: 'IpConf'\n        properties: {\n          subnet: {\n            id: '${vnet.id}/subnets/${bastionSubnetName}'\n          }\n          publicIPAddress: {\n            id: bastionPublicIpAddress.id\n          }\n        }\n      }\n    ]\n  }\n}\n\n// Diagnostic Settings\nresource vmSubnetNsgDiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: diagnosticSettingsName\n  scope: vmSubnetNsg\n  properties: {\n    workspaceId: workspaceId\n    logs: nsgLogs\n  }\n}\n\nresource bastionSubnetNsgDiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = if (bastionHostEnabled) {\n  name: diagnosticSettingsName\n  scope: bastionSubnetNsg\n  properties: {\n    workspaceId: workspaceId\n    logs: nsgLogs\n  }\n}\n\nresource vnetDiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: diagnosticSettingsName\n  scope: vnet\n  properties: {\n    workspaceId: workspaceId\n    logs: vnetLogs\n    metrics: vnetMetrics\n  }\n}\n\nresource bastionDiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = if (bastionHostEnabled) {\n  name: diagnosticSettingsName\n  scope: bastionHost\n  properties: {\n    workspaceId: workspaceId\n    logs: bastionLogs\n    metrics: bastionMetrics\n  }\n}\n\n// Outputs\noutput virtualNetworkId string = vnet.id\noutput virtualNetworkName string = vnet.name\noutput vmSubnetId string = resourceId('Microsoft.Network/virtualNetworks/subnets', vnet.name, vmSubnetName)\noutput bastionSubnetId string = resourceId('Microsoft.Network/virtualNetworks/subnets', vnet.name, bastionSubnetName)\noutput vmSubnetName string = vmSubnetName\noutput bastionSubnetName string = bastionSubnetName"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1106."}, {"role": "assistant", "content": "// Execute this main file to depoy Azure AI studio resources in the basic security configuraiton\n\n// Parameters\n@minLength(2)\n@maxLength(12)\n@description('Name for the AI resource and used to derive name of dependent resources.')\nparam aiHubName string = 'demo'\n\n@description('Friendly name for your Azure AI resource')\nparam aiHubFriendlyName string = 'Demo AI resource'\n\n@description('Description of your Azure AI resource dispayed in AI studio')\nparam aiHubDescription string = 'This is an example AI resource for use in Azure AI Studio.'\n\n@description('Azure region used for the deployment of all resources.')\nparam location string = resourceGroup().location\n\n@description('Set of tags to apply to all resources.')\nparam tags object = {}\n\n@description('Specifies the customer managed keyvault Resource Manager ID.')\nparam cmk_keyvault_id string\n\n@description('Specifies the customer managed keyvault key uri.')\nparam cmk_keyvault_vault_uri string\n\n@description('Specifies the customer managed keyvault key uri.')\nparam cmk_keyvault_key_name string\n\n@description('Specifies the customer managed keyvault key version.')\nparam cmk_keyvault_key_version string\n\n// Variables\nvar name = toLower('${aiHubName}')\n\n// Create a short, unique suffix, that will be unique to each resource group\nvar uniqueSuffix = substring(uniqueString(resourceGroup().id), 0, 4) \n\nvar cmk_keyvault_key_uri = '${cmk_keyvault_vault_uri}keys/${cmk_keyvault_key_name}/${cmk_keyvault_key_version}'\n\n// Dependent resources for the Azure Machine Learning workspace\nmodule aiDependencies 'modules/dependent-resources.bicep' = {\n  name: 'dependencies-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    storageName: 'st${name}${uniqueSuffix}'\n    keyvaultName: 'kv-${name}-${uniqueSuffix}'\n    applicationInsightsName: 'appi-${name}-${uniqueSuffix}'\n    containerRegistryName: 'cr${name}${uniqueSuffix}'\n    aiServicesName: 'ais${name}${uniqueSuffix}'\n    cmk_keyvault_id: cmk_keyvault_id\n    cmk_keyvault_uri: cmk_keyvault_vault_uri\n    cmk_keyvault_key_name: cmk_keyvault_key_name\n    cmk_keyvault_key_version: cmk_keyvault_key_version\n    tags: tags\n  }\n}\n\nmodule aiHub 'modules/ai-hub.bicep' = {\n  name: 'ai-${name}-${uniqueSuffix}-deployment'\n  params: {\n    // workspace organization\n    aiHubName: 'aih-${name}-${uniqueSuffix}'\n    aiHubFriendlyName: aiHubFriendlyName\n    aiHubDescription: aiHubDescription\n    location: location\n    tags: tags\n\n    // dependent resources\n    aiServicesId: aiDependencies.outputs.aiservicesID\n    aiServicesTarget: aiDependencies.outputs.aiservicesTarget\n    applicationInsightsId: aiDependencies.outputs.applicationInsightsId\n    containerRegistryId: aiDependencies.outputs.containerRegistryId\n    keyVaultId: aiDependencies.outputs.keyvaultId\n    storageAccountId: aiDependencies.outputs.storageId\n\n    // encryption configuration\n    cmk_keyvault_id: cmk_keyvault_id\n    cmk_keyvault_key_uri: cmk_keyvault_key_uri\n  }\n}\n\noutput vaulturi string = cmk_keyvault_vault_uri\noutput keyuri string = cmk_keyvault_key_uri\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1107."}, {"role": "assistant", "content": "// Creates an Azure AI resource with proxied endpoints for the Azure AI services provider\n\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('AI hub name')\nparam aiHubName string\n\n@description('AI hub display name')\nparam aiHubFriendlyName string = aiHubName\n\n@description('AI hub description')\nparam aiHubDescription string\n\n@description('Resource ID of the application insights resource for storing diagnostics logs')\nparam applicationInsightsId string\n\n@description('Resource ID of the container registry resource for storing docker images')\nparam containerRegistryId string\n\n@description('Resource ID of the key vault resource for storing connection strings')\nparam keyVaultId string\n\n@description('Resource ID of the storage account resource for storing experimentation outputs')\nparam storageAccountId string\n\n@description('Resource ID of the AI Services resource')\nparam aiServicesId string\n\n@description('Resource ID of the AI Services endpoint')\nparam aiServicesTarget string\n\n@description('Specifies the customer managed keyvault Resource Manager ID.')\nparam cmk_keyvault_id string\n\n@description('Specifies the customer managed keyvault key uri.')\nparam cmk_keyvault_key_uri string\n\nresource aiHub 'Microsoft.MachineLearningServices/workspaces@2024-07-01-preview' = {\n  name: aiHubName\n  location: location\n  tags: tags\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    // organization\n    friendlyName: aiHubFriendlyName\n    description: aiHubDescription\n\n    // dependent resources\n    keyVault: keyVaultId\n    storageAccount: storageAccountId\n    applicationInsights: applicationInsightsId\n    containerRegistry: containerRegistryId\n\n    //encryption settings\n    encryption: {\n      status: 'Enabled'\n      keyVaultProperties: {\n        keyVaultArmId: cmk_keyvault_id\n        keyIdentifier: cmk_keyvault_key_uri\n      }\n    }\n    enableServiceSideCMKEncryption: true\n  }\n  kind: 'hub'\n\n  resource aiServicesConnection 'connections@2024-01-01-preview' = {\n    name: '${aiHubName}-connection-AzureOpenAI'\n    properties: {\n      category: 'AzureOpenAI'\n      target: aiServicesTarget\n      authType: 'ApiKey'\n      isSharedToAll: true\n      credentials: {\n        key: '${listKeys(aiServicesId, '2021-10-01').key1}'\n      }\n      metadata: {\n        ApiType: 'Azure'\n        ResourceId: aiServicesId\n      }\n    }\n  }\n}\n\noutput aiHubID string = aiHub.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1108 please."}, {"role": "assistant", "content": "// Creates Azure dependent resources for Azure AI studio\n\n@description('Azure region of the deployment')\nparam location string = resourceGroup().location\n\n@description('Tags to add to the resources')\nparam tags object = {}\n\n@description('AI services name')\nparam aiServicesName string\n\n@description('Application Insights resource name')\nparam applicationInsightsName string\n\n@description('Container registry name')\nparam containerRegistryName string\n\n@description('The name of the Key Vault')\nparam keyvaultName string\n\nvar containerRegistryNameCleaned = replace(containerRegistryName, '-', '')\n\n@description('Specifies the customer managed keyvault Resource Manager ID.')\nparam cmk_keyvault_id string\n\n@description('Specifies the customer managed keyvault key name.')\nparam cmk_keyvault_key_name string\n\n@description('Specifies the customer managed keyvault key version.')\nparam cmk_keyvault_key_version string\n\n@description('Specifies the customer managed keyvault key uri.')\nparam cmk_keyvault_uri string\n\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: location\n  tags: tags\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    DisableIpMasking: false\n    DisableLocalAuth: false\n    Flow_Type: 'Bluefield'\n    ForceCustomerStorageForProfiler: false\n    ImmediatePurgeDataOn30Days: true\n    IngestionMode: 'ApplicationInsights'\n    publicNetworkAccessForIngestion: 'Enabled'\n    publicNetworkAccessForQuery: 'Disabled'\n    Request_Source: 'rest'\n  }\n}\n\nresource containerRegistry 'Microsoft.ContainerRegistry/registries@2022-12-01' = {\n  name: containerRegistryNameCleaned\n  location: location\n  tags: tags\n  sku: {\n    name: 'Premium'\n  }\n  properties: {\n    adminUserEnabled: true\n    dataEndpointEnabled: false\n    networkRuleBypassOptions: 'AzureServices'\n    networkRuleSet: {\n      defaultAction: 'Deny'\n    }\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      retentionPolicy: {\n        status: 'enabled'\n        days: 7\n      }\n      trustPolicy: {\n        status: 'disabled'\n        type: 'Notary'\n      }\n    }\n    publicNetworkAccess: 'Disabled'\n    zoneRedundancy: 'Disabled'\n  }\n}\n\nresource keyVault 'Microsoft.KeyVault/vaults@2023-07-01' = {\n  name: keyvaultName\n  location: location\n  tags: tags\n  properties: {\n    createMode: 'default'\n    enabledForDeployment: false\n    enabledForDiskEncryption: false\n    enabledForTemplateDeployment: false\n    enableSoftDelete: true\n    enableRbacAuthorization: true\n    enablePurgeProtection: true\n    networkAcls: {\n      bypass: 'AzureServices'\n      defaultAction: 'Deny'\n    }\n    sku: {\n      family: 'A'\n      name: 'standard'\n    }\n    softDeleteRetentionInDays: 7\n    tenantId: subscription().tenantId\n  }\n}\n\n@description('Name of the storage account')\nparam storageName string\n\n@allowed([\n  'Standard_LRS'\n  'Standard_ZRS'\n  'Standard_GRS'\n  'Standard_GZRS'\n  'Standard_RAGRS'\n  'Standard_RAGZRS'\n  'Premium_LRS'\n  'Premium_ZRS'\n])\n\n@description('Storage SKU')\nparam storageSkuName string = 'Standard_LRS'\n\nvar storageNameCleaned = replace(storageName, '-', '')\n\nresource aiServices 'Microsoft.CognitiveServices/accounts@2023-05-01' = {\n  name: aiServicesName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'S0'\n  }\n  kind: 'AIServices'\n  properties: {\n    apiProperties: {\n      statisticsEnabled: false\n    }    \n    // optionally enable encryption for AI Services. Ensure the managed identity has wrap/unwrap permissions on the CMK key vault. \n    // encryption: {\n  //  keySource: 'Microsoft.KeyVault'\n  //  keyVaultProperties: {\n  //    keyVaultUri: cmk_keyvault_uri\n  //    keyName: cmk_keyvault_id\n  //    keyVersion: cmk_keyvault_key_version\n  //  }\n    // }\n  }\n}\n\nresource storage 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: storageNameCleaned\n  location: location\n  tags: tags\n  sku: {\n    name: storageSkuName\n  }\n  kind: 'StorageV2'\n  properties: {\n    accessTier: 'Hot'\n    allowBlobPublicAccess: false\n    allowCrossTenantReplication: false\n    allowSharedKeyAccess: true\n    encryption: {\n      keySource: 'Microsoft.Storage'\n      requireInfrastructureEncryption: false\n      services: {\n        blob: {\n          enabled: true\n          keyType: 'Account'\n        }\n        file: {\n          enabled: true\n          keyType: 'Account'\n        }\n        queue: {\n          enabled: true\n          keyType: 'Service'\n        }\n        table: {\n          enabled: true\n          keyType: 'Service'\n        }\n      }\n    }\n    isHnsEnabled: false\n    isNfsV3Enabled: false\n    keyPolicy: {\n      keyExpirationPeriodInDays: 7\n    }\n    largeFileSharesState: 'Disabled'\n    minimumTlsVersion: 'TLS1_2'\n    supportsHttpsTrafficOnly: true\n  }\n}\n\noutput aiservicesID string = aiServices.id\noutput aiservicesTarget string = aiServices.properties.endpoint\noutput storageId string = storage.id\noutput keyvaultId string = keyVault.id\noutput containerRegistryId string = containerRegistry.id\noutput applicationInsightsId string = applicationInsights.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1109?"}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Machine Learning workspace which will hold this data asset.')\nparam workspaceName string\n\n@description('Specifies the name of the data container asset.')\nparam dataContainerName string\n\n@description('Specifies the name of the data version.')\nparam dataVersionName string = '1'\n\n@description('Specifies the type of data: mltable, uri_file, or uri_folder.')\n@allowed([\n  'mltable'\n  'uri_file'\n  'uri_folder'\n])\nparam dataType string = 'uri_file'\n\n@description('Specifies a URI for the data, for testing purposes use: https://azbotstorage.blob.core.windows.net/sample-artifacts/yellow_tripdata_2022-04.parquet')\nparam dataUri string\n\n@description('Optional: Description of the data asset.')\nparam dataDescription string = 'Sample data asset'\n\n@description('Optional: Is the asset archived?')\nparam isArchived bool = false\n\nresource dc 'Microsoft.MachineLearningServices/workspaces/data@2022-05-01' = {\n  name: '${workspaceName}/${dataContainerName}'\n  properties: {\n    dataType: dataType\n    isArchived: isArchived\n  }\n}\n\nresource dv 'Microsoft.MachineLearningServices/workspaces/data/versions@2022-05-01' = {\n  name: '${workspaceName}/${dataContainerName}/${dataVersionName}'\n  dependsOn: [dc]\n  properties: {\n    dataType: dataType\n    dataUri: dataUri\n    isArchived: isArchived\n    description: dataDescription    \n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1110."}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Machine Learning workspace which will hold this data asset.')\nparam workspaceName string\n\n@description('Specifies the name of the data container asset.')\nparam dataContainerName string\n\n@description('Specifies the name of the data version.')\nparam dataVersionName string\n\n@description('Specifies the type of data: mltable, uri_file, or uri_folder.')\n@allowed([\n  'mltable'\n  'uri_file'\n  'uri_folder'\n])\nparam dataType string = 'uri_file'\n\n@description('Specifies a URI for the data, for testing purposes use: https://azbotstorage.blob.core.windows.net/sample-artifacts/yellow_tripdata_2022-04.parquet')\nparam dataUri string\n\n@description('Optional: Description of the data asset.')\nparam dataDescription string = 'Sample data asset'\n\n@description('Optional: Is the asset archived?')\nparam isArchived bool = false\n\nresource dv 'Microsoft.MachineLearningServices/workspaces/data/versions@2022-05-01' = {\n  name: '${workspaceName}/${dataContainerName}/${dataVersionName}'\n  properties: {\n    dataType: dataType\n    dataUri: dataUri\n    isArchived: isArchived\n    description: dataDescription    \n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1111?"}, {"role": "assistant", "content": "// Execute this main file to configure Azure Machine Learning end-to-end in a moderately secure set up\n\n// Parameters\n@minLength(2)\n@maxLength(10)\n@description('Prefix for all resource names.')\nparam prefix string\n\n@description('Azure region used for the deployment of all resources.')\nparam location string = resourceGroup().location\n\n@description('Set of tags to apply to all resources.')\nparam tags object = {}\n\n@description('Virtual network address prefix')\nparam vnetAddressPrefix string = '192.168.0.0/16'\n\n@description('Training subnet address prefix')\nparam trainingSubnetPrefix string = '192.168.0.0/24'\n\n@description('Scoring subnet address prefix')\nparam scoringSubnetPrefix string = '192.168.1.0/24'\n\n@description('Bastion subnet address prefix')\nparam azureBastionSubnetPrefix string = '192.168.250.0/27'\n\n@description('Deploy a Bastion jumphost to access the network-isolated environment?')\nparam deployJumphost bool = true\n\n@description('Jumphost virtual machine username')\nparam dsvmJumpboxUsername string\n\n@secure()\n@minLength(8)\n@description('Jumphost virtual machine password')\nparam dsvmJumpboxPassword string\n\n@description('Enable public IP for Azure Machine Learning compute nodes')\nparam amlComputePublicIp bool = true\n\n@description('VM size for the default compute cluster')\nparam amlComputeDefaultVmSize string = 'Standard_DS3_v2'\n\n// Variables\nvar name = toLower('${prefix}')\n\n// Create a short, unique suffix, that will be unique to each resource group\nvar uniqueSuffix = substring(uniqueString(resourceGroup().id), 0, 4)\n\n// Virtual network and network security group\nmodule nsg 'modules/nsg.bicep' = { \n  name: 'nsg-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    tags: tags \n    nsgName: 'nsg-${name}-${uniqueSuffix}'\n  }\n}\n\nmodule vnet 'modules/vnet.bicep' = { \n  name: 'vnet-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    virtualNetworkName: 'vnet-${name}-${uniqueSuffix}'\n    networkSecurityGroupId: nsg.outputs.networkSecurityGroup\n    vnetAddressPrefix: vnetAddressPrefix\n    trainingSubnetPrefix: trainingSubnetPrefix\n    scoringSubnetPrefix: scoringSubnetPrefix\n    tags: tags\n  }\n}\n\n// Dependent resources for the Azure Machine Learning workspace\nmodule keyvault 'modules/keyvault.bicep' = {\n  name: 'kv-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    keyvaultName: 'kv-${name}-${uniqueSuffix}'\n    keyvaultPleName: 'ple-${name}-${uniqueSuffix}-kv'\n    subnetId: '${vnet.outputs.id}/subnets/snet-training'\n    virtualNetworkId: vnet.outputs.id\n    tags: tags\n  }\n}\n\nmodule storage 'modules/storage.bicep' = {\n  name: 'st${name}${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    storageName: 'st${name}${uniqueSuffix}'\n    storagePleBlobName: 'ple-${name}-${uniqueSuffix}-st-blob'\n    storagePleFileName: 'ple-${name}-${uniqueSuffix}-st-file'\n    storageSkuName: 'Standard_LRS'\n    subnetId: '${vnet.outputs.id}/subnets/snet-training'\n    virtualNetworkId: vnet.outputs.id\n    tags: tags\n  }\n}\n\nmodule containerRegistry 'modules/containerregistry.bicep' = {\n  name: 'cr${name}${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    containerRegistryName: 'cr${name}${uniqueSuffix}'\n    containerRegistryPleName: 'ple-${name}-${uniqueSuffix}-cr'\n    subnetId: '${vnet.outputs.id}/subnets/snet-training'\n    virtualNetworkId: vnet.outputs.id\n    tags: tags\n  }\n}\n\nmodule applicationInsights 'modules/applicationinsights.bicep' = {\n  name: 'appi-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    applicationInsightsName: 'appi-${name}-${uniqueSuffix}'\n    logAnalyticsWorkspaceName: 'ws-${name}-${uniqueSuffix}'\n    tags: tags\n  }\n}\n\nmodule azuremlWorkspace 'modules/machinelearning.bicep' = {\n  name: 'mlw-${name}-${uniqueSuffix}-deployment'\n  params: {\n    // workspace organization\n    machineLearningName: 'mlw-${name}-${uniqueSuffix}'\n    machineLearningFriendlyName: 'Private link endpoint sample workspace'\n    machineLearningDescription: 'This is an example workspace having a private link endpoint.'\n    location: location\n    prefix: name\n    tags: tags\n\n    // dependent resources\n    applicationInsightsId: applicationInsights.outputs.applicationInsightsId\n    containerRegistryId: containerRegistry.outputs.containerRegistryId\n    keyVaultId: keyvault.outputs.keyvaultId\n    storageAccountId: storage.outputs.storageId\n\n    // networking\n    subnetId: '${vnet.outputs.id}/subnets/snet-training'\n    computeSubnetId: '${vnet.outputs.id}/subnets/snet-training'\n    aksSubnetId: '${vnet.outputs.id}/subnets/snet-scoring'\n    virtualNetworkId: vnet.outputs.id\n    machineLearningPleName: 'ple-${name}-${uniqueSuffix}-mlw'\n\n    // compute\n    amlComputePublicIp: amlComputePublicIp\n    mlAksName: 'aks-${name}-${uniqueSuffix}'\n    vmSizeParam: amlComputeDefaultVmSize\n  }\n  dependsOn: [\n    keyvault\n    containerRegistry\n    applicationInsights\n    storage\n  ]\n}\n\n// Optional VM and Bastion jumphost to help access the network isolated environment\nmodule dsvm 'modules/dsvmjumpbox.bicep' = if (deployJumphost) {\n  name: 'vm-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    virtualMachineName: 'vm-${name}-${uniqueSuffix}'\n    subnetId: '${vnet.outputs.id}/subnets/snet-training'\n    adminUsername: dsvmJumpboxUsername\n    adminPassword: dsvmJumpboxPassword\n    networkSecurityGroupId: nsg.outputs.networkSecurityGroup\n    vmSizeParameter: amlComputeDefaultVmSize\n  }\n}\n\nmodule bastion 'modules/bastion.bicep' = if (deployJumphost) {\n  name: 'bas-${name}-${uniqueSuffix}-deployment'\n  params: {\n    bastionHostName: 'bas-${name}-${uniqueSuffix}'\n    location: location\n    vnetName: vnet.outputs.name\n    addressPrefix: azureBastionSubnetPrefix\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1112."}, {"role": "assistant", "content": "// Creates an Application Insights instance as dependency for Azure ML\n@description('Azure region of the deployment')\nparam location string = resourceGroup().location\n\n@description('Tags to add to the resources')\nparam tags object = {}\n\n@description('Application Insights resource name')\nparam applicationInsightsName string\n\n@description('Log Analytics resource name')\nparam logAnalyticsWorkspaceName string \n\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2021-06-01' = {\n  name: logAnalyticsWorkspaceName\n  location: location\n  properties: {\n    sku: {\n      name: 'PerGB2018'\n    }\n    retentionInDays: 30\n    publicNetworkAccessForIngestion: 'Enabled'\n    publicNetworkAccessForQuery: 'Disabled'\n  }\n}\n\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: location\n  tags: tags\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    WorkspaceResourceId: logAnalyticsWorkspace.id\n    Flow_Type: 'Bluefield'\n  }\n}\n\noutput applicationInsightsId string = applicationInsights.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1113."}, {"role": "assistant", "content": "// Creates an Azure Bastion Subnet and host in the specified virtual network\n@description('The Azure region where the Bastion should be deployed')\nparam location string = resourceGroup().location\n\n@description('Virtual network name')\nparam vnetName string\n\n@description('The address prefix to use for the Bastion subnet')\nparam addressPrefix string = '192.168.250.0/27'\n\n@description('The name of the Bastion public IP address')\nparam publicIpName string = 'pip-bastion'\n\n@description('The name of the Bastion host')\nparam bastionHostName string = 'bastion-jumpbox'\n\n// The Bastion Subnet is required to be named 'AzureBastionSubnet'\nvar subnetName = 'AzureBastionSubnet'\n\nresource bastionSubnet 'Microsoft.Network/virtualNetworks/subnets@2022-01-01' = {\n  name: '${vnetName}/${subnetName}'\n  properties: {\n    addressPrefix: addressPrefix\n    privateEndpointNetworkPolicies: 'Disabled'\n    privateLinkServiceNetworkPolicies: 'Disabled'\n  }\n}\n\nresource publicIpAddressForBastion 'Microsoft.Network/publicIPAddresses@2022-01-01' = {\n  name: publicIpName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource bastionHost 'Microsoft.Network/bastionHosts@2022-01-01' = {\n  name: bastionHostName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'IpConf'\n        properties: {\n          subnet: {\n            id: bastionSubnet.id\n          }\n          publicIPAddress: {\n            id: publicIpAddressForBastion.id\n          }\n        }\n      }\n    ]\n  }\n}\n\noutput bastionId string = bastionHost.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1114?"}, {"role": "assistant", "content": "// Creates an Azure Container Registry with Azure Private Link endpoint\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Container registry name')\nparam containerRegistryName string\n\n@description('Container registry private link endpoint name')\nparam containerRegistryPleName string\n\n@description('Resource ID of the subnet')\nparam subnetId string\n\n@description('Resource ID of the virtual network')\nparam virtualNetworkId string\n\nvar containerRegistryNameCleaned = replace(containerRegistryName, '-', '')\n\nvar privateDnsZoneName = 'privatelink${environment().suffixes.acrLoginServer}'\n\nvar groupName = 'registry' \n\nresource containerRegistry 'Microsoft.ContainerRegistry/registries@2021-09-01' = {\n  name: containerRegistryNameCleaned\n  location: location\n  tags: tags\n  sku: {\n    name: 'Premium'\n  }\n  properties: {\n    adminUserEnabled: true\n    dataEndpointEnabled: false\n    networkRuleBypassOptions: 'AzureServices'\n    networkRuleSet: {\n      defaultAction: 'Deny'\n    }\n    policies: {\n      quarantinePolicy: {\n        status: 'disabled'\n      }\n      retentionPolicy: {\n        status: 'enabled'\n        days: 7\n      }\n      trustPolicy: {\n        status: 'disabled'\n        type: 'Notary'\n      }\n    }\n    publicNetworkAccess: 'Disabled'\n    zoneRedundancy: 'Disabled'\n  }\n}\n\nresource containerRegistryPrivateEndpoint 'Microsoft.Network/privateEndpoints@2022-01-01' = {\n  name: containerRegistryPleName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: containerRegistryPleName\n        properties: {\n          groupIds: [\n            groupName\n          ]\n          privateLinkServiceId: containerRegistry.id\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource acrPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDnsZoneName\n  location: 'global'\n}\n\nresource privateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-01-01' = {\n  name: '${containerRegistryPrivateEndpoint.name}/${groupName}-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: privateDnsZoneName\n        properties:{\n          privateDnsZoneId: acrPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource acrPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${acrPrivateDnsZone.name}/${uniqueString(containerRegistry.id)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\noutput containerRegistryId string = containerRegistry.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1115."}, {"role": "assistant", "content": "// Creates a Data Science Virtual Machine jumpbox.\n@description('Azure region of the deployment')\nparam location string = resourceGroup().location\n\n@description('Resource ID of the subnet')\nparam subnetId string\n\n@description('Network Security Group Resource ID')\nparam networkSecurityGroupId string\n\n@description('Virtual machine name')\nparam virtualMachineName string\n\n@description('Virtual machine size')\nparam vmSizeParameter string\n\n@description('Virtual machine admin username')\nparam adminUsername string\n\n@secure()\n@minLength(8)\n@description('Virtual machine admin password')\nparam adminPassword string\n\nvar aadLoginExtensionName = 'AADLoginForWindows'\n\nresource networkInterface 'Microsoft.Network/networkInterfaces@2022-07-01' = {\n  name: '${virtualMachineName}-nic'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          subnet: {\n            id: subnetId\n          }\n          privateIPAllocationMethod: 'Dynamic'\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: networkSecurityGroupId\n    }\n  }\n}\n\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2021-03-01' = {\n  name: virtualMachineName\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSizeParameter\n    }\n    storageProfile: {\n      osDisk: {\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n      }\n      imageReference: {\n        publisher: 'microsoft-dsvm'\n        offer: 'dsvm-win-2019'\n        sku: 'server-2019'\n        version: 'latest'\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkInterface.id\n        }\n      ]\n    }\n    osProfile: {\n      computerName: virtualMachineName\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        enableAutomaticUpdates: true\n        provisionVMAgent: true\n        patchSettings: {\n          enableHotpatching: false\n          patchMode: 'AutomaticByOS'\n        }\n      }\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n      }\n    }\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n}\n\nresource virtualMachineName_aadLoginExtensionName 'Microsoft.Compute/virtualMachines/extensions@2021-11-01' = {\n  name: '${virtualMachine.name}/${aadLoginExtensionName}'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.ActiveDirectory'\n    type: aadLoginExtensionName\n    typeHandlerVersion: '1.0'\n    autoUpgradeMinorVersion: true\n  }\n}\n\noutput dsvmId string = virtualMachine.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1116."}, {"role": "assistant", "content": "// Creates a KeyVault with Private Link Endpoint\n@description('The Azure Region to deploy the resources into')\nparam location string = resourceGroup().location\n\n@description('Tags to apply to the Key Vault Instance')\nparam tags object = {}\n\n@description('The name of the Key Vault')\nparam keyvaultName string\n\n@description('The name of the Key Vault private link endpoint')\nparam keyvaultPleName string\n\n@description('The Subnet ID where the Key Vault Private Link is to be created')\nparam subnetId string\n\n@description('The VNet ID where the Key Vault Private Link is to be created')\nparam virtualNetworkId string\n\nvar privateDnsZoneName = 'privatelink${environment().suffixes.keyvaultDns}'\n\nresource keyVault 'Microsoft.KeyVault/vaults@2021-10-01' = {\n  name: keyvaultName\n  location: location\n  tags: tags\n  properties: {\n    createMode: 'default'\n    enabledForDeployment: false\n    enabledForDiskEncryption: false\n    enabledForTemplateDeployment: false\n    enableSoftDelete: true\n    enableRbacAuthorization: true\n    enablePurgeProtection: true\n    networkAcls: {\n      bypass: 'AzureServices'\n      defaultAction: 'Deny'\n    }\n    sku: {\n      family: 'A'\n      name: 'standard'\n    }\n    softDeleteRetentionInDays: 7\n    tenantId: subscription().tenantId\n  }\n}\n\nresource keyVaultPrivateEndpoint 'Microsoft.Network/privateEndpoints@2022-01-01' = {\n  name: keyvaultPleName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: keyvaultPleName\n        properties: {\n          groupIds: [\n            'vault'\n          ]\n          privateLinkServiceId: keyVault.id\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource keyVaultPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDnsZoneName\n  location: 'global'\n}\n\nresource privateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-01-01' = {\n  name: '${keyVaultPrivateEndpoint.name}/vault-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: privateDnsZoneName\n        properties:{\n          privateDnsZoneId: keyVaultPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource keyVaultPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${keyVaultPrivateDnsZone.name}/${uniqueString(keyVault.id)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\noutput keyvaultId string = keyVault.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1117."}, {"role": "assistant", "content": "// Creates a machine learning workspace, private endpoints and compute resources\n// Compute resources include a GPU cluster, CPU cluster, compute instance and attached private AKS cluster\n@description('Prefix for resource names')\nparam prefix string\n\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Machine learning workspace name')\nparam machineLearningName string\n\n@description('Machine learning workspace display name')\nparam machineLearningFriendlyName string = machineLearningName\n\n@description('Machine learning workspace description')\nparam machineLearningDescription string\n\n@description('Name of the Azure Kubernetes services resource to create and attached to the machine learning workspace')\nparam mlAksName string\n\n@description('Resource ID of the application insights resource')\nparam applicationInsightsId string\n\n@description('Resource ID of the container registry resource')\nparam containerRegistryId string\n\n@description('Resource ID of the key vault resource')\nparam keyVaultId string\n\n@description('Resource ID of the storage account resource')\nparam storageAccountId string\n\n@description('Resource ID of the subnet resource')\nparam subnetId string\n\n@description('Resource ID of the compute subnet')\nparam computeSubnetId string\n\n@description('Resource ID of the Azure Kubernetes services resource')\nparam aksSubnetId string\n\n@description('Resource ID of the virtual network')\nparam virtualNetworkId string\n\n@description('Machine learning workspace private link endpoint name')\nparam machineLearningPleName string\n\n@description('Enable public IP for Azure Machine Learning compute nodes')\nparam amlComputePublicIp bool = true\n\n@description('VM size for the default compute cluster')\nparam vmSizeParam string\n \nresource machineLearning 'Microsoft.MachineLearningServices/workspaces@2022-05-01' = {\n  name: machineLearningName\n  location: location\n  tags: tags\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    // workspace organization\n    friendlyName: machineLearningFriendlyName\n    description: machineLearningDescription\n\n    // dependent resources\n    applicationInsights: applicationInsightsId\n    containerRegistry: containerRegistryId\n    keyVault: keyVaultId\n    storageAccount: storageAccountId\n\n    // configuration for workspaces with private link endpoint\n    imageBuildCompute: 'cluster001'\n    publicNetworkAccess: 'Disabled'\n  }\n}\n\nmodule machineLearningPrivateEndpoint 'machinelearningnetworking.bicep' = {\n  name: 'machineLearningNetworking'\n  scope: resourceGroup()\n  params: {\n    location: location\n    tags: tags\n    virtualNetworkId: virtualNetworkId\n    workspaceArmId: machineLearning.id\n    subnetId: subnetId\n    machineLearningPleName: machineLearningPleName\n  }\n}\n\nmodule machineLearningCompute 'machinelearningcompute.bicep' = {\n  name: 'machineLearningComputes'\n  scope: resourceGroup()\n  params: {\n    machineLearning: machineLearningName\n    location: location\n    computeSubnetId:computeSubnetId\n    aksName: mlAksName\n    aksSubnetId: aksSubnetId\n    prefix: prefix\n    tags: tags\n    amlComputePublicIp: amlComputePublicIp\n    vmSizeParam: vmSizeParam\n  }\n  dependsOn: [\n    machineLearning\n    machineLearningPrivateEndpoint\n  ]\n}\n\noutput machineLearningId string = machineLearning.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1118 please."}, {"role": "assistant", "content": "// Creates compute resources in the specified machine learning workspace\n// Includes Compute Instance, Compute Cluster and attached Azure Kubernetes Service compute types\n@description('Prefix for resource names')\nparam prefix string\n\n@description('Azure Machine Learning workspace to create the compute resources in')\nparam machineLearning string\n\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Resource ID of the compute subnet')\nparam computeSubnetId string\n\n@description('Name of the Azure Kubernetes services resource')\nparam aksName string\n\n@description('Resource ID of the Azure Kubernetes services resource')\nparam aksSubnetId string\n\n@description('Resource ID of the Azure Kubernetes services resource')\nparam amlComputePublicIp bool\n\n@description('VM size for the default compute cluster')\nparam vmSizeParam string\n\nresource machineLearningCluster001 'Microsoft.MachineLearningServices/workspaces/computes@2022-05-01' = {\n  name: '${machineLearning}/cluster001'\n  location: location\n  tags: tags\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    computeType: 'AmlCompute'\n    computeLocation: location\n    description: 'Machine Learning cluster 001'\n    disableLocalAuth: true\n    properties: {\n      vmPriority: 'Dedicated'\n      vmSize: vmSizeParam\n      enableNodePublicIp: amlComputePublicIp\n      isolatedNetwork: false\n      osType: 'Linux'\n      remoteLoginPortPublicAccess: 'Disabled'\n      scaleSettings: {\n        minNodeCount: 0\n        maxNodeCount: 5\n        nodeIdleTimeBeforeScaleDown: 'PT120S'\n      }\n      subnet: {\n        id: computeSubnetId\n      }\n    }\n  }\n}\n\nresource machineLearningComputeInstance001 'Microsoft.MachineLearningServices/workspaces/computes@2022-05-01' = {\n  name: '${machineLearning}/${prefix}-ci001'\n  location: location\n  tags: tags\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    computeType: 'ComputeInstance'\n    computeLocation: location\n    description: 'Machine Learning compute instance 001'\n    disableLocalAuth: true\n    properties: {\n      applicationSharingPolicy: 'Personal'\n      \n      computeInstanceAuthorizationType: 'personal'\n      sshSettings: {\n        sshPublicAccess: 'Disabled'\n      }\n      subnet: {\n        id: computeSubnetId\n      }\n      vmSize: vmSizeParam\n    }\n  }\n}\n\nmodule machineLearningAksCompute 'privateaks.bicep' = {\n  name: aksName\n  scope: resourceGroup()\n  params: {\n    location: location\n    tags: tags\n    aksClusterName: aksName\n    computeName: aksName\n    aksSubnetId: aksSubnetId\n    workspaceName: machineLearning\n    vmSizeParam: vmSizeParam\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1119?"}, {"role": "assistant", "content": "// Creates private endpoints and DNS zones for the azure machine learning workspace\n@description('Azure region of the deployment')\nparam location string\n\n@description('Machine learning workspace private link endpoint name')\nparam machineLearningPleName string\n\n@description('Resource ID of the virtual network resource')\nparam virtualNetworkId string\n\n@description('Resource ID of the subnet resource')\nparam subnetId string\n\n@description('Resource ID of the machine learning workspace')\nparam workspaceArmId string\n\n@description('Tags to add to the resources')\nparam tags object\n\nvar privateDnsZoneName =  {\n  azureusgovernment: 'privatelink.api.ml.azure.us'\n  azurechinacloud: 'privatelink.api.ml.azure.cn'\n  azurecloud: 'privatelink.api.azureml.ms'\n}\n\nvar privateAznbDnsZoneName = {\n    azureusgovernment: 'privatelink.notebooks.usgovcloudapi.net'\n    azurechinacloud: 'privatelink.notebooks.chinacloudapi.cn'\n    azurecloud: 'privatelink.notebooks.azure.net'\n}\n\nresource machineLearningPrivateEndpoint 'Microsoft.Network/privateEndpoints@2022-01-01' = {\n  name: machineLearningPleName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: machineLearningPleName\n        properties: {\n          groupIds: [\n            'amlworkspace'\n          ]\n          privateLinkServiceId: workspaceArmId\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource amlPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDnsZoneName[toLower(environment().name)]\n  location: 'global'\n}\n\nresource amlPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${amlPrivateDnsZone.name}/${uniqueString(workspaceArmId)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\n// Notebook\nresource notebookPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateAznbDnsZoneName[toLower(environment().name)]\n  location: 'global'\n}\n\nresource notebookPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${notebookPrivateDnsZone.name}/${uniqueString(workspaceArmId)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\nresource privateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-01-01' = {\n  name: '${machineLearningPrivateEndpoint.name}/amlworkspace-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: privateDnsZoneName[environment().name]\n        properties:{\n          privateDnsZoneId: amlPrivateDnsZone.id\n        }\n      }\n      {\n        name: privateAznbDnsZoneName[environment().name]\n        properties:{\n          privateDnsZoneId: notebookPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1120."}, {"role": "assistant", "content": "// Creates a network security group preconfigured for use with Azure ML\n// To learn more, see https://docs.microsoft.com/en-us/azure/machine-learning/how-to-access-azureml-behind-firewall\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Name of the network security group')\nparam nsgName string\n\nresource nsg 'Microsoft.Network/networkSecurityGroups@2022-01-01' = {\n  name: nsgName\n  location: location\n  tags: tags\n  properties: {\n    securityRules: [\n      {\n        name: 'BatchNodeManagement'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '29876-29877'\n          sourceAddressPrefix: 'BatchNodeManagement'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 120\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AzureMachineLearning'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '44224'\n          sourceAddressPrefix: 'AzureMachineLearning'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 130\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AzureActiveDirectory'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'AzureActiveDirectory'\n          access: 'Allow'\n          priority: 140\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AzureMachineLearningOutbound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'AzureMachineLearning'\n          access: 'Allow'\n          priority: 150\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AzureResourceManager'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'AzureResourceManager'\n          access: 'Allow'\n          priority: 160\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AzureStorageAccount'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'Storage.${location}'\n          access: 'Allow'\n          priority: 170\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AzureFrontDoor'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'AzureFrontDoor.FrontEnd'\n          access: 'Allow'\n          priority: 180\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AzureContainerRegistry'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'AzureContainerRegistry.${location}'\n          access: 'Allow'\n          priority: 190\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'MicrosoftContainerRegistry'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationAddressPrefix: 'MicrosoftContainerRegistry'\n          access: 'Allow'\n          priority: 200\n          direction: 'Outbound'\n        }\n      }\n    ]\n  }\n}\n\noutput networkSecurityGroup string = nsg.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1121?"}, {"role": "assistant", "content": "// Creates an Azure Kubernetes Services and attaches it to the Azure Machine Learning workspace\n@description('Name of the Azure Kubernetes Service cluster')\nparam aksClusterName string\n\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Resource ID for the Azure Kubernetes Service subnet')\nparam aksSubnetId string\n\n@description('Name of the Azure Machine Learning workspace')\nparam workspaceName string\n\n@description('Name of the Azure Machine Learning attached compute')\nparam computeName string\n\n@description('Size of the virtual machine')\nparam vmSizeParam string // = 'Standard_DS2_v2'\n\nresource aksCluster 'Microsoft.ContainerService/managedClusters@2022-04-01' = {\n  name: aksClusterName\n  location: location\n  tags: tags\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    kubernetesVersion: '1.27.1'\n    dnsPrefix: '${aksClusterName}-dns'\n    agentPoolProfiles: [\n      {\n        name: toLower('agentpool')\n        count: 3\n        vmSize: vmSizeParam\n        osDiskSizeGB: 128\n        vnetSubnetID: aksSubnetId\n        maxPods: 110\n        osType: 'Linux'\n        mode: 'System'\n        type: 'VirtualMachineScaleSets'\n      }\n    ]\n    enableRBAC: true\n    networkProfile: {\n      networkPlugin: 'kubenet'\n      serviceCidr: '10.0.0.0/16'\n      dnsServiceIP: '10.0.0.10'\n      dockerBridgeCidr: '172.17.0.1/16'\n      loadBalancerSku: 'standard'\n    }\n    apiServerAccessProfile: {\n      enablePrivateCluster: true\n    }\n  }\n}\n\noutput aksResourceId string = aksCluster.id\n\nresource workspaceName_computeName 'Microsoft.MachineLearningServices/workspaces/computes@2022-05-01' = {\n  name: '${workspaceName}/${computeName}'\n  location: location\n  properties: {\n    computeType: 'AKS'\n    resourceId: aksCluster.id\n    properties: {\n      aksNetworkingConfiguration:  {\n        subnetId: aksSubnetId\n      }\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1122."}, {"role": "assistant", "content": "// Creates a storage account, private endpoints and DNS zones\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Name of the storage account')\nparam storageName string\n\n@description('Name of the storage blob private link endpoint')\nparam storagePleBlobName string\n\n@description('Name of the storage file private link endpoint')\nparam storagePleFileName string\n\n@description('Resource ID of the subnet')\nparam subnetId string\n\n@description('Resource ID of the virtual network')\nparam virtualNetworkId string\n\n@allowed([\n  'Standard_LRS'\n  'Standard_ZRS'\n  'Standard_GRS'\n  'Standard_GZRS'\n  'Standard_RAGRS'\n  'Standard_RAGZRS'\n  'Premium_LRS'\n  'Premium_ZRS'\n])\n\n@description('Storage SKU')\nparam storageSkuName string = 'Standard_LRS'\n\nvar storageNameCleaned = replace(storageName, '-', '')\n\nvar blobPrivateDnsZoneName = 'privatelink.blob.${environment().suffixes.storage}'\n\nvar filePrivateDnsZoneName = 'privatelink.file.${environment().suffixes.storage}'\n\nresource storage 'Microsoft.Storage/storageAccounts@2021-09-01' = {\n  name: storageNameCleaned\n  location: location\n  tags: tags\n  sku: {\n    name: storageSkuName\n  }\n  kind: 'StorageV2'\n  properties: {\n    accessTier: 'Hot'\n    allowBlobPublicAccess: false\n    allowCrossTenantReplication: false\n    allowSharedKeyAccess: true\n    encryption: {\n      keySource: 'Microsoft.Storage'\n      requireInfrastructureEncryption: false\n      services: {\n        blob: {\n          enabled: true\n          keyType: 'Account'\n        }\n        file: {\n          enabled: true\n          keyType: 'Account'\n        }\n        queue: {\n          enabled: true\n          keyType: 'Service'\n        }\n        table: {\n          enabled: true\n          keyType: 'Service'\n        }\n      }\n    }\n    isHnsEnabled: false\n    isNfsV3Enabled: false\n    keyPolicy: {\n      keyExpirationPeriodInDays: 7\n    }\n    largeFileSharesState: 'Disabled'\n    minimumTlsVersion: 'TLS1_2'\n    networkAcls: {\n      bypass: 'AzureServices'\n      defaultAction: 'Deny'\n    }\n    supportsHttpsTrafficOnly: true\n  }\n}\n\nresource storagePrivateEndpointBlob 'Microsoft.Network/privateEndpoints@2022-01-01' = {\n  name: storagePleBlobName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      { \n        name: storagePleBlobName\n        properties: {\n          groupIds: [\n            'blob'\n          ]\n          privateLinkServiceId: storage.id\n          privateLinkServiceConnectionState: {\n            status: 'Approved'\n            description: 'Auto-Approved'\n            actionsRequired: 'None'\n          }\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource storagePrivateEndpointFile 'Microsoft.Network/privateEndpoints@2022-01-01' = {\n  name: storagePleFileName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: storagePleFileName\n        properties: {\n          groupIds: [\n            'file'\n          ]\n          privateLinkServiceId: storage.id\n          privateLinkServiceConnectionState: {\n            status: 'Approved'\n            description: 'Auto-Approved'\n            actionsRequired: 'None'\n          }\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource blobPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: blobPrivateDnsZoneName\n  location: 'global'\n}\n\nresource privateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-01-01' = {\n  name: '${storagePrivateEndpointBlob.name}/blob-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: blobPrivateDnsZoneName\n        properties:{\n          privateDnsZoneId: blobPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource blobPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${blobPrivateDnsZone.name}/${uniqueString(storage.id)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\nresource filePrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: filePrivateDnsZoneName\n  location: 'global'\n}\n\nresource filePrivateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-01-01' = {\n  name: '${storagePrivateEndpointFile.name}/flie-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: filePrivateDnsZoneName\n        properties:{\n          privateDnsZoneId: filePrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource filePrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${filePrivateDnsZone.name}/${uniqueString(storage.id)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\noutput storageId string = storage.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1123."}, {"role": "assistant", "content": "// Creates a virtual network\n@description('Azure region of the deployment')\nparam location string = resourceGroup().location\n\n@description('Tags to add to the resources')\nparam tags object = {}\n\n@description('Name of the virtual network resource')\nparam virtualNetworkName string\n\n@description('Group ID of the network security group')\nparam networkSecurityGroupId string\n\n@description('Virtual network address prefix')\nparam vnetAddressPrefix string = '192.168.0.0/16'\n\n@description('Training subnet address prefix')\nparam trainingSubnetPrefix string = '192.168.0.0/24'\n\n@description('Scoring subnet address prefix')\nparam scoringSubnetPrefix string = '192.168.1.0/24'\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-01-01' = {\n  name: virtualNetworkName\n  location: location\n  tags: tags\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      { \n        name: 'snet-training'\n        properties: {\n          addressPrefix: trainingSubnetPrefix\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Disabled'\n          networkSecurityGroup: {\n            id: networkSecurityGroupId\n          }\n        }\n      }\n      { \n        name: 'snet-scoring'\n        properties: {\n          addressPrefix: scoringSubnetPrefix\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Disabled'\n          serviceEndpoints: [\n            {\n              service: 'Microsoft.KeyVault'\n            }\n            {\n              service: 'Microsoft.ContainerRegistry'\n            }\n            {\n              service: 'Microsoft.Storage'\n            }\n          ]\n          networkSecurityGroup: {\n            id: networkSecurityGroupId\n          }\n        }\n      }\n    ]\n  }\n}\n\noutput id string = virtualNetwork.id\noutput name string = virtualNetwork.name\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1124?"}, {"role": "assistant", "content": "// Execute this main file to configure Azure Machine Learning end-to-end in a moderately secure set up.\n\n// Parameters\n@minLength(2)\n@maxLength(10)\n@description('Prefix for all resource names.')\nparam prefix string\n\n@description('Azure region used for the deployment of all resources.')\nparam location string = resourceGroup().location\n\n@description('Set of tags to apply to all resources.')\nparam tags object = {}\n\n@description('Virtual network address prefix')\nparam vnetAddressPrefix string = '192.168.0.0/16'\n\n@description('Training subnet address prefix')\nparam trainingSubnetPrefix string = '192.168.0.0/24'\n\n@description('Scoring subnet address prefix')\nparam scoringSubnetPrefix string = '192.168.1.0/24'\n\n@description('Bastion subnet address prefix')\nparam azureBastionSubnetPrefix string = '192.168.250.0/27'\n\n@description('Deploy a Bastion jumphost to access the network-isolated environment?')\nparam deployJumphost bool = true\n\n@description('Jumphost virtual machine username')\nparam dsvmJumpboxUsername string\n\n@secure()\n@minLength(8)\n@description('Jumphost virtual machine password')\nparam dsvmJumpboxPassword string\n\n@description('Enable public IP for Azure Machine Learning compute nodes')\nparam amlComputePublicIp bool = true\n\n@description('VM size for the default compute cluster')\nparam amlComputeDefaultVmSize string = 'Standard_DS3_v2'\n\n// Variables\nvar name = toLower('${prefix}')\n\n// Create a short, unique suffix, that will be unique to each resource group\nvar uniqueSuffix = substring(uniqueString(resourceGroup().id), 0, 4)\n\n// Virtual network and network security group\nmodule nsg 'modules/nsg.bicep' = { \n  name: 'nsg-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    tags: tags \n    nsgName: 'nsg-${name}-${uniqueSuffix}'\n  }\n}\n\nmodule vnet 'modules/vnet.bicep' = { \n  name: 'vnet-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    virtualNetworkName: 'vnet-${name}-${uniqueSuffix}'\n    networkSecurityGroupId: nsg.outputs.networkSecurityGroup\n    vnetAddressPrefix: vnetAddressPrefix\n    trainingSubnetPrefix: trainingSubnetPrefix\n    scoringSubnetPrefix: scoringSubnetPrefix\n    tags: tags\n  }\n}\n\n// Dependent resources for the Azure Machine Learning workspace\nmodule keyvault 'modules/keyvault.bicep' = {\n  name: 'kv-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    keyvaultName: 'kv-${name}-${uniqueSuffix}'\n    keyvaultPleName: 'ple-${name}-${uniqueSuffix}-kv'\n    subnetId: '${vnet.outputs.id}/subnets/snet-training'\n    virtualNetworkId: vnet.outputs.id\n    tags: tags\n  }\n}\n\nmodule storage 'modules/storage.bicep' = {\n  name: 'st${name}${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    storageName: 'st${name}${uniqueSuffix}'\n    storagePleBlobName: 'ple-${name}-${uniqueSuffix}-st-blob'\n    storagePleFileName: 'ple-${name}-${uniqueSuffix}-st-file'\n    storageSkuName: 'Standard_LRS'\n    subnetId: '${vnet.outputs.id}/subnets/snet-training'\n    virtualNetworkId: vnet.outputs.id\n    tags: tags\n  }\n}\n\nmodule containerRegistry 'modules/containerregistry.bicep' = {\n  name: 'cr${name}${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    containerRegistryName: 'cr${name}${uniqueSuffix}'\n    containerRegistryPleName: 'ple-${name}-${uniqueSuffix}-cr'\n    subnetId: '${vnet.outputs.id}/subnets/snet-training'\n    virtualNetworkId: vnet.outputs.id\n    tags: tags\n  }\n}\n\nmodule applicationInsights 'modules/applicationinsights.bicep' = {\n  name: 'appi-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    applicationInsightsName: 'appi-${name}-${uniqueSuffix}'\n    tags: tags\n  }\n}\n\nmodule azuremlWorkspace 'modules/machinelearning.bicep' = {\n  name: 'mlw-${name}-${uniqueSuffix}-deployment'\n  params: {\n    // workspace organization\n    machineLearningName: 'mlw-${name}-${uniqueSuffix}'\n    machineLearningFriendlyName: 'Private link endpoint sample workspace'\n    machineLearningDescription: 'This is an example workspace having a private link endpoint.'\n    location: location\n    prefix: name\n    tags: tags\n\n    // dependent resources\n    applicationInsightsId: applicationInsights.outputs.applicationInsightsId\n    containerRegistryId: containerRegistry.outputs.containerRegistryId\n    keyVaultId: keyvault.outputs.keyvaultId\n    storageAccountId: storage.outputs.storageId\n\n    // networking\n    subnetId: '${vnet.outputs.id}/subnets/snet-training'\n    computeSubnetId: '${vnet.outputs.id}/subnets/snet-training'\n    aksSubnetId: '${vnet.outputs.id}/subnets/snet-scoring'\n    virtualNetworkId: vnet.outputs.id\n    machineLearningPleName: 'ple-${name}-${uniqueSuffix}-mlw'\n\n    // compute\n    amlComputePublicIp: amlComputePublicIp\n    mlAksName: 'aks-${name}-${uniqueSuffix}'\n    vmSizeParam: amlComputeDefaultVmSize\n  }\n  dependsOn: [\n    keyvault\n    containerRegistry\n    applicationInsights\n    storage\n  ]\n}\n\n// Optional VM and Bastion jumphost to help access the network isolated environment\nmodule dsvm 'modules/dsvmjumpbox.bicep' = if (deployJumphost) {\n  name: 'vm-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    virtualMachineName: 'vm-${name}-${uniqueSuffix}'\n    subnetId: '${vnet.outputs.id}/subnets/snet-training'\n    adminUsername: dsvmJumpboxUsername\n    adminPassword: dsvmJumpboxPassword\n    networkSecurityGroupId: nsg.outputs.networkSecurityGroup\n    vmSizeParameter: amlComputeDefaultVmSize\n  }\n}\n\nmodule bastion 'modules/bastion.bicep' = if (deployJumphost) {\n  name: 'bas-${name}-${uniqueSuffix}-deployment'\n  params: {\n    bastionHostName: 'bas-${name}-${uniqueSuffix}'\n    location: location\n    vnetName: vnet.outputs.name\n    addressPrefix: azureBastionSubnetPrefix\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1125."}, {"role": "assistant", "content": "// Creates an Application Insights instance as dependency for Azure ML\n@description('Azure region of the deployment')\nparam location string = resourceGroup().location\n\n@description('Tags to add to the resources')\nparam tags object = {}\n\n@description('Application Insights resource name')\nparam applicationInsightsName string\n\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: location\n  tags: tags\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    DisableIpMasking: false\n    DisableLocalAuth: false\n    Flow_Type: 'Bluefield'\n    ForceCustomerStorageForProfiler: false\n    ImmediatePurgeDataOn30Days: true\n    IngestionMode: 'ApplicationInsights'\n    publicNetworkAccessForIngestion: 'Enabled'\n    publicNetworkAccessForQuery: 'Disabled'\n    Request_Source: 'rest'\n  }\n}\n\noutput applicationInsightsId string = applicationInsights.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1126."}, {"role": "assistant", "content": "// Creates an Azure Bastion Subnet and host in the specified virtual network\n@description('The Azure region where the Bastion should be deployed')\nparam location string = resourceGroup().location\n\n@description('Virtual network name')\nparam vnetName string\n\n@description('The address prefix to use for the Bastion subnet')\nparam addressPrefix string = '192.168.250.0/27'\n\n@description('The name of the Bastion public IP address')\nparam publicIpName string = 'pip-bastion'\n\n@description('The name of the Bastion host')\nparam bastionHostName string = 'bastion-jumpbox'\n\n// The Bastion Subnet is required to be named 'AzureBastionSubnet'\nvar subnetName = 'AzureBastionSubnet'\n\nresource bastionSubnet 'Microsoft.Network/virtualNetworks/subnets@2021-08-01' = {\n  name: '${vnetName}/${subnetName}'\n  properties: {\n    addressPrefix: addressPrefix\n    privateEndpointNetworkPolicies: 'Disabled'\n    privateLinkServiceNetworkPolicies: 'Disabled'\n  }\n}\n\nresource publicIpAddressForBastion 'Microsoft.Network/publicIpAddresses@2020-08-01' = {\n  name: publicIpName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource bastionHost 'Microsoft.Network/bastionHosts@2021-08-01' = {\n  name: bastionHostName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'IpConf'\n        properties: {\n          subnet: {\n            id: bastionSubnet.id\n          }\n          publicIPAddress: {\n            id: publicIpAddressForBastion.id\n          }\n        }\n      }\n    ]\n  }\n}\n\noutput bastionId string = bastionHost.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1127."}, {"role": "assistant", "content": "// Creates an Azure Container Registry with Azure Private Link endpoint\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Container registry name')\nparam containerRegistryName string\n\n@description('Container registry private link endpoint name')\nparam containerRegistryPleName string\n\n@description('Resource ID of the subnet')\nparam subnetId string\n\n@description('Resource ID of the virtual network')\nparam virtualNetworkId string\n\nvar containerRegistryNameCleaned = replace(containerRegistryName, '-', '')\n\nvar privateDnsZoneName = 'privatelink${environment().suffixes.acrLoginServer}'\n\nvar groupName = 'registry' \n\nresource containerRegistry 'Microsoft.ContainerRegistry/registries@2021-09-01' = {\n  name: containerRegistryNameCleaned\n  location: location\n  tags: tags\n  sku: {\n    name: 'Premium'\n  }\n  properties: {\n    adminUserEnabled: true\n    dataEndpointEnabled: false\n    networkRuleBypassOptions: 'AzureServices'\n    networkRuleSet: {\n      defaultAction: 'Deny'\n    }\n    policies: {\n      quarantinePolicy: {\n        status: 'enabled'\n      }\n      retentionPolicy: {\n        status: 'enabled'\n        days: 7\n      }\n      trustPolicy: {\n        status: 'disabled'\n        type: 'Notary'\n      }\n    }\n    publicNetworkAccess: 'Disabled'\n    zoneRedundancy: 'Disabled'\n  }\n}\n\nresource containerRegistryPrivateEndpoint 'Microsoft.Network/privateEndpoints@2021-08-01' = {\n  name: containerRegistryPleName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: containerRegistryPleName\n        properties: {\n          groupIds: [\n            groupName\n          ]\n          privateLinkServiceId: containerRegistry.id\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource acrPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDnsZoneName\n  location: 'global'\n}\n\nresource privateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2021-08-01' = {\n  name: '${containerRegistryPrivateEndpoint.name}/${groupName}-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: privateDnsZoneName\n        properties:{\n          privateDnsZoneId: acrPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource acrPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${acrPrivateDnsZone.name}/${uniqueString(containerRegistry.id)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\noutput containerRegistryId string = containerRegistry.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1128 please."}, {"role": "assistant", "content": "// Creates a Data Science Virtual Machine jumpbox.\n@description('Azure region of the deployment')\nparam location string = resourceGroup().location\n\n@description('Resource ID of the subnet')\nparam subnetId string\n\n@description('Network Security Group Resource ID')\nparam networkSecurityGroupId string\n\n@description('Virtual machine name')\nparam virtualMachineName string\n\n@description('Virtual machine size')\nparam vmSizeParameter string\n\n@description('Virtual machine admin username')\nparam adminUsername string\n\n@secure()\n@minLength(8)\n@description('Virtual machine admin password')\nparam adminPassword string\n\nvar aadLoginExtensionName = 'AADLoginForWindows'\n\nresource networkInterface 'Microsoft.Network/networkInterfaces@2021-08-01' = {\n  name: '${virtualMachineName}-nic'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          subnet: {\n            id: subnetId\n          }\n          privateIPAllocationMethod: 'Dynamic'\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: networkSecurityGroupId\n    }\n  }\n}\n\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2021-03-01' = {\n  name: virtualMachineName\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSizeParameter\n    }\n    storageProfile: {\n      osDisk: {\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n      }\n      imageReference: {\n        publisher: 'microsoft-dsvm'\n        offer: 'dsvm-win-2019'\n        sku: 'server-2019'\n        version: 'latest'\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkInterface.id\n        }\n      ]\n    }\n    osProfile: {\n      computerName: virtualMachineName\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        enableAutomaticUpdates: true\n        provisionVMAgent: true\n        patchSettings: {\n          enableHotpatching: false\n          patchMode: 'AutomaticByOS'\n        }\n      }\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n      }\n    }\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n}\n\nresource virtualMachineName_aadLoginExtensionName 'Microsoft.Compute/virtualMachines/extensions@2021-11-01' = {\n  name: '${virtualMachine.name}/${aadLoginExtensionName}'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.ActiveDirectory'\n    type: aadLoginExtensionName\n    typeHandlerVersion: '1.0'\n    autoUpgradeMinorVersion: true\n  }\n}\n\noutput dsvmId string = virtualMachine.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1129?"}, {"role": "assistant", "content": "// Creates a KeyVault with Private Link Endpoint\n@description('The Azure Region to deploy the resources into')\nparam location string = resourceGroup().location\n\n@description('Tags to apply to the Key Vault Instance')\nparam tags object = {}\n\n@description('The name of the Key Vault')\nparam keyvaultName string\n\n@description('The name of the Key Vault private link endpoint')\nparam keyvaultPleName string\n\n@description('The Subnet ID where the Key Vault Private Link is to be created')\nparam subnetId string\n\n@description('The VNet ID where the Key Vault Private Link is to be created')\nparam virtualNetworkId string\n\nvar privateDnsZoneName = 'privatelink${environment().suffixes.keyvaultDns}'\n\nresource keyVault 'Microsoft.KeyVault/vaults@2021-10-01' = {\n  name: keyvaultName\n  location: location\n  tags: tags\n  properties: {\n    createMode: 'default'\n    enabledForDeployment: false\n    enabledForDiskEncryption: false\n    enabledForTemplateDeployment: false\n    enableSoftDelete: true\n    enableRbacAuthorization: true\n    enablePurgeProtection: true\n    networkAcls: {\n      bypass: 'AzureServices'\n      defaultAction: 'Deny'\n    }\n    sku: {\n      family: 'A'\n      name: 'standard'\n    }\n    softDeleteRetentionInDays: 7\n    tenantId: subscription().tenantId\n  }\n}\n\nresource keyVaultPrivateEndpoint 'Microsoft.Network/privateEndpoints@2021-08-01' = {\n  name: keyvaultPleName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: keyvaultPleName\n        properties: {\n          groupIds: [\n            'vault'\n          ]\n          privateLinkServiceId: keyVault.id\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource keyVaultPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDnsZoneName\n  location: 'global'\n}\n\nresource privateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2021-08-01' = {\n  name: '${keyVaultPrivateEndpoint.name}/vault-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: privateDnsZoneName\n        properties:{\n          privateDnsZoneId: keyVaultPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource keyVaultPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${keyVaultPrivateDnsZone.name}/${uniqueString(keyVault.id)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\noutput keyvaultId string = keyVault.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1130."}, {"role": "assistant", "content": "// Creates a machine learning workspace, private endpoints and compute resources\n// Compute resources include a GPU cluster, CPU cluster, compute instance and attached private AKS cluster\n@description('Prefix for resource names')\nparam prefix string\n\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Machine learning workspace name')\nparam machineLearningName string\n\n@description('Machine learning workspace display name')\nparam machineLearningFriendlyName string = machineLearningName\n\n@description('Machine learning workspace description')\nparam machineLearningDescription string\n\n@description('Name of the Azure Kubernetes services resource to create and attached to the machine learning workspace')\nparam mlAksName string\n\n@description('Resource ID of the application insights resource')\nparam applicationInsightsId string\n\n@description('Resource ID of the container registry resource')\nparam containerRegistryId string\n\n@description('Resource ID of the key vault resource')\nparam keyVaultId string\n\n@description('Resource ID of the storage account resource')\nparam storageAccountId string\n\n@description('Resource ID of the subnet resource')\nparam subnetId string\n\n@description('Resource ID of the compute subnet')\nparam computeSubnetId string\n\n@description('Resource ID of the Azure Kubernetes services resource')\nparam aksSubnetId string\n\n@description('Resource ID of the virtual network')\nparam virtualNetworkId string\n\n@description('Machine learning workspace private link endpoint name')\nparam machineLearningPleName string\n\n@description('Enable public IP for Azure Machine Learning compute nodes')\nparam amlComputePublicIp bool = true\n\n@description('VM size for the default compute cluster')\nparam vmSizeParam string\n \nresource machineLearning 'Microsoft.MachineLearningServices/workspaces@2022-05-01' = {\n  name: machineLearningName\n  location: location\n  tags: tags\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    // workspace organization\n    friendlyName: machineLearningFriendlyName\n    description: machineLearningDescription\n\n    // dependent resources\n    applicationInsights: applicationInsightsId\n    containerRegistry: containerRegistryId\n    keyVault: keyVaultId\n    storageAccount: storageAccountId\n\n    // configuration for workspaces with private link endpoint\n    imageBuildCompute: 'cluster001'\n    publicNetworkAccess: 'Disabled'\n    v1LegacyMode: true\n  }\n}\n\nmodule machineLearningPrivateEndpoint 'machinelearningnetworking.bicep' = {\n  name: 'machineLearningNetworking'\n  scope: resourceGroup()\n  params: {\n    location: location\n    tags: tags\n    virtualNetworkId: virtualNetworkId\n    workspaceArmId: machineLearning.id\n    subnetId: subnetId\n    machineLearningPleName: machineLearningPleName\n  }\n}\n\nmodule machineLearningCompute 'machinelearningcompute.bicep' = {\n  name: 'machineLearningComputes'\n  scope: resourceGroup()\n  params: {\n    machineLearning: machineLearningName\n    location: location\n    computeSubnetId:computeSubnetId\n    aksName: mlAksName\n    aksSubnetId: aksSubnetId\n    prefix: prefix\n    tags: tags\n    amlComputePublicIp: amlComputePublicIp\n    vmSizeParam: vmSizeParam\n  }\n  dependsOn: [\n    machineLearning\n    machineLearningPrivateEndpoint\n  ]\n}\n\noutput machineLearningId string = machineLearning.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1131?"}, {"role": "assistant", "content": "// Creates compute resources in the specified machine learning workspace\n// Includes Compute Instance, Compute Cluster and attached Azure Kubernetes Service compute types\n@description('Prefix for resource names')\nparam prefix string\n\n@description('Azure Machine Learning workspace to create the compute resources in')\nparam machineLearning string\n\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Resource ID of the compute subnet')\nparam computeSubnetId string\n\n@description('Name of the Azure Kubernetes services resource')\nparam aksName string\n\n@description('Resource ID of the Azure Kubernetes services resource')\nparam aksSubnetId string\n\n@description('Resource ID of the Azure Kubernetes services resource')\nparam amlComputePublicIp bool\n\n@description('VM size for the default compute cluster')\nparam vmSizeParam string\n\nresource machineLearningCluster001 'Microsoft.MachineLearningServices/workspaces/computes@2021-07-01' = {\n  name: '${machineLearning}/cluster001'\n  location: location\n  tags: tags\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    computeType: 'AmlCompute'\n    computeLocation: location\n    description: 'Machine Learning cluster 001'\n    disableLocalAuth: true\n    properties: {\n      vmPriority: 'Dedicated'\n      vmSize: vmSizeParam\n      enableNodePublicIp: amlComputePublicIp\n      isolatedNetwork: false\n      osType: 'Linux'\n      remoteLoginPortPublicAccess: 'Disabled'\n      scaleSettings: {\n        minNodeCount: 0\n        maxNodeCount: 5\n        nodeIdleTimeBeforeScaleDown: 'PT120S'\n      }\n      subnet: {\n        id: computeSubnetId\n      }\n    }\n  }\n}\n\nresource machineLearningComputeInstance001 'Microsoft.MachineLearningServices/workspaces/computes@2021-07-01' = {\n  name: '${machineLearning}/${prefix}-ci001'\n  location: location\n  tags: tags\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    computeType: 'ComputeInstance'\n    computeLocation: location\n    description: 'Machine Learning compute instance 001'\n    disableLocalAuth: true\n    properties: {\n      applicationSharingPolicy: 'Personal'\n      \n      computeInstanceAuthorizationType: 'personal'\n      sshSettings: {\n        sshPublicAccess: 'Disabled'\n      }\n      subnet: {\n        id: computeSubnetId\n      }\n      vmSize: vmSizeParam\n    }\n  }\n}\n\nmodule machineLearningAksCompute 'privateaks.bicep' = {\n  name: aksName\n  scope: resourceGroup()\n  params: {\n    location: location\n    tags: tags\n    aksClusterName: aksName\n    computeName: aksName\n    aksSubnetId: aksSubnetId\n    workspaceName: machineLearning\n    vmSizeParam: vmSizeParam\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1132."}, {"role": "assistant", "content": "// Creates private endpoints and DNS zones for the azure machine learning workspace\n@description('Azure region of the deployment')\nparam location string\n\n@description('Machine learning workspace private link endpoint name')\nparam machineLearningPleName string\n\n@description('Resource ID of the virtual network resource')\nparam virtualNetworkId string\n\n@description('Resource ID of the subnet resource')\nparam subnetId string\n\n@description('Resource ID of the machine learning workspace')\nparam workspaceArmId string\n\n@description('Tags to add to the resources')\nparam tags object\n\nvar privateDnsZoneName =  {\n  azureusgovernment: 'privatelink.api.ml.azure.us'\n  azurechinacloud: 'privatelink.api.ml.azure.cn'\n  azurecloud: 'privatelink.api.azureml.ms'\n}\n\nvar privateAznbDnsZoneName = {\n    azureusgovernment: 'privatelink.notebooks.usgovcloudapi.net'\n    azurechinacloud: 'privatelink.notebooks.chinacloudapi.cn'\n    azurecloud: 'privatelink.notebooks.azure.net'\n}\n\nresource machineLearningPrivateEndpoint 'Microsoft.Network/privateEndpoints@2021-08-01' = {\n  name: machineLearningPleName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: machineLearningPleName\n        properties: {\n          groupIds: [\n            'amlworkspace'\n          ]\n          privateLinkServiceId: workspaceArmId\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource amlPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDnsZoneName[toLower(environment().name)]\n  location: 'global'\n}\n\nresource amlPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${amlPrivateDnsZone.name}/${uniqueString(workspaceArmId)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\n// Notebook\nresource notebookPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateAznbDnsZoneName[toLower(environment().name)]\n  location: 'global'\n}\n\nresource notebookPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${notebookPrivateDnsZone.name}/${uniqueString(workspaceArmId)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\nresource privateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2021-08-01' = {\n  name: '${machineLearningPrivateEndpoint.name}/amlworkspace-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: privateDnsZoneName[environment().name]\n        properties:{\n          privateDnsZoneId: amlPrivateDnsZone.id\n        }\n      }\n      {\n        name: privateAznbDnsZoneName[environment().name]\n        properties:{\n          privateDnsZoneId: notebookPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1133."}, {"role": "assistant", "content": "// Creates a network security group preconfigured for use with Azure ML\n// To learn more, see https://docs.microsoft.com/en-us/azure/machine-learning/how-to-access-azureml-behind-firewall\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Name of the network security group')\nparam nsgName string\n\nresource nsg 'Microsoft.Network/networkSecurityGroups@2021-08-01' = {\n  name: nsgName\n  location: location\n  tags: tags\n  properties: {\n    securityRules: [\n      {\n        name: 'BatchNodeManagement'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '29876-29877'\n          sourceAddressPrefix: 'BatchNodeManagement'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 120\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AzureMachineLearning'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '44224'\n          sourceAddressPrefix: 'AzureMachineLearning'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 130\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AzureActiveDirectory'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'AzureActiveDirectory'\n          access: 'Allow'\n          priority: 140\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AzureMachineLearningOutbound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'AzureMachineLearning'\n          access: 'Allow'\n          priority: 150\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AzureResourceManager'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'AzureResourceManager'\n          access: 'Allow'\n          priority: 160\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AzureStorageAccount'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'Storage.${location}'\n          access: 'Allow'\n          priority: 170\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AzureFrontDoor'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'AzureFrontDoor.FrontEnd'\n          access: 'Allow'\n          priority: 180\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AzureContainerRegistry'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'AzureContainerRegistry.${location}'\n          access: 'Allow'\n          priority: 190\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'MicrosoftContainerRegistry'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationAddressPrefix: 'MicrosoftContainerRegistry'\n          access: 'Allow'\n          priority: 200\n          direction: 'Outbound'\n        }\n      }\n    ]\n  }\n}\n\noutput networkSecurityGroup string = nsg.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1134?"}, {"role": "assistant", "content": "// Creates an Azure Kubernetes Services and attaches it to the Azure Machine Learning workspace\n@description('Name of the Azure Kubernetes Service cluster')\nparam aksClusterName string\n\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Resource ID for the Azure Kubernetes Service subnet')\nparam aksSubnetId string\n\n@description('Name of the Azure Machine Learning workspace')\nparam workspaceName string\n\n@description('Name of the Azure Machine Learning attached compute')\nparam computeName string\n\n@description('Size of the virtual machine')\nparam vmSizeParam string // = 'Standard_DS2_v2'\n\nresource aksCluster 'Microsoft.ContainerService/managedClusters@2020-07-01' = {\n  name: aksClusterName\n  location: location\n  tags: tags\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    kubernetesVersion: '1.22.4'\n    dnsPrefix: '${aksClusterName}-dns'\n    agentPoolProfiles: [\n      {\n        name: toLower('agentpool')\n        count: 3\n        vmSize: vmSizeParam\n        osDiskSizeGB: 128\n        vnetSubnetID: aksSubnetId\n        maxPods: 110\n        osType: 'Linux'\n        mode: 'System'\n        type: 'VirtualMachineScaleSets'\n      }\n    ]\n    enableRBAC: true\n    networkProfile: {\n      networkPlugin: 'kubenet'\n      serviceCidr: '10.0.0.0/16'\n      dnsServiceIP: '10.0.0.10'\n      dockerBridgeCidr: '172.17.0.1/16'\n      loadBalancerSku: 'standard'\n    }\n    apiServerAccessProfile: {\n      enablePrivateCluster: true\n    }\n  }\n}\n\noutput aksResourceId string = aksCluster.id\n\nresource workspaceName_computeName 'Microsoft.MachineLearningServices/workspaces/computes@2021-01-01' = {\n  name: '${workspaceName}/${computeName}'\n  location: location\n  properties: {\n    computeType: 'AKS'\n    resourceId: aksCluster.id\n    properties: {\n      aksNetworkingConfiguration:  {\n        subnetId: aksSubnetId\n      }\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1135."}, {"role": "assistant", "content": "// Creates a storage account, private endpoints and DNS zones\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Name of the storage account')\nparam storageName string\n\n@description('Name of the storage blob private link endpoint')\nparam storagePleBlobName string\n\n@description('Name of the storage file private link endpoint')\nparam storagePleFileName string\n\n@description('Resource ID of the subnet')\nparam subnetId string\n\n@description('Resource ID of the virtual network')\nparam virtualNetworkId string\n\n@allowed([\n  'Standard_LRS'\n  'Standard_ZRS'\n  'Standard_GRS'\n  'Standard_GZRS'\n  'Standard_RAGRS'\n  'Standard_RAGZRS'\n  'Premium_LRS'\n  'Premium_ZRS'\n])\n\n@description('Storage SKU')\nparam storageSkuName string = 'Standard_LRS'\n\nvar storageNameCleaned = replace(storageName, '-', '')\n\nvar blobPrivateDnsZoneName = 'privatelink.blob.${environment().suffixes.storage}'\n\nvar filePrivateDnsZoneName = 'privatelink.file.${environment().suffixes.storage}'\n\nresource storage 'Microsoft.Storage/storageAccounts@2021-04-01' = {\n  name: storageNameCleaned\n  location: location\n  tags: tags\n  sku: {\n    name: storageSkuName\n  }\n  kind: 'StorageV2'\n  properties: {\n    accessTier: 'Hot'\n    allowBlobPublicAccess: false\n    allowCrossTenantReplication: false\n    allowSharedKeyAccess: true\n    encryption: {\n      keySource: 'Microsoft.Storage'\n      requireInfrastructureEncryption: false\n      services: {\n        blob: {\n          enabled: true\n          keyType: 'Account'\n        }\n        file: {\n          enabled: true\n          keyType: 'Account'\n        }\n        queue: {\n          enabled: true\n          keyType: 'Service'\n        }\n        table: {\n          enabled: true\n          keyType: 'Service'\n        }\n      }\n    }\n    isHnsEnabled: false\n    isNfsV3Enabled: false\n    keyPolicy: {\n      keyExpirationPeriodInDays: 7\n    }\n    largeFileSharesState: 'Disabled'\n    minimumTlsVersion: 'TLS1_2'\n    networkAcls: {\n      bypass: 'AzureServices'\n      defaultAction: 'Deny'\n    }\n    supportsHttpsTrafficOnly: true\n  }\n}\n\nresource storagePrivateEndpointBlob 'Microsoft.Network/privateEndpoints@2021-08-01' = {\n  name: storagePleBlobName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      { \n        name: storagePleBlobName\n        properties: {\n          groupIds: [\n            'blob'\n          ]\n          privateLinkServiceId: storage.id\n          privateLinkServiceConnectionState: {\n            status: 'Approved'\n            description: 'Auto-Approved'\n            actionsRequired: 'None'\n          }\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource storagePrivateEndpointFile 'Microsoft.Network/privateEndpoints@2021-08-01' = {\n  name: storagePleFileName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: storagePleFileName\n        properties: {\n          groupIds: [\n            'file'\n          ]\n          privateLinkServiceId: storage.id\n          privateLinkServiceConnectionState: {\n            status: 'Approved'\n            description: 'Auto-Approved'\n            actionsRequired: 'None'\n          }\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource blobPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: blobPrivateDnsZoneName\n  location: 'global'\n}\n\nresource privateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2021-08-01' = {\n  name: '${storagePrivateEndpointBlob.name}/blob-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: blobPrivateDnsZoneName\n        properties:{\n          privateDnsZoneId: blobPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource blobPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${blobPrivateDnsZone.name}/${uniqueString(storage.id)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\nresource filePrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: filePrivateDnsZoneName\n  location: 'global'\n}\n\nresource filePrivateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2021-08-01' = {\n  name: '${storagePrivateEndpointFile.name}/flie-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: filePrivateDnsZoneName\n        properties:{\n          privateDnsZoneId: filePrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource filePrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  name: '${filePrivateDnsZone.name}/${uniqueString(storage.id)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\noutput storageId string = storage.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1136."}, {"role": "assistant", "content": "// Creates a virtual network\n@description('Azure region of the deployment')\nparam location string = resourceGroup().location\n\n@description('Tags to add to the resources')\nparam tags object = {}\n\n@description('Name of the virtual network resource')\nparam virtualNetworkName string\n\n@description('Group ID of the network security group')\nparam networkSecurityGroupId string\n\n@description('Virtual network address prefix')\nparam vnetAddressPrefix string = '192.168.0.0/16'\n\n@description('Training subnet address prefix')\nparam trainingSubnetPrefix string = '192.168.0.0/24'\n\n@description('Scoring subnet address prefix')\nparam scoringSubnetPrefix string = '192.168.1.0/24'\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2021-08-01' = {\n  name: virtualNetworkName\n  location: location\n  tags: tags\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      { \n        name: 'snet-training'\n        properties: {\n          addressPrefix: trainingSubnetPrefix\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Disabled'\n          networkSecurityGroup: {\n            id: networkSecurityGroupId\n          }\n        }\n      }\n      { \n        name: 'snet-scoring'\n        properties: {\n          addressPrefix: scoringSubnetPrefix\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Disabled'\n          serviceEndpoints: [\n            {\n              service: 'Microsoft.KeyVault'\n            }\n            {\n              service: 'Microsoft.ContainerRegistry'\n            }\n            {\n              service: 'Microsoft.Storage'\n            }\n          ]\n          networkSecurityGroup: {\n            id: networkSecurityGroupId\n          }\n        }\n      }\n    ]\n  }\n}\n\noutput id string = virtualNetwork.id\noutput name string = virtualNetwork.name\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1137."}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Machine Learning workspace where job will be created.')\nparam workspaceName string\n\n@description('Specifies the name of the Azure Machine Learning compute instance/cluster on which job will be run.')\nparam computeName string\n\n@description('Specifies the name of the Azure Machine Learning experiment under which job will be created.')\nparam experimentName string\n\n@description('Specifies the name of the Azure Machine Learning job to be created.')\nparam jobName string\n\n@description('The base URI where artifacts required by this template are located including a trailing \\'/\\'.')\nparam _artifactsLocation string = deployment().properties.templateLink.uri\n\n@description('The sasToken required to access _artifactsLocation.')\n@secure()\nparam _artifactsLocationSasToken string = ''\n\n@description('Specifies execution contraints for the job.')\nparam limitSettings object = {\n  maxTrials: 5\n  maxConcurrentTrials: 1\n  maxCoresPerTrial: -1\n  enableEarlyTermination: true\n  timeout: 'PT10H'\n  trialTimeout: 'PT20M'\n}\n\n@description('Specifies training related configuration for the job.')\nparam trainingSettings object = {\n  blockedTrainingAlgorithms: [\n    'LogisticRegression'\n  ]\n  enableModelExplainability: true\n  enableOnnxCompatibleModels: false\n  enableStackEnsemble: true\n  enableVoteEnsemble: true\n  ensembleModelDownloadTimeout: 'PT5M'\n  enableDnnTraining: false\n}\n\nvar compute = resourceId('Microsoft.MachineLearningServices/workspaces/computes', workspaceName, computeName)\n\nresource jobResource 'Microsoft.MachineLearningServices/workspaces/jobs@2022-06-01-preview' = {\n  name: '${workspaceName}/${jobName}'\n  properties: {\n    jobType: 'AutoML'\n    tags: {\n      referenceNotebook: 'https://github.com/Azure/azureml-examples/blob/main/sdk/jobs/automl-standalone-jobs/automl-classification-task-bankmarketing'\n    }\n    experimentName: experimentName\n    computeId: compute\n    taskDetails: {\n      logVerbosity: 'Info'\n      taskType: 'Classification'\n      primaryMetric: 'Accuracy'\n      targetColumnName: 'y'\n      trainingData: {\n        uri: uri(_artifactsLocation, 'data/training-mltable-folder/${_artifactsLocationSasToken}')\n        jobInputType: 'MLTable'\n      }\n      validationData: {\n        uri: uri(_artifactsLocation, 'data/validation-mltable-folder/${_artifactsLocationSasToken}')\n        jobInputType: 'MLTable'\n      }\n      featurizationSettings: {\n        mode: 'auto'\n      }\n      limitSettings: limitSettings\n      trainingSettings: trainingSettings\n    }\n  }\n}\n\noutput Job_Studio_Endpoint string = jobResource.properties.services.Studio.endpoint\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1138 please."}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Machine Learning workspace where the command job will be created.')\nparam workspaceName string\n\n@description('Specifies the name of the Azure Machine Learning compute instance/cluster on which job will be run.')\nparam computeName string\n\n@description('Specifies the name of the Azure Machine Learning experiment under which job will be created.')\nparam experimentName string\n\n@description('Specifies the name of the Azure Machine Learning job to be created.')\nparam jobName string\n\n@description('Specifies the curated environment to run sweep job.')\nparam environmentName string = 'AzureML-lightgbm-3.2-ubuntu18.04-py37-cpu'\n\nresource environment 'Microsoft.MachineLearningServices/workspaces/environments@2022-05-01' existing = {\n  name: '${workspaceName}/${environmentName}'\n}\n\nresource environmentVersion 'Microsoft.MachineLearningServices/workspaces/environments/versions@2022-05-01' existing = {\n  parent: environment\n  name: environment.properties.latestVersion\n}\n\nresource compute 'Microsoft.MachineLearningServices/workspaces/computes@2022-05-01' existing = {\n  name: '${workspaceName}/${computeName}'\n}\n\nresource jobResource 'Microsoft.MachineLearningServices/workspaces/jobs@2022-10-01' = {\n  name: '${workspaceName}/${jobName}'\n  properties: {\n    jobType: 'Command'\n    experimentName: experimentName\n    command: 'echo \"hello_world\"'\n    environmentId: environmentVersion.id\n    computeId: compute.id\n  }\n}\n\noutput Job_Studio_Endpoint string = jobResource.properties.services.Studio.endpoint\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1139?"}, {"role": "assistant", "content": "// Sweep Job Resource using ARM Template\n@description('Specifies the location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Specifies the name of the Azure Machine Learning workspace where sweep job will be deployed')\nparam workspaceName string\n\n@description('Specifies the unique name for sweep job.')\nparam jobName string\n\n@description('Specifies the name of the Azure Machine Learning amlcompute cluster on which job will be run.')\nparam computeName string\n\n@description('The name for the storage account to created and associated with the workspace.')\nparam storageAccountName string\n\n@description('Specifies the name of the Azure Machine Learning experiment under which job will be created.')\nparam experimentName string\n\n@description('The base URI where artifacts required by this template are located including a trailing \\'/\\'.')\nparam _artifactsLocation string = deployment().properties.templateLink.uri\n\n@description('The sasToken required to access _artifactsLocation.')\n@secure()\nparam _artifactsLocationSasToken string = ''\n\n@description('Specifies dictionary of inputs search for sweep job.')\nparam inputs object = {\n  iris_csv: {\n    mode: 'ReadOnlyMount'\n    uri: uri(_artifactsLocation, 'data/iris.csv${_artifactsLocationSasToken}')\n    jobInputType: 'uri_file'\n  }\n}\n\n@description('Specifies execution contraints for sweep job.')\nparam limits object = {\n  jobLimitsType: 'Sweep'\n  timeout: 'PT20M'\n  trialTimeout: 'PT50S'\n  maxConcurrentTrials: 3\n  maxTotalTrials: 5\n}\n\n@description('Specifies objective for sweep job.')\nparam objective object = {\n  goal: 'maximize'\n  primaryMetric: 'result'\n}\n\n@description('Specifies sampling algorithm for sweep job.')\nparam samplingAlgorithmType string = 'Random'\n\n@description('Specifies different search space for sweep job.')\nparam searchSpace object = {\n  learning_rate: [ 'uniform', [ json('0.01'), json('0.9') ] ]\n  boosting: [ 'choice', [ [ 'gbdt', 'dart' ] ] ]\n}\n\n@description('Specifies command to be executed by trials of sweep job.')\nparam command string = '''python main.py --iris-csv ${{inputs.iris_csv}} --learning-rate ${{search_space.learning_rate}} --boosting ${{search_space.boosting}}'''\n\n@description('Specifies the curated environment to run sweep job.')\nparam environmentName string = 'AzureML-lightgbm-3.2-ubuntu18.04-py37-cpu'\n\n// creating codeVersion resource\nmodule codeVersion 'modules/codeversion.bicep' = {\n  name: 'blob'\n  params: {\n    location: location\n    workspaceName: workspaceName\n    storageAccountName: storageAccountName\n  }\n}\n\n// fetching existing curated environment resource object\nresource environmemt 'Microsoft.MachineLearningServices/workspaces/environments@2022-05-01' existing = {\n  name: '${workspaceName}/${environmentName}'\n}\n\n// creating sweep job resource\nresource sweepjobResource 'Microsoft.MachineLearningServices/workspaces/jobs@2022-06-01-preview' = {\n  name: '${workspaceName}/${jobName}'\n  properties: {\n    description: 'Sweep Job Resource from ARM Template'\n    properties: {}\n    tags: {\n      referenceNotebook: 'https://github.com/Azure/azureml-examples/blob/main/sdk/jobs/single-step/lightgbm/iris/lightgbm-iris-sweep.ipynb'\n    }\n    computeId: resourceId('Microsoft.MachineLearningServices/workspaces/computes', workspaceName, computeName)\n    displayName: 'Sweep Job Resource'\n    experimentName: experimentName\n    isArchived: false\n    jobType: 'Sweep'\n    inputs: inputs\n    limits: limits\n    objective: objective\n    samplingAlgorithm: {\n      samplingAlgorithmType: samplingAlgorithmType\n    }\n    searchSpace: searchSpace\n    trial: {\n      codeId: codeVersion.outputs.codeId\n      command: command\n      environmentId: resourceId('Microsoft.MachineLearningServices/workspaces/environments/versions', workspaceName, environmentName, environmemt.properties.latestVersion)\n      environmentVariables: {}\n    }\n  }\n}\n\n// output the azure machine learning studio experiment url\noutput Job_Studio_Endpoint string = sweepjobResource.properties.services.Studio.endpoint\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1140."}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Machine Learning workspace where sweep job will be deployed')\nparam workspaceName string\n\n@description('Name of the blob as it is stored in the blob container')\nparam filename string = 'main.py'\n\n@description('Name of the blob container')\nparam containerName string = 'hdscript'\n\n@description('Azure region where resources should be deployed')\nparam location string = resourceGroup().location\n\n@description('Desired name of the storage account')\nparam storageAccountName string\n\n@description('Specifies the env version for sweep job.')\nparam codeVersion string = '1'\n\n@description('Specifies the env for sweep job.')\nparam codeId string = 'code'\n\n// fetching existing storage account\nresource storage 'Microsoft.Storage/storageAccounts@2021-04-01' existing = {\n  name: storageAccountName\n  // creating blob service in storage account\n  resource blobService 'blobServices' = {\n    name: 'default'\n    // creating blob container in storage account\n    resource container 'containers' = {\n      name: containerName\n      properties: {\n        publicAccess: 'Container'\n      }\n    }\n  }\n}\n\n// creating deployment script to upload hyperdrive script 'main.py' to blob container\nresource deploymentScript 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\n  name: 'deployscript-upload-blob-${uniqueString(storage::blobService::container.id)}'\n  location: location\n  kind: 'AzureCLI'\n  properties: {\n    azCliVersion: '2.26.1'\n    timeout: 'PT5M'\n    retentionInterval: 'PT1H'\n    environmentVariables: [\n      {\n        name: 'AZURE_STORAGE_ACCOUNT'\n        value: storage.name\n      }\n      {\n        name: 'AZURE_STORAGE_KEY'\n        secureValue: storage.listKeys().keys[0].value\n      }\n      {\n        name: 'CONTENT'\n        value: loadTextContent('../scripts/main.py')\n      }\n    ]\n    scriptContent: 'echo \"$CONTENT\" > ${filename} && az storage blob upload -f ${filename} -c ${containerName} -n ${filename}'\n  }\n}\n\n// creating codeVersion resource using uploaded hyperdrive script blob url\nresource codeVersionResource 'Microsoft.MachineLearningServices/workspaces/codes/versions@2022-05-01' = {\n  dependsOn: [ deploymentScript ]\n  name: '${workspaceName}/${codeId}-${uniqueString(storage::blobService::container.id)}/${codeVersion}'\n  properties: {\n    codeUri: uri('https://${storageAccountName}.blob.${environment().suffixes.storage}/', '${containerName}/')\n    isAnonymous: false\n  }\n}\n\n// output the codeId from codeVersion resource\noutput codeId string = codeVersionResource.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1141?"}, {"role": "assistant", "content": "// Execute this main file to deploy Azure AI studio resources in the basic security configuration\n\n// Parameters\n@minLength(2)\n@maxLength(12)\n@description('Name for the AI resource and used to derive name of dependent resources.')\nparam amlName string = 'demo'\n\n@description('Friendly name for your Azure AI resource')\nparam amlFriendlyName string = 'Demo AI resource'\n\n@description('Description of your Azure AI resource displayed in AI studio')\nparam amlDescription string = 'This is an example AI resource for use in Azure AI Studio.'\n\n@description('Set of tags to apply to all resources.')\nparam tags object = {}\n\n@description('Resource name of the virtual network to deploy the resource into.')\nparam vnetName string\n\n@description('Resource group name of the virtual network to deploy the resource into.')\nparam vnetRgName string\n\n@description('Name of the subnet to deploy into.')\nparam subnetName string\n\n@description('The location into which the resources should be deployed.')\nparam location string = resourceGroup().location\n\n@minLength(2)\n@maxLength(10)\n@description('Prefix for all resource names.')\nparam prefix string\n\n// Variables\nvar name = toLower('${amlName}')\n\n// Create a short, unique suffix, that will be unique to each resource group\nvar uniqueSuffix = substring(uniqueString(resourceGroup().id), 0, 7)\n\nvar vnetResourceId = '/subscriptions/${subscription().subscriptionId}/resourceGroups/${vnetRgName}/providers/Microsoft.Network/virtualNetworks/${vnetName}'\nvar subnetResourceId = '${vnetResourceId}/subnets/${subnetName}'\n\n// Dependent resources for the Azure Machine Learning workspace\nmodule aiDependencies 'modules/dependent-resources.bicep' = {\n  name: 'dependencies-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    tags: tags\n    subnetResourceId: subnetResourceId\n    vnetResourceId: vnetResourceId\n    prefix: prefix\n  }\n}\n\nmodule amlWorkspace 'modules/aml-workspace.bicep' = {\n  name: 'aml-${name}-${uniqueSuffix}-deployment'\n  params: {\n    // workspace organization\n    amlWorkspaceName: 'aml-${name}-${uniqueSuffix}'\n    amlWorkspaceFriendlyName: amlFriendlyName\n    amlWorkspaceDescription: amlDescription\n    location: location\n    tags: tags\n\n    //metadata\n    uniqueSuffix: uniqueSuffix\n\n    //network related\n    vnetResourceId: vnetResourceId\n    subnetResourceId: subnetResourceId\n\n    // dependent resources\n    aiServicesId: aiDependencies.outputs.aiservicesID\n    aiServicesTarget: aiDependencies.outputs.aiservicesTarget\n    applicationInsightsId: aiDependencies.outputs.applicationInsightsId\n    containerRegistryId: aiDependencies.outputs.containerRegistryId\n    keyVaultId: aiDependencies.outputs.keyvaultId\n    storageAccountId: aiDependencies.outputs.storageId\n\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1142."}, {"role": "assistant", "content": "// Creates an Azure AI resource with proxied endpoints for the Azure AI services provider\n\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('AML name')\nparam amlWorkspaceName string\n\n@description('AML display name')\nparam amlWorkspaceFriendlyName string = amlWorkspaceName\n\n@description('AML description')\nparam amlWorkspaceDescription string\n\n@description('Resource ID of the application insights resource for storing diagnostics logs')\nparam applicationInsightsId string\n\n@description('Resource ID of the container registry resource for storing docker images')\nparam containerRegistryId string\n\n@description('Resource ID of the key vault resource for storing connection strings')\nparam keyVaultId string\n\n@description('Resource ID of the storage account resource for storing experimentation outputs')\nparam storageAccountId string\n\n@description('Resource ID of the AI Services resource')\nparam aiServicesId string\n\n@description('Resource ID of the AI Services endpoint')\nparam aiServicesTarget string\n\n@description('Resource Id of the virtual network to deploy the resource into.')\nparam vnetResourceId string\n\n@description('Subnet Id to deploy into.')\nparam subnetResourceId string\n\n@description('Unique Suffix used for name generation')\nparam uniqueSuffix string\n\nvar privateEndpointName = '${amlWorkspaceName}-amlWorkspace-PE'\nvar targetSubResource = [\n    'amlworkspace'\n]\n\nresource amlWorkspace 'Microsoft.MachineLearningServices/workspaces@2023-10-01' = {\n  name: amlWorkspaceName\n  location: location\n  tags: tags\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    // organization\n    friendlyName: amlWorkspaceFriendlyName\n    description: amlWorkspaceDescription\n\n    // dependent resources\n    keyVault: keyVaultId\n    storageAccount: storageAccountId\n    applicationInsights: applicationInsightsId\n    containerRegistry: containerRegistryId\n\n    // network settings\n    publicNetworkAccess: 'Disabled'\n    managedNetwork: {\n      isolationMode: 'AllowInternetOutBound'\n    }\n\n    // private link settings\n    sharedPrivateLinkResources: []\n  }\n  kind: 'Default'\n\n  resource aiServicesConnection 'connections@2024-01-01-preview' = {\n    name: '${amlWorkspaceName}-connection-AIServices'\n    properties: {\n      category: 'AIServices'\n      target: aiServicesTarget\n      authType: 'ApiKey'\n      isSharedToAll: true\n      credentials: {\n        key: '${listKeys(aiServicesId, '2021-10-01').key1}'\n      }\n      metadata: {\n        ApiType: 'Azure'\n        ResourceId: aiServicesId\n      }\n    }\n  }\n}\n\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2023-11-01' = {\n  name: privateEndpointName\n  location: location\n  properties: {\n    subnet: {\n      id: subnetResourceId\n    }\n    customNetworkInterfaceName: '${amlWorkspaceName}-nic-${uniqueSuffix}'\n    privateLinkServiceConnections: [\n      {\n        name: amlWorkspaceName\n        properties: {\n          privateLinkServiceId: amlWorkspace.id\n          groupIds: targetSubResource\n        }\n      }\n    ]\n  }\n\n}\n\nresource privateLinkApi 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: 'privatelink.api.azureml.ms'\n  location: 'global'\n  tags: {}\n  properties: {}\n}\n\nresource privateLinkNotebooks 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: 'privatelink.notebooks.azure.net'\n  location: 'global'\n  tags: {}\n  properties: {}\n}\n\nresource vnetLinkApi 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateLinkApi\n  name: '${uniqueString(vnetResourceId)}-api'\n  location: 'global'\n  properties: {\n    virtualNetwork: {\n      id: vnetResourceId\n    }\n    registrationEnabled: false\n  }\n}\n\nresource vnetLinkNotebooks 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateLinkNotebooks\n  name: '${uniqueString(vnetResourceId)}-notebooks'\n  location: 'global'\n  properties: {\n    virtualNetwork: {\n      id: vnetResourceId\n    }\n    registrationEnabled: false\n  }\n}\n\n\n\nresource dnsZoneGroupamlWorkspace 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-11-01' = {\n  parent: privateEndpoint\n  name: 'default'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'privatelink-api-azureml-ms'\n        properties: {\n            privateDnsZoneId: privateLinkApi.id\n        }\n      }\n      {\n        name: 'privatelink-notebooks-azure-net'\n        properties: {\n            privateDnsZoneId: privateLinkNotebooks.id\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnetLinkApi\n    vnetLinkNotebooks\n  ]\n}\n\noutput amlWorkspaceID string = amlWorkspace.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1143."}, {"role": "assistant", "content": "// Creates Azure dependent resources for Azure AI studio\n@minLength(2)\n@maxLength(10)\n@description('Prefix for all resource names.')\nparam prefix string\n\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object = {}\n\n@description('Subnet Id to deploy into.')\nparam subnetResourceId string\n\n@description('Resource Id of the virtual network to deploy the resource into.')\nparam vnetResourceId string\n\n// Variables\nvar name = toLower('${prefix}')\n\n// Create a short, unique suffix, that will be unique to each resource group\nvar uniqueSuffix = substring(uniqueString(resourceGroup().id), 0, 4)\n\nmodule applicationInsights 'dependent/applicationinsights.bicep' = {\n  name: 'appi-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    applicationInsightsName: 'appi-${name}-${uniqueSuffix}'\n    logAnalyticsWorkspaceName: 'ws-${name}-${uniqueSuffix}'\n    tags: tags\n  }\n}\n\n// Dependent resources for the Azure Machine Learning workspace\nmodule keyvault 'dependent/keyvault.bicep' = {\n  name: 'kv-${name}-${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    keyvaultName: 'kv-${name}-${uniqueSuffix}'\n    keyvaultPleName: 'ple-${name}-${uniqueSuffix}-kv'\n    subnetId: subnetResourceId\n    virtualNetworkId: vnetResourceId\n    tags: tags\n  }\n}\n\nmodule containerRegistry 'dependent/containerregistry.bicep' = {\n  name: 'cr${name}${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    containerRegistryName: 'cr${name}${uniqueSuffix}'\n    containerRegistryPleName: 'ple-${name}-${uniqueSuffix}-cr'\n    subnetId: subnetResourceId\n    virtualNetworkId: vnetResourceId\n    tags: tags\n  }\n}\n\nmodule aiServices 'dependent/aiservices.bicep' = {\n  name: 'ai${name}${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    aiServiceName: 'ai${name}${uniqueSuffix}'\n    aiServicesPleName: 'ple-${name}-${uniqueSuffix}-ais'\n    subnetId: subnetResourceId\n    virtualNetworkId: vnetResourceId\n    tags: tags\n  }\n}\n\nmodule storage 'dependent/storage.bicep' = {\n  name: 'st${name}${uniqueSuffix}-deployment'\n  params: {\n    location: location\n    storageName: 'st${name}${uniqueSuffix}'\n    storagePleBlobName: 'ple-${name}-${uniqueSuffix}-st-blob'\n    storagePleFileName: 'ple-${name}-${uniqueSuffix}-st-file'\n    storageSkuName: 'Standard_LRS'\n    subnetId: subnetResourceId\n    virtualNetworkId: vnetResourceId\n    tags: tags\n  }\n}\n\noutput aiservicesID string = aiServices.outputs.aiServicesId\noutput aiservicesTarget string = aiServices.outputs.aiServicesEndpoint\noutput storageId string = storage.outputs.storageId\noutput keyvaultId string = keyvault.outputs.keyvaultId\noutput containerRegistryId string = containerRegistry.outputs.containerRegistryId\noutput applicationInsightsId string = applicationInsights.outputs.applicationInsightsId\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1144?"}, {"role": "assistant", "content": "// Creates AI services resources, private endpoints, and DNS zones\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Name of the AI service')\nparam aiServiceName string\n\n@description('Name of the AI service private link endpoint for cognitive services')\nparam aiServicesPleName string\n\n@description('Resource ID of the subnet')\nparam subnetId string\n\n@description('Resource ID of the virtual network')\nparam virtualNetworkId string\n\n@allowed([\n  'S0'\n])\n\n@description('AI service SKU')\nparam aiServiceSkuName string = 'S0'\n\nvar aiServiceNameCleaned = replace(aiServiceName, '-', '')\n\nvar cognitiveServicesPrivateDnsZoneName = 'privatelink.cognitiveservices.azure.com'\nvar openAiPrivateDnsZoneName = 'privatelink.openai.azure.com'\n\nresource aiServices 'Microsoft.CognitiveServices/accounts@2023-05-01' = {\n  name: aiServiceNameCleaned\n  location: location\n  sku: {\n    name: aiServiceSkuName\n  }\n  kind: 'AIServices'\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    disableLocalAuth: true\n    apiProperties: {\n      statisticsEnabled: false\n    }\n    networkAcls: {\n      defaultAction: 'Deny'\n      virtualNetworkRules: [\n        {\n          id: subnetId\n          ignoreMissingVnetServiceEndpoint: true\n        }\n      ]\n    }\n    customSubDomainName: aiServiceNameCleaned\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n}\n\nresource aiServicesPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-11-01' = {\n  name: aiServicesPleName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      { \n        name: aiServicesPleName\n        properties: {\n          groupIds: [\n            'account'\n          ]\n          privateLinkServiceId: aiServices.id\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource cognitiveServicesPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: cognitiveServicesPrivateDnsZoneName\n  location: 'global'\n}\n\nresource openAiPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: openAiPrivateDnsZoneName\n  location: 'global'\n}\n\nresource cognitiveServicesVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: cognitiveServicesPrivateDnsZone\n  name: uniqueString(virtualNetworkId)\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\nresource openAiVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: openAiPrivateDnsZone\n  name: uniqueString(virtualNetworkId)\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\nresource aiServicesPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-11-01' = {\n  parent: aiServicesPrivateEndpoint\n  name: 'default'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: replace(openAiPrivateDnsZoneName, '.', '-')\n        properties:{\n          privateDnsZoneId: openAiPrivateDnsZone.id\n        }\n      }\n      {\n        name: replace(cognitiveServicesPrivateDnsZoneName, '.', '-')\n        properties:{\n          privateDnsZoneId: cognitiveServicesPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\noutput aiServicesId string = aiServices.id\noutput aiServicesEndpoint string = aiServices.properties.endpoint\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1145."}, {"role": "assistant", "content": "// Creates an Application Insights instance as dependency for Azure ML\n@description('Azure region of the deployment')\nparam location string = resourceGroup().location\n\n@description('Tags to add to the resources')\nparam tags object = {}\n\n@description('Application Insights resource name')\nparam applicationInsightsName string\n\n@description('Log Analytics resource name')\nparam logAnalyticsWorkspaceName string \n\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {\n  name: logAnalyticsWorkspaceName\n  location: location\n  properties: {\n    sku: {\n      name: 'PerGB2018'\n    }\n    retentionInDays: 30\n    publicNetworkAccessForIngestion: 'Enabled'\n    publicNetworkAccessForQuery: 'Disabled'\n  }\n}\n\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: location\n  tags: tags\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    WorkspaceResourceId: logAnalyticsWorkspace.id\n    Flow_Type: 'Bluefield'\n  }\n}\n\noutput applicationInsightsId string = applicationInsights.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1146."}, {"role": "assistant", "content": "// Creates an Azure Container Registry with Azure Private Link endpoint\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Container registry name')\nparam containerRegistryName string\n\n@description('Container registry private link endpoint name')\nparam containerRegistryPleName string\n\n@description('Resource ID of the subnet')\nparam subnetId string\n\n@description('Resource ID of the virtual network')\nparam virtualNetworkId string\n\nvar containerRegistryNameCleaned = replace(containerRegistryName, '-', '')\n\nvar privateDnsZoneName = 'privatelink${environment().suffixes.acrLoginServer}'\n\nvar groupName = 'registry' \n\nresource containerRegistry 'Microsoft.ContainerRegistry/registries@2023-07-01' = {\n  name: containerRegistryNameCleaned\n  location: location\n  tags: tags\n  sku: {\n    name: 'Premium'\n  }\n  properties: {\n    adminUserEnabled: false\n    dataEndpointEnabled: false\n    networkRuleBypassOptions: 'AzureServices'\n    networkRuleSet: {\n      defaultAction: 'Deny'\n    }\n    policies: {\n      quarantinePolicy: {\n        status: 'disabled'\n      }\n      retentionPolicy: {\n        status: 'enabled'\n        days: 7\n      }\n      trustPolicy: {\n        status: 'enabled'\n        type: 'Notary'\n      }\n    }\n    publicNetworkAccess: 'Disabled'\n    zoneRedundancy: 'Disabled'\n  }\n}\n\nresource containerRegistryPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-11-01' = {\n  name: containerRegistryPleName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: containerRegistryPleName\n        properties: {\n          groupIds: [\n            groupName\n          ]\n          privateLinkServiceId: containerRegistry.id\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource acrPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDnsZoneName\n  location: 'global'\n}\n\nresource privateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-11-01' = {\n  parent: containerRegistryPrivateEndpoint\n  name: '${groupName}-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: privateDnsZoneName\n        properties:{\n          privateDnsZoneId: acrPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource acrPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: acrPrivateDnsZone\n  name: uniqueString(containerRegistry.id)\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\noutput containerRegistryId string = containerRegistry.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1147."}, {"role": "assistant", "content": "// Creates a KeyVault with Private Link Endpoint\n@description('The Azure Region to deploy the resources into')\nparam location string = resourceGroup().location\n\n@description('Tags to apply to the Key Vault Instance')\nparam tags object = {}\n\n@description('The name of the Key Vault')\nparam keyvaultName string\n\n@description('The name of the Key Vault private link endpoint')\nparam keyvaultPleName string\n\n@description('The Subnet ID where the Key Vault Private Link is to be created')\nparam subnetId string\n\n@description('The VNet ID where the Key Vault Private Link is to be created')\nparam virtualNetworkId string\n\nvar privateDnsZoneName = 'privatelink${environment().suffixes.keyvaultDns}'\n\nresource keyVault 'Microsoft.KeyVault/vaults@2023-07-01' = {\n  name: keyvaultName\n  location: location\n  tags: tags\n  properties: {\n    createMode: 'default'\n    enabledForDeployment: false\n    enabledForDiskEncryption: false\n    enabledForTemplateDeployment: false\n    enableSoftDelete: true\n    enableRbacAuthorization: true\n    enablePurgeProtection: true\n    networkAcls: {\n      bypass: 'AzureServices'\n      defaultAction: 'Deny'\n    }\n    sku: {\n      family: 'A'\n      name: 'standard'\n    }\n    softDeleteRetentionInDays: 7\n    tenantId: subscription().tenantId\n  }\n}\n\nresource keyVaultPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-11-01' = {\n  name: keyvaultPleName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: keyvaultPleName\n        properties: {\n          groupIds: [\n            'vault'\n          ]\n          privateLinkServiceId: keyVault.id\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource keyVaultPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDnsZoneName\n  location: 'global'\n}\n\nresource privateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-11-01' = {\n  parent: keyVaultPrivateEndpoint\n  name: 'vault-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: privateDnsZoneName\n        properties:{\n          privateDnsZoneId: keyVaultPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource keyVaultPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: keyVaultPrivateDnsZone\n  name: uniqueString(keyVault.id)\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\noutput keyvaultId string = keyVault.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1148 please."}, {"role": "assistant", "content": "// Creates a storage account, private endpoints and DNS zones\n@description('Azure region of the deployment')\nparam location string\n\n@description('Tags to add to the resources')\nparam tags object\n\n@description('Name of the storage account')\nparam storageName string\n\n@description('Name of the storage blob private link endpoint')\nparam storagePleBlobName string\n\n@description('Name of the storage file private link endpoint')\nparam storagePleFileName string\n\n@description('Resource ID of the subnet')\nparam subnetId string\n\n@description('Resource ID of the virtual network')\nparam virtualNetworkId string\n\n@allowed([\n  'Standard_LRS'\n  'Standard_ZRS'\n  'Standard_GRS'\n  'Standard_GZRS'\n  'Standard_RAGRS'\n  'Standard_RAGZRS'\n  'Premium_LRS'\n  'Premium_ZRS'\n])\n\n@description('Storage SKU')\nparam storageSkuName string = 'Standard_LRS'\n\nvar storageNameCleaned = replace(storageName, '-', '')\n\nvar blobPrivateDnsZoneName = 'privatelink.blob.${environment().suffixes.storage}'\n\nvar filePrivateDnsZoneName = 'privatelink.file.${environment().suffixes.storage}'\n\nresource storage 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: storageNameCleaned\n  location: location\n  tags: tags\n  sku: {\n    name: storageSkuName\n  }\n  kind: 'StorageV2'\n  properties: {\n    accessTier: 'Hot'\n    allowBlobPublicAccess: false\n    allowCrossTenantReplication: false\n    allowSharedKeyAccess: true\n    encryption: {\n      keySource: 'Microsoft.Storage'\n      requireInfrastructureEncryption: false\n      services: {\n        blob: {\n          enabled: true\n          keyType: 'Account'\n        }\n        file: {\n          enabled: true\n          keyType: 'Account'\n        }\n        queue: {\n          enabled: true\n          keyType: 'Service'\n        }\n        table: {\n          enabled: true\n          keyType: 'Service'\n        }\n      }\n    }\n    isHnsEnabled: false\n    isNfsV3Enabled: false\n    keyPolicy: {\n      keyExpirationPeriodInDays: 7\n    }\n    largeFileSharesState: 'Disabled'\n    minimumTlsVersion: 'TLS1_2'\n    networkAcls: {\n      bypass: 'AzureServices'\n      defaultAction: 'Deny'\n    }\n    supportsHttpsTrafficOnly: true\n  }\n}\n\nresource storagePrivateEndpointBlob 'Microsoft.Network/privateEndpoints@2023-11-01' = {\n  name: storagePleBlobName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      { \n        name: storagePleBlobName\n        properties: {\n          groupIds: [\n            'blob'\n          ]\n          privateLinkServiceId: storage.id\n          privateLinkServiceConnectionState: {\n            status: 'Approved'\n            description: 'Auto-Approved'\n            actionsRequired: 'None'\n          }\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource storagePrivateEndpointFile 'Microsoft.Network/privateEndpoints@2023-11-01' = {\n  name: storagePleFileName\n  location: location\n  tags: tags\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: storagePleFileName\n        properties: {\n          groupIds: [\n            'file'\n          ]\n          privateLinkServiceId: storage.id\n          privateLinkServiceConnectionState: {\n            status: 'Approved'\n            description: 'Auto-Approved'\n            actionsRequired: 'None'\n          }\n        }\n      }\n    ]\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource blobPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: blobPrivateDnsZoneName\n  location: 'global'\n}\n\nresource blobPrivateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-11-01' = {\n  parent: storagePrivateEndpointBlob\n  name: 'blob-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: blobPrivateDnsZoneName\n        properties:{\n          privateDnsZoneId: blobPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource blobPrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: blobPrivateDnsZone\n  name: uniqueString(storage.id)\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\nresource filePrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: filePrivateDnsZoneName\n  location: 'global'\n}\n\nresource filePrivateEndpointDns 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-11-01' = {\n  parent: storagePrivateEndpointFile\n  name: 'flie-PrivateDnsZoneGroup'\n  properties:{\n    privateDnsZoneConfigs: [\n      {\n        name: filePrivateDnsZoneName\n        properties:{\n          privateDnsZoneId: filePrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource filePrivateDnsZoneVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: filePrivateDnsZone\n  name: uniqueString(storage.id)\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\noutput storageId string = storage.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1149?"}, {"role": "assistant", "content": "// Define the parameters for the deployment\n@description('Name of the vm.')\nparam vmName string = 'windows-bastion'\n\n@description('Name of the adminUsername')\nparam adminUsername string = 'azureuser'\n\n@description('Name of the admin login password.')\n@secure()\nparam adminPassword string\n\n@description('The location into which the resources should be deployed.')\nparam location string = resourceGroup().location\n\n// Create the virtual network\nresource vnet 'Microsoft.Network/virtualNetworks@2023-11-01' = {\n  name: 'CoreVnet'\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.1.0.0/16'\n      ]\n    }\n    subnets: [\n      {\n        name: 'default'\n        properties: {\n          addressPrefix: '10.1.0.0/24'\n        }\n      }\n    ]\n  }\n}\n\n// Get the subnet reference\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2023-11-01' existing = {\n  parent: vnet\n  name: 'default'\n}\n\n// Create a public IP address\nresource publicIp 'Microsoft.Network/publicIPAddresses@2023-11-01' = {\n  name: 'windows-bastion-ip'\n  location: location\n  sku: {\n    name: 'Basic'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n\n// Create a network interface\nresource nic 'Microsoft.Network/networkInterfaces@2023-11-01' = {\n  name: 'windows-bastion-nic'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          subnet: {\n            id: subnet.id\n          }\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: publicIp.id\n          }\n        }\n      }\n    ]\n  }\n}\n\n// Create the virtual machine\nresource vm 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: vmName\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: 'Standard_B2s'\n    }\n    osProfile: {\n      computerName: vmName\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2019-Datacenter'\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: nic.id\n        }\n      ]\n    }\n  }\n}\n\n// Outputs\noutput vnetName string = vnet.name\noutput subnetName string = subnet.name\noutput vnetResourceGroupName string = resourceGroup().name\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1150."}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Machine Learning service workspace.')\nparam workspaceName string = 'workspace${uniqueString(resourceGroup().id)}'\n\n@description('Specifies the location for all resources.')\n@allowed([\n  'australiaeast'\n  'brazilsouth'\n  'canadacentral'\n  'centralus'\n  'eastasia'\n  'eastus'\n  'eastus2'\n  'francecentral'\n  'japaneast'\n  'koreacentral'\n  'northcentralus'\n  'northeurope'\n  'southeastasia'\n  'southcentralus'\n  'uksouth'\n  'westcentralus'\n  'westus'\n  'westus2'\n  'westeurope'\n])\nparam location string\n\n@description('Specifies the VM size of the agents.')\nparam vmSize string = 'Standard_D4_v3'\n\n@description('Specifies the agent count.')\nparam agentCount int = 3\n\nvar storageAccountName = 'sa${uniqueString(resourceGroup().id)}'\nvar storageAccountType = 'Standard_LRS'\nvar keyVaultName = 'kv${uniqueString(resourceGroup().id)}'\nvar tenantId = subscription().tenantId\nvar applicationInsightsName = 'ai${uniqueString(resourceGroup().id)}'\nvar containerRegistryName = 'cr${uniqueString(resourceGroup().id)}'\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'StorageV2'\n  properties: {\n    encryption: {\n      services: {\n        blob: {\n          enabled: true\n        }\n        file: {\n          enabled: true\n        }\n      }\n      keySource: 'Microsoft.Storage'\n    }\n    supportsHttpsTrafficOnly: true\n    allowBlobPublicAccess: false\n    minimumTlsVersion: 'TLS1_2'\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n  }\n}\n\nresource keyVault 'Microsoft.KeyVault/vaults@2022-07-01' = {\n  name: keyVaultName\n  location: location\n  properties: {\n    tenantId: tenantId\n    sku: {\n      name: 'standard'\n      family: 'A'\n    }\n    accessPolicies: []\n  }\n}\n\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: (((location == 'eastus2') || (location == 'westcentralus')) ? 'southcentralus' : location)\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n  }\n}\n\nresource containerRegistry 'Microsoft.ContainerRegistry/registries@2022-02-01-preview' = {\n  name: containerRegistryName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    adminUserEnabled: false\n  }\n}\n\nresource workspace 'Microsoft.MachineLearningServices/workspaces@2022-10-01' = {\n  name: workspaceName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    friendlyName: workspaceName\n    keyVault: keyVault.id\n    applicationInsights: applicationInsights.id\n    containerRegistry: containerRegistry.id\n    storageAccount: storageAccount.id\n  }\n}\n\nresource workspaceCompute 'Microsoft.MachineLearningServices/workspaces/computes@2022-10-01' = {\n  parent: workspace\n  name: 'compute-with-ilb'\n  location: location\n  properties: {\n    computeType: 'AKS'\n    computeLocation: location\n    properties: {\n      agentVmSize: vmSize\n      agentCount: agentCount\n      loadBalancerType: 'InternalLoadBalancer'\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1151?"}, {"role": "assistant", "content": "@description('Specifies the name of the deployment.')\nparam name string\n\n@description('Specifies the name of the environment.')\nparam environment string\n\n@description('Specifies the location of the Azure Machine Learning workspace and dependent resources.')\n@allowed([\n  'australiaeast'\n  'brazilsouth'\n  'canadacentral'\n  'centralus'\n  'eastasia'\n  'eastus'\n  'eastus2'\n  'francecentral'\n  'japaneast'\n  'koreacentral'\n  'northcentralus'\n  'northeurope'\n  'southeastasia'\n  'southcentralus'\n  'uksouth'\n  'westcentralus'\n  'westus'\n  'westus2'\n  'westeurope'\n  'usgovvirginia'\n])\nparam location string\n\nvar tenantId = subscription().tenantId\nvar storageAccountName = 'st${name}${environment}'\nvar keyVaultName = 'kv-${name}-${environment}'\nvar applicationInsightsName = 'appi-${name}-${environment}'\nvar containerRegistryName = 'cr${name}${environment}'\nvar workspaceName = 'mlw${name}${environment}'\nvar storageAccountId = storageAccount.id\nvar keyVaultId = vault.id\nvar applicationInsightId = applicationInsight.id\nvar containerRegistryId = registry.id\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_RAGRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    encryption: {\n      services: {\n        blob: {\n          enabled: true\n        }\n        file: {\n          enabled: true\n        }\n      }\n      keySource: 'Microsoft.Storage'\n    }\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    allowBlobPublicAccess: false\n    networkAcls: {\n      defaultAction: 'Deny'\n    }\n  }\n}\n\nresource vault 'Microsoft.KeyVault/vaults@2022-07-01' = {\n  name: keyVaultName\n  location: location\n  properties: {\n    tenantId: tenantId\n    sku: {\n      name: 'standard'\n      family: 'A'\n    }\n    accessPolicies: []\n    enableSoftDelete: true\n  }\n}\n\nresource applicationInsight 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: location\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n  }\n}\n\nresource registry 'Microsoft.ContainerRegistry/registries@2022-02-01-preview' = {\n  sku: {\n    name: 'Standard'\n  }\n  name: containerRegistryName\n  location: location\n  properties: {\n    adminUserEnabled: false\n  }\n}\n\nresource workspace 'Microsoft.MachineLearningServices/workspaces@2022-10-01' = {\n  identity: {\n    type: 'SystemAssigned'\n  }\n  name: workspaceName\n  location: location\n  properties: {\n    friendlyName: workspaceName\n    storageAccount: storageAccountId\n    keyVault: keyVaultId\n    applicationInsights: applicationInsightId\n    containerRegistry: containerRegistryId\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1152."}, {"role": "assistant", "content": "@description('Specifies the name of the deployment that is used to generate resource names.')\nparam name string\n\n@description('Specifies the name of the environment that is used to generate resource names.')\nparam environment string\n\n@description('Specifies the location of the Azure Machine Learning workspace and dependent resources.')\n@allowed([\n  'australiaeast'\n  'brazilsouth'\n  'canadacentral'\n  'centralus'\n  'eastasia'\n  'eastus'\n  'eastus2'\n  'francecentral'\n  'japaneast'\n  'koreacentral'\n  'northcentralus'\n  'northeurope'\n  'southeastasia'\n  'southcentralus'\n  'uksouth'\n  'westcentralus'\n  'westus'\n  'westus2'\n  'westeurope'\n  'usgovvirginia'\n  'usgovarizona'\n])\nparam location string\n\n@description('Specifies whether to reduce telemetry collection and enable additional encryption.')\n@allowed([\n  false\n  true\n])\nparam hbi_workspace bool = true\n\n@description('Specifies if the Azure Machine Learning workspace should be encrypted with the customer managed key.')\n@allowed([\n  'Enabled'\n  'Disabled'\n])\nparam encryption_status string = 'Enabled'\n\n@description('Specifies the customer managed keyvault Resource Manager ID.')\nparam cmk_keyvault_id string\n\n@description('Specifies the customer managed keyvault key uri.')\nparam cmk_keyvault_key_uri string\n\nvar tenantId = subscription().tenantId\nvar storageAccountName = 'st${name}${environment}'\nvar keyVaultName = 'kv-${name}-${environment}'\nvar applicationInsightsName = 'appi-${name}-${environment}'\nvar containerRegistryName = 'cr${name}${environment}'\nvar workspaceName = 'mlw${name}${environment}'\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_RAGRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    encryption: {\n      services: {\n        blob: {\n          enabled: true\n        }\n        file: {\n          enabled: true\n        }\n      }\n      keySource: 'Microsoft.Storage'\n    }\n    supportsHttpsTrafficOnly: true\n    allowBlobPublicAccess: false\n  }\n}\n\nresource vault 'Microsoft.KeyVault/vaults@2022-07-01' = {\n  name: keyVaultName\n  location: location\n  properties: {\n    tenantId: tenantId\n    sku: {\n      name: 'standard'\n      family: 'A'\n    }\n    accessPolicies: []\n    enableSoftDelete: true\n    enablePurgeProtection: true\n  }\n}\n\nresource insight 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: (((location == 'eastus2') || (location == 'westcentralus')) ? 'southcentralus' : location)\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n  }\n}\n\nresource registry 'Microsoft.ContainerRegistry/registries@2022-02-01-preview' = {\n  name: containerRegistryName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    adminUserEnabled: true\n  }\n}\n\nresource workspace 'Microsoft.MachineLearningServices/workspaces@2022-10-01' = {\n  name: workspaceName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    friendlyName: workspaceName\n    storageAccount: storageAccount.id\n    keyVault: vault.id\n    applicationInsights: insight.id\n    containerRegistry: registry.id\n    hbiWorkspace: hbi_workspace\n    encryption: {\n      status: encryption_status\n      keyVaultProperties: {\n        keyVaultArmId: cmk_keyvault_id\n        keyIdentifier: cmk_keyvault_key_uri\n      }\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1153."}, {"role": "assistant", "content": "@description('Specifies the name of the deployment that is used to generate resource names.')\n@minLength(1)\nparam name string\n\n@minLength(1)\n@description('Specifies the name of the environment that is used to generate resource names.')\nparam environment string\n\n@description('Specifies the location of the Azure Machine Learning workspace and dependent resources.')\n@allowed([\n  'australiaeast'\n  'brazilsouth'\n  'canadacentral'\n  'centralus'\n  'centralindia'\n  'eastasia'\n  'eastus'\n  'eastus2'\n  'francecentral'\n  'japaneast'\n  'koreacentral'\n  'northcentralus'\n  'northeurope'\n  'southeastasia'\n  'southcentralus'\n  'uksouth'\n  'westcentralus'\n  'westus'\n  'westus2'\n  'westeurope'\n])\nparam location string\n\n@description('Specifies whether to reduce telemetry collection and enable additional encryption.')\n@allowed([\n  false\n  true\n])\nparam hbi_workspace bool = true\n\n@description('Specifies if the Azure Machine Learning workspace should be encrypted with the customer managed key.')\n@allowed([\n  'Enabled'\n  'Disabled'\n])\nparam encryption_status string = 'Enabled'\n\n@description('Specifies the customer managed keyvault Resource Manager ID.')\nparam cmk_keyvault_id string\n\n@description('Specifies the customer managed keyvault key uri.')\nparam cmk_keyvault_key_uri string\n\nvar tenantId = subscription().tenantId\nvar storageAccountName = 'st${name}${environment}'\nvar keyVaultName = 'kv-${name}-${environment}'\nvar applicationInsightsName = 'appi-${name}-${environment}'\nvar containerRegistryName = 'cr${name}${environment}'\nvar workspaceName = 'mlw${name}${environment}'\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_RAGRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    encryption: {\n      services: {\n        blob: {\n          enabled: true\n        }\n        file: {\n          enabled: true\n        }\n      }\n      keySource: 'Microsoft.Storage'\n    }\n    minimumTlsVersion: 'TLS1_2'\n    supportsHttpsTrafficOnly: true\n    allowBlobPublicAccess: false\n  }\n}\n\nresource vault 'Microsoft.KeyVault/vaults@2022-07-01' = {\n  name: keyVaultName\n  location: location\n  properties: {\n    tenantId: tenantId\n    sku: {\n      name: 'standard'\n      family: 'A'\n    }\n    accessPolicies: []\n    enableSoftDelete: true\n    enablePurgeProtection: true\n  }\n}\n\nresource insight 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: (((location == 'eastus2') || (location == 'westcentralus')) ? 'southcentralus' : location)\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n  }\n}\n\nresource registry 'Microsoft.ContainerRegistry/registries@2023-07-01' = {\n  name: containerRegistryName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    adminUserEnabled: true\n  }\n}\n\nresource workspace 'Microsoft.MachineLearningServices/workspaces@2024-04-01-preview' = {\n  name: workspaceName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    friendlyName: workspaceName\n    storageAccount: storageAccount.id\n    keyVault: vault.id\n    applicationInsights: insight.id\n    containerRegistry: registry.id\n    hbiWorkspace: hbi_workspace\n    encryption: {\n      status: encryption_status\n      keyVaultProperties: {\n        keyVaultArmId: cmk_keyvault_id\n        keyIdentifier: cmk_keyvault_key_uri\n      }\n    }\n    enableServiceSideCMKEncryption: true\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1154?"}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Machine Learning workspace.')\nparam workspaceName string\n\n@description('Specifies the location for workspace.')\nparam location string\n\n@description('Specifies the identity type of the Azure Machine Learning workspace.')\n@allowed([\n  'systemAssigned'\n  'userAssigned'\n  'systemAssigned,userAssigned'\n])\nparam identityType string = 'systemAssigned'\n\n@description('Specifies the resource group of user assigned identity that represents the Azure Machine Learing workspace.')\nparam primaryUserAssignedIdentityResourceGroup string = resourceGroup().name\n\n@description('Specifies the name of user assigned identity that represents the Azure Machine Learing    workspace.')\nparam primaryUserAssignedIdentityName string = ''\n\n@description('Specifies the resource group of user assigned identity that needs to be used to access the key for encryption.')\nparam cmkUserAssignedIdentityResourceGroup string = resourceGroup().name\n\n@description('Specifies the name of user assigned identity that needs to be used to access the key for encryption.')\nparam cmkUserAssignedIdentityName string = ''\n\n@description('Tags for workspace, will also be populated if provisioning new dependent resources.')\nparam tagValues object = {\n}\n\n@description('Determines whether or not a new storage should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n])\nparam storageAccountOption string = 'new'\n\n@description('Name of the storage account.')\nparam storageAccountName string = 'sa${uniqueString(resourceGroup().id, workspaceName)}'\n\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n  'Standard_ZRS'\n  'Standard_GZRS'\n  'Standard_RAGZRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('Determines whether or not to put the storage account behind VNet')\n@allowed([\n  'true'\n  'false'\n])\nparam storageAccountBehindVNet string = 'false'\n\n@description('Resource group name of the storage account if using existing one')\nparam storageAccountResourceGroupName string = resourceGroup().name\n\n@description('Determines whether or not a new key vault should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n])\nparam keyVaultOption string = 'new'\n\n@description('Name of the key vault.')\nparam keyVaultName string = 'kv${uniqueString(resourceGroup().id, workspaceName)}'\n\n@description('Determines whether or not to put the storage account behind VNet')\n@allowed([\n  'true'\n  'false'\n])\nparam keyVaultBehindVNet string = 'false'\n\n@description('Resource group name of the key vault if using existing one')\nparam keyVaultResourceGroupName string = resourceGroup().name\n\n@description('Determines whether or not new ApplicationInsights should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n])\nparam applicationInsightsOption string = 'new'\n\n@description('Name of ApplicationInsights.')\nparam applicationInsightsName string = 'ai${uniqueString(resourceGroup().id, workspaceName)}'\n\n@description('Resource group name of the application insights if using existing one.')\nparam applicationInsightsResourceGroupName string = resourceGroup().name\n\n@description('Determines whether or not a new container registry should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n  'none'\n])\nparam containerRegistryOption string = 'none'\n\n@description('The container registry bind to the workspace.')\nparam containerRegistryName string = 'cr${uniqueString(resourceGroup().id, workspaceName)}'\n\n@allowed([\n  'Basic'\n  'Standard'\n  'Premium'\n])\nparam containerRegistrySku string = 'Standard'\n\n@description('Resource group name of the container registry if using existing one.')\nparam containerRegistryResourceGroupName string = resourceGroup().name\n\n@description('Determines whether or not to put container registry behind VNet.')\n@allowed([\n  'true'\n  'false'\n])\nparam containerRegistryBehindVNet string = 'false'\n\n@description('Determines whether or not a new VNet should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n  'none'\n])\nparam vnetOption string = ((privateEndpointType == 'none') ? 'none' : 'new')\n\n@description('Name of the VNet')\nparam vnetName string = 'vn${uniqueString(resourceGroup().id, workspaceName)}'\n\n@description('Resource group name of the VNET if using existing one.')\nparam vnetResourceGroupName string = resourceGroup().name\n\n@description('Required if existing VNET location differs from workspace location')\nparam vnetLocation string = location\n\n@description('Address prefix of the virtual network')\nparam addressPrefixes array = [\n  '10.0.0.0/16'\n]\n\n@description('Determines whether or not a new subnet should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n  'none'\n])\nparam subnetOption string = (((privateEndpointType != 'none') || (vnetOption == 'new')) ? 'new' : 'none')\n\n@description('Name of the subnet')\nparam subnetName string = 'sn${uniqueString(resourceGroup().id, workspaceName)}'\n\n@description('Subnet prefix of the virtual network')\nparam subnetPrefix string = '10.0.0.0/24'\n\n@description('Azure Databrick workspace to be linked to the workspace')\nparam adbWorkspaceId string = ''\n\n@description('Specifies that the Azure Machine Learning workspace holds highly confidential data.')\n@allowed([\n  false\n  true\n])\nparam confidential_data bool = false\n\n@description('Specifies if the Azure Machine Learning workspace should be encrypted with customer managed key.')\n@allowed([\n  'Enabled'\n  'Disabled'\n])\nparam encryption_status string = 'Disabled'\n\n@description('Specifies the customer managed keyVault arm id. Required when encryption is enabled')\nparam cmk_keyvault string = ''\n\n@description('Specifies if the customer managed keyvault key uri. Required when encryption is enabled')\nparam resource_cmk_uri string = ''\n\n@allowed([\n  'AutoApproval'\n  'ManualApproval'\n  'none'\n])\nparam privateEndpointType string = 'none'\n\nvar tenantId = subscription().tenantId\n\nvar storageAccountId = resourceId(storageAccountResourceGroupName, 'Microsoft.Storage/storageAccounts', storageAccountName)\nvar keyVaultId = resourceId(keyVaultResourceGroupName, 'Microsoft.KeyVault/vaults', keyVaultName)\nvar containerRegistryId = resourceId(containerRegistryResourceGroupName, 'Microsoft.ContainerRegistry/registries', containerRegistryName)\nvar applicationInsightId = resourceId(applicationInsightsResourceGroupName, 'Microsoft.Insights/components', applicationInsightsName)\nvar vnetId = resourceId(vnetResourceGroupName, 'Microsoft.Network/virtualNetworks', vnetName)\nvar subnetId = resourceId(vnetResourceGroupName, 'Microsoft.Network/virtualNetworks/subnets', vnetName, subnetName)\n\nvar privateDnsZoneName = {\n  azureusgovernment: 'privatelink.api.ml.azure.us'\n  azurechinacloud: 'privatelink.api.ml.azure.cn'\n  azurecloud: 'privatelink.api.azureml.ms'\n}\nvar privateAznbDnsZoneName = {\n  azureusgovernment: 'privatelink.notebooks.usgovcloudapi.net'\n  azurecloud: 'privatelink.notebooks.azure.net'\n  azurechinacloud: 'privatelink.notebooks.chinacloudapi.cn'\n}\nvar enablePE = (privateEndpointType != 'none')\nvar networkRuleSetBehindVNet = {\n  defaultAction: 'deny'\n  virtualNetworkRules: [\n    {\n      action: 'Allow'\n      id: subnetId\n    }\n  ]\n}\nvar serviceEndpointsAll = [\n  {\n    service: 'Microsoft.Storage'\n  }\n  {\n    service: 'Microsoft.KeyVault'\n  }\n  {\n    service: 'Microsoft.ContainerRegistry'\n  }\n]\nvar serviceEndpointsAzureChinaCloud = [\n  {\n    service: 'Microsoft.Storage'\n  }\n  {\n    service: 'Microsoft.KeyVault'\n  }\n]\nvar privateEndpointSettings = {\n  name: '${workspaceName}-PrivateEndpoint'\n  properties: {\n    privateLinkServiceId: workspace.id\n    groupIds: [\n      'amlworkspace'\n    ]\n  }\n}\nvar defaultPEConnections = array(privateEndpointSettings)\nvar userAssignedIdentities = union(userAssignedIdentitiesPrimary, userAssignedIdentitiesCmk)\nvar userAssignedIdentityPrimary = {\n  '${primaryUserAssignedIdentity}': {\n  }\n}\nvar userAssignedIdentitiesPrimary = ((primaryUserAssignedIdentityName != '') ? userAssignedIdentityPrimary : json('{}'))\nvar primaryUserAssignedIdentity = resourceId(primaryUserAssignedIdentityResourceGroup, 'Microsoft.ManagedIdentity/userAssignedIdentities', primaryUserAssignedIdentityName)\nvar userAssignedIdentityCmk = {\n  '${cmkUserAssignedIdentity}': {\n  }\n}\nvar userAssignedIdentitiesCmk = ((cmkUserAssignedIdentityName != '') ? userAssignedIdentityCmk : json('{}'))\nvar cmkUserAssignedIdentity = resourceId(cmkUserAssignedIdentityResourceGroup, 'Microsoft.ManagedIdentity/userAssignedIdentities', cmkUserAssignedIdentityName)\nvar encryptionUserAssignedIdentity = {\n  userAssignedIdentity: cmkUserAssignedIdentity\n}\nvar encryptionIdentity = ((cmkUserAssignedIdentityName != '') ? encryptionUserAssignedIdentity : json('{}'))\nvar appInsightsLocation = (((location == 'westcentralus') || (location == 'eastus2euap') || (location == 'centraluseuap') || (location == 'westus3')) ? 'southcentralus' : ((location == 'canadaeast') ? 'canadacentral' : ((location == 'qatarcentral') ? 'uaenorth' : ((location == 'spaincentral') ? 'francecentral' : location))))\n\nresource vnet 'Microsoft.Network/virtualNetworks@2022-05-01' = if (vnetOption == 'new') {\n  name: vnetName\n  location: location\n  tags: tagValues\n  properties: {\n    addressSpace: {\n      addressPrefixes: addressPrefixes\n    }\n    enableDdosProtection: false\n    enableVmProtection: false\n  }\n}\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2022-05-01' = if (subnetOption == 'new') {\n  parent: vnet\n  name: subnetName\n  properties: {\n    addressPrefix: subnetPrefix\n    privateLinkServiceNetworkPolicies: 'Enabled'\n    serviceEndpoints: ((toLower(environment().name) == 'azurechinacloud') ? serviceEndpointsAzureChinaCloud : serviceEndpointsAll)\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = if (storageAccountOption == 'new') {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'StorageV2'\n  tags: tagValues\n  dependsOn: [\n    subnet\n  ]\n  properties: {\n    encryption: {\n      services: {\n        blob: {\n          enabled: true\n        }\n        file: {\n          enabled: true\n        }\n      }\n      keySource: 'Microsoft.Storage'\n    }\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    allowBlobPublicAccess: false\n    networkAcls: ((storageAccountBehindVNet == 'true') ? networkRuleSetBehindVNet : json('null'))\n  }\n}\n\nresource vault 'Microsoft.KeyVault/vaults@2022-07-01' = if (keyVaultOption == 'new') {\n  name: keyVaultName\n  location: location\n  tags: tagValues\n  dependsOn: [\n    subnet\n  ]\n  properties: {\n    tenantId: tenantId\n    sku: {\n      name: 'standard'\n      family: 'A'\n    }\n    accessPolicies: []\n    networkAcls: ((keyVaultBehindVNet == 'true') ? networkRuleSetBehindVNet : json('null'))\n  }\n}\n\nresource registry 'Microsoft.ContainerRegistry/registries@2022-02-01-preview' = if (containerRegistryOption == 'new') {\n  name: containerRegistryName\n  location: location\n  sku: {\n    name: containerRegistrySku\n  }\n  tags: tagValues\n  dependsOn:  [\n    subnet\n  ]\n  properties: {\n    adminUserEnabled: true\n    networkRuleSet: ((containerRegistryBehindVNet == 'true') ? networkRuleSetBehindVNet : json('null'))\n  }\n}\n\nresource insight 'Microsoft.Insights/components@2020-02-02' = if (applicationInsightsOption == 'new') {\n  name: applicationInsightsName\n  location: appInsightsLocation\n  kind: 'web'\n  tags: tagValues\n  properties: {\n    Application_Type: 'web'\n  }\n}\n\nresource workspace 'Microsoft.MachineLearningServices/workspaces@2022-10-01' = {\n  name: workspaceName\n  location: location\n  identity: {\n    type: identityType\n    userAssignedIdentities: (((identityType == 'userAssigned') || (identityType == 'systemAssigned,userAssigned')) ? userAssignedIdentities : json('null'))\n  }\n  tags: tagValues\n  dependsOn: [\n    storageAccount\n    vault\n    registry\n    insight\n  ]\n  properties: {\n    friendlyName: workspaceName\n    storageAccount: storageAccountId\n    keyVault: keyVaultId\n    applicationInsights: applicationInsightId\n    containerRegistry: ((containerRegistryOption != 'none') ? containerRegistryId : json('null'))\n    adbWorkspace: ((adbWorkspaceId == '') ? json('null') : adbWorkspaceId)\n    primaryUserAssignedIdentity: ((identityType == 'userAssigned') ? primaryUserAssignedIdentity : json('null'))\n    encryption: {\n      status: encryption_status\n      identity: encryptionIdentity\n      keyVaultProperties: {\n        keyVaultArmId: cmk_keyvault\n        keyIdentifier: resource_cmk_uri\n      }\n    }\n    hbiWorkspace: confidential_data\n    publicNetworkAccess: 'Disabled'\n  }\n}\n\nmodule DeployPrivateEndpoints './nested_DeployPrivateEndpoints.bicep' = {\n  name: 'DeployPrivateEndpoints'\n  scope: resourceGroup(vnetResourceGroupName)\n  params: {\n    enablePE: enablePE\n    defaultPEConnections: defaultPEConnections\n    subnetId: subnetId\n    privateDnsZoneName: privateDnsZoneName\n    privateAznbDnsZoneName: privateAznbDnsZoneName\n    vnetId: vnetId\n    workspaceName: workspaceName\n    vnetLocation: vnetLocation\n    tagValues: tagValues\n    privateEndpointType: privateEndpointType\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1155."}, {"role": "assistant", "content": "param enablePE bool\nparam defaultPEConnections array\nparam subnetId string\nparam privateDnsZoneName object\nparam privateAznbDnsZoneName object\nparam vnetId string\n\n@description('Specifies the name of the Azure Machine Learning workspace.')\nparam workspaceName string\n\n@description('Required if existing VNET location differs from workspace location')\nparam vnetLocation string\n\n@description('Tags for workspace, will also be populated if provisioning new dependent resources.')\nparam tagValues object\n\n@allowed([\n  'AutoApproval'\n  'ManualApproval'\n  'none'\n])\nparam privateEndpointType string\n\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2022-05-01' = if (enablePE) {\n  name: '${workspaceName}-PrivateEndpoint'\n  location: vnetLocation\n  tags: tagValues\n  properties: {\n    privateLinkServiceConnections: ((privateEndpointType == 'AutoApproval') ? defaultPEConnections : json('null'))\n    manualPrivateLinkServiceConnections: ((privateEndpointType == 'ManualApproval') ? defaultPEConnections : json('null'))\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource privateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = if (privateEndpointType == 'AutoApproval') {\n  name: privateDnsZoneName[toLower(environment().name)]\n  location: 'global'\n  tags: tagValues\n  properties: {\n  }\n  dependsOn: [\n    privateEndpoint\n  ]\n}\n\nresource privateAznbDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = if (privateEndpointType == 'AutoApproval') {\n  name: privateAznbDnsZoneName[toLower(environment().name)]\n  location: 'global'\n  tags: tagValues\n  properties: {\n  }\n  dependsOn: [\n    privateEndpoint\n  ]\n}\n\nresource privateDnsZoneVnLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = if (privateEndpointType == 'AutoApproval') {\n  parent: privateDnsZone\n  name: uniqueString(vnetId)\n  location: 'global'\n  tags: tagValues\n  properties: {\n    virtualNetwork: {\n      id: vnetId\n    }\n    registrationEnabled: false\n  }\n  dependsOn: [\n    privateEndpoint\n  ]\n}\n\nresource privateAznbDnsZoneVnLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = if (privateEndpointType == 'AutoApproval') {\n  parent: privateAznbDnsZone\n  name: uniqueString(vnetId)\n  location: 'global'\n  tags: tagValues\n  properties: {\n    virtualNetwork: {\n      id: vnetId\n    }\n    registrationEnabled: false\n  }\n  dependsOn: [\n    privateEndpoint\n  ]\n}\n\nresource privateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-05-01' = if (privateEndpointType == 'AutoApproval') {\n  parent: privateEndpoint\n  name: 'default'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'privatelink-api-azureml-ms'\n        properties: {\n          privateDnsZoneId: privateDnsZone.id\n        }\n      }\n      {\n        name: 'privatelink-notebooks-azure-net'\n        properties: {\n          privateDnsZoneId: privateAznbDnsZone.id\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1156."}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Machine Learning workspace.')\nparam workspaceName string\n\n@description('Specifies the location for workspace.')\nparam location string\n\n@description('Specifies the identity type of the Azure Machine Learning workspace.')\n@allowed([\n  'systemAssigned'\n  'userAssigned'\n  'systemAssigned,userAssigned'\n])\nparam identityType string = 'systemAssigned'\n\n@description('Specifies the resource group of user assigned identity that represents the Azure Machine Learing workspace.')\nparam primaryUserAssignedIdentityResourceGroup string = resourceGroup().name\n\n@description('Specifies the name of user assigned identity that represents the Azure Machine Learing    workspace.')\nparam primaryUserAssignedIdentityName string = ''\n\n@description('Specifies the resource group of user assigned identity that needs to be used to access the key for encryption.')\nparam cmkUserAssignedIdentityResourceGroup string = resourceGroup().name\n\n@description('Specifies the name of user assigned identity that needs to be used to access the key for encryption.')\nparam cmkUserAssignedIdentityName string = ''\n\n@description('Tags for workspace, will also be populated if provisioning new dependent resources.')\nparam tagValues object = {\n}\n\n@description('Determines whether or not a new storage should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n])\nparam storageAccountOption string = 'new'\n\n@description('Name of the storage account.')\nparam storageAccountName string = 'sa${uniqueString(resourceGroup().id, workspaceName)}'\n\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n  'Standard_ZRS'\n  'Standard_GZRS'\n  'Standard_RAGZRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('Determines whether or not to put the storage account behind VNet')\n@allowed([\n  'true'\n  'false'\n])\nparam storageAccountBehindVNet string = 'true'\n\n@description('Resource group name of the storage account if using existing one')\nparam storageAccountResourceGroupName string = resourceGroup().name\n\n@description('Determines whether or not a new key vault should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n])\nparam keyVaultOption string = 'new'\n\n@description('Name of the key vault.')\nparam keyVaultName string = 'kv${uniqueString(resourceGroup().id, workspaceName)}'\n\n@description('Determines whether or not to put the storage account behind VNet')\n@allowed([\n  'true'\n  'false'\n])\nparam keyVaultBehindVNet string = 'false'\n\n@description('Resource group name of the key vault if using existing one')\nparam keyVaultResourceGroupName string = resourceGroup().name\n\n@description('Determines whether or not new ApplicationInsights should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n])\nparam applicationInsightsOption string = 'new'\n\n@description('Name of ApplicationInsights.')\nparam applicationInsightsName string = 'ai${uniqueString(resourceGroup().id, workspaceName)}'\n\n@description('Resource group name of the application insights if using existing one.')\nparam applicationInsightsResourceGroupName string = resourceGroup().name\n\n@description('Determines whether or not a new container registry should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n  'none'\n])\nparam containerRegistryOption string = 'none'\n\n@description('The container registry bind to the workspace.')\nparam containerRegistryName string = 'cr${uniqueString(resourceGroup().id, workspaceName)}'\n\n@allowed([\n  'Basic'\n  'Standard'\n  'Premium'\n])\nparam containerRegistrySku string = 'Standard'\n\n@description('Resource group name of the container registry if using existing one.')\nparam containerRegistryResourceGroupName string = resourceGroup().name\n\n@description('Determines whether or not to put container registry behind VNet.')\n@allowed([\n  'true'\n  'false'\n])\nparam containerRegistryBehindVNet string = 'false'\n\n@description('Determines whether or not a new VNet should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n  'none'\n])\nparam vnetOption string = ((privateEndpointType == 'none') ? 'none' : 'new')\n\n@description('Name of the VNet')\nparam vnetName string = 'vn${uniqueString(resourceGroup().id, workspaceName)}'\n\n@description('Resource group name of the VNET if using existing one.')\nparam vnetResourceGroupName string = resourceGroup().name\n\n@description('Required if existing VNET location differs from workspace location')\nparam vnetLocation string = location\n\n@description('Address prefix of the virtual network')\nparam addressPrefixes array = [\n  '10.0.0.0/16'\n]\n\n@description('Determines whether or not a new subnet should be provisioned.')\n@allowed([\n  'new'\n  'existing'\n  'none'\n])\nparam subnetOption string = (((privateEndpointType != 'none') || (vnetOption == 'new')) ? 'new' : 'none')\n\n@description('Name of the subnet')\nparam subnetName string = 'sn${uniqueString(resourceGroup().id, workspaceName)}'\n\n@description('Subnet prefix of the virtual network')\nparam subnetPrefix string = '10.0.0.0/24'\n\n@description('Specifies that the Azure Machine Learning workspace holds highly confidential data.')\n@allowed([\n  false\n  true\n])\nparam confidential_data bool = false\n\n@description('Specifies if the Azure Machine Learning workspace should be encrypted with customer managed key.')\n@allowed([\n  'Enabled'\n  'Disabled'\n])\nparam encryption_status string = 'Disabled'\n\n@description('Specifies the customer managed keyVault arm id. Required when encryption is enabled')\nparam cmk_keyvault string = ''\n\n@description('Specifies if the customer managed keyvault key uri. Required when encryption is enabled')\nparam resource_cmk_uri string = ''\n\n@allowed([\n  'AutoApproval'\n  'ManualApproval'\n  'none'\n])\nparam privateEndpointType string = 'none'\n\nvar tenantId = subscription().tenantId\nvar storageAccountId = resourceId(storageAccountResourceGroupName, 'Microsoft.Storage/storageAccounts', storageAccountName)\nvar keyVaultId = resourceId(keyVaultResourceGroupName, 'Microsoft.KeyVault/vaults', keyVaultName)\nvar containerRegistryId = resourceId(containerRegistryResourceGroupName, 'Microsoft.ContainerRegistry/registries', containerRegistryName)\nvar applicationInsightsId = resourceId(applicationInsightsResourceGroupName, 'Microsoft.Insights/components', applicationInsightsName)\nvar vnetId = resourceId(vnetResourceGroupName, 'Microsoft.Network/virtualNetworks', vnetName)\nvar subnetId = resourceId(vnetResourceGroupName, 'Microsoft.Network/virtualNetworks/subnets', vnetName, subnetName)\nvar privateDnsZoneName = {\n  azureusgovernment: 'privatelink.api.ml.azure.us'\n  azurechinacloud: 'privatelink.api.ml.azure.cn'\n  azurecloud: 'privatelink.api.azureml.ms'\n}\nvar privateAznbDnsZoneName = {\n  azureusgovernment: 'privatelink.notebooks.usgovcloudapi.net'\n  azurecloud: 'privatelink.notebooks.azure.net'\n  azurechinacloud: 'privatelink.notebooks.chinacloudapi.cn'\n}\nvar enablePE = (privateEndpointType != 'none')\nvar networkRuleSetBehindVNet = {\n  defaultAction: 'deny'\n  virtualNetworkRules: [\n    {\n      action: 'Allow'\n      id: subnetId\n    }\n  ]\n}\nvar serviceEndpointsAll = [\n  {\n    service: 'Microsoft.Storage'\n  }\n  {\n    service: 'Microsoft.KeyVault'\n  }\n  {\n    service: 'Microsoft.ContainerRegistry'\n  }\n]\nvar serviceEndpointsAzureChinaCloud = [\n  {\n    service: 'Microsoft.Storage'\n  }\n  {\n    service: 'Microsoft.KeyVault'\n  }\n]\nvar privateEndpointSettings = {\n  name: '${workspaceName}-PrivateEndpoint'\n  properties: {\n    privateLinkServiceId: workspace.id\n    groupIds: [\n      'amlworkspace'\n    ]\n  }\n}\nvar defaultPEConnections = array(privateEndpointSettings)\nvar userAssignedIdentities = union(userAssignedIdentitiesPrimary, userAssignedIdentitiesCmk)\nvar userAssignedIdentityPrimary = {\n  '${primaryUserAssignedIdentity}': {\n  }\n}\nvar userAssignedIdentitiesPrimary = ((primaryUserAssignedIdentityName != '') ? userAssignedIdentityPrimary : json('{}'))\nvar primaryUserAssignedIdentity = resourceId(primaryUserAssignedIdentityResourceGroup, 'Microsoft.ManagedIdentity/userAssignedIdentities', primaryUserAssignedIdentityName)\nvar userAssignedIdentityCmk = {\n  '${cmkUserAssignedIdentity}': {\n  }\n}\nvar userAssignedIdentitiesCmk = ((cmkUserAssignedIdentityName != '') ? userAssignedIdentityCmk : json('{}'))\nvar cmkUserAssignedIdentity = resourceId(cmkUserAssignedIdentityResourceGroup, 'Microsoft.ManagedIdentity/userAssignedIdentities', cmkUserAssignedIdentityName)\nvar encryptionUserAssignedIdentity = {\n  userAssignedIdentity: cmkUserAssignedIdentity\n}\nvar encryptionIdentity = ((cmkUserAssignedIdentityName != '') ? encryptionUserAssignedIdentity : json('{}'))\nvar appInsightsLocation = (((location == 'westcentralus') || (location == 'eastus2euap') || (location == 'centraluseuap') || (location == 'westus3')) ? 'southcentralus' : ((location == 'canadaeast') ? 'canadacentral' : location))\n\nresource vNet 'Microsoft.Network/virtualNetworks@2022-05-01' = if (vnetOption == 'new') {\n  name: vnetName\n  location: location\n  tags: tagValues\n  properties: {\n    addressSpace: {\n      addressPrefixes: addressPrefixes\n    }\n    enableDdosProtection: false\n    enableVmProtection: false\n  }\n}\n\nresource vNetSubnet 'Microsoft.Network/virtualNetworks/subnets@2022-05-01' = if (subnetOption == 'new') {\n  parent: vNet\n  name: subnetName\n  properties: {\n    addressPrefix: subnetPrefix\n    serviceEndpoints: ((toLower(environment().name) == 'azurechinacloud') ? serviceEndpointsAzureChinaCloud : serviceEndpointsAll)\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = if (storageAccountOption == 'new') {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'StorageV2'\n  tags: tagValues\n  properties: {\n    encryption: {\n      services: {\n        blob: {\n          enabled: true\n        }\n        file: {\n          enabled: true\n        }\n      }\n      keySource: 'Microsoft.Storage'\n    }\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    allowBlobPublicAccess: false\n    networkAcls: ((storageAccountBehindVNet == 'true') ? networkRuleSetBehindVNet : json('null'))\n  }\n  dependsOn: [\n    vNetSubnet\n  ]\n}\n\nresource vault 'Microsoft.KeyVault/vaults@2022-07-01' = if (keyVaultOption == 'new') {\n  name: keyVaultName\n  location: location\n  tags: tagValues\n  properties: {\n    tenantId: tenantId\n    sku: {\n      name: 'standard'\n      family: 'A'\n    }\n    accessPolicies: []\n    networkAcls: ((keyVaultBehindVNet == 'true') ? networkRuleSetBehindVNet : json('null'))\n  }\n  dependsOn: [\n    vNetSubnet\n  ]\n}\n\nresource registry 'Microsoft.ContainerRegistry/registries@2022-02-01-preview' = if (containerRegistryOption == 'new') {\n  name: containerRegistryName\n  location: location\n  sku: {\n    name: containerRegistrySku\n  }\n  tags: tagValues\n  properties: {\n    adminUserEnabled: false\n    networkRuleSet: ((containerRegistryBehindVNet == 'true') ? networkRuleSetBehindVNet : json('null'))\n  }\n  dependsOn: [\n    vNetSubnet\n  ]\n}\n\nresource insight 'Microsoft.Insights/components@2020-02-02' = if (applicationInsightsOption == 'new') {\n  name: applicationInsightsName\n  location: appInsightsLocation\n  kind: 'web'\n  tags: tagValues\n  properties: {\n    Application_Type: 'web'\n  }\n}\n\nresource workspace 'Microsoft.MachineLearningServices/workspaces@2022-10-01' = {\n  name: workspaceName\n  location: location\n  identity: {\n    type: identityType\n    userAssignedIdentities: (((identityType == 'userAssigned') || (identityType == 'systemAssigned,userAssigned')) ? userAssignedIdentities : json('null'))\n  }\n  tags: tagValues\n  properties: {\n    friendlyName: workspaceName\n    storageAccount: storageAccountId\n    keyVault: keyVaultId\n    applicationInsights: applicationInsightsId\n    containerRegistry: ((containerRegistryOption != 'none') ? containerRegistryId : json('null'))\n    primaryUserAssignedIdentity: ((identityType == 'userAssigned') ? primaryUserAssignedIdentity : json('null'))\n    encryption: {\n      status: encryption_status\n      identity: encryptionIdentity\n      keyVaultProperties: {\n        keyVaultArmId: cmk_keyvault\n        keyIdentifier: resource_cmk_uri\n      }\n    }\n    hbiWorkspace: confidential_data\n    publicNetworkAccess: 'Disabled'\n    v1LegacyMode: true\n  }\n  dependsOn: [\n    storageAccount\n    vault\n    insight\n    registry\n  ]\n}\n\nmodule DeployPrivateEndpoints './nested_DeployPrivateEndpoints.bicep' = {\n  name: 'DeployPrivateEndpoints'\n  scope: resourceGroup(vnetResourceGroupName)\n  params: {\n    privateDnsZoneName: privateDnsZoneName\n    privateAznbDnsZoneName: privateAznbDnsZoneName\n    enablePE: enablePE\n    defaultPEConnections: defaultPEConnections\n    subnetId: subnetId\n    vnetId: vnetId\n    workspaceName: workspaceName\n    vnetLocation: vnetLocation\n    tagValues: tagValues\n    privateEndpointType: privateEndpointType\n  }\n  dependsOn: [\n    vNetSubnet\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1157."}, {"role": "assistant", "content": "param privateDnsZoneName object\nparam privateAznbDnsZoneName object\n\nparam enablePE bool\nparam defaultPEConnections array\nparam subnetId string\nparam vnetId string\n\n@description('Specifies the name of the Azure Machine Learning workspace.')\nparam workspaceName string\n\n@description('Required if existing VNET location differs from workspace location')\nparam vnetLocation string\n\n@description('Tags for workspace, will also be populated if provisioning new dependent resources.')\nparam tagValues object\n\n@allowed([\n  'AutoApproval'\n  'ManualApproval'\n  'none'\n])\nparam privateEndpointType string\n\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2022-05-01' = if (enablePE) {\n  name: '${workspaceName}-PrivateEndpoint'\n  location: vnetLocation\n  tags: tagValues\n  properties: {\n    privateLinkServiceConnections: ((privateEndpointType == 'AutoApproval') ? defaultPEConnections : json('null'))\n    manualPrivateLinkServiceConnections: ((privateEndpointType == 'ManualApproval') ? defaultPEConnections : json('null'))\n    subnet: {\n      id: subnetId\n    }\n  }\n}\n\nresource privateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = if (privateEndpointType == 'AutoApproval') {\n  name: privateDnsZoneName[toLower(environment().name)]\n  location: 'global'\n  tags: tagValues\n  dependsOn:[\n    privateEndpoint\n  ]\n  properties: {\n  }\n}\n\nresource privateAznbDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = if (privateEndpointType == 'AutoApproval') {\n  name: privateAznbDnsZoneName[toLower(environment().name)]\n  location: 'global'\n  tags: tagValues\n  dependsOn:[\n    privateEndpoint\n  ]\n  properties: {\n  }\n}\n\nresource dnsVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = if (privateEndpointType == 'AutoApproval') {\n  parent: privateDnsZone\n  name: uniqueString(vnetId)\n  location: 'global'\n  tags: tagValues\n  properties: {\n    virtualNetwork: {\n      id: vnetId\n    }\n    registrationEnabled: false\n  }\n  dependsOn: [\n    privateEndpoint\n  ]\n}\n\nresource aznbDnsVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = if (privateEndpointType == 'AutoApproval') {\n  parent: privateAznbDnsZone\n  name: uniqueString(vnetId)\n  location: 'global'\n  tags: tagValues\n  dependsOn: [\n    privateEndpoint\n  ]\n  properties: {\n    virtualNetwork: {\n      id: vnetId\n    }\n    registrationEnabled: false\n  }\n}\n\nresource privateDnsZoneGroups 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-05-01' = if (privateEndpointType == 'AutoApproval') {\n  parent: privateEndpoint\n  name: 'default'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'privatelink-api-azureml-ms'\n        properties: {\n          privateDnsZoneId: privateDnsZone.id\n        }\n      }\n      {\n        name: 'privatelink-notebooks-azure-net'\n        properties: {\n          privateDnsZoneId: privateAznbDnsZone.id\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1158 please."}, {"role": "assistant", "content": "@description('The name for your Azure Maps account. This value must be globally unique.')\nparam accountName string = uniqueString(resourceGroup().id)\n\n@description('Specifies the location for all the resources.')\n@allowed([\n  'westeurope'\n  'eastus'\n  'westus2'\n  'northeurope'\n  'westcentralus'\n  'usgovvirginia'\n  'usgovarizona'\n])\nparam location string\n\n@description('The pricing tier SKU for the account.')\n@allowed([\n  'G2'\n])\nparam pricingTier string = 'G2'\n\n@description('The pricing tier for the account.')\n@allowed([\n  'Gen2'\n])\nparam kind string = 'Gen2'\n\nresource account 'Microsoft.Maps/accounts@2023-06-01' = {\n  name: accountName\n  location: location\n  sku: {\n    name: pricingTier\n  }\n  kind: kind\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1159?"}, {"role": "assistant", "content": "@description('The name for your Azure Maps account. This value must be globally unique.')\nparam accountName string = uniqueString(resourceGroup().id)\n\n@description('Total available storage units shared across all Creator services. Allowable value between 1 and 100 units. Each unit corresponds to 1 MiB')\n@minValue(1)\n@maxValue(100)\nparam creatorStorageUnits int = 1\n\n@description('Location of the Creator Service')\n@allowed([\n  'East US 2'\n  'West US 2'\n  'North Europe'\n  'West Europe'\n])\nparam creatorLocation string = 'East US 2'\n\nresource mapsResource 'Microsoft.Maps/accounts@2021-02-01' = {\n  name: accountName\n  location: 'global'\n  sku: {\n    name: 'G2'\n  }\n}\n\nresource creatorResource 'Microsoft.Maps/accounts/creators@2021-02-01' = {\n  parent: mapsResource\n  name: 'creator'\n  location: creatorLocation\n  properties: {\n    storageUnits: creatorStorageUnits\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1160."}, {"role": "assistant", "content": "@description('Name of the Media Services account. A Media Services account name is globally unique, all lowercase letters or numbers with no spaces.')\nparam mediaServiceName string = 'mediaserv${uniqueString(resourceGroup().id)}'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar storageAccountName = 'storage${uniqueString(resourceGroup().id)}'\n\nresource mediaService 'Microsoft.Media/mediaservices@2021-06-01' = {\n  name: mediaServiceName\n  location: location\n  properties: {\n    storageAccounts: [\n      {\n        id: storageAccount.id\n        type: 'Primary'\n      }\n    ]\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-08-01' = {\n  name: storageAccountName\n  location: location\n  kind: 'StorageV2'\n  sku: {\n    name: 'Standard_LRS'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1161?"}, {"role": "assistant", "content": "@description('Region where the Mobile Network will be deployed (must match the resource group region)')\nparam location string = resourceGroup().location\n\n@description('The name for the private mobile network')\nparam mobileNetworkName string\n\n@description('The mobile country code for the private mobile network')\nparam mobileCountryCode string = '001'\n\n@description('The mobile network code for the private mobile network')\nparam mobileNetworkCode string = '01'\n\n@description('The name for the site')\nparam siteName string = 'myExampleSite'\n\n@description('The name of the service')\nparam serviceName string = 'Allow-all-traffic'\n\n@description('The name of the SIM policy')\nparam simPolicyName string = 'Default-policy'\n\n@description('The name of the slice')\nparam sliceName string = 'slice-1'\n\n@description('The name for the SIM group.')\nparam simGroupName string = ''\n\n@description('A unversioned key vault key to encrypt the SIM data that belongs to this SIM group. For example: https://contosovault.vault.azure.net/keys/azureKey.')\nparam existingEncryptionKeyUrl string = ''\n\n@description('User-assigned identity is an identity in Azure Active Directory that can be used to give access to other Azure resource such as Azure Key Vault. This identity should have Get, Wrap key, and Unwrap key permissions on the key vault.')\nparam existingUserAssignedIdentityResourceId string = ''\n\n@description('An array containing properties of the SIM(s) you wish to create. See [Provision proxy SIM(s)](https://docs.microsoft.com/en-gb/azure/private-5g-core/provision-sims-azure-portal) for a full description of the required properties and their format.')\nparam simResources array = []\n\n@description('The resource ID of the Azure Stack Edge device to deploy to')\nparam azureStackEdgeDevice string = ''\n\n@description('The virtual network name on port 5 on your Azure Stack Edge Pro device corresponding to the control plane interface on the access network. For 5G, this interface is the N2 interface; for 4G, it\\'s the S1-MME interface.')\nparam controlPlaneAccessInterfaceName string = ''\n\n@description('The IP address of the control plane interface on the access network. In 5G networks this is called the N2 interface whereas in 4G networks this is called the S1-MME interface.')\nparam controlPlaneAccessIpAddress string = ''\n\n@description('The virtual network name on port 5 on your Azure Stack Edge Pro device corresponding to the user plane interface on the access network. For 5G, this interface is the N3 interface; for 4G, it\\'s the S1-U interface.')\nparam userPlaneAccessInterfaceName string = ''\n\n@description('The virtual network name on port 6 on your Azure Stack Edge Pro device corresponding to the user plane interface on the data network. For 5G, this interface is the N6 interface; for 4G, it\\'s the SGi interface.')\nparam userPlaneDataInterfaceName string = ''\n\n@description('The network address of the subnet from which dynamic IP addresses must be allocated to UEs, given in CIDR notation. Optional if userEquipmentStaticAddressPoolPrefix is specified. If both are specified, they must be the same size and not overlap.')\nparam userEquipmentAddressPoolPrefix string = ''\n\n@description('The network address of the subnet from which static IP addresses must be allocated to UEs, given in CIDR notation. Optional if userEquipmentAddressPoolPrefix is specified. If both are specified, they must be the same size and not overlap.')\nparam userEquipmentStaticAddressPoolPrefix string = ''\n\n@description('The name of the data network')\nparam dataNetworkName string = 'internet'\n\n@description('The desired installation state')\nparam desiredState string = 'Uninstalled'\n\n@description('The MTU (in bytes) signaled to the UE. The same MTU is set on the user plane data links for all data networks. The MTU set on the user plane access link is calculated to be 60 bytes greater than this value to allow for GTP encapsulation. ')\nparam ueMtu int = 1440\n\n@description('Provide consent for Microsoft to access non-PII telemetry information from the packet core.')\nparam allowSupportTelemetryAccess bool = true\n\n@description('The mode in which the packet core instance will run')\n@allowed([\n  'EPC'\n  '5GC'\n  'EPC + 5GC'\n])\nparam coreNetworkTechnology string = '5GC'\n\n@description('Whether or not Network Address and Port Translation (NAPT) should be enabled for this data network')\n@allowed([\n  'Enabled'\n  'Disabled'\n])\nparam naptEnabled string\n\n@description('A list of DNS servers that UEs on this data network will use')\nparam dnsAddresses array\n\n@description('The resource ID of the customLocation representing the ASE device where the packet core will be deployed. If this parameter is not specified then the 5G core will be created but will not be deployed to an ASE. [Collect custom location information](https://docs.microsoft.com/en-gb/azure/private-5g-core/collect-required-information-for-a-site#collect-custom-location-information) explains which value to specify here.')\nparam customLocation string = ''\n\n#disable-next-line BCP081\nresource exampleMobileNetwork 'Microsoft.MobileNetwork/mobileNetworks@2024-04-01' = {\n  name: mobileNetworkName\n  location: location\n  properties: {\n    publicLandMobileNetworkIdentifier: {\n      mcc: mobileCountryCode\n      mnc: mobileNetworkCode\n    }\n  }\n}\n\n#disable-next-line BCP081\nresource exampleSite 'Microsoft.MobileNetwork/mobileNetworks/sites@2024-04-01' = {\n  parent: exampleMobileNetwork\n  name: siteName\n  location: location\n}\n\n#disable-next-line BCP081\nresource exampleDataNetwork 'Microsoft.MobileNetwork/mobileNetworks/dataNetworks@2024-04-01' = {\n  parent: exampleMobileNetwork\n  name: dataNetworkName\n  location: location\n  properties: {}\n}\n\n#disable-next-line BCP081\nresource exampleSlice 'Microsoft.MobileNetwork/mobileNetworks/slices@2024-04-01' = {\n  parent: exampleMobileNetwork\n  name: sliceName\n  location: location\n  properties: {\n    snssai: {\n      sst: 1\n    }\n  }\n}\n\n#disable-next-line BCP081\nresource exampleService 'Microsoft.MobileNetwork/mobileNetworks/services@2024-04-01' = {\n  parent: exampleMobileNetwork\n  name: serviceName\n  location: location\n  properties: {\n    servicePrecedence: 253\n    pccRules: [\n      {\n        ruleName: 'All-traffic'\n        rulePrecedence: 253\n        trafficControl: 'Enabled'\n        serviceDataFlowTemplates: [\n          {\n            templateName: 'Any-traffic'\n            protocol: [\n              'ip'\n            ]\n            direction: 'Bidirectional'\n            remoteIpList: [\n              'any'\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n\n#disable-next-line BCP081\nresource exampleSimPolicy 'Microsoft.MobileNetwork/mobileNetworks/simPolicies@2024-04-01' = {\n  parent: exampleMobileNetwork\n  name: simPolicyName\n  location: location\n  properties: {\n    ueAmbr: {\n      uplink: '2 Gbps'\n      downlink: '2 Gbps'\n    }\n    defaultSlice: {\n      id: exampleSlice.id\n    }\n    sliceConfigurations: [\n      {\n        slice: {\n          id: exampleSlice.id\n        }\n        defaultDataNetwork: {\n          id: exampleDataNetwork.id\n        }\n        dataNetworkConfigurations: [\n          {\n            dataNetwork: {\n              id: exampleDataNetwork.id\n            }\n            sessionAmbr: {\n              uplink: '2 Gbps'\n              downlink: '2 Gbps'\n            }\n            allowedServices: [\n              {\n                id: exampleService.id\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n\n#disable-next-line BCP081\nresource exampleSimGroupResource 'Microsoft.MobileNetwork/simGroups@2024-04-01' = if (!empty(simGroupName)) {\n  name: empty(simGroupName) ? 'placeHolderForValidation' : simGroupName\n  location: location\n  properties: {\n    mobileNetwork: {\n      id: exampleMobileNetwork.id\n    }\n    encryptionKey: {\n        keyUrl: existingEncryptionKeyUrl\n    }\n  }\n  identity: !empty(existingUserAssignedIdentityResourceId) ? {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${existingUserAssignedIdentityResourceId}': {}\n    }\n  } : {\n    type: 'None'\n  }\n\n  #disable-next-line BCP081\n  resource exampleSimResources 'sims@2024-04-01' = [for item in simResources: {\n    name: item.simName\n    properties: {\n      integratedCircuitCardIdentifier: item.integratedCircuitCardIdentifier\n      internationalMobileSubscriberIdentity: item.internationalMobileSubscriberIdentity\n      authenticationKey: item.authenticationKey\n      operatorKeyCode: item.operatorKeyCode\n      deviceType: item.deviceType\n      simPolicy: {\n        id: exampleSimPolicy.id\n      }\n    }\n  }]\n}\n\n#disable-next-line BCP081\nresource examplePacketCoreControlPlane 'Microsoft.MobileNetwork/packetCoreControlPlanes@2024-04-01' = {\n  name: siteName\n  location: location\n  dependsOn: [\n    exampleSlice\n  ]\n  properties: {\n    sites: [\n      {\n        id: exampleSite.id\n      }\n    ]\n    sku: 'G0'\n    ueMtu: ueMtu\n    userConsent: {\n      allowSupportTelemetryAccess: allowSupportTelemetryAccess\n    }\n    coreNetworkTechnology: coreNetworkTechnology\n    platform: {\n      type: 'AKS-HCI'\n      customLocation: empty(customLocation) ? null : {\n        id: customLocation\n      }\n      azureStackEdgeDevice: {\n        id: azureStackEdgeDevice\n      }\n    }\n    installation:{\n      desiredState: desiredState\n    }\n    localDiagnosticsAccess: {\n      authenticationType: 'Password'\n    }\n    controlPlaneAccessInterface: {\n      ipv4Address: controlPlaneAccessIpAddress\n      name: controlPlaneAccessInterfaceName\n    }\n  }\n\n  #disable-next-line BCP081\n  resource examplePacketCoreDataPlane 'packetCoreDataPlanes@2024-04-01' = {\n    name: siteName\n    location: location\n    properties: {\n      userPlaneAccessInterface: {\n        name: userPlaneAccessInterfaceName\n      }\n    }\n\n    #disable-next-line BCP081\n    resource exampleAttachedDataNetwork 'attachedDataNetworks@2024-04-01' = {\n      name: dataNetworkName\n      location: location\n      properties: {\n        userPlaneDataInterface: {\n          name: userPlaneDataInterfaceName\n        }\n        userEquipmentAddressPoolPrefix: empty(userEquipmentAddressPoolPrefix) ? null : [\n          userEquipmentAddressPoolPrefix\n        ]\n        userEquipmentStaticAddressPoolPrefix: empty(userEquipmentStaticAddressPoolPrefix) ? null : [\n          userEquipmentStaticAddressPoolPrefix\n        ]\n        naptConfiguration: {\n          enabled: naptEnabled\n        }\n        dnsAddresses: dnsAddresses\n      }\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1162."}, {"role": "assistant", "content": "@description('The name for the AzureStackEdgeName')\nparam azureStackEdgeName string\n\n@description('Region where the AzureStackEdgeName will be deployed (must match the resource group region)')\nparam location string = resourceGroup().location\n\nresource exampleAzureStackEdge 'Microsoft.DataBoxEdge/DataBoxEdgeDevices@2022-03-01' = {\n  name: azureStackEdgeName\n  location: location\n  sku: {\n    name: 'Management'\n    tier: 'Standard'\n  }\n}\n\noutput aseID string = exampleAzureStackEdge.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1163."}, {"role": "assistant", "content": "@description('Region where the Mobile Network will be deployed (must match the resource group region)')\nparam location string\n\n@description('The name for the private mobile network')\nparam mobileNetworkName string\n\n@description('The mobile country code for the private mobile network')\nparam mobileCountryCode string = '001'\n\n@description('The mobile network code for the private mobile network')\nparam mobileNetworkCode string = '01'\n\n@description('The name of the slice')\nparam sliceName string = 'slice-1'\n\n@description('The name of the data network')\nparam dataNetworkName string = 'internet'\n\n#disable-next-line BCP081\nresource exampleMobileNetwork 'Microsoft.MobileNetwork/mobileNetworks@2024-04-01' = {\n  name: mobileNetworkName\n  location: location\n  properties: {\n    publicLandMobileNetworkIdentifier: {\n      mcc: mobileCountryCode\n      mnc: mobileNetworkCode\n    }\n  }\n\n  #disable-next-line BCP081\n  resource exampleDataNetwork 'dataNetworks@2024-04-01' = {\n    name: dataNetworkName\n    location: location\n    properties: {}\n  }\n\n  #disable-next-line BCP081\n  resource exampleSlice 'slices@2024-04-01' = {\n    name: sliceName\n    location: location\n    properties: {\n      snssai: {\n        sst: 1\n      }\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1164?"}, {"role": "assistant", "content": "@description('Region where the mobile network will be deployed (must match the resource group region)')\nparam location string\n\n@description('Name of the mobile network to which you are adding a site')\nparam existingMobileNetworkName string\n\n@description('Name of the existing data network to which the mobile network connects')\nparam existingDataNetworkName string\n\n@description('The name for the site')\nparam siteName string = 'myExampleSite'\n\n@description('The resource ID of the Azure Stack Edge device to deploy to')\nparam azureStackEdgeDevice string = ''\n\n@description('The virtual network name on port 5 on your Azure Stack Edge Pro device corresponding to the control plane interface on the access network. For 5G, this interface is the N2 interface; for 4G, it\\'s the S1-MME interface.')\nparam controlPlaneAccessInterfaceName string = ''\n\n@description('The IP address of the control plane interface on the access network. In 5G networks this is called the N2 interface whereas in 4G networks this is called the S1-MME interface.')\nparam controlPlaneAccessIpAddress string = ''\n\n@description('The virtual network name on port 5 on your Azure Stack Edge Pro device corresponding to the user plane interface on the access network. For 5G, this interface is the N3 interface; for 4G, it\\'s the S1-U interface.')\nparam userPlaneAccessInterfaceName string = ''\n\n@description('The virtual network name on port 6 on your Azure Stack Edge Pro device corresponding to the user plane interface on the data network. For 5G, this interface is the N6 interface; for 4G, it\\'s the SGi interface.')\nparam userPlaneDataInterfaceName string = ''\n\n@description('The network address of the subnet from which dynamic IP addresses must be allocated to UEs, given in CIDR notation. Optional if userEquipmentStaticAddressPoolPrefix is specified. If both are specified, they must be the same size and not overlap.')\nparam userEquipmentAddressPoolPrefix string = ''\n\n@description('The network address of the subnet from which static IP addresses must be allocated to UEs, given in CIDR notation. Optional if userEquipmentAddressPoolPrefix is specified. If both are specified, they must be the same size and not overlap.')\nparam userEquipmentStaticAddressPoolPrefix string = ''\n\n@description('The mode in which the packet core instance will run')\n@allowed([\n  'EPC'\n  '5GC'\n  'EPC + 5GC'\n])\nparam coreNetworkTechnology string = '5GC'\n\n@description('Whether or not Network Address and Port Translation (NAPT) should be enabled for this data network')\n@allowed([\n  'Enabled'\n  'Disabled'\n])\nparam naptEnabled string\n\n@description('A list of DNS servers that UEs on this data network will use')\nparam dnsAddresses array\n\n@description('The resource ID of the custom location that targets the Azure Kubernetes Service on Azure Stack HCI (AKS-HCI) cluster on the Azure Stack Edge Pro device in the site. If this parameter is not specified, the packet core instance will be created but will not be deployed to an ASE. [Collect custom location information](https://docs.microsoft.com/en-gb/azure/private-5g-core/collect-required-information-for-a-site#collect-custom-location-information) explains which value to specify here.')\nparam customLocation string = ''\n\n@description('The desired installation state')\nparam desiredState string = 'Uninstalled'\n\n@description('The MTU (in bytes) signaled to the UE. The same MTU is set on the user plane data links for all data networks. The MTU set on the user plane access link is calculated to be 60 bytes greater than this value to allow for GTP encapsulation. ')\nparam ueMtu int = 1440\n\n@description('Provide consent for Microsoft to access non-PII telemetry information from the packet core.')\nparam allowSupportTelemetryAccess bool = true\n\n#disable-next-line BCP081\nresource existingMobileNetwork 'Microsoft.MobileNetwork/mobileNetworks@2024-04-01' existing = {\n  name: existingMobileNetworkName\n\n  #disable-next-line BCP081\n  resource existingDataNetwork 'dataNetworks@2024-04-01' existing = {\n    name: existingDataNetworkName\n  }\n}\n\n#disable-next-line BCP081\nresource exampleSite 'Microsoft.MobileNetwork/mobileNetworks/sites@2024-04-01' = {\n  name: siteName\n  parent: existingMobileNetwork\n  location: location\n}\n\n#disable-next-line BCP081\nresource examplePacketCoreControlPlane 'Microsoft.MobileNetwork/packetCoreControlPlanes@2024-04-01' = {\n  name: siteName\n  location: location\n  properties: {\n    sites: [\n      {\n        id: exampleSite.id\n      }\n    ]\n    sku: 'G0'\n    localDiagnosticsAccess: {\n      authenticationType: 'Password'\n    }\n    coreNetworkTechnology: coreNetworkTechnology\n    platform: {\n      type: 'AKS-HCI'\n      customLocation: empty(customLocation) ? null : {\n        id: customLocation\n      }\n      azureStackEdgeDevice: {\n        id: azureStackEdgeDevice\n      }\n    }\n    controlPlaneAccessInterface: {\n      ipv4Address: controlPlaneAccessIpAddress\n      name: controlPlaneAccessInterfaceName\n    }\n    installation: {\n      desiredState: desiredState\n    }\n    ueMtu: ueMtu\n    userConsent: {\n      allowSupportTelemetryAccess: allowSupportTelemetryAccess\n    }\n  }\n\n  #disable-next-line BCP081\n  resource examplePacketCoreDataPlane 'packetCoreDataPlanes@2024-04-01' = {\n    name: siteName\n    location: location\n    properties: {\n      userPlaneAccessInterface: {\n        name: userPlaneAccessInterfaceName\n      }\n    }\n\n    #disable-next-line BCP081\n    resource exampleAttachedDataNetwork 'attachedDataNetworks@2024-04-01' = {\n      name: existingDataNetworkName\n      location: location\n      properties: {\n        userPlaneDataInterface: {\n          name: userPlaneDataInterfaceName\n        }\n        userEquipmentAddressPoolPrefix: empty(userEquipmentAddressPoolPrefix) ? null : [\n          userEquipmentAddressPoolPrefix\n        ]\n        userEquipmentStaticAddressPoolPrefix: empty(userEquipmentStaticAddressPoolPrefix) ? null : [\n          userEquipmentStaticAddressPoolPrefix\n        ]\n        naptConfiguration: {\n          enabled: naptEnabled\n        }\n        dnsAddresses: dnsAddresses\n      }\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1165."}, {"role": "assistant", "content": "@description('Region where the Mobile Network will be deployed (must match the resource group region)')\nparam location string = resourceGroup().location\n\n@description('The name for the private mobile network')\nparam mobileNetworkName string\n\n@description('The mobile country code for the private mobile network')\nparam mobileCountryCode string = '001'\n\n@description('The mobile network code for the private mobile network')\nparam mobileNetworkCode string = '01'\n\n@description('The name for the AzureStackEdgeName')\nparam azureStackEdgeName string\n\n@description('The name of the data network')\nparam dataNetworkName string = 'internet'\n\nresource exampleAzureStackEdge 'Microsoft.DataBoxEdge/DataBoxEdgeDevices@2022-03-01' = {\n  name: azureStackEdgeName\n  location: location\n  sku: {\n    name: 'Management'\n    tier: 'Standard'\n  }\n}\n\n#disable-next-line BCP081\nresource exampleMobileNetwork 'Microsoft.MobileNetwork/mobileNetworks@2023-09-01' = {\n  name: mobileNetworkName\n  location: location\n  properties: {\n    publicLandMobileNetworkIdentifier: {\n      mcc: mobileCountryCode\n      mnc: mobileNetworkCode\n    }\n  }\n}\n\n#disable-next-line BCP081\nresource exampleDataNetwork 'Microsoft.MobileNetwork/mobileNetworks/dataNetworks@2023-09-01' = {\n  parent: exampleMobileNetwork\n  name: dataNetworkName\n  location: location\n  properties: {}\n}\n\noutput aseID string = exampleAzureStackEdge.id\noutput existingMobileNetworkName string = mobileNetworkName\noutput existingDataNetworkName string = dataNetworkName\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1166."}, {"role": "assistant", "content": "@description('Region where the Mobile Network will be deployed (must match the resource group region)')\nparam location string\n\n@description('Name of the Mobile Network to add a Slice to')\nparam existingMobileNetworkName string\n\n@description('The name of the Slice')\nparam sliceName string\n\n@description('The SST value for the slice being deployed.')\n@maxValue(255)\n@minValue(0)\nparam sst int\n\n@description('The SD value for the slice being deployed.')\nparam sd string=''\n\nresource existingMobileNetwork 'Microsoft.MobileNetwork/mobileNetworks@2024-04-01' existing = {\n  name: existingMobileNetworkName\n\nresource exampleSlice 'slices@2024-04-01' = {\n    name: sliceName\n    location: location\n    properties:{\n      snssai: {       \n        sst: sst\n        sd: empty(sd) ? null : sd\n      }     \n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1167."}, {"role": "assistant", "content": "@description('Region where the Mobile Network will be deployed (must match the resource group region)')\nparam location string\n\n@description('Name of the Mobile Network to add a SIM policy to')\nparam existingMobileNetworkName string\n\n@description('Name of the existing slice to use for the SIM policy')\nparam existingSliceName string\n\n@description('Name of the existing data network to use for the SIM policy')\nparam existingDataNetworkName string\n\n@description('The name of the service')\nparam serviceName string = 'Allow_all_traffic'\n\n@description('The maximum bit rate (MBR) for uploads across all service data flows that match data flow policy rules configured on the generic service')\nparam serviceMaximumBitRateUplink string = '2 Gbps'\n\n@description('The maximum bit rate (MBR) for downloads across all service data flows that match data flow policy rules configured on the generic service')\nparam serviceMaximumBitRateDownlink string = '2 Gbps'\n\n@description('The precedence value for the service being deployed.')\n@maxValue(255)\n@minValue(0)\nparam servicePrecedence int = 253\n\n@description('The name of the data flow policy rule that will be created for this service.')\nparam dataFlowPolicyRuleName string = 'All_traffic'\n\n@description('The precedence value for the data flow policy rule being created.')\n@maxValue(255)\n@minValue(0)\nparam dataFlowPolicyRulePrecedence int = 253\n\n@description('Whether flows matching this data flow policy rule are permitted or blocked.')\n@allowed([\n  'Enabled'\n  'Blocked'\n])\nparam dataFlowPolicyRuleTrafficControl string = 'Enabled'\n\n@description('Which protocols match this data flow policy rule. This should be either a list of IANA protocol numbers or the special value \"ip\"')\nparam dataFlowTemplateProtocols array = [\n  'ip'\n]\n\n@description('The name of the data flow template that will be created for this service.')\nparam dataFlowTemplateName string = 'ip_traffic'\n\n@description('The direction of the flow to match with this data flow policy rule.')\n@allowed([\n  'Uplink'\n  'Downlink'\n  'Bidirectional'\n])\nparam dataFlowTemplateDirection string = 'Bidirectional'\n\n@description('The remote IP addresses that UEs will connect to for this flow. This should be either a list of IP addresses or the special value \"any\"')\nparam dataFlowTemplateRemoteIps array = [\n  'any'\n]\n\n@description('The name of the SIM policy')\nparam simPolicyName string = 'Default-policy'\n\n@description('The UE aggregated maximum bit rate (UE-AMBR) for uploads across all non-GBR QoS flows for a particular UE')\nparam totalBandwidthAllowedUplink string = '2 Gbps'\n\n@description('The UE aggregated maximum bit rate (UE-AMBR) for downloads across all non-GBR QoS flows for a particular UE')\nparam totalBandwidthAllowedDownlink string = '2 Gbps'\n\n@description('The session aggregated maximum bit rate (Session-AMBR) for uploads across all non-GBR QoS flows of an individual PDU session involving a particular UE')\nparam sessionAggregateMaximumBitRateUplink string = '2 Gbps'\n\n@description('The session aggregated maximum bit rate (Session-AMBR) for downloads across all non-GBR QoS flows of an individual PDU session involving a particular UE')\nparam sessionAggregateMaximumBitRateDownlink string = '2 Gbps'\n\n#disable-next-line BCP081\nresource existingMobileNetwork 'Microsoft.MobileNetwork/mobileNetworks@2024-04-01' existing = {\n  name: existingMobileNetworkName\n\n  #disable-next-line BCP081\n  resource existingDataNetwork 'dataNetworks@2024-04-01' existing = {\n    name: existingDataNetworkName\n  }\n\n  #disable-next-line BCP081\n  resource existingSlice 'slices@2024-04-01' existing = {\n    name: existingSliceName\n  }\n\n  #disable-next-line BCP081\n  resource exampleService 'services@2024-04-01' = {\n    name: serviceName\n    location: location\n    properties: {\n      servicePrecedence: servicePrecedence\n      serviceQosPolicy: {\n        maximumBitRate: {\n          uplink: serviceMaximumBitRateUplink\n          downlink: serviceMaximumBitRateDownlink\n        }\n      }\n      pccRules: [\n        {\n          ruleName: dataFlowPolicyRuleName\n          rulePrecedence: dataFlowPolicyRulePrecedence\n          trafficControl: dataFlowPolicyRuleTrafficControl\n          serviceDataFlowTemplates: [\n            {\n              templateName: dataFlowTemplateName\n              protocol: dataFlowTemplateProtocols\n              direction: dataFlowTemplateDirection\n              remoteIpList: dataFlowTemplateRemoteIps\n            }\n          ]\n        }\n      ]\n    }\n  }\n\n  #disable-next-line BCP081\n  resource exampleSimPolicy 'simPolicies@2024-04-01' = {\n    name: simPolicyName\n    location: location\n    properties: {\n      ueAmbr: {\n        uplink: totalBandwidthAllowedUplink\n        downlink: totalBandwidthAllowedDownlink\n      }\n      defaultSlice: {\n        id: existingSlice.id\n      }\n      sliceConfigurations: [\n        {\n          slice: {\n            id: existingSlice.id\n          }\n          defaultDataNetwork: {\n            id: existingDataNetwork.id\n          }\n          dataNetworkConfigurations: [\n            {\n              dataNetwork: {\n                id: existingDataNetwork.id\n              }\n              sessionAmbr: {\n                uplink: sessionAggregateMaximumBitRateUplink\n                downlink: sessionAggregateMaximumBitRateDownlink\n              }\n              allowedServices: [\n                {\n                  id: exampleService.id\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1168 please."}, {"role": "assistant", "content": "@description('Region where the SIM group will be deployed (must match the resource group region).')\nparam location string\n\n@description('The name of the mobile network to which you are adding the SIM group.')\nparam existingMobileNetworkName string\n\n@description('The name of the SIM policy to be assigned to the SIM(s).')\nparam existingSimPolicyName string\n\n@description('The name for the SIM group.')\nparam simGroupName string\n\n@description('A unversioned key vault key to encrypt the SIM data that belongs to this SIM group. For example: https://contosovault.vault.azure.net/keys/azureKey.')\nparam existingEncryptionKeyUrl string = ''\n\n@description('User-assigned identity is an identity in Azure Active Directory that can be used to give access to other Azure resource such as Azure Key Vault. This identity should have Get, Wrap key, and Unwrap key permissions on the key vault.')\nparam existingUserAssignedIdentityResourceId string = ''\n\n@description('An array containing properties of the SIM(s) you wish to create. See [Provision proxy SIM(s)](https://docs.microsoft.com/en-gb/azure/private-5g-core/provision-sims-azure-portal) for a full description of the required properties and their format.')\nparam simResources array\n\n#disable-next-line BCP081\nresource existingMobileNetwork 'Microsoft.MobileNetwork/mobileNetworks@2024-04-01' existing = {\n  name: existingMobileNetworkName\n}\n\n#disable-next-line BCP081\nresource existingSimPolicy 'Microsoft.MobileNetwork/mobileNetworks/simPolicies@2024-04-01' existing = {\n  parent: existingMobileNetwork\n  name: existingSimPolicyName\n}\n\n#disable-next-line BCP081\nresource exampleSimGroupResource 'Microsoft.MobileNetwork/simGroups@2024-04-01' = {\n  name: simGroupName\n  location: location\n  properties: {\n    mobileNetwork: {\n      id: existingMobileNetwork.id\n    }\n    encryptionKey: {\n      keyUrl: existingEncryptionKeyUrl\n    }\n  }\n  identity: !empty(existingUserAssignedIdentityResourceId) ? {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${existingUserAssignedIdentityResourceId}': {}\n    }\n  } : {\n    type: 'None'\n  }\n\n  #disable-next-line BCP081\n  resource exampleSimResources 'sims@2024-04-01' = [for item in simResources: {\n    name: item.simName\n    properties: {\n      integratedCircuitCardIdentifier: item.integratedCircuitCardIdentifier\n      internationalMobileSubscriberIdentity: item.internationalMobileSubscriberIdentity\n      authenticationKey: item.authenticationKey\n      operatorKeyCode: item.operatorKeyCode\n      deviceType: item.deviceType\n      simPolicy: {\n        id: existingSimPolicy.id\n      }\n    }\n  }]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1169?"}, {"role": "assistant", "content": "@description('Region where the mobile network will be deployed (must match the resource group region)')\nparam location string = resourceGroup().location\n\n@description('The name of the existing packet core / site.')\nparam existingSiteName string = 'myExampleSite'\n\n@description('The ID of the site.')\nparam existingSiteId string\n\n@description('The mode in which the packet core instance will run.')\n@allowed([\n  'EPC'\n  '5GC'\n  'EPC + 5GC'\n])\nparam existingPacketCoreNetworkTechnology string = '5GC'\n\n@description('The resource ID of the customLocation representing the ASE device where the packet core will be deployed. If this parameter is not specified then the 5G core will be created but will not be deployed to an ASE. [Collect custom location information](https://docs.microsoft.com/en-gb/azure/private-5g-core/collect-required-information-for-a-site#collect-custom-location-information) explains which value to specify here.')\nparam existingPacketCoreCustomLocationId string = ''\n\n@description('The name of the control plane interface on the access network. In 5G networks this is called the N2 interface whereas in 4G networks this is called the S1-MME interface. This should match one of the interfaces configured on your Azure Stack Edge machine.')\nparam controlPlaneAccessInterfaceName string = ''\n\n@description('The IP address of the control plane interface on the access network. In 5G networks this is called the N2 interface whereas in 4G networks this is called the S1-MME interface.')\nparam controlPlaneAccessIpAddress string\n\n@description('The network address of the access subnet in CIDR notation')\nparam accessSubnet string\n\n@description('The access subnet default gateway')\nparam accessGateway string\n\n@description('The version of packet core to use. Only set this field when instructed to by your support engineer.')\nparam newVersion string = ''\n\n@description('Name of the existing slice to use for the packetcorecontrolPlane')\nparam existingSliceName string = 'slice-1'\n\n@description('The name for the private mobile network')\nparam mobileNetworkName string\n\n@description('The mobile country code for the private mobile network')\nparam mobileCountryCode string = '001'\n\n@description('The mobile network code for the private mobile network')\nparam mobileNetworkCode string = '01'\n\n\n#disable-next-line BCP081\nresource exampleMobileNetwork 'Microsoft.MobileNetwork/mobileNetworks@2024-04-01' = {\n  name: mobileNetworkName\n  location: location\n  properties: {\n    publicLandMobileNetworkIdentifier: {\n      mcc: mobileCountryCode\n      mnc: mobileNetworkCode\n    }\n  }\n}\n\n#disable-next-line BCP081\nresource existingSlice 'Microsoft.MobileNetwork/mobileNetworks/slices@2024-04-01' = {\n  parent: exampleMobileNetwork\n  name: existingSliceName\n  location: location\n  properties: {\n    snssai: {\n      sst: 1\n    }\n  }\n}\n\n#disable-next-line BCP081\nresource examplePacketCoreControlPlane 'Microsoft.MobileNetwork/packetCoreControlPlanes@2024-04-01' = {\n  name: existingSiteName\n  location: location\n  dependsOn: [\n    existingSlice\n  ]\n  properties: {\n    sites: [\n      {\n        id: existingSiteId\n      }\n    ]\n    localDiagnosticsAccess: {\n      authenticationType: 'Password'\n    }\n    sku: 'G0'\n    coreNetworkTechnology: existingPacketCoreNetworkTechnology\n    platform: {\n      type: 'AKS-HCI'\n      customLocation: empty(existingPacketCoreCustomLocationId) ? null : {\n        id: existingPacketCoreCustomLocationId\n      }\n    }\n    controlPlaneAccessInterface: {\n      name: controlPlaneAccessInterfaceName\n      ipv4Address: controlPlaneAccessIpAddress\n      ipv4Subnet: accessSubnet\n      ipv4Gateway: accessGateway\n    }\n    version: newVersion\n  }\n }\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1170."}, {"role": "assistant", "content": "@description('System ID for Oracle to create unique volume group and volume names. Minimum 3 and maximum 12 characters.')\n@minLength(3)\n@maxLength(12)\nparam UniqueSystemID string\n\n@description('Availability Zone. This is None when proximity placement group is selected.')\n@allowed([\n  'None'\n  '1'\n  '2'\n  '3'\n])\nparam AvailabilityZone string\n\n@description('Name of proximity placement group. This is optional when Availability Zone is selected.')\n@minLength(0)\n@maxLength(80)\nparam ProximityPlacementGroupName string = ''\n\n@description('Resource group name for the proximity placement group. This is optional when Availability Zone is selected.')\n@minLength(0)\n@maxLength(90)\nparam ProximityPlacementGroupResourceGroup string = ''\n\n@description('Basic or Standard network features available to the volume')\n@allowed([\n  'Basic'\n  'Standard'\n])\nparam NetworkFeatures string = 'Basic'\n\n@description('Specifies whether LDAP is enabled or not for all the volumes.')\nparam LdapEnabled bool = false\n\n@description('Number of Oracle data volumes. Minimum 1 and maximum 8 data volumes.')\n@minValue(1)\n@maxValue(8)\nparam NoOfOracleDataVolumes int\n\n@description('Total size of the database. This and the number of data volumes and addition capacity for snapshots will be used to calculate the size of each individual data volume.')\n@minValue(1)\n@maxValue(800)\nparam OracleDatabaseSizeInTebibytes int\n\n@description('Total throughput in MiB/s for the database. This will be used to calculate the throughput of each data volume.')\n@minLength(1)\n@maxLength(16)\nparam OracleThroughputInMebibytesPerSecond string\n\n@description('Name of Capacity Pool in Azure NetApp Files (ANF) account. All the volumes are created using this capacity pool.')\n@minLength(1)\n@maxLength(64)\nparam CapacityPool string\n\n@description('Additional capacity provisioned for each data volume to keep local snapshots. Possible values 0% - 100%. The default of 20% is usually sufficient to retain multiple snapshots.')\n@minValue(0)\n@maxValue(100)\nparam AdditionalCapacityForSnapshotsPercentage int = 20\n\n@description('If a Tag Key is specified, it will be added to each volume created by this ARM template.')\n@maxLength(512)\nparam TagKey string = ''\n\n@description('If a Tag Value is specified, it will be added to each volume created by this ARM template. The value will only be added if Tag Key was specified.')\n@maxLength(256)\nparam TagValue string = ''\n\n@description('Azure NetApp Files (ANF) Location. If the resource group location is different than ANF location, ANF location needs to be specified.')\n@minLength(1)\n@maxLength(1024)\nparam AzureNetappFilesLocation string = resourceGroup().location\n\n@description('Name of Azure NetApp Files (ANF) account.')\n@minLength(1)\n@maxLength(128)\nparam ANFNetappAccount string\n\n@description('Virtual Network name for the subnet.')\n@minLength(1)\n@maxLength(1024)\nparam VirtualNetwork string\n\n@description('Delegated Subnet name.')\n@minLength(1)\n@maxLength(1024)\nparam DelegatedSubnet string = 'default'\n\n@description('Manually specify the size of each data volume or use auto to let ARM calculate. See documentation for details.')\n@minLength(1)\n@maxLength(16)\nparam DataSizeInGibibytes string = 'auto'\n\n@description('Manually specify the performance of each data volume or use auto to let ARM calculate. See documentation for details.')\n@minLength(1)\n@maxLength(16)\nparam DataPerformanceInMebibytesPerSecond string = 'auto'\n\n@description('NFS Protocol version for all volumes.')\n@allowed([\n  'NFSv3'\n  'NFSv4.1'\n])\nparam NFSVersion string = 'NFSv4.1'\n\n@description('Specify capacity (in GiB). Possible values can be auto or integer value representing size.')\n@minLength(1)\n@maxLength(16)\nparam LogSizeInGibibytes string = 'auto'\n\n@description('Specify throughput in MiB/s. Possible values can be \"auto\" or integer values (min 1 MiB/s) representing throughput.')\n@minLength(1)\n@maxLength(16)\nparam LogPerformanceInMebibytesPerSecond string = 'auto'\n\n@description('Specify capacity (in GiB). Possible values can be \"auto\", none or integer values (min 100 GiB) representing size.')\n@minLength(1)\n@maxLength(16)\nparam LogMirrorSizeInGibibytes string = 'auto'\n\n@description('Specify throughput in MiB/s. Possible values can be \"auto\" or integer values (min 1 MiB/s) representing throughput.')\n@minLength(1)\n@maxLength(16)\nparam LogMirrorPerformanceInMebibytesPerSecond string = 'auto'\n\n@description('Specify capacity (in GiB). Possible values can be \"auto\", none or integer values (min 100 GiB) representing size.')\n@minLength(1)\n@maxLength(16)\nparam BinarySizeInGibibytes string = 'auto'\n\n@description('Specify throughput in MiB/s. Possible values can be \"auto\" or integer values (min 1 MiB/s) representing throughput.')\n@minLength(1)\n@maxLength(16)\nparam BinaryPerformanceInMebibytesPerSecond string = 'auto'\n\n@description('Specify capacity (in GiB). Possible values can be \"auto\", none or integer values (min 100 GiB) representing size.')\n@minLength(1)\n@maxLength(16)\nparam BackupSizeInGibibytes string = 'auto'\n\n@description('Specify throughput in MiB/s. Possible values can be \"auto\" or integer values (min 1 MiB/s) representing throughput.')\n@minLength(1)\n@maxLength(16)\nparam BackupPerformanceInMebibytesPerSecond string = 'auto'\n\nvar location = AzureNetappFilesLocation\nvar OracleApplicationType = 'ORACLE'\nvar _1GBInBytes = (1024 * (1024 * 1024))\nvar _1TBInGiB = 1024\nvar volumeGroupName = '${ANFNetappAccount}/Oracle-${UniqueSystemID}-VolumeGroup'\nvar tagPayload = {\n  '${TagKey}': TagValue\n}\nvar emptyTag = {}\nvar volumeTag = ((TagKey == '') ? emptyTag : tagPayload)\nvar zones = (empty(ProximityPlacementGroupName) ? ((AvailabilityZone == 'None') ? [] : array(AvailabilityZone)) : null)\nvar proximityPlacementGroup = (empty(ProximityPlacementGroupName) ? null : resourceId(ProximityPlacementGroupResourceGroup, 'Microsoft.Compute/proximityPlacementGroups', ProximityPlacementGroupName))\nvar autoDataVolumeSize = min((_1TBInGiB * 100), int((((_1TBInGiB * OracleDatabaseSizeInTebibytes) + int(((AdditionalCapacityForSnapshotsPercentage * (_1TBInGiB * OracleDatabaseSizeInTebibytes)) / 100))) / NoOfOracleDataVolumes)))\nvar dataVolumeSize = ((DataSizeInGibibytes == 'auto') ? autoDataVolumeSize : int(DataSizeInGibibytes))\nvar dataVolumeThroughput = ((DataPerformanceInMebibytesPerSecond == 'auto') ? int((int(OracleThroughputInMebibytesPerSecond) / NoOfOracleDataVolumes)) : int(DataPerformanceInMebibytesPerSecond))\nvar autoLogVolumeSize = 100\nvar autoLogThroughput = 150\nvar logVolumeSize = ((LogSizeInGibibytes == 'auto') ? autoLogVolumeSize : int(LogSizeInGibibytes))\nvar logVolumeThroughput = ((LogPerformanceInMebibytesPerSecond == 'auto') ? autoLogThroughput : int(LogPerformanceInMebibytesPerSecond))\nvar autoLogMirrorVolumeSize = 100\nvar autoLogMirrorThroughput = 150\nvar logMirrorVolumeSize = ((LogMirrorSizeInGibibytes == 'auto') ? autoLogMirrorVolumeSize : ((LogMirrorSizeInGibibytes == 'none') ? 0 : int(LogMirrorSizeInGibibytes)))\nvar logMirrorVolumeThroughput = ((LogMirrorPerformanceInMebibytesPerSecond == 'auto') ? autoLogMirrorThroughput : int(LogMirrorPerformanceInMebibytesPerSecond))\nvar autoBinaryVolumeSize = 100\nvar autoBinaryThroughput = 64\nvar binaryVolumeSize = ((BinarySizeInGibibytes == 'auto') ? autoBinaryVolumeSize : ((BinarySizeInGibibytes == 'none') ? 0 : int(BinarySizeInGibibytes)))\nvar binaryVolumeThroughput = ((BinaryPerformanceInMebibytesPerSecond == 'auto') ? autoBinaryThroughput : int(BinaryPerformanceInMebibytesPerSecond))\nvar autoBackupVolumeSize = min((_1TBInGiB * 100), int(((_1TBInGiB * OracleDatabaseSizeInTebibytes) / 2)))\nvar autoBackupThroughput = 150\nvar backupVolumeSize = ((BackupSizeInGibibytes == 'auto') ? autoBackupVolumeSize : ((BackupSizeInGibibytes == 'none') ? 0 : int(BackupSizeInGibibytes)))\nvar backupVolumeThroughput = ((BackupPerformanceInMebibytesPerSecond == 'auto') ? autoBackupThroughput : int(BackupPerformanceInMebibytesPerSecond))\nvar logVolumePayload = {\n  type: 'Microsoft.NetApp/netAppAccounts/capacityPools/volumes'\n  name: '${UniqueSystemID}-ora-log'\n  tags: volumeTag\n  zones: zones\n  properties: {\n    creationToken: '${UniqueSystemID}-ora-log'\n    ldapEnabled: LdapEnabled\n    networkFeatures: NetworkFeatures\n    proximityPlacementGroup: proximityPlacementGroup\n    usageThreshold: (_1GBInBytes * logVolumeSize)\n    capacityPoolResourceId: resourceId('Microsoft.NetApp/netAppAccounts/capacityPools', ANFNetappAccount, CapacityPool)\n    volumeSpecName: 'ora-log'\n    kerberosEnabled: false\n    throughputMibps: logVolumeThroughput\n    subnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', VirtualNetwork, DelegatedSubnet)\n    exportPolicy: {\n      rules: [\n        {\n          ruleIndex: 1\n          unixReadOnly: false\n          unixReadWrite: true\n          cifs: false\n          kerberos5ReadOnly: false\n          kerberos5ReadWrite: false\n          kerberos5iReadOnly: false\n          kerberos5iReadWrite: false\n          kerberos5pReadOnly: false\n          kerberos5pReadWrite: false\n          nfsv3: ((NFSVersion == 'NFSv3') ? 'true' : 'false')\n          nfsv41: ((NFSVersion == 'NFSv4.1') ? 'true' : 'false')\n          allowedClients: '0.0.0.0/0'\n          hasRootAccess: true\n        }\n      ]\n    }\n    protocolTypes: [\n      NFSVersion\n    ]\n  }\n}\nvar logMirrorVolumePayload = {\n  type: 'Microsoft.NetApp/netAppAccounts/capacityPools/volumes'\n  name: '${UniqueSystemID}-ora-log-mirror'\n  tags: volumeTag\n  zones: zones\n  properties: {\n    creationToken: '${UniqueSystemID}-ora-log-mirror'\n    ldapEnabled: LdapEnabled\n    networkFeatures: NetworkFeatures\n    proximityPlacementGroup: proximityPlacementGroup\n    usageThreshold: (_1GBInBytes * logMirrorVolumeSize)\n    capacityPoolResourceId: resourceId('Microsoft.NetApp/netAppAccounts/capacityPools', ANFNetappAccount, CapacityPool)\n    volumeSpecName: 'ora-log-mirror'\n    kerberosEnabled: false\n    throughputMibps: logMirrorVolumeThroughput\n    subnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', VirtualNetwork, DelegatedSubnet)\n    exportPolicy: {\n      rules: [\n        {\n          ruleIndex: 1\n          unixReadOnly: false\n          unixReadWrite: true\n          cifs: false\n          kerberos5ReadOnly: false\n          kerberos5ReadWrite: false\n          kerberos5iReadOnly: false\n          kerberos5iReadWrite: false\n          kerberos5pReadOnly: false\n          kerberos5pReadWrite: false\n          nfsv3: ((NFSVersion == 'NFSv3') ? 'true' : 'false')\n          nfsv41: ((NFSVersion == 'NFSv4.1') ? 'true' : 'false')\n          allowedClients: '0.0.0.0/0'\n          hasRootAccess: true\n        }\n      ]\n    }\n    protocolTypes: [\n      NFSVersion\n    ]\n  }\n}\nvar binaryVolumePayload = {\n  type: 'Microsoft.NetApp/netAppAccounts/capacityPools/volumes'\n  name: '${UniqueSystemID}-ora-binary'\n  tags: volumeTag\n  zones: zones\n  properties: {\n    creationToken: '${UniqueSystemID}-ora-binary'\n    ldapEnabled: LdapEnabled\n    networkFeatures: NetworkFeatures\n    proximityPlacementGroup: proximityPlacementGroup\n    usageThreshold: (_1GBInBytes * binaryVolumeSize)\n    capacityPoolResourceId: resourceId('Microsoft.NetApp/netAppAccounts/capacityPools', ANFNetappAccount, CapacityPool)\n    volumeSpecName: 'ora-binary'\n    kerberosEnabled: false\n    throughputMibps: binaryVolumeThroughput\n    subnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', VirtualNetwork, DelegatedSubnet)\n    exportPolicy: {\n      rules: [\n        {\n          ruleIndex: 1\n          unixReadOnly: false\n          unixReadWrite: true\n          cifs: false\n          kerberos5ReadOnly: false\n          kerberos5ReadWrite: false\n          kerberos5iReadOnly: false\n          kerberos5iReadWrite: false\n          kerberos5pReadOnly: false\n          kerberos5pReadWrite: false\n          nfsv3: ((NFSVersion == 'NFSv3') ? 'true' : 'false')\n          nfsv41: ((NFSVersion == 'NFSv4.1') ? 'true' : 'false')\n          allowedClients: '0.0.0.0/0'\n          hasRootAccess: true\n        }\n      ]\n    }\n    protocolTypes: [\n      NFSVersion\n    ]\n  }\n}\nvar backupVolumePayload = {\n  type: 'Microsoft.NetApp/netAppAccounts/capacityPools/volumes'\n  name: '${UniqueSystemID}-ora-backup'\n  tags: volumeTag\n  zones: zones\n  properties: {\n    creationToken: '${UniqueSystemID}-ora-backup'\n    ldapEnabled: LdapEnabled\n    networkFeatures: NetworkFeatures\n    proximityPlacementGroup: proximityPlacementGroup\n    usageThreshold: (_1GBInBytes * backupVolumeSize)\n    capacityPoolResourceId: resourceId('Microsoft.NetApp/netAppAccounts/capacityPools', ANFNetappAccount, CapacityPool)\n    volumeSpecName: 'ora-backup'\n    kerberosEnabled: false\n    throughputMibps: backupVolumeThroughput\n    subnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', VirtualNetwork, DelegatedSubnet)\n    exportPolicy: {\n      rules: [\n        {\n          ruleIndex: 1\n          unixReadOnly: false\n          unixReadWrite: true\n          cifs: false\n          kerberos5ReadOnly: false\n          kerberos5ReadWrite: false\n          kerberos5iReadOnly: false\n          kerberos5iReadWrite: false\n          kerberos5pReadOnly: false\n          kerberos5pReadWrite: false\n          nfsv3: ((NFSVersion == 'NFSv3') ? 'true' : 'false')\n          nfsv41: ((NFSVersion == 'NFSv4.1') ? 'true' : 'false')\n          allowedClients: '0.0.0.0/0'\n          hasRootAccess: true\n        }\n      ]\n    }\n    protocolTypes: [\n      NFSVersion\n    ]\n  }\n}\nvar emptyArray = []\nvar volumesPayloadArray = concat(array(dataVolumePayloads), array(logVolumePayload), ((LogMirrorSizeInGibibytes == 'none') ? emptyArray : array(logMirrorVolumePayload)), ((BinarySizeInGibibytes == 'none') ? emptyArray : array(binaryVolumePayload)), ((BackupSizeInGibibytes == 'none') ? emptyArray : array(backupVolumePayload)))\nvar dataVolumePayloads = [for i in range(0, NoOfOracleDataVolumes): {\n  type: 'Microsoft.NetApp/netAppAccounts/capacityPools/volumes'\n  name: '${UniqueSystemID}-ora-data${(i + 1)}'\n  tags: volumeTag\n  zones: zones\n  properties: {\n    creationToken: '${UniqueSystemID}-ora-data${(i + 1)}'\n    ldapEnabled: LdapEnabled\n    networkFeatures: NetworkFeatures\n    proximityPlacementGroup: proximityPlacementGroup\n    usageThreshold: (_1GBInBytes * dataVolumeSize)\n    capacityPoolResourceId: resourceId('Microsoft.NetApp/netAppAccounts/capacityPools', ANFNetappAccount, CapacityPool)\n    volumeSpecName: 'ora-data${(i + 1)}'\n    kerberosEnabled: false\n    throughputMibps: dataVolumeThroughput\n    subnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', VirtualNetwork, DelegatedSubnet)\n    exportPolicy: {\n      rules: [\n        {\n          ruleIndex: 1\n          unixReadOnly: false\n          unixReadWrite: true\n          cifs: false\n          kerberos5ReadOnly: false\n          kerberos5ReadWrite: false\n          kerberos5iReadOnly: false\n          kerberos5iReadWrite: false\n          kerberos5pReadOnly: false\n          kerberos5pReadWrite: false\n          nfsv3: ((NFSVersion == 'NFSv3') ? 'true' : 'false')\n          nfsv41: ((NFSVersion == 'NFSv4.1') ? 'true' : 'false')\n          allowedClients: '0.0.0.0/0'\n          hasRootAccess: true\n        }\n      ]\n    }\n    protocolTypes: [\n      NFSVersion\n    ]\n  }\n}]\n\nresource volumeGroup 'Microsoft.NetApp/netAppAccounts/volumeGroups@2023-05-01' = {\n  name: volumeGroupName\n  location: location\n  properties: {\n    groupMetaData: {\n      groupDescription: 'Primary database for ${UniqueSystemID}'\n      applicationType: OracleApplicationType\n      applicationIdentifier: UniqueSystemID\n    }\n    volumes: volumesPayloadArray\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1171?"}, {"role": "assistant", "content": "@description('Domain Name')\nparam domainName string\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('SKU of the AD Domain Service.')\nparam sku string = 'Enterprise'\n\n@description('Domain Configuration Type.')\nparam domainConfigurationType string = 'FullySynced'\n\n@description('Choose the filtered sync type.')\nparam filteredSync string = 'Disabled'\n\n@description('Virtual Network Name')\nparam domainServicesVnetName string = 'domain-services-vnet'\n\n@description('Address Prefix')\nparam domainServicesVnetAddressPrefix string = '10.0.0.0/16'\n\n@description('Virtual Network Name')\nparam domainServicesSubnetName string = 'domain-services-subnet'\n\n@description('Subnet prefix')\nparam domainServicesSubnetAddressPrefix string = '10.0.0.0/24'\n\nvar domainServicesNSGName = '${domainServicesSubnetName}-nsg'\n\nvar PSRemotingSlicePIPAddresses = [\n  '52.180.179.108'\n  '52.180.177.87'\n  '13.75.105.168'\n  '52.175.18.134'\n  '52.138.68.41'\n  '52.138.65.157'\n  '104.41.159.212'\n  '104.45.138.161'\n  '52.169.125.119'\n  '52.169.218.0'\n  '52.187.19.1'\n  '52.187.120.237'\n  '13.78.172.246'\n  '52.161.110.169'\n  '52.174.189.149'\n  '40.68.160.142'\n  '40.83.144.56'\n  '13.64.151.161'\n]\nvar RDPIPAddresses = [\n  '207.68.190.32/27'\n  '13.106.78.32/27'\n  '13.106.174.32/27'\n  '13.106.4.96/27'\n]\n\nvar PSRemotingSliceTIPAddresses = [\n  '52.180.183.67'\n  '52.180.181.39'\n  '52.175.28.111'\n  '52.175.16.141'\n  '52.138.70.93'\n  '52.138.64.115'\n  '40.80.146.22'\n  '40.121.211.60'\n  '52.138.143.173'\n  '52.169.87.10'\n  '13.76.171.84'\n  '52.187.169.156'\n  '13.78.174.255'\n  '13.78.191.178'\n  '40.68.163.143'\n  '23.100.14.28'\n  '13.64.188.43'\n  '23.99.93.197'\n]\n\nresource nsg 'Microsoft.Network/networkSecurityGroups@2020-11-01' = {\n  name: domainServicesNSGName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowPSRemotingSliceP'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '5986'\n          sourceAddressPrefixes: PSRemotingSlicePIPAddresses\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 301\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowRDP'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '3389'\n          sourceAddressPrefixes: RDPIPAddresses\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 201\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowSyncWithAzureAD'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 101\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowPSRemotingSliceT'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '5986'\n          sourceAddressPrefixes: PSRemotingSliceTIPAddresses\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 302\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource vnet 'Microsoft.Network/virtualNetworks@2020-11-01' = {\n  name: domainServicesVnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        domainServicesVnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: domainServicesSubnetName\n        properties: {\n          addressPrefix: domainServicesSubnetAddressPrefix\n          networkSecurityGroup: {\n            id: nsg.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource domainServices 'Microsoft.AAD/DomainServices@2020-01-01' = {\n  name: domainName\n  location: location\n  properties: {\n    domainName: domainName\n    filteredSync: filteredSync\n    domainConfigurationType: domainConfigurationType\n    replicaSets: [\n      {\n        subnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', vnet.name, domainServicesSubnetName)\n        location: location\n      }\n    ]\n    sku: sku\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1172."}, {"role": "assistant", "content": "@description('Security Type of the Virtual Machine.')\n@allowed([\n  'Standard'\n  'TrustedLaunch'\n])\nparam securityType string = 'TrustedLaunch'\n\n@description('Specifies the location of AKS cluster.')\nparam location string = resourceGroup().location\n\n@description('Specifies the name of the AKS cluster.')\nparam aksClusterName string = 'aks-${uniqueString(resourceGroup().id)}'\n\n@description('Specifies the DNS prefix specified when creating the managed cluster.')\nparam aksClusterDnsPrefix string = aksClusterName\n\n@description('Specifies the tags of the AKS cluster.')\nparam aksClusterTags object = {\n  resourceType: 'AKS Cluster'\n  createdBy: 'ARM Template'\n}\n\n@description('Specifies the network plugin used for building Kubernetes network. - azure or kubenet.')\n@allowed([\n  'azure'\n  'kubenet'\n])\nparam aksClusterNetworkPlugin string = 'azure'\n\n@description('Specifies the network policy used for building Kubernetes network. - calico or azure')\n@allowed([\n  'azure'\n  'calico'\n])\nparam aksClusterNetworkPolicy string = 'azure'\n\n@description('Specifies the CIDR notation IP range from which to assign pod IPs when kubenet is used.')\nparam aksClusterPodCidr string = '10.244.0.0/16'\n\n@description('A CIDR notation IP range from which to assign service cluster IPs. It must not overlap with any Subnet IP ranges.')\nparam aksClusterServiceCidr string = '10.3.0.0/16'\n\n@description('Specifies the IP address assigned to the Kubernetes DNS service. It must be within the Kubernetes service address range specified in serviceCidr.')\nparam aksClusterDnsServiceIP string = '10.3.0.10'\n\n@description('Specifies the sku of the load balancer used by the virtual machine scale sets used by nodepools.')\n@allowed([\n  'basic'\n  'standard'\n])\nparam aksClusterLoadBalancerSku string = 'standard'\n\n@description('Specifies outbound (egress) routing method. - loadBalancer or userDefinedRouting.')\n@allowed([\n  'loadBalancer'\n  'userDefinedRouting'\n])\nparam aksClusterOutboundType string = 'loadBalancer'\n\n@description('Specifies the tier of a managed cluster SKU: Automatic or Base')\n@allowed([\n  'Automatic'\n  'Base'\n])\nparam aksClusterSkuName string = 'Base'\n\n@description('Specifies the tier of a managed cluster SKU: Free, Premium or Standard')\n@allowed([\n  'Free'\n  'Premium'\n  'Standard'\n])\nparam aksClusterSkuTier string = 'Standard'\n\n@description('Specifies the administrator username of Linux virtual machines.')\nparam aksClusterAdminUsername string\n\n@description('Specifies the SSH RSA public key string for the Linux nodes.')\nparam aksClusterSshPublicKey string\n\n@description('Specifies whether to create the cluster as a private cluster or not.')\nparam aksClusterEnablePrivateCluster bool = false\n\n@description('Specifies the unique name of of the system node pool profile in the context of the subscription and resource group.')\nparam systemNodePoolName string = 'system'\n\n@description('Specifies the vm size of nodes in the system node pool.')\nparam systemNodePoolVmSize string = 'Standard_D16s_v3'\n\n@description('Specifies the OS Disk Size in GB to be used to specify the disk size for every machine in the system agent pool. If you specify 0, it will apply the default osDisk size according to the vmSize specified..')\nparam systemNodePoolOsDiskSizeGB int = 100\n\n@description('Specifies the number of agents (VMs) to host docker containers in the system node pool. Allowed values must be in the range of 1 to 100 (inclusive). The default value is 1.')\nparam systemNodePoolAgentCount int = 3\n\n@description('Specifies the OS type for the vms in the system node pool. Choose from Linux and Windows. Default to Linux.')\n@allowed([\n  'Linux'\n  'Windows'\n])\nparam systemNodePoolOsType string = 'Linux'\n\n@description('Specifies the maximum number of pods that can run on a node in the system node pool. The maximum number of pods per node in an AKS cluster is 250. The default maximum number of pods per node varies between kubenet and Azure CNI networking, and the method of cluster deployment.')\nparam systemNodePoolMaxPods int = 30\n\n@description('Specifies the maximum number of nodes for auto-scaling for the system node pool.')\nparam systemNodePoolMaxCount int = 5\n\n@description('Specifies the minimum number of nodes for auto-scaling for the system node pool.')\nparam systemNodePoolMinCount int = 3\n\n@description('Specifies whether to enable auto-scaling for the system node pool.')\nparam systemNodePoolEnableAutoScaling bool = true\n\n@description('Specifies the virtual machine scale set priority in the system node pool: Spot or Regular.')\n@allowed([\n  'Spot'\n  'Regular'\n])\nparam systemNodePoolScaleSetPriority string = 'Regular'\n\n@description('Specifies the ScaleSetEvictionPolicy to be used to specify eviction policy for spot virtual machine scale set. Default to Delete. Allowed values are Delete or Deallocate.')\n@allowed([\n  'Delete'\n  'Deallocate'\n])\nparam systemNodePoolScaleSetEvictionPolicy string = 'Delete'\n\n@description('Specifies the type for the system node pool: VirtualMachineScaleSets or AvailabilitySet')\n@allowed([\n  'VirtualMachineScaleSets'\n  'AvailabilitySet'\n])\nparam systemNodePoolType string = 'VirtualMachineScaleSets'\n\n@description('Specifies the unique name of of the user node pool profile in the context of the subscription and resource group.')\nparam userNodePoolName string = 'user'\n\n@description('Specifies the vm size of nodes in the user node pool.')\nparam userNodePoolVmSize string = 'Standard_D16s_v3'\n\n@description('Specifies the OS Disk Size in GB to be used to specify the disk size for every machine in the system agent pool. If you specify 0, it will apply the default osDisk size according to the vmSize specified..')\nparam userNodePoolOsDiskSizeGB int = 100\n\n@description('Specifies the number of agents (VMs) to host docker containers in the user node pool. Allowed values must be in the range of 1 to 100 (inclusive). The default value is 1.')\nparam userNodePoolAgentCount int = 3\n\n@description('Specifies the OS type for the vms in the user node pool. Choose from Linux and Windows. Default to Linux.')\n@allowed([\n  'Linux'\n  'Windows'\n])\nparam userNodePoolOsType string = 'Linux'\n\n@description('Specifies the maximum number of pods that can run on a node in the user node pool. The maximum number of pods per node in an AKS cluster is 250. The default maximum number of pods per node varies between kubenet and Azure CNI networking, and the method of cluster deployment.')\nparam userNodePoolMaxPods int = 30\n\n@description('Specifies the maximum number of nodes for auto-scaling for the user node pool.')\nparam userNodePoolMaxCount int = 5\n\n@description('Specifies the minimum number of nodes for auto-scaling for the user node pool.')\nparam userNodePoolMinCount int = 3\n\n@description('Specifies whether to enable auto-scaling for the user node pool.')\nparam userNodePoolEnableAutoScaling bool = true\n\n@description('Specifies the virtual machine scale set priority in the user node pool: Spot or Regular.')\n@allowed([\n  'Spot'\n  'Regular'\n])\nparam userNodePoolScaleSetPriority string = 'Regular'\n\n@description('Specifies the ScaleSetEvictionPolicy to be used to specify eviction policy for spot virtual machine scale set. Default to Delete. Allowed values are Delete or Deallocate.')\n@allowed([\n  'Delete'\n  'Deallocate'\n])\nparam userNodePoolScaleSetEvictionPolicy string = 'Delete'\n\n@description('Specifies the type for the user node pool: VirtualMachineScaleSets or AvailabilitySet')\n@allowed([\n  'VirtualMachineScaleSets'\n  'AvailabilitySet'\n])\nparam userNodePoolType string = 'VirtualMachineScaleSets'\n\n@description('Specifies whether the httpApplicationRouting add-on is enabled or not.')\nparam httpApplicationRoutingEnabled bool = false\n\n@description('Specifies whether the aciConnectorLinux add-on is enabled or not.')\nparam aciConnectorLinuxEnabled bool = false\n\n@description('Specifies whether the azurepolicy add-on is enabled or not.')\nparam azurePolicyEnabled bool = true\n\n@description('Specifies whether the kubeDashboard add-on is enabled or not.')\nparam kubeDashboardEnabled bool = false\n\n@description('Specifies whether the pod identity addon is enabled..')\nparam podIdentityProfileEnabled bool = false\n\n@description('Specifies the scan interval of the auto-scaler of the AKS cluster.')\nparam autoScalerProfileScanInterval string = '10s'\n\n@description('Specifies the scale down delay after add of the auto-scaler of the AKS cluster.')\nparam autoScalerProfileScaleDownDelayAfterAdd string = '10m'\n\n@description('Specifies the scale down delay after delete of the auto-scaler of the AKS cluster.')\nparam autoScalerProfileScaleDownDelayAfterDelete string = '20s'\n\n@description('Specifies scale down delay after failure of the auto-scaler of the AKS cluster.')\nparam autoScalerProfileScaleDownDelayAfterFailure string = '3m'\n\n@description('Specifies the scale down unneeded time of the auto-scaler of the AKS cluster.')\nparam autoScalerProfileScaleDownUnneededTime string = '10m'\n\n@description('Specifies the scale down unready time of the auto-scaler of the AKS cluster.')\nparam autoScalerProfileScaleDownUnreadyTime string = '20m'\n\n@description('Specifies the utilization threshold of the auto-scaler of the AKS cluster.')\nparam autoScalerProfileUtilizationThreshold string = '0.5'\n\n@description('Specifies the max graceful termination time interval in seconds for the auto-scaler of the AKS cluster.')\nparam autoScalerProfileMaxGracefulTerminationSec string = '600'\n\n@description('Specifies the name of the virtual network.')\nparam virtualNetworkName string = '${aksClusterName}Vnet'\n\n@description('Specifies the address prefixes of the virtual network.')\nparam virtualNetworkAddressPrefixes string = '10.0.0.0/8'\n\n@description('Specifies the name of the subnet hosting the system node pool of the AKS cluster.')\nparam aksSubnetName string = 'AksSubnet'\n\n@description('Specifies the address prefix of the subnet hosting the system node pool of the AKS cluster.')\nparam aksSubnetAddressPrefix string = '10.0.0.0/16'\n\n@description('Specifies the name of the Log Analytics Workspace.')\nparam logAnalyticsWorkspaceName string = '${aksClusterName}Workspace'\n\n@description('Specifies the service tier of the workspace: Free, Standalone, PerNode, Per-GB.')\n@allowed([\n  'Free'\n  'Standalone'\n  'PerNode'\n  'PerGB2018'\n])\nparam logAnalyticsSku string = 'PerGB2018'\n\n@description('Specifies the workspace data retention in days. -1 means Unlimited retention for the Unlimited Sku. 730 days is the maximum allowed for all other Skus.')\nparam logAnalyticsRetentionInDays int = 60\n\n@description('Specifies the name of the subnet which contains the virtual machine.')\nparam vmSubnetName string = 'VmSubnet'\n\n@description('Specifies the address prefix of the subnet which contains the virtual machine.')\nparam vmSubnetAddressPrefix string = '10.1.0.0/16'\n\n@description('Specifies the name of the subnet which contains the the Application Gateway.')\nparam applicationGatewaySubnetName string = 'AppGatewaySubnet'\n\n@description('Specifies the address prefix of the subnet which contains the Application Gateway.')\nparam applicationGatewaySubnetAddressPrefix string = '10.2.0.0/24'\n\n@description('Specifies the name of the virtual machine.')\nparam vmName string = 'TestVm'\n\n@description('Specifies the size of the virtual machine.')\nparam vmSize string = 'Standard_D4s_v3'\n\n@description('The publisher of the image from which to launch the virtual machine.')\nparam imagePublisher string = 'Canonical'\n\n@description('The offer of the image from which to launch the virtual machine.')\nparam imageOffer string = '0001-com-ubuntu-server-jammy'\n\n@description('The SKU of the image from which to launch the virtual machine.')\nparam imageSku string = '22_04-lts-gen2'\n\n@description('Specifies the type of authentication when accessing the Virtual Machine. SSH key is recommended.')\n@allowed([\n  'sshPublicKey'\n  'password'\n])\nparam authenticationType string = 'password'\n\n@description('Specifies the name of the administrator account of the virtual machine.')\nparam vmAdminUsername string\n\n@description('Specifies the SSH Key or password for the virtual machine. SSH key is recommended.')\n@secure()\nparam vmAdminPasswordOrKey string\n\n@description('Specifies the storage account type for OS and data disk.')\n@allowed([\n  'Premium_LRS'\n  'Premium_ZRS'\n  'StandardSSD_LRS'\n  'StandardSSD_ZRS'\n  'Standard_LRS'\n])\nparam diskStorageAccounType string = 'Premium_LRS'\n\n@description('Specifies the number of data disks of the virtual machine.')\n@minValue(0)\n@maxValue(64)\nparam numDataDisks int = 1\n\n@description('Specifies the size in GB of the OS disk of the VM.')\nparam osDiskSize int = 50\n\n@description('Specifies the size in GB of the OS disk of the virtual machine.')\nparam dataDiskSize int = 50\n\n@description('Specifies the caching requirements for the data disks.')\nparam dataDiskCaching string = 'ReadWrite'\n\n@description('Specifies the globally unique name for the storage account used to store the boot diagnostics logs of the virtual machine.')\nparam blobStorageAccountName string = 'boot${uniqueString(resourceGroup().id)}'\n\n@description('Specifies the name of the private link to the boot diagnostics storage account.')\nparam blobStorageAccountPrivateEndpointName string = 'BlobStorageAccountPrivateEndpoint'\n\n@description('Specifies the name of the private link to the Azure Container Registry.')\nparam acrPrivateEndpointName string = 'AcrPrivateEndpoint'\n\n@description('Name of your Azure Container Registry')\n@minLength(5)\n@maxLength(50)\nparam acrName string = 'acr${uniqueString(resourceGroup().id)}'\n\n@description('Enable admin user that have push / pull permission to the registry.')\nparam acrAdminUserEnabled bool = false\n\n@description('The default action of allow or deny when no other rules match. Allowed values: Allow or Deny')\n@allowed([\n  'Allow'\n  'Deny'\n])\nparam acrNetworkRuleSetDefaultAction string = 'Deny'\n\n@description('Whether or not public network access is allowed for the container registry. Allowed values: Enabled or Disabled')\n@allowed([\n  'Enabled'\n  'Disabled'\n])\nparam acrPublicNetworkAccess string = 'Enabled'\n\n@description('Tier of your Azure Container Registry.')\n@allowed([\n  'Basic'\n  'Standard'\n  'Premium'\n])\nparam acrSku string = 'Premium'\n\n@description('Specifies the Bastion subnet IP prefix. This prefix must be within vnet IP prefix address space.')\nparam bastionSubnetAddressPrefix string = '10.2.1.0/24'\n\n@description('Specifies the name of the Azure Bastion resource.')\nparam bastionHostName string = '${aksClusterName}Bastion'\n\n@description('Specifies the name of the private link to the Key Vault.')\nparam keyVaultPrivateEndpointName string = 'KeyVaultPrivateEndpoint'\n\n@description('Specifies the name of the Key Vault resource.')\nparam keyVaultName string = 'keyvault-${uniqueString(resourceGroup().id)}'\n\n@description('The default action of allow or deny when no other rules match. Allowed values: Allow or Deny')\n@allowed([\n  'Allow'\n  'Deny'\n])\nparam keyVaultNetworkRuleSetDefaultAction string = 'Deny'\n\n@description('Specifies the name of the Application Gateway.')\nparam applicationGatewayName string = 'appgw-${uniqueString(resourceGroup().id)}'\n\n@description('Specifies the name of the WAF policy')\nparam wafPolicyName string = '${applicationGatewayName}WafPolicy'\n\n@description('Specifies the mode of the WAF policy.')\n@allowed([\n  'Detection'\n  'Prevention'\n])\nparam wafPolicyMode string = 'Prevention'\n\n@description('Specifies the state of the WAF policy.')\n@allowed([\n  'Enabled'\n  'Disabled '\n])\nparam wafPolicyState string = 'Enabled'\n\n@description('Specifies the maximum file upload size in Mb for the WAF policy.')\nparam wafPolicyFileUploadLimitInMb int = 100\n\n@description('Specifies the maximum request body size in Kb for the WAF policy.')\nparam wafPolicyMaxRequestBodySizeInKb int = 128\n\n@description('Specifies the whether to allow WAF to check request Body.')\nparam wafPolicyRequestBodyCheck bool = true\n\n@description('Specifies the rule set type.')\nparam wafPolicyRuleSetType string = 'OWASP'\n\n@description('Specifies the rule set version.')\nparam wafPolicyRuleSetVersion string = '3.1'\n\n\n@description('Unique name (within the Resource Group) for the Action group.')\nparam actionGroupName string = 'actiongroup${uniqueString(resourceGroup().id)}'\n\n@description('Short name (maximum 12 characters) for the Action group.')\nparam actionGroupShortName string = 'actiongroup'\n\n@description('The list of email receivers that are part of this action group.')\nparam emailReceivers array = [\n  {\n    name: 'contosoEmail'\n    emailAddress: 'devops@contoso.com'\n  }\n]\n\n@description('The list of SMS receivers that are part of this action group.')\nparam smsReceivers array = [\n  {\n    name: 'smsReceiver'\n    countryCode: '1'\n    phoneNumber: '2134567891'\n  }\n]\n\n@description('The list of voice receivers that are part of this action group.')\nparam voiceReceivers array = [\n  {\n    name: 'voiceReceiver'\n    countryCode: '1'\n    phoneNumber: '2134567891'\n  }\n]\n\n\nvar securityProfileJson = {\n  uefiSettings: {\n    secureBootEnabled: true\n    vTpmEnabled: true\n  }\n  securityType: securityType\n}\nvar extensionName = 'GuestAttestation'\nvar extensionPublisher = 'Microsoft.Azure.Security.LinuxAttestation'\nvar extensionVersion = '1.0'\nvar maaTenantName = 'GuestAttestation'\nvar readerRoleDefinitionName = 'acdd72a7-3385-48ef-bd42-f606fba81ae7'\nvar contributorRoleDefinitionName = 'b24988ac-6180-42a0-ab88-20f7382dd24c'\nvar acrPullRoleDefinitionName = '7f951dda-4ed3-4680-a7ca-43fe172d538d'\nvar aksClusterUserDefinedManagedIdentityName = '${aksClusterName}ManagedIdentity'\nvar aadPodIdentityUserDefinedManagedIdentityName = '${aksClusterName}AadPodManagedIdentity'\nvar vmNicName = '${vmName}Nic'\nvar blobPublicDNSZoneForwarder = 'blob.${environment().suffixes.storage}'\nvar blobPrivateDnsZoneName = 'privatelink.${blobPublicDNSZoneForwarder}'\nvar blobStorageAccountPrivateEndpointGroupName = 'blob'\nvar blobPrivateDnsZoneGroupName = '${blobStorageAccountPrivateEndpointGroupName}PrivateDnsZoneGroup'\nvar linuxConfiguration = {\n  disablePasswordAuthentication: true\n  ssh: {\n    publicKeys: [\n      {\n        path: '/home/${vmAdminUsername}/.ssh/authorized_keys'\n        keyData: vmAdminPasswordOrKey\n      }\n    ]\n  }\n  provisionVMAgent: true\n}\n\nvar workspaceId = monitoring.outputs.logAnalyticsWorkspaceId\nvar readerRoleId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', readerRoleDefinitionName)\nvar contributorRoleId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', contributorRoleDefinitionName)\nvar acrPullRoleId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', acrPullRoleDefinitionName)\n\nvar containerInsightsSolutionName = 'ContainerInsights(${logAnalyticsWorkspaceName})'\nvar acrPublicDNSZoneForwarder = ((toLower(environment().name) == 'azureusgovernment') ? 'azurecr.us' : 'azurecr.io')\nvar acrPrivateDnsZoneName = 'privatelink.${acrPublicDNSZoneForwarder}'\nvar acrPrivateEndpointGroupName = 'registry'\nvar acrPrivateDnsZoneGroupName = '${acrPrivateEndpointGroupName}PrivateDnsZoneGroup'\n\nvar keyVaultPublicDNSZoneForwarder = ((toLower(environment().name) == 'azureusgovernment')\n  ? '.vaultcore.usgovcloudapi.net'\n  : '.vaultcore.azure.net')\nvar keyVaultPrivateDnsZoneName = 'privatelink${keyVaultPublicDNSZoneForwarder}'\nvar keyVaultPrivateEndpointGroupName = 'vault'\nvar keyVaultPrivateDnsZoneGroupName = '${keyVaultPrivateEndpointGroupName}PrivateDnsZoneGroup'\n\nmodule monitoring 'modules/monitoring/monitoring.bicep' = {\n  name: 'monitoringComponent'\n  params: {\n    location: location\n    logAnalyticsWorkspaceName: logAnalyticsWorkspaceName\n    logAnalyticsSku: logAnalyticsSku\n    logAnalyticsRetentionInDays: logAnalyticsRetentionInDays\n    containerInsightsSolutionName: containerInsightsSolutionName\n    actionGroupName: actionGroupName\n    actionGroupShortName: actionGroupShortName\n    emailReceivers: emailReceivers\n    smsReceivers: smsReceivers\n    voiceReceivers: voiceReceivers\n  }\n}\n\nmodule identity 'modules/identity/identity.bicep' = {\n  name: 'identityComponent'\n  params: {\n    location: location\n    applicationGatewayName: applicationGatewayName\n    aksClusterUserDefinedManagedIdentityName: aksClusterUserDefinedManagedIdentityName\n    aadPodIdentityUserDefinedManagedIdentityName: aadPodIdentityUserDefinedManagedIdentityName\n  }\n}\n\nmodule network 'modules/networks/main.bicep' = {\n  name: 'networkComponent'\n  params: {\n    location: location\n    virtualNetworkName: virtualNetworkName\n    virtualNetworkAddressPrefixes: virtualNetworkAddressPrefixes\n    aksSubnetName: aksSubnetName\n    aksSubnetAddressPrefix: aksSubnetAddressPrefix\n    vmSubnetName: vmSubnetName\n    vmSubnetAddressPrefix: vmSubnetAddressPrefix\n    applicationGatewaySubnetName: applicationGatewaySubnetName\n    applicationGatewaySubnetAddressPrefix: applicationGatewaySubnetAddressPrefix\n    bastionSubnetAddressPrefix: bastionSubnetAddressPrefix\n    bastionHostName: bastionHostName\n    workspaceId: workspaceId\n  }\n}\n\nmodule keyvault 'modules/security/keyvault.bicep' = {\n  name: 'keyVaultComponent'\n  params: {\n    location: location\n    keyVaultName: keyVaultName\n    aadPodIdentityUserDefinedManagedIdentityTenantId: identity.outputs.aadPodIdentityUserDefinedManagedIdentityTenantId\n    aadPodIdentityUserDefinedManagedIdentityPrincipalId: identity.outputs.aadPodIdentityUserDefinedManagedIdentityPrincipalId\n    applicationGatewayUserDefinedManagedIdentityTenantId: identity.outputs.applicationGatewayUserDefinedManagedIdentityTenantId\n    applicationGatewayUserDefinedManagedIdentityPrincipalId: identity.outputs.applicationGatewayUserDefinedManagedIdentityPrincipalId\n    keyVaultNetworkRuleSetDefaultAction: keyVaultNetworkRuleSetDefaultAction\n    workspaceId: workspaceId\n    readerRoleId: readerRoleId\n    keyVaultPrivateDnsZoneName: keyVaultPrivateDnsZoneName\n    virtualNetworkName: virtualNetworkName\n    virtualNetworkId: network.outputs.virtualNetworkId\n    privateEndpointSubnetId: network.outputs.vmSubnetId\n    keyVaultPrivateEndpointName: keyVaultPrivateEndpointName\n    keyVaultPrivateEndpointGroupName: keyVaultPrivateEndpointGroupName\n    keyVaultPrivateDnsZoneGroupName: keyVaultPrivateDnsZoneGroupName\n  }\n}\n\nmodule compute 'modules/computes/virtualmachine.bicep' = {\n  name: 'virtualMachineComponent'\n  params: {\n    location: location\n    virtualNetworkId: network.outputs.virtualNetworkId\n    blobStorageAccountName: blobStorageAccountName\n    blobPrivateDnsZoneName: blobPrivateDnsZoneName\n    blobStorageAccountPrivateEndpointName: blobStorageAccountPrivateEndpointName\n    blobStorageAccountPrivateEndpointGroupName: blobStorageAccountPrivateEndpointGroupName\n    blobPrivateDnsZoneGroupName: blobPrivateDnsZoneGroupName\n    vmNicName: vmNicName\n    vmSubnetId: network.outputs.vmSubnetId\n    vmName: vmName\n    vmSize: vmSize\n    vmAdminUsername: vmAdminUsername\n    vmAdminPasswordOrKey: vmAdminPasswordOrKey\n    authenticationType: authenticationType\n    linuxConfiguration: linuxConfiguration\n    securityType: securityType\n    securityProfileJson: securityProfileJson\n    imagePublisher: imagePublisher\n    imageOffer: imageOffer\n    imageSku: imageSku\n    osDiskSize: osDiskSize\n    diskStorageAccounType: diskStorageAccounType\n    numDataDisks: numDataDisks\n    dataDiskCaching: dataDiskCaching\n    dataDiskSize: dataDiskSize\n    extensionPublisher: extensionPublisher\n    extensionName: extensionName\n    extensionVersion: extensionVersion\n    maaTenantName: maaTenantName\n  }\n}\n\nmodule applicateGateway 'modules/networks/applicationgateway.bicep' = {\n  name: 'applicationGatewayComponent'\n  params: {\n    location: location\n    workspaceId: workspaceId\n    applicationGatewayName: applicationGatewayName\n    applicationGatewaySubnetId: network.outputs.applicationGatewaySubnetId\n    wafPolicyName: wafPolicyName\n    wafPolicyMode: wafPolicyMode\n    wafPolicyState: wafPolicyState\n    wafPolicyFileUploadLimitInMb: wafPolicyFileUploadLimitInMb\n    wafPolicyMaxRequestBodySizeInKb: wafPolicyMaxRequestBodySizeInKb\n    wafPolicyRequestBodyCheck: wafPolicyRequestBodyCheck\n    wafPolicyRuleSetType: wafPolicyRuleSetType\n    wafPolicyRuleSetVersion: wafPolicyRuleSetVersion\n    applicationGatewayUserDefinedManagedIdentityId: identity.outputs.applicationGatewayUserDefinedManagedIdentityId\n  }\n}\n\nmodule kubernetes 'modules/containerservices/kubernetes.bicep' = {\n  name: 'kubernetesComponent'\n  params: {\n    location: location\n    aksClusterUserDefinedManagedIdentityPrincipalId: identity.outputs.aksClusterUserDefinedManagedIdentityPrincipalId\n    aksClusterUserDefinedManagedIdentityId: identity.outputs.aksClusterUserDefinedManagedIdentityId\n    contributorRoleId: contributorRoleId\n    workspaceId: workspaceId\n    aksClusterName: aksClusterName\n    aksClusterTags: aksClusterTags\n    aksClusterDnsPrefix: aksClusterDnsPrefix\n    aksClusterSkuName: aksClusterSkuName\n    aksClusterSkuTier: aksClusterSkuTier\n    systemNodePoolName: systemNodePoolName\n    systemNodePoolAgentCount: systemNodePoolAgentCount\n    systemNodePoolVmSize: systemNodePoolVmSize\n    systemNodePoolOsDiskSizeGB: systemNodePoolOsDiskSizeGB\n    aksSubnetId: network.outputs.aksSubnetId\n    systemNodePoolMaxPods: systemNodePoolMaxPods\n    systemNodePoolOsType: systemNodePoolOsType\n    systemNodePoolMaxCount: systemNodePoolMaxCount\n    systemNodePoolMinCount: systemNodePoolMinCount\n    systemNodePoolScaleSetPriority: systemNodePoolScaleSetPriority\n    systemNodePoolScaleSetEvictionPolicy: systemNodePoolScaleSetEvictionPolicy\n    systemNodePoolEnableAutoScaling: systemNodePoolEnableAutoScaling\n    systemNodePoolType: systemNodePoolType\n    userNodePoolName: userNodePoolName\n    userNodePoolAgentCount: userNodePoolAgentCount\n    userNodePoolVmSize: userNodePoolVmSize\n    userNodePoolOsDiskSizeGB: userNodePoolOsDiskSizeGB\n    userNodePoolMaxPods: userNodePoolMaxPods\n    userNodePoolOsType: userNodePoolOsType\n    userNodePoolMaxCount: userNodePoolMaxCount\n    userNodePoolMinCount: userNodePoolMinCount\n    userNodePoolScaleSetPriority: userNodePoolScaleSetPriority\n    userNodePoolScaleSetEvictionPolicy: userNodePoolScaleSetEvictionPolicy\n    userNodePoolEnableAutoScaling: userNodePoolEnableAutoScaling\n    userNodePoolType: userNodePoolType\n    aksClusterAdminUsername: aksClusterAdminUsername\n    aksClusterSshPublicKey: aksClusterSshPublicKey\n    httpApplicationRoutingEnabled: httpApplicationRoutingEnabled\n    aciConnectorLinuxEnabled: aciConnectorLinuxEnabled\n    azurePolicyEnabled: azurePolicyEnabled\n    kubeDashboardEnabled: kubeDashboardEnabled\n    applicationGatewayId: applicateGateway.outputs.applicationGatewayId\n    podIdentityProfileEnabled: podIdentityProfileEnabled\n    aksClusterNetworkPlugin: aksClusterNetworkPlugin\n    aksClusterNetworkPolicy: aksClusterNetworkPolicy\n    aksClusterPodCidr: aksClusterPodCidr\n    aksClusterServiceCidr: aksClusterServiceCidr\n    aksClusterDnsServiceIP: aksClusterDnsServiceIP\n    aksClusterOutboundType: aksClusterOutboundType\n    aksClusterLoadBalancerSku: aksClusterLoadBalancerSku\n    autoScalerProfileScanInterval: autoScalerProfileScanInterval\n    autoScalerProfileScaleDownDelayAfterAdd: autoScalerProfileScaleDownDelayAfterAdd\n    autoScalerProfileScaleDownDelayAfterDelete: autoScalerProfileScaleDownDelayAfterDelete\n    autoScalerProfileScaleDownDelayAfterFailure: autoScalerProfileScaleDownDelayAfterFailure\n    autoScalerProfileScaleDownUnneededTime: autoScalerProfileScaleDownUnneededTime\n    autoScalerProfileScaleDownUnreadyTime: autoScalerProfileScaleDownUnreadyTime\n    autoScalerProfileUtilizationThreshold: autoScalerProfileUtilizationThreshold\n    autoScalerProfileMaxGracefulTerminationSec: autoScalerProfileMaxGracefulTerminationSec\n    aksClusterEnablePrivateCluster: aksClusterEnablePrivateCluster\n  }\n}\n\nmodule containerRegistry 'modules/containerservices/containerregistry.bicep' = {\n  name: 'containerRegistryComponent'\n  params: {\n    location: location\n    acrName: acrName\n    acrSku: acrSku\n    acrAdminUserEnabled: acrAdminUserEnabled\n    acrNetworkRuleSetDefaultAction: acrNetworkRuleSetDefaultAction\n    acrPublicNetworkAccess: acrPublicNetworkAccess\n    acrPullRoleId: acrPullRoleId\n    aksClusterKubeletidentityObjectId: kubernetes.outputs.aksClusterKubeletidentityObjectId\n    workspaceId: workspaceId\n    acrPrivateDnsZoneName: acrPrivateDnsZoneName\n    virtualNetworkId: network.outputs.virtualNetworkId\n    acrPrivateEndpointName: acrPrivateEndpointName\n    acrPrivateEndpointGroupName: acrPrivateEndpointGroupName\n    privateEndpointSubnetId: network.outputs.vmSubnetId\n    acrPrivateDnsZoneGroupName: acrPrivateDnsZoneGroupName\n  }\n}\n\nmodule roleAssignment 'modules/roleassignment/roleassignment.bicep' = {\n  name: 'roleAssignmentComponent'\n  params: {\n    applicationGatewayUserDefinedManagedIdentityId: identity.outputs.applicationGatewayUserDefinedManagedIdentityId\n    applicationGatewayId: applicateGateway.outputs.applicationGatewayId\n    aksClusterIngressApplicationGatewayObjectId: kubernetes.outputs.aksClusteringressApplicationGatewayIdentity\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1173."}, {"role": "assistant", "content": "@description('Specifies the location of AKS cluster.')\nparam location string\nparam blobStorageAccountName string\nparam blobPrivateDnsZoneName string\nparam blobStorageAccountPrivateEndpointName string\nparam blobStorageAccountPrivateEndpointGroupName string\nparam blobPrivateDnsZoneGroupName string\nparam virtualNetworkId string\nparam vmNicName string\nparam vmSubnetId string\nparam vmName string\nparam vmSize string\nparam vmAdminUsername string\n@secure()\nparam vmAdminPasswordOrKey string\nparam authenticationType string\nparam linuxConfiguration object\nparam securityType string\nparam securityProfileJson object\nparam imagePublisher string\nparam imageOffer string\nparam imageSku string\nparam osDiskSize int\nparam diskStorageAccounType string\nparam numDataDisks int\nparam dataDiskCaching string\nparam dataDiskSize int\nparam extensionPublisher string\nparam extensionName string\nparam extensionVersion string\nparam maaTenantName string\n\nresource blobStorageAccount 'Microsoft.Storage/storageAccounts@2023-05-01' = {\n  name: blobStorageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'StorageV2'\n}\n\nresource blobPrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = {\n  name: blobPrivateDnsZoneName\n  location: 'global'\n}\n\nresource blobPrivateDnsZoneName_link_to_virtualNetwork 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01' = {\n  parent: blobPrivateDnsZone\n  name: 'link_to_${toLower(split(virtualNetworkId, '/')[8])}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\nresource blobStorageAccountPrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\n  name: blobStorageAccountPrivateEndpointName\n  location: location\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: blobStorageAccountPrivateEndpointName\n        properties: {\n          privateLinkServiceId: blobStorageAccount.id\n          groupIds: [\n            blobStorageAccountPrivateEndpointGroupName\n          ]\n        }\n      }\n    ]\n    subnet: {\n      id: vmSubnetId\n    }\n  }\n}\n\nresource blobStorageAccountPrivateEndpointName_blobPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2024-01-01' = {\n  parent: blobStorageAccountPrivateEndpoint\n  name: blobPrivateDnsZoneGroupName\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'dnsConfig'\n        properties: {\n          privateDnsZoneId: blobPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource vmNic 'Microsoft.Network/networkInterfaces@2024-01-01' = {\n  name: vmNicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: vmSubnetId\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource vm 'Microsoft.Compute/virtualMachines@2024-07-01' = {\n  name: vmName\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: vmName\n      adminUsername: vmAdminUsername\n      adminPassword: vmAdminPasswordOrKey\n      linuxConfiguration: ((authenticationType == 'password') ? {} : linuxConfiguration)\n    }\n    securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\n    storageProfile: {\n      imageReference: {\n        publisher: imagePublisher\n        offer: imageOffer\n        sku: imageSku\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${vmName}_OSDisk'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        diskSizeGB: osDiskSize\n        managedDisk: {\n          storageAccountType: diskStorageAccounType\n        }\n      }\n      dataDisks: [\n        for j in range(0, numDataDisks): {\n          caching: dataDiskCaching\n          diskSizeGB: dataDiskSize\n          lun: j\n          name: '${vmName}-DataDisk${j}'\n          createOption: 'Empty'\n          managedDisk: {\n            storageAccountType: diskStorageAccounType\n          }\n        }\n      ]\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: vmNic.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: blobStorageAccount.properties.primaryEndpoints.blob\n      }\n    }\n  }\n}\n\nresource vmName_GuestAttestation 'Microsoft.Compute/virtualMachines/extensions@2024-07-01' = if ((securityType == 'TrustedLaunch') && ((securityProfileJson.uefiSettings.secureBootEnabled == true) && (securityProfileJson.uefiSettings.vTpmEnabled == true))) {\n  parent: vm\n  name: 'GuestAttestation'\n  location: location\n  properties: {\n    publisher: extensionPublisher\n    type: extensionName\n    typeHandlerVersion: extensionVersion\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      AttestationConfig: {\n        MaaSettings: {\n          maaTenantName: maaTenantName\n        }\n        useCustomToken: 'false'\n        disableAlerts: 'false'\n      }\n    }\n  }\n}\n\nresource vmName_AzureMonitorLinuxAgent 'Microsoft.Compute/virtualMachines/extensions@2024-07-01' = {\n  parent: vm\n  name: 'AzureMonitorLinuxAgent'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Monitor'\n    type: 'AzureMonitorLinuxAgent'\n    typeHandlerVersion: '1.21'\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1174?"}, {"role": "assistant", "content": "param location string\nparam acrName string\nparam acrSku string\nparam acrAdminUserEnabled bool\nparam acrNetworkRuleSetDefaultAction string\nparam acrPublicNetworkAccess string\nparam acrPullRoleId string\nparam aksClusterKubeletidentityObjectId string\nparam workspaceId string\nparam acrPrivateDnsZoneName string\nparam virtualNetworkId string\nparam acrPrivateEndpointName string\nparam acrPrivateEndpointGroupName string\nparam privateEndpointSubnetId string\nparam acrPrivateDnsZoneGroupName string\n\nresource acr 'Microsoft.ContainerRegistry/registries@2023-11-01-preview' = {\n  name: acrName\n  location: location\n  tags: {\n    displayName: 'Container Registry'\n    'container.registry': acrName\n  }\n  sku: {\n    name: acrSku\n  }\n  properties: {\n    adminUserEnabled: acrAdminUserEnabled\n    networkRuleSet: {\n      defaultAction: acrNetworkRuleSetDefaultAction\n    }\n    policies: {\n      quarantinePolicy: {\n        status: 'disabled'\n      }\n      trustPolicy: {\n        type: 'Notary'\n        status: 'disabled'\n      }\n      retentionPolicy: {\n        days: 15\n        status: 'enabled'\n      }\n    }\n    publicNetworkAccess: acrPublicNetworkAccess\n    encryption: {\n      status: 'disabled'\n    }\n    dataEndpointEnabled: true\n    networkRuleBypassOptions: 'AzureServices'\n  }\n}\n\nresource acrName_acrPullRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: guid(resourceGroup().id, acr.id, 'acrPull')\n  properties: {\n    roleDefinitionId: acrPullRoleId\n    principalId: aksClusterKubeletidentityObjectId\n    principalType: 'ServicePrincipal'\n  }\n}\n\nresource acrDiag 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: acr\n  name: '${acrName}-Diag'\n  properties: {\n    workspaceId: workspaceId\n    metrics: [\n      {\n        timeGrain: 'PT1M'\n        category: 'AllMetrics'\n        enabled: true\n      }\n    ]\n    logs: [\n      {\n        category: 'ContainerRegistryRepositoryEvents'\n        enabled: true\n      }\n      {\n        category: 'ContainerRegistryLoginEvents'\n        enabled: true\n      }\n    ]\n  }\n}\n\nresource acrPrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = {\n  name: acrPrivateDnsZoneName\n  location: 'global'\n  properties: {}\n}\n\nresource acrPrivateDnsZoneVirtualNetworkLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01' = {\n  parent: acrPrivateDnsZone\n  name: 'link_to_${toLower(split(virtualNetworkId, '/')[8])}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\nresource acrPrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\n  name: acrPrivateEndpointName\n  location: location\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: acrPrivateEndpointName\n        properties: {\n          privateLinkServiceId: acr.id\n          groupIds: [\n            acrPrivateEndpointGroupName\n          ]\n        }\n      }\n    ]\n    subnet: {\n      id: privateEndpointSubnetId\n    }\n  }\n}\n\nresource acrPrivateEndpointPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2024-01-01' = {\n  parent: acrPrivateEndpoint\n  name: acrPrivateDnsZoneGroupName\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'dnsConfig'\n        properties: {\n          privateDnsZoneId: acrPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1175."}, {"role": "assistant", "content": "param location string\nparam aksClusterUserDefinedManagedIdentityPrincipalId string\nparam aksClusterUserDefinedManagedIdentityId string\nparam contributorRoleId string\nparam workspaceId string\nparam aksClusterName string\nparam aksClusterTags object\nparam aksClusterDnsPrefix string\nparam aksClusterSkuName string\nparam aksClusterSkuTier string\nparam systemNodePoolName string\nparam systemNodePoolAgentCount int\nparam systemNodePoolVmSize string\nparam systemNodePoolOsDiskSizeGB int\nparam aksSubnetId string\nparam systemNodePoolMaxPods int\nparam systemNodePoolOsType string\nparam systemNodePoolMaxCount int\nparam systemNodePoolMinCount int\nparam systemNodePoolScaleSetPriority string\nparam systemNodePoolScaleSetEvictionPolicy string\nparam systemNodePoolEnableAutoScaling bool\nparam systemNodePoolType string\nparam userNodePoolName string\nparam userNodePoolAgentCount int\nparam userNodePoolVmSize string\nparam userNodePoolOsDiskSizeGB int\nparam userNodePoolMaxPods int\nparam userNodePoolOsType string\nparam userNodePoolMaxCount int\nparam userNodePoolMinCount int\nparam userNodePoolScaleSetPriority string\nparam userNodePoolScaleSetEvictionPolicy string\nparam userNodePoolEnableAutoScaling bool\nparam userNodePoolType string\nparam aksClusterAdminUsername string\nparam aksClusterSshPublicKey string\nparam httpApplicationRoutingEnabled bool\nparam aciConnectorLinuxEnabled bool\nparam azurePolicyEnabled bool\nparam kubeDashboardEnabled bool\nparam applicationGatewayId string\nparam podIdentityProfileEnabled bool\nparam aksClusterNetworkPlugin string\nparam aksClusterNetworkPolicy string\nparam aksClusterPodCidr string\nparam aksClusterServiceCidr string\nparam aksClusterDnsServiceIP string\nparam aksClusterOutboundType string\nparam aksClusterLoadBalancerSku string\nparam autoScalerProfileScanInterval string\nparam autoScalerProfileScaleDownDelayAfterAdd string\nparam autoScalerProfileScaleDownDelayAfterDelete string\nparam autoScalerProfileScaleDownDelayAfterFailure string\nparam autoScalerProfileScaleDownUnneededTime string\nparam autoScalerProfileScaleDownUnreadyTime string\nparam autoScalerProfileUtilizationThreshold string\nparam autoScalerProfileMaxGracefulTerminationSec string\nparam aksClusterEnablePrivateCluster bool\n\nresource aksContributorRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: guid(resourceGroup().id, aksClusterUserDefinedManagedIdentityPrincipalId, 'Contributor')\n  properties: {\n    roleDefinitionId: contributorRoleId\n    description: 'Assign the cluster user-defined managed identity contributor role on the resource group.'\n    principalId: aksClusterUserDefinedManagedIdentityPrincipalId\n    principalType: 'ServicePrincipal'\n  }\n}\n\nresource aksCluster 'Microsoft.ContainerService/managedClusters@2024-07-01' = {\n  name: aksClusterName\n  location: location\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${aksClusterUserDefinedManagedIdentityId}': {}\n    }\n  }\n  tags: aksClusterTags\n  sku: {\n    name: aksClusterSkuName\n    tier: aksClusterSkuTier\n  }\n  properties: {\n    dnsPrefix: aksClusterDnsPrefix\n    agentPoolProfiles: [\n      {\n        name: toLower(systemNodePoolName)\n        count: systemNodePoolAgentCount\n        vmSize: systemNodePoolVmSize\n        osDiskSizeGB: systemNodePoolOsDiskSizeGB\n        vnetSubnetID: aksSubnetId\n        maxPods: systemNodePoolMaxPods\n        osType: systemNodePoolOsType\n        maxCount: systemNodePoolMaxCount\n        minCount: systemNodePoolMinCount\n        scaleSetPriority: systemNodePoolScaleSetPriority\n        scaleSetEvictionPolicy: systemNodePoolScaleSetEvictionPolicy\n        enableAutoScaling: systemNodePoolEnableAutoScaling\n        mode: 'System'\n        type: systemNodePoolType\n      }\n      {\n        name: toLower(userNodePoolName)\n        count: userNodePoolAgentCount\n        vmSize: userNodePoolVmSize\n        osDiskSizeGB: userNodePoolOsDiskSizeGB\n        vnetSubnetID: aksSubnetId\n        maxPods: userNodePoolMaxPods\n        osType: userNodePoolOsType\n        maxCount: userNodePoolMaxCount\n        minCount: userNodePoolMinCount\n        scaleSetPriority: userNodePoolScaleSetPriority\n        scaleSetEvictionPolicy: userNodePoolScaleSetEvictionPolicy\n        enableAutoScaling: userNodePoolEnableAutoScaling\n        mode: 'User'\n        type: userNodePoolType\n      }\n    ]\n    linuxProfile: {\n      adminUsername: aksClusterAdminUsername\n      ssh: {\n        publicKeys: [\n          {\n            keyData: aksClusterSshPublicKey\n          }\n        ]\n      }\n    }\n    addonProfiles: {\n      httpApplicationRouting: {\n        enabled: httpApplicationRoutingEnabled\n      }\n      omsagent: {\n        enabled: true\n        config: {\n          logAnalyticsWorkspaceResourceID: workspaceId\n        }\n      }\n      aciConnectorLinux: {\n        enabled: aciConnectorLinuxEnabled\n      }\n      azurepolicy: {\n        enabled: azurePolicyEnabled\n        config: {\n          version: 'v2'\n        }\n      }\n      kubeDashboard: {\n        enabled: kubeDashboardEnabled\n      }\n      ingressApplicationGateway: {\n        config: {\n          applicationGatewayId: applicationGatewayId\n        }\n        enabled: true\n        \n      }\n    }\n    podIdentityProfile: {\n      enabled: podIdentityProfileEnabled\n    }\n    enableRBAC: true\n    networkProfile: {\n      networkPlugin: aksClusterNetworkPlugin\n      networkPolicy: aksClusterNetworkPolicy\n      podCidr: aksClusterPodCidr\n      serviceCidr: aksClusterServiceCidr\n      dnsServiceIP: aksClusterDnsServiceIP\n      outboundType: aksClusterOutboundType\n      loadBalancerSku: aksClusterLoadBalancerSku\n    }\n    autoScalerProfile: {\n      'scan-interval': autoScalerProfileScanInterval\n      'scale-down-delay-after-add': autoScalerProfileScaleDownDelayAfterAdd\n      'scale-down-delay-after-delete': autoScalerProfileScaleDownDelayAfterDelete\n      'scale-down-delay-after-failure': autoScalerProfileScaleDownDelayAfterFailure\n      'scale-down-unneeded-time': autoScalerProfileScaleDownUnneededTime\n      'scale-down-unready-time': autoScalerProfileScaleDownUnreadyTime\n      'scale-down-utilization-threshold': autoScalerProfileUtilizationThreshold\n      'max-graceful-termination-sec': autoScalerProfileMaxGracefulTerminationSec\n    }\n    apiServerAccessProfile: {\n      enablePrivateCluster: aksClusterEnablePrivateCluster\n    }\n  }\n}\n\nresource aksClusterDiag 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: aksCluster\n  name: '${aksClusterName}-Diag'\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'kube-apiserver'\n        enabled: true\n      }\n      {\n        category: 'kube-audit'\n        enabled: true\n      }\n      {\n        category: 'kube-audit-admin'\n        enabled: true\n      }\n      {\n        category: 'kube-controller-manager'\n        enabled: true\n      }\n      {\n        category: 'kube-scheduler'\n        enabled: true\n      }\n      {\n        category: 'cluster-autoscaler'\n        enabled: true\n      }\n      {\n        category: 'guard'\n        enabled: true\n      }\n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n      }\n    ]\n  }\n}\n\noutput aksClusterKubeletidentityObjectId string = aksCluster.properties.identityProfile.kubeletidentity.objectId\noutput aksClusteringressApplicationGatewayIdentity string = aksCluster.properties.addonProfiles.ingressApplicationGateway.identity.objectId\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1176."}, {"role": "assistant", "content": "param location string\nparam applicationGatewayName string\nparam aksClusterUserDefinedManagedIdentityName string\nparam aadPodIdentityUserDefinedManagedIdentityName string\n\nvar applicationGatewayUserDefinedManagedIdentityName = '${applicationGatewayName}ManagedIdentity'\n\nresource applicationGatewayUserDefinedManagedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2023-01-31' = {\n  name: applicationGatewayUserDefinedManagedIdentityName\n  location: location\n}\n\nresource aksClusterUserDefinedManagedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2023-07-31-preview' = {\n  name: aksClusterUserDefinedManagedIdentityName\n  location: location\n}\n\nresource aadPodIdentityUserDefinedManagedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2023-07-31-preview' = {\n  name: aadPodIdentityUserDefinedManagedIdentityName\n  location: location\n}\n\noutput applicationGatewayUserDefinedManagedIdentityId string = applicationGatewayUserDefinedManagedIdentity.id\noutput aksClusterUserDefinedManagedIdentityId string = aksClusterUserDefinedManagedIdentity.id\noutput aadPodIdentityUserDefinedManagedIdentityId string = aadPodIdentityUserDefinedManagedIdentity.id\n\noutput applicationGatewayUserDefinedManagedIdentityTenantId string = applicationGatewayUserDefinedManagedIdentity.properties.tenantId\noutput aksClusterUserDefinedManagedIdentityTenantId string = aksClusterUserDefinedManagedIdentity.properties.tenantId\noutput aadPodIdentityUserDefinedManagedIdentityTenantId string = aadPodIdentityUserDefinedManagedIdentity.properties.tenantId\n\noutput applicationGatewayUserDefinedManagedIdentityPrincipalId string = applicationGatewayUserDefinedManagedIdentity.properties.principalId\noutput aksClusterUserDefinedManagedIdentityPrincipalId string = aksClusterUserDefinedManagedIdentity.properties.principalId\noutput aadPodIdentityUserDefinedManagedIdentityPrincipalId string = aadPodIdentityUserDefinedManagedIdentity.properties.principalId\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1177."}, {"role": "assistant", "content": "param location string\nparam logAnalyticsWorkspaceName string\nparam logAnalyticsSku string\nparam logAnalyticsRetentionInDays int\nparam containerInsightsSolutionName string\nparam actionGroupName string\nparam actionGroupShortName string\nparam emailReceivers array\nparam smsReceivers array\nparam voiceReceivers array\n\n\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2023-09-01' = {\n  name: logAnalyticsWorkspaceName\n  location: location\n  properties: {\n    sku: {\n      name: logAnalyticsSku\n    }\n    retentionInDays: logAnalyticsRetentionInDays\n  }\n}\n\nresource containerInsightsSolution 'Microsoft.OperationsManagement/solutions@2015-11-01-preview' = {\n  name: containerInsightsSolutionName\n  location: location\n  plan: {\n    name: containerInsightsSolutionName\n    product: 'OMSGallery/ContainerInsights'\n    publisher: 'Microsoft'\n    promotionCode: ''\n  }\n  properties: {\n    workspaceResourceId: logAnalyticsWorkspace.id\n  }\n}\n\nresource actionGroup 'Microsoft.Insights/actionGroups@2023-09-01-preview' = {\n  name: actionGroupName\n  location: 'Global'\n  properties: {\n    groupShortName: actionGroupShortName\n    enabled: true\n    emailReceivers: emailReceivers\n    smsReceivers: smsReceivers\n    voiceReceivers: voiceReceivers\n  }\n}\n\nresource AllAzureAdvisorAlert 'Microsoft.Insights/activityLogAlerts@2020-10-01' = {\n  name: 'AllAzureAdvisorAlert'\n  location: 'Global'\n  properties: {\n    scopes: [\n      resourceGroup().id\n    ]\n    actions: {\n      actionGroups: [\n        {\n          actionGroupId: actionGroup.id\n        }\n      ]\n    }\n    condition: {\n      allOf: [\n        {\n          field: 'category'\n          equals: 'Recommendation'\n        }\n        {\n          field: 'operationName'\n          equals: 'Microsoft.Advisor/recommendations/available/action'\n        }\n      ]\n    }\n    enabled: true\n    description: 'All azure advisor alerts'\n  }\n}\n\noutput logAnalyticsWorkspaceId string = logAnalyticsWorkspace.id\noutput containerInsightsSolutionId string = containerInsightsSolution.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1178 please."}, {"role": "assistant", "content": "@description('Specifies the location of AKS cluster.')\nparam location string\n\n@description('Specifies the resource ID of the log analytics workspace')\nparam workspaceId string\n\n@description('Specifies the name of the Application Gateway.')\nparam applicationGatewayName string\n\nparam applicationGatewaySubnetId string\n\n@description('Specifies the name of the WAF policy')\nparam wafPolicyName string\n\n@description('Specifies the mode of the WAF policy.')\n@allowed([\n  'Detection'\n  'Prevention'\n])\nparam wafPolicyMode string\n\n@description('Specifies the state of the WAF policy.')\n@allowed([\n  'Enabled'\n  'Disabled '\n])\nparam wafPolicyState string\n\n@description('Specifies the maximum file upload size in Mb for the WAF policy.')\nparam wafPolicyFileUploadLimitInMb int\n\n@description('Specifies the maximum request body size in Kb for the WAF policy.')\nparam wafPolicyMaxRequestBodySizeInKb int\n\n@description('Specifies the whether to allow WAF to check request Body.')\nparam wafPolicyRequestBodyCheck bool\n\n@description('Specifies the rule set type.')\nparam wafPolicyRuleSetType string\n\n@description('Specifies the rule set version.')\nparam wafPolicyRuleSetVersion string\n\nparam applicationGatewayUserDefinedManagedIdentityId string\n\nvar applicationGatewayPublicIPAddressName = '${applicationGatewayName}PublicIp'\nvar applicationGatewayUserDefinedManagedIdentityName = '${applicationGatewayName}ManagedIdentity'\n\nvar applicationGatewayIPConfigurationName = 'applicationGatewayIPConfiguration'\nvar applicationGatewayFrontendIPConfigurationName = 'applicationGatewayFrontendIPConfiguration'\nvar applicationGatewayFrontendIPConfigurationId = resourceId(\n  'Microsoft.Network/applicationGateways/frontendIPConfigurations',\n  applicationGatewayName,\n  applicationGatewayFrontendIPConfigurationName\n)\nvar applicationGatewayFrontendPortName = 'applicationGatewayFrontendPort'\nvar applicationGatewayFrontendPortId = resourceId(\n  'Microsoft.Network/applicationGateways/frontendPorts',\n  applicationGatewayName,\n  applicationGatewayFrontendPortName\n)\nvar applicationGatewayHttpListenerName = 'applicationGatewayHttpListener'\nvar applicationGatewayHttpListenerId = resourceId(\n  'Microsoft.Network/applicationGateways/httpListeners',\n  applicationGatewayName,\n  applicationGatewayHttpListenerName\n)\nvar applicationGatewayBackendAddressPoolName = 'applicationGatewayBackendPool'\nvar applicationGatewayBackendAddressPoolId = resourceId(\n  'Microsoft.Network/applicationGateways/backendAddressPools',\n  applicationGatewayName,\n  applicationGatewayBackendAddressPoolName\n)\nvar applicationGatewayBackendHttpSettingsName = 'applicationGatewayBackendHttpSettings'\nvar applicationGatewayBackendHttpSettingsId = resourceId(\n  'Microsoft.Network/applicationGateways/backendHttpSettingsCollection',\n  applicationGatewayName,\n  applicationGatewayBackendHttpSettingsName\n)\nvar applicationGatewayRequestRoutingRuleName = 'default'\n\nresource applicationGatewayPublicIPAddress 'Microsoft.Network/publicIPAddresses@2024-01-01' = {\n  name: applicationGatewayPublicIPAddressName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource applicationGatewayUserDefinedManagedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2023-01-31' = {\n  name: applicationGatewayUserDefinedManagedIdentityName\n  location: location\n}\n\nresource wafPolicy 'Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies@2024-01-01' = {\n  name: wafPolicyName\n  location: location\n  properties: {\n    customRules: [\n      {\n        name: 'BlockMe'\n        priority: 1\n        ruleType: 'MatchRule'\n        action: 'Block'\n        matchConditions: [\n          {\n            matchVariables: [\n              {\n                variableName: 'QueryString'\n              }\n            ]\n            operator: 'Contains'\n            negationConditon: false\n            matchValues: [\n              'blockme'\n            ]\n          }\n        ]\n      }\n      {\n        name: 'BlockEvilBot'\n        priority: 2\n        ruleType: 'MatchRule'\n        action: 'Block'\n        matchConditions: [\n          {\n            matchVariables: [\n              {\n                variableName: 'RequestHeaders'\n                selector: 'User-Agent'\n              }\n            ]\n            operator: 'Contains'\n            negationConditon: false\n            matchValues: [\n              'evilbot'\n            ]\n            transforms: [\n              'Lowercase'\n            ]\n          }\n        ]\n      }\n    ]\n    policySettings: {\n      requestBodyCheck: wafPolicyRequestBodyCheck\n      maxRequestBodySizeInKb: wafPolicyMaxRequestBodySizeInKb\n      fileUploadLimitInMb: wafPolicyFileUploadLimitInMb\n      mode: wafPolicyMode\n      state: wafPolicyState\n    }\n    managedRules: {\n      managedRuleSets: [\n        {\n          ruleSetType: wafPolicyRuleSetType\n          ruleSetVersion: wafPolicyRuleSetVersion\n        }\n      ]\n    }\n  }\n}\n\nresource applicationGateway 'Microsoft.Network/applicationGateways@2024-01-01' = {\n  name: applicationGatewayName\n  location: location\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${applicationGatewayUserDefinedManagedIdentityId}': {}\n    }\n  }\n  properties: {\n    sku: {\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n    }\n    gatewayIPConfigurations: [\n      {\n        name: applicationGatewayIPConfigurationName\n        properties: {\n          subnet: {\n            id: applicationGatewaySubnetId\n          }\n        }\n      }\n    ]\n    frontendIPConfigurations: [\n      {\n        name: applicationGatewayFrontendIPConfigurationName\n        properties: {\n          publicIPAddress: {\n            id: applicationGatewayPublicIPAddress.id\n          }\n        }\n      }\n    ]\n    frontendPorts: [\n      {\n        name: applicationGatewayFrontendPortName\n        properties: {\n          port: 80\n        }\n      }\n    ]\n    autoscaleConfiguration: {\n      minCapacity: 0\n      maxCapacity: 10\n    }\n    enableHttp2: false\n    probes: [\n      {\n        name: 'defaultHttpProbe'\n        properties: {\n          protocol: 'Http'\n          path: '/'\n          interval: 30\n          timeout: 30\n          unhealthyThreshold: 3\n          pickHostNameFromBackendHttpSettings: true\n          minServers: 0\n        }\n      }\n      {\n        name: 'defaultHttpsProbe'\n        properties: {\n          protocol: 'Https'\n          path: '/'\n          interval: 30\n          timeout: 30\n          unhealthyThreshold: 3\n          pickHostNameFromBackendHttpSettings: true\n          minServers: 0\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: applicationGatewayBackendAddressPoolName\n      }\n    ]\n    backendHttpSettingsCollection: [\n      {\n        name: applicationGatewayBackendHttpSettingsName\n        properties: {\n          port: 80\n          protocol: 'Http'\n          cookieBasedAffinity: 'Disabled'\n        }\n      }\n    ]\n    httpListeners: [\n      {\n        name: applicationGatewayHttpListenerName\n        properties: {\n          firewallPolicy: {\n            id: wafPolicy.id\n          }\n          frontendIPConfiguration: {\n            id: applicationGatewayFrontendIPConfigurationId\n          }\n          frontendPort: {\n            id: applicationGatewayFrontendPortId\n          }\n          protocol: 'Http'\n        }\n      }\n    ]\n    requestRoutingRules: [\n      {\n        name: applicationGatewayRequestRoutingRuleName\n        properties: {\n          priority: 1\n          ruleType: 'Basic'\n          httpListener: {\n            id: applicationGatewayHttpListenerId\n          }\n          backendAddressPool: {\n            id: applicationGatewayBackendAddressPoolId\n          }\n          backendHttpSettings: {\n            id: applicationGatewayBackendHttpSettingsId\n          }\n        }\n      }\n    ]\n    firewallPolicy: {\n      id: wafPolicy.id\n    }\n  }\n}\n\nresource applicationGatewayDiag 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: applicationGateway\n  name: '${applicationGatewayName}-Diag'\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'ApplicationGatewayAccessLog'\n        enabled: true\n      }\n      {\n        category: 'ApplicationGatewayPerformanceLog'\n        enabled: true\n      }\n      {\n        category: 'ApplicationGatewayFirewallLog'\n        enabled: true\n      }\n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n      }\n    ]\n  }\n}\n\noutput applicationGatewayId string = applicationGateway.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1179?"}, {"role": "assistant", "content": "@description('Specifies the location of AKS cluster.')\nparam location string\n\n@description('Specifies the name of the virtual network.')\nparam virtualNetworkName string\n\n@description('Specifies the address prefixes of the virtual network.')\nparam virtualNetworkAddressPrefixes string\n\n@description('Specifies the name of the subnet hosting the system node pool of the AKS cluster.')\nparam aksSubnetName string\n\n@description('Specifies the address prefix of the subnet hosting the system node pool of the AKS cluster.')\nparam aksSubnetAddressPrefix string\n\n@description('Specifies the name of the subnet which contains the virtual machine.')\nparam vmSubnetName string\n\n@description('Specifies the address prefix of the subnet which contains the virtual machine.')\nparam vmSubnetAddressPrefix string\n\n@description('Specifies the name of the subnet which contains the the Application Gateway.')\nparam applicationGatewaySubnetName string\n\n@description('Specifies the address prefix of the subnet which contains the Application Gateway.')\nparam applicationGatewaySubnetAddressPrefix string\n\n@description('Specifies the Bastion subnet IP prefix. This prefix must be within vnet IP prefix address space.')\nparam bastionSubnetAddressPrefix string\n\n@description('Specifies the name of the Azure Bastion resource.')\nparam bastionHostName string\n\n@description('Specifies the resource ID of the log analytics workspace')\nparam workspaceId string\n\nvar bastionSubnetName = 'AzureBastionSubnet'\nvar bastionPublicIpAddressName = '${bastionHostName}PublicIp'\n\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2024-01-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        virtualNetworkAddressPrefixes\n      ]\n    }\n    enableDdosProtection: false\n    enableVmProtection: false\n\n    subnets: [\n      {\n        name: aksSubnetName\n        properties: {\n          addressPrefix: aksSubnetAddressPrefix\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n        }\n      }\n      {\n        name: vmSubnetName\n        properties: {\n          addressPrefix: vmSubnetAddressPrefix\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n          networkSecurityGroup: {\n            id: vmSubnetNsg.id\n          }\n        }\n      }\n      {\n        name: applicationGatewaySubnetName\n        properties: {\n          addressPrefix: applicationGatewaySubnetAddressPrefix\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n        }\n      }\n      {\n        name: bastionSubnetName\n        properties: {\n          addressPrefix: bastionSubnetAddressPrefix\n          networkSecurityGroup: {\n            id: bastionSubnetNsg.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource bastionPublicIpAddress 'Microsoft.Network/publicIPAddresses@2024-01-01' = {\n  name: bastionPublicIpAddressName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource bastionSubnetNsg 'Microsoft.Network/networkSecurityGroups@2024-01-01' = {\n  name: '${bastionHostName}Nsg'\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowHttpsInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'Internet'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 100\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowGatewayManagerInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'GatewayManager'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 110\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowLoadBalancerInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'AzureLoadBalancer'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 120\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowBastionHostCommunicationInBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationPortRanges: [\n            '8080'\n            '5701'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 130\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'DenyAllInBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRange: '*'\n          destinationAddressPrefix: '*'\n          access: 'Deny'\n          priority: 1000\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowSshRdpOutBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRanges: [\n            '22'\n            '3389'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 100\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowAzureCloudCommunicationOutBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRange: '443'\n          destinationAddressPrefix: 'AzureCloud'\n          access: 'Allow'\n          priority: 110\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowBastionHostCommunicationOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationPortRanges: [\n            '8080'\n            '5701'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 120\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowGetSessionInformationOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'Internet'\n          destinationPortRanges: [\n            '80'\n            '443'\n          ]\n          access: 'Allow'\n          priority: 130\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'DenyAllOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          destinationPortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Deny'\n          priority: 1000\n          direction: 'Outbound'\n        }\n      }\n    ]\n  }\n}\n\nresource vmSubnetNsg 'Microsoft.Network/networkSecurityGroups@2024-01-01' = {\n  name: '${vmSubnetName}Nsg'\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowSshInbound'\n        properties: {\n          priority: 100\n          access: 'Allow'\n          direction: 'Inbound'\n          destinationPortRange: '22'\n          protocol: 'Tcp'\n          sourceAddressPrefix: '*'\n          sourcePortRange: '*'\n          destinationAddressPrefix: '*'\n        }\n      }\n    ]\n  }\n}\n\nresource bastionHost 'Microsoft.Network/bastionHosts@2024-01-01' = {\n  name: bastionHostName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'IpConf'\n        properties: {\n          subnet: {\n            id: virtualNetwork.id != '' ? resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, bastionSubnetName) : ''\n          }\n          publicIPAddress: {\n            id: bastionPublicIpAddress.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource bastionSubnetNsgDiag 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: bastionSubnetNsg\n  name: '${bastionHostName}Nsg-Diag'\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'NetworkSecurityGroupEvent'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n      {\n        category: 'NetworkSecurityGroupRuleCounter'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n    ]\n  }\n}\n\nresource vmSubnetNsgDiag 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: vmSubnetNsg\n  name: '${vmSubnetName}Nsg-Diag'\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'NetworkSecurityGroupEvent'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n      {\n        category: 'NetworkSecurityGroupRuleCounter'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n    ]\n  }\n}\n\nresource bastionHostDiag 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: bastionHost\n  name: '${bastionHostName}-Diag'\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'BastionAuditLogs'\n        enabled: true\n      }\n    ]\n  }\n}\n\noutput virtualNetworkId string = virtualNetwork.id\noutput aksSubnetId string = virtualNetwork.id != '' ? resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, aksSubnetName) : ''\noutput vmSubnetId string = virtualNetwork.id != '' ? resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, vmSubnetName) : ''\noutput applicationGatewaySubnetId string = virtualNetwork.id != '' ? resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, applicationGatewaySubnetName) : ''\noutput bastionSubnetId string = virtualNetwork.id != '' ? resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, bastionSubnetName) : ''\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1180."}, {"role": "assistant", "content": "param applicationGatewayUserDefinedManagedIdentityId string\nparam applicationGatewayId string\nparam aksClusterIngressApplicationGatewayObjectId string\n\nvar managedIdentityOperatorRoleDefinitionId = resourceId('Microsoft.Authorization/roleDefinitions', 'f1a07417-d97a-45cb-824c-7a7467783830')\nvar readerRoleDefinitionId = resourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')\nvar contributorRoleDefinitionId = resourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\n\n// AGIC's identity requires \"Managed Identity Operator\" permission over the user assigned identity of Application Gateway.\nresource applicationGatewayAgicManagedIdentityOperatorRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  scope: resourceGroup()\n  name: guid(subscription().id, applicationGatewayUserDefinedManagedIdentityId, 'managedIdentityOperator')\n  properties: {\n    roleDefinitionId: managedIdentityOperatorRoleDefinitionId\n    principalType: 'ServicePrincipal'\n    principalId: aksClusterIngressApplicationGatewayObjectId\n    //aksClusterIngressApplicationGatewayObjectId\n  }\n}\n\nresource applicationGatewayAgicContributorRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  scope: resourceGroup()\n  name: guid(resourceGroup().id, applicationGatewayId, 'contributor')\n  properties: {\n    roleDefinitionId: contributorRoleDefinitionId\n    principalType: 'ServicePrincipal'\n    principalId: aksClusterIngressApplicationGatewayObjectId\n  }\n}\n\nresource applicationGatewayAgicReaderRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  scope: resourceGroup()\n  name: guid(resourceGroup().id, applicationGatewayId, 'reader')\n  properties: {\n    roleDefinitionId: readerRoleDefinitionId\n    principalType: 'ServicePrincipal'\n    principalId: aksClusterIngressApplicationGatewayObjectId\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1181?"}, {"role": "assistant", "content": "param location string\nparam keyVaultName string\nparam aadPodIdentityUserDefinedManagedIdentityTenantId string\nparam aadPodIdentityUserDefinedManagedIdentityPrincipalId string\nparam applicationGatewayUserDefinedManagedIdentityTenantId string\nparam applicationGatewayUserDefinedManagedIdentityPrincipalId string\nparam keyVaultNetworkRuleSetDefaultAction string\nparam workspaceId string\nparam readerRoleId string\nparam keyVaultPrivateDnsZoneName string\nparam virtualNetworkName string\nparam virtualNetworkId string\nparam privateEndpointSubnetId string\nparam keyVaultPrivateEndpointName string\nparam keyVaultPrivateEndpointGroupName string\nparam keyVaultPrivateDnsZoneGroupName string\n\nresource keyVault 'Microsoft.KeyVault/vaults@2024-04-01-preview' = {\n  name: keyVaultName\n  location: location\n  properties: {\n    accessPolicies: [\n      {\n        tenantId: applicationGatewayUserDefinedManagedIdentityTenantId\n        objectId: applicationGatewayUserDefinedManagedIdentityPrincipalId\n        permissions: {\n          secrets: [\n            'get'\n            'list'\n          ]\n          certificates: [\n            'get'\n          ]\n        }\n      }\n      {\n        tenantId: aadPodIdentityUserDefinedManagedIdentityTenantId\n        objectId: aadPodIdentityUserDefinedManagedIdentityPrincipalId\n        permissions: {\n          secrets: [\n            'get'\n            'list'\n          ]\n          certificates: [\n            'get'\n          ]\n        }\n      }\n    ]\n    sku: {\n      family: 'A'\n      name: 'standard'\n    }\n    tenantId: subscription().tenantId\n    networkAcls: {\n      bypass: 'AzureServices'\n      defaultAction: keyVaultNetworkRuleSetDefaultAction\n    }\n    enabledForDeployment: false\n    enabledForDiskEncryption: false\n    enabledForTemplateDeployment: false\n    enableSoftDelete: false\n  }\n}\n\nresource keyVaultNameDiag 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: keyVault\n  name: 'default-Diag'\n  properties: {\n    workspaceId: workspaceId\n    logs: [\n      {\n        category: 'AuditEvent'\n        enabled: true\n      }\n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n      }\n    ]\n  }\n}\n\nresource keyVaultNameRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: guid(subscription().id, resourceGroup().id, keyVault.id)\n  properties: {\n    roleDefinitionId: readerRoleId\n    principalId: aadPodIdentityUserDefinedManagedIdentityPrincipalId\n    principalType: 'ServicePrincipal'\n  }\n}\n\nresource keyVaultPrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = {\n  name: keyVaultPrivateDnsZoneName\n  location: 'global'\n  properties: {}\n}\n\nresource keyVaultPrivateDnsZoneName_link_to_virtualNetwork 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01' = {\n  parent: keyVaultPrivateDnsZone\n  name: 'link_to_${toLower(virtualNetworkName)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n  }\n}\n\nresource keyVaultPrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\n  name: keyVaultPrivateEndpointName\n  location: location\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: keyVaultPrivateEndpointName\n        properties: {\n          privateLinkServiceId: keyVault.id\n          groupIds: [\n            keyVaultPrivateEndpointGroupName\n          ]\n        }\n      }\n    ]\n    subnet: {\n      id: privateEndpointSubnetId\n    }\n  }\n}\n\nresource keyVaultPrivateEndpointName_keyVaultPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2024-01-01' = {\n  parent: keyVaultPrivateEndpoint\n  name: keyVaultPrivateDnsZoneGroupName\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'dnsConfig'\n        properties: {\n          privateDnsZoneId: keyVaultPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1182."}, {"role": "assistant", "content": "@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Private Endpoint VNet Name.')\nparam virtualNetworkName string\n@description('Address prefix for the Virtual Network')\nparam addressPrefix string = '10.0.0.0/16'\n@description('Private Endpoint Subnet Name.')\nparam subnetName string\n@description('Subnet prefix')\nparam subnetPrefix string = '10.0.0.0/28'\n\n\nparam applicationGatewayName string = 'apgw-${uniqueString(resourceGroup().id)}'\nparam publicIPAddressName string = 'pip-${uniqueString(resourceGroup().id)}'\n@description('Sku Name')\n@allowed([\n  'Standard_v2'\n  'WAF_v2'\n])\nparam skuName string = 'WAF_v2'\n@description('Sku tier')\n@allowed([\n  'Standard_v2'\n  'WAF_v2'\n])\nparam skuTier string = 'WAF_v2'\n@description('Number of instances')\n@minValue(1)\n@maxValue(10)\nparam capacity int = 2\n\n@description('Specifies the name of the WAF policy')\nparam wafPolicyName string = '${applicationGatewayName}-WafPolicy'\n@description('Specifies the mode of the WAF policy.')\n@allowed([\n  'Detection'\n  'Prevention'\n])\nparam wafPolicyMode string = 'Prevention'\n\n@description('Specifies the state of the WAF policy.')\n@allowed([\n  'Enabled'\n  'Disabled '\n])\nparam wafPolicyState string = 'Enabled'\n\n@description('Specifies the maximum file upload size in Mb for the WAF policy.')\nparam wafPolicyFileUploadLimitInMb int = 100\n\n@description('Specifies the maximum request body size in Kb for the WAF policy.')\nparam wafPolicyMaxRequestBodySizeInKb int = 128\n\n@description('Specifies the whether to allow WAF to check request Body.')\nparam wafPolicyRequestBodyCheck bool = true\n\n@description('Specifies the rule set type.')\nparam wafPolicyRuleSetType string = 'OWASP'\n\n@description('Specifies the rule set version.')\nparam wafPolicyRuleSetVersion string = '3.2'\n@description('IP Address of Default Backend Server')\nparam backendIpAddressDefault string\n@description('IP Address of Backend Server for Path Rule 1 match')\nparam backendIpAddressForPathRule1 string\n@description('IP Address of Backend Server for Path Rule 2 match')\nparam backendIpAddressForPathRule2 string\n@description('Path match string for Path Rule 1')\nparam pathMatch1 string\n@description('Path match string for Path Rule 2')\nparam pathMatch2 string\n\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2024-01-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        addressPrefix\n      ]\n    }\n  }\n}\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2024-01-01' = {\n  parent: virtualNetwork\n  name: subnetName\n  properties: {\n    addressPrefix: subnetPrefix\n  }\n}\n\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2024-01-01' = {\n  name: publicIPAddressName\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource wafPolicy 'Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies@2024-01-01' = if(skuName == 'WAF_v2') {\n  name: wafPolicyName\n  location: location\n  properties: {\n    customRules: [\n      {\n        name: 'BlockMe'\n        priority: 1\n        ruleType: 'MatchRule'\n        action: 'Block'\n        matchConditions: [\n          {\n            matchVariables: [\n              {\n                variableName: 'QueryString'\n              }\n            ]\n            operator: 'Contains'\n            negationConditon: false\n            matchValues: [\n              'blockme'\n            ]\n          }\n        ]\n      }\n      {\n        name: 'BlockEvilBot'\n        priority: 2\n        ruleType: 'MatchRule'\n        action: 'Block'\n        matchConditions: [\n          {\n            matchVariables: [\n              {\n                variableName: 'RequestHeaders'\n                selector: 'User-Agent'\n              }\n            ]\n            operator: 'Contains'\n            negationConditon: false\n            matchValues: [\n              'evilbot'\n            ]\n            transforms: [\n              'Lowercase'\n            ]\n          }\n        ]\n      }\n    ]\n    policySettings: {\n      requestBodyCheck: wafPolicyRequestBodyCheck\n      maxRequestBodySizeInKb: wafPolicyMaxRequestBodySizeInKb\n      fileUploadLimitInMb: wafPolicyFileUploadLimitInMb\n      mode: wafPolicyMode\n      state: wafPolicyState\n    }\n    managedRules: {\n      managedRuleSets: [\n        {\n          ruleSetType: wafPolicyRuleSetType\n          ruleSetVersion: wafPolicyRuleSetVersion\n        }\n      ]\n    }\n  }\n}\n\nresource applicationGateway 'Microsoft.Network/applicationGateways@2024-01-01' = {\n  name: applicationGatewayName\n  location: location\n  properties: {\n    firewallPolicy: skuName == 'WAF_v2' ? {\n      id: wafPolicy.id\n    } : null\n    sku: {\n      name: skuName\n      tier: skuTier\n      capacity: capacity\n    }\n    gatewayIPConfigurations: [\n      {\n        name: 'appGatewayIpConfig'\n        properties: {\n          subnet: {\n            id: subnet.id\n          }\n        }\n      }\n    ]\n    frontendIPConfigurations: [\n      {\n        name: 'appGatewayFrontendPublicIP'\n        properties: {\n          publicIPAddress: {\n            id: publicIPAddress.id\n          }\n        }\n      }\n    ]\n    frontendPorts: [\n      {\n        name: 'appGatewayFrontendPort80'\n        properties: {\n          port: 80\n        }\n      }\n      {\n        name: 'appGatewayFrontendPort443'\n        properties: {\n          port: 443\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: 'appGatewayBackendPoolDefault'\n        properties: {\n          backendAddresses: [\n            {\n              ipAddress: backendIpAddressDefault\n            }\n          ]\n        }\n      }\n      {\n        name: 'appGatewayBackendPool1'\n        properties: {\n          backendAddresses: [\n            {\n              ipAddress: backendIpAddressForPathRule1\n            }\n          ]\n        }\n      }\n      {\n        name: 'appGatewayBackendPool2'\n        properties: {\n          backendAddresses: [\n            {\n              ipAddress: backendIpAddressForPathRule2\n            }\n          ]\n        }\n      }\n    ]\n    backendHttpSettingsCollection: [\n      {\n        name: 'appGatewayBackendHttpSettings'\n        properties: {\n          port: 80\n          protocol: 'Http'\n          cookieBasedAffinity: 'Disabled'\n        }\n      }\n    ]\n    httpListeners: [\n      {\n        name: 'appGatewayHttpListener'\n        properties: {\n          firewallPolicy: skuName == 'WAF_v2' ? {\n            id: wafPolicy.id\n          } : null\n          frontendIPConfiguration: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/frontendIPConfigurations',\n              applicationGatewayName,\n              'appGatewayFrontendPublicIP'\n            )\n          }\n          frontendPort: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/frontendPorts',\n              applicationGatewayName,\n              'appGatewayFrontendPort80'\n            )\n          }\n          protocol: 'Http'\n        }\n      }\n    ]\n    urlPathMaps: [\n      {\n        name: 'urlPathMap1'\n        properties: {\n          defaultBackendAddressPool: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/backendAddressPools',\n              applicationGatewayName,\n              'appGatewayBackendPoolDefault'\n            )\n          }\n          defaultBackendHttpSettings: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/backendHttpSettingsCollection',\n              applicationGatewayName,\n              'appGatewayBackendHttpSettings'\n            )\n          }\n          pathRules: [\n            {\n              name: 'pathRule1'\n              properties: {\n                paths: [\n                  pathMatch1\n                ]\n                backendAddressPool: {\n                  id: resourceId(\n                    'Microsoft.Network/applicationGateways/backendAddressPools',\n                    applicationGatewayName,\n                    'appGatewayBackendPool1'\n                  )\n                }\n                backendHttpSettings: {\n                  id: resourceId(\n                    'Microsoft.Network/applicationGateways/backendHttpSettingsCollection',\n                    applicationGatewayName,\n                    'appGatewayBackendHttpSettings'\n                  )\n                }\n              }\n            }\n            {\n              name: 'pathRule2'\n              properties: {\n                paths: [\n                  pathMatch2\n                ]\n                backendAddressPool: {\n                  id: resourceId(\n                    'Microsoft.Network/applicationGateways/backendAddressPools',\n                    applicationGatewayName,\n                    'appGatewayBackendPool2'\n                  )\n                }\n                backendHttpSettings: {\n                  id: resourceId(\n                    'Microsoft.Network/applicationGateways/backendHttpSettingsCollection',\n                    applicationGatewayName,\n                    'appGatewayBackendHttpSettings'\n                  )\n                }\n              }\n            }\n          ]\n        }\n      }\n    ]\n    requestRoutingRules: [\n      {\n        name: 'rule1'\n        properties: {\n          priority: 100\n          ruleType: 'PathBasedRouting'\n          httpListener: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/httpListeners',\n              applicationGatewayName,\n              'appGatewayHttpListener'\n            )\n          }\n          urlPathMap: {\n            id: resourceId('Microsoft.Network/applicationGateways/urlPathMaps', applicationGatewayName, 'urlPathMap1')\n          }\n        }\n      }\n    ]\n    sslPolicy: {\n      policyType: 'Custom'\n      minProtocolVersion: 'TLSv1_2'\n      cipherSuites: [\n        'TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384'\n        'TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256'\n        'TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384'\n        'TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256'\n      ]\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1183."}, {"role": "assistant", "content": "@description('Virtual Network name')\nparam virtualNetworkName string = 'Application-Vnet'\n\n@description('Virtual Network address range')\nparam vnetAddressPrefix string = '10.0.0.0/16'\n\n@description('Name of the subnet')\nparam subnetName string = 'ApplicationGatewaySubnet'\n\n@description('Subnet address range')\nparam subnetPrefix string = '10.0.0.0/24'\n\n@description('Application Gateway name')\nparam applicationGatewayName string = 'applicationGatewayV2'\n\n@description('Minimum instance count for Application Gateway')\nparam minCapacity int = 2\n\n@description('Maximum instance count for Application Gateway')\nparam maxCapacity int = 10\n\n@description('Application Gateway Frontend port')\nparam frontendPort int = 80\n\n@description('Application gateway Backend port')\nparam backendPort int = 80\n\n@description('Back end pool ip addresses')\nparam backendIPAddresses array = [\n  {\n    IpAddress: '10.0.0.4'\n  }\n  {\n    IpAddress: '10.0.0.5'\n  }\n]\n\n@description('Cookie based affinity')\n@allowed([\n  'Enabled'\n  'Disabled'\n])\nparam cookieBasedAffinity string = 'Disabled'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar appGwPublicIpName = '${applicationGatewayName}-pip'\nvar appGwSize = 'Standard_v2'\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-06-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: subnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource publicIP 'Microsoft.Network/publicIPAddresses@2020-06-01' = {\n  name: appGwPublicIpName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource applicationGateway 'Microsoft.Network/applicationGateways@2020-06-01' = {\n  name: applicationGatewayName\n  location: location\n  properties: {\n    sku: {\n      name: appGwSize\n      tier: 'Standard_v2'\n    }\n    autoscaleConfiguration: {\n      minCapacity: minCapacity\n      maxCapacity: maxCapacity\n    }\n    gatewayIPConfigurations: [\n      {\n        name: 'appGatewayIpConfig'\n        properties: {\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, subnetName)\n          }\n        }\n      }\n    ]\n    frontendIPConfigurations: [\n      {\n        name: 'appGatewayFrontendIP'\n        properties: {\n          publicIPAddress: {\n            id: publicIP.id\n          }\n        }\n      }\n    ]\n    frontendPorts: [\n      {\n        name: 'appGatewayFrontendPort'\n        properties: {\n          port: frontendPort\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: 'appGatewayBackendPool'\n        properties: {\n          backendAddresses: backendIPAddresses\n        }\n      }\n    ]\n    backendHttpSettingsCollection: [\n      {\n        name: 'appGatewayBackendHttpSettings'\n        properties: {\n          port: backendPort\n          protocol: 'Http'\n          cookieBasedAffinity: cookieBasedAffinity\n        }\n      }\n    ]\n    httpListeners: [\n      {\n        name: 'appGatewayHttpListener'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/applicationGateways/frontendIPConfigurations', applicationGatewayName, 'appGatewayFrontendIP')\n          }\n          frontendPort: {\n            id: resourceId('Microsoft.Network/applicationGateways/frontendPorts', applicationGatewayName, 'appGatewayFrontendPort')\n          }\n          protocol: 'Http'\n        }\n      }\n    ]\n    requestRoutingRules: [\n      {\n        name: 'rule1'\n        properties: {\n          ruleType: 'Basic'\n          httpListener: {\n            id: resourceId('Microsoft.Network/applicationGateways/httpListeners', applicationGatewayName, 'appGatewayHttpListener')\n          }\n          backendAddressPool: {\n            id: resourceId('Microsoft.Network/applicationGateways/backendAddressPools', applicationGatewayName, 'appGatewayBackendPool')\n          }\n          backendHttpSettings: {\n            id: resourceId('Microsoft.Network/applicationGateways/backendHttpSettingsCollection', applicationGatewayName, 'appGatewayBackendHttpSettings')\n          }\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1184?"}, {"role": "assistant", "content": "@description('Application gateway name')\nparam applicationGatewayName string = 'appGw01'\n\n@description('Application gateway location')\nparam location string = resourceGroup().location\n\n@description('Application gateway tier')\n@allowed([\n  'Standard'\n  'WAF'\n  'Standard_v2'\n  'WAF_v2'\n])\nparam tier string = 'WAF_v2'\n\n@description('Application gateway sku')\n@allowed([\n  'Standard_Small'\n  'Standard_Medium'\n  'Standard_Large'\n  'WAF_Medium'\n  'WAF_Large'\n  'Standard_v2'\n  'WAF_v2'\n])\nparam sku string = 'WAF_v2'\n\n@description('Enable HTTP/2 support')\nparam http2Enabled bool = true\n\n@description('Capacity (instance count) of application gateway')\n@minValue(1)\n@maxValue(32)\nparam capacity int = 2\n\n@description('Autoscale capacity (instance count) of application gateway')\n@minValue(1)\n@maxValue(32)\nparam autoScaleMaxCapacity int = 10\n\n@description('Public ip address name')\nparam publicIpAddressName string = 'appGwpublicIp'\n\n@description('Virutal network subscription id')\nparam vNetSubscriptionId string = subscription().subscriptionId\n\n@description('Virutal network resource group')\nparam existingVnetResourceGroup string\n\n@description('Virutal network name')\nparam existingVnetName string\n\n@description('Application gateway subnet name')\nparam existingSubnetName string\n\n@description('Array containing ssl certificates')\n@metadata({\n  name: 'Certificate name'\n  keyVaultResourceId: 'Key vault resource id'\n  secretName: 'Secret name'\n})\nparam sslCertificates array = []\n\n@description('Array containing trusted root certificates')\n@metadata({\n  name: 'Certificate name'\n  keyVaultResourceId: 'Key vault resource id'\n  secretName: 'Secret name'\n})\nparam trustedRootCertificates array = []\n\n@description('Array containing http listeners')\n@metadata({\n  name: 'Listener name'\n  protocol: 'Listener protocol'\n  frontEndPort: 'Front end port name'\n  sslCertificate: 'SSL certificate name'\n  hostNames: 'Array containing host names'\n  firewallPolicy: 'Enabled/Disabled. Configures firewall policy on listener'\n})\nparam httpListeners array = [\n  {\n    name: 'HttpListener01'\n    protocol: 'Http'\n    frontEndPort: 'port_80'\n    firewallPolicy: 'Enabled'\n  }\n]\n\n@description('Array containing backend address pools')\n@metadata({\n  name: 'Backend address pool name'\n  backendAddresses: 'Array containing backend addresses'\n})\nparam backendAddressPools array = [\n  {\n    name: 'BackendPool01'\n    backendAddresses: [\n      {\n        ipAddress: '10.1.2.3'\n      }\n    ]\n  }\n]\n\n@description('Array containing backend http settings')\n@metadata({\n  name: 'Backend http setting name'\n  port: 'integer containing port number'\n  protocol: 'Backend http setting protocol'\n  cookieBasedAffinity: 'Enabled/Disabled. Configures cookie based affinity.'\n  requestTimeout: 'Integer containing backend http setting request timeout'\n  connectionDraining: {\n    drainTimeoutInSec: 'Integer containing connection drain timeout in seconds'\n    enabled: 'Bool to enable connection draining'\n  }\n  trustedRootCertificate: 'Trusted root certificate name'\n  hostName: 'Backend http setting host name'\n  probeName: 'Custom probe name'\n})\nparam backendHttpSettings array = [\n  {\n    name: 'BackendHttpSetting01'\n    port: 80\n    protocol: 'Http'\n    cookieBasedAffinity: 'Enabled'\n    affinityCookieName: 'CookieAffinity01'\n    requestTimeout: 300\n    connectionDraining: {\n      drainTimeoutInSec: 60\n      enabled: true\n    }\n  }\n]\n\n@description('Array containing request routing rules')\n@metadata({\n  name: 'Rule name'\n  ruleType: 'Rule type'\n  listener: 'Http listener name'\n  backendPool: 'Backend pool name'\n  backendHttpSettings: 'Backend http setting name'\n  redirectConfiguration: 'Redirection configuration name'\n})\nparam rules array = [\n  {\n    name: 'Rule01'\n    ruleType: 'Basic'\n    listener: 'HttpListener01'\n    backendPool: 'BackendPool01'\n    backendHttpSettings: 'BackendHttpSetting01'\n  }\n]\n\n@description('Array containing redirect configurations')\n@metadata({\n  name: 'Redirecton name'\n  redirectType: 'Redirect type'\n  targetUrl: 'Target URL'\n  includePath: 'Bool to include path'\n  includeQueryString: 'Bool to include query string'\n  requestRoutingRule: 'Name of request routing rule to associate redirection configuration'\n})\nparam redirectConfigurations array = []\n\n@description('Array containing front end ports')\n@metadata({\n  name: 'Front port name'\n  port: 'Integer containing port number'\n})\nparam frontEndPorts array = [\n  {\n    name: 'port_80'\n    port: 80\n  }\n]\n\n@description('Array containing custom probes')\n@metadata({\n  name: 'Custom probe name'\n  protocol: 'Custom probe protocol'\n  host: 'Host name'\n  path: 'Probe path'\n  interval: 'Integer containing probe interval'\n  timeout: 'Integer containing probe timeout'\n  unhealthyThreshold: 'Integer containing probe unhealthy threshold'\n  pickHostNameFromBackendHttpSettings: 'Bool to enable pick host name from backend settings'\n  minServers: 'Integer containing min servers'\n  match: {\n    statusCodes: [\n      'Custom probe status codes'\n    ]\n  }\n})\nparam customProbes array = []\n\n@description('Resource id of an existing user assigned managed identity to associate with the application gateway')\nparam managedIdentityResourceId string = ''\n\n@description('Enable web application firewall')\nparam enableWebApplicationFirewall bool = true\n\n@description('Name of the firewall policy. Only required if enableWebApplicationFirewall is set to true')\nparam firewallPolicyName string = 'FirewallPolicy01'\n\n@description('Array containing the firewall policy settings. Only required if enableWebApplicationFirewall is set to true')\n@metadata({\n  requestBodyCheck: 'Bool to enable request body check'\n  maxRequestBodySizeInKb: 'Integer containing max request body size in kb'\n  fileUploadLimitInMb: 'Integer containing file upload limit in mb'\n  state: 'Enabled/Disabled. Configures firewall policy settings'\n  mode: 'Sets the detection mode'\n})\nparam firewallPolicySettings object = {\n  requestBodyCheck: true\n  maxRequestBodySizeInKb: 128\n  fileUploadLimitInMb: 100\n  state: 'Enabled'\n  mode: 'Detection'\n}\n\n@description('Array containing the firewall policy custom rules. Only required if enableWebApplicationFirewall is set to true')\n@metadata({\n  action: 'Type of actions'\n  matchConditions: 'Array containing match conditions'\n  name: 'Custom rule name'\n  priority: 'Integer containing priority'\n  ruleType: 'Rule type'\n})\nparam firewallPolicyCustomRules array = []\n\n@description('Array containing the firewall policy managed rule sets. Only required if enableWebApplicationFirewall is set to true')\n@metadata({\n  ruleSetType: 'Rule set type'\n  ruleSetVersion: 'Rule set version'\n})\nparam firewallPolicyManagedRuleSets array = [\n  {\n    ruleSetType: 'OWASP'\n    ruleSetVersion: '3.2'\n  }\n]\n\n@description('Array containing the firewall policy managed rule exclusions. Only required if enableWebApplicationFirewall is set to true')\n@metadata({\n  matchVariable: 'Variable to be excluded'\n  selector: 'String specifying exclusions'\n  selectorMatchOperator: 'Exclusion operator'\n})\nparam firewallPolicyManagedRuleExclusions array = []\n\n@description('Enable delete lock')\nparam enableDeleteLock bool = false\n\n@description('Enable diagnostic logs')\nparam enableDiagnostics bool = false\n\n@description('Storage account resource id. Only required if enableDiagnostics is set to true')\nparam diagnosticStorageAccountId string = ''\n\n@description('Log analytics workspace resource id. Only required if enableDiagnostics is set to true')\nparam logAnalyticsWorkspaceId string = ''\n\nvar publicIpLockName = '${publicIpAddress.name}-lck'\nvar publicIpDiagnosticsName = '${publicIpAddress.name}-dgs'\nvar appGatewayLockName = '${applicationGateway.name}-lck'\nvar appGatewayDiagnosticsName = '${applicationGateway.name}-dgs'\nvar gatewayIpConfigurationName = 'appGatewayIpConfig'\nvar frontendIpConfigurationName = 'appGwPublicFrontendIp'\n\nresource publicIpAddress 'Microsoft.Network/publicIPAddresses@2021-03-01' = {\n  name: publicIpAddressName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource publicIpAddressDiagnostics 'microsoft.insights/diagnosticSettings@2021-05-01-preview' = if (enableDiagnostics) {\n  scope: publicIpAddress\n  name: publicIpDiagnosticsName\n  properties: {\n    workspaceId: empty(logAnalyticsWorkspaceId) ? null : logAnalyticsWorkspaceId\n    storageAccountId: empty(diagnosticStorageAccountId) ? null : diagnosticStorageAccountId\n    logs: [\n      {\n        category: 'DDoSProtectionNotifications'\n        enabled: true\n      }\n      {\n        category: 'DDoSMitigationFlowLogs'\n        enabled: true\n      }\n      {\n        category: 'DDoSMitigationReports'\n        enabled: true\n      }\n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n      }\n    ]\n  }\n}\n\nresource publicIpAddressLock 'Microsoft.Authorization/locks@2017-04-01' = if (enableDeleteLock) {\n  scope: publicIpAddress\n  name: publicIpLockName\n  properties: {\n    level: 'CanNotDelete'\n  }\n}\n\nresource applicationGateway 'Microsoft.Network/applicationGateways@2021-03-01' = {\n  name: applicationGatewayName\n  location: location\n  identity: !empty(managedIdentityResourceId) ? {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${managedIdentityResourceId}': {}\n    }\n  } : null\n  properties: {\n    sku: {\n      name: sku\n      tier: tier\n    }\n    autoscaleConfiguration: {\n      minCapacity: capacity\n      maxCapacity: autoScaleMaxCapacity\n    }\n    enableHttp2: http2Enabled\n    webApplicationFirewallConfiguration: enableWebApplicationFirewall ? {\n      enabled: firewallPolicySettings.state == 'Enabled' ? true : false\n      firewallMode: firewallPolicySettings.mode\n      ruleSetType: 'OWASP'\n      ruleSetVersion: '3.2'\n    } : null\n    gatewayIPConfigurations: [\n      {\n        name: gatewayIpConfigurationName\n        properties: {\n          subnet: {\n            id: resourceId(vNetSubscriptionId, existingVnetResourceGroup, 'Microsoft.Network/virtualNetworks/subnets', existingVnetName, existingSubnetName)\n          }\n        }\n      }\n    ]\n    frontendIPConfigurations: [\n      {\n        name: frontendIpConfigurationName\n        properties: {\n          publicIPAddress: {\n            id: publicIpAddress.id\n          }\n        }\n      }\n    ]\n    frontendPorts: [for frontEndPort in frontEndPorts: {\n      name: frontEndPort.name\n      properties: {\n        port: frontEndPort.port\n      }\n    }]\n    probes: [for probe in customProbes: {\n      name: probe.name\n      properties: {\n        protocol: probe.protocol\n        host: probe.host\n        path: probe.path\n        interval: probe.interval\n        timeout: probe.timeout\n        unhealthyThreshold: probe.unhealthyThreshold\n        pickHostNameFromBackendHttpSettings: probe.pickHostNameFromBackendHttpSettings\n        minServers: probe.minServers\n        match: probe.match\n      }\n    }]\n    backendAddressPools: [for backendAddressPool in backendAddressPools: {\n      name: backendAddressPool.name\n      properties: {\n        backendAddresses: backendAddressPool.backendAddresses\n      }\n    }]\n    firewallPolicy: enableWebApplicationFirewall ? {\n      id: firewallPolicy.id\n    } : null\n    trustedRootCertificates: [for trustedRootCertificate in trustedRootCertificates: {\n      name: trustedRootCertificate.name\n      properties: {\n        keyVaultSecretId: '${reference(trustedRootCertificate.keyVaultResourceId, '2021-10-01').vaultUri}secrets/${trustedRootCertificate.secretName}'\n      }\n    }]\n    sslCertificates: [for sslCertificate in sslCertificates: {\n      name: sslCertificate.name\n      properties: {\n        keyVaultSecretId: '${reference(sslCertificate.keyVaultResourceId, '2021-10-01').vaultUri}secrets/${sslCertificate.secretName}'\n      }\n    }]\n    backendHttpSettingsCollection: [for backendHttpSetting in backendHttpSettings: {\n      name: backendHttpSetting.name\n      properties: {\n        port: backendHttpSetting.port\n        protocol: backendHttpSetting.protocol\n        cookieBasedAffinity: backendHttpSetting.cookieBasedAffinity\n        affinityCookieName: contains(backendHttpSetting, 'affinityCookieName') ? backendHttpSetting.affinityCookieName : null\n        requestTimeout: backendHttpSetting.requestTimeout\n        connectionDraining: backendHttpSetting.connectionDraining\n        probe: contains(backendHttpSetting, 'probeName') ? json('{\"id\": \"${resourceId('Microsoft.Network/applicationGateways/probes', applicationGatewayName, backendHttpSetting.probeName)}\"}') : null\n        trustedRootCertificates: contains(backendHttpSetting, 'trustedRootCertificate') ? json('[{\"id\": \"${resourceId('Microsoft.Network/applicationGateways/trustedRootCertificates', applicationGatewayName, backendHttpSetting.trustedRootCertificate)}\"}]') : null\n        hostName: contains(backendHttpSetting, 'hostName') ? backendHttpSetting.hostName : null\n        pickHostNameFromBackendAddress: contains(backendHttpSetting, 'pickHostNameFromBackendAddress') ? backendHttpSetting.pickHostNameFromBackendAddress : false\n      }\n    }]\n    httpListeners: [for httpListener in httpListeners: {\n      name: httpListener.name\n      properties: {\n        frontendIPConfiguration: {\n          id: resourceId('Microsoft.Network/applicationGateways/frontendIPConfigurations', applicationGatewayName, frontendIpConfigurationName)\n        }\n        frontendPort: {\n          id: resourceId('Microsoft.Network/applicationGateways/frontendPorts', applicationGatewayName, httpListener.frontEndPort)\n        }\n        protocol: httpListener.protocol\n        sslCertificate: contains(httpListener, 'sslCertificate') ? json('{\"id\": \"${resourceId('Microsoft.Network/applicationGateways/sslCertificates', applicationGatewayName, httpListener.sslCertificate)}\"}') : null\n        hostNames: contains(httpListener, 'hostNames') ? httpListener.hostNames : null\n        hostName: contains(httpListener, 'hostName') ? httpListener.hostName : null\n        requireServerNameIndication: contains(httpListener, 'requireServerNameIndication') ? httpListener.requireServerNameIndication : false\n        firewallPolicy: contains(httpListener, 'firewallPolicy') ? json('{\"id\": \"${firewallPolicy.id}\"}') : null\n      }\n    }]\n    requestRoutingRules: [for rule in rules: {\n      name: rule.name\n      properties: {\n        ruleType: rule.ruleType\n        httpListener: contains(rule, 'listener') ? json('{\"id\": \"${resourceId('Microsoft.Network/applicationGateways/httpListeners', applicationGatewayName, rule.listener)}\"}') : null\n        backendAddressPool: contains(rule, 'backendPool') ? json('{\"id\": \"${resourceId('Microsoft.Network/applicationGateways/backendAddressPools', applicationGatewayName, rule.backendPool)}\"}') : null\n        backendHttpSettings: contains(rule, 'backendHttpSettings') ? json('{\"id\": \"${resourceId('Microsoft.Network/applicationGateways/backendHttpSettingsCollection', applicationGatewayName, rule.backendHttpSettings)}\"}') : null\n        redirectConfiguration: contains(rule, 'redirectConfiguration') ? json('{\"id\": \"${resourceId('Microsoft.Network/applicationGateways/redirectConfigurations', applicationGatewayName, rule.redirectConfiguration)}\"}') : null\n      }\n    }]\n    redirectConfigurations: [for redirectConfiguration in redirectConfigurations: {\n      name: redirectConfiguration.name\n      properties: {\n        redirectType: redirectConfiguration.redirectType\n        targetUrl: redirectConfiguration.targetUrl\n        targetListener: contains(redirectConfiguration, 'targetListener') ? json('{\"id\": \"${resourceId('Microsoft.Network/applicationGateways/httpListeners', applicationGatewayName, redirectConfiguration.targetListener)}\"}') : null\n        includePath: redirectConfiguration.includePath\n        includeQueryString: redirectConfiguration.includeQueryString\n        requestRoutingRules: [\n          {\n            id: resourceId('Microsoft.Network/applicationGateways/requestRoutingRules', applicationGatewayName, redirectConfiguration.requestRoutingRule)\n          }\n        ]\n      }\n    }]\n  }\n}\n\nresource applicationGatewayDiagnostics 'microsoft.insights/diagnosticSettings@2021-05-01-preview' = if (enableDiagnostics) {\n  scope: applicationGateway\n  name: appGatewayDiagnosticsName\n  properties: {\n    workspaceId: empty(logAnalyticsWorkspaceId) ? null : logAnalyticsWorkspaceId\n    storageAccountId: empty(diagnosticStorageAccountId) ? null : diagnosticStorageAccountId\n    logs: [\n      {\n        category: 'ApplicationGatewayAccessLog'\n        enabled: true\n      }\n      {\n        category: 'ApplicationGatewayPerformanceLog'\n        enabled: true\n      }\n      {\n        category: 'ApplicationGatewayFirewallLog'\n        enabled: true\n      }\n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n      }\n    ]\n  }\n}\n\nresource applicationGatewayLock 'Microsoft.Authorization/locks@2017-04-01' = if (enableDeleteLock) {\n  scope: applicationGateway\n  name: appGatewayLockName\n  properties: {\n    level: 'CanNotDelete'\n  }\n}\n\nresource firewallPolicy 'Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies@2021-03-01' = if (enableWebApplicationFirewall) {\n  name: firewallPolicyName == '' ? 'placeholdervalue' : firewallPolicyName // placeholder value required as name cannot be empty/null when enableWebApplicationFirewall equals false \n  location: location\n  properties: {\n    customRules: firewallPolicyCustomRules\n    policySettings: firewallPolicySettings\n    managedRules: {\n      managedRuleSets: firewallPolicyManagedRuleSets\n      exclusions: firewallPolicyManagedRuleExclusions\n    }\n  }\n}\n\noutput name string = applicationGateway.name\noutput id string = applicationGateway.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1185."}, {"role": "assistant", "content": "@description('Name of new or existing vnet to which Azure Bastion should be deployed')\nparam vnetName string = 'vnet01'\n\n@description('IP prefix for available addresses in vnet address space')\nparam vnetIpPrefix string = '10.1.0.0/16'\n\n@description('Specify whether to provision new vnet or deploy to existing vnet')\n@allowed([\n  'new'\n  'existing'\n])\nparam vnetNewOrExisting string = 'new'\n\n@description('Bastion subnet IP prefix MUST be within vnet IP prefix address space')\nparam bastionSubnetIpPrefix string = '10.1.1.0/26'\n\n@description('Name of Azure Bastion resource')\nparam bastionHostName string\n\n@description('Azure region for Bastion and virtual network')\nparam location string = resourceGroup().location\n\nvar publicIpAddressName = '${bastionHostName}-pip'\nvar bastionSubnetName = 'AzureBastionSubnet'\n\nresource publicIp 'Microsoft.Network/publicIPAddresses@2022-01-01' = {\n  name: publicIpAddressName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\n// if vnetNewOrExisting == 'new', create a new vnet and subnet\nresource newVirtualNetwork 'Microsoft.Network/virtualNetworks@2022-01-01' = if (vnetNewOrExisting == 'new') {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetIpPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: bastionSubnetName\n        properties: {\n          addressPrefix: bastionSubnetIpPrefix\n        }\n      }\n    ]\n  }\n}\n\n// if vnetNewOrExisting == 'existing', reference an existing vnet and create a new subnet under it\nresource existingVirtualNetwork 'Microsoft.Network/virtualNetworks@2022-01-01' existing = if (vnetNewOrExisting == 'existing') {\n  name: vnetName\n}\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2022-01-01' = if (vnetNewOrExisting == 'existing') {\n  parent: existingVirtualNetwork\n  name: bastionSubnetName\n  properties: {\n    addressPrefix: bastionSubnetIpPrefix\n  }\n}\n\nresource bastionHost 'Microsoft.Network/bastionHosts@2022-01-01' = {\n  name: bastionHostName\n  location: location\n  dependsOn: [\n    newVirtualNetwork\n    existingVirtualNetwork\n  ]\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'IpConf'\n        properties: {\n          subnet: {\n            id: subnet.id\n          }\n          publicIPAddress: {\n            id: publicIp.id\n          }\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1186."}, {"role": "assistant", "content": "@description('Name of new or existing vnet to which Azure Bastion should be deployed')\nparam vnetName string = 'vnet01'\n\n@description('IP prefix for available addresses in vnet address space')\nparam vnetIpPrefix string = '10.1.0.0/16'\n\n@description('Specify whether to provision new vnet or deploy to existing vnet')\n@allowed([\n  'new'\n  'existing'\n])\nparam vnetNewOrExisting string = 'new'\n\n@description('Bastion subnet IP prefix MUST be within vnet IP prefix address space')\nparam bastionSubnetIpPrefix string = '10.1.1.0/26'\n\n@description('Name of Azure Bastion resource')\nparam bastionHostName string\n\n@description('Azure region for Bastion and virtual network')\nparam location string = resourceGroup().location\n\nvar publicIpAddressName = '${bastionHostName}-pip'\nvar bastionSubnetName = 'AzureBastionSubnet'\nvar nsgName = '${bastionHostName}-nsg'\n\nresource publicIp 'Microsoft.Network/publicIPAddresses@2022-07-01' = {\n  name: publicIpAddressName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\n\nresource nsg 'Microsoft.Network/networkSecurityGroups@2022-07-01' = {\n  name: nsgName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowHttpsInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'Internet'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 100\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowGatewayManagerInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'GatewayManager'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 110\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowLoadBalancerInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'AzureLoadBalancer'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 120\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowBastionHostCommunicationInBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationPortRanges: [\n            '8080'\n            '5701'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 130\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'DenyAllInBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRange: '*'\n          destinationAddressPrefix: '*'\n          access: 'Deny'\n          priority: 1000\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowSshRdpOutBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRanges: [\n            '22'\n            '3389'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 100\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowAzureCloudCommunicationOutBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRange: '443'\n          destinationAddressPrefix: 'AzureCloud'\n          access: 'Allow'\n          priority: 110\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowBastionHostCommunicationOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationPortRanges: [\n            '8080'\n            '5701'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 120\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowGetSessionInformationOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'Internet'\n          destinationPortRanges: [\n            '80'\n            '443'\n          ]\n          access: 'Allow'\n          priority: 130\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'DenyAllOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          destinationPortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Deny'\n          priority: 1000\n          direction: 'Outbound'\n        }\n      }\n    ]\n  }\n}\n\n// if vnetNewOrExisting == 'new', create a new vnet and subnet\nresource newVirtualNetwork 'Microsoft.Network/virtualNetworks@2022-07-01' = if (vnetNewOrExisting == 'new') {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetIpPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: bastionSubnetName\n        properties: {\n          addressPrefix: bastionSubnetIpPrefix\n          networkSecurityGroup: {\n            id: nsg.id\n          }\n        }\n      }\n    ]\n  }\n}\n\n// if vnetNewOrExisting == 'existing', reference an existing vnet and create a new subnet under it\nresource existingVirtualNetwork 'Microsoft.Network/virtualNetworks@2022-07-01' existing = if (vnetNewOrExisting == 'existing') {\n  name: vnetName\n}\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2022-07-01' = if (vnetNewOrExisting == 'existing') {\n  parent: existingVirtualNetwork\n  name: bastionSubnetName\n  properties: {\n    addressPrefix: bastionSubnetIpPrefix\n    networkSecurityGroup: {\n      id: nsg.id\n    }\n  }\n}\n\nresource bastionHost 'Microsoft.Network/bastionHosts@2022-07-01' = {\n  name: bastionHostName\n  location: location\n  dependsOn: [\n    newVirtualNetwork\n    existingVirtualNetwork\n  ]\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'IpConf'\n        properties: {\n          subnet: {\n            id: subnet.id\n          }\n          publicIPAddress: {\n            id: publicIp.id\n          }\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1187."}, {"role": "assistant", "content": "@description('The name of the DNS zone to be created.  Must have at least 2 segments, e.g. hostname.org')\nparam zoneName string = '${uniqueString(resourceGroup().id)}.azurequickstart.org'\n\n@description('The name of the DNS record to be created.  The name is relative to the zone, not the FQDN.')\nparam recordName string = 'www'\n\nresource zone 'Microsoft.Network/dnsZones@2018-05-01' = {\n  name: zoneName\n  location: 'global'\n}\n\nresource record 'Microsoft.Network/dnsZones/A@2018-05-01' = {\n  parent: zone\n  name: recordName\n  properties: {\n    TTL: 3600\n    ARecords: [\n      {\n        ipv4Address: '203.0.113.1'\n      }\n      {\n        ipv4Address: '203.0.113.2'\n      }\n    ]\n  }\n}\n\noutput nameServers array = zone.properties.nameServers\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1188 please."}, {"role": "assistant", "content": "@description('name of the new virtual network where DNS resolver will be created')\nparam resolverVNETName string = 'dnsresolverVNET'\n\n@description('the IP address space for the resolver virtual network')\nparam resolverVNETAddressSpace string = '10.7.0.0/24'\n\n@description('name of the dns private resolver')\nparam dnsResolverName string = 'dnsResolver'\n\n@description('the location for resolver VNET and dns private resolver - Azure DNS Private Resolver available in specific region, refer the documenation to select the supported region for this deployment. For more information https://docs.microsoft.com/azure/dns/dns-private-resolver-overview#regional-availability')\n@allowed([\n  'australiaeast'\n  'uksouth'\n  'northeurope'\n  'southcentralus'\n  'westus3'\n  'eastus'\n  'northcentralus'\n  'westcentralus'\n  'eastus2'\n  'westeurope'\n  'centralus'\n  'canadacentral'\n  'brazilsouth'\n  'francecentral'\n  'swedencentral'\n  'switzerlandnorth'\n  'eastasia'\n  'southeastasia'\n  'japaneast'\n  'koreacentral'\n  'southafricanorth'\n  'centralindia'\n  'westus'\n  'canadaeast'\n  'qatarcentral'\n  'uaenorth'\n  'australiasoutheast'\n  'polandcentral'\n])\nparam location string\n\n@description('name of the subnet that will be used for private resolver inbound endpoint')\nparam inboundSubnet string = 'snet-inbound'\n\n@description('the inbound endpoint subnet address space')\nparam inboundAddressPrefix string = '10.7.0.0/28'\n\n@description('name of the subnet that will be used for private resolver outbound endpoint')\nparam outboundSubnet string = 'snet-outbound'\n\n@description('the outbound endpoint subnet address space')\nparam outboundAddressPrefix string = '10.7.0.16/28'\n\n@description('name of the vnet link that links outbound endpoint with forwarding rule set')\nparam resolvervnetlink string = 'vnetlink'\n\n@description('name of the forwarding ruleset')\nparam forwardingRulesetName string = 'forwardingRule'\n\n@description('name of the forwarding rule name')\nparam forwardingRuleName string = 'contosocom'\n\n@description('the target domain name for the forwarding ruleset')\nparam DomainName string = 'contoso.com.'\n\n@description('the list of target DNS servers ip address and the port number for conditional forwarding')\nparam targetDNS array = [\n  {\n    ipAddress: '10.0.0.4'\n    port: 53\n  }\n  {\n    ipAddress: '10.0.0.5'\n    port: 53\n  }\n]\n\nresource resolver 'Microsoft.Network/dnsResolvers@2022-07-01' = {\n  name: dnsResolverName\n  location: location\n  properties: {\n    virtualNetwork: {\n      id: resolverVnet.id\n    }\n  }\n}\n\nresource inEndpoint 'Microsoft.Network/dnsResolvers/inboundEndpoints@2022-07-01' = {\n  parent: resolver\n  name: inboundSubnet\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        privateIpAllocationMethod: 'Dynamic'\n        subnet: {\n          id: '${resolverVnet.id}/subnets/${inboundSubnet}'\n        }\n      }\n    ]\n  }\n}\n\nresource outEndpoint 'Microsoft.Network/dnsResolvers/outboundEndpoints@2022-07-01' = {\n  parent: resolver\n  name: outboundSubnet\n  location: location\n  properties: {\n    subnet: {\n      id: '${resolverVnet.id}/subnets/${outboundSubnet}'\n    }\n  }\n}\n\nresource fwruleSet 'Microsoft.Network/dnsForwardingRulesets@2022-07-01' = {\n  name: forwardingRulesetName\n  location: location\n  properties: {\n    dnsResolverOutboundEndpoints: [\n      {\n        id: outEndpoint.id\n      }\n    ]\n  }\n}\n\nresource resolverLink 'Microsoft.Network/dnsForwardingRulesets/virtualNetworkLinks@2022-07-01' = {\n  parent: fwruleSet\n  name: resolvervnetlink\n  properties: {\n    virtualNetwork: {\n      id: resolverVnet.id\n    }\n  }\n}\n\nresource fwRules 'Microsoft.Network/dnsForwardingRulesets/forwardingRules@2022-07-01' = {\n  parent: fwruleSet\n  name: forwardingRuleName\n  properties: {\n    domainName: DomainName\n    targetDnsServers: targetDNS\n  }\n}\n\nresource resolverVnet 'Microsoft.Network/virtualNetworks@2022-01-01' = {\n  name: resolverVNETName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        resolverVNETAddressSpace\n      ]\n    }\n    enableDdosProtection: false\n    enableVmProtection: false\n    subnets: [\n      {\n        name: inboundSubnet\n        properties: {\n          addressPrefix: inboundAddressPrefix\n          delegations: [\n            {\n              name: 'Microsoft.Network.dnsResolvers'\n              properties: {\n                serviceName: 'Microsoft.Network/dnsResolvers'\n              }\n            }\n          ]\n        }\n      }\n      {\n        name: outboundSubnet\n        properties: {\n          addressPrefix: outboundAddressPrefix\n          delegations: [\n            {\n              name: 'Microsoft.Network.dnsResolvers'\n              properties: {\n                serviceName: 'Microsoft.Network/dnsResolvers'\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1189?"}, {"role": "assistant", "content": "@description('Security Type of the Virtual Machine.')\n@allowed([\n  'Standard'\n  'TrustedLaunch'\n])\nparam securityType string = 'TrustedLaunch'\n\n@description('Specifies the globally unique DNS Name for the ADLS Gen 2 storage account.')\nparam adlsStorageAccountName string = 'adls${uniqueString(resourceGroup().id)}'\n\n@description('Specifies the globally unique name for the storage account used to store the test file system and the boot diagnostics logs of the virtual machines.')\nparam blobStorageAccountName string = 'blob${uniqueString(resourceGroup().id)}'\n\n@description('Specifies the default action of allow or deny when no other rules match for the ADLS storage account.')\n@allowed([\n  'Allow'\n  'Deny'\n])\nparam adlsStorageAccountNetworkAclsDefaultAction string = 'Deny'\n\n@description('Allow or disallow public access to all blobs or containers in the Blob storage account. The default interpretation is true for this property.')\n@allowed([\n  'Allow'\n  'Deny'\n])\nparam blobStorageAccountNetworkAclsDefaultAction string = 'Deny'\n\n@description('Allow or disallow public access to all blobs or containers in the ADLS storage account. The default interpretation is true for this property.')\nparam adlsStorageAccountAllowBlobPublicAccess bool = true\n\n@description('Allow or disallow public access to all blobs or containers in the Blob storage account. The default interpretation is true for this property.')\nparam blobStorageAccountAllowBlobPublicAccess bool = true\n\n@description('Specify whether deploy a custom DNS forwarder in the Hub Virtual Network. Default value is false.')\nparam deployCustomDnsForwarder bool = false\n\n@description('Name of the Availability Set used by the DNS virtual machine.')\nparam dnsAvailabilitySetName string = 'availabilityset${uniqueString(resourceGroup().id)}'\n\n@description('Specifies the name of the DNS virtual machine.')\nparam dnsVmName string = 'DnsVm'\n\n@description('Specifies the name of the virtual machine in the Development Virtual Network.')\nparam devVmName string = 'DevVm'\n\n@description('Specifies the name of the virtual machine in the Production Virtual Network.')\nparam prodVmName string = 'ProdVm'\n\n@description('Specifies the size of the virtual machine.')\nparam vmSize string = 'Standard_D4s_v3'\n\n@description('The publisher of the image from which to launch the virtual machine.')\nparam imagePublisher string = 'MicrosoftCBLMariner'\n\n@description('The offer of the image from which to launch the virtual machine.')\nparam imageOffer string = 'cbl-mariner'\n\n@description('The SKU of the image from which to launch the virtual machine.')\nparam imageSku string = 'cbl-mariner-2-gen2'\n\n@description('Specifies the type of authentication when accessing the Virtual Machine. SSH key is recommended.')\n@allowed([\n  'sshPublicKey'\n  'password'\n])\nparam authenticationType string = 'password'\n\n@description('Specifies the name of the administrator account of the virtual machine.')\nparam adminUsername string\n\n@description('Specifies the SSH Key or password for the virtual machine. SSH key is recommended.')\n@secure()\nparam adminPasswordOrKey string\n\n@description('Defines the storage account type for OS and data disk.')\n@allowed([\n  'Premium_LRS'\n  'Premium_ZRS'\n  'StandardSSD_LRS'\n  'StandardSSD_ZRS'\n  'Standard_LRS'\n])\nparam diskStorageAccounType string = 'Premium_LRS'\n\n@description('Specifies the number of data disks of the virtual machine.')\n@minValue(0)\n@maxValue(64)\nparam numDataDisks int = 1\n\n@description('The size in GB of the OS disk of the VM.')\nparam osDiskSize int = 100\n\n@description('Specifies the size in GB of the OS disk of the virtual machine.')\nparam dataDiskSize int = 10\n\n@description('Specifies the caching requirements for the data disks.')\nparam dataDiskCaching string = 'ReadWrite'\n\n@description('Specifies the base URI where artifacts required by this template are located including a trailing \\'/\\'')\nparam _artifactsLocation string = deployment().properties.templateLink.uri\n\n@description('Specifies the sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured.')\n@secure()\nparam _artifactsLocationSasToken string = ''\n\n@description('Specifies the name of the adls private endpoint to the adls storage account.')\nparam adlsStorageAccountAdlsPrivateEndpointName string = 'AdlsStorageAccountAdlsPrivateEndpoint'\n\n@description('Specifies the name of the blob private endpoint to the adls storage account.')\nparam adlsStorageAccountBlobPrivateEndpointName string = 'AdlsStorageAccountBlobPrivateEndpoint'\n\n@description('Specifies the name of the blob private endpoint to the boot diagnostics storage account.')\nparam blobStorageAccountBlobPrivateEndpointName string = 'BlobStorageAccountBlobPrivateEndpoint'\n\n@description('Private DNS Zone name.')\nparam privateDnsZoneName string = 'contoso.corp'\n\n@description('the name of the Log Analytics workspace.')\nparam workspaceName string = 'loganalytics${uniqueString(resourceGroup().id)}'\n\n@description('The sku of the Log Analytics workspace.')\n@allowed([\n  'Free'\n  'Standard'\n  'Premium'\n  'PerNode'\n  'PerGB2018'\n  'Standalone'\n  'CapacityReservation'\n])\nparam workspaceSku string = 'PerGB2018'\n\n@description('The name of the Azure Firewall.')\nparam firewallName string = 'HubFirewall'\n\n@description('Zone numbers e.g. 1,2,3.')\nparam firewallAvailabilityZones array = []\n\n@description('Number of public IP addresses for the Azure Firewall')\n@minValue(1)\n@maxValue(100)\nparam numberOfFirewallPublicIPAddresses int = 1\n\n@description('Specifies whether create DNAT rule collection in the Azure Firewall policy or not.')\nparam createDnatRuleCollection bool = true\n\n@description('Specifies whether deploy a VPN Gateway in the Hub or not.')\nparam deployVpnGateway bool = false\n\n@description('The SKU of the Gateway, if deployed')\n@allowed([\n  'Basic'\n  'HighPerformance'\n  'Standard'\n  'UltraPerformance'\n  'VpnGw1'\n  'VpnGw2'\n  'VpnGw3'\n  'VpnGw4'\n  'VpnGw5'\n  'VpnGw1AZ'\n  'VpnGw2AZ'\n  'VpnGw3AZ'\n  'VpnGw4AZ'\n  'VpnGw5AZ'\n  'ErGw1AZ'\n  'ErGw2AZ'\n  'ErGw3AZ'\n])\nparam gatewaySku string = 'Standard'\n\n@description('The type of this virtual network gateway. - Vpn or ExpressRoute')\n@allowed([\n  'Vpn'\n  'ExpressRoute'\n])\nparam gatewayType string = 'Vpn'\n\n@description('The type of this virtual network gateway. - PolicyBased or RouteBased')\n@allowed([\n  'PolicyBased'\n  'RouteBased'\n])\nparam vpnType string = 'RouteBased'\n\n@description('Whether BGP is enabled for this virtual network gateway or not.')\nparam enableBgp bool = false\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\nparam hubVnetName string = 'HubVnet'\nparam hubVnetAddressPrefix string = '192.168.0.0/16'\n\n@description('The name of the Firewall subnet.')\nparam hubVnetFirewallSubnetName string = 'AzureFirewallSubnet'\n\n@description('The address prefix of the Firewall subnet.')\nparam hubVnetFirewallSubnetPrefix string = '192.168.0.0/26'\n\n@description('The name of the Management subnet.')\nparam hubVnetCommonSubnetName string = 'CommonSubnet'\n\n@description('The address prefix of the Management subnet.')\nparam hubVnetCommonSubnetPrefix string = '192.168.1.0/24'\n\n@description('The name of the Development Virtual Network.')\nparam hubVnetGatewaySubnetName string = 'GatewaySubnet'\n\n@description('The address prefix of the Gateway subnet.')\nparam hubVnetGatewaySubnetPrefix string = '192.168.15.224/27'\n\n@description('The name of gateway.')\nparam gatewayName string = 'HubVpnGateway'\n\n@description('The name of the Development Virtual Network.')\nparam devVnetName string = 'DevelopmentVNet'\n\n@description('The address prefix of the Development Virtual Network.')\nparam devVnetAddressPrefix string = '10.0.0.0/16'\n\n@description('The name of the Production Virtual Network.')\nparam prodVnetName string = 'ProductionVNet'\n\n@description('The address prefix of the Production Virtual Network.')\nparam prodVnetAddressPrefix string = '10.1.0.0/16'\n\n@description('The name of the Workload subnet.')\nparam devVnetDefaultSubnetName string = 'DefaultSubnet'\n\n@description('The address prefix of the Workload subnet in the Development Virtual Network.')\nparam devVNetDefaultSubnetPrefix string = '10.0.0.0/24'\n\n@description('The name of the Workload subnet.')\nparam prodVnetDefaultSubnetName string = 'DefaultSubnet'\n\n@description('The address prefix of the Workload subnet in the Production Virtual Network.')\nparam prodVNetDefaultSubnetPrefix string = '10.1.0.0/24'\n\n@description('Specifies the Bastion subnet IP prefix. This prefix must be within vnet IP prefix address space.')\nparam hubVnetBastionSubnetPrefix string = '192.168.4.0/24'\n\n@description('Specifies the name of the Azure Bastion resource.')\nparam bastionHostName string = 'bastion${uniqueString(resourceGroup().id)}'\n\n@description('The name of the Firewall Policy uased by the Azure Firewall')\nparam firewallPolicyName string = '${firewallName}Policy'\n\nvar securityProfileJson = {\n  uefiSettings: {\n    secureBootEnabled: true\n    vTpmEnabled: true\n  }\n  securityType: securityType\n}\nvar extensionName = 'GuestAttestation'\nvar extensionPublisher = 'Microsoft.Azure.Security.LinuxAttestation'\nvar extensionVersion = '1.0'\nvar maaTenantName = 'GuestAttestation'\nvar bastionPublicIpAddressName = '${bastionHostName}PublicIp'\nvar bastionSubnetName = 'AzureBastionSubnet'\nvar gatewayPublicIpName = '${gatewayName}PublicIp'\nvar hubVnetCommonSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', hubVnetName, hubVnetCommonSubnetName)\nvar dnsVmNicName = '${dnsVmName}Nic'\nvar devVmNicName = '${devVmName}Nic'\nvar prodVmNicName = '${prodVmName}Nic'\nvar hubVnetCommonSubnetNsgName = '${hubVnetName}${hubVnetCommonSubnetName}Nsg'\nvar hubVnetBastionSubnetNsgName = '${hubVnetName}${bastionSubnetName}Nsg'\nvar devVnetDefaultSubnetNsgName = '${devVnetName}${devVnetDefaultSubnetName}Nsg'\nvar prodVnetDefaultSubnetNsgName = '${prodVnetName}${prodVnetDefaultSubnetName}Nsg'\nvar devVnetDefaultSubnetRouteTableName = '${devVnetName}${devVnetDefaultSubnetName}RouteTable'\nvar prodVnetDefaultSubnetRouteTableName = '${prodVnetName}${prodVnetDefaultSubnetName}RouteTable'\nvar devVnetDefaultSubnetRouteTableId = devVnetDefaultSubnetRouteTable.id\nvar prodVnetDefaultSubnetRouteTableId = prodVnetDefaultSubnetRouteTable.id\nvar firewallPublicIPNamePrefix = '${firewallName}PublicIP'\nvar azureFirewallPublicIpId = resourceId('Microsoft.Network/publicIPAddresses', firewallPublicIPNamePrefix)\nvar azureFirewallSubnetJSON = json('{\"id\": \"${resourceId('Microsoft.Network/virtualNetworks/subnets', hubVnetName, hubVnetFirewallSubnetName)}\"}')\nvar firewallPolicyDefaultNetworkRuleCollectionGroupName = '${firewallPolicyName}/DefaultNetworkRuleCollectionGroup'\nvar firewallPolicyDefaultDnatRuleCollectionGroupName = '${firewallPolicyName}/DefaultDnatRuleCollectionGroup'\nvar contributorRoleId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\nvar storageBlobDataContributorRoleId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')\nvar linuxConfiguration = {\n  disablePasswordAuthentication: true\n  ssh: {\n    publicKeys: [\n      {\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\n        keyData: adminPasswordOrKey\n      }\n    ]\n  }\n  provisionVMAgent: true\n  patchSettings: {\n      patchMode: 'AutomaticByPlatform'\n  }\n}\nvar adlsStorageAccountId = adlsStorageAccount.id\nvar blobStorageAccountId = blobStorageAccount.id\nvar adlsPublicDNSZoneForwarder = '.dfs.${environment().suffixes.storage}'\nvar blobPublicDNSZoneForwarder = '.blob.${environment().suffixes.storage}'\nvar adlsPrivateDnsZoneName = 'privatelink${adlsPublicDNSZoneForwarder}'\nvar blobPrivateDnsZoneName = 'privatelink${blobPublicDNSZoneForwarder}'\nvar adlsPrivateDnsZoneId = adlsPrivateDnsZone.id\nvar blobPrivateDnsZoneId = blobPrivateDnsZone.id\nvar adlsServicePrimaryEndpoint = '${adlsStorageAccountName}${adlsPublicDNSZoneForwarder}'\nvar blobServicePrimaryEndpoint = '${blobStorageAccountName}${blobPublicDNSZoneForwarder}'\nvar adlsGroupName = 'dfs'\nvar blobGroupName = 'blob'\nvar dnsVmScriptFileName = 'configure-custom-dns-forwarder.sh'\nvar testVmScriptFileName = 'test-dns-and-private-endpoints.sh'\nvar dnsVmScriptFileUri = uri(_artifactsLocation, 'scripts/${dnsVmScriptFileName}${_artifactsLocationSasToken}')\nvar testVmScriptFileUri = uri(_artifactsLocation, 'scripts/${testVmScriptFileName}${_artifactsLocationSasToken}')\n\nvar devContributorRoleAssignmentName = guid('devcontributor${resourceGroup().id}${devVmName}')\nvar prodContributorRoleAssignmentName = guid('prodcontributor${resourceGroup().id}${prodVmName}')\nvar devStorageBlobDataContributorRoleAssignmentName = guid('devStorageBlobDataContributor${resourceGroup().id}${devVmName}')\nvar prodStorageBlobDataContributorRoleAssignmentName = guid('prodStorageBlobDataContributor${resourceGroup().id}${prodVmName}')\n\nresource adlsStorageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: adlsStorageAccountName\n  location: location\n  sku: {\n    name: 'Standard_RAGRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    networkAcls: {\n      defaultAction: adlsStorageAccountNetworkAclsDefaultAction\n      bypass: 'AzureServices'\n    }\n    allowBlobPublicAccess: adlsStorageAccountAllowBlobPublicAccess\n  }\n}\n\nresource blobStorageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: blobStorageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    networkAcls: {\n      defaultAction: blobStorageAccountNetworkAclsDefaultAction\n      bypass: 'AzureServices'\n    }\n    allowBlobPublicAccess: blobStorageAccountAllowBlobPublicAccess\n  }\n}\n\nresource hubVnetCommonSubnetNsg 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\n  name: hubVnetCommonSubnetNsgName\n  location: location\n}\n\nresource hubVnetCommonSubnetNsgDiagnosticSetting 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: hubVnetCommonSubnetNsg\n  name: 'default'\n  properties: {\n    workspaceId: workspace.id\n    logs: [\n      {\n        category: 'NetworkSecurityGroupEvent'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n      {\n        category: 'NetworkSecurityGroupRuleCounter'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n    ]\n  }\n}\n\nresource devVnetDefaultSubnetNsg 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\n  name: devVnetDefaultSubnetNsgName\n  location: location\n}\n\nresource devVnetDefaultSubnetNsgDiagnosticSetting 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: devVnetDefaultSubnetNsg\n  name: 'default'\n  properties: {\n    workspaceId: workspace.id\n    logs: [\n      {\n        category: 'NetworkSecurityGroupEvent'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n      {\n        category: 'NetworkSecurityGroupRuleCounter'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n    ]\n  }\n}\n\nresource prodVnetDefaultSubnetNsg 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\n  name: prodVnetDefaultSubnetNsgName\n  location: location\n}\n\nresource prodVnetDefaultSubnetNsgDiagnosticSetting 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: prodVnetDefaultSubnetNsg\n  name: 'default'\n  properties: {\n    workspaceId: workspace.id\n    logs: [\n      {\n        category: 'NetworkSecurityGroupEvent'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n      {\n        category: 'NetworkSecurityGroupRuleCounter'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n    ]\n  }\n}\n\nresource hubVnetBastionSubnetNsg 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\n  name: hubVnetBastionSubnetNsgName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowHttpsInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'Internet'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 100\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowGatewayManagerInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'GatewayManager'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 110\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowLoadBalancerInBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'AzureLoadBalancer'\n          destinationPortRange: '443'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 120\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowBastionHostCommunicationInBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationPortRanges: [\n            '8080'\n            '5701'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 130\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'DenyAllInBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRange: '*'\n          destinationAddressPrefix: '*'\n          access: 'Deny'\n          priority: 1000\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'AllowSshRdpOutBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRanges: [\n            '22'\n            '3389'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 100\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowAzureCloudCommunicationOutBound'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationPortRange: '443'\n          destinationAddressPrefix: 'AzureCloud'\n          access: 'Allow'\n          priority: 110\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowBastionHostCommunicationOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationPortRanges: [\n            '8080'\n            '5701'\n          ]\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 120\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'AllowGetSessionInformationOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'Internet'\n          destinationPortRanges: [\n            '80'\n            '443'\n          ]\n          access: 'Allow'\n          priority: 130\n          direction: 'Outbound'\n        }\n      }\n      {\n        name: 'DenyAllOutBound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          destinationPortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Deny'\n          priority: 1000\n          direction: 'Outbound'\n        }\n      }\n    ]\n  }\n}\n\nresource hubVnetBastionSubnetNsgDiagnosticSetting 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: hubVnetBastionSubnetNsg\n  name: 'default'\n  properties: {\n    workspaceId: workspace.id\n    logs: [\n      {\n        category: 'NetworkSecurityGroupEvent'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n      {\n        category: 'NetworkSecurityGroupRuleCounter'\n        enabled: true\n        retentionPolicy: {\n          enabled: false\n          days: 0\n        }\n      }\n    ]\n  }\n}\n\nresource bastionPublicIpAddress 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\n  name: bastionPublicIpAddressName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource bastionHost 'Microsoft.Network/bastionHosts@2023-09-01' = {\n  name: bastionHostName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'IpConfiguration'\n        properties: {\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', hubVnetName, bastionSubnetName)\n          }\n          publicIPAddress: {\n            id: bastionPublicIpAddress.id\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    hubVnet\n  ]\n}\n\nresource hubVnet 'Microsoft.Network/virtualNetworks@2023-09-01' = {\n  name: hubVnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        hubVnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: hubVnetCommonSubnetName\n        properties: {\n          addressPrefix: hubVnetCommonSubnetPrefix\n          networkSecurityGroup: {\n            id: hubVnetCommonSubnetNsg.id\n          }\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n        }\n      }\n      {\n        name: bastionSubnetName\n        properties: {\n          addressPrefix: hubVnetBastionSubnetPrefix\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n          networkSecurityGroup: {\n            id: hubVnetBastionSubnetNsg.id\n          }\n        }\n      }\n      {\n        name: hubVnetGatewaySubnetName\n        properties: {\n          addressPrefix: hubVnetGatewaySubnetPrefix\n        }\n      }\n      {\n        name: hubVnetFirewallSubnetName\n        properties: {\n          addressPrefix: hubVnetFirewallSubnetPrefix\n        }\n      }\n    ]\n    enableDdosProtection: false\n    enableVmProtection: false\n  }\n}\n\nresource devVnet 'Microsoft.Network/virtualNetworks@2023-09-01' = {\n  name: devVnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        devVnetAddressPrefix\n      ]\n    }\n    dhcpOptions: {\n      dnsServers: [\n        firewall.properties.ipConfigurations[0].properties.privateIPAddress\n      ]\n    }\n    subnets: [\n      {\n        name: devVnetDefaultSubnetName\n        properties: {\n          addressPrefix: devVNetDefaultSubnetPrefix\n          routeTable: {\n            id: devVnetDefaultSubnetRouteTableId\n          }\n          networkSecurityGroup: {\n            id: devVnetDefaultSubnetNsg.id\n          }\n        }\n      }\n    ]\n    enableDdosProtection: false\n    enableVmProtection: false\n  }\n}\n\nresource prodVnet 'Microsoft.Network/virtualNetworks@2023-09-01' = {\n  name: prodVnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        prodVnetAddressPrefix\n      ]\n    }\n    dhcpOptions: {\n      dnsServers: [\n        firewall.properties.ipConfigurations[0].properties.privateIPAddress\n      ]\n    }\n    subnets: [\n      {\n        name: prodVnetDefaultSubnetName\n        properties: {\n          addressPrefix: prodVNetDefaultSubnetPrefix\n          routeTable: {\n            id: prodVnetDefaultSubnetRouteTableId\n          }\n          networkSecurityGroup: {\n            id: prodVnetDefaultSubnetNsg.id\n          }\n        }\n      }\n    ]\n    enableDdosProtection: false\n    enableVmProtection: false\n  }\n}\n\nresource hubVnetToDevVnetPeering 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2023-09-01' = {\n  parent: hubVnet\n  name: '${hubVnetName}To${devVnetName}Peering'\n  properties: {\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: true\n    allowGatewayTransit: deployVpnGateway\n    useRemoteGateways: false\n    remoteVirtualNetwork: {\n      id: devVnet.id\n    }\n  }\n  dependsOn: [\n    gateway\n  ]\n}\n\nresource hubVnetToProdVnetPeering 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2023-09-01' = {\n  parent: hubVnet\n  name: '${hubVnetName}To${prodVnetName}Peering'\n  properties: {\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: true\n    allowGatewayTransit: deployVpnGateway\n    useRemoteGateways: false\n    remoteVirtualNetwork: {\n      id: prodVnet.id\n    }\n  }\n  dependsOn: [\n    gateway\n  ]\n}\n\nresource devVnetToHubVnetPeering 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2023-09-01' = {\n  parent: devVnet\n  name: '${devVnetName}To${hubVnetName}Peering'\n  properties: {\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: true\n    allowGatewayTransit: false\n    useRemoteGateways: deployVpnGateway\n    remoteVirtualNetwork: {\n      id: hubVnet.id\n    }\n  }\n  dependsOn: [\n    gateway\n  ]\n}\n\nresource prodVnetToHubVnetPeering 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2023-09-01' = {\n  parent: prodVnet\n  name: '${prodVnetName}To${hubVnetName}Peering'\n  properties: {\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: true\n    allowGatewayTransit: false\n    useRemoteGateways: deployVpnGateway\n    remoteVirtualNetwork: {\n      id: hubVnet.id\n    }\n  }\n  dependsOn: [\n    gateway\n  ]\n}\n\nresource gatewayPublicIp 'Microsoft.Network/publicIPAddresses@2023-09-01' = if (deployVpnGateway) {\n  name: gatewayPublicIpName\n  location: location\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n\nresource gateway 'Microsoft.Network/virtualNetworkGateways@2023-09-01' = if (deployVpnGateway) {\n  name: gatewayName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', hubVnetName, hubVnetGatewaySubnetName)\n          }\n          publicIPAddress: {\n            id: gatewayPublicIp.id\n          }\n        }\n        name: 'vnetGatewayConfig'\n      }\n    ]\n    sku: {\n      name: gatewaySku\n      tier: gatewaySku\n    }\n    gatewayType: gatewayType\n    vpnType: vpnType\n    enableBgp: enableBgp\n  }\n  dependsOn: [\n    hubVnet\n  ]\n}\n\nresource dnsAvailabilitySet 'Microsoft.Compute/availabilitySets@2023-09-01' = if (deployCustomDnsForwarder) {\n  name: dnsAvailabilitySetName\n  location: location\n  sku: {\n    name: 'Aligned'\n  }\n  properties: {\n    platformFaultDomainCount: 2\n    platformUpdateDomainCount: 2\n  }\n}\n\nresource dnsVmNic 'Microsoft.Network/networkInterfaces@2023-09-01' = if (deployCustomDnsForwarder) {\n  name: dnsVmNicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'vmIpConfig'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: hubVnetCommonSubnetId\n          }\n          privateIPAddressVersion: 'IPv4'\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    hubVnet\n  ]\n}\n\nresource dnsVm 'Microsoft.Compute/virtualMachines@2023-09-01' = if (deployCustomDnsForwarder) {\n  name: dnsVmName\n  location: location\n  tags: {\n      AzSecPackAutoConfigReady: true\n  }\n  properties: {\n    availabilitySet: {\n      id: dnsAvailabilitySet.id\n    }\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: dnsVmName\n      adminUsername: adminUsername\n      adminPassword: adminPasswordOrKey\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: imagePublisher\n        offer: imageOffer\n        sku: imageSku\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${dnsVmName}_OSDisk'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        diskSizeGB: osDiskSize\n        managedDisk: {\n          storageAccountType: diskStorageAccounType\n        }\n      }\n      dataDisks: [for j in range(0, numDataDisks): {\n        caching: dataDiskCaching\n        diskSizeGB: dataDiskSize\n        lun: j\n        name: '${dnsVmName}-DataDisk${j}'\n        createOption: 'Empty'\n        managedDisk: {\n          storageAccountType: diskStorageAccounType\n        }\n      }]\n    }\n    securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: dnsVmNic.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: reference(blobStorageAccountId).primaryEndpoints.blob\n      }\n    }\n  }\n  dependsOn: [\n    blobStorageAccountBlobPrivateEndpoint\n  ]\n}\n\nresource dnsVmGuestAttestation 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = if (deployCustomDnsForwarder && ((securityType == 'TrustedLaunch') && ((securityProfileJson.uefiSettings.secureBootEnabled == true) && (securityProfileJson.uefiSettings.vTpmEnabled == true)))) {\n  parent: dnsVm\n  name: 'GuestAttestation'\n  location: location\n  properties: {\n    publisher: extensionPublisher\n    type: extensionName\n    typeHandlerVersion: extensionVersion\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      AttestationConfig: {\n        MaaSettings: {\n          maaEndpoint: ''\n          maaTenantName: maaTenantName\n        }\n        AscSettings: {\n          ascReportingEndpoint: ''\n          ascReportingFrequency: ''\n        }\n        useCustomToken: 'false'\n        disableAlerts: 'false'\n      }\n    }\n  }\n}\n\nresource dnsVmCustomScript 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = if (deployCustomDnsForwarder) {\n  parent: dnsVm\n  name: 'CustomScript'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Extensions'\n    type: 'CustomScript'\n    typeHandlerVersion: '2.0'\n    autoUpgradeMinorVersion: true\n    settings: {\n      fileUris: [\n        dnsVmScriptFileUri\n      ]\n      commandToExecute: './${dnsVmScriptFileName}'\n    }\n  }\n}\n\nresource dnsVmAzureMonitorAgent 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = if (deployCustomDnsForwarder) {\n  parent: dnsVm\n  name: '${dnsVmName}-AzureMonitorLinuxAgent'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Monitor'\n    type: 'AzureMonitorLinuxAgent'\n    typeHandlerVersion: '1.21'\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n  }\n}\n\nresource devVmNic 'Microsoft.Network/networkInterfaces@2023-09-01' = {\n  name: devVmNicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', devVnetName, devVnetDefaultSubnetName)\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    devVnet\n  ]\n}\n\nresource devContributorRoleAssignmentGuid 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: devContributorRoleAssignmentName\n  properties: {\n    roleDefinitionId: contributorRoleId\n    principalId: devVm.identity.principalId\n  }\n}\n\nresource devStorageBlobDataContributorRoleAssignmentGuid 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: devStorageBlobDataContributorRoleAssignmentName\n  properties: {\n    roleDefinitionId: storageBlobDataContributorRoleId\n    principalId: devVm.identity.principalId\n  }\n}\n\nresource devVm 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: devVmName\n  location: location\n  tags: {\n      AzSecPackAutoConfigReady: true\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: devVmName\n      adminUsername: adminUsername\n      adminPassword: adminPasswordOrKey\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: imagePublisher\n        offer: imageOffer\n        sku: imageSku\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${devVmName}_OSDisk'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        diskSizeGB: osDiskSize\n        managedDisk: {\n          storageAccountType: diskStorageAccounType\n        }\n      }\n      dataDisks: [for j in range(0, numDataDisks): {\n        caching: dataDiskCaching\n        diskSizeGB: dataDiskSize\n        lun: j\n        name: '${devVmName}-DataDisk${j}'\n        createOption: 'Empty'\n        managedDisk: {\n          storageAccountType: diskStorageAccounType\n        }\n      }]\n    }\n    securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: devVmNic.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: reference(blobStorageAccountId).primaryEndpoints.blob\n      }\n    }\n  }\n  dependsOn: [\n    adlsStorageAccountAdlsPrivateEndpoint\n    adlsStorageAccountBlobPrivateEndpoint\n    blobStorageAccountBlobPrivateEndpoint\n  ]\n}\n\nresource devVmGuestAttestation 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = if ((securityType == 'TrustedLaunch') && ((securityProfileJson.uefiSettings.secureBootEnabled == true) && (securityProfileJson.uefiSettings.vTpmEnabled == true))) {\n  parent: devVm\n  name: 'GuestAttestation'\n  location: location\n  properties: {\n    publisher: extensionPublisher\n    type: extensionName\n    typeHandlerVersion: extensionVersion\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      AttestationConfig: {\n        MaaSettings: {\n          maaEndpoint: ''\n          maaTenantName: maaTenantName\n        }\n        AscSettings: {\n          ascReportingEndpoint: ''\n          ascReportingFrequency: ''\n        }\n        useCustomToken: 'false'\n        disableAlerts: 'false'\n      }\n    }\n  }\n}\n\nresource devVmCustomScript 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = {\n  parent: devVm\n  name: 'CustomScript'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Extensions'\n    type: 'CustomScript'\n    typeHandlerVersion: '2.1'\n    autoUpgradeMinorVersion: true\n    settings: {\n      skipDos2Unix: false\n      timestamp: 123456789\n      fileUris: [\n        testVmScriptFileUri\n      ]\n    }\n    protectedSettings: {\n      commandToExecute: 'bash ${testVmScriptFileName} ${privateDnsZoneName} ${devVmName} ${prodVmName} ${adlsServicePrimaryEndpoint} ${blobServicePrimaryEndpoint}'\n    }\n  }\n  dependsOn: [\n    devContributorRoleAssignmentGuid\n    devStorageBlobDataContributorRoleAssignmentGuid\n    firewallPolicyDefaultNetworkRuleCollectionGroup\n  ]\n}\n\nresource devVmAzureMonitorAgent 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = {\n  parent: devVm\n  name: '${devVmName}-AzureMonitorLinuxAgent'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Monitor'\n    type: 'AzureMonitorLinuxAgent'\n    typeHandlerVersion: '1.21'\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n  }\n}\n\nresource prodVmNic 'Microsoft.Network/networkInterfaces@2023-09-01' = {\n  name: prodVmNicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', prodVnetName, prodVnetDefaultSubnetName)\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    prodVnet\n  ]\n}\n\nresource prodContributorRoleAssignmentGuid 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: prodContributorRoleAssignmentName\n  properties: {\n    roleDefinitionId: contributorRoleId\n    principalId: prodVm.identity.principalId\n  }\n}\n\nresource prodStorageBlobDataContributorRoleAssignmentGuid 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: prodStorageBlobDataContributorRoleAssignmentName\n  properties: {\n    roleDefinitionId: storageBlobDataContributorRoleId\n    principalId: prodVm.identity.principalId\n  }\n}\n\nresource prodVm 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: prodVmName\n  location: location\n  tags: {\n      AzSecPackAutoConfigReady: true\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: prodVmName\n      adminUsername: adminUsername\n      adminPassword: adminPasswordOrKey\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: imagePublisher\n        offer: imageOffer\n        sku: imageSku\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${prodVmName}_OSDisk'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        diskSizeGB: osDiskSize\n        managedDisk: {\n          storageAccountType: diskStorageAccounType\n        }\n      }\n      dataDisks: [for j in range(0, numDataDisks): {\n        caching: dataDiskCaching\n        diskSizeGB: dataDiskSize\n        lun: j\n        name: '${prodVmName}-DataDisk${j}'\n        createOption: 'Empty'\n        managedDisk: {\n          storageAccountType: diskStorageAccounType\n        }\n      }]\n    }\n    securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: prodVmNic.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: reference(blobStorageAccountId).primaryEndpoints.blob\n      }\n    }\n  }\n  dependsOn: [\n    adlsStorageAccountAdlsPrivateEndpoint\n    adlsStorageAccountBlobPrivateEndpoint\n    blobStorageAccountBlobPrivateEndpoint\n  ]\n}\n\nresource prodVmGuestAttestation 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = if ((securityType == 'TrustedLaunch') && ((securityProfileJson.uefiSettings.secureBootEnabled == true) && (securityProfileJson.uefiSettings.vTpmEnabled == true))) {\n  parent: prodVm\n  name: 'GuestAttestation'\n  location: location\n  properties: {\n    publisher: extensionPublisher\n    type: extensionName\n    typeHandlerVersion: extensionVersion\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      AttestationConfig: {\n        MaaSettings: {\n          maaEndpoint: ''\n          maaTenantName: maaTenantName\n        }\n        AscSettings: {\n          ascReportingEndpoint: ''\n          ascReportingFrequency: ''\n        }\n        useCustomToken: 'false'\n        disableAlerts: 'false'\n      }\n    }\n  }\n}\n\nresource prodVmCustomScript 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = {\n  parent: prodVm\n  name: 'CustomScript'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Extensions'\n    type: 'CustomScript'\n    typeHandlerVersion: '2.1'\n    autoUpgradeMinorVersion: true\n    settings: {\n      skipDos2Unix: false\n      timestamp: 123456789\n      fileUris: [\n        testVmScriptFileUri\n      ]\n    }\n    protectedSettings: {\n      commandToExecute: 'bash ${testVmScriptFileName} ${privateDnsZoneName} ${devVmName} ${prodVmName} ${adlsServicePrimaryEndpoint} ${blobServicePrimaryEndpoint}'\n    }\n  }\n  dependsOn: [\n    prodContributorRoleAssignmentGuid\n    prodStorageBlobDataContributorRoleAssignmentGuid\n    firewallPolicyDefaultNetworkRuleCollectionGroup\n  ]\n}\n\nresource prodVmAzureMonitorAgent 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = {\n  parent: prodVm\n  name: '${prodVmName}-AzureMonitorLinuxAgent'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Monitor'\n    type: 'AzureMonitorLinuxAgent'\n    typeHandlerVersion: '1.21'\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n  }\n}\n\nresource firewallPublicIp 'Microsoft.Network/publicIPAddresses@2023-09-01' = [for i in range(0, numberOfFirewallPublicIPAddresses): {\n  name: ((numberOfFirewallPublicIPAddresses == 1) ? firewallPublicIPNamePrefix : '${firewallPublicIPNamePrefix}${i + 1}')\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    publicIPAddressVersion: 'IPv4'\n  }\n}]\n\nresource firewallPolicy 'Microsoft.Network/firewallPolicies@2023-09-01' = {\n  name: firewallPolicyName\n  location: location\n  properties: {\n    dnsSettings: {\n      enableProxy: true\n      servers: (deployCustomDnsForwarder ? [\n        dnsVmNic.properties.ipConfigurations[0].properties.privateIPAddress\n      ] : [])\n    }\n    threatIntelMode: 'Alert'\n  }\n}\n\nresource firewall 'Microsoft.Network/azureFirewalls@2023-09-01' = {\n  name: firewallName\n  location: location\n  zones: ((length(firewallAvailabilityZones) == 0) ? null : firewallAvailabilityZones)\n  properties: {\n    ipConfigurations: [for j in range(0, numberOfFirewallPublicIPAddresses): {\n      name: ((numberOfFirewallPublicIPAddresses == 1) ? 'IpConfiguration' : 'IpConfiguration${j}')\n      properties: {\n        subnet: ((j == 0) ? azureFirewallSubnetJSON : null)\n        publicIPAddress: {\n          id: ((numberOfFirewallPublicIPAddresses == 1) ? azureFirewallPublicIpId : '${azureFirewallPublicIpId}${j + 1}')\n        }\n      }\n    }]\n    firewallPolicy: {\n      id: firewallPolicy.id\n    }\n  }\n  dependsOn: [\n    hubVnet\n    firewallPublicIp\n  ]\n}\n\nresource firewallPolicyDefaultNetworkRuleCollectionGroup 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2023-09-01' = {\n  name: firewallPolicyDefaultNetworkRuleCollectionGroupName\n  properties: {\n    priority: 200\n    ruleCollections: [\n      {\n        name: 'VnetToVnetNetworkRules'\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        priority: 100\n        action: {\n          type: 'Allow'\n        }\n        rules: [\n          {\n            name: 'Allow-${devVnetName}-${devVnetDefaultSubnetName}-To-${prodVnetName}-${prodVnetDefaultSubnetName}-Traffic'\n            ruleType: 'NetworkRule'\n            ipProtocols: [\n              'Any'\n            ]\n            sourceAddresses: [\n              prodVnetAddressPrefix\n            ]\n            destinationAddresses: [\n              devVnetAddressPrefix\n            ]\n            destinationPorts: [\n              '*'\n            ]\n          }\n          {\n            name: 'Allow-${prodVnetName}-${prodVnetDefaultSubnetName}-To-${devVnetName}-${devVnetDefaultSubnetName}-Traffic'\n            ruleType: 'NetworkRule'\n            ipProtocols: [\n              'Any'\n            ]\n            sourceAddresses: [\n              devVnetAddressPrefix\n            ]\n            destinationAddresses: [\n              prodVnetAddressPrefix\n            ]\n            destinationPorts: [\n              '*'\n            ]\n          }\n        ]\n      }\n      {\n        name: 'VnetToInternet'\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        priority: 200\n        action: {\n          type: 'Allow'\n        }\n        rules: [\n          {\n            name: 'Allow-${hubVnetName}-${hubVnetCommonSubnetName}-Internet-Traffic'\n            ruleType: 'NetworkRule'\n            ipProtocols: [\n              'TCP'\n            ]\n            sourceAddresses: [\n              hubVnetCommonSubnetPrefix\n            ]\n            destinationAddresses: [\n              '*'\n            ]\n            destinationPorts: [\n              '80'\n              '443'\n            ]\n          }\n          {\n            name: 'Allow-${prodVnetName}-${prodVnetDefaultSubnetName}-Internet-Traffic'\n            ruleType: 'NetworkRule'\n            ipProtocols: [\n              'TCP'\n            ]\n            sourceAddresses: [\n              prodVNetDefaultSubnetPrefix\n            ]\n            destinationAddresses: [\n              '*'\n            ]\n            destinationPorts: [\n              '80'\n              '443'\n            ]\n          }\n          {\n            name: 'Allow-${devVnetName}-${devVnetDefaultSubnetName}-Internet-Traffic'\n            ruleType: 'NetworkRule'\n            ipProtocols: [\n              'TCP'\n            ]\n            sourceAddresses: [\n              devVNetDefaultSubnetPrefix\n            ]\n            destinationAddresses: [\n              '*'\n            ]\n            destinationPorts: [\n              '80'\n              '443'\n            ]\n          }\n        ]\n      }\n    ]\n  }\n  dependsOn: [\n    firewallPolicy\n    firewall\n    hubVnet\n    devVnet\n    prodVnet\n  ]\n}\n\nresource firewallPolicyDefaultDnatRuleCollectionGroup 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2023-09-01' = if (createDnatRuleCollection) {\n  name: firewallPolicyDefaultDnatRuleCollectionGroupName\n  properties: {\n    priority: 100\n    ruleCollections: [\n      {\n        name: 'VirtualMachineNatRules'\n        ruleCollectionType: 'FirewallPolicyNatRuleCollection'\n        priority: 300\n        action: {\n          type: 'Dnat'\n        }\n        rules: [\n          {\n            name: '${devVmName}-Rdp-Nat-Rule'\n            ruleType: 'NatRule'\n            sourceAddresses: [\n              '*'\n            ]\n            destinationAddresses: [\n              firewallPublicIp[0].properties.ipAddress\n            ]\n            destinationPorts: [\n              '4001'\n            ]\n            ipProtocols: [\n              'TCP'\n            ]\n            translatedAddress: devVmNic.properties.ipConfigurations[0].properties.privateIPAddress\n            translatedPort: '22'\n          }\n          {\n            name: '${prodVmName}-Rdp-Nat-Rule'\n            ruleType: 'NatRule'\n            sourceAddresses: [\n              '*'\n            ]\n            destinationAddresses: [\n              firewallPublicIp[0].properties.ipAddress\n            ]\n            destinationPorts: [\n              '4002'\n            ]\n            ipProtocols: [\n              'TCP'\n            ]\n            translatedAddress: prodVmNic.properties.ipConfigurations[0].properties.privateIPAddress\n            translatedPort: '22'\n          }\n        ]\n      }\n    ]\n  }\n  dependsOn: [\n    firewallPolicy\n    firewall\n    firewallPolicyDefaultNetworkRuleCollectionGroup\n  ]\n}\n\nresource devVnetDefaultSubnetRouteTable 'Microsoft.Network/routeTables@2023-09-01' = {\n  name: devVnetDefaultSubnetRouteTableName\n  location: location\n  properties: {\n    disableBgpRoutePropagation: (!enableBgp)\n    routes: [\n      {\n        name: 'RouteTrafficTo${firewallName}'\n        properties: {\n          addressPrefix: '0.0.0.0/0'\n          nextHopType: 'VirtualAppliance'\n          nextHopIpAddress: firewall.properties.ipConfigurations[0].properties.privateIPAddress\n        }\n      }\n    ]\n  }\n}\n\nresource prodVnetDefaultSubnetRouteTable 'Microsoft.Network/routeTables@2023-09-01' = {\n  name: prodVnetDefaultSubnetRouteTableName\n  location: location\n  properties: {\n    disableBgpRoutePropagation: (!enableBgp)\n    routes: [\n      {\n        name: 'RouteTrafficTo${firewallName}'\n        properties: {\n          addressPrefix: '0.0.0.0/0'\n          nextHopType: 'VirtualAppliance'\n          nextHopIpAddress: firewall.properties.ipConfigurations[0].properties.privateIPAddress\n        }\n      }\n    ]\n  }\n}\n\nresource privateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDnsZoneName\n  location: 'global'\n}\n\nresource linkToProdVnet 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateDnsZone\n  name: 'LinkTo${prodVnetName}'\n  location: 'global'\n  properties: {\n    registrationEnabled: true\n    virtualNetwork: {\n      id: prodVnet.id\n    }\n  }\n}\n\nresource linkToHubVnet 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateDnsZone\n  name: 'LinkTo${hubVnetName}'\n  location: 'global'\n  properties: {\n    registrationEnabled: true\n    virtualNetwork: {\n      id: hubVnet.id\n    }\n  }\n}\n\nresource linkToDevVnet 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateDnsZone\n  name: 'LinkTo${devVnetName}'\n  location: 'global'\n  properties: {\n    registrationEnabled: true\n    virtualNetwork: {\n      id: devVnet.id\n    }\n  }\n}\n\nresource workspace 'Microsoft.OperationalInsights/workspaces@2023-09-01' = {\n  name: workspaceName\n  location: location\n  properties: {\n    sku: {\n      name: workspaceSku\n    }\n  }\n}\n\nresource agentHealthAssessmentWorkspace 'Microsoft.OperationsManagement/solutions@2015-11-01-preview' = {\n  location: location\n  name: 'AgentHealthAssessment(${workspaceName})'\n  properties: {\n    workspaceResourceId: workspace.id\n  }\n  plan: {\n    name: 'AgentHealthAssessment(${workspaceName})'\n    publisher: 'Microsoft'\n    product: 'OMSGallery/AgentHealthAssessment'\n    promotionCode: ''\n  }\n}\n\nresource infrastructureInsightsWorkspace 'Microsoft.OperationsManagement/solutions@2015-11-01-preview' = {\n  location: location\n  name: 'InfrastructureInsights(${workspaceName})'\n  properties: {\n    workspaceResourceId: workspace.id\n  }\n  plan: {\n    name: 'InfrastructureInsights(${workspaceName})'\n    publisher: 'Microsoft'\n    product: 'OMSGallery/InfrastructureInsights'\n    promotionCode: ''\n  }\n}\n\nresource workspaceKern 'Microsoft.OperationalInsights/workspaces/dataSources@2020-08-01' = {\n  parent: workspace\n  name: 'Kern'\n  kind: 'LinuxSyslog'\n  properties: {\n    syslogName: 'kern'\n    syslogSeverities: [\n      {\n        severity: 'emerg'\n      }\n      {\n        severity: 'alert'\n      }\n      {\n        severity: 'crit'\n      }\n      {\n        severity: 'err'\n      }\n      {\n        severity: 'warning'\n      }\n    ]\n  }\n}\n\nresource workspaceSyslog 'Microsoft.OperationalInsights/workspaces/dataSources@2020-08-01' = {\n  parent: workspace\n  name: 'Syslog'\n  kind: 'LinuxSyslog'\n  properties: {\n    syslogName: 'syslog'\n    syslogSeverities: [\n      {\n        severity: 'emerg'\n      }\n      {\n        severity: 'alert'\n      }\n      {\n        severity: 'crit'\n      }\n      {\n        severity: 'err'\n      }\n      {\n        severity: 'warning'\n      }\n    ]\n  }\n}\n\nresource workspaceUser 'Microsoft.OperationalInsights/workspaces/dataSources@2020-08-01' = {\n  parent: workspace\n  name: 'User'\n  kind: 'LinuxSyslog'\n  properties: {\n    syslogName: 'user'\n    syslogSeverities: [\n      {\n        severity: 'emerg'\n      }\n      {\n        severity: 'alert'\n      }\n      {\n        severity: 'crit'\n      }\n      {\n        severity: 'err'\n      }\n      {\n        severity: 'warning'\n      }\n    ]\n  }\n}\n\nresource workspaceSampleSyslogCollection1 'Microsoft.OperationalInsights/workspaces/dataSources@2020-08-01' = {\n  parent: workspace\n  name: 'SampleSyslogCollection1'\n  kind: 'LinuxSyslogCollection'\n  properties: {\n    state: 'Enabled'\n  }\n}\n\nresource workspaceDiskPerfCounters 'Microsoft.OperationalInsights/workspaces/dataSources@2020-08-01' = {\n  parent: workspace\n  name: 'DiskPerfCounters'\n  kind: 'LinuxPerformanceObject'\n  properties: {\n    performanceCounters: [\n      {\n        counterName: '% Used Inodes'\n      }\n      {\n        counterName: 'Free Megabytes'\n      }\n      {\n        counterName: '% Used Space'\n      }\n      {\n        counterName: 'Disk Transfers/sec'\n      }\n      {\n        counterName: 'Disk Reads/sec'\n      }\n      {\n        counterName: 'Disk Writes/sec'\n      }\n      {\n        counterName: 'Disk Read Bytes/sec'\n      }\n      {\n        counterName: 'Disk Write Bytes/sec'\n      }\n    ]\n    objectName: 'Logical Disk'\n    instanceName: '*'\n    intervalSeconds: 10\n  }\n}\n\nresource workspaceProcessorPerfCounters 'Microsoft.OperationalInsights/workspaces/dataSources@2020-08-01' = {\n  parent: workspace\n  name: 'ProcessorPerfCounters'\n  kind: 'LinuxPerformanceObject'\n  properties: {\n    performanceCounters: [\n      {\n        counterName: '% Processor Time'\n      }\n      {\n        counterName: '% User Time'\n      }\n      {\n        counterName: '% Privileged Time'\n      }\n      {\n        counterName: '% IO Wait Time'\n      }\n      {\n        counterName: '% Idle Time'\n      }\n      {\n        counterName: '% Interrupt Time'\n      }\n    ]\n    objectName: 'Processor'\n    instanceName: '*'\n    intervalSeconds: 10\n  }\n}\n\nresource workspaceProcessPerfCounters 'Microsoft.OperationalInsights/workspaces/dataSources@2020-08-01' = {\n  parent: workspace\n  name: 'ProcessPerfCounters'\n  kind: 'LinuxPerformanceObject'\n  properties: {\n    performanceCounters: [\n      {\n        counterName: '% User Time'\n      }\n      {\n        counterName: '% Privileged Time'\n      }\n      {\n        counterName: 'Used Memory'\n      }\n      {\n        counterName: 'Virtual Shared Memory'\n      }\n    ]\n    objectName: 'Process'\n    instanceName: '*'\n    intervalSeconds: 10\n  }\n}\n\nresource workspaceSystemPerfCounters 'Microsoft.OperationalInsights/workspaces/dataSources@2020-08-01' = {\n  parent: workspace\n  name: 'SystemPerfCounters'\n  kind: 'LinuxPerformanceObject'\n  properties: {\n    performanceCounters: [\n      {\n        counterName: 'Processes'\n      }\n    ]\n    objectName: 'System'\n    instanceName: '*'\n    intervalSeconds: 10\n  }\n}\n\nresource workspaceNetworkPerfCounters 'Microsoft.OperationalInsights/workspaces/dataSources@2020-08-01' = {\n  parent: workspace\n  name: 'NetworkPerfCounters'\n  kind: 'LinuxPerformanceObject'\n  properties: {\n    performanceCounters: [\n      {\n        counterName: 'Total Bytes Transmitted'\n      }\n      {\n        counterName: 'Total Bytes Received'\n      }\n      {\n        counterName: 'Total Bytes'\n      }\n      {\n        counterName: 'Total Packets Transmitted'\n      }\n      {\n        counterName: 'Total Packets Received'\n      }\n      {\n        counterName: 'Total Rx Errors'\n      }\n      {\n        counterName: 'Total Tx Errors'\n      }\n      {\n        counterName: 'Total Collisions'\n      }\n    ]\n    objectName: 'Network'\n    instanceName: '*'\n    intervalSeconds: 10\n  }\n}\n\nresource workspaceMemorydataSources 'Microsoft.OperationalInsights/workspaces/dataSources@2020-08-01' = {\n  parent: workspace\n  name: 'MemorydataSources'\n  kind: 'LinuxPerformanceObject'\n  properties: {\n    performanceCounters: [\n      {\n        counterName: 'Available MBytes Memory'\n      }\n      {\n        counterName: '% Available Memory'\n      }\n      {\n        counterName: 'Used Memory MBytes'\n      }\n      {\n        counterName: '% Used Memory'\n      }\n    ]\n    objectName: 'Memory'\n    instanceName: '*'\n    intervalSeconds: 10\n  }\n}\n\nresource workspaceSampleLinuxPerfCollection1 'Microsoft.OperationalInsights/workspaces/dataSources@2020-08-01' = {\n  parent: workspace\n  name: 'SampleLinuxPerfCollection1'\n  kind: 'LinuxPerformanceCollection'\n  properties: {\n    state: 'Enabled'\n  }\n}\n\nresource adlsPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: adlsPrivateDnsZoneName\n  location: 'global'\n}\n\nresource adlsPrivateDnsZoneLinkToHubVnet 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: adlsPrivateDnsZone\n  name: 'link_to_${toLower(hubVnetName)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: hubVnet.id\n    }\n  }\n}\n\nresource blobPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: blobPrivateDnsZoneName\n  location: 'global'\n}\n\nresource blobPrivateDnsZoneLinkToHubVnet 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: blobPrivateDnsZone\n  name: 'link_to_${toLower(hubVnetName)}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: hubVnet.id\n    }\n  }\n}\n\nresource adlsStorageAccountAdlsPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-09-01' = {\n  name: adlsStorageAccountAdlsPrivateEndpointName\n  location: location\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: adlsStorageAccountAdlsPrivateEndpointName\n        properties: {\n          privateLinkServiceId: adlsStorageAccountId\n          groupIds: [\n            adlsGroupName\n          ]\n        }\n      }\n    ]\n    subnet: {\n      id: hubVnetCommonSubnetId\n    }\n  }\n  dependsOn: [\n    hubVnet\n  ]\n}\n\nresource adlsStorageAccountAdlsPrivateEndpointPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-09-01' = {\n  parent: adlsStorageAccountAdlsPrivateEndpoint\n  name: 'PrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'dnsConfig'\n        properties: {\n          privateDnsZoneId: adlsPrivateDnsZoneId\n        }\n      }\n    ]\n  }\n}\n\nresource adlsStorageAccountBlobPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-09-01' = {\n  name: adlsStorageAccountBlobPrivateEndpointName\n  location: location\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: adlsStorageAccountBlobPrivateEndpointName\n        properties: {\n          privateLinkServiceId: adlsStorageAccountId\n          groupIds: [\n            blobGroupName\n          ]\n        }\n      }\n    ]\n    subnet: {\n      id: hubVnetCommonSubnetId\n    }\n  }\n  dependsOn: [\n    hubVnet\n  ]\n}\n\nresource adlsStorageAccountBlobPrivateEndpointPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-09-01' = {\n  parent: adlsStorageAccountBlobPrivateEndpoint\n  name: 'PrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'dnsConfig'\n        properties: {\n          privateDnsZoneId: blobPrivateDnsZoneId\n        }\n      }\n    ]\n  }\n}\n\nresource blobStorageAccountBlobPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-09-01' = {\n  name: blobStorageAccountBlobPrivateEndpointName\n  location: location\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: blobStorageAccountBlobPrivateEndpointName\n        properties: {\n          privateLinkServiceId: blobStorageAccountId\n          groupIds: [\n            blobGroupName\n          ]\n        }\n      }\n    ]\n    subnet: {\n      id: hubVnetCommonSubnetId\n    }\n  }\n  dependsOn: [\n    hubVnet\n  ]\n}\n\nresource blobStorageAccountBlobPrivateEndpointPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2023-09-01' = {\n  parent: blobStorageAccountBlobPrivateEndpoint\n  name: 'PrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'dnsConfig'\n        properties: {\n          privateDnsZoneId: blobPrivateDnsZoneId\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1190."}, {"role": "assistant", "content": "@description('Username for client and server Virtual Machines.')\nparam adminUsername string\n\n@description('Password for client and server Virtual Machines.')\n@secure()\nparam adminPassword string\n\n@description('Location for all resources, the location must support Availability Zones if required.')\nparam location string = resourceGroup().location\n\n@description('Size of client and server VMs.')\nparam vmSize string = 'Standard_D2s_v3'\nparam routeTableName string = 'route-table'\nparam virtualNetworkName string = 'vnet'\nparam clientVirtualMachineName string = 'client-vm'\nparam serverVirtualMachineName string = 'server-vm'\nparam firewallPublicIpName string = 'fw-pip'\nparam clientPublicIpName string = 'client-pip'\nparam serverPublicIpName string = 'server-pip'\nparam firewallName string = 'firewall'\nparam clientNetworkInterfaceName string = 'client-nic'\nparam serverNetworkInterfaceName string = 'server-nic'\nparam networkSecurityGroupName string = 'vnet-nsg'\n\nvar vnetAddressPrefix = '10.0.0.0/16'\nvar serversSubnetPrefix = '10.0.2.0/24'\nvar serverPrefix = '10.0.2.4/32'\nvar clientPrefix = '10.0.2.5/32'\nvar azureFirewallSubnetPrefix = '10.0.1.0/26'\nvar firewallPrivateIP = '10.0.1.4'\nvar serverPrivateIP = '10.0.2.4'\nvar clientPrivateIP = '10.0.2.5'\n\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\n  name: networkSecurityGroupName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'ssh-allow'\n        properties: {\n          protocol: 'TCP'\n          sourcePortRange: '*'\n          destinationPortRange: '22'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 100\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource clientPublicIp 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\n  name: clientPublicIpName\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource firewallPublicIp 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\n  name: firewallPublicIpName\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource serverPublicIp 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\n  name: serverPublicIpName\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource routeTable 'Microsoft.Network/routeTables@2023-09-01' = {\n  name: routeTableName\n  location: location\n  properties: {\n    routes: [\n      {\n        name: 'to-server'\n        properties: {\n          addressPrefix: serverPrefix\n          nextHopType: 'VirtualAppliance'\n          nextHopIpAddress: firewallPrivateIP\n        }\n      }\n      {\n        name: 'to-client'\n        properties: {\n          addressPrefix: clientPrefix\n          nextHopType: 'VirtualAppliance'\n          nextHopIpAddress: firewallPrivateIP\n        }\n      }\n    ]\n  }\n}\n\nresource clientVirtualMachine 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: clientVirtualMachineName\n  location: location\n  tags: { \n    AzSecPackAutoConfigReady: true \n  }\n  zones: [\n    '1'\n  ]\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftCBLMariner'\n        offer: 'cbl-mariner'\n        sku: 'cbl-mariner-2-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        osType: 'Linux'\n        name: '${clientVirtualMachineName}-osdisk'\n        createOption: 'FromImage'\n        caching: 'ReadWrite'\n        deleteOption: 'Delete'\n        diskSizeGB: 30\n      }\n    }\n    osProfile: {\n      computerName: clientVirtualMachineName\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      linuxConfiguration:{\n          patchSettings: { \n          patchMode: 'AutomaticByPlatform'\n          }\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: clientNetworkInterface.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n      }\n    }\n  }\n}\n\nresource serverVirtualMachine 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: serverVirtualMachineName\n  location: location\n  tags: { \n    AzSecPackAutoConfigReady: true \n  }\n  zones: [\n    '1'\n  ]\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftCBLMariner'\n        offer: 'cbl-mariner'\n        sku: 'cbl-mariner-2-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        osType: 'Linux'\n        name: '${serverVirtualMachineName}-osdisk'\n        createOption: 'FromImage'\n        caching: 'ReadWrite'\n        deleteOption: 'Delete'\n        diskSizeGB: 30\n      }\n    }\n    osProfile: {\n      computerName: serverVirtualMachineName\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      linuxConfiguration:{\n          patchSettings: { \n          patchMode: 'AutomaticByPlatform'\n          }\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: serverNetworkInterface.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n      }\n    }\n  }\n}\n\nresource toClientRoute 'Microsoft.Network/routeTables/routes@2023-09-01' = {\n  parent: routeTable\n  name: 'to-client'\n  properties: {\n    addressPrefix: clientPrefix\n    nextHopType: 'VirtualAppliance'\n    nextHopIpAddress: firewallPrivateIP\n  }\n}\n\nresource toServerRoute 'Microsoft.Network/routeTables/routes@2023-09-01' = {\n  parent: routeTable\n  name: 'to-server'\n  properties: {\n    addressPrefix: serverPrefix\n    nextHopType: 'VirtualAppliance'\n    nextHopIpAddress: firewallPrivateIP\n  }\n}\n\nresource firewall 'Microsoft.Network/azureFirewalls@2023-09-01' = {\n  name: firewallName\n  location: location\n  properties: {\n    sku: {\n      name: 'AZFW_VNet'\n      tier: 'Standard'\n    }\n    threatIntelMode: 'Alert'\n    ipConfigurations: [\n      {\n        name: 'fw-pip'\n        properties: {\n          publicIPAddress: {\n            id: firewallPublicIp.id\n          }\n          subnet: {\n            id: firewallSubnet.id\n          }\n        }\n      }\n    ]\n    networkRuleCollections: [\n      {\n        name: 'net-col'\n        properties: {\n          priority: 100\n          action: {\n            type: 'Allow'\n          }\n          rules: [\n            {\n              name: 'allow-all'\n              protocols: [\n                'Any'\n              ]\n              sourceAddresses: [\n                '*'\n              ]\n              destinationAddresses: [\n                '*'\n              ]\n              destinationPorts: [\n                '*'\n              ]\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource clientNetworkInterface 'Microsoft.Network/networkInterfaces@2023-09-01' = {\n  name: clientNetworkInterfaceName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAddress: clientPrivateIP\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: clientPublicIp.id\n          }\n          subnet: {\n            id: serverSubnet.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2023-09-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: 'AzureFirewallSubnet'\n        properties: {\n          addressPrefix: azureFirewallSubnetPrefix\n        }\n      }\n      {\n        name: 'ServerSubnet'\n        properties: {\n          addressPrefix: serversSubnetPrefix\n          networkSecurityGroup: {\n            id: networkSecurityGroup.id\n          }\n          routeTable: {\n            id: routeTable.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource firewallSubnet 'Microsoft.Network/virtualNetworks/subnets@2023-09-01' = {\n  parent: virtualNetwork\n  name: 'AzureFirewallSubnet'\n  properties: {\n    addressPrefix: azureFirewallSubnetPrefix\n  }\n}\n\nresource serverNetworkInterface 'Microsoft.Network/networkInterfaces@2023-09-01' = {\n  name: serverNetworkInterfaceName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAddress: serverPrivateIP\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: serverPublicIp.id\n          }\n          subnet: {\n            id: serverSubnet.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource serverSubnet 'Microsoft.Network/virtualNetworks/subnets@2023-09-01' = {\n  parent: virtualNetwork\n  name: 'ServerSubnet'\n  properties: {\n    addressPrefix: serversSubnetPrefix\n    networkSecurityGroup: {\n      id: networkSecurityGroup.id\n    }\n    routeTable: {\n      id: routeTable.id\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1191?"}, {"role": "assistant", "content": "@description('Virtual network name')\nparam virtualNetworkName string = 'vnet${uniqueString(resourceGroup().id)}'\n\n@description('Azure Firewall name')\nparam firewallName string = 'fw${uniqueString(resourceGroup().id)}'\n\n@description('Number of public IP addresses for the Azure Firewall')\n@minValue(1)\n@maxValue(100)\nparam numberOfPublicIPAddresses int = 2\n\n@description('Zone numbers e.g. 1,2,3.')\nparam availabilityZones array = []\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\nparam infraIpGroupName string = '${location}-infra-ipgroup-${uniqueString(resourceGroup().id)}'\nparam workloadIpGroupName string = '${location}-workload-ipgroup-${uniqueString(resourceGroup().id)}'\nparam firewallPolicyName string = '${firewallName}-firewallPolicy'\n\nvar vnetAddressPrefix = '10.10.0.0/24'\nvar azureFirewallSubnetPrefix = '10.10.0.0/25'\nvar publicIPNamePrefix = 'publicIP'\nvar azurepublicIpname = publicIPNamePrefix\nvar azureFirewallSubnetName = 'AzureFirewallSubnet'\nvar azureFirewallSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, azureFirewallSubnetName)\nvar azureFirewallPublicIpId = resourceId('Microsoft.Network/publicIPAddresses', publicIPNamePrefix)\nvar azureFirewallIpConfigurations = [for i in range(0, numberOfPublicIPAddresses): {\n  name: 'IpConf${i}'\n  properties: {\n    subnet: ((i == 0) ? json('{\"id\": \"${azureFirewallSubnetId}\"}') : json('null'))\n    publicIPAddress: {\n      id: '${azureFirewallPublicIpId}${i + 1}'\n    }\n  }\n}]\n\nresource workloadIpGroup 'Microsoft.Network/ipGroups@2022-01-01' = {\n  name: workloadIpGroupName\n  location: location\n  properties: {\n    ipAddresses: [\n      '10.20.0.0/24'\n      '10.30.0.0/24'\n    ]\n  }\n}\n\nresource infraIpGroup 'Microsoft.Network/ipGroups@2022-01-01' = {\n  name: infraIpGroupName\n  location: location\n  properties: {\n    ipAddresses: [\n      '10.40.0.0/24'\n      '10.50.0.0/24'\n    ]\n  }\n}\n\nresource vnet 'Microsoft.Network/virtualNetworks@2022-01-01' = {\n  name: virtualNetworkName\n  location: location\n  tags: {\n    displayName: virtualNetworkName\n  }\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: azureFirewallSubnetName\n        properties: {\n          addressPrefix: azureFirewallSubnetPrefix\n        }\n      }\n    ]\n    enableDdosProtection: false\n  }\n}\n\nresource publicIpAddress 'Microsoft.Network/publicIPAddresses@2022-01-01' = [for i in range(0, numberOfPublicIPAddresses): {\n  name: '${azurepublicIpname}${i + 1}'\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    publicIPAddressVersion: 'IPv4'\n  }\n}]\n\nresource firewallPolicy 'Microsoft.Network/firewallPolicies@2022-01-01'= {\n  name: firewallPolicyName\n  location: location\n  properties: {\n    threatIntelMode: 'Alert'\n  }\n}\n\nresource networkRuleCollectionGroup 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2022-01-01' = {\n  parent: firewallPolicy\n  name: 'DefaultNetworkRuleCollectionGroup'\n  properties: {\n    priority: 200\n    ruleCollections: [\n      {\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        action: {\n          type: 'Allow'\n        }\n        name: 'azure-global-services-nrc'\n        priority: 1250\n        rules: [\n          {\n            ruleType: 'NetworkRule'\n            name: 'time-windows'\n            ipProtocols: [\n              'UDP'\n            ]\n            destinationAddresses: [\n              '13.86.101.172'\n            ]\n            sourceIpGroups: [\n              workloadIpGroup.id\n              infraIpGroup.id\n            ]\n            destinationPorts: [\n              '123'\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n\nresource applicationRuleCollectionGroup 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2022-01-01' = {\n  parent: firewallPolicy\n  name: 'DefaultApplicationRuleCollectionGroup'\n  dependsOn: [\n    networkRuleCollectionGroup\n  ]\n  properties: {\n    priority: 300\n    ruleCollections: [\n      {\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        name: 'global-rule-url-arc'\n        priority: 1000\n        action: {\n          type: 'Allow'\n        }\n        rules: [\n          {\n            ruleType: 'ApplicationRule'\n            name: 'winupdate-rule-01'\n            protocols: [\n              {\n                protocolType: 'Https'\n                port: 443\n              }\n              {\n                protocolType: 'Http'\n                port: 80\n              }\n            ]\n            fqdnTags: [\n              'WindowsUpdate'\n            ]\n            terminateTLS: false\n            sourceIpGroups: [\n              workloadIpGroup.id\n              infraIpGroup.id\n            ]\n          }\n        ]\n      }\n      {\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        action: {\n          type: 'Allow'\n        }\n        name: 'Global-rules-arc'\n        priority: 1202\n        rules: [\n          {\n            ruleType: 'ApplicationRule'\n            name: 'global-rule-01'\n            protocols: [\n              {\n                protocolType: 'Https'\n                port: 443\n              }\n            ]\n            targetFqdns: [\n              'www.microsoft.com'\n            ]\n            terminateTLS: false\n            sourceIpGroups: [\n              workloadIpGroup.id\n              infraIpGroup.id\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n\nresource firewall 'Microsoft.Network/azureFirewalls@2021-03-01' = {\n  name: firewallName\n  location: location\n  zones: ((length(availabilityZones) == 0) ? null : availabilityZones)\n  dependsOn: [\n    vnet\n    publicIpAddress\n    workloadIpGroup\n    infraIpGroup\n    networkRuleCollectionGroup\n    applicationRuleCollectionGroup\n  ]\n  properties: {\n    ipConfigurations: azureFirewallIpConfigurations\n    firewallPolicy: {\n      id: firewallPolicy.id\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1192."}, {"role": "assistant", "content": "@description('virtual network name')\nparam virtualNetworkName string = 'vnet${uniqueString(resourceGroup().id)}'\nparam ipgroups_name1 string = 'ipgroup1${uniqueString(resourceGroup().id)}'\nparam ipgroups_name2 string = 'ipgroup2${uniqueString(resourceGroup().id)}'\n\n@description('Username for the Virtual Machine.')\nparam adminUsername string\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Zone numbers e.g. 1,2,3.')\nparam vmSize string = 'Standard_D2s_v3'\n\n@description('Number of public IP addresses for the Azure Firewall')\n@minValue(1)\n@maxValue(100)\nparam numberOfFirewallPublicIPAddresses int = 1\n\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\n@allowed([\n  'sshPublicKey'\n  'password'\n])\nparam authenticationType string = 'sshPublicKey'\n\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\n@secure()\nparam adminPasswordOrKey string\n\nvar vnetAddressPrefix = '10.0.0.0/16'\nvar serversSubnetPrefix = '10.0.2.0/24'\nvar azureFirewallSubnetPrefix = '10.0.1.0/24'\nvar jumpboxSubnetPrefix = '10.0.0.0/24'\nvar nextHopIP = '10.0.1.4'\nvar azureFirewallSubnetName = 'AzureFirewallSubnet'\nvar jumpBoxSubnetName = 'JumpboxSubnet'\nvar serversSubnetName = 'ServersSubnet'\nvar jumpBoxPublicIPAddressName = 'JumpHostPublicIP'\nvar jumpBoxNsgName = 'JumpHostNSG'\nvar jumpBoxNicName = 'JumpHostNic'\nvar jumpBoxSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, jumpBoxSubnetName)\nvar serverNicName = 'ServerNic'\nvar serverSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, serversSubnetName)\nvar storageAccountName = '${uniqueString(resourceGroup().id)}sajumpbox'\nvar azfwRouteTableName = 'AzfwRouteTable'\nvar firewallName = 'firewall1'\nvar publicIPNamePrefix = 'publicIP'\nvar azureFirewallSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, azureFirewallSubnetName)\nvar linuxConfiguration = {\n  disablePasswordAuthentication: true\n  ssh: {\n    publicKeys: [\n      {\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\n        keyData: adminPasswordOrKey\n      }\n    ]\n  }\n  patchSettings: {\n      patchMode: 'AutomaticByPlatform'\n  }\n}\nvar networkSecurityGroupName = '${serversSubnetName}-nsg'\nvar azureFirewallIpConfigurations = [for i in range(0, numberOfFirewallPublicIPAddresses): {\n  name: 'IpConf${i}'\n  properties: {\n    subnet: {\n      id: (i == 0) ? azureFirewallSubnetId : null\n    }\n    publicIPAddress: {\n      id: publicIP[i].id\n    }\n  }\n}]\n\nresource ipgroup1 'Microsoft.Network/ipGroups@2023-09-01' = {\n  name: ipgroups_name1\n  location: location\n  properties: {\n    ipAddresses: [\n      '13.73.64.64/26'\n      '13.73.208.128/25'\n      '52.126.194.0/23'\n    ]\n  }\n}\n\nresource ipgroup2 'Microsoft.Network/ipGroups@2023-09-01' = {\n  name: ipgroups_name2\n  location: location\n  properties: {\n    ipAddresses: [\n      '12.0.0.0/24'\n      '13.9.0.0/24'\n    ]\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'StorageV2'\n  properties: {}\n}\n\nresource azfwRouteTable 'Microsoft.Network/routeTables@2023-09-01' = {\n  name: azfwRouteTableName\n  location: location\n  properties: {\n    disableBgpRoutePropagation: false\n    routes: [\n      {\n        name: 'AzfwDefaultRoute'\n        properties: {\n          addressPrefix: '0.0.0.0/0'\n          nextHopType: 'VirtualAppliance'\n          nextHopIpAddress: nextHopIP\n        }\n      }\n    ]\n  }\n}\n\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\n  name: networkSecurityGroupName\n  location: location\n  properties: {}\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2023-09-01' = {\n  name: virtualNetworkName\n  location: location\n  tags: {\n    displayName: virtualNetworkName\n  }\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: jumpBoxSubnetName\n        properties: {\n          addressPrefix: jumpboxSubnetPrefix\n        }\n      }\n      {\n        name: azureFirewallSubnetName\n        properties: {\n          addressPrefix: azureFirewallSubnetPrefix\n        }\n      }\n      {\n        name: serversSubnetName\n        properties: {\n          addressPrefix: serversSubnetPrefix\n          routeTable: {\n            id: azfwRouteTable.id\n          }\n          networkSecurityGroup: {\n            id: networkSecurityGroup.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource publicIP 'Microsoft.Network/publicIPAddresses@2023-09-01' = [for i in range(0, numberOfFirewallPublicIPAddresses): {\n  name: '${publicIPNamePrefix}${i + 1}'\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    publicIPAddressVersion: 'IPv4'\n  }\n}]\n\nresource jumpBoxPublicIPAddress 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\n  name: jumpBoxPublicIPAddressName\n  location: location\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n\nresource jumpBoxNsg 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\n  name: jumpBoxNsgName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'myNetworkSecurityGroupRuleSSH'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '22'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 1000\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource JumpBoxNic 'Microsoft.Network/networkInterfaces@2023-09-01' = {\n  name: jumpBoxNicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: jumpBoxPublicIPAddress.id\n          }\n          subnet: {\n            id: jumpBoxSubnetId\n          }\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: jumpBoxNsg.id\n    }\n  }\n  dependsOn: [\n    virtualNetwork\n  ]\n}\n\nresource ServerNic 'Microsoft.Network/networkInterfaces@2023-09-01' = {\n  name: serverNicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: serverSubnetId\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    virtualNetwork\n  ]\n}\n\nresource JumpBoxVm 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: 'JumpBox'\n  location: location\n  tags: {\n      AzSecPackAutoConfigReady: true\n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftCBLMariner'\n        offer: 'cbl-mariner'\n        sku: 'cbl-mariner-2-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n      }\n    }\n    osProfile: {\n      computerName: 'JumpBox'\n      adminUsername: adminUsername\n      adminPassword: adminPasswordOrKey\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: JumpBoxNic.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: storageAccount.properties.primaryEndpoints.blob\n      }\n    }\n  }\n}\n\nresource ServerVm 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: 'Server'\n  location: location\n  tags: {\n      AzSecPackAutoConfigReady: true\n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftCBLMariner'\n        offer: 'cbl-mariner'\n        sku: 'cbl-mariner-2-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n      }\n    }\n    osProfile: {\n      computerName: 'Server'\n      adminUsername: adminUsername\n      adminPassword: adminPasswordOrKey\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: ServerNic.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: storageAccount.properties.primaryEndpoints.blob\n      }\n    }\n  }\n}\n\nresource firewall 'Microsoft.Network/azureFirewalls@2023-09-01' = {\n  name: firewallName\n  location: location\n  dependsOn: [\n    virtualNetwork\n    publicIP\n  ]\n  properties: {\n    ipConfigurations: azureFirewallIpConfigurations\n    applicationRuleCollections: [\n      {\n        name: 'appRc1'\n        properties: {\n          priority: 101\n          action: {\n            type: 'Allow'\n          }\n          rules: [\n            {\n              name: 'someAppRule'\n              protocols: [\n                {\n                  protocolType: 'Http'\n                  port: 8080\n                }\n              ]\n              targetFqdns: [\n                '*bing.com'\n              ]\n              sourceIpGroups: [\n                ipgroup1.id\n              ]\n            }\n            {\n              name: 'someOtherAppRule'\n              protocols: [\n                {\n                  protocolType: 'Mssql'\n                  port: 1433\n                }\n              ]\n              targetFqdns: [\n                'sql1${environment().suffixes.sqlServerHostname}'\n              ]\n              sourceIpGroups: [\n                ipgroup1.id\n                ipgroup2.id\n              ]\n            }\n          ]\n        }\n      }\n    ]\n    networkRuleCollections: [\n      {\n        name: 'netRc1'\n        properties: {\n          priority: 200\n          action: {\n            type: 'Allow'\n          }\n          rules: [\n            {\n              name: 'networkRule'\n              description: 'desc1'\n              protocols: [\n                'UDP'\n                'TCP'\n                'ICMP'\n              ]\n              sourceAddresses: [\n                '10.0.0.0'\n                '111.1.0.0/23'\n              ]\n              sourceIpGroups: [\n                ipgroup1.id\n              ]\n              destinationIpGroups: [\n                ipgroup2.id\n              ]\n              destinationPorts: [\n                '90'\n              ]\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n\noutput location string = location\noutput name string = firewall.name\noutput resourceGroupName string = resourceGroup().name\noutput resourceId string = firewall.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1193."}, {"role": "assistant", "content": "@description('Size of virtual machine sizes')\nparam vmSize string = 'Standard_B2s'\n\n@description('Username for remote access')\nparam remoteAccessUsername string\n\n@description('Password for remote access')\n@secure()\nparam remoteAccessPassword string\n\n@description('The Windows version for the VM. This will pick a fully patched image of this given Windows version.')\n@allowed([\n  '2016-datacenter-gensecond'\n  '2016-datacenter-server-core-g2'\n  '2016-datacenter-server-core-smalldisk-g2'\n  '2016-datacenter-smalldisk-g2'\n  '2016-datacenter-with-containers-g2'\n  '2016-datacenter-zhcn-g2'\n  '2019-datacenter-core-g2'\n  '2019-datacenter-core-smalldisk-g2'\n  '2019-datacenter-core-with-containers-g2'\n  '2019-datacenter-core-with-containers-smalldisk-g2'\n  '2019-datacenter-gensecond'\n  '2019-datacenter-smalldisk-g2'\n  '2019-datacenter-with-containers-g2'\n  '2019-datacenter-with-containers-smalldisk-g2'\n  '2019-datacenter-zhcn-g2'\n  '2022-datacenter-azure-edition'\n  '2022-datacenter-azure-edition-core'\n  '2022-datacenter-azure-edition-core-smalldisk'\n  '2022-datacenter-azure-edition-smalldisk'\n  '2022-datacenter-core-g2'\n  '2022-datacenter-core-smalldisk-g2'\n  '2022-datacenter-g2'\n  '2022-datacenter-smalldisk-g2'\n])\nparam OSVersion string = '2022-datacenter-azure-edition'\n\n@description('Secure Boot setting of the virtual machine.')\nparam secureBoot bool = true\n\n@description('vTPM setting of the virtual machine.')\nparam vTPM bool = true\n\n@description('Deployment location')\nparam location string = resourceGroup().location\n\n@description('Intruder Detection - Signature Overrodes Id 1')\nparam sigOverrideParam1 string = '2024897'\n\n@description('Intruder Detection - Signature Overrodes Id 2')\nparam sigOverrideParam2 string = '2024898'\n\nvar vnetAddressSpace = '10.0.0.0/16'\nvar workerAddressSpace = '10.0.10.0/24'\nvar workerPrivateIPAddress = '10.0.10.10'\nvar bastionAddressSpace = '10.0.20.0/24'\nvar firewallAddressSpace = '10.0.100.0/24'\nvar firewallPrivateIPAddress = '10.0.100.4'\nvar keyVaultName = 'fw-quick-${uniqueString(subscription().id, resourceGroup().id)}'\nvar keyVaultCASecretName = 'CACert'\nvar extensionName = 'GuestAttestation'\nvar extensionPublisher = 'Microsoft.Azure.Security.WindowsAttestation'\nvar extensionVersion = '1.0'\nvar maaTenantName = 'GuestAttestation'\n\nresource CreateAndDeployCertificates 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\n  name: 'CreateAndDeployCertificates'\n  location: location\n  kind: 'AzurePowerShell'\n  properties: {\n    forceUpdateTag: '2'\n    azPowerShellVersion: '3.0'\n    scriptContent: '# Write the config to file\\n$opensslConfig=@\\'\\n[ req ]\\ndefault_bits        = 4096\\ndistinguished_name  = req_distinguished_name\\nstring_mask         = utf8only\\ndefault_md          = sha512\\n\\n[ req_distinguished_name ]\\ncountryName                     = Country Name (2 letter code)\\nstateOrProvinceName             = State or Province Name\\nlocalityName                    = Locality Name\\n0.organizationName              = Organization Name\\norganizationalUnitName          = Organizational Unit Name\\ncommonName                      = Common Name\\nemailAddress                    = Email Address\\n\\n[ rootCA_ext ]\\nsubjectKeyIdentifier = hash\\nauthorityKeyIdentifier = keyid:always,issuer\\nbasicConstraints = critical, CA:true\\nkeyUsage = critical, digitalSignature, cRLSign, keyCertSign\\n\\n[ interCA_ext ]\\nsubjectKeyIdentifier = hash\\nauthorityKeyIdentifier = keyid:always,issuer\\nbasicConstraints = critical, CA:true, pathlen:1\\nkeyUsage = critical, digitalSignature, cRLSign, keyCertSign\\n\\n[ server_ext ]\\nsubjectKeyIdentifier = hash\\nauthorityKeyIdentifier = keyid:always,issuer\\nbasicConstraints = critical, CA:false\\nkeyUsage = critical, digitalSignature\\nextendedKeyUsage = serverAuth\\n\\'@\\n\\nSet-Content -Path openssl.cnf -Value $opensslConfig\\n\\n# Create root CA\\nopenssl req -x509 -new -nodes -newkey rsa:4096 -keyout rootCA.key -sha256 -days 3650 -out rootCA.crt -subj \\'/C=US/ST=US/O=Self Signed/CN=Self Signed Root CA\\' -config openssl.cnf -extensions rootCA_ext\\n\\n# Create intermediate CA request\\nopenssl req -new -nodes -newkey rsa:4096 -keyout interCA.key -sha256 -out interCA.csr -subj \\'/C=US/ST=US/O=Self Signed/CN=Self Signed Intermediate CA\\'\\n\\n# Sign on the intermediate CA\\nopenssl x509 -req -in interCA.csr -CA rootCA.crt -CAkey rootCA.key -CAcreateserial -out interCA.crt -days 3650 -sha256 -extfile openssl.cnf -extensions interCA_ext\\n\\n# Export the intermediate CA into PFX\\nopenssl pkcs12 -export -out interCA.pfx -inkey interCA.key -in interCA.crt -password \\'pass:\\'\\n\\n# Convert the PFX and public key into base64\\n$interCa = [Convert]::ToBase64String((Get-Content -Path interCA.pfx -AsByteStream -Raw))\\n$rootCa = [Convert]::ToBase64String((Get-Content -Path rootCA.crt -AsByteStream -Raw))\\n\\n# Assign outputs\\n$DeploymentScriptOutputs = @{}\\n$DeploymentScriptOutputs[\\'interca\\'] = $interCa\\n$DeploymentScriptOutputs[\\'rootca\\'] = $rootCa\\n'\n    timeout: 'PT5M'\n    cleanupPreference: 'OnSuccess'\n    retentionInterval: 'P1D'\n  }\n}\n\nresource DemoIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\n  name: 'DemoIdentity'\n  location: location\n}\n\nresource keyVault 'Microsoft.KeyVault/vaults@2019-09-01' = {\n  name: keyVaultName\n  location: location\n  properties: {\n    enabledForDeployment: false\n    enabledForDiskEncryption: false\n    enabledForTemplateDeployment: false\n    tenantId: subscription().tenantId\n    accessPolicies: [\n      {\n        objectId: DemoIdentity.properties.principalId\n        tenantId: DemoIdentity.properties.tenantId\n        permissions: {\n          secrets: [\n            'get'\n            'list'\n          ]\n        }\n      }\n    ]\n    sku: {\n      name: 'standard'\n      family: 'A'\n    }\n  }\n}\n\nresource keyVaultName_keyVaultCASecret 'Microsoft.KeyVault/vaults/secrets@2019-09-01' = {\n  parent: keyVault\n  name: keyVaultCASecretName\n  location: location\n  properties: {\n    value: CreateAndDeployCertificates.properties.outputs.interca\n  }\n}\n\nresource WorkerRoute 'Microsoft.Network/routeTables@2020-05-01' = {\n  name: 'WorkerRoute'\n  location: location\n  properties: {\n    routes: [\n      {\n        name: 'WorkerRouteFirewall'\n        properties: {\n          addressPrefix: '0.0.0.0/0'\n          nextHopType: 'VirtualAppliance'\n          nextHopIpAddress: firewallPrivateIPAddress\n        }\n      }\n    ]\n    disableBgpRoutePropagation: false\n  }\n}\n\nresource DemoVnet 'Microsoft.Network/virtualNetworks@2020-07-01' = {\n  name: 'DemoVnet'\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressSpace\n      ]\n    }\n    subnets: [\n      {\n        name: 'WorkerSubnet'\n        properties: {\n          addressPrefix: workerAddressSpace\n          routeTable: {\n            id: WorkerRoute.id\n          }\n        }\n      }\n      {\n        name: 'AzureBastionSubnet'\n        properties: {\n          addressPrefix: bastionAddressSpace\n        }\n      }\n      {\n        name: 'AzureFirewallSubnet'\n        properties: {\n          addressPrefix: firewallAddressSpace\n        }\n      }\n    ]\n  }\n}\n\nresource WorkerNIC 'Microsoft.Network/networkInterfaces@2020-07-01' = {\n  name: 'WorkerNIC'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'WorkerIPConfiguration'\n        properties: {\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', 'DemoVnet', 'WorkerSubnet')\n          }\n          privateIPAllocationMethod: 'Static'\n          privateIPAddress: workerPrivateIPAddress\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    DemoVnet\n  ]\n}\n\nresource WorkerVM 'Microsoft.Compute/virtualMachines@2021-03-01' = {\n  name: 'WorkerVM'\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: OSVersion\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n      }\n    }\n    osProfile: {\n      computerName: 'WorkerVM'\n      adminUsername: remoteAccessUsername\n      adminPassword: remoteAccessPassword\n    }\n    securityProfile: {\n      uefiSettings: {\n        secureBootEnabled: secureBoot\n        vTpmEnabled: vTPM\n      }\n      securityType: 'TrustedLaunch'\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: WorkerNIC.id\n        }\n      ]\n    }\n  }\n}\n\nresource WorkerVM_extension 'Microsoft.Compute/virtualMachines/extensions@2022-03-01' = if (vTPM && secureBoot) {\n  parent: WorkerVM\n  name: extensionName\n  location: location\n  properties: {\n    publisher: extensionPublisher\n    type: extensionName\n    typeHandlerVersion: extensionVersion\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      AttestationConfig: {\n        MaaSettings: {\n          maaEndpoint: ''\n          maaTenantName: maaTenantName\n        }\n        AscSettings: {\n          ascReportingEndpoint: ''\n          ascReportingFrequency: ''\n        }\n        useCustomToken: 'false'\n        disableAlerts: 'false'\n      }\n    }\n  }\n}\n\nresource WorkerVM_Bootstrap 'Microsoft.Compute/virtualMachines/extensions@2020-06-01' = {\n  parent: WorkerVM\n  name: 'Bootstrap'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Compute'\n    type: 'CustomScriptExtension'\n    typeHandlerVersion: '1.7'\n    autoUpgradeMinorVersion: true\n    settings: {\n      commandToExecute: 'echo ${CreateAndDeployCertificates.properties.outputs.rootca} > c:\\\\root.pem.base64 && powershell \"Set-Content -Path c:\\\\root.pem -Value ([Text.Encoding]::UTF8.GetString([convert]::FromBase64String((Get-Content -Path c:\\\\root.pem.base64))))\" && certutil -addstore root c:\\\\root.pem'\n    }\n  }\n}\n\nresource BastionPublicIP 'Microsoft.Network/publicIpAddresses@2020-07-01' = {\n  name: 'BastionPublicIP'\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource DemoBastion 'Microsoft.Network/bastionHosts@2020-07-01' = {\n  name: 'DemoBastion'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'BastionIpConfiguration'\n        properties: {\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', 'DemoVnet', 'AzureBastionSubnet')\n          }\n          publicIPAddress: {\n            id: BastionPublicIP.id\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    DemoVnet\n\n  ]\n}\n\nresource FirewallPublicIP 'Microsoft.Network/publicIpAddresses@2020-07-01' = {\n  name: 'FirewallPublicIP'\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource DemoFirewallPolicy 'Microsoft.Network/firewallPolicies@2020-07-01' = {\n  name: 'DemoFirewallPolicy'\n  location: location\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${DemoIdentity.id}': {}\n    }\n  }\n  properties: {\n    sku: {\n      tier: 'Premium'\n    }\n    transportSecurity: {\n      certificateAuthority: {\n        name: keyVaultCASecretName\n        keyVaultSecretId: '${keyVault.properties.vaultUri}secrets/${keyVaultCASecretName}/'\n      }\n    }\n    intrusionDetection: {\n      mode: 'Alert'\n      configuration: {\n        signatureOverrides: [\n          {\n            id: sigOverrideParam1\n            mode: 'Deny'\n          }\n          {\n            id: sigOverrideParam2\n            mode: 'Alert'\n          }\n        ]\n        bypassTrafficSettings: [\n          {\n            name: 'SecretBypass'\n            protocol: 'TCP'\n            sourceAddresses: [\n              '*'\n            ]\n            destinationAddresses: [\n              '1.1.1.1'\n            ]\n            destinationPorts: [\n              '80'\n            ]\n          }\n        ]\n      }\n    }\n  }\n  dependsOn: [\n    keyVaultName_keyVaultCASecret\n\n  ]\n}\n\nresource DemoFirewallPolicy_PolicyRules 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2020-07-01' = {\n  parent: DemoFirewallPolicy\n  name: 'PolicyRules'\n  location: location\n  properties: {\n    priority: 200\n    ruleCollections: [\n      {\n        name: 'AllowWeb'\n        priority: 101\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        action: {\n          type: 'Allow'\n        }\n        rules: [\n          {\n            ruleType: 'ApplicationRule'\n            name: 'AllowAzure'\n            protocols: [\n              {\n                protocolType: 'Https'\n                port: 443\n              }\n            ]\n            targetFqdns: [\n              '*azure.com'\n              '*microsoft.com'\n            ]\n            sourceAddresses: [\n              '*'\n            ]\n            terminateTLS: true\n          }\n          {\n            ruleType: 'ApplicationRule'\n            name: 'AllowNews'\n            protocols: [\n              {\n                protocolType: 'Https'\n                port: 443\n              }\n            ]\n            webCategories: [\n              'business'\n              'webbasedemail'\n            ]\n            sourceAddresses: [\n              '*'\n            ]\n            terminateTLS: true\n          }\n        ]\n      }\n      {\n        name: 'BlockPage'\n        priority: 100\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        action: {\n          type: 'Deny'\n        }\n        rules: [\n          {\n            ruleType: 'ApplicationRule'\n            name: 'BlockAzureEvents'\n            protocols: [\n              {\n                protocolType: 'Https'\n                port: 443\n              }\n            ]\n            targetUrls: [\n              'azure.microsoft.com/en-us/community/events'\n              'azure.microsoft.com/en-us/community/events/*'\n            ]\n            sourceAddresses: [\n              '*'\n            ]\n            terminateTLS: true\n          }\n        ]\n      }\n    ]\n  }\n}\n\nresource DemoFirewall 'Microsoft.Network/azureFirewalls@2020-07-01' = {\n  name: 'DemoFirewall'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'FirewallIPConfiguration'\n        properties: {\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', 'DemoVnet', 'AzureFirewallSubnet')\n          }\n          publicIPAddress: {\n            id: FirewallPublicIP.id\n          }\n        }\n      }\n    ]\n    firewallPolicy: {\n      id: DemoFirewallPolicy.id\n    }\n    sku: {\n      name: 'AZFW_VNet'\n      tier: 'Premium'\n    }\n  }\n  dependsOn: [\n    DemoVnet\n\n    DemoFirewallPolicy_PolicyRules\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1194?"}, {"role": "assistant", "content": "@description('virtual network name')\nparam virtualNetworkName string = 'test-vnet'\n\n@description('Username for the Virtual Machine.')\nparam adminUsername string\n\n@description('Secure Boot setting of the virtual machine.')\nparam secureBoot bool = true\n\n@description('vTPM setting of the virtual machine.')\nparam vTPM bool = true\n\n@description('Location for all resources, the location must support Availability Zones if required.')\nparam location string = resourceGroup().location\n\n@description('Zone numbers e.g. 1,2,3.')\nparam availabilityZones array = [\n  '1'\n  '2'\n  '3'\n]\n\n@description('Ip prefixes to which traffic won\\'t be SNAT\\'ed.')\nparam privateRanges string = 'IANAPrivateRanges'\n\n@description('Zone numbers e.g. 1,2,3.')\nparam vmSize string = 'Standard_D2s_v3'\n\n@description('Number of public IP addresses for the Azure Firewall')\n@minValue(1)\n@maxValue(100)\nparam numberOfFirewallPublicIPAddresses int = 1\n\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\n@allowed([\n  'sshPublicKey'\n  'password'\n])\nparam authenticationType string = 'sshPublicKey'\n\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\n@secure()\nparam adminPasswordOrKey string\n\n@description('Security Type of the Virtual Machine.')\n@allowed([\n  'Standard'\n  'TrustedLaunch'\n])\nparam securityType string = 'TrustedLaunch'\n\nvar securityProfileJson = {\n  uefiSettings: {\n    secureBootEnabled: true\n    vTpmEnabled: true\n  }\n  securityType: securityType\n}\nvar extensionName = 'GuestAttestation'\nvar extensionPublisher = 'Microsoft.Azure.Security.LinuxAttestation'\nvar extensionVersion = '1.0'\nvar maaTenantName = 'GuestAttestation'\nvar vnetAddressPrefix = '10.0.0.0/16'\nvar serversSubnetPrefix = '10.0.2.0/24'\nvar azureFirewallSubnetPrefix = '10.0.1.0/24'\nvar jumpboxSubnetPrefix = '10.0.0.0/24'\nvar nextHopIP = '10.0.1.4'\nvar azureFirewallSubnetName = 'AzureFirewallSubnet'\nvar jumpBoxSubnetName = 'JumpboxSubnet'\nvar serversSubnetName = 'ServersSubnet'\nvar jumpBoxPublicIPAddressName = 'JumpHostPublicIP'\nvar jumpBoxNsgName = 'JumpHostNSG'\nvar jumpBoxNicName = 'JumpHostNic'\nvar jumpBoxSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, jumpBoxSubnetName)\nvar serverNicName = 'ServerNic'\nvar serverSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, serversSubnetName)\nvar storageAccountName = '${uniqueString(resourceGroup().id)}sajumpbox'\nvar azfwRouteTableName = 'AzfwRouteTable'\nvar firewallName = 'firewall1'\nvar publicIPNamePrefix = 'publicIP'\nvar azureFirewallSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, azureFirewallSubnetName)\nvar azureFirewallSubnetJSON = json('{\"id\": \"${azureFirewallSubnetId}\"}')\nvar linuxConfiguration = {\n  disablePasswordAuthentication: true\n  ssh: {\n    publicKeys: [\n      {\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\n        keyData: adminPasswordOrKey\n      }\n    ]\n  }\n  patchSettings: { \n      patchMode: 'AutomaticByPlatform'\n  }\n}\nvar networkSecurityGroupName = '${serversSubnetName}-nsg'\nvar azureFirewallIpConfigurations = [for i in range(0, numberOfFirewallPublicIPAddresses): {\n  name: 'IpConf${i}'\n  properties: {\n    subnet: ((i == 0) ? azureFirewallSubnetJSON : null)\n    publicIPAddress: {\n      id: publicIPAddress[i].id\n    }\n  }\n}]\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'Storage'\n}\n\nresource azfwRouteTable 'Microsoft.Network/routeTables@2023-09-01' = {\n  name: azfwRouteTableName\n  location: location\n  properties: {\n    disableBgpRoutePropagation: false\n    routes: [\n      {\n        name: 'AzfwDefaultRoute'\n        properties: {\n          addressPrefix: '0.0.0.0/0'\n          nextHopType: 'VirtualAppliance'\n          nextHopIpAddress: nextHopIP\n        }\n      }\n    ]\n  }\n}\n\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\n  name: networkSecurityGroupName\n  location: location\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2023-09-01' = {\n  name: virtualNetworkName\n  location: location\n  tags: {\n    displayName: virtualNetworkName\n  }\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: jumpBoxSubnetName\n        properties: {\n          addressPrefix: jumpboxSubnetPrefix\n        }\n      }\n      {\n        name: azureFirewallSubnetName\n        properties: {\n          addressPrefix: azureFirewallSubnetPrefix\n        }\n      }\n      {\n        name: serversSubnetName\n        properties: {\n          addressPrefix: serversSubnetPrefix\n          routeTable: {\n            id: azfwRouteTable.id\n          }\n          networkSecurityGroup: {\n            id: networkSecurityGroup.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2023-09-01' = [for i in range(0, numberOfFirewallPublicIPAddresses): {\n  name: '${publicIPNamePrefix}${i + 1}'\n  location: location\n  zones: ((length(availabilityZones) == 0) ? null : availabilityZones)\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    publicIPAddressVersion: 'IPv4'\n  }\n}]\n\nresource jumpBoxPublicIPAddress 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\n  name: jumpBoxPublicIPAddressName\n  location: location\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n\nresource jumpBoxNsg 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\n  name: jumpBoxNsgName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'myNetworkSecurityGroupRuleSSH'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '22'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 1000\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource JumpBoxNic 'Microsoft.Network/networkInterfaces@2023-09-01' = {\n  name: jumpBoxNicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: jumpBoxPublicIPAddress.id\n          }\n          subnet: {\n            id: jumpBoxSubnetId\n          }\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: jumpBoxNsg.id\n    }\n  }\n  dependsOn: [\n\n    virtualNetwork\n\n  ]\n}\n\nresource ServerNic 'Microsoft.Network/networkInterfaces@2023-09-01' = {\n  name: serverNicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: serverSubnetId\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    virtualNetwork\n  ]\n}\n\nresource JumpBox 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: 'JumpBox'\n  location: location\n  tags: { \n    AzSecPackAutoConfigReady: true \n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftCBLMariner'\n        offer: 'cbl-mariner'\n        sku: 'cbl-mariner-2-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n      }\n    }\n    osProfile: {\n      computerName: 'JumpBox'\n      adminUsername: adminUsername\n      adminPassword: adminPasswordOrKey\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: JumpBoxNic.id\n        }\n      ]\n    }\n    securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: storageAccount.properties.primaryEndpoints.blob\n      }\n    }\n  }\n}\n\nresource JumpBox_extension 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = if ((securityType == 'TrustedLaunch') && ((securityProfileJson.uefiSettings.secureBootEnabled == true) && (securityProfileJson.uefiSettings.vTpmEnabled == true))) {\n  parent: JumpBox\n  name: extensionName\n  location: location\n  properties: {\n    publisher: extensionPublisher\n    type: extensionName\n    typeHandlerVersion: extensionVersion\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      AttestationConfig: {\n        MaaSettings: {\n          maaEndpoint: ''\n          maaTenantName: maaTenantName\n        }\n        AscSettings: {\n          ascReportingEndpoint: ''\n          ascReportingFrequency: ''\n        }\n        useCustomToken: 'false'\n        disableAlerts: 'false'\n      }\n    }\n  }\n}\n\nresource Server 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: 'Server'\n  location: location\n  tags: { \n    AzSecPackAutoConfigReady: true \n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftCBLMariner'\n        offer: 'cbl-mariner'\n        sku: 'cbl-mariner-2-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n      }\n    }\n    osProfile: {\n      computerName: 'Server'\n      adminUsername: adminUsername\n      adminPassword: adminPasswordOrKey\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: ServerNic.id\n        }\n      ]\n    }\n    securityProfile: {\n      uefiSettings: {\n        secureBootEnabled: secureBoot\n        vTpmEnabled: vTPM\n      }\n      securityType: 'TrustedLaunch'\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: storageAccount.properties.primaryEndpoints.blob\n      }\n    }\n  }\n}\n\nresource Server_extension 'Microsoft.Compute/virtualMachines/extensions@2023-09-01' = if (vTPM && secureBoot) {\n  parent: Server\n  name: extensionName\n  location: location\n  properties: {\n    publisher: extensionPublisher\n    type: extensionName\n    typeHandlerVersion: extensionVersion\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      AttestationConfig: {\n        MaaSettings: {\n          maaEndpoint: ''\n          maaTenantName: maaTenantName\n        }\n        AscSettings: {\n          ascReportingEndpoint: ''\n          ascReportingFrequency: ''\n        }\n        useCustomToken: 'false'\n        disableAlerts: 'false'\n      }\n    }\n  }\n}\n\nresource firewall 'Microsoft.Network/azureFirewalls@2023-09-01' = {\n  name: firewallName\n  location: location\n  zones: ((length(availabilityZones) == 0) ? null : availabilityZones)\n  properties: {\n    ipConfigurations: azureFirewallIpConfigurations\n    applicationRuleCollections: [\n      {\n        name: 'appRc1'\n        properties: {\n          priority: 101\n          action: {\n            type: 'Allow'\n          }\n          rules: [\n            {\n              name: 'appRule1'\n              protocols: [\n                {\n                  port: 80\n                  protocolType: 'http'\n                }\n                {\n                  port: 443\n                  protocolType: 'https'\n                }\n              ]\n              targetFqdns: [\n                '*microsoft.com'\n              ]\n            }\n          ]\n        }\n      }\n    ]\n    networkRuleCollections: [\n      {\n        name: 'netRc1'\n        properties: {\n          priority: 200\n          action: {\n            type: 'Allow'\n          }\n          rules: [\n            {\n              name: 'netRule1'\n              protocols: [\n                'TCP'\n              ]\n              sourceAddresses: [\n                '10.0.2.0/24'\n              ]\n              destinationAddresses: [\n                '*'\n              ]\n              destinationPorts: [\n                '8000-8999'\n              ]\n            }\n          ]\n        }\n      }\n    ]\n    additionalProperties: {\n      'Network.SNAT.PrivateRanges': privateRanges\n    }\n  }\n  dependsOn: [\n    virtualNetwork\n    publicIPAddress\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1195."}, {"role": "assistant", "content": "@description('virtual network name')\nparam virtualNetworkName string = 'test-vnet'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Username for the Virtual Machine.')\nparam adminUsername string\n\n@description('Password for the Virtual Machine.')\n@secure()\nparam adminPassword string\n\n@description('Availability zone numbers e.g. 1,2,3.')\nparam availabilityZones array = [\n  '1'\n  '2'\n  '3'\n]\n\n@description('Number of public IP addresses for the Azure Firewall')\n@minValue(1)\n@maxValue(100)\nparam numberOfFirewallPublicIPAddresses int = 1\n\n@description('Size of the virtual machine.')\nparam jumpBoxSize string = 'Standard_D2s_v3'\n\n@description('Size of the virtual machine.')\nparam serverSize string = 'Standard_D2s_v3'\n\nvar vnetAddressPrefix = '10.0.0.0/16'\nvar serversSubnetPrefix = '10.0.2.0/24'\nvar azureFirewallSubnetPrefix = '10.0.1.0/24'\nvar jumpboxSubnetPrefix = '10.0.0.0/24'\nvar nextHopIP = '10.0.1.4'\nvar azureFirewallSubnetName = 'AzureFirewallSubnet'\nvar jumpBoxSubnetName = 'JumpboxSubnet'\nvar serversSubnetName = 'ServersSubnet'\nvar jumpBoxPublicIPAddressName = 'JumpHostPublicIP'\nvar jumpBoxNsgName = 'JumpHostNSG'\nvar jumpBoxNicName = 'JumpHostNic'\nvar jumpBoxSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, jumpBoxSubnetName)\nvar serverNicName = 'ServerNic'\nvar serverSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, serversSubnetName)\nvar storageAccountName = '${uniqueString(resourceGroup().id)}sajumpbox'\nvar azfwRouteTableName = 'AzfwRouteTable'\nvar firewallName = 'firewall1'\nvar publicIPNamePrefix = 'publicIP'\nvar azureFirewallSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, azureFirewallSubnetName)\nvar azureFirewallSubnetJSON = json('{\"id\": \"${azureFirewallSubnetId}\"}')\nvar networkSecurityGroupName = '${serversSubnetName}-nsg'\nvar azureFirewallIpConfigurations = [for i in range(0, numberOfFirewallPublicIPAddresses): {\n  name: 'IpConf${i}'\n  properties: {\n    subnet: ((i == 0) ? azureFirewallSubnetJSON : json('null'))\n    publicIPAddress: {\n      id: publicIPAddress[i].id\n    }\n  }\n}]\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-08-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'Storage'\n  properties: {}\n}\n\nresource azfwRouteTable 'Microsoft.Network/routeTables@2021-03-01' = {\n  name: azfwRouteTableName\n  location: location\n  properties: {\n    disableBgpRoutePropagation: false\n    routes: [\n      {\n        name: 'AzfwDefaultRoute'\n        properties: {\n          addressPrefix: '0.0.0.0/0'\n          nextHopType: 'VirtualAppliance'\n          nextHopIpAddress: nextHopIP\n        }\n      }\n    ]\n  }\n}\n\nresource nsg 'Microsoft.Network/networkSecurityGroups@2021-03-01' = {\n  name: networkSecurityGroupName\n  location: location\n  properties: {}\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2021-05-01' = {\n  name: virtualNetworkName\n  location: location\n  tags: {\n    displayName: virtualNetworkName\n  }\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: jumpBoxSubnetName\n        properties: {\n          addressPrefix: jumpboxSubnetPrefix\n        }\n      }\n      {\n        name: azureFirewallSubnetName\n        properties: {\n          addressPrefix: azureFirewallSubnetPrefix\n        }\n      }\n      {\n        name: serversSubnetName\n        properties: {\n          addressPrefix: serversSubnetPrefix\n          routeTable: {\n            id: azfwRouteTable.id\n          }\n          networkSecurityGroup: {\n            id: nsg.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2021-03-01' = [for i in range(0, numberOfFirewallPublicIPAddresses): {\n  name: '${publicIPNamePrefix}${i+1}'\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    publicIPAddressVersion: 'IPv4'\n  }\n  zones: availabilityZones\n}]\n\nresource jumpBoxPublicIPAddress 'Microsoft.Network/publicIPAddresses@2021-03-01' = {\n  name: jumpBoxPublicIPAddressName\n  location: location\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n\nresource jumpBoxNsg 'Microsoft.Network/networkSecurityGroups@2021-05-01' = {\n  name: jumpBoxNsgName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'myNetworkSecurityGroupRuleRDP'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '3389'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 1000\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource JumpBoxNic 'Microsoft.Network/networkInterfaces@2021-05-01' = {\n  name: jumpBoxNicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: jumpBoxPublicIPAddress.id\n          }\n          subnet: {\n            id: jumpBoxSubnetId\n          }\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: jumpBoxNsg.id\n    }\n  }\n  dependsOn: [\n    virtualNetwork\n  ]\n}\n\nresource ServerNic 'Microsoft.Network/networkInterfaces@2021-05-01' = {\n  name: serverNicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: serverSubnetId\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    virtualNetwork\n  ]\n}\n\nresource JumpBoxVM 'Microsoft.Compute/virtualMachines@2021-11-01' = {\n  name: 'JumpBox'\n  location: location\n  tags: { \n    AzSecPackAutoConfigReady: true \n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: jumpBoxSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftCBLMariner'\n        offer: 'cbl-mariner'\n        sku: 'cbl-mariner-2-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        osType: 'Linux'\n        createOption: 'FromImage'\n        diskSizeGB: 127\n      }\n    }\n    osProfile: {\n      computerName: 'JumpBox'\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      linuxConfiguration:{\n          patchSettings: { \n              patchMode: 'AutomaticByPlatform'\n          }\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: JumpBoxNic.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: storageAccount.properties.primaryEndpoints.blob\n      }\n    }\n  }\n}\n\nresource ServerVM 'Microsoft.Compute/virtualMachines@2021-11-01' = {\n  name: 'Server'\n  location: location\n  tags: { \n    AzSecPackAutoConfigReady: true \n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: serverSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftCBLMariner'\n        offer: 'cbl-mariner'\n        sku: 'cbl-mariner-2-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        osType: 'Linux'\n        createOption: 'FromImage'\n        diskSizeGB: 127\n      }\n    }\n    osProfile: {\n      computerName: 'Server'\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      linuxConfiguration:{\n          patchSettings: { \n              patchMode: 'AutomaticByPlatform'\n          }\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: ServerNic.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: storageAccount.properties.primaryEndpoints.blob\n      }\n    }\n  }\n}\n\nresource firewall 'Microsoft.Network/azureFirewalls@2021-05-01' = {\n  name: firewallName\n  location: location\n  zones: ((length(availabilityZones) == 0) ? json('null') : availabilityZones)\n  properties: {\n    ipConfigurations: azureFirewallIpConfigurations\n    applicationRuleCollections: [\n      {\n        name: 'appRc1'\n        properties: {\n          priority: 101\n          action: {\n            type: 'Allow'\n          }\n          rules: [\n            {\n              name: 'appRule1'\n              protocols: [\n                {\n                  port: 80\n                  protocolType: 'Http'\n                }\n                {\n                  port: 443\n                  protocolType: 'Https'\n                }\n              ]\n              targetFqdns: [\n                'www.microsoft.com'\n              ]\n              sourceAddresses: [\n                '10.0.2.0/24'\n              ]\n            }\n          ]\n        }\n      }\n    ]\n    networkRuleCollections: [\n      {\n        name: 'netRc1'\n        properties: {\n          priority: 200\n          action: {\n            type: 'Allow'\n          }\n          rules: [\n            {\n              name: 'netRule1'\n              protocols: [\n                'TCP'\n              ]\n              sourceAddresses: [\n                '10.0.2.0/24'\n              ]\n              destinationAddresses: [\n                '*'\n              ]\n              destinationPorts: [\n                '8000-8999'\n              ]\n            }\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    virtualNetwork\n    publicIPAddress\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1196."}, {"role": "assistant", "content": "@description('The location of all resources')\nparam location string = resourceGroup().location\n\n@description('The name of the Hub vNet')\nparam vNetHubName string = 'vnet-hub'\n\n@description('The name of the Spoke vNet')\nparam vNetSpokeName string = 'vnet-spoke'\n\n@description('The name of the Virtual Machine')\nparam vmName string = 'vm1'\n\n@description('The size of the Virtual Machine')\nparam vmSize string = 'Standard_D2s_v3'\n\n@description('The administrator username')\nparam adminUsername string\n\n@description('The administrator password')\n@secure()\nparam adminPassword string\n\n@description('The name of the Azure Bastion host')\nparam bastionHostName string = 'bastion1'\n\nvar vNetHubPrefix = '10.0.0.0/16'\nvar subnetBastionPrefix = '10.0.0.0/26'\nvar vNetSpokePrefix = '10.1.0.0/16'\nvar subnetSpokeName = 'Subnet-1'\nvar subnetSpokePrefix = '10.1.0.0/24'\n\nresource vNetHub 'Microsoft.Network/virtualNetworks@2022-07-01' = {\n  name: vNetHubName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vNetHubPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: 'AzureBastionSubnet'\n        properties: {\n          addressPrefix: subnetBastionPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource vNetSpoke 'Microsoft.Network/virtualNetworks@2022-07-01' = {\n  name: vNetSpokeName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vNetSpokePrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetSpokeName\n        properties: {\n          addressPrefix: subnetSpokePrefix\n        }\n      }\n    ]\n  }\n}\n\nresource vNetHubSpokePeering 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2022-07-01' = {\n  parent: vNetHub\n  name: 'peering-to-${vNetSpokeName}'\n  properties: {\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: false\n    allowGatewayTransit: false\n    useRemoteGateways: false\n    remoteVirtualNetwork: {\n      id: vNetSpoke.id\n    }\n  }\n}\n\nresource vNetSpokeHubPeering 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2022-07-01' = {\n  parent: vNetSpoke\n  name: 'peering-to-${vNetHubName}'\n  properties: {\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: false\n    allowGatewayTransit: false\n    useRemoteGateways: false\n    remoteVirtualNetwork: {\n      id: vNetHub.id\n    }\n  }\n}\n\nresource bastionPublicIP 'Microsoft.Network/publicIPAddresses@2022-07-01' = {\n  name: '${bastionHostName}-pip'\n  location: location\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n  sku: {\n    name: 'Standard'\n  }\n}\n\nresource bastionHost 'Microsoft.Network/bastionHosts@2022-07-01' = {\n  name: bastionHostName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        properties: {\n          subnet: {\n            id: '${vNetHub.id}/subnets/AzureBastionSubnet'\n          }\n          publicIPAddress: {\n            id: bastionPublicIP.id\n          }\n          privateIPAllocationMethod: 'Dynamic'\n        }\n        name: 'ipconfig1'\n      }\n    ]\n  }\n}\n\nresource vmNic 'Microsoft.Network/networkInterfaces@2022-07-01' = {\n  name: '${vmName}-nic-01'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: '${vNetSpoke.id}/subnets/${subnetSpokeName}'\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource vm 'Microsoft.Compute/virtualMachines@2022-08-01' = {\n  name: vmName\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: vmName\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'Canonical'\n        offer: '0001-com-ubuntu-server-jammy'\n        sku: '22_04-lts-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${vmName}-os-01'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: vmNic.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n      }\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1197."}, {"role": "assistant", "content": "@description('Specify a DDoS protection plan name.')\nparam ddosProtectionPlanName string\n\n@description('Specify a DDoS virtual network name.')\nparam virtualNetworkName string\n\n@description('Specify a location for the resources.')\nparam location string = resourceGroup().location\n\n@description('Specify the virtual network address prefix')\nparam vnetAddressPrefix string = '172.17.0.0/16'\n\n@description('Specify the virtual network subnet prefix')\nparam subnetPrefix string = '172.17.0.0/24'\n\n@description('Enable DDoS protection plan.')\nparam ddosProtectionPlanEnabled bool = true\n\nresource ddosProtectionPlan 'Microsoft.Network/ddosProtectionPlans@2021-05-01' = {\n  name: ddosProtectionPlanName\n  location: location\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2021-05-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: 'default'\n        properties: {\n          addressPrefix: subnetPrefix\n        }\n      }\n    ]\n    enableDdosProtection: ddosProtectionPlanEnabled\n    ddosProtectionPlan: {\n      id: ddosProtectionPlan.id\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1198 please."}, {"role": "assistant", "content": "@description('Location for all resources')\nparam location string = resourceGroup().location\n\n@description('Virtual network address prefix')\nparam virtualNetworkAddressPrefix string = '10.1.0.0/16'\n\n@description('Azure Firewall subnet address prefix')\nparam azureFirewallSubnetPrefix string = '10.1.1.0/26'\n\n@description('Workload subnet address prefix')\nparam workloadSubnetPrefix string = '10.1.2.0/24'\n\n@description('Admin username for the virtual machine')\nparam adminUsername string = 'azureuser'\n\n@description('Admin password for the virtual machine')\n@secure()\nparam adminPassword string\n\n@description('Size of the virtual machine')\nparam vmSize string = 'Standard_D2s_v3'\n\n@description('Name prefix for all resources')\nparam resourcePrefix string = 'fw-ddos'\n\n@description('DNS label prefix for the public IP address')\nparam dnsLabelPrefix string = toLower('${resourcePrefix}-${uniqueString(resourceGroup().id)}')\n\n// DDoS Protection Plan\nresource ddosProtectionPlan 'Microsoft.Network/ddosProtectionPlans@2024-05-01' = {\n  name: '${resourcePrefix}-ddos-plan'\n  location: location\n  properties: {}\n  tags: {\n    purpose: 'DDoS Protection'\n    environment: 'tutorial'\n  }\n}\n\n// Public IP for Azure Firewall\nresource firewallPublicIP 'Microsoft.Network/publicIPAddresses@2024-05-01' = {\n  name: '${resourcePrefix}-fw-pip'\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    publicIPAddressVersion: 'IPv4'\n    dnsSettings: {\n      domainNameLabel: '${dnsLabelPrefix}-fw'\n    }\n    ddosSettings: {\n      protectionMode: 'Enabled'\n      ddosProtectionPlan: {\n        id: ddosProtectionPlan.id\n      }\n    }\n  }\n  tags: {\n    purpose: 'Azure Firewall Public IP'\n    environment: 'tutorial'\n  }\n}\n\n// Public IP for Virtual Machine\nresource vmPublicIP 'Microsoft.Network/publicIPAddresses@2024-05-01' = {\n  name: '${resourcePrefix}-vm-pip'\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    publicIPAddressVersion: 'IPv4'\n    dnsSettings: {\n      domainNameLabel: '${dnsLabelPrefix}-vm'\n    }\n    ddosSettings: {\n      protectionMode: 'Enabled'\n      ddosProtectionPlan: {\n        id: ddosProtectionPlan.id\n      }\n    }\n  }\n  tags: {\n    purpose: 'Virtual Machine Public IP'\n    environment: 'tutorial'\n  }\n}\n\n// Route Table for Workload Subnet\nresource routeTable 'Microsoft.Network/routeTables@2024-05-01' = {\n  name: '${resourcePrefix}-rt-workload'\n  location: location\n  properties: {\n    disableBgpRoutePropagation: false\n    routes: [\n      {\n        name: 'route-to-firewall'\n        properties: {\n          addressPrefix: '0.0.0.0/0'\n          nextHopType: 'VirtualAppliance'\n          nextHopIpAddress: '10.1.1.4' // Azure Firewall private IP\n        }\n      }\n    ]\n  }\n  tags: {\n    purpose: 'Force traffic through Azure Firewall'\n    environment: 'tutorial'\n  }\n}\n\n// Virtual Network with DDoS Protection\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2024-05-01' = {\n  name: '${resourcePrefix}-vnet'\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        virtualNetworkAddressPrefix\n      ]\n    }\n    dhcpOptions: {\n      dnsServers: [\n        '168.63.129.16' // Azure DNS\n      ]\n    }\n    enableDdosProtection: true\n    ddosProtectionPlan: {\n      id: ddosProtectionPlan.id\n    }\n    subnets: [\n      {\n        name: 'AzureFirewallSubnet'\n        properties: {\n          addressPrefix: azureFirewallSubnetPrefix\n          privateEndpointNetworkPolicies: 'Enabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n        }\n      }\n      {\n        name: 'Workload-SN'\n        properties: {\n          addressPrefix: workloadSubnetPrefix\n          routeTable: {\n            id: routeTable.id\n          }\n          privateEndpointNetworkPolicies: 'Enabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n        }\n      }\n    ]\n  }\n  tags: {\n    purpose: 'Virtual Network with DDoS Protection'\n    environment: 'tutorial'\n  }\n}\n\n// Firewall Policy\nresource firewallPolicy 'Microsoft.Network/firewallPolicies@2024-05-01' = {\n  name: '${resourcePrefix}-fw-policy'\n  location: location\n  properties: {\n    sku: {\n      tier: 'Standard'\n    }\n    threatIntelMode: 'Alert'\n    dnsSettings: {\n      enableProxy: true\n    }\n  }\n  tags: {\n    purpose: 'Azure Firewall Policy'\n    environment: 'tutorial'\n  }\n}\n\n// Network Rule Collection Group\nresource networkRuleCollectionGroup 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2024-05-01' = {\n  parent: firewallPolicy\n  name: 'DefaultNetworkRuleCollectionGroup'\n  properties: {\n    priority: 200\n    ruleCollections: [\n      {\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        name: 'Net-Col01'\n        priority: 200\n        action: {\n          type: 'Allow'\n        }\n        rules: [\n          {\n            ruleType: 'NetworkRule'\n            name: 'AllowWebRule'\n            ipProtocols: [\n              'TCP'\n            ]\n            sourceAddresses: [\n              '10.1.2.0/24'\n            ]\n            destinationAddresses: [\n              '*'\n            ]\n            destinationPorts: [\n              '80'\n              '443'\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n\n// Application Rule Collection Group\nresource applicationRuleCollectionGroup 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2024-05-01' = {\n  parent: firewallPolicy\n  name: 'DefaultApplicationRuleCollectionGroup'\n  properties: {\n    priority: 300\n    ruleCollections: [\n      {\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        name: 'App-Col01'\n        priority: 200\n        action: {\n          type: 'Allow'\n        }\n        rules: [\n          {\n            ruleType: 'ApplicationRule'\n            name: 'AllowWebsitesRule'\n            protocols: [\n              {\n                protocolType: 'Http'\n                port: 80\n              }\n              {\n                protocolType: 'Https'\n                port: 443\n              }\n            ]\n            targetFqdns: [\n              'www.google.com'\n              'www.microsoft.com'\n              'www.bing.com'\n            ]\n            sourceAddresses: [\n              '10.1.2.0/24'\n            ]\n          }\n        ]\n      }\n    ]\n  }\n  dependsOn: [\n    networkRuleCollectionGroup\n  ]\n}\n\n// DNAT Rule Collection Group\nresource dnatRuleCollectionGroup 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2024-05-01' = {\n  parent: firewallPolicy\n  name: 'DefaultDnatRuleCollectionGroup'\n  properties: {\n    priority: 100\n    ruleCollections: [\n      {\n        ruleCollectionType: 'FirewallPolicyNatRuleCollection'\n        name: 'Dnat-Col01'\n        priority: 200\n        action: {\n          type: 'Dnat'\n        }\n        rules: [\n          {\n            ruleType: 'NatRule'\n            name: 'RDPRule'\n            ipProtocols: [\n              'TCP'\n            ]\n            sourceAddresses: [\n              '*'\n            ]\n            destinationAddresses: [\n              firewallPublicIP.properties.ipAddress\n            ]\n            destinationPorts: [\n              '3389'\n            ]\n            translatedAddress: '10.1.2.4'\n            translatedPort: '3389'\n          }\n        ]\n      }\n    ]\n  }\n  dependsOn: [\n    applicationRuleCollectionGroup\n  ]\n}\n\n// Azure Firewall\nresource azureFirewall 'Microsoft.Network/azureFirewalls@2024-05-01' = {\n  name: '${resourcePrefix}-fw'\n  location: location\n  properties: {\n    sku: {\n      name: 'AZFW_VNet'\n      tier: 'Standard'\n    }\n    threatIntelMode: 'Alert'\n    ipConfigurations: [\n      {\n        name: 'FW-config'\n        properties: {\n          publicIPAddress: {\n            id: firewallPublicIP.id\n          }\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, 'AzureFirewallSubnet')\n          }\n        }\n      }\n    ]\n    firewallPolicy: {\n      id: firewallPolicy.id\n    }\n  }\n  tags: {\n    purpose: 'Azure Firewall with DDoS Protection'\n    environment: 'tutorial'\n  }\n  dependsOn: [\n    dnatRuleCollectionGroup\n  ]\n}\n\n// Network Interface for Virtual Machine\nresource vmNetworkInterface 'Microsoft.Network/networkInterfaces@2024-05-01' = {\n  name: '${resourcePrefix}-vm-nic'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Static'\n          privateIPAddress: '10.1.2.4'\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, 'Workload-SN')\n          }\n          publicIPAddress: {\n            id: vmPublicIP.id\n          }\n        }\n      }\n    ]\n    enableAcceleratedNetworking: false\n    enableIPForwarding: false\n  }\n  tags: {\n    purpose: 'Virtual Machine Network Interface'\n    environment: 'tutorial'\n  }\n}\n\n// Virtual Machine\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2024-07-01' = {\n  name: '${resourcePrefix}-vm'\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: '${resourcePrefix}-vm'\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        enableAutomaticUpdates: true\n        provisionVMAgent: true\n        patchSettings: {\n          patchMode: 'AutomaticByOS'\n          assessmentMode: 'ImageDefault'\n        }\n      }\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2019-datacenter-gensecond'\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${resourcePrefix}-vm-osdisk'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n        diskSizeGB: 128\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: vmNetworkInterface.id\n          properties: {\n            primary: true\n          }\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n      }\n    }\n  }\n  tags: {\n    purpose: 'Test Virtual Machine'\n    environment: 'tutorial'\n  }\n}\n\n// Outputs\noutput firewallPublicIP string = firewallPublicIP.properties.ipAddress\noutput firewallFQDN string = firewallPublicIP.properties.dnsSettings.fqdn\noutput vmPublicIP string = vmPublicIP.properties.ipAddress\noutput vmFQDN string = vmPublicIP.properties.dnsSettings.fqdn\noutput firewallPrivateIP string = '10.1.1.4'\noutput virtualNetworkName string = virtualNetwork.name\noutput ddosProtectionPlanId string = ddosProtectionPlan.id\noutput adminUsername string = adminUsername\noutput rdpConnectionString string = 'mstsc /v:${firewallPublicIP.properties.ipAddress}:3389'\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1199?"}, {"role": "assistant", "content": "@description('Set the local VNet name')\nparam existingLocalVirtualNetworkName string\n\n@description('Set the remote VNet name')\nparam existingRemoteVirtualNetworkName string\n\n@description('Sets the remote VNet Resource group')\nparam existingRemoteVirtualNetworkResourceGroupName string\n\nresource existingLocalVirtualNetworkName_peering_to_remote_vnet 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2021-02-01' = {\n  name: '${existingLocalVirtualNetworkName}/peering-to-remote-vnet'\n  properties: {\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: false\n    allowGatewayTransit: false\n    useRemoteGateways: false\n    remoteVirtualNetwork: {\n      id: resourceId(existingRemoteVirtualNetworkResourceGroupName, 'Microsoft.Network/virtualNetworks', existingRemoteVirtualNetworkName)\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1200."}, {"role": "assistant", "content": "@description('This is the name of the ExpressRoute circuit')\nparam circuitName string\n\n@description('This is the name of the ExpressRoute Service Provider. It must exactly match one of the Service Providers from List ExpressRoute Service Providers API call.')\nparam serviceProviderName string\n\n@description('This is the name of the peering location and not the ARM resource location. It must exactly match one of the available peering locations from List ExpressRoute Service Providers API call.')\nparam peeringLocation string\n\n@description('This is the bandwidth in Mbps of the circuit being created. It must exactly match one of the available bandwidth offers List ExpressRoute Service Providers API call.')\nparam bandwidthInMbps int\n\n@description('Chosen SKU Tier of ExpressRoute circuit. Choose from Premium or Standard SKU tiers.')\n@allowed([\n  'Standard'\n  'Premium'\n])\nparam skuTier string = 'Standard'\n\n@description('Chosen SKU family of ExpressRoute circuit. Choose from MeteredData or UnlimitedData SKU families.')\n@allowed([\n  'MeteredData'\n  'UnlimitedData'\n])\nparam skuFamily string = 'MeteredData'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nresource circuit 'Microsoft.Network/expressRouteCircuits@2021-02-01' = {\n  name: circuitName\n  location: location\n  sku: {\n    name: '${skuTier}_${skuFamily}'\n    tier: skuTier\n    family: skuFamily\n  }\n  properties: {\n    serviceProviderProperties: {\n      serviceProviderName: serviceProviderName\n      peeringLocation: peeringLocation\n      bandwidthInMbps: bandwidthInMbps\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1201?"}, {"role": "assistant", "content": "@description('Location for all resources deployed in the Bicep file')\nparam location string = resourceGroup().location\n\n@description('ExpressRoute peering location')\nparam erpeeringLocation string = 'Washington DC'\n\n@description('Name of the ExpressRoute circuit')\nparam erCircuitName string = 'er-ckt01'\n\n@description('Name of the ExpressRoute provider')\nparam serviceProviderName string = 'Equinix'\n\n@description('Tier ExpressRoute circuit')\n@allowed([\n  'Premium'\n  'Standard'\n])\nparam erSKU_Tier string = 'Premium'\n\n@description('Billing model ExpressRoute circuit')\n@allowed([\n  'MeteredData'\n  'UnlimitedData'\n])\nparam erSKU_Family string = 'MeteredData'\n\n@description('Bandwidth ExpressRoute circuit')\n@allowed([\n  50\n  100\n  200\n  500\n  1000\n  2000\n  5000\n  10000\n])\nparam bandwidthInMbps int = 50\n\n@description('autonomous system number used to create private peering between the customer edge router and MSEE routers')\nparam peerASN int = 65001\n\n@description('point-to-point network prefix of primary link between the customer edge router and MSEE router')\nparam primaryPeerAddressPrefix string = '192.168.10.16/30'\n\n@description('point-to-point network prefix of secondary link between the customer edge router and MSEE router')\nparam secondaryPeerAddressPrefix string = '192.168.10.20/30'\n\n@description('VLAN Id used between the customer edge routers and MSEE routers. primary and secondary link have the same VLAN Id')\nparam vlanId int = 100\n\n@description('name of the Virtual Network')\nparam vnetName string = 'vnet1'\n\n@description('name of the subnet')\nparam subnet1Name string = 'subnet1'\n\n@description('address space assigned to the Virtual Network')\nparam vnetAddressSpace string = '10.10.10.0/24'\n\n@description('network prefix assigned to the subnet')\nparam subnet1Prefix string = '10.10.10.0/25'\n\n@description('network prefixes assigned to the gateway subnet. It has to be a network prefix with mask /27 or larger')\nparam gatewaySubnetPrefix string = '10.10.10.224/27'\n\n@description('name of the ExpressRoute Gateway')\nparam gatewayName string = 'er-gw'\n\n@description('ExpressRoute Gateway SKU')\n@allowed([\n  'Standard'\n  'HighPerformance'\n  'UltraPerformance'\n  'ErGw1AZ'\n  'ErGw2AZ'\n  'ErGw3AZ'\n])\nparam gatewaySku string = 'HighPerformance'\n\nvar erSKU_Name = '${erSKU_Tier}_${erSKU_Family}'\nvar gatewayPublicIPName = '${gatewayName}-pubIP'\nvar nsgName = 'nsg'\n\nresource erCircuit 'Microsoft.Network/expressRouteCircuits@2023-09-01' = {\n  name: erCircuitName\n  location: location\n  sku: {\n    name: erSKU_Name\n    tier: erSKU_Tier\n    family: erSKU_Family\n  }\n  properties: {\n    serviceProviderProperties: {\n      serviceProviderName: serviceProviderName\n      peeringLocation: erpeeringLocation\n      bandwidthInMbps: bandwidthInMbps\n    }\n    allowClassicOperations: false\n  }\n}\n\nresource peering 'Microsoft.Network/expressRouteCircuits/peerings@2023-09-01' = {\n  parent: erCircuit\n  name: 'AzurePrivatePeering'\n  properties: {\n    peeringType: 'AzurePrivatePeering'\n    peerASN: peerASN\n    primaryPeerAddressPrefix: primaryPeerAddressPrefix\n    secondaryPeerAddressPrefix: secondaryPeerAddressPrefix\n    vlanId: vlanId\n  }\n}\n\nresource nsg 'Microsoft.Network/networkSecurityGroups@2023-09-01' = {\n  name: nsgName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'SSH-rule'\n        properties: {\n          description: 'allow SSH'\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '22'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 500\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'RDP-rule'\n        properties: {\n          description: 'allow RDP'\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '3389'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 600\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource vnet 'Microsoft.Network/virtualNetworks@2023-09-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressSpace\n      ]\n    }\n    subnets: [\n      {\n        name: subnet1Name\n        properties: {\n          addressPrefix: subnet1Prefix\n          networkSecurityGroup: {\n            id: nsg.id\n          }\n        }\n      }\n      {\n        name: 'GatewaySubnet'\n        properties: {\n          addressPrefix: gatewaySubnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource gatewayPublicIP 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\n  name: gatewayPublicIPName\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Regional'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource gateway 'Microsoft.Network/virtualNetworkGateways@2023-09-01' = {\n  name: gatewayName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, 'GatewaySubnet')\n          }\n          publicIPAddress: {\n            id: gatewayPublicIP.id\n          }\n        }\n        name: 'gwIPconf'\n      }\n    ]\n    gatewayType: 'ExpressRoute'\n    sku: {\n      name: gatewaySku\n      tier: gatewaySku\n    }\n    vpnType: 'RouteBased'\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\noutput erCircuitName string = erCircuitName\noutput gatewayName string = gatewayName\noutput gatewaySku string = gatewaySku\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1202."}, {"role": "assistant", "content": "@description('The name of the frontdoor resource.')\nparam frontDoorName string\n\n@description('The hostname of the backend. Must be an IP address or FQDN.')\nparam backendAddress string\n\nvar frontEndEndpointName = 'frontEndEndpoint'\nvar loadBalancingSettingsName = 'loadBalancingSettings'\nvar healthProbeSettingsName = 'healthProbeSettings'\nvar routingRuleName = 'routingRule'\nvar backendPoolName = 'backendPool'\n\nresource frontDoor 'Microsoft.Network/frontDoors@2021-06-01' = {\n  name: frontDoorName\n  location: 'global'\n  properties: {\n    enabledState: 'Enabled'\n\n    frontendEndpoints: [\n      {\n        name: frontEndEndpointName\n        properties: {\n          hostName: '${frontDoorName}.azurefd.net'\n          sessionAffinityEnabledState: 'Disabled'\n        }\n      }\n    ]\n\n    loadBalancingSettings: [\n      {\n        name: loadBalancingSettingsName\n        properties: {\n          sampleSize: 4\n          successfulSamplesRequired: 2\n        }\n      }\n    ]\n\n    healthProbeSettings: [\n      {\n        name: healthProbeSettingsName\n        properties: {\n          path: '/'\n          protocol: 'Http'\n          intervalInSeconds: 120\n        }\n      }\n    ]\n\n    backendPools: [\n      {\n        name: backendPoolName\n        properties: {\n          backends: [\n            {\n              address: backendAddress\n              backendHostHeader: backendAddress\n              httpPort: 80\n              httpsPort: 443\n              weight: 50\n              priority: 1\n              enabledState: 'Enabled'\n            }\n          ]\n          loadBalancingSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/loadBalancingSettings', frontDoorName, loadBalancingSettingsName)\n          }\n          healthProbeSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/healthProbeSettings', frontDoorName, healthProbeSettingsName)\n          }\n        }\n      }\n    ]\n\n    routingRules: [\n      {\n        name: routingRuleName\n        properties: {\n          frontendEndpoints: [\n            {\n              id: resourceId('Microsoft.Network/frontDoors/frontEndEndpoints', frontDoorName, frontEndEndpointName)\n            }\n          ]\n          acceptedProtocols: [\n            'Http'\n            'Https'\n          ]\n          patternsToMatch: [\n            '/*'\n          ]\n          routeConfiguration: {\n            '@odata.type': '#Microsoft.Azure.FrontDoor.Models.FrontdoorForwardingConfiguration'\n            forwardingProtocol: 'MatchRequest'\n            backendPool: {\n              id: resourceId('Microsoft.Network/frontDoors/backEndPools', frontDoorName, backendPoolName)\n            }\n          }\n          enabledState: 'Enabled'\n        }\n      }\n    ]\n  }\n}\n\noutput name string = frontDoor.name\noutput resourceGroupName string = resourceGroup().name\noutput resourceId string = frontDoor.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1203."}, {"role": "assistant", "content": "@description('The name of the frontdoor resource.')\nparam frontDoorName string\n\n@description('The hostname of the backend. Must be an IP address or FQDN.')\nparam backendAddress string\n\nresource frontdoor 'Microsoft.Network/frontDoors@2020-05-01' = {\n  name: frontDoorName\n  location: 'global'\n  properties: {\n    routingRules: [\n      {\n        name: 'httptohttps'\n        properties: {\n          frontendEndpoints: [\n            {\n              id: resourceId('Microsoft.Network/frontDoors/frontendEndpoints', frontDoorName, 'frontendEndpoint1')\n            }\n          ]\n          acceptedProtocols: [\n            'Http'\n          ]\n          patternsToMatch: [\n            '/*'\n          ]\n          routeConfiguration: {\n            '@odata.type': '#Microsoft.Azure.FrontDoor.Models.FrontdoorRedirectConfiguration'\n            redirectProtocol: 'HttpsOnly'\n            redirectType: 'Moved'\n          }\n          enabledState: 'Enabled'\n        }\n      }\n    ]\n    healthProbeSettings: [\n      {\n        name: 'healthProbeSettings1'\n        properties: {\n          path: '/'\n          protocol: 'Http'\n          intervalInSeconds: 120\n        }\n      }\n    ]\n    loadBalancingSettings: [\n      {\n        name: 'loadBalancingSettings1'\n        properties: {\n          sampleSize: 4\n          successfulSamplesRequired: 2\n        }\n      }\n    ]\n    backendPools: [\n      {\n        name: 'backendPool1'\n        properties: {\n          backends: [\n            {\n              address: backendAddress\n              backendHostHeader: backendAddress\n              httpPort: 80\n              httpsPort: 443\n              weight: 50\n              priority: 1\n              enabledState: 'Enabled'\n            }\n          ]\n          loadBalancingSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/loadBalancingSettings', frontDoorName, 'loadBalancingSettings1')\n          }\n          healthProbeSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/healthProbeSettings', frontDoorName, 'healthProbeSettings1')\n          }\n        }\n      }\n    ]\n    frontendEndpoints: [\n      {\n        name: 'frontendEndpoint1'\n        properties: {\n          hostName: '${frontDoorName}.azurefd.net'\n          sessionAffinityEnabledState: 'Disabled'\n        }\n      }\n    ]\n    enabledState: 'Enabled'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1204?"}, {"role": "assistant", "content": "@description('The name of the Front Door resource.')\nparam frontDoorName string\n\n@description('The custom domain name to associate with your Front Door.')\nparam customDomainName string\n\n@description('The hostname of the backend. Must be a public IP address or FQDN.')\nparam backendAddress string\n\nvar frontEndEndpointDefaultHostName = '${frontDoorName}.azurefd.net'\nvar frontEndEndpointDefaultName = replace(frontEndEndpointDefaultHostName, '.', '-')\nvar frontEndEndpointCustomName = replace(customDomainName, '.', '-')\nvar loadBalancingSettingsName = 'loadBalancingSettings'\nvar healthProbeSettingsName = 'healthProbeSettings'\nvar routingRuleName = 'routingRule'\nvar backendPoolName = 'backendPool'\n\nresource frontDoor 'Microsoft.Network/frontDoors@2020-01-01' = {\n  name: frontDoorName\n  location: 'global'\n  properties: {\n    enabledState: 'Enabled'\n\n    frontendEndpoints: [\n      {\n        name: frontEndEndpointDefaultName\n        properties: {\n          hostName: frontEndEndpointDefaultHostName\n          sessionAffinityEnabledState: 'Disabled'\n        }\n      }\n      {\n        name: frontEndEndpointCustomName\n        properties: {\n          hostName: customDomainName\n          sessionAffinityEnabledState: 'Disabled'\n        }\n      }\n    ]\n\n    loadBalancingSettings: [\n      {\n        name: loadBalancingSettingsName\n        properties: {\n          sampleSize: 4\n          successfulSamplesRequired: 2\n        }\n      }\n    ]\n\n    healthProbeSettings: [\n      {\n        name: healthProbeSettingsName\n        properties: {\n          path: '/'\n          protocol: 'Http'\n          intervalInSeconds: 120\n        }\n      }\n    ]\n\n    backendPools: [\n      {\n        name: backendPoolName\n        properties: {\n          backends: [\n            {\n              address: backendAddress\n              backendHostHeader: backendAddress\n              httpPort: 80\n              httpsPort: 443\n              weight: 50\n              priority: 1\n              enabledState: 'Enabled'\n            }\n          ]\n          loadBalancingSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/loadBalancingSettings', frontDoorName, loadBalancingSettingsName)\n          }\n          healthProbeSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/healthProbeSettings', frontDoorName, healthProbeSettingsName)\n          }\n        }\n      }\n    ]\n\n    routingRules: [\n      {\n        name: routingRuleName\n        properties: {\n          frontendEndpoints: [\n            {\n              id: resourceId('Microsoft.Network/frontDoors/frontEndEndpoints', frontDoorName, frontEndEndpointDefaultName)\n            }\n            {\n              id: resourceId('Microsoft.Network/frontDoors/frontEndEndpoints', frontDoorName, frontEndEndpointCustomName)\n            }\n          ]\n          acceptedProtocols: [\n            'Http'\n            'Https'\n          ]\n          patternsToMatch: [\n            '/*'\n          ]\n          routeConfiguration: {\n            '@odata.type': '#Microsoft.Azure.FrontDoor.Models.FrontdoorForwardingConfiguration'\n            forwardingProtocol: 'MatchRequest'\n            backendPool: {\n              id: resourceId('Microsoft.Network/frontDoors/backEndPools', frontDoorName, backendPoolName)\n            }\n          }\n          enabledState: 'Enabled'\n        }\n      }\n    ]\n  }\n\n  resource frontendEndpoint 'frontendEndpoints' existing = {\n    name: frontEndEndpointCustomName\n  }\n}\n\n// This resource enables a Front Door-managed TLS certificate on the frontend.\nresource customHttpsConfiguration 'Microsoft.Network/frontdoors/frontendEndpoints/customHttpsConfiguration@2020-07-01' = {\n  parent: frontDoor::frontendEndpoint\n  name: 'default'\n  properties: {\n    protocolType: 'ServerNameIndication'\n    certificateSource: 'FrontDoor'\n    frontDoorCertificateSourceParameters: {\n      certificateType: 'Dedicated'\n    }\n    minimumTlsVersion: '1.2'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1205."}, {"role": "assistant", "content": "@description('The name of the Front Door resource.')\nparam frontDoorName string\n\n@description('The custom domain name to associate with your Front Door.')\nparam customDomainName string\n\n@description('The fully qualified resource ID of the Key Vault that contains the custom domain\\'s certificate.')\nparam certificateKeyVaultResourceId string\n\n@description('The name of the Key Vault secret that contains the custom domain\\'s certificate.')\nparam certificateKeyVaultSecretName string\n\n@description('The version of the Key Vault secret that contains the custom domain\\'s certificate.')\nparam certificateKeyVaultSecretVersion string = ''\n\n@description('The hostname of the backend. Must be a public IP address or FQDN.')\nparam backendAddress string\n\nvar frontEndEndpointDefaultHostName = '${frontDoorName}.azurefd.net'\nvar frontEndEndpointDefaultName = replace(frontEndEndpointDefaultHostName, '.', '-')\nvar frontEndEndpointCustomName = replace(customDomainName, '.', '-')\nvar loadBalancingSettingsName = 'loadBalancingSettings'\nvar healthProbeSettingsName = 'healthProbeSettings'\nvar routingRuleName = 'routingRule'\nvar backendPoolName = 'backendPool'\n\nresource frontDoor 'Microsoft.Network/frontDoors@2020-01-01' = {\n  name: frontDoorName\n  location: 'global'\n  properties: {\n    enabledState: 'Enabled'\n\n    frontendEndpoints: [\n      {\n        name: frontEndEndpointDefaultName\n        properties: {\n          hostName: frontEndEndpointDefaultHostName\n          sessionAffinityEnabledState: 'Disabled'\n        }\n      }\n      {\n        name: frontEndEndpointCustomName\n        properties: {\n          hostName: customDomainName\n          sessionAffinityEnabledState: 'Disabled'\n        }\n      }\n    ]\n\n    loadBalancingSettings: [\n      {\n        name: loadBalancingSettingsName\n        properties: {\n          sampleSize: 4\n          successfulSamplesRequired: 2\n        }\n      }\n    ]\n\n    healthProbeSettings: [\n      {\n        name: healthProbeSettingsName\n        properties: {\n          path: '/'\n          protocol: 'Http'\n          intervalInSeconds: 120\n        }\n      }\n    ]\n\n    backendPools: [\n      {\n        name: backendPoolName\n        properties: {\n          backends: [\n            {\n              address: backendAddress\n              backendHostHeader: backendAddress\n              httpPort: 80\n              httpsPort: 443\n              weight: 50\n              priority: 1\n              enabledState: 'Enabled'\n            }\n          ]\n          loadBalancingSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/loadBalancingSettings', frontDoorName, loadBalancingSettingsName)\n          }\n          healthProbeSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/healthProbeSettings', frontDoorName, healthProbeSettingsName)\n          }\n        }\n      }\n    ]\n\n    routingRules: [\n      {\n        name: routingRuleName\n        properties: {\n          frontendEndpoints: [\n            {\n              id: resourceId('Microsoft.Network/frontDoors/frontEndEndpoints', frontDoorName, frontEndEndpointDefaultName)\n            }\n            {\n              id: resourceId('Microsoft.Network/frontDoors/frontEndEndpoints', frontDoorName, frontEndEndpointCustomName)\n            }\n          ]\n          acceptedProtocols: [\n            'Http'\n            'Https'\n          ]\n          patternsToMatch: [\n            '/*'\n          ]\n          routeConfiguration: {\n            '@odata.type': '#Microsoft.Azure.FrontDoor.Models.FrontdoorForwardingConfiguration'\n            forwardingProtocol: 'MatchRequest'\n            backendPool: {\n              id: resourceId('Microsoft.Network/frontDoors/backEndPools', frontDoorName, backendPoolName)\n            }\n          }\n          enabledState: 'Enabled'\n        }\n      }\n    ]\n  }\n\n  resource frontendEndpoint 'frontendEndpoints' existing = {\n    name: frontEndEndpointCustomName\n  }\n}\n\n// This resource enables a custom TLS certificate on the frontend.\nresource customHttpsConfiguration 'Microsoft.Network/frontdoors/frontendEndpoints/customHttpsConfiguration@2020-07-01' = {\n  parent: frontDoor::frontendEndpoint\n  name: 'default'\n  properties: {\n    protocolType: 'ServerNameIndication'\n    certificateSource: 'AzureKeyVault'\n    keyVaultCertificateSourceParameters: {\n      vault: {\n        id: certificateKeyVaultResourceId\n      }\n      secretName: certificateKeyVaultSecretName\n      secretVersion: (certificateKeyVaultSecretVersion == '') ? null : certificateKeyVaultSecretVersion\n    }\n    minimumTlsVersion: '1.2'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1206."}, {"role": "assistant", "content": "@description('The name of the frontdoor resource.')\nparam frontDoorName string\n\n@description('The hostname of the backend. Must be an IP address or FQDN.')\nparam backendAddress string\n\n@description('Name of the Health probe settings associated with this Front Door instance.')\nparam healthProbeName string\n\n@description('The path to use for the health probe. Default is /')\nparam healthProbePath string\n\n@description('Protocol scheme to use for this probe. Must be Http or Https.')\n@allowed([\n  'Http'\n  'Https'\n])\nparam healthProbeProtocol string\n\n@description('The number of seconds between health probes.')\nparam healthProbeIntervalInSeconds int\n\nvar frontdoorLocation = 'global'\nvar frontDoorSuffix = ((toLower(environment().name) == 'azureusgovernment') ? 'azurefd.us' : environment().suffixes.azureFrontDoorEndpointSuffix)\nvar frontDoorHostName = '${toLower(frontDoorName)}.${frontDoorSuffix}'\n\nresource frontDoor 'Microsoft.Network/frontDoors@2020-05-01' = {\n  name: frontDoorName\n  location: frontdoorLocation\n  properties: {\n    routingRules: [\n      {\n        name: 'routingRule1'\n        properties: {\n          frontendEndpoints: [\n            {\n              id: resourceId('Microsoft.Network/frontDoors/frontendEndpoints', frontDoorName, 'frontendEndpoint1')\n            }\n          ]\n          acceptedProtocols: [\n            'Http'\n          ]\n          patternsToMatch: [\n            '/*'\n          ]\n          routeConfiguration: {\n            '@odata.type': '#Microsoft.Azure.FrontDoor.Models.FrontdoorForwardingConfiguration'\n            forwardingProtocol: 'MatchRequest'\n            backendPool: {\n              id: resourceId('Microsoft.Network/frontDoors/backendPools', frontDoorName, 'backendPool1')\n            }\n          }\n          enabledState: 'Enabled'\n        }\n      }\n    ]\n    healthProbeSettings: [\n      {\n        name: healthProbeName\n        properties: {\n          path: healthProbePath\n          protocol: healthProbeProtocol\n          intervalInSeconds: healthProbeIntervalInSeconds\n        }\n      }\n    ]\n    loadBalancingSettings: [\n      {\n        name: 'loadBalancingSettings1'\n        properties: {\n          sampleSize: 4\n          successfulSamplesRequired: 2\n        }\n      }\n    ]\n    backendPools: [\n      {\n        name: 'backendPool1'\n        properties: {\n          backends: [\n            {\n              address: backendAddress\n              httpPort: 80\n              httpsPort: 443\n              weight: 50\n              priority: 1\n              enabledState: 'Enabled'\n            }\n          ]\n          loadBalancingSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/loadBalancingSettings', frontDoorName, 'loadBalancingSettings1')\n          }\n          healthProbeSettings: {\n            id: resourceId('Microsoft.Network/frontDoors/healthProbeSettings', frontDoorName, 'healthProbeSettings1')\n          }\n        }\n      }\n    ]\n    frontendEndpoints: [\n      {\n        name: 'frontendEndpoint1'\n        properties: {\n          hostName: frontDoorHostName\n          sessionAffinityEnabledState: 'Disabled'\n        }\n      }\n    ]\n    enabledState: 'Enabled'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1207."}, {"role": "assistant", "content": "@description('The name of the WAF policy')\nparam wafPolicyName string\n\n@description('Describes if it is in detection mode or prevention mode at policy level.')\n@allowed([\n  'Detection'\n  'Prevention'\n])\nparam wafMode string = 'Detection'\n\n\nresource wafPolicy 'Microsoft.Network/FrontDoorWebApplicationFirewallPolicies@2020-11-01' = {\n  name: wafPolicyName\n  location: 'global'\n  properties: {\n    policySettings: {\n      mode: wafMode\n      enabledState: 'Enabled'\n    }\n    managedRules: {\n      managedRuleSets: [\n        {\n          ruleSetType: 'DefaultRuleSet'\n          ruleSetVersion: '1.0'\n        }\n      ]\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1208 please."}, {"role": "assistant", "content": "@description('Admin username for the backend servers')\nparam adminUsername string\n\n@description('Password for the admin account on the backend servers')\n@secure()\nparam adminPassword string\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Size of the virtual machine.')\nparam vmSize string = 'Standard_B2ms'\n\nvar virtualMachineName = 'myVM'\nvar virtualNetworkName = 'myVNet'\nvar networkInterfaceName = 'net-int'\nvar ipConfigName = 'ipconfig'\nvar ipPrefixName = 'public_ip_prefix'\nvar ipPrefixSize = 31\nvar publicIpAddressName = 'public_ip'\nvar nsgName = 'vm-nsg'\nvar firewallName = 'FW-01'\nvar vnetPrefix = '10.0.0.0/16'\nvar fwSubnetPrefix = '10.0.0.0/24'\nvar backendSubnetPrefix = '10.0.1.0/24'\nvar azureFirewallSubnetId = subnet.id\nvar azureFirewallIpConfigurations = [for i in range(0, 2): {\n  name: 'IpConf${(i + 1)}'\n  properties: {\n    subnet: ((i == 0) ? json('{\"id\": \"${azureFirewallSubnetId}\"}') : null)\n    publicIPAddress: {\n      id: publicIPAddress[i].id\n    }\n  }\n}]\n\nresource nsg 'Microsoft.Network/networkSecurityGroups@2023-09-01' = [for i in range(0, 2): {\n  name: '${nsgName}${i + 1}'\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'RDP'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '3389'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 300\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}]\n\nresource ipprefix 'Microsoft.Network/publicIPPrefixes@2023-09-01' = {\n  name: ipPrefixName\n  location: location\n  properties: {\n    prefixLength: ipPrefixSize\n    publicIPAddressVersion: 'IPv4'\n  }\n  sku: {\n    name: 'Standard'\n  }\n}\n\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2023-09-01' = [for i in range(0, 2): {\n  name: '${publicIpAddressName}${i + 1}'\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    publicIPPrefix: {\n      id: ipprefix.id\n    }\n    idleTimeoutInMinutes: 4\n  }\n}]\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2023-09-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: 'myBackendSubnet'\n        properties: {\n          addressPrefix: backendSubnetPrefix\n          routeTable: {\n            id: routeTable.id\n          }\n          privateEndpointNetworkPolicies: 'Enabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n        }\n      }\n    ]\n    enableDdosProtection: false\n    enableVmProtection: false\n  }\n}\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2023-09-01' = {\n  parent: virtualNetwork\n  name: 'AzureFirewallSubnet'\n  properties: {\n    addressPrefix: fwSubnetPrefix\n    privateEndpointNetworkPolicies: 'Enabled'\n    privateLinkServiceNetworkPolicies: 'Enabled'\n  }\n}\n\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2023-09-01' = [for i in range(0, 2): {\n  name: '${virtualMachineName}${i+1}'\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2019-Datacenter'\n        version: 'latest'\n      }\n      osDisk: {\n        osType: 'Windows'\n        createOption: 'FromImage'\n        caching: 'ReadWrite'\n        managedDisk: {\n          storageAccountType: 'StandardSSD_LRS'\n        }\n        diskSizeGB: 127\n      }\n    }\n    osProfile: {\n      computerName: '${virtualMachineName}${i+1}'\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        provisionVMAgent: true\n        enableAutomaticUpdates: true\n      }\n      allowExtensionOperations: true\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: netInterface[i].id\n        }\n      ]\n    }\n  }\n}]\n\nresource netInterface 'Microsoft.Network/networkInterfaces@2023-09-01' = [for i in range(0, 2): {\n  name: '${networkInterfaceName}${i + 1}'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: '${ipConfigName}${i + 1}'\n        properties: {\n          subnet: {\n            id: virtualNetwork.properties.subnets[0].id\n          }\n          primary: true\n        }\n      }\n    ]\n    enableAcceleratedNetworking: false\n    enableIPForwarding: false\n    networkSecurityGroup: {\n      id: nsg[i].id\n    }\n  }\n}]\n\nresource firewall 'Microsoft.Network/azureFirewalls@2023-09-01' = {\n  name: firewallName\n  location: location\n  properties: {\n    sku: {\n      name: 'AZFW_VNet'\n      tier: 'Standard'\n    }\n    threatIntelMode: 'Deny'\n    ipConfigurations: azureFirewallIpConfigurations\n    applicationRuleCollections: [\n      {\n        name: 'web'\n        properties: {\n          priority: 100\n          action: {\n            type: 'Allow'\n          }\n          rules: [\n            {\n              name: 'wan-address'\n              protocols: [\n                {\n                  protocolType: 'Http'\n                  port: 80\n                }\n                {\n                  protocolType: 'Https'\n                  port: 443\n                }\n              ]\n              targetFqdns: [\n                'getmywanip.com'\n              ]\n              sourceAddresses: [\n                '*'\n              ]\n            }\n            {\n              name: 'google'\n              protocols: [\n                {\n                  protocolType: 'Http'\n                  port: 80\n                }\n                {\n                  protocolType: 'Https'\n                  port: 443\n                }\n              ]\n              targetFqdns: [\n                'www.google.com'\n              ]\n              sourceAddresses: [\n                '10.0.1.0/24'\n              ]\n            }\n            {\n              name: 'wupdate'\n              protocols: [\n                {\n                  protocolType: 'Http'\n                  port: 80\n                }\n                {\n                  protocolType: 'Https'\n                  port: 443\n                }\n              ]\n              fqdnTags: [\n                'WindowsUpdate'\n              ]\n              sourceAddresses: [\n                '*'\n              ]\n            }\n          ]\n        }\n      }\n    ]\n    natRuleCollections: [\n      {\n        name: 'Coll-01'\n        properties: {\n          priority: 100\n          action: {\n            type: 'Dnat'\n          }\n          rules: [\n            {\n              name: 'rdp-01'\n              protocols: [\n                'TCP'\n              ]\n              translatedAddress: '10.0.1.4'\n              translatedPort: '3389'\n              sourceAddresses: [\n                '*'\n              ]\n              destinationAddresses: [\n                publicIPAddress[0].properties.ipAddress\n              ]\n              destinationPorts: [\n                '3389'\n              ]\n            }\n            {\n              name: 'rdp-02'\n              protocols: [\n                'TCP'\n              ]\n              translatedAddress: '10.0.1.5'\n              translatedPort: '3389'\n              sourceAddresses: [\n                '*'\n              ]\n              destinationAddresses: [\n                publicIPAddress[1].properties.ipAddress\n              ]\n              destinationPorts: [\n                '3389'\n              ]\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource routeTable 'Microsoft.Network/routeTables@2023-09-01' = {\n  name: 'rt-01'\n  location: location\n  properties: {\n    disableBgpRoutePropagation: false\n    routes: [\n      {\n        name: 'fw'\n        properties: {\n          addressPrefix: '0.0.0.0/0'\n          nextHopType: 'VirtualAppliance'\n          nextHopIpAddress: '10.0.0.4'\n        }\n      }\n    ]\n  }\n}\n\noutput name string = firewall.name\noutput resourceId string = firewall.id\noutput location string = location\noutput resourceGroupName string = resourceGroup().name\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1209?"}, {"role": "assistant", "content": "@description('Admin username for the servers')\nparam adminUsername string\n\n@description('Password for the admin account on the servers')\n@secure()\nparam adminPassword string\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Size of the virtual machine.')\nparam vmSize string = 'Standard_D2_v3'\n\nresource virtualWan 'Microsoft.Network/virtualWans@2021-08-01' = {\n  name: 'VWan-01'\n  location: location\n  properties: {\n    disableVpnEncryption: false\n    allowBranchToBranchTraffic: true\n    type: 'Standard'\n  }\n}\n\nresource virtualHub 'Microsoft.Network/virtualHubs@2021-08-01' = {\n  name: 'Hub-01'\n  location: location\n  properties: {\n    addressPrefix: '10.1.0.0/16'\n    virtualWan: {\n      id: virtualWan.id\n    }\n  }\n}\n\nresource hubVNetconnection 'Microsoft.Network/virtualHubs/hubVirtualNetworkConnections@2021-08-01' = {\n  parent: virtualHub\n  name: 'hub-spoke'\n  dependsOn: [\n    firewall\n  ]\n  properties: {\n    remoteVirtualNetwork: {\n      id: virtualNetwork.id\n    }\n    allowHubToRemoteVnetTransit: true\n    allowRemoteVnetToUseHubVnetGateways: false\n    enableInternetSecurity: true\n    routingConfiguration: {\n      associatedRouteTable: {\n        id: hubRouteTable.id\n      }\n      propagatedRouteTables: {\n        labels: [\n          'VNet'\n        ]\n        ids: [\n          {\n            id: hubRouteTable.id\n          }\n        ]\n      }\n    }\n  }\n}\n\nresource policy 'Microsoft.Network/firewallPolicies@2021-08-01' = {\n  name: 'Policy-01'\n  location: location\n  properties: {\n    threatIntelMode: 'Alert'\n  }\n}\n\nresource ruleCollectionGroup 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2021-08-01' = {\n  parent: policy\n  name: 'DefaultApplicationRuleCollectionGroup'\n  properties: {\n    priority: 300\n    ruleCollections: [\n      {\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        name: 'RC-01'\n        priority: 100\n        action: {\n          type: 'Allow'\n        }\n        rules: [\n          {\n            ruleType: 'ApplicationRule'\n            name: 'Allow-msft'\n            sourceAddresses: [\n              '*'\n            ]\n            protocols: [\n              {\n                port: 80\n                protocolType: 'Http'\n              }\n              {\n                port: 443\n                protocolType: 'Https'\n              }\n            ]\n            targetFqdns: [\n              '*.microsoft.com'\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n\nresource firewall 'Microsoft.Network/azureFirewalls@2021-08-01' = {\n  name: 'AzfwTest'\n  location: location\n  properties: {\n    sku: {\n      name: 'AZFW_Hub'\n      tier: 'Standard'\n    }\n    hubIPAddresses: {\n      publicIPs: {\n        count: 1\n      }\n    }\n    virtualHub: {\n      id: virtualHub.id\n    }\n    firewallPolicy: {\n      id: policy.id\n    }\n  }\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2021-08-01' = {\n  name: 'Spoke-01'\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/16'\n      ]\n    }\n    enableDdosProtection: false\n    enableVmProtection: false\n  }\n}\n\nresource subnet_Workload_SN 'Microsoft.Network/virtualNetworks/subnets@2021-08-01' = {\n  parent: virtualNetwork\n  name: 'Workload-SN'\n  properties: {\n    addressPrefix: '10.0.1.0/24'\n    privateEndpointNetworkPolicies: 'Enabled'\n    privateLinkServiceNetworkPolicies: 'Enabled'\n  }\n}\n\nresource subnet_Jump_SN 'Microsoft.Network/virtualNetworks/subnets@2021-08-01' = {\n  parent: virtualNetwork\n  name: 'Jump-SN'\n  dependsOn: [\n    subnet_Workload_SN\n  ]\n  properties: {\n    addressPrefix: '10.0.2.0/24'\n    routeTable: {\n      id: routeTable.id\n    }\n    privateEndpointNetworkPolicies: 'Enabled'\n    privateLinkServiceNetworkPolicies: 'Enabled'\n  }\n}\n\nresource Jump_Srv 'Microsoft.Compute/virtualMachines@2022-03-01' = {\n  name: 'Jump-Srv'\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2019-Datacenter'\n        version: 'latest'\n      }\n      osDisk: {\n        osType: 'Windows'\n        createOption: 'FromImage'\n        caching: 'ReadWrite'\n        managedDisk: {\n          storageAccountType: 'StandardSSD_LRS'\n        }\n        diskSizeGB: 127\n      }\n    }\n    osProfile: {\n      computerName: 'Jump-Srv'\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        provisionVMAgent: true\n        enableAutomaticUpdates: true\n      }\n      allowExtensionOperations: true\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: netInterface_jump_srv.id\n        }\n      ]\n    }\n  }\n}\n\nresource Workload_Srv 'Microsoft.Compute/virtualMachines@2022-03-01' = {\n  name: 'Workload-Srv'\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2019-Datacenter'\n        version: 'latest'\n      }\n      osDisk: {\n        osType: 'Windows'\n        createOption: 'FromImage'\n        caching: 'ReadWrite'\n        managedDisk: {\n          storageAccountType: 'StandardSSD_LRS'\n        }\n        diskSizeGB: 127\n      }\n    }\n    osProfile: {\n      computerName: 'Workload-Srv'\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        provisionVMAgent: true\n        enableAutomaticUpdates: true\n      }\n      allowExtensionOperations: true\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: netInterface_workload_srv.id\n        }\n      ]\n    }\n  }\n}\n\nresource netInterface_workload_srv 'Microsoft.Network/networkInterfaces@2021-08-01' = {\n  name: 'netInterface-workload-srv'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: subnet_Workload_SN.id\n          }\n          primary: true\n          privateIPAddressVersion: 'IPv4'\n        }\n      }\n    ]\n    enableAcceleratedNetworking: false\n    enableIPForwarding: false\n    networkSecurityGroup: {\n      id: nsg_workload_srv.id\n    }\n  }\n}\n\nresource netInterface_jump_srv 'Microsoft.Network/networkInterfaces@2021-08-01' = {\n  name: 'netInterface-jump-srv'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: publicIP_jump_srv.id\n          }\n          subnet: {\n            id: subnet_Jump_SN.id\n          }\n          primary: true\n          privateIPAddressVersion: 'IPv4'\n        }\n      }\n    ]\n    enableAcceleratedNetworking: false\n    enableIPForwarding: false\n    networkSecurityGroup: {\n      id: nsg_jump_srv.id\n    }\n  }\n}\n\nresource nsg_jump_srv 'Microsoft.Network/networkSecurityGroups@2021-08-01' = {\n  name: 'nsg-jump-srv'\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'RDP'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '3389'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 300\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource nsg_workload_srv 'Microsoft.Network/networkSecurityGroups@2021-08-01' = {\n  name: 'nsg-workload-srv'\n  location: location\n  properties: {}\n}\n\nresource publicIP_jump_srv 'Microsoft.Network/publicIPAddresses@2021-08-01' = {\n  name: 'publicIP-jump-srv'\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    idleTimeoutInMinutes: 4\n  }\n}\n\nresource routeTable 'Microsoft.Network/routeTables@2021-08-01' = {\n  name: 'RT-01'\n  location: location\n  properties: {\n    disableBgpRoutePropagation: false\n    routes: [\n      {\n        name: 'jump-to-inet'\n        properties: {\n          addressPrefix: '0.0.0.0/0'\n          nextHopType: 'Internet'\n        }\n      }\n    ]\n  }\n}\n\nresource hubRouteTable 'Microsoft.Network/virtualHubs/hubRouteTables@2021-08-01' = {\n  parent: virtualHub\n  name: 'RT_VNet'\n  properties: {\n    routes: [\n      {\n        name: 'Workload-SNToFirewall'\n        destinationType: 'CIDR'\n        destinations: [\n          '10.0.1.0/24'\n        ]\n        nextHopType: 'ResourceId'\n        nextHop: firewall.id\n      }\n      {\n        name: 'InternetToFirewall'\n        destinationType: 'CIDR'\n        destinations: [\n          '0.0.0.0/0'\n        ]\n        nextHopType: 'ResourceId'\n        nextHop: firewall.id\n      }\n    ]\n    labels: [\n      'VNet'\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1210."}, {"role": "assistant", "content": "\n@description('Admin username')\nparam adminUsername string\n\n@description('Admin password')\n@secure()\nparam adminPassword string\n\n@description('Prefix to use for VM names')\nparam vmNamePrefix string = 'BackendVM'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Size of VM')\nparam vmSize string = 'Standard_D2s_v3'\n\n@description('Virtual network address prefix')\nparam vNetAddressPrefix string = '10.0.0.0/16'\n\n@description('Backend subnet address prefix')\nparam vNetSubnetAddressPrefix string = '10.0.0.0/24'\n\n@description('Bastion subnet address prefix')\nparam vNetBastionSubnetAddressPrefix string = '10.0.2.0/24'\n\n@description('Frontend IP address of load balancer')\nparam lbFrontendIPAddress string = '10.0.0.6'\n\nvar natGatewayName = 'lb-nat-gateway'\nvar natGatewayPublicIPAddressName = 'lb-nat-gateway-ip'\nvar vNetName = 'lb-vnet'\nvar vNetSubnetName = 'backend-subnet'\nvar storageAccountType = 'Standard_LRS'\nvar storageAccountName = uniqueString(resourceGroup().id)\nvar loadBalancerName = 'internal-lb'\nvar networkInterfaceName = 'lb-nic'\nvar numberOfInstances = 2\nvar lbSkuName = 'Standard'\nvar bastionName = 'lb-bastion'\nvar bastionSubnetName = 'AzureBastionSubnet'\nvar bastionPublicIPAddressName = 'lb-bastion-ip'\n\nresource natGateway 'Microsoft.Network/natGateways@2023-09-01' = {\n  name: natGatewayName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    idleTimeoutInMinutes: 4\n    publicIpAddresses: [\n      {\n        id: natGatewayPublicIPAddress.id\n      }\n    ]\n  }\n}\n\nresource natGatewayPublicIPAddress 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\n  name: natGatewayPublicIPAddressName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    idleTimeoutInMinutes: 4\n  }\n}\n\nresource vNet 'Microsoft.Network/virtualNetworks@2023-09-01' = {\n  name: vNetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vNetAddressPrefix\n      ]\n    }\n  }\n}\n\nresource vNetName_bastionSubnet 'Microsoft.Network/virtualNetworks/subnets@2023-09-01' = {\n  parent: vNet\n  name: bastionSubnetName\n  properties: {\n    addressPrefix: vNetBastionSubnetAddressPrefix\n  }\n}\n\nresource vNetName_vNetSubnetName 'Microsoft.Network/virtualNetworks/subnets@2023-09-01' = {\n  parent: vNet\n  name: vNetSubnetName\n  properties: {\n    addressPrefix: vNetSubnetAddressPrefix\n    natGateway: {\n      id: natGateway.id\n    }\n  }\n}\n\nresource bastion 'Microsoft.Network/bastionHosts@2023-09-01' = {\n  name: bastionName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'IpConf'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: bastionPublicIPAddress.id\n          }\n          subnet: {\n            id: vNetName_bastionSubnet.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource bastionPublicIPAddress 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\n  name: bastionPublicIPAddressName\n  location: location\n  sku: {\n    name: lbSkuName\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource networkInterface 'Microsoft.Network/networkInterfaces@2023-09-01' = [for i in range(0, numberOfInstances): {\n  name: '${networkInterfaceName}${i}'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: vNetName_vNetSubnetName.id\n          }\n          loadBalancerBackendAddressPools: [\n            {\n              id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadBalancerName, 'BackendPool1')\n            }\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vNet\n    loadBalancer\n  ]\n}]\n\nresource loadBalancer 'Microsoft.Network/loadBalancers@2023-09-01' = {\n  name: loadBalancerName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    frontendIPConfigurations: [\n      {\n        properties: {\n          subnet: {\n            id: vNetName_vNetSubnetName.id\n          }\n          privateIPAddress: lbFrontendIPAddress\n          privateIPAllocationMethod: 'Static'\n        }\n        name: 'LoadBalancerFrontend'\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: 'BackendPool1'\n      }\n    ]\n    loadBalancingRules: [\n      {\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIpConfigurations', loadBalancerName, 'LoadBalancerFrontend')\n          }\n          backendAddressPool: {\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadBalancerName, 'BackendPool1')\n          }\n          probe: {\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadBalancerName, 'lbprobe')\n          }\n          protocol: 'Tcp'\n          frontendPort: 80\n          backendPort: 80\n          idleTimeoutInMinutes: 15\n        }\n        name: 'lbrule'\n      }\n    ]\n    probes: [\n      {\n        properties: {\n          protocol: 'Tcp'\n          port: 80\n          intervalInSeconds: 15\n          numberOfProbes: 2\n        }\n        name: 'lbprobe'\n      }\n    ]\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'StorageV2'\n}\n\nresource vm 'Microsoft.Compute/virtualMachines@2023-09-01' = [for i in range(0, numberOfInstances): {\n  name: '${vmNamePrefix}${i}'\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: '${vmNamePrefix}${i}'\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2019-Datacenter'\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkInterface[i].id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: storageAccount.properties.primaryEndpoints.blob\n      }\n    }\n  }\n}]\n\noutput location string = location\noutput name string = loadBalancer.name\noutput resourceGroupName string = resourceGroup().name\noutput resourceId string = loadBalancer.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1211?"}, {"role": "assistant", "content": "@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Virtual network name')\nparam virtualNetworkName string\n@description('Virtual network address prefix')\nparam virtualNetworkPrefix string\n@description('Subnet name')\nparam subnetName string\n@description('Subnet prefix')\nparam subnetPrefix string\n\n@description('Load balancer name')\nparam loadBalancerName string = 'loadBalancer-${uniqueString(subscription().id)}'\n@description('Load balancer sku')\nparam lbsku string = 'Standard'\n@description('Load balancer rule name')\nparam lbrulename string = '${loadBalancerName}-HARule'\n@description('Load balancer probe name')\nparam lbprobename string = '${loadBalancerName}HealthProbe'\n@description('Load balancer backend pool network interface name')\nparam networkInterfaceName string = 'networkInterface1'\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2024-01-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        virtualNetworkPrefix\n      ]\n    }\n  }\n}\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2024-01-01' = {\n  parent: virtualNetwork\n  name: subnetName\n  properties: {\n    addressPrefix: subnetPrefix\n  }\n}\n\nresource loadBalancer 'Microsoft.Network/loadBalancers@2024-01-01' = {\n  name: loadBalancerName\n  location: location\n  sku: {\n    name: lbsku\n  }\n  properties: {\n    frontendIPConfigurations: [\n      {\n        name: 'loadBalancerFrontEnd'\n        properties: {\n          subnet: {\n            id: subnet.id\n          }\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: 'loadBalancerBackEnd'\n      }\n    ]\n    loadBalancingRules: [\n      {\n        name: lbrulename\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId( 'Microsoft.Network/loadBalancers/frontendIpConfigurations', loadBalancerName, 'loadBalancerFrontEnd')\n          }\n          backendAddressPool: {\n            id: resourceId( 'Microsoft.Network/loadBalancers/backendAddressPools', loadBalancerName, 'loadBalancerBackEnd')\n          }\n          probe: {\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadBalancerName, lbprobename)\n          }\n          protocol: 'All'\n          frontendPort: 0\n          backendPort: 0\n          enableFloatingIP: false\n          enableTcpReset: true\n          loadDistribution: 'Default'\n          disableOutboundSnat: true\n          idleTimeoutInMinutes: 15\n        }\n      }\n    ]\n    probes: [\n      {\n        name: lbprobename\n        properties: {\n          protocol: 'Tcp'\n          port: 80\n          intervalInSeconds: 15\n          numberOfProbes: 2\n        }\n      }\n    ]\n  }\n}\n\nresource networkInterface 'Microsoft.Network/networkInterfaces@2024-01-01' = {\n  name: networkInterfaceName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipConfig'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: subnet.id\n          }\n          loadBalancerBackendAddressPools: [\n            {\n              id: loadBalancer.properties.backendAddressPools[0].id\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1212."}, {"role": "assistant", "content": "// Name for project\n@description('Specifies a project name that is used for generating resource names.')\nparam projectName string\n\n@description('Specifies the location for the global load balancer.  Available in limited regions.')\n@allowed([\n  'eastus2'\n  'westus'\n  'centralus'\n  'westeurope'\n  'southeastasia'\n  'centralus'\n  'northeurope'\n  'eastasia'\n  'UKsouth'\n  'USgovvirginia'\n])\nparam locationCr string = 'eastus2'\n\n@description('Specifies the location for the regional load balancer.')\n@allowed([\n  'eastus'\n  'eastus2'\n  'southcentralus'\n  'westus2'\n  'westus3'\n  'australiaeast'\n  'southeastasia'\n  'northeurope'\n  'swedencentral'\n  'uksouth'\n  'westeurope'\n  'centralus'\n  'southafricanorth'\n  'centralindia'\n  'eastasia'\n  'japaneast'\n  'koreacentral'\n  'canadacentral'\n  'francecentral'\n  'germanywestcentral'\n  'norwayeast'\n  'switzerlandnorth'\n  'uaenorth'\n  'brazilsouth'\n  'eastus2euap'\n  'qatarcentral'\n  'centralusstage'\n  'eastus2stage'\n  'northcentralusstage'\n  'southcentralusstage'\n  'westusstage'\n  'westus2stage'\n  'asia'\n  'asiapacific'\n  'australia'\n  'brazil'\n  'canada'\n  'europe'\n  'france'\n  'germany'\n  'global'\n  'india'\n  'japan'\n  'korea'\n  'norway'\n  'singapore'\n  'southafrica'\n  'switzerland'\n  'unitedstates'\n  'eastasiastage'\n  'eastusstg'\n  'northcentralus'\n  'westus'\n  'jioindiawest'\n  'centraluseuap'\n  'westcentralus'\n  'southafricawest'\n  'australiacentral'\n  'australiacentral2'\n  'australiasoutheast'\n  'japanwest'\n  'jioindiacentral'\n  'koreasouth'\n  'southindia'\n  'westindia'\n  'francesouth'\n  'germanynorth'\n  'norwaywest'\n  'switzerlandwest'\n  'ukwest'\n  'uaecentral'\n  'brazilsoutheast'\n])\nparam locationR1 string = 'eastus'\n\n@description('Specifies the location for the regional load balancer.')\n@allowed([\n  'eastus'\n  'eastus2'\n  'southcentralus'\n  'westus2'\n  'westus3'\n  'australiaeast'\n  'southeastasia'\n  'northeurope'\n  'swedencentral'\n  'uksouth'\n  'westeurope'\n  'centralus'\n  'southafricanorth'\n  'centralindia'\n  'eastasia'\n  'japaneast'\n  'koreacentral'\n  'canadacentral'\n  'francecentral'\n  'germanywestcentral'\n  'norwayeast'\n  'switzerlandnorth'\n  'uaenorth'\n  'brazilsouth'\n  'eastus2euap'\n  'qatarcentral'\n  'centralusstage'\n  'eastus2stage'\n  'northcentralusstage'\n  'southcentralusstage'\n  'westusstage'\n  'westus2stage'\n  'asia'\n  'asiapacific'\n  'australia'\n  'brazil'\n  'canada'\n  'europe'\n  'france'\n  'germany'\n  'global'\n  'india'\n  'japan'\n  'korea'\n  'norway'\n  'singapore'\n  'southafrica'\n  'switzerland'\n  'unitedstates'\n  'eastasiastage'\n  'eastusstg'\n  'northcentralus'\n  'westus'\n  'jioindiawest'\n  'centraluseuap'\n  'westcentralus'\n  'southafricawest'\n  'australiacentral'\n  'australiacentral2'\n  'australiasoutheast'\n  'japanwest'\n  'jioindiacentral'\n  'koreasouth'\n  'southindia'\n  'westindia'\n  'francesouth'\n  'germanynorth'\n  'norwaywest'\n  'switzerlandwest'\n  'ukwest'\n  'uaecentral'\n  'brazilsoutheast'\n])\nparam locationR2 string = 'westus2'\n\n@description('Specifies the virtual machine administrator username.')\nparam adminUsername string\n\n@description('Specifies the virtual machine administrator password.')\n@secure()\nparam adminPassword string\n\n@description('Size of the virtual machine')\nparam vmSize string = 'Standard_DS1_v2'\n\nvar publicIPAddressType = 'Static'\nvar lbSkuName = 'Standard'\nvar vmStorageAccountType = 'Premium_LRS'\nvar lbR1Name = '${projectName}-lb-r1'\nvar lbPIPR1Name = '${projectName}-lbPublicIP-r1'\nvar lbFrontEndR1Name = 'LoadBalancerFrontEnd-r1'\nvar lbBackendPoolR1Name = 'LoadBalancerBackEndPool-r1'\nvar lbProbeR1Name = 'loadBalancerHealthProbe-r1'\nvar nsgR1Name = '${projectName}-nsg-r1'\nvar vnetR1Name = '${projectName}-vnet-r1'\nvar vnetAddressPrefixR1 = '10.0.0.0/16'\nvar vnetSubnetR1Name = 'BackendSubnet-r1'\nvar vnetSubnetAddressPrefixR1 = '10.0.0.0/24'\nvar bastionHostR1Name = '${projectName}-bastion-r1'\nvar bastionSubnetR1Name = 'AzureBastionSubnet'\nvar vnetBastionSubnetAddressPrefixR1 = '10.0.1.0/26'\nvar bastionPIPR1Name = '${projectName}-bastionPublicIP-r1'\nvar natGatewayR1Name = '${projectName}-natgateway-r1'\nvar natGatewayPIR1Name = '${projectName}-natPublicIP-r1'\nvar lbR2Name = '${projectName}-lb-r2'\nvar lbPIPR2Name = '${projectName}-lbPublicIP-r2'\nvar lbFrontEndR2Name = 'LoadBalancerFrontEnd-r2'\nvar lbBackendPoolR2Name = 'LoadBalancerBackEndPool-r2'\nvar lbProbeR2Name = 'loadBalancerHealthProbe-r2'\nvar nsgR2Name = '${projectName}-nsg-r2'\nvar vnetR2Name = '${projectName}-vnet-r2'\nvar vnetAddressPrefixR2 = '10.1.0.0/16'\nvar vnetSubnetR2Name = 'BackendSubnet-r2'\nvar vnetSubnetAddressPrefixR2 = '10.1.0.0/24'\nvar bastionHostR2Name = '${projectName}-bastion-r2'\nvar bastionSubnetR2Name = 'AzureBastionSubnet'\nvar vnetBastionSubnetAddressPrefixR2 = '10.1.1.0/26'\nvar bastionPIPR2Name = '${projectName}-bastionPublicIP-r2'\nvar natGatewayR2Name = '${projectName}-natgateway-r2'\nvar natGatewayPIR2Name = '${projectName}-natPublicIP-r2'\nvar lbCrName = '${projectName}-lb-cr'\nvar lbBackendPoolCrName = 'LoadBalancerBackEndPool-cr'\nvar lbPIPCrName = '${projectName}-lbPublicIP-cr'\nvar lbFrontEndCrName = 'LoadBalancerFrontEnd-cr'\n\nresource nicVmR1 'Microsoft.Network/networkInterfaces@2023-02-01' = [for i in range(0, 3): {\n  name: 'vm-r1-${(i + 1)}-networkInterface'\n  location: locationR1\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: vnetSubnetR1.id\n          }\n          loadBalancerBackendAddressPools: [\n            {\n              id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbR1Name, lbBackendPoolR1Name)\n            }\n          ]\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: nsgR1.id\n    }\n  }\n  dependsOn: [\n    vnetR1\n    lbR1\n  ]\n}]\n\nresource installWebServerVmR1 'Microsoft.Compute/virtualMachines/extensions@2023-03-01' = [for i in range(0, 3): {\n  name: 'vm-r1-${(i + 1)}/InstallWebServer'\n  location: locationR1\n  properties: {\n    publisher: 'Microsoft.Compute'\n    type: 'CustomScriptExtension'\n    typeHandlerVersion: '1.7'\n    autoUpgradeMinorVersion: true\n    settings: {\n      commandToExecute: 'powershell.exe Install-WindowsFeature -name Web-Server -IncludeManagementTools && powershell.exe remove-item \\'C:\\\\inetpub\\\\wwwroot\\\\iisstart.htm\\' && powershell.exe Add-Content -Path \\'C:\\\\inetpub\\\\wwwroot\\\\iisstart.htm\\' -Value $(\\'Hello World from \\' + $env:computername)'\n    }\n  }\n  dependsOn: [\n    vmR2\n  ]\n}]\n\nresource vmR1 'Microsoft.Compute/virtualMachines@2023-03-01' = [for i in range(0, 3): {\n  name: 'vm-r1-${(i + 1)}'\n  location: locationR1\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2019-Datacenter'\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'fromImage'\n        managedDisk: {\n          storageAccountType: vmStorageAccountType\n        }\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: resourceId('Microsoft.Network/networkInterfaces', 'vm-r1-${(i + 1)}-networkInterface')\n        }\n      ]\n    }\n    osProfile: {\n      computerName: 'vm-r1-${(i + 1)}'\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        enableAutomaticUpdates: true\n        provisionVMAgent: true\n      }\n    }\n  }\n  dependsOn: [\n    nicVmR2\n  ]\n}]\n\nresource vnetSubnetR1Bastion 'Microsoft.Network/virtualNetworks/subnets@2023-02-01' = {\n  parent: vnetR1\n  name: bastionSubnetR1Name\n  properties: {\n    addressPrefix: vnetBastionSubnetAddressPrefixR1\n  }\n}\n\nresource vnetSubnetR1 'Microsoft.Network/virtualNetworks/subnets@2023-02-01' = {\n  parent: vnetR1\n  name: vnetSubnetR1Name\n  properties: {\n    addressPrefix: vnetSubnetAddressPrefixR1\n    natGateway: {\n      id: natGatewayR1.id\n    }\n  }\n  dependsOn: [\n\n    vnetSubnetR1Bastion\n  ]\n}\n\nresource bastionHostR1 'Microsoft.Network/bastionHosts@2023-02-01' = {\n  name: bastionHostR1Name\n  location: locationR1\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'IpConf'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: bastionPIPR1.id\n          }\n          subnet: {\n            id: vnetSubnetR1Bastion.id\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n\n    vnetR1\n\n  ]\n}\n\nresource bastionPIPR1 'Microsoft.Network/publicIPAddresses@2023-02-01' = {\n  name: bastionPIPR1Name\n  location: locationR1\n  sku: {\n    name: lbSkuName\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource natGatewayR1 'Microsoft.Network/natGateways@2021-05-01' = {\n  name: natGatewayR1Name\n  location: locationR1\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    idleTimeoutInMinutes: 4\n    publicIpAddresses: [\n      {\n        id: natGatewayPIPR1.id\n      }\n    ]\n  }\n}\n\nresource natGatewayPIPR1 'Microsoft.Network/publicIPAddresses@2021-05-01' = {\n  name: natGatewayPIR1Name\n  location: locationR1\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    idleTimeoutInMinutes: 4\n  }\n}\n\nresource lbR1 'Microsoft.Network/loadBalancers@2023-02-01' = {\n  name: lbR1Name\n  location: locationR1\n  sku: {\n    name: lbSkuName\n  }\n  properties: {\n    frontendIPConfigurations: [\n      {\n        name: lbFrontEndR1Name\n        properties: {\n          publicIPAddress: {\n            id: lbPIPR1.id\n          }\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: lbBackendPoolR1Name\n      }\n    ]\n    loadBalancingRules: [\n      {\n        name: 'myHTTPRule'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', lbR1Name, lbFrontEndR1Name)\n          }\n          backendAddressPool: {\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbR1Name, lbBackendPoolR1Name)\n          }\n          frontendPort: 80\n          backendPort: 80\n          enableFloatingIP: false\n          idleTimeoutInMinutes: 15\n          protocol: 'Tcp'\n          enableTcpReset: true\n          loadDistribution: 'Default'\n          disableOutboundSnat: true\n          probe: {\n            id: resourceId('Microsoft.Network/loadBalancers/probes', lbR1Name, lbProbeR1Name)\n          }\n        }\n      }\n    ]\n    probes: [\n      {\n        name: lbProbeR1Name\n        properties: {\n          protocol: 'Http'\n          port: 80\n          requestPath: '/'\n          intervalInSeconds: 5\n          numberOfProbes: 2\n        }\n      }\n    ]\n    outboundRules: []\n  }\n}\n\nresource lbPIPR1 'Microsoft.Network/publicIPAddresses@2023-02-01' = {\n  name: lbPIPR1Name\n  location: locationR1\n  sku: {\n    name: lbSkuName\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource nsgR1 'Microsoft.Network/networkSecurityGroups@2023-02-01' = {\n  name: nsgR1Name\n  location: locationR1\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowHTTPInbound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          destinationPortRange: '80'\n          sourceAddressPrefix: 'Internet'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 100\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource vnetR1 'Microsoft.Network/virtualNetworks@2023-02-01' = {\n  name: vnetR1Name\n  location: locationR1\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefixR1\n      ]\n    }\n  }\n}\n\nresource nicVmR2 'Microsoft.Network/networkInterfaces@2023-02-01' = [for i in range(0, 3): {\n  name: 'vm-r2-${(i + 1)}-networkInterface'\n  location: locationR2\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: vnetSubnetR2.id\n          }\n          loadBalancerBackendAddressPools: [\n            {\n              id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbR2Name, lbBackendPoolR2Name)\n            }\n          ]\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: nsgR2.id\n    }\n  }\n  dependsOn: [\n    vnetR2\n    lbR2\n  ]\n}]\n\nresource installWebServerVmR2 'Microsoft.Compute/virtualMachines/extensions@2023-03-01' = [for i in range(0, 3): {\n  name: 'vm-r2-${(i + 1)}/InstallWebServer'\n  location: locationR2\n  properties: {\n    publisher: 'Microsoft.Compute'\n    type: 'CustomScriptExtension'\n    typeHandlerVersion: '1.7'\n    autoUpgradeMinorVersion: true\n    settings: {\n      commandToExecute: 'powershell.exe Install-WindowsFeature -name Web-Server -IncludeManagementTools && powershell.exe remove-item \\'C:\\\\inetpub\\\\wwwroot\\\\iisstart.htm\\' && powershell.exe Add-Content -Path \\'C:\\\\inetpub\\\\wwwroot\\\\iisstart.htm\\' -Value $(\\'Hello World from \\' + $env:computername)'\n    }\n  }\n  dependsOn: [\n    vmR2\n  ]\n}]\n\nresource vmR2 'Microsoft.Compute/virtualMachines@2023-03-01' = [for i in range(0, 3): {\n  name: 'vm-r2-${(i + 1)}'\n  location: locationR2\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2019-Datacenter'\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'fromImage'\n        managedDisk: {\n          storageAccountType: vmStorageAccountType\n        }\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: resourceId('Microsoft.Network/networkInterfaces', 'vm-r2-${(i + 1)}-networkInterface')\n        }\n      ]\n    }\n    osProfile: {\n      computerName: 'vm-r2-${(i + 1)}'\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        enableAutomaticUpdates: true\n        provisionVMAgent: true\n      }\n    }\n  }\n  dependsOn: [\n    nicVmR2\n  ]\n}]\n\nresource vnetSubnetR2Bastion 'Microsoft.Network/virtualNetworks/subnets@2023-02-01' = {\n  parent: vnetR2\n  name: bastionSubnetR2Name\n  properties: {\n    addressPrefix: vnetBastionSubnetAddressPrefixR2\n  }\n}\n\nresource vnetSubnetR2 'Microsoft.Network/virtualNetworks/subnets@2023-02-01' = {\n  parent: vnetR2\n  name: vnetSubnetR2Name\n  properties: {\n    addressPrefix: vnetSubnetAddressPrefixR2\n    natGateway: {\n      id: natGatewayR2.id\n    }\n  }\n  dependsOn: [\n\n    vnetSubnetR2Bastion\n  ]\n}\n\nresource bastionHostR2 'Microsoft.Network/bastionHosts@2023-02-01' = {\n  name: bastionHostR2Name\n  location: locationR2\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'IpConf'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: bastionPIPR2.id\n          }\n          subnet: {\n            id: vnetSubnetR2Bastion.id\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n\n    vnetR2\n\n  ]\n}\n\nresource bastionPIPR2 'Microsoft.Network/publicIPAddresses@2023-02-01' = {\n  name: bastionPIPR2Name\n  location: locationR2\n  sku: {\n    name: lbSkuName\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource natGatewayR2 'Microsoft.Network/natGateways@2021-05-01' = {\n  name: natGatewayR2Name\n  location: locationR2\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    idleTimeoutInMinutes: 4\n    publicIpAddresses: [\n      {\n        id: natGatewayPIPR2.id\n      }\n    ]\n  }\n}\n\nresource natGatewayPIPR2 'Microsoft.Network/publicIPAddresses@2021-05-01' = {\n  name: natGatewayPIR2Name\n  location: locationR2\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    idleTimeoutInMinutes: 4\n  }\n}\n\nresource lbR2 'Microsoft.Network/loadBalancers@2023-02-01' = {\n  name: lbR2Name\n  location: locationR2\n  sku: {\n    name: lbSkuName\n  }\n  properties: {\n    frontendIPConfigurations: [\n      {\n        name: lbFrontEndR2Name\n        properties: {\n          publicIPAddress: {\n            id: lbPIPR2.id\n          }\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: lbBackendPoolR2Name\n      }\n    ]\n    loadBalancingRules: [\n      {\n        name: 'myHTTPRule'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', lbR2Name, lbFrontEndR2Name)\n          }\n          backendAddressPool: {\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbR2Name, lbBackendPoolR2Name)\n          }\n          frontendPort: 80\n          backendPort: 80\n          enableFloatingIP: false\n          idleTimeoutInMinutes: 15\n          protocol: 'Tcp'\n          enableTcpReset: true\n          loadDistribution: 'Default'\n          disableOutboundSnat: true\n          probe: {\n            id: resourceId('Microsoft.Network/loadBalancers/probes', lbR2Name, lbProbeR2Name)\n          }\n        }\n      }\n    ]\n    probes: [\n      {\n        name: lbProbeR2Name\n        properties: {\n          protocol: 'Http'\n          port: 80\n          requestPath: '/'\n          intervalInSeconds: 5\n          numberOfProbes: 2\n        }\n      }\n    ]\n    outboundRules: []\n  }\n}\n\nresource lbPIPR2 'Microsoft.Network/publicIPAddresses@2023-02-01' = {\n  name: lbPIPR2Name\n  location: locationR2\n  sku: {\n    name: lbSkuName\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource nsgR2 'Microsoft.Network/networkSecurityGroups@2023-02-01' = {\n  name: nsgR2Name\n  location: locationR2\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowHTTPInbound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          destinationPortRange: '80'\n          sourceAddressPrefix: 'Internet'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 100\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource vnetR2 'Microsoft.Network/virtualNetworks@2023-02-01' = {\n  name: vnetR2Name\n  location: locationR2\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefixR2\n      ]\n    }\n  }\n}\n\nresource lbPIPCr 'Microsoft.Network/publicIPAddresses@2023-02-01' = {\n  name: lbPIPCrName\n  location: locationCr\n  sku: {\n    name: 'Standard'\n    tier: 'Global'\n  }\n  properties: {\n    publicIPAllocationMethod: publicIPAddressType\n  }\n}\n\nresource lbCr 'Microsoft.Network/loadBalancers@2023-02-01' = {\n  name: lbCrName\n  location: locationCr\n  sku: {\n    name: 'Standard'\n    tier: 'Global'\n  }\n  properties: {\n    frontendIPConfigurations: [\n      {\n        name: lbFrontEndCrName\n        properties: {\n          publicIPAddress: {\n            id: lbPIPCr.id\n          }\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: lbBackendPoolCrName\n      }\n    ]\n    loadBalancingRules: [\n      {\n        name: 'LBRule'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', lbCrName, lbFrontEndCrName)\n          }\n          backendAddressPool: {\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbCrName, lbBackendPoolCrName)\n          }\n          protocol: 'Tcp'\n          frontendPort: 80\n          backendPort: 80\n          enableFloatingIP: false\n        }\n      }\n    ]\n  }\n}\n\nresource lbBackendPoolCr 'Microsoft.Network/loadBalancers/backendAddressPools@2023-02-01' = {\n  parent: lbCr\n  name: lbBackendPoolCrName\n  properties: {\n    loadBalancerBackendAddresses: [\n      {\n        name: 'address1'\n        properties: {\n          loadBalancerFrontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', lbR1Name, lbFrontEndR1Name)\n          }\n        }\n      }\n      {\n        name: 'address2'\n        properties: {\n          loadBalancerFrontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', lbR2Name, lbFrontEndR2Name)\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    lbR1\n    lbR2\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1213."}, {"role": "assistant", "content": "@description('Specifies a project name that is used for generating resource names.')\nparam projectName string\n\n@description('Specifies the location for all of the resources created by this template.')\nparam location string = resourceGroup().location\n\n@description('Specifies the virtual machine administrator username.')\nparam adminUsername string\n\n@description('Specifies the virtual machine administrator password.')\n@secure()\nparam adminPassword string\n\n@description('Size of the virtual machine')\nparam vmSize string = 'Standard_D2s_v3'\n\n@description('The Windows version for the VM. This will pick a fully patched image of this given Windows version.')\n@allowed([\n  '2016-datacenter-gensecond'\n  '2016-datacenter-server-core-g2'\n  '2016-datacenter-server-core-smalldisk-g2'\n  '2016-datacenter-smalldisk-g2'\n  '2016-datacenter-with-containers-g2'\n  '2016-datacenter-zhcn-g2'\n  '2019-datacenter-core-g2'\n  '2019-datacenter-core-smalldisk-g2'\n  '2019-datacenter-core-with-containers-g2'\n  '2019-datacenter-core-with-containers-smalldisk-g2'\n  '2019-datacenter-gensecond'\n  '2019-datacenter-smalldisk-g2'\n  '2019-datacenter-with-containers-g2'\n  '2019-datacenter-with-containers-smalldisk-g2'\n  '2019-datacenter-zhcn-g2'\n  '2022-datacenter-azure-edition'\n  '2022-datacenter-azure-edition-core'\n  '2022-datacenter-azure-edition-core-smalldisk'\n  '2022-datacenter-azure-edition-smalldisk'\n  '2022-datacenter-core-g2'\n  '2022-datacenter-core-smalldisk-g2'\n  '2022-datacenter-g2'\n  '2022-datacenter-smalldisk-g2'\n])\nparam OSVersion string = '2022-datacenter-azure-edition'\n\n@description('Linux Sku')\n@allowed([\n  'vs-2019-ent-latest-win11-n-gen2'\n  'vs-2019-pro-general-win11-m365-gen2'\n  'vs-2019-comm-latest-win11-n-gen2'\n  'vs-2019-ent-general-win10-m365-gen2'\n  'vs-2019-ent-general-win11-m365-gen2'\n  'vs-2019-pro-general-win10-m365-gen2'\n])\nparam imageSku string = 'vs-2019-ent-latest-win11-n-gen2'\n\n@description('Security Type of the Virtual Machine.')\n@allowed([\n  'Standard'\n  'TrustedLaunch'\n])\nparam securityType string = 'TrustedLaunch'\n\nvar securityProfileJson = {\n  uefiSettings: {\n    secureBootEnabled: true\n    vTpmEnabled: true\n  }\n  securityType: securityType\n}\nvar lbName = '${projectName}-lb'\nvar lbSkuName = 'Standard'\nvar lbPublicIpAddressName = '${projectName}-lbPublicIP'\nvar lbFrontEndName = 'LoadBalancerFrontEnd'\nvar lbBackendPoolName = 'LoadBalancerBackEndPool'\nvar lbProbeName = 'loadBalancerHealthProbe'\nvar nsgName = '${projectName}-nsg'\nvar vNetName = '${projectName}-vnet'\nvar vNetAddressPrefix = '10.0.0.0/16'\nvar vNetSubnetName = 'BackendSubnet'\nvar vNetSubnetAddressPrefix = '10.0.0.0/24'\nvar bastionName = '${projectName}-bastion'\nvar bastionSubnetName = 'AzureBastionSubnet'\nvar vNetBastionSubnetAddressPrefix = '10.0.1.0/24'\nvar bastionPublicIPAddressName = '${projectName}-bastionPublicIP'\nvar vmStorageAccountType = 'Premium_LRS'\nvar extensionName = 'GuestAttestation'\nvar extensionPublisher = 'Microsoft.Azure.Security.WindowsAttestation'\nvar extensionVersion = '1.0'\nvar maaTenantName = 'GuestAttestation'\nvar maaEndpoint = substring('emptyString', 0, 0)\nvar ascReportingEndpoint = substring('emptystring', 0, 0)\nvar natGatewayName = '${projectName}-natgateway'\nvar natGatewayPublicIPAddressName = '${projectName}-natPublicIP'\n\nresource project_vm_1_networkInterface 'Microsoft.Network/networkInterfaces@2021-08-01' = [for i in range(0, 3): {\n  name: '${projectName}-vm${(i + 1)}-networkInterface'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: vNetName_vNetSubnetName.id\n          }\n          loadBalancerBackendAddressPools: [\n            {\n              id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbName, lbBackendPoolName)\n            }\n          ]\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: nsg.id\n    }\n  }\n  dependsOn: [\n    lb\n  ]\n}]\n\nresource project_vm_1_InstallWebServer 'Microsoft.Compute/virtualMachines/extensions@2021-11-01' = [for i in range(0, 3): {\n  name: '${projectName}-vm${(i + 1)}/InstallWebServer'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Compute'\n    type: 'CustomScriptExtension'\n    typeHandlerVersion: '1.10'\n    autoUpgradeMinorVersion: true\n    settings: {\n      commandToExecute: 'powershell.exe Install-WindowsFeature -name Web-Server -IncludeManagementTools && powershell.exe remove-item \\'C:\\\\inetpub\\\\wwwroot\\\\iisstart.htm\\' && powershell.exe Add-Content -Path \\'C:\\\\inetpub\\\\wwwroot\\\\iisstart.htm\\' -Value $(\\'Hello World from \\' + $env:computername)'\n    }\n  }\n  dependsOn: [\n    project_vm_1\n  ]\n}]\n\nresource project_vm_1 'Microsoft.Compute/virtualMachines@2021-11-01' = [for i in range(1, 3): {\n  name: '${projectName}-vm${i}'\n  location: location\n  zones: [\n    string(i)\n  ]\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: OSVersion\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: vmStorageAccountType\n        }\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: resourceId('Microsoft.Network/networkInterfaces', '${projectName}-vm${i}-networkInterface')\n        }\n      ]\n    }\n    osProfile: {\n      computerName: '${projectName}-vm${i}'\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        enableAutomaticUpdates: true\n        provisionVMAgent: true\n      }\n    }\n    securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\n  }\n  dependsOn: [\n    project_vm_1_networkInterface\n  ]\n}]\n\nresource projectName_vm_1_3_GuestAttestation 'Microsoft.Compute/virtualMachines/extensions@2022-03-01' = [for i in range(1, 3): if ((securityType == 'TrustedLaunch') && ((securityProfileJson.uefiSettings.secureBootEnabled == true) && (securityProfileJson.uefiSettings.vTpmEnabled == true))) {\n  name: '${projectName}-vm${i}/GuestAttestation'\n  location: location\n  properties: {\n    publisher: extensionPublisher\n    type: extensionName\n    typeHandlerVersion: extensionVersion\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      AttestationConfig: {\n        MaaSettings: {\n          maaEndpoint: maaEndpoint\n          maaTenantName: maaTenantName\n        }\n        AscSettings: {\n          ascReportingEndpoint: ascReportingEndpoint\n          ascReportingFrequency: ''\n        }\n        useCustomToken: 'false'\n        disableAlerts: 'false'\n      }\n    }\n  }\n  dependsOn: [\n    project_vm_1\n  ]\n}]\n\nresource natGateway 'Microsoft.Network/natGateways@2021-05-01' = {\n  name: natGatewayName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    idleTimeoutInMinutes: 4\n    publicIpAddresses: [\n      {\n        id: natGatewayPublicIPAddress.id\n      }\n    ]\n  }\n}\n\nresource natGatewayPublicIPAddress 'Microsoft.Network/publicIPAddresses@2021-05-01' = {\n  name: natGatewayPublicIPAddressName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    idleTimeoutInMinutes: 4\n  }\n}\n\nresource vNetName_bastionSubnet 'Microsoft.Network/virtualNetworks/subnets@2021-08-01' = {\n  parent: vNet\n  name: bastionSubnetName\n  properties: {\n    addressPrefix: vNetBastionSubnetAddressPrefix\n  }\n  dependsOn: [\n    vNetName_vNetSubnetName\n  ]\n}\n\nresource vNetName_vNetSubnetName 'Microsoft.Network/virtualNetworks/subnets@2021-08-01' = {\n  parent: vNet\n  name: vNetSubnetName\n  properties: {\n    addressPrefix: vNetSubnetAddressPrefix\n    natGateway: {\n      id: natGateway.id\n    }\n  }\n}\n\nresource bastion 'Microsoft.Network/bastionHosts@2021-08-01' = {\n  name: bastionName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'IpConf'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: bastionPublicIPAddress.id\n          }\n          subnet: {\n            id: vNetName_bastionSubnet.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource bastionPublicIPAddress 'Microsoft.Network/publicIPAddresses@2021-08-01' = {\n  name: bastionPublicIPAddressName\n  location: location\n  sku: {\n    name: lbSkuName\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource lb 'Microsoft.Network/loadBalancers@2021-08-01' = {\n  name: lbName\n  location: location\n  sku: {\n    name: lbSkuName\n  }\n  properties: {\n    frontendIPConfigurations: [\n      {\n        name: lbFrontEndName\n        properties: {\n          publicIPAddress: {\n            id: lbPublicIPAddress.id\n          }\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: lbBackendPoolName\n      }\n    ]\n    loadBalancingRules: [\n      {\n        name: 'myHTTPRule'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', lbName, lbFrontEndName)\n          }\n          backendAddressPool: {\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbName, lbBackendPoolName)\n          }\n          frontendPort: 80\n          backendPort: 80\n          enableFloatingIP: false\n          idleTimeoutInMinutes: 15\n          protocol: 'Tcp'\n          enableTcpReset: true\n          loadDistribution: 'Default'\n          disableOutboundSnat: true\n          probe: {\n            id: resourceId('Microsoft.Network/loadBalancers/probes', lbName, lbProbeName)\n          }\n        }\n      }\n    ]\n    probes: [\n      {\n        name: lbProbeName\n        properties: {\n          protocol: 'Tcp'\n          port: 80\n          intervalInSeconds: 5\n          numberOfProbes: 2\n        }\n      }\n    ]\n    outboundRules: [\n    ]\n  }\n}\n\nresource lbPublicIPAddress 'Microsoft.Network/publicIPAddresses@2021-08-01' = {\n  name: lbPublicIpAddressName\n  location: location\n  sku: {\n    name: lbSkuName\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\nresource nsg 'Microsoft.Network/networkSecurityGroups@2021-08-01' = {\n  name: nsgName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'AllowHTTPInbound'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          destinationPortRange: '80'\n          sourceAddressPrefix: 'Internet'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 100\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource vNet 'Microsoft.Network/virtualNetworks@2021-08-01' = {\n  name: vNetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vNetAddressPrefix\n      ]\n    }\n  }\n}\n\noutput location string = location\noutput name string = lb.name\noutput resourceGroupName string = resourceGroup().name\noutput resourceId string = lb.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1214?"}, {"role": "assistant", "content": "@description('Name of the virtual machine')\nparam vmname string = 'vm-1'\n\n@description('Size of the virtual machine')\nparam vmsize string = 'Standard_D2s_v3'\n\n@description('Name of the virtual network')\nparam vnetname string = 'vnet-1'\n\n@description('Name of the subnet for virtual network')\nparam subnetname string = 'subnet-1'\n\n@description('Address space for virtual network')\nparam vnetaddressspace string = '10.0.0.0/16'\n\n@description('Subnet prefix for virtual network')\nparam vnetsubnetprefix string = '10.0.0.0/24'\n\n@description('Name of the NAT gateway')\nparam natgatewayname string = 'nat-gateway'\n\n@description('Name of the virtual machine nic')\nparam networkinterfacename string = 'nic-1'\n\n@description('Name of the NAT gateway public IP')\nparam publicipname string = 'public-ip-nat'\n\n@description('Name of the Bastion host')\nparam bastionName string = 'bastion-host'\n\n@description('Name of the virtual machine NSG')\nparam nsgname string = 'nsg-1'\n\n@description('Administrator username for virtual machine')\nparam adminusername string\n\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\n@allowed([\n  'sshPublicKey'\n  'password'\n])\nparam authenticationType string = 'sshPublicKey'\n\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\n@secure()\nparam adminPasswordOrKey string\n\n@description('Name of resource group')\nparam location string = resourceGroup().location\n\nvar linuxConfiguration = {\n  disablePasswordAuthentication: true\n  ssh: {\n    publicKeys: [\n      {\n        path: '/home/${adminusername}/.ssh/authorized_keys'\n        keyData: adminPasswordOrKey\n      }\n    ]\n  }\n}\n\nresource nsg 'Microsoft.Network/networkSecurityGroups@2024-01-01' = {\n  name: nsgname\n  location: location\n  properties: {}\n}\n\nresource publicip 'Microsoft.Network/publicIPAddresses@2024-01-01' = {\n  name: publicipname\n  location: location\n  sku: {\n    name: 'StandardV2'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    idleTimeoutInMinutes: 4\n  }\n}\n\nresource vm 'Microsoft.Compute/virtualMachines@2023-09-01' = {\n  name: vmname\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmsize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'Canonical'\n        offer: '0001-com-ubuntu-server-jammy'\n        sku: '22_04-lts-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        osType: 'Linux'\n        name: '${vmname}_disk1'\n        createOption: 'FromImage'\n        caching: 'ReadWrite'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n        diskSizeGB: 30\n      }\n    }\n    osProfile: {\n      computerName: vmname\n      adminUsername: adminusername\n      adminPassword: adminPasswordOrKey\n      linuxConfiguration: ((authenticationType == 'password') ? null : linuxConfiguration)\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkinterface.id\n        }\n      ]\n    }\n  }\n}\n\nresource vnet 'Microsoft.Network/virtualNetworks@2024-01-01' = {\n  name: vnetname\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetaddressspace\n      ]\n    }\n    subnets: [\n      {\n        name: subnetname\n        properties: {\n          addressPrefix: vnetsubnetprefix\n          natGateway: {\n            id: natgateway.id\n          }\n          privateEndpointNetworkPolicies: 'Enabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n        }\n      }\n    ]\n    enableDdosProtection: false\n    enableVmProtection: false\n  }\n}\n\nresource natgateway 'Microsoft.Network/natGateways@2024-01-01' = {\n  name: natgatewayname\n  location: location\n  sku: {\n    name: 'StandardV2'\n  }\n  properties: {\n    idleTimeoutInMinutes: 4\n    publicIpAddresses: [\n      {\n        id: publicip.id\n      }\n    ]\n  }\n}\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2024-01-01' = {\n  parent: vnet\n  name: 'subnet-1'\n  properties: {\n    addressPrefix: vnetsubnetprefix\n    natGateway: {\n      id: natgateway.id\n    }\n    privateEndpointNetworkPolicies: 'Enabled'\n    privateLinkServiceNetworkPolicies: 'Enabled'\n  }\n}\n\nresource networkinterface 'Microsoft.Network/networkInterfaces@2024-01-01' = {\n  name: networkinterfacename\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig-1'\n        properties: {\n          privateIPAddress: '10.0.0.4'\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: subnet.id\n          }\n          primary: true\n          privateIPAddressVersion: 'IPv4'\n        }\n      }\n    ]\n    enableAcceleratedNetworking: false\n    enableIPForwarding: false\n    networkSecurityGroup: {\n      id: nsg.id\n    }\n  }\n}\n\nresource bastionHost 'Microsoft.Network/bastionHosts@2024-01-01' = {\n  name: bastionName\n  location: location\n  sku: {\n    name: 'Developer'\n  }\n  properties: {\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n\noutput location string = location\noutput name string = natgateway.name\noutput resourceGroupName string = resourceGroup().name\noutput resourceId string = natgateway.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1215."}, {"role": "assistant", "content": "@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Resource name prefix.')\nparam resourcePrefix string = 'natfw-${uniqueString(resourceGroup().id)}'\n\n@description('Admin username for the virtual machine.')\nparam adminUsername string = 'azureuser'\n\n@description('SSH public key for the virtual machine.')\n@secure()\nparam adminSshKey string\n\n@description('Size of the virtual machine.')\nparam vmSize string = 'Standard_DS1_v2'\n\n// Hub Virtual Network\nresource hubVirtualNetwork 'Microsoft.Network/virtualNetworks@2024-05-01' = {\n  name: '${resourcePrefix}-vnet-hub'\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/16'\n      ]\n    }\n    subnets: [\n      {\n        name: 'subnet-1'\n        properties: {\n          addressPrefix: '10.0.0.0/24'\n        }\n      }\n      {\n        name: 'AzureFirewallSubnet'\n        properties: {\n          addressPrefix: '10.0.1.64/26'\n          natGateway: {\n            id: natGateway.id\n          }\n        }\n      }\n    ]\n  }\n}\n\n// Spoke Virtual Network\nresource spokeVirtualNetwork 'Microsoft.Network/virtualNetworks@2024-05-01' = {\n  name: '${resourcePrefix}-vnet-spoke'\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.1.0.0/16'\n      ]\n    }\n    subnets: [\n      {\n        name: 'subnet-private'\n        properties: {\n          addressPrefix: '10.1.0.0/24'\n          routeTable: {\n            id: routeTableSpoke.id\n          }\n        }\n      }\n    ]\n  }\n}\n\n// Azure Bastion\nresource bastion 'Microsoft.Network/bastionHosts@2024-01-01' = {\n  name: '${resourcePrefix}-bastion'\n  location: location\n  sku: {\n    name: 'Developer'\n  }\n  properties: {\n    virtualNetwork: {\n      id: hubVirtualNetwork.id\n    }\n  }\n}\n\n// Public IP for Azure Firewall\nresource firewallPublicIP 'Microsoft.Network/publicIPAddresses@2024-05-01' = {\n  name: '${resourcePrefix}-public-ip-firewall'\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\n// Firewall Policy\nresource firewallPolicy 'Microsoft.Network/firewallPolicies@2024-05-01' = {\n  name: '${resourcePrefix}-firewall-policy'\n  location: location\n  properties: {}\n}\n\n// Network Rule Collection Group for Firewall Policy\nresource networkRuleCollectionGroup 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2024-05-01' = {\n  name: 'DefaultNetworkRuleCollectionGroup'\n  parent: firewallPolicy\n  properties: {\n    priority: 200\n    ruleCollections: [\n      {\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        name: 'spoke-to-internet'\n        priority: 100\n        action: {\n          type: 'Allow'\n        }\n        rules: [\n          {\n            ruleType: 'NetworkRule'\n            name: 'allow-web'\n            ipProtocols: [\n              'TCP'\n            ]\n            sourceAddresses: [\n              '10.1.0.0/24'\n            ]\n            destinationAddresses: [\n              '*'\n            ]\n            destinationPorts: [\n              '80'\n              '443'\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n\n// Azure Firewall\nresource firewall 'Microsoft.Network/azureFirewalls@2024-05-01' = {\n  name: '${resourcePrefix}-firewall'\n  location: location\n  properties: {\n    sku: {\n      name: 'AZFW_VNet'\n      tier: 'Standard'\n    }\n    ipConfigurations: [\n      {\n        name: 'AzureFirewallIpConfiguration'\n        properties: {\n          publicIPAddress: {\n            id: firewallPublicIP.id\n          }\n          subnet: {\n            id: '${hubVirtualNetwork.id}/subnets/AzureFirewallSubnet'\n          }\n        }\n      }\n    ]\n    firewallPolicy: {\n      id: firewallPolicy.id\n    }\n  }\n  dependsOn: [\n    networkRuleCollectionGroup\n  ]\n}\n\n// Public IP for NAT Gateway\nresource natGatewayPublicIP 'Microsoft.Network/publicIPAddresses@2024-05-01' = {\n  name: '${resourcePrefix}-public-ip-nat'\n  location: location\n  sku: {\n    name: 'StandardV2'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\n\n// NAT Gateway\nresource natGateway 'Microsoft.Network/natGateways@2024-05-01' = {\n  name: '${resourcePrefix}-nat-gateway'\n  location: location\n  sku: {\n    name: 'StandardV2'\n  }\n  properties: {\n    idleTimeoutInMinutes: 4\n    publicIpAddresses: [\n      {\n        id: natGatewayPublicIP.id\n      }\n    ]\n  }\n}\n\n// Virtual Network Peering - Hub to Spoke\nresource hubToSpokeVnetPeering 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2024-05-01' = {\n  name: 'vnet-hub-to-vnet-spoke'\n  parent: hubVirtualNetwork\n  properties: {\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: true\n    allowGatewayTransit: false\n    useRemoteGateways: false\n    remoteVirtualNetwork: {\n      id: spokeVirtualNetwork.id\n    }\n  }\n}\n\n// Virtual Network Peering - Spoke to Hub\nresource spokeToHubVnetPeering 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2024-05-01' = {\n  name: 'vnet-spoke-to-vnet-hub'\n  parent: spokeVirtualNetwork\n  properties: {\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: true\n    allowGatewayTransit: false\n    useRemoteGateways: false\n    remoteVirtualNetwork: {\n      id: hubVirtualNetwork.id\n    }\n  }\n}\n\n// Route Table for Spoke Network\nresource routeTableSpoke 'Microsoft.Network/routeTables@2024-05-01' = {\n  name: '${resourcePrefix}-route-table-spoke'\n  location: location\n  properties: {\n    disableBgpRoutePropagation: true\n    routes: [\n      {\n        name: 'route-to-hub'\n        properties: {\n          addressPrefix: '0.0.0.0/0'\n          nextHopType: 'VirtualAppliance'\n          nextHopIpAddress: firewall.properties.ipConfigurations[0].properties.privateIPAddress\n        }\n      }\n    ]\n  }\n}\n\n// Network Security Group for VM\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2024-05-01' = {\n  name: '${resourcePrefix}-nsg-vm'\n  location: location\n  properties: {}\n}\n\n// Network Interface for VM\nresource vmNetworkInterface 'Microsoft.Network/networkInterfaces@2024-05-01' = {\n  name: '${resourcePrefix}-nic-vm-spoke'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: '${spokeVirtualNetwork.id}/subnets/subnet-private'\n          }\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: networkSecurityGroup.id\n    }\n  }\n}\n\n// Variables for Linux VM configuration\nvar linuxConfiguration = {\n  disablePasswordAuthentication: true\n  ssh: {\n    publicKeys: [\n      {\n        path: '/home/${adminUsername}/.ssh/authorized_keys'\n        keyData: adminSshKey\n      }\n    ]\n  }\n}\n\n// Virtual Machine in Spoke Network\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2024-07-01' = {\n  name: '${resourcePrefix}-vm-spoke'\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: '${resourcePrefix}-vm'\n      adminUsername: adminUsername\n      linuxConfiguration: linuxConfiguration\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'Canonical'\n        offer: '0001-com-ubuntu-server-jammy'\n        sku: '22_04-lts-gen2'\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Standard_LRS'\n        }\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: vmNetworkInterface.id\n        }\n      ]\n    }\n  }\n}\n\n// Outputs\noutput hubVnetId string = hubVirtualNetwork.id\noutput spokeVnetId string = spokeVirtualNetwork.id\noutput firewallPrivateIP string = firewall.properties.ipConfigurations[0].properties.privateIPAddress\noutput natGatewayPublicIP string = natGatewayPublicIP.properties.ipAddress\noutput vmPrivateIP string = vmNetworkInterface.properties.ipConfigurations[0].properties.privateIPAddress\noutput bastionFqdn string = bastion.properties.dnsName\noutput resourceGroupName string = resourceGroup().name\noutput vmName string = virtualMachine.name\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1216."}, {"role": "assistant", "content": "@description('Name of the virtual network')\nparam vnetName string = 'myVnet'\n\n@description('Name of the subnet for virtual network')\nparam subnetName string = 'mySubnet'\n\n@description('Address space for virtual network')\nparam vnetAddressSpace string = '10.0.0.0/16'\n\n@description('Subnet prefix for virtual network')\nparam vnetSubnetPrefix string = '10.0.0.0/24'\n\n@description('Name of the NAT gateway resource')\nparam natGatewayName string = 'myNATgateway'\n\n@description('dns of the public ip address, leave blank for no dns')\nparam publicIpDns string = 'gw-${uniqueString(resourceGroup().id)}'\n\n@description('Location of resources')\nparam location string = resourceGroup().location\n\nvar publicIpName = '${natGatewayName}-ip'\nvar publicIpAddresses = [\n  {\n    id: publicIp.id\n  }\n]\n\nresource publicIp 'Microsoft.Network/publicIPAddresses@2024-01-01' = {\n  name: publicIpName\n  location: location\n  sku: {\n    name: 'StandardV2'\n  }\n  properties: {\n    publicIPAddressVersion: 'IPv4'\n    publicIPAllocationMethod: 'Static'\n    idleTimeoutInMinutes: 4\n    dnsSettings: {\n      domainNameLabel: publicIpDns\n    }\n  }\n}\n\nresource natGateway 'Microsoft.Network/natGateways@2024-01-01' = {\n  name: natGatewayName\n  location: location\n  sku: {\n    name: 'StandardV2'\n  }\n  properties: {\n    idleTimeoutInMinutes: 4\n    publicIpAddresses: !empty(publicIpDns) ? publicIpAddresses : null\n  }\n}\n\nresource vnet 'Microsoft.Network/virtualNetworks@2024-01-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressSpace\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: vnetSubnetPrefix\n          natGateway: {\n            id: natGateway.id\n          }\n          privateEndpointNetworkPolicies: 'Enabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n        }\n      }\n    ]\n    enableDdosProtection: false\n    enableVmProtection: false\n  }\n}\n\n\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1217."}, {"role": "assistant", "content": "param location string = resourceGroup().location\nparam keyVaultName string = 'kv-${uniqueString(resourceGroup().id)}'\nparam nspName string = 'networkSecurityPerimeter'\nparam profileName string = 'profile1'\nparam inboundIpv4AccessRuleName string = 'inboundRule'\nparam outboundFqdnAccessRuleName string = 'outboundRule'\nparam associationName string = 'networkSecurityPerimeterAssociation'\n\nresource keyVault 'Microsoft.KeyVault/vaults@2022-07-01' = {\n    name: keyVaultName\n    location: location\n    properties: {\n        sku: {\n            family: 'A'\n            name: 'standard'\n        }\n        tenantId: subscription().tenantId\n        accessPolicies: []\n        enabledForDeployment: false\n        enabledForDiskEncryption: false\n        enabledForTemplateDeployment: false\n        enableSoftDelete: true\n        softDeleteRetentionInDays: 90\n        enableRbacAuthorization: false\n    }\n}\n\nresource networkSecurityPerimeter 'Microsoft.Network/networkSecurityPerimeters@2023-07-01-preview' = {\n    name: nspName\n    location: location\n    properties: {}\n}\n\nresource profile 'Microsoft.Network/networkSecurityPerimeters/profiles@2023-07-01-preview' = {\n    parent: networkSecurityPerimeter\n    name: profileName\n    location: location\n    properties: {}\n}\n\nresource inboundAccessRule 'Microsoft.Network/networkSecurityPerimeters/profiles/accessRules@2023-07-01-preview' = {\n    parent: profile\n    name: inboundIpv4AccessRuleName\n    location: location\n    properties: {\n        direction: 'Inbound'\n        addressPrefixes: [\n            '100.10.0.0/16'\n        ]\n        fullyQualifiedDomainNames: []\n        subscriptions: []\n        emailAddresses: []\n        phoneNumbers: []\n    }\n}\n\nresource outboundAccessRule 'Microsoft.Network/networkSecurityPerimeters/profiles/accessRules@2023-07-01-preview' = {\n    parent: profile\n    name: outboundFqdnAccessRuleName\n    location: location\n    properties: {\n        direction: 'Outbound'\n        addressPrefixes: []\n        fullyQualifiedDomainNames: [\n            'contoso.com'\n        ]\n        subscriptions: []\n        emailAddresses: []\n        phoneNumbers: []\n    }\n}\n\nresource resourceAssociation 'Microsoft.Network/networkSecurityPerimeters/resourceAssociations@2023-07-01-preview' = {\n    parent: networkSecurityPerimeter\n    name: associationName\n    location: location\n    properties: {\n        privateLinkResource: {\n            id: keyVault.id\n        }\n        profile: {\n            id: profile.id\n        }\n        accessMode: 'Enforced'\n    }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1218 please."}, {"role": "assistant", "content": "@description('Network Watcher name')\nparam networkWatcherName string\n\n@description('Location of Network Watcher')\nparam location string = resourceGroup().location\n\n@description('Enable delete lock')\nparam enableDeleteLock bool = false\n\nvar lockName = '${networkWatcher.name}-lck'\n\nresource networkWatcher 'Microsoft.Network/networkWatchers@2021-02-01' = {\n  name: networkWatcherName\n  location: location\n  properties: {}\n}\n\nresource lock 'Microsoft.Authorization/locks@2016-09-01' = if (enableDeleteLock) {\n  scope: networkWatcher\n  name: lockName\n  properties: {\n    level: 'CanNotDelete'\n  }\n}\n\noutput name string = networkWatcher.name\noutput id string = networkWatcher.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1219?"}, {"role": "assistant", "content": "@description('Name of the Network Watcher attached to your subscription. Format: NetworkWatcher_<region_name>')\nparam networkWatcherName string = 'NetworkWatcher_${location}'\n\n@description('Name of your Flow log resource')\nparam flowLogName string = 'FlowLog1'\n\n@description('Region where you resources are located')\nparam location string = resourceGroup().location\n\n@description('Resource ID of the target NSG')\nparam existingNSG string\n\n@description('Retention period in days. Default is zero which stands for permanent retention. Can be any Integer from 0 to 365')\n@minValue(0)\n@maxValue(365)\nparam retentionDays int = 0\n\n@description('FlowLogs Version. Correct values are 1 or 2 (default)')\n@allowed([\n  1\n  2\n])\nparam flowLogsVersion int = 2\n\n@description('Storage Account type')\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_ZRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\nvar storageAccountName = 'flowlogs${uniqueString(resourceGroup().id)}'\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-09-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'StorageV2'\n  properties: {}\n}\n\nresource networkWatcher 'Microsoft.Network/networkWatchers@2022-01-01' = {\n  name: networkWatcherName\n  location: location\n  properties: {}\n}\n\nresource flowLog 'Microsoft.Network/networkWatchers/flowLogs@2022-01-01' = {\n  name: '${networkWatcherName}/${flowLogName}'\n  location: location\n  properties: {\n    targetResourceId: existingNSG\n    storageId: storageAccount.id\n    enabled: true\n    retentionPolicy: {\n      days: retentionDays\n      enabled: true\n    }\n    format: {\n      type: 'JSON'\n      version: flowLogsVersion\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1220."}, {"role": "assistant", "content": "@description('Address prefix')\nparam addressPrefix string = '10.0.0.0/16'\n\n@description('Subnet-1 Prefix')\nparam subnetPrefix string = '10.0.0.0/24'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar virtualNetworkName = 'virtualNetwork1'\nvar subnetName = 'subnet'\nvar networkSecurityGroupName = 'networkSecurityGroup1'\n\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2022-01-01' = {\n  name: networkSecurityGroupName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'first_rule'\n        properties: {\n          description: 'This is the first rule'\n          protocol: 'Tcp'\n          sourcePortRange: '23-45'\n          destinationPortRange: '46-56'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 123\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-01-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        addressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: subnetPrefix\n          networkSecurityGroup: {\n            id: networkSecurityGroup.id\n          }\n        }\n      }\n    ]\n  }\n}\n\noutput existingNSG string = networkSecurityGroup.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1221?"}, {"role": "assistant", "content": "@description('Network security group name')\nparam nsgName string = uniqueString(resourceGroup().id)\n\n@description('Network security group location')\nparam location string = resourceGroup().location\n\n@description('Array containing security rules. For properties format refer to https://docs.microsoft.com/en-us/azure/templates/microsoft.network/networksecuritygroups?tabs=bicep#securityrulepropertiesformat')\nparam securityRules array = []\n\n@description('Enable delete lock')\nparam enableDeleteLock bool = false\n\n@description('Enable diagnostic logs')\nparam enableDiagnostics bool = false\n\n@description('Storage account resource id. Only required if enableDiagnostics is set to true.')\nparam diagnosticStorageAccountId string = ''\n\n@description('Log analytics workspace resource id. Only required if enableDiagnostics is set to true.')\nparam logAnalyticsWorkspaceId string = ''\n\nvar lockName = '${nsg.name}-lck'\nvar diagnosticsName = '${nsg.name}-dgs'\n\nresource nsg 'Microsoft.Network/networkSecurityGroups@2021-02-01' = {\n  name: nsgName\n  location: location\n  properties: {\n    securityRules: [for rule in securityRules: {\n      name: rule.name\n      properties: rule.properties\n    }]\n  }\n}\n\nresource diagnostics 'microsoft.insights/diagnosticSettings@2021-05-01-preview' = if (enableDiagnostics) {\n  scope: nsg\n  name: diagnosticsName\n  properties: {\n    workspaceId: empty(logAnalyticsWorkspaceId) ? null : logAnalyticsWorkspaceId\n    storageAccountId: empty(diagnosticStorageAccountId) ? null : diagnosticStorageAccountId\n    logs: [\n      {\n        category: 'NetworkSecurityGroupEvent'\n        enabled: true\n      }\n      {\n        category: 'NetworkSecurityGroupRuleCounter'\n        enabled: true\n      }\n    ]\n  }\n}\n\nresource lock 'Microsoft.Authorization/locks@2017-04-01' = if (enableDeleteLock) {\n  scope: nsg\n  name: lockName\n  properties: {\n    level: 'CanNotDelete'\n  }\n}\n\noutput name string = nsg.name\noutput id string = nsg.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1222."}, {"role": "assistant", "content": "@description('Flow Log name')\nparam flowlogName string = 'flowlog'\n\n@description('Flow Log location')\nparam location string = resourceGroup().location\n\n@description('Network Watcher name')\nparam networkWatcherName string = 'NetworkWatcher_${location}'\n\n@description('Network Watcher Resource Group')\nparam networkWatcherResourceGroup string = 'NetworkWatcherRG'\n\n@description('Network Security Group resource id')\nparam existingNsgId string\n\n@description('Storage account resource id')\nparam existingFlowLogStorageAccountId string\n\n@description('Log analytics workspace resource id')\nparam logAnalyticsWorkspaceId string = ''\n\nmodule flowLogs './nested/nested.flowlogs.bicep' = {\n  name: 'deployFlowLogs'\n  scope: resourceGroup(networkWatcherResourceGroup)\n  params: {\n    flowlogName: flowlogName\n    location: location\n    networkWatcherName: networkWatcherName\n    existingNsgId: existingNsgId\n    existingFlowLogStorageAccountId: existingFlowLogStorageAccountId\n    logAnalyticsWorkspaceId: logAnalyticsWorkspaceId\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1223."}, {"role": "assistant", "content": "@description('Flow Log name')\nparam flowlogName string\n\n@description('Flow Log location')\nparam location string\n\n@description('Network Watcher name')\nparam networkWatcherName string\n\n@description('Network Security Group resource id')\nparam existingNsgId string\n\n@description('Storage account resource id')\nparam existingFlowLogStorageAccountId string\n\n@description('Log analytics workspace resource id')\nparam logAnalyticsWorkspaceId string = ''\n\nvar flowLogsStorageRetention = 60\n\nresource nsgFlowLog 'Microsoft.Network/networkWatchers/flowLogs@2021-02-01' = {\n  name: '${networkWatcherName}/${flowlogName}'\n  location: location\n  properties: {\n    enabled: true\n    flowAnalyticsConfiguration: {\n      networkWatcherFlowAnalyticsConfiguration: {\n        enabled: empty(logAnalyticsWorkspaceId) ? false : true\n        trafficAnalyticsInterval: 60\n        workspaceResourceId: empty(logAnalyticsWorkspaceId) ? null : logAnalyticsWorkspaceId\n      }\n    }\n    format: {\n      type: 'JSON'\n      version: 2\n    }\n    retentionPolicy: {\n      days: flowLogsStorageRetention\n      enabled: true\n    }\n    storageId: existingFlowLogStorageAccountId\n    targetResourceId: existingNsgId\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1224?"}, {"role": "assistant", "content": "@description('Name of the Public IP Address resource')\nparam publicIpName string = 'publicIp'\n\n@description('SKU of the Public IP Address')\n@allowed([\n  'Basic'\n  'Standard'\n])\nparam sku string = 'Standard'\n\n@description('The Allocation Method used for the Public IP Address')\n@allowed([\n  'Dynamic'\n  'Static'\n])\nparam publicIPAllocationMethod string = 'Static'\n\n@description('SKU Tier of the Public IP Address')\n@allowed([\n  'Regional'\n  'Global'\n])\nparam tier string = 'Regional'\n\n@description('DDoS Protection Mode of the Public IP Address, use Enabled for DDoS IP Protection')\n@allowed([\n  'VirtualNetworkInherited'\n  'Enabled'\n  'Disabled'\n])\nparam ddosProtectionMode string = 'Enabled'\n\n@description('Specify a location for the resources.')\nparam location string = resourceGroup().location\n\nresource publicIp 'Microsoft.Network/publicIPAddresses@2022-05-01' = {\n  name: publicIpName\n  location: location\n  sku: {\n    name: sku\n    tier: tier\n  }\n  properties: {\n    publicIPAllocationMethod: publicIPAllocationMethod\n    ddosSettings: {\n      protectionMode: ddosProtectionMode\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1225."}, {"role": "assistant", "content": "@description('Name for the virtual network')\nparam virtualNetworkName string = 'VNet1'\n\n@description('Location for the resources')\nparam location string = resourceGroup().location\n\n@description('Name for the frontend subnet')\nparam frontendSubName string = 'FrontEnd'\n\n@description('CIDR block representing the address space of the VNet')\nparam virtualNetworkPrefix string = '10.1.0.0/16'\n\n@description('CIDR block for the front end subnet, subset of VNet address space')\nparam frontendSubPrefix string = '10.1.0.0/24'\n\n@description('CIDR block for the gateway subnet, subset of VNet address space')\nparam gatewaySubPrefix string = '10.1.255.0/27'\n\n@description('Name for the new gateway')\nparam gatewayName string = 'VNet1GW'\n\n@description('Name for public IP resource used for the new azure gateway')\nparam gatewayPublicIPName string = 'VNet1GWIP'\n\n@description('The SKU of the Gateway. This must be either Standard or HighPerformance to work with OpenVPN')\n@allowed([\n  'Standard'\n  'HighPerformance'\n])\nparam gatewaySku string = 'Standard'\n\n@description('Route based (Dynamic Gateway) or Policy based (Static Gateway)')\n@allowed([\n  'RouteBased'\n  'PolicyBased'\n])\nparam vpnType string = 'RouteBased'\n\n@description('The IP address range from which VPN clients will receive an IP address when connected. Range specified must not overlap with on-premise network')\nparam vpnClientAddressPool string = '172.16.0.0/24'\n\nvar audienceMap = {\n  AzureCloud: '41b23e61-6c1e-4545-b367-cd054e0ed4b4'\n  AzureUSGovernment: '51bb15d4-3a4f-4ebf-9dca-40096fe32426'\n  AzureGermanCloud: '538ee9e6-310a-468d-afef-ea97365856a9'\n  AzureChinaCloud: '49f817b6-84ae-4cc0-928c-73f27289b3aa'\n}\n\nvar tenantId = subscription().tenantId\nvar cloud = environment().name\nvar audience = audienceMap[cloud]\nvar tenant = uri(environment().authentication.loginEndpoint, tenantId)\nvar issuer = 'https://sts.windows.net/${tenantId}/'\nvar gatewaySubnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, 'GatewaySubnet')\nvar publicIPAddressRef =  resourceId('Microsoft.Network/publicIPAddresses', gatewayPublicIPName)\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2021-02-01'= {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        virtualNetworkPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: frontendSubName\n        properties:{\n          addressPrefix: frontendSubPrefix\n        }\n      }\n      {\n        name: 'GatewaySubnet'\n        properties:{\n          addressPrefix: gatewaySubPrefix\n        }\n      }\n    ]\n  }\n\n}\n\nresource vpnGateway 'Microsoft.Network/virtualNetworkGateways@2021-02-01' = {\n  name: gatewayName\n  location: location\n  dependsOn: [\n    virtualNetwork\n    publicIp\n  ]\n  properties: {\n    ipConfigurations: [\n      {\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: gatewaySubnetRef\n          }\n          publicIPAddress: {\n            id: publicIPAddressRef\n          }\n        }\n        name: 'vnetGatewayConfig'\n      }\n    ]\n    sku: {\n      name: gatewaySku\n      tier: gatewaySku\n    }\n    gatewayType: 'Vpn'\n    vpnType: vpnType\n    vpnClientConfiguration: {\n      vpnClientAddressPool: {\n        addressPrefixes: [\n          vpnClientAddressPool\n        ]\n      }\n      vpnClientProtocols: [\n        'OpenVPN'\n      ]\n      vpnAuthenticationTypes: [\n        'AAD'\n      ]\n      aadTenant: tenant\n      aadAudience: audience\n      aadIssuer: issuer\n    }\n  }\n}\n\nresource publicIp 'Microsoft.Network/publicIPAddresses@2021-02-01' = {\n  name: gatewayPublicIPName\n  location: location\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1226."}, {"role": "assistant", "content": "@description('Private DNS zone name')\nparam privateDnsZoneName string\n\n@description('Enable automatic VM DNS registration in the zone')\nparam vmRegistration bool = true\n\n@description('VNet name')\nparam vnetName string = 'VNet'\n\n@description('VNet Address prefix')\nparam vnetAddressPrefix string = '10.0.0.0/16'\n\n@description('Subnet Prefix')\nparam subnetPrefix string = '10.0.0.0/24'\n\n@description('Subnet Name')\nparam subnetName string = 'App'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nresource vnet 'Microsoft.Network/virtualNetworks@2021-03-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: subnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource privateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDnsZoneName\n  location: 'global'\n}\n\nresource privateDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateDnsZone\n  name: '${vnet.name}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: vmRegistration\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1227."}, {"role": "assistant", "content": "@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Private Link resource name from same tenant or cross-tenant.')\nparam privateLinkResourceName string\n\n@description('Private Link sub resource name for Private Endpoint.')\nparam targetSubResource array\n\n@description('Request message for the Private Link approval.')\nparam requestMessage string\n\n@description('Private Endpoint VNet Name.')\nparam virtualNetworkName string\n\n@description('Private Endpoint VNet Address Space.')\nparam virtualNetworkAddressSpace string\n\n@description('Private Endpoint Subnet Name.')\nparam subnetName string\n\n@description('Private Endpoint Subnet Address Prefix.')\nparam subnetAddressPrefix string\n\nresource keyVault 'Microsoft.KeyVault/vaults@2023-07-01' = {\n  name: '${privateLinkResourceName}-mifal'\n  location: location\n  properties: {\n    sku: {\n      name: 'standard'\n      family: 'A'\n    }\n    accessPolicies: []\n    tenantId: tenant().tenantId\n  }\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2024-01-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [virtualNetworkAddressSpace]\n    }\n  }\n}\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2024-01-01' = {\n  parent: virtualNetwork\n  name: subnetName\n  properties: {\n    addressPrefix: subnetAddressPrefix\n    privateEndpointNetworkPolicies: 'Enabled'\n  }\n}\n\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\n  location: location\n  name: '${keyVault.name}-pe'\n  properties: {\n    subnet: {\n      id: subnet.id\n    }\n    customNetworkInterfaceName: '${split(keyVault.id, '/')[8]}-nic'\n    manualPrivateLinkServiceConnections: [\n      {\n        name: '${keyVault.name}-pe'\n        properties: {\n          privateLinkServiceId: keyVault.id\n          groupIds: targetSubResource\n          requestMessage: requestMessage\n        }\n      }\n    ]\n  }\n  tags: {}\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1228 please."}, {"role": "assistant", "content": "@description('Username for the Virtual Machine.')\nparam vmAdminUsername string\n\n@description('Password for the Virtual Machine. The password must be at least 12 characters long and have lower case, upper characters, digit and a special character (Regex match)')\n@secure()\nparam vmAdminPassword string\n\n@description('The size of the VM')\nparam vmSize string = 'Standard_D2_v3'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar vnetName = 'myVirtualNetwork'\nvar vnetConsumerName = 'myPEVnet'\nvar vnetAddressPrefix = '10.0.0.0/16'\nvar frontendSubnetPrefix = '10.0.1.0/24'\nvar frontendSubnetName = 'frontendSubnet'\nvar backendSubnetPrefix = '10.0.2.0/24'\nvar backendSubnetName = 'backendSubnet'\nvar consumerSubnetPrefix = '10.0.0.0/24'\nvar consumerSubnetName = 'myPESubnet'\nvar loadbalancerName = 'myILB'\nvar backendPoolName = 'myBackEndPool'\nvar loadBalancerFrontEndIpConfigurationName = 'myFrontEnd'\nvar healthProbeName = 'myHealthProbe'\nvar privateEndpointName = 'myPrivateEndpoint'\nvar vmName = take('myVm${uniqueString(resourceGroup().id)}', 15)\nvar networkInterfaceName = '${vmName}NetInt'\nvar vmConsumerName = take('myConsumerVm${uniqueString(resourceGroup().id)}', 15)\nvar publicIpAddressConsumerName = '${vmConsumerName}PublicIP'\nvar networkInterfaceConsumerName = '${vmConsumerName}NetInt'\nvar osDiskType = 'StandardSSD_LRS'\nvar privatelinkServiceName = 'myPLS'\nvar loadbalancerId = loadbalancer.id\n\nresource vnet 'Microsoft.Network/virtualNetworks@2021-05-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: frontendSubnetName\n        properties: {\n          addressPrefix: frontendSubnetPrefix\n          privateLinkServiceNetworkPolicies: 'Disabled'\n        }\n      }\n      {\n        name: backendSubnetName\n        properties: {\n          addressPrefix: backendSubnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource loadbalancer 'Microsoft.Network/loadBalancers@2021-05-01' = {\n  name: loadbalancerName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    frontendIPConfigurations: [\n      {\n        name: loadBalancerFrontEndIpConfigurationName\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, frontendSubnetName)\n          }\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: backendPoolName\n      }\n    ]\n    inboundNatRules: [\n      {\n        name: 'RDP-VM0'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIpConfigurations', loadbalancerName, loadBalancerFrontEndIpConfigurationName)\n          }\n          protocol: 'Tcp'\n          frontendPort: 3389\n          backendPort: 3389\n          enableFloatingIP: false\n        }\n      }\n    ]\n    loadBalancingRules: [\n      {\n        name: 'myHTTPRule'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/loadBalancers/frontendIpConfigurations', loadbalancerName, loadBalancerFrontEndIpConfigurationName)\n          }\n          backendAddressPool: {\n            id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadbalancerName, backendPoolName)\n          }\n          probe: {\n            id: resourceId('Microsoft.Network/loadBalancers/probes', loadbalancerName, healthProbeName)\n          }\n          protocol: 'Tcp'\n          frontendPort: 80\n          backendPort: 80\n          idleTimeoutInMinutes: 15\n        }\n      }\n    ]\n    probes: [\n      {\n        properties: {\n          protocol: 'Tcp'\n          port: 80\n          intervalInSeconds: 15\n          numberOfProbes: 2\n        }\n        name: healthProbeName\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource networkInterface 'Microsoft.Network/networkInterfaces@2021-05-01' = {\n  name: networkInterfaceName\n  location: location\n  tags: {\n    displayName: networkInterfaceName\n  }\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipConfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, backendSubnetName)\n          }\n          loadBalancerBackendAddressPools: [\n            {\n              id: resourceId('Microsoft.Network/loadBalancers/backendAddressPools', loadbalancerName, backendPoolName)\n            }\n          ]\n          loadBalancerInboundNatRules: [\n            {\n              id: resourceId('Microsoft.Network/loadBalancers/inboundNatRules/', loadbalancerName, 'RDP-VM0')\n            }\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    loadbalancer\n  ]\n}\n\nresource vm 'Microsoft.Compute/virtualMachines@2021-11-01' = {\n  name: vmName\n  location: location\n  tags: {\n    displayName: vmName\n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: vmName\n      adminUsername: vmAdminUsername\n      adminPassword: vmAdminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2019-Datacenter'\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${vmName}OsDisk'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: osDiskType\n        }\n        diskSizeGB: 128\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkInterface.id\n        }\n      ]\n    }\n  }\n}\n\nresource vmExtension 'Microsoft.Compute/virtualMachines/extensions@2021-11-01' = {\n  parent: vm\n  name: 'installcustomscript'\n  location: location\n  tags: {\n    displayName: 'install software for Windows VM'\n  }\n  properties: {\n    publisher: 'Microsoft.Compute'\n    type: 'CustomScriptExtension'\n    typeHandlerVersion: '1.9'\n    autoUpgradeMinorVersion: true\n    protectedSettings: {\n      commandToExecute: 'powershell -ExecutionPolicy Unrestricted Install-WindowsFeature -Name Web-Server'\n    }\n  }\n}\n\nresource privatelinkService 'Microsoft.Network/privateLinkServices@2021-05-01' = {\n  name: privatelinkServiceName\n  location: location\n  properties: {\n    enableProxyProtocol: false\n    loadBalancerFrontendIpConfigurations: [\n      {\n        id: resourceId('Microsoft.Network/loadBalancers/frontendIpConfigurations', loadbalancerName, loadBalancerFrontEndIpConfigurationName)\n      }\n    ]\n    ipConfigurations: [\n      {\n        name: 'snet-provider-default-1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          privateIPAddressVersion: 'IPv4'\n          subnet: {\n            id: reference(loadbalancerId, '2019-06-01').frontendIPConfigurations[0].properties.subnet.id\n          }\n          primary: false\n        }\n      }\n    ]\n  }\n}\n\nresource vnetConsumer 'Microsoft.Network/virtualNetworks@2021-05-01' = {\n  name: vnetConsumerName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: consumerSubnetName\n        properties: {\n          addressPrefix: consumerSubnetPrefix\n          privateEndpointNetworkPolicies: 'Disabled'\n        }\n      }\n      {\n        name: backendSubnetName\n        properties: {\n          addressPrefix: backendSubnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource publicIpAddressConsumer 'Microsoft.Network/publicIPAddresses@2021-05-01' = {\n  name: publicIpAddressConsumerName\n  location: location\n  tags: {\n    displayName: publicIpAddressConsumerName\n  }\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n    dnsSettings: {\n      domainNameLabel: toLower(vmConsumerName)\n    }\n  }\n}\n\nresource networkInterfaceConsumer 'Microsoft.Network/networkInterfaces@2021-05-01' = {\n  name: networkInterfaceConsumerName\n  location: location\n  tags: {\n    displayName: networkInterfaceConsumerName\n  }\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipConfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: publicIpAddressConsumer.id\n          }\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetConsumerName, consumerSubnetName)\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnetConsumer\n  ]\n}\n\nresource vmConsumer 'Microsoft.Compute/virtualMachines@2021-11-01' = {\n  name: vmConsumerName\n  location: location\n  tags: {\n    displayName: vmConsumerName\n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: vmConsumerName\n      adminUsername: vmAdminUsername\n      adminPassword: vmAdminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2019-Datacenter'\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${vmConsumerName}OsDisk'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: osDiskType\n        }\n        diskSizeGB: 128\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkInterfaceConsumer.id\n        }\n      ]\n    }\n  }\n}\n\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2021-05-01' = {\n  name: privateEndpointName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetConsumerName, consumerSubnetName)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: privateEndpointName\n        properties: {\n          privateLinkServiceId: privatelinkService.id\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnetConsumer\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1229?"}, {"role": "assistant", "content": "@description('Name of new or existing vnet to which Azure Route Server should be deployed.')\nparam vnetName string = 'routeservervnet'\n\n@description('IP prefix for available addresses in vnet address space.')\nparam vnetIpPrefix string = '10.1.0.0/16'\n\n@description('Specify whether to provision new vnet or deploy to existing vnet.')\n@allowed([\n  'New'\n  'Existing'\n])\nparam vnetNew_or_Existing string = 'New'\n\n@description('Route Server subnet IP prefix MUST be within vnet IP prefix address space.')\nparam routeServerSubnetIpPrefix string = '10.1.1.0/26'\n\n\n@description('Specify whether to provision new standard public IP or deploy using existing standard public IP.')\n@allowed([\n  'New'\n  'Existing'\n])\nparam publicIpNew_or_Existing string = 'New'\n\n@description('Name of the standard Public IP used for the Route Server')\nparam publicIpName string = 'routeserverpip'\n\n@description('Name of Route Server.')\nparam firstRouteServerName string = 'routeserver'\n\n@description('Name of BGP connection.')\nparam routeServerBgpConnectionName string = 'conn1'\n\n@description('Peer ASN connecting to.')\nparam peerAsn int = 65002\n\n@description('Peer IP connecting to.')\nparam peerIp string = '10.0.1.4'\n\n@description('Azure region for Route Server and virtual network.')\nparam location string = resourceGroup().location\n\nvar ipconfigName = 'ipconfig1'\nvar routeServerSubnetName = 'RouteServerSubnet'\n\nresource vnet 'Microsoft.Network/virtualNetworks@2020-05-01' = if (vnetNew_or_Existing == 'New') {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetIpPrefix\n      ]\n    }\n  }\n}\n\nresource routeserverSubnet 'Microsoft.Network/virtualNetworks/subnets@2020-05-01' = {\n  name: routeServerSubnetName\n  parent: vnet\n  properties: {\n    addressPrefix: routeServerSubnetIpPrefix\n  }\n}\n\nresource publicIp 'Microsoft.Network/publicIPAddresses@2020-05-01' = if (publicIpNew_or_Existing == 'New') {\n  name: publicIpName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    publicIPAddressVersion: 'IPv4'\n    idleTimeoutInMinutes: 4\n  }\n}\n\nresource firstRouteServer 'Microsoft.Network/virtualHubs@2020-06-01' = {\n  name: firstRouteServerName\n  location: location\n  properties: {\n    sku: 'Standard'\n  }\n\n  \n}\n\nresource ipconfig  'Microsoft.Network/virtualHubs/ipConfigurations@2020-06-01' = {\n  name: ipconfigName\n  parent: firstRouteServer\n  properties: {\n    subnet:{\n      id: routeserverSubnet.id\n    }\n    publicIPAddress: {\n      id: publicIp.id\n    }\n  }\n}\n\nresource bgpConnnection 'Microsoft.Network/virtualHubs/bgpConnections@2020-06-01' = {\n  name: routeServerBgpConnectionName\n  parent: firstRouteServer\n  properties: {\n    peerAsn: peerAsn\n    peerIp: peerIp\n  }\n  dependsOn: [\n    ipconfig\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1230."}, {"role": "assistant", "content": "@description('Route table name')\nparam routeTableName string = uniqueString(resourceGroup().id)\n\n@description('Route table location')\nparam location string = resourceGroup().location\n\n@description('Disable the routes learned by BGP on the route table')\nparam disableBgpRoutePropagation bool = false\n\n@description('Array containing routes. For properties format refer to https://docs.microsoft.com/en-us/azure/templates/microsoft.network/routetables?tabs=bicep#routepropertiesformat')\nparam routes array = []\n\n@description('Enable delete lock')\nparam enableDeleteLock bool = false\n\nvar lockName = '${routeTable.name}-lck'\n\nresource routeTable 'Microsoft.Network/routeTables@2021-02-01' = {\n  name: routeTableName\n  location: location\n  properties: {\n    disableBgpRoutePropagation: disableBgpRoutePropagation\n    routes: [for route in routes: {\n      name: route.name\n      properties: {\n        addressPrefix: route.addressPrefix\n        hasBgpOverride: contains(route, 'hasBgpOverride') ? route.hasBgpOverride : null\n        nextHopIpAddress: contains(route, 'nextHopIpAddress') ? route.nextHopIpAddress : null\n        nextHopType: route.nextHopType\n      }\n    }]\n  }\n}\n\nresource lock 'Microsoft.Authorization/locks@2017-04-01' = if (enableDeleteLock) {\n  scope: routeTable\n  name: lockName\n  properties: {\n    level: 'CanNotDelete'\n  }\n}\n\noutput name string = routeTable.name\noutput id string = routeTable.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1231?"}, {"role": "assistant", "content": "@description('naming prefix of the objects in the resource. it can be an empty string.')\nparam prefix string = ''\n\n@description('First Azure region with Availability Zone')\n@allowed([\n  'canadacentral'\n  'francecentral'\n  'germanywestcentral'\n  'japaneast'\n  'centralus'\n  'northeurope'\n  'southeastasia'\n  'eastus'\n  'uksouth'\n  'australiaeast'\n  'eastus2'\n  'westeurope'\n  'southcentralus'\n  'westus2'\n])\nparam location1 string\n\n@description('Second Azure region with Availability Zone')\n@allowed([\n  'canadacentral'\n  'francecentral'\n  'germanywestcentral'\n  'japaneast'\n  'centralus'\n  'northeurope'\n  'southeastasia'\n  'eastus'\n  'uksouth'\n  'australiaeast'\n  'eastus2'\n  'westeurope'\n  'southcentralus'\n  'westus2'\n])\nparam location2 string\n\n@description('Arbitrary name for the Azure Virtual Network 1')\nparam vNet1Name string = '${prefix}vnet1'\n\n@description('Arbitrary name for the Azure Virtual Network 2')\nparam vNet2Name string = '${prefix}vnet2'\n\n@description('CIDR block representing the address space of the Azure VNet 1')\nparam vNet1AddressPrefix string = '10.1.0.0/16'\n\n@description('CIDR block representing the address space of the Azure VNet 2')\nparam vNet2AddressPrefix string = '10.2.0.0/16'\n\n@description('Arbitrary name for the Azure subnet1 in VNet1')\nparam subnet11Name string = 'subnet11'\n\n@description('Arbitrary name for the Azure subnet2 in VNet1')\nparam subnet12Name string = 'subnet12'\n\n@description('Arbitrary name for the Azure subnet1 in VNet2')\nparam subnet21Name string = 'subnet21'\n\n@description('Arbitrary name for the Azure subnet2 in VNet2')\nparam subnet22Name string = 'subnet22'\n\n@description('CIDR block for subnet1 in VNet1- it is a subset of vNet1AddressPrefix address space')\nparam subnet11Prefix string = '10.1.1.0/24'\n\n@description('CIDR block for subnet2 in VNet1- it is a subset of vNet1AddressPrefix address space')\nparam subnet12Prefix string = '10.1.2.0/24'\n\n@description('CIDR block for gateway subnet- it is a subset of vNet1AddressPrefix address space')\nparam gateway1SubnetPrefix string = '10.1.3.0/24'\n\n@description('CIDR block for subnet1 in VNet2- it is a subset of vNet2AddressPrefix address space')\nparam subnet21Prefix string = '10.2.1.0/24'\n\n@description('CIDR block for subnet2 in VNet2- it is a subset of vNet2AddressPrefix address space')\nparam subnet22Prefix string = '10.2.2.0/24'\n\n@description('CIDR block for gateway subnet- it is a subset of vNet2AddressPrefix address space')\nparam gateway2SubnetPrefix string = '10.2.3.0/24'\n\n@description('Arbitrary name for the new gateway1')\nparam gateway1Name string = '${prefix}gw1'\n\n@description('Arbitrary name for the new gateway2')\nparam gateway2Name string = '${prefix}gw2'\n\n@description('Arbitrary name for public IP1 resource used for the new azure gateway1')\nparam gateway1PublicIP1Name string = '${gateway1Name}IP1'\n\n@description('Arbitrary name for public IP2 resource used for the new azure gateway1')\nparam gateway1PublicIP2Name string = '${gateway1Name}IP2'\n\n@description('Arbitrary name for public IP1 resource used for the new azure gateway2')\nparam gateway2PublicIP1Name string = '${gateway2Name}IP1'\n\n@description('Arbitrary name for public IP2 resource used for the new azure gateway2')\nparam gateway2PublicIP2Name string = '${gateway2Name}IP2'\n\n@description('The Sku of the Gateway')\n@allowed([\n  'VpnGw1AZ'\n  'VpnGw2AZ'\n  'VpnGw3AZ'\n  'VpnGw4AZ'\n  'VpnGw5AZ'\n])\nparam gatewaySku string = 'VpnGw2AZ'\n\n@allowed([\n  'Generation1'\n  'Generation2'\n])\nparam vpnGatewayGeneration string = 'Generation2'\n\n@description('BGP Autonomous System Number of the VPN Gateway1 in VNet1')\nparam asnGtw1 int = 65001\n\n@description('BGP Autonomous System Number of the VPN Gateway2 in VNet2')\nparam asnGtw2 int = 65002\n\n@description('Arbitrary name for gateway resource representing VPN gateway1-public IP1')\nparam localGatewayName11 string = '${prefix}localGateway11'\n\n@description('Arbitrary name for gateway resource representing VPN gateway1-publicIP2')\nparam localGatewayName12 string = '${prefix}localGateway12'\n\n@description('Arbitrary name for gateway resource representing VPN gateway2-publicIP1')\nparam localGatewayName21 string = '${prefix}localGateway21'\n\n@description('Arbitrary name for gateway resource representing VPN gateway2-publicIP2')\nparam localGatewayName22 string = '${prefix}localGateway22'\n\n@description('Arbitrary name for the new connection between VPN gateway1 and the remote VPN Gateway2-public IP1')\nparam connectionName11_21 string = '${gateway1Name}-to-${gateway2PublicIP1Name}'\n\n@description('Arbitrary name for the new connection between VPN gateway1 and the remote VPN Gateway2-public IP2')\nparam connectionName12_22 string = '${gateway1Name}-to-${gateway2PublicIP2Name}'\n\n@description('Arbitrary name for the new connection between VPN gateway2 and the remote VPN Gateway1-public IP1')\nparam connectionName21_11 string = '${gateway2Name}-to-${gateway1PublicIP1Name}'\n\n@description('Arbitrary name for the new connection between VPN gateway2 and the remote VPN Gateway1-public IP2')\nparam connectionName22_12 string = '${gateway2Name}-to-${gateway1PublicIP2Name}'\n\n@description('Shared key (PSK) for IPSec tunnels')\nparam sharedKey string = '_your_Pre-Shared-Secret'\n\n@description('name of the VM in subnet1 in VNet1')\nparam vm1Name string = '${prefix}vm1'\n\n@description('name of the VM in subnet1 in VNet2')\nparam vm2Name string = '${prefix}vm2'\n\n@description('Size of the Virtual Machine')\n@allowed([\n  'Standard_B1ls'\n  'Standard_B1s'\n  'Standard_D2s_v3'\n  'Standard_D16s_v3'\n])\nparam vmSize string = 'Standard_B1s'\n\n@description('administrator username of the VMs')\nparam adminUsername string\n\n@description('administrator password of the VMs')\n@secure()\nparam adminPassword string\n\n@description('dns name of public IP1 of the VPN Gateway1. Must be lowercase. It should match with the regex: ^[a-z][a-z0-9-]{1,61}[a-z0-9]$.')\nparam dnsLabelgtw1PubIP1 string = toLower('gtw1-ip1-${uniqueString(resourceGroup().id)}')\n\n@description('dns name of public IP2 of the VPN Gateway1. Must be lowercase. It should match with the regex: ^[a-z][a-z0-9-]{1,61}[a-z0-9]$.')\nparam dnsLabelgtw1PubIP2 string = toLower('gtw1-ip2-${uniqueString(resourceGroup().id)}')\n\n@description('dns name of public IP1 of the VPN Gateway2. Must be lowercase. It should match with the regex: ^[a-z][a-z0-9-]{1,61}[a-z0-9]$.')\nparam dnsLabelgtw2PubIP1 string = toLower('gtw2-ip1-${uniqueString(resourceGroup().id)}')\n\n@description('dns name of public IP2 of the VPN Gateway2. Must be lowercase. It should match with the regex: ^[a-z][a-z0-9-]{1,61}[a-z0-9]$.')\nparam dnsLabelgtw2PubIP2 string = toLower('gtw2-ip2-${uniqueString(resourceGroup().id)}')\n\n@description('Availability zone for the public IP addresses.')\n@allowed([\n  '1'\n  '2'\n  '3'\n])\nparam publicIpZone string = '1'\n\nvar gateway1subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', vNet1Name, 'GatewaySubnet')\nvar gateway2subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', vNet2Name, 'GatewaySubnet')\nvar subnet11Ref = resourceId('Microsoft.Network/virtualNetworks/subnets', vNet1Name, subnet11Name)\nvar subnet21Ref = resourceId('Microsoft.Network/virtualNetworks/subnets', vNet2Name, subnet21Name)\n\nvar nsg1Name = '${prefix}nsg1'\nvar nsg2Name = '${prefix}nsg2'\nvar nic1Name = '${vm1Name}-nic'\nvar nic2Name = '${vm2Name}-nic'\nvar vm1PublicIPName = '${vm1Name}-pubIP'\nvar vm2PublicIPName = '${vm2Name}-pubIP'\nvar imageReference = {\n  publisher: 'Canonical'\n  offer: '0001-com-ubuntu-server-focal'\n  sku: '20_04-lts'\n  version: 'latest'\n}\n\nresource nsg1 'Microsoft.Network/networkSecurityGroups@2023-02-01' = {\n  location: location1\n  name: nsg1Name\n  properties: {\n    securityRules: [\n      {\n        name: 'SSH-rule'\n        properties: {\n          description: 'allow SSH'\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '22'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 500\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'RDP-rule'\n        properties: {\n          description: 'allow RDP'\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '3389'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 510\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource nsg2 'Microsoft.Network/networkSecurityGroups@2023-02-01' = {\n  name: nsg2Name\n  location: location2\n  properties: {\n    securityRules: [\n      {\n        name: 'SSH-rule'\n        properties: {\n          description: 'allow SSH'\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '22'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 500\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'RDP-rule'\n        properties: {\n          description: 'allow RDP'\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '3389'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: 'VirtualNetwork'\n          access: 'Allow'\n          priority: 510\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource vNet1 'Microsoft.Network/virtualNetworks@2023-02-01' = {\n  name: vNet1Name\n  location: location1\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vNet1AddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnet11Name\n        properties: {\n          addressPrefix: subnet11Prefix\n          networkSecurityGroup: {\n            id: nsg1.id\n          }\n        }\n      }\n      {\n        name: subnet12Name\n        properties: {\n          addressPrefix: subnet12Prefix\n        }\n      }\n      {\n        name: 'GatewaySubnet'\n        properties: {\n          addressPrefix: gateway1SubnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource vNet2 'Microsoft.Network/virtualNetworks@2023-02-01' = {\n  name: vNet2Name\n  location: location2\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vNet2AddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnet21Name\n        properties: {\n          addressPrefix: subnet21Prefix\n          networkSecurityGroup: {\n            id: nsg2.id\n          }\n        }\n      }\n      {\n        name: subnet22Name\n        properties: {\n          addressPrefix: subnet22Prefix\n        }\n      }\n      {\n        name: 'GatewaySubnet'\n        properties: {\n          addressPrefix: gateway2SubnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource gateway1PublicIP1 'Microsoft.Network/publicIPAddresses@2023-02-01' = {\n  name: gateway1PublicIP1Name\n  location: location1\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    dnsSettings: {\n      domainNameLabel: dnsLabelgtw1PubIP1\n    }\n  }\n  zones: [\n    publicIpZone\n  ]\n}\n\nresource gateway1PublicIP2 'Microsoft.Network/publicIPAddresses@2023-02-01' = {\n  name: gateway1PublicIP2Name\n  location: location1\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    dnsSettings: {\n      domainNameLabel: dnsLabelgtw1PubIP2\n    }\n  }\n  zones: [\n    publicIpZone\n  ]\n}\n\nresource gateway2PublicIP1 'Microsoft.Network/publicIPAddresses@2023-02-01' = {\n  name: gateway2PublicIP1Name\n  location: location2\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    dnsSettings: {\n      domainNameLabel: dnsLabelgtw2PubIP1\n    }\n  }\n  zones: [\n    publicIpZone\n  ]\n}\n\nresource gateway2PublicIP2 'Microsoft.Network/publicIPAddresses@2023-02-01' = {\n  name: gateway2PublicIP2Name\n  location: location2\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    dnsSettings: {\n      domainNameLabel: dnsLabelgtw2PubIP2\n    }\n  }\n  zones: [\n    publicIpZone\n  ]\n}\n\nresource gateway1 'Microsoft.Network/virtualNetworkGateways@2023-02-01' = {\n  name: gateway1Name\n  location: location1\n  properties: {\n    ipConfigurations: [\n      {\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: gateway1subnetRef\n          }\n          publicIPAddress: {\n            id: gateway1PublicIP1.id\n          }\n        }\n        name: 'vnetGateway1Config1'\n      }\n      {\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: gateway1subnetRef\n          }\n          publicIPAddress: {\n            id: gateway1PublicIP2.id\n          }\n        }\n        name: 'vnetGateway1Config2'\n      }\n    ]\n    sku: {\n      name: gatewaySku\n      tier: gatewaySku\n    }\n    gatewayType: 'Vpn'\n    vpnType: 'RouteBased'\n    enableBgp: true\n    activeActive: true\n    vpnGatewayGeneration: vpnGatewayGeneration\n    bgpSettings: {\n      asn: asnGtw1\n    }\n  }\n  dependsOn: [\n\n    vNet1\n  ]\n}\n\nresource gateway2 'Microsoft.Network/virtualNetworkGateways@2023-02-01' = {\n  name: gateway2Name\n  location: location2\n  properties: {\n    ipConfigurations: [\n      {\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: gateway2subnetRef\n          }\n          publicIPAddress: {\n            id: gateway2PublicIP1.id\n          }\n        }\n        name: 'vnetGateway2Config1'\n      }\n      {\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: gateway2subnetRef\n          }\n          publicIPAddress: {\n            id: gateway2PublicIP2.id\n          }\n        }\n        name: 'vnetGateway2Config2'\n      }\n    ]\n    sku: {\n      name: gatewaySku\n      tier: gatewaySku\n    }\n    gatewayType: 'Vpn'\n    vpnType: 'RouteBased'\n    enableBgp: true\n    activeActive: true\n    vpnGatewayGeneration: vpnGatewayGeneration\n    bgpSettings: {\n      asn: asnGtw2\n    }\n  }\n  dependsOn: [\n\n    vNet2\n  ]\n}\n\nresource localGateway11 'Microsoft.Network/localNetworkGateways@2023-02-01' = {\n  name: localGatewayName11\n  location: location2\n  properties: {\n    fqdn: gateway1PublicIP1.properties.dnsSettings.fqdn\n    bgpSettings: {\n      asn: asnGtw1\n      bgpPeeringAddress: first(split(gateway1.properties.bgpSettings.bgpPeeringAddress, ','))\n      peerWeight: 0\n    }\n  }\n}\n\nresource localGateway12 'Microsoft.Network/localNetworkGateways@2023-02-01' = {\n  name: localGatewayName12\n  location: location2\n  properties: {\n    fqdn: gateway1PublicIP2.properties.dnsSettings.fqdn\n    bgpSettings: {\n      asn: asnGtw1\n      bgpPeeringAddress: last(split(gateway1.properties.bgpSettings.bgpPeeringAddress, ','))\n      peerWeight: 0\n    }\n  }\n}\n\nresource localGateway21 'Microsoft.Network/localNetworkGateways@2023-02-01' = {\n  name: localGatewayName21\n  location: location1\n  properties: {\n    fqdn: gateway2PublicIP1.properties.dnsSettings.fqdn\n    bgpSettings: {\n      asn: asnGtw2\n      bgpPeeringAddress: first(split(gateway2.properties.bgpSettings.bgpPeeringAddress, ','))\n      peerWeight: 0\n    }\n  }\n}\n\nresource localGateway22 'Microsoft.Network/localNetworkGateways@2023-02-01' = {\n  name: localGatewayName22\n  location: location1\n  properties: {\n    fqdn: gateway2PublicIP2.properties.dnsSettings.fqdn\n    bgpSettings: {\n      asn: asnGtw2\n      bgpPeeringAddress: last(split(gateway2.properties.bgpSettings.bgpPeeringAddress, ','))\n      peerWeight: 0\n    }\n  }\n}\n\nresource connectionName11_21_resource 'Microsoft.Network/connections@2023-02-01' = {\n  name: connectionName11_21\n  location: location1\n  properties: {\n    virtualNetworkGateway1: {\n      id: gateway1.id\n      properties: {}\n    }\n    localNetworkGateway2: {\n      id: localGateway21.id\n      properties: {}\n    }\n    connectionType: 'IPsec'\n    routingWeight: 0\n    sharedKey: sharedKey\n    enableBgp: true\n  }\n}\n\nresource connectionName12_22_resource 'Microsoft.Network/connections@2023-02-01' = {\n  name: connectionName12_22\n  location: location1\n  properties: {\n    virtualNetworkGateway1: {\n      id: gateway1.id\n      properties: {}\n    }\n    localNetworkGateway2: {\n      id: localGateway22.id\n      properties: {}\n    }\n    connectionType: 'IPsec'\n    routingWeight: 0\n    sharedKey: sharedKey\n    enableBgp: true\n  }\n}\n\nresource connectionName21_11_resource 'Microsoft.Network/connections@2023-02-01' = {\n  name: connectionName21_11\n  location: location2\n  properties: {\n    virtualNetworkGateway1: {\n      id: gateway2.id\n      properties: {}\n    }\n    localNetworkGateway2: {\n      id: localGateway11.id\n      properties: {}\n    }\n    connectionType: 'IPsec'\n    routingWeight: 0\n    sharedKey: sharedKey\n    enableBgp: true\n  }\n}\n\nresource connectionName22_12_resource 'Microsoft.Network/connections@2023-02-01' = {\n  name: connectionName22_12\n  location: location2\n  properties: {\n    virtualNetworkGateway1: {\n      id: gateway2.id\n      properties: {}\n    }\n    localNetworkGateway2: {\n      id: localGateway12.id\n      properties: {}\n    }\n    connectionType: 'IPsec'\n    routingWeight: 0\n    sharedKey: sharedKey\n    enableBgp: true\n  }\n}\n\nresource vm1PublicIP 'Microsoft.Network/publicIPAddresses@2023-02-01' = {\n  name: vm1PublicIPName\n  location: location1\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n\nresource vm2PublicIP 'Microsoft.Network/publicIPAddresses@2023-02-01' = {\n  name: vm2PublicIPName\n  location: location2\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n\nresource nic1 'Microsoft.Network/networkInterfaces@2023-02-01' = {\n  name: nic1Name\n  location: location1\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: vm1PublicIP.id\n          }\n          subnet: {\n            id: subnet11Ref\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n\n    vNet1\n  ]\n}\n\nresource nic2 'Microsoft.Network/networkInterfaces@2023-02-01' = {\n  name: nic2Name\n  location: location2\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig2'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: vm2PublicIP.id\n          }\n          subnet: {\n            id: subnet21Ref\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n\n    vNet2\n  ]\n}\n\nresource vm1 'Microsoft.Compute/virtualMachines@2023-03-01' = {\n  name: vm1Name\n  location: location1\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: vm1Name\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: imageReference.publisher\n        offer: imageReference.offer\n        sku: imageReference.sku\n        version: imageReference.version\n      }\n      osDisk: {\n        name: '${vm1Name}-OSdisk'\n        createOption: 'FromImage'\n        caching: 'ReadWrite'\n        managedDisk: {\n          storageAccountType: 'StandardSSD_LRS'\n        }\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: nic1.id\n        }\n      ]\n    }\n  }\n}\n\nresource vm2 'Microsoft.Compute/virtualMachines@2023-03-01' = {\n  name: vm2Name\n  location: location2\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: vm2Name\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: imageReference.publisher\n        offer: imageReference.offer\n        sku: imageReference.sku\n        version: imageReference.version\n      }\n      osDisk: {\n        name: '${vm2Name}-OSdisk'\n        createOption: 'FromImage'\n        caching: 'ReadWrite'\n        managedDisk: {\n          storageAccountType: 'StandardSSD_LRS'\n        }\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: nic2.id\n        }\n      ]\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1232."}, {"role": "assistant", "content": "@description('Name of the VNET to add a subnet to')\nparam existingVNETName string\n\n@description('Name of the subnet to add')\nparam newSubnetName string\n\n@description('Address space of the subnet to add')\nparam newSubnetAddressPrefix string = '10.0.0.0/24'\n\nresource vnet 'Microsoft.Network/virtualNetworks@2021-03-01' existing = {\n   name: existingVNETName\n}\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2021-03-01' = {\n  parent: vnet\n  name: newSubnetName\n  properties: {\n    addressPrefix: newSubnetAddressPrefix\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1233."}, {"role": "assistant", "content": "@description('Relative DNS name for the traffic manager profile, must be globally unique.')\nparam uniqueDnsName string\n\nresource ExternalEndpointExample 'Microsoft.Network/trafficmanagerprofiles@2022-04-01' = {\n  name: 'ExternalEndpointExample'\n  location: 'global'\n  properties: {\n    profileStatus: 'Enabled'\n    trafficRoutingMethod: 'Performance'\n    dnsConfig: {\n      relativeName: uniqueDnsName\n      ttl: 30\n    }\n    monitorConfig: {\n      protocol: 'HTTPS'\n      port: 443\n      path: '/'\n      expectedStatusCodeRanges: [\n        {\n          min: 200\n          max: 202\n        }\n        {\n          min: 301\n          max: 302\n        }\n      ]\n    }\n    endpoints: [\n      {\n        type: 'Microsoft.Network/TrafficManagerProfiles/ExternalEndpoints'\n        name: 'endpoint1'\n        properties: {\n          target: 'www.microsoft.com'\n          endpointStatus: 'Enabled'\n          endpointLocation: 'northeurope'\n        }\n      }\n      {\n        type: 'Microsoft.Network/TrafficManagerProfiles/ExternalEndpoints'\n        name: 'endpoint2'\n        properties: {\n          target: 'docs.microsoft.com'\n          endpointStatus: 'Enabled'\n          endpointLocation: 'southcentralus'\n        }\n      }\n    ]\n  }\n}\noutput name string = ExternalEndpointExample.name\noutput resourceGroupName string = resourceGroup().name\noutput resourceId string = ExternalEndpointExample.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1234?"}, {"role": "assistant", "content": "@description('Location for the VM, only certain regions support zones.')\nparam location string = resourceGroup().location\n\n@description('Relative DNS name for the traffic manager profile, must be globally unique')\nparam uniqueDnsName string\n\n@description('Admin user name for the Virtual Machines.')\nparam adminUserName string\n\n@description('Relative DNS Name for the Public IPs used to access the Virtual Machines, must be globally unique. An index will be appended for each instance.')\nparam uniqueDnsNameForPublicIP string\n\n@description('The Ubuntu version for the VM. This will pick a fully patched image of this given Ubuntu version. Allowed values: 18.04-LTS, 16.04-LTS.')\n@allowed([\n  '18.04-LTS'\n  '16.04-LTS'\n])\nparam ubuntuOSVersion string = '18.04-LTS'\n\n@description('Size of the virtual machine')\nparam vmSize string = 'Standard_D2s_v3'\n\n@description('Type of authentication to use on the Virtual Machine. SSH key is recommended.')\n@allowed([\n  'sshPublicKey'\n  'password'\n])\nparam authenticationType string = 'sshPublicKey'\n\n@description('SSH Key or password for the Virtual Machine. SSH key is recommended.')\n@secure()\nparam adminPasswordOrKey string\n\nvar numVMs = 3\nvar imageReference = {\n  publisher: 'Canonical'\n  offer: 'UbuntuServer'\n  sku: ubuntuOSVersion\n  version: 'latest'\n}\nvar vmName = 'UbuntuVM'\nvar virtualNetworkName = '${vmName}-vnet'\nvar networkSecurityGroupName = '${vmName}-nsg'\nvar traficManagerProfileName = '${vmName}-tm'\nvar addressPrefix = '10.0.0.0/16'\nvar subnetPrefix = '10.0.0.0/24'\nvar subnetName = 'Subnet'\nvar publicIPAddressType = 'Dynamic'\n\nvar linuxConfiguration = {\n  disablePasswordAuthentication: true\n  ssh: {\n    publicKeys: [\n      {\n        path: '/home/${adminUserName}/.ssh/authorized_keys'\n        keyData: adminPasswordOrKey\n      }\n    ]\n  }\n}\n\nresource pip 'Microsoft.Network/publicIPAddresses@2021-03-01' = [for i in range(0, numVMs): {\n  name: '${vmName}${i}-pip'\n  location: location\n  sku: {\n    name: 'Basic'\n  }\n  properties: {\n    publicIPAllocationMethod: publicIPAddressType\n    publicIPAddressVersion: 'IPv4'\n    dnsSettings: {\n      domainNameLabel: '${uniqueDnsNameForPublicIP}${i}'\n    }\n  }\n}]\n\nresource vnet 'Microsoft.Network/virtualNetworks@2021-03-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        addressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: subnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource nic 'Microsoft.Network/networkInterfaces@2021-03-01' = [for i in range(0, numVMs): {\n  name: '${vmName}${i}-nic'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: pip[i].id\n          }\n          subnet: {\n            id: vnet.properties.subnets[0].id\n          }\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: nsg.id\n    }\n  }\n}]\n\nresource nsg 'Microsoft.Network/networkSecurityGroups@2021-03-01' = {\n  name: networkSecurityGroupName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'Allow-HTTP'\n        properties: {\n          protocol: '*'\n          sourcePortRange: '*'\n          destinationPortRange: '80'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 100\n          direction: 'Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource vm 'Microsoft.Compute/virtualMachines@2021-07-01' = [for i in range(0, numVMs): {\n  name: '${vmName}${i}'\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: '${vmName}${i}'\n      adminUsername: adminUserName\n      adminPassword: adminPasswordOrKey\n      linuxConfiguration: ((authenticationType == 'password') ? json('null') : linuxConfiguration)\n    }\n    storageProfile: {\n      imageReference: imageReference\n      osDisk: {\n        name: '${vmName}${i}-osdisk'\n        createOption: 'FromImage'\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: nic[i].id\n        }\n      ]\n    }\n  }\n}]\n\nresource customScript 'Microsoft.Compute/virtualMachines/extensions@2021-07-01' = [for i in range(0, numVMs): {\n  name: 'installcustomscript'\n  parent: vm[i]\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Extensions'\n    type: 'CustomScript'\n    typeHandlerVersion: '2.0'\n    autoUpgradeMinorVersion: true\n    settings: {\n      commandToExecute: 'sudo bash -c \"sudo apt-get install -f -y && sudo apt-get update -y && sudo apt-get upgrade -y && sudo apt-get install -y apache2 && echo \\\\\"You\\'re connected to $(hostname)\\\\\" | sudo tee /var/www/html/index.html\"'\n    }\n  }\n}]\n\nresource tmProfile 'Microsoft.Network/trafficmanagerprofiles@2018-08-01' = {\n  name: traficManagerProfileName\n  location: 'global'\n  properties: {\n    profileStatus: 'Enabled'\n    trafficRoutingMethod: 'Weighted'\n    dnsConfig: {\n      relativeName: uniqueDnsName\n      ttl: 30\n    }\n    monitorConfig: {\n      protocol: 'HTTP'\n      port: 80\n      path: '/'\n    }\n    endpoints: [for i in range(0, numVMs): {\n      name: 'endpoint${i}'\n      type: 'Microsoft.Network/trafficManagerProfiles/azureEndpoints'\n      properties: {\n        targetResourceId: pip[i].id\n        endpointStatus: 'Enabled'\n        weight: 1\n      }\n    }]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1235."}, {"role": "assistant", "content": "@description('Relative DNS name for the traffic manager profile, resulting FQDN will be <uniqueDnsName>.trafficmanager.net, must be globally unique.')\nparam uniqueDnsName string\n\n@description('Relative DNS name for the WebApps, must be globally unique.  An index will be appended for each Web App.')\nparam uniqueDnsNameForWebApp string\n\n@description('Name of the App Service Plan that is being created')\nparam appServicePlanName string\nparam location string = resourceGroup().location\n\n@description('Name of the trafficManager being created')\nparam trafficManagerName string\n\nresource appServicePlan 'Microsoft.Web/serverFarms@2020-12-01' = {\n  name: appServicePlanName\n  location: location\n  sku: {\n    name: 'S1'\n    tier: 'Standard'\n  }\n}\n\nresource webSite 'Microsoft.Web/sites@2020-12-01' = {\n  name: uniqueDnsNameForWebApp\n  location: location\n  properties: {\n    serverFarmId: appServicePlan.id\n  }\n}\n\nresource trafficManagerProfile 'Microsoft.Network/trafficManagerProfiles@2018-08-01' = {\n  name: trafficManagerName\n  location: 'global'\n  properties: {\n    profileStatus: 'Enabled'\n    trafficRoutingMethod: 'Priority'\n    dnsConfig: {\n      relativeName: uniqueDnsName\n      ttl: 30\n    }\n    monitorConfig: {\n      protocol: 'HTTPS'\n      port: 443\n      path: '/'\n    }\n    endpoints: [\n      {\n        name: uniqueDnsNameForWebApp\n        type: 'Microsoft.Network/trafficManagerProfiles/azureEndpoints'\n        properties: {\n          targetResourceId: webSite.id\n          endpointStatus: 'Enabled'\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1236."}, {"role": "assistant", "content": "@description('Location where all resources will be created.')\nparam location string = resourceGroup().location\n\n@description('Name of the Virtual Wan.')\nparam vWanName string = 'SampleVirtualWan'\n\n@description('Sku of the Virtual Wan.')\n@allowed([\n  'Standard'\n  'Basic'\n])\nparam vWanSku string = 'Standard'\n\n@description('Name of the Virtual Hub. A virtual hub is created inside a virtual wan.')\nparam hubName string = 'SampleVirtualHub'\n\n@description('Name of the VPN Gateway. A VPN Gateway is created inside a virtual hub.')\nparam vpnGatewayName string = 'SampleVpnGateway'\n\n@description('Name of the vpnsite. A vpnsite represents the on-premise vpn device. A public ip address is mandatory for a VPN Site creation.')\nparam vpnSiteName string = 'SampleVpnSite'\n\n@description('Name of the vpnconnection. A vpn connection is established between a vpnsite and a VPN Gateway.')\nparam connectionName string = 'SampleVpnsiteVpnGwConnection'\n\n@description('A list of static routes corresponding to the VPN Gateway. These are configured on the VPN Gateway. Mandatory if BGP is disabled.')\nparam vpnSiteAddressspaceList array = []\n\n@description('The public IP address of a VPN Site.')\nparam vpnSitePublicIPAddress string\n\n@description('The BGP ASN number of a VPN Site. Unused if BGP is disabled.')\nparam vpnSiteBgpAsn int\n\n@description('The BGP peer IP address of a VPN Site. Unused if BGP is disabled.')\nparam vpnSiteBgpPeeringAddress string\n\n@description('The hub address prefix. This address prefix will be used as the address prefix for the hub vnet')\nparam hubAddressPrefix string = '192.168.0.0/24'\n\n@description('This needs to be set to true if BGP needs to enabled on the VPN connection.')\nparam enableBgp bool = false\n\nresource vWan 'Microsoft.Network/virtualWans@2021-03-01' = {\n  name: vWanName\n  location: location\n  properties: {\n    type: vWanSku\n  }\n}\n\nresource hub 'Microsoft.Network/virtualHubs@2021-03-01' = {\n  name: hubName\n  location: location\n  properties: {\n    addressPrefix: hubAddressPrefix\n    virtualWan: {\n      id: vWan.id\n    }\n  }\n}\n\nresource vpnSite 'Microsoft.Network/vpnSites@2021-03-01' = {\n  name: vpnSiteName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: vpnSiteAddressspaceList\n    }\n    bgpProperties: (enableBgp ? {\n      asn: vpnSiteBgpAsn\n      bgpPeeringAddress: vpnSiteBgpPeeringAddress\n      peerWeight: 0\n    } : null)\n    deviceProperties: {\n      linkSpeedInMbps: 10\n    }\n    ipAddress: vpnSitePublicIPAddress\n    virtualWan: {\n      id: vWan.id\n    }\n  }\n}\n\nresource vpnGateway 'Microsoft.Network/vpnGateways@2021-03-01' = {\n  name: vpnGatewayName\n  location: location\n  properties: {\n    connections: [\n      {\n        name: connectionName\n        properties: {\n          connectionBandwidth: 10\n          enableBgp: enableBgp\n          remoteVpnSite: {\n            id: vpnSite.id\n          }\n        }\n      }\n    ]\n    virtualHub: {\n      id: hub.id\n    }\n    bgpSettings: {\n      asn: 65515\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1237."}, {"role": "assistant", "content": "@minLength(4)\n@maxLength(80)\nparam vWANname string = 'vWAN'\n\n@description('Region for the Azure Virtual WAN')\nparam vWANlocation string = resourceGroup().location \n\n@description('Name of the FIRST virtual hub')\n@minLength(4)\n@maxLength(80)\nparam hub1Name string = 'Hub1' \n\n@description('Region for the FIRST virtual hub')\nparam hub1Location string = resourceGroup().location\n\n@description('Address space for the FIRST virtual hub')\nparam hub1AddressSpace string = '10.1.0.0/23'\n\n@description('Address space for the first VNet (spoke1) connected to the FIRST virtual hub')\nparam hub1Spoke1AddressSpace string = '10.1.2.0/24'\n\n@description('Address space for the second VNet (spoke2) connected to the FIRST virtual hub')\nparam hub1Spoke2AddressSpace string = '10.1.4.0/24'\n\n@description('Name of the SECOND virtual hub')\n@minLength(4)\n@maxLength(80)\nparam hub2Name string = 'Hub2'\n\n@description('Region for the SECOND virtual hub')\nparam hub2Location string = resourceGroup().location\n\n@description('Address space for the SECOND virtual hub')\nparam hub2AddressSpace string = '10.2.0.0/23'\n\n@description('Address space for the first VNet (spoke1) connected to the SECOND virtual hub')\nparam hub2Spoke1AddressSpace string = '10.2.2.0/24'\n\n@description('Address space for the second VNet (spoke2) connected to the SECOND virtual hub')\nparam hub2Spoke2AddressSpace string = '10.2.4.0/24'\n\n@description('Azure Firewall Tier')\n@allowed([\n  'Standard'\n  'Premium'\n])\nparam firewallTier string = 'Standard' \n\n@description('Default with RFC1918 prefixes, to add more use comma separated list of values in CIDR notation')\nparam firewallSNATprivateRanges string[] = ['10.0.0.0/8','172.16.0.0/12','192.168.0.0/16','100.64.0.0/10'] //default values\n// param firewallSNATprivateRanges string[] = ['10.0.0.0/8','172.16.0.0/12','192.168.0.0/16','100.64.0.0/10,'11.0.0.0/8','12.0.0.0/8','13.0.0.0/8'] // example with custom values \n\n@description('Enable vWAN Routing Intent and Policy for Internet Traffic')\nparam internetTrafficRoutingPolicy bool = true\n\n@description('Enable vWAN Routing Intent and Policy for Private Traffic')\nparam privateTrafficRoutingPolicy bool = true\n\n// NOTE: vWAN Routing Intent and Policy requires either InternetTrafficRoutingPolicy or PrivateTrafficRoutingPolicy to be true, otherwise feature will be disabled.\n\n// NOTE: specifying additional private IP prefixes will be unavaliable only if private traffic is not secured\n\n@description('Custom public IP prefixes to consider as internal for Virtual WAN - insert as comma-separated list of values in CIDR notation')\nparam customPrivateTrafficPrefixes string[] = []\n// param customPrivateTrafficPrefixes string[] = ['11.0.0.0/8','12.0.0.0/8','13.0.0.0/8'] // example with custom values \n\n@description('Deploy VPN Site-to-Site (S2S) Gateways')\nparam deployS2Sgw bool = false\n\n@description('Deploy ExpressRoute Gateways')\nparam deployERgw bool = false\n\nvar vWANtype = 'Standard' // 'Standard' vWAN is required for Routing Intent and Policy\nvar logAnalyticsWorkspaceName = '${vWANname}-LogAnalyticsWS' //single Log Analytics workspace for firewall logging\nvar logAnalyticsWorkspaceSKU = 'pergb2018' // default value is 'pergb2018'\nvar rfc1918addressSpaces = ['10.0.0.0','172.16.0.0','192.168.0.0'] // RFC1918 address spaces\nvar vpnGatewayScaleUnit = 1 // minimum value is 1\nvar erGatewayScaleUnit = 1 // minimum value is 1\nvar virtualRouterAsn = 65515 // default value is 65515 for Azure Virtual WAN\nvar minRoutingInfrastructureUnit = 2 // minimum value is 2 for Azure Virtual WAN\nvar vWANhubs = [\n  {\n            name: hub1Name\n            addressSpace: hub1AddressSpace\n            location: hub1Location\n            routingPreference: 'ExpressRoute' // \"ASPath\", \"ExpressRoute\", \"VpnGateway\" - default is \"ExpressRoute\"\n            fwName: take('${vWANname}-${hub1Name}-AzFW',56) //maximum length for Firewall name is 56 characters\n            fwTier: firewallTier // 'Standard' or 'Premium'\n            fwPublicIPs: 1 // Mininum value is 1\n            fwPolicyName: '${vWANname}-${hub1Name}-FirewallPolicy'\n            threatIntelMode: 'Alert' // 'Alert', 'Deny', 'Off' - default is 'Off'\n            spoke1: {name:'${hub1Name}-vnet1', addressSpace: hub1Spoke1AddressSpace}\n            spoke2: {name:'${hub1Name}-vnet2', addressSpace: hub1Spoke2AddressSpace}\n  }\n  { \n            name: hub2Name\n            addressSpace: hub2AddressSpace\n            location: hub2Location\n            routingPreference: 'ExpressRoute' // \"ASPath\", \"ExpressRoute\", \"VpnGateway\" - default is \"ExpressRoute\"\n            fwName: take('${vWANname}-${hub2Name}-AzFW',56)\n            fwTier: firewallTier // 'Standard' or 'Premium'\n            fwPublicips: 1 // Mininum value is 1\n            fwPolicyName: '${vWANname}-${hub2Name}-FirewallPolicy'\n            threatIntelMode: 'Alert' // 'Alert', 'Deny', 'Off' - default is 'Off'\n            spoke1: {name:'${hub2Name}-vnet1', addressSpace: hub2Spoke1AddressSpace}\n            spoke2: {name:'${hub2Name}-vnet2', addressSpace: hub2Spoke2AddressSpace}     \n  }\n]\n\n// module for Log Analytics workspace deployment\nmodule logAnalyticsWsModule './modules/loganalyticsws.bicep' = {\n  name: 'logAnalyticsWSmodule'\n  params: {\n   logAnalyticsWorkspaceName: logAnalyticsWorkspaceName\n   location: vWANhubs[0].location\n   logAnalyticsWorkspaceSKU: logAnalyticsWorkspaceSKU\n  }\n}\n\n// module for VNets deployment \nmodule vNetsModule './modules/vnets.bicep' = {\n  name: 'vNetsModule'\n  params: {\n    vWANhubs: vWANhubs\n  }\n}\n\n// module for IP Groups deployment \nmodule ipGroupsModule './modules/ipgroups.bicep' = {\n  name: 'ipGroupsModule'\n  params: {\n    vWANname: vWANname\n    vWANhubs: vWANhubs\n  }\n}\n\nmodule firewallPolicies './modules/firewallpolicies.bicep' = {\n  name: 'firewallPoliciesModule'\n  params: {\n    vWANhubs: vWANhubs \n    sourceIPAddressSpaces: rfc1918addressSpaces\n    destinationIPAddressSpaces: rfc1918addressSpaces\n    firewallSNATprivateRanges: firewallSNATprivateRanges\n  }\n}\n\nresource vWAN 'Microsoft.Network/virtualWans@2023-04-01' = {\n  name: vWANname\n  location: vWANlocation\n  properties: {\n    disableVpnEncryption: false\n    allowBranchToBranchTraffic: true\n    type: vWANtype\n  }\n}\n\nresource vWANHub1 'Microsoft.Network/virtualHubs@2023-04-01' = {\n  name: vWANhubs[0].name\n  location: vWANhubs[0].location\n  properties: {\n    addressPrefix: vWANhubs[0].addressSpace\n    virtualRouterAsn: virtualRouterAsn\n    virtualRouterAutoScaleConfiguration: {\n      minCapacity: minRoutingInfrastructureUnit \n    }\n    virtualWan: {\n      id: vWAN.id\n    }\n    sku: vWANtype\n    hubRoutingPreference: vWANhubs[0].routingPreference\n  }\n}\n\nresource vWANHub2 'Microsoft.Network/virtualHubs@2023-04-01' = {\n  name: vWANhubs[1].name\n  location: vWANhubs[1].location\n  properties: {\n    addressPrefix: vWANhubs[1].addressSpace \n    virtualRouterAsn: virtualRouterAsn\n    virtualRouterAutoScaleConfiguration: {\n      minCapacity: minRoutingInfrastructureUnit\n    }\n    virtualWan: {\n      id: vWAN.id\n    }\n    sku: vWANtype\n    hubRoutingPreference: vWANhubs[1].routingPreference\n  }\n}\n\nresource hub1Firewall 'Microsoft.Network/azureFirewalls@2023-04-01' = {\n  name: vWANhubs[0].fwName\n  location: vWANhubs[0].location\n  zones: pickZones('Microsoft.Network', 'azureFirewalls', vWANhubs[0].location,3)\n  properties: {\n    sku: {\n      name: 'AZFW_Hub'\n      tier: vWANhubs[0].fwTier\n    } \n    virtualHub: {\n      id: vWANHub1.id\n    }\n    hubIPAddresses: {      \n      publicIPs: {\n        count: vWANhubs[0].fwPublicIPs\n      }\n    }\n    firewallPolicy: {\n      id: firewallPolicies.outputs.fwPolicyArrayIDs[0]\n    }\n  }\n}\n\nresource hub2Firewall 'Microsoft.Network/azureFirewalls@2023-04-01' = {\n  name: vWANhubs[1].fwName\n  location: vWANhubs[1].location\n zones: pickZones('Microsoft.Network', 'azureFirewalls', vWANhubs[1].location,3)\n  properties: {\n    sku: {\n      name: 'AZFW_Hub'\n      tier: vWANhubs[1].fwTier\n    }\n    virtualHub: {\n      id: vWANHub2.id\n    }\n    hubIPAddresses: {\n      publicIPs: {\n        count: vWANhubs[0].fwPublicIPs\n      }\n    }\n    firewallPolicy: {\n      id: firewallPolicies.outputs.fwPolicyArrayIDs[1]\n    }\n  }\n}\n\n// NOTE: vWAN Routing Intent and Policy requires either InternetTrafficRoutingPolicy or PrivateTrafficRoutingPolicy to be true, otherwise feature will be disabled.\n\nmodule resourceIntentModule './modules/routingintent.bicep' = if (internetTrafficRoutingPolicy == true || privateTrafficRoutingPolicy == true ) {\n  name: 'resourceIntentModule'\n  params:{\n    vWANhubs: vWANhubs\n    internetTrafficRoutingPolicy: internetTrafficRoutingPolicy\n    privateTrafficRoutingPolicy: privateTrafficRoutingPolicy\n  }\n  #disable-next-line no-unnecessary-depends\n  dependsOn: [vWANHub1,vWANHub2,hub1Firewall,hub2Firewall]\n}\n\nmodule PrivateTrafficRouteTable './modules/PrivateTrafficRouteTable.bicep' = if ((internetTrafficRoutingPolicy == true || privateTrafficRoutingPolicy == true ) && !empty(customPrivateTrafficPrefixes)) {\n  name: 'PrivateTrafficRouteTable'\n  params: {\n    vWANhubs: vWANhubs\n    internetTrafficRoutingPolicy: internetTrafficRoutingPolicy\n    privateTrafficRoutingPolicy: privateTrafficRoutingPolicy\n    customPrivateTrafficPrefixes: customPrivateTrafficPrefixes\n  }\n  #disable-next-line no-unnecessary-depends\n  dependsOn: [resourceIntentModule]\n}\n\n\nmodule firewallDiagnosticsModule './modules/fwdiagnostics.bicep' = {\n  name: 'firewallDiagnosticsModule'\n  params: {\n    vWANhubs: vWANhubs\n    logAnalyticsWorkspaceID: logAnalyticsWsModule.outputs.LogAnalyticsWorkspaceID\n  }\n  #disable-next-line no-unnecessary-depends\n  dependsOn:[hub1Firewall, hub2Firewall]\n}\n\nmodule vnetConnectionsModule'./modules/vnetconnections.bicep' = {\n  name: 'vnetConnectionsModule'\n  params: {\n    vWANhubs: vWANhubs\n    vNetsIDs: vNetsModule.outputs.spokeVnetsIDs\n  }\n  #disable-next-line no-unnecessary-dependson\n  dependsOn: [hub1Firewall, hub2Firewall]\n}\n\nmodule vpnS2Smodule './modules/vpns2s.bicep' = if (deployS2Sgw == true) {\n  name: 'vpnS2Smodule'\n  params: {\n    vWANhubs: vWANhubs\n    vWANHub1ID: vWANHub1.id\n    vWANHub2ID: vWANHub2.id\n    vpnGatewayScaleUnit: vpnGatewayScaleUnit\n    logAnalyticsWorkspaceID: logAnalyticsWsModule.outputs.LogAnalyticsWorkspaceID\n  }\n  #disable-next-line no-unnecessary-dependson // This is required to avoid conflicts in vWAN RP, some resources must be created in a certain order\n  dependsOn: [resourceIntentModule]\n}\n\nmodule erModule './modules/er.bicep' = if (deployERgw == true) {\n  name: 'erModule'\n  params:{\n    vWANhubs: vWANhubs\n    vWANHub1ID: vWANHub1.id\n    vWANHub2ID: vWANHub2.id\n    ErGatewayScaleUnit: erGatewayScaleUnit\n    LogAnalyticsWorkspaceID: logAnalyticsWsModule.outputs.LogAnalyticsWorkspaceID\n  }\n  #disable-next-line no-unnecessary-dependson\n  dependsOn: [resourceIntentModule]\n}\n\n// Generate outputs for Public IP addresses used by Azure Firewalls and VPN Gateways (if deployed):\noutput hub1FirewallPublicIPaddresses object = hub1Firewall.properties.hubIPAddresses.publicIPs\noutput hub2FirewallPublicIPaddresses object = hub2Firewall.properties.hubIPAddresses.publicIPs\noutput hub1VPNs2sGatewayIPaddresses array = deployS2Sgw ? vpnS2Smodule.outputs.vpnGatewayConfigs[0] : ['No VPN S2S gateway deployed in ${vWANhubs[0].name}.']\noutput hub2VPNs2sGatewayIPaddresses array = deployS2Sgw ? vpnS2Smodule.outputs.vpnGatewayConfigs[1] : ['No VPN S2S gateway deployed in ${vWANhubs[1].name}.']\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1238 please."}, {"role": "assistant", "content": "param vWANhubs array\nparam vWANHub1ID string\nparam vWANHub2ID string\nparam ErGatewayScaleUnit int\nparam LogAnalyticsWorkspaceID string\n//param LogAnalyticsWorkspaceRetentionDays int \n\nresource Hub1ErGateway 'Microsoft.Network/expressRouteGateways@2023-04-01' = {\n  name: '${vWANhubs[0].name}-ErGateway'\n  location: vWANhubs[0].location\n  properties: {\n    virtualHub: {\n      id: vWANHub1ID\n    }\n    allowNonVirtualWanTraffic: false\n    autoScaleConfiguration: {\n      bounds: {\n        min: ErGatewayScaleUnit\n      }\n    }\n  }\n}\n\nresource ErGw1_DiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: '${vWANhubs[0].name}-ErGatewayDiagnosticSettings'\n  scope: Hub1ErGateway\n  properties: {\n    workspaceId: LogAnalyticsWorkspaceID\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n        /* retentionPolicy: {\n          enabled: true\n          days: LogAnalyticsWorkspaceRetentionDays\n        } */\n      }\n    ]\n  }\n}\n\nresource Hub2ErGateway 'Microsoft.Network/expressRouteGateways@2023-04-01' = {\n  name: '${vWANhubs[1].name}-ErGateway'\n  location: vWANhubs[1].location\n  properties: {\n    virtualHub: {\n      id: vWANHub2ID\n    }\n    allowNonVirtualWanTraffic: false\n    autoScaleConfiguration: {\n      bounds: {\n        min: ErGatewayScaleUnit\n      }\n    }\n  }\n}\n\nresource ErGw2_DiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: '${vWANhubs[1].name}-ErGatewayDiagnosticSettings'\n  scope: Hub2ErGateway\n  properties: {\n    workspaceId: LogAnalyticsWorkspaceID\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n        /* retentionPolicy: {\n          enabled: true \n          days: LogAnalyticsWorkspaceRetentionDays\n        } */\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1239?"}, {"role": "assistant", "content": "param vWANhubs array\nparam sourceIPAddressSpaces array\nparam destinationIPAddressSpaces array\nparam firewallSNATprivateRanges string[]\n\nvar NetworkRuleCollectionGroupPriority = 50000\nvar DefaultNetworkRuleCollectionGroup = 'DefaultNetworkRuleCollectionGroup'\n\nresource hub1FirewallPolicy 'Microsoft.Network/firewallPolicies@2023-04-01' = {\n  name: vWANhubs[0].fwpolicyname\n  location: vWANhubs[0].location\n  properties: {\n    sku: {\n      tier: vWANhubs[0].fwtier\n    }\n    snat: {\n      privateRanges: firewallSNATprivateRanges\n    }\n\n    threatIntelMode: vWANhubs[0].threatintelmode\n  }\n}\n\nresource hub2FirewallPolicy 'Microsoft.Network/firewallPolicies@2023-04-01' = {\n  name: vWANhubs[1].fwpolicyname\n  location: vWANhubs[1].location\n  properties: {\n    sku: {\n      tier: vWANhubs[1].fwtier\n    }\n    threatIntelMode: vWANhubs[1].threatintelmode\n    snat: {\n      privateRanges: firewallSNATprivateRanges\n    }\n  }\n}\n\nresource hub2FirewallPolicyDefaultNetworkRuleCollectionGroup 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2023-04-01' = {\n  parent: hub2FirewallPolicy\n  name: DefaultNetworkRuleCollectionGroup\n  properties: {\n    priority: NetworkRuleCollectionGroupPriority\n    ruleCollections: [\n      {\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        action: {\n          type: 'Allow'\n        }\n        rules: [\n          {\n            ruleType: 'NetworkRule'\n            name: 'DefaultAllowRule'\n            ipProtocols: [\n              'TCP'\n              'UDP'\n              'ICMP'\n              'Any'\n            ]\n            sourceAddresses: sourceIPAddressSpaces\n            destinationAddresses: destinationIPAddressSpaces\n            destinationPorts: [\n              '*'\n            ]\n          }\n        ]\n        name: 'NetworkCollectionAllowDefault'\n        priority: NetworkRuleCollectionGroupPriority\n      }\n    ]\n  }\n}\n\nresource hub1FirewallPolicyDefaultNetworkRuleCollectionGroup 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2023-04-01' = {\n  parent: hub1FirewallPolicy\n  name: DefaultNetworkRuleCollectionGroup\n  properties: {\n    priority: NetworkRuleCollectionGroupPriority\n    ruleCollections: [\n      {\n        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'\n        action: {\n          type: 'Allow'\n        }\n        rules: [\n          {\n            ruleType: 'NetworkRule'\n            name: 'DefaultAllowRule'\n            ipProtocols: [\n              'TCP'\n              'UDP'\n              'ICMP'\n              'Any'\n            ]\n            sourceAddresses: sourceIPAddressSpaces\n            destinationAddresses: destinationIPAddressSpaces\n            destinationPorts: [\n              '*'\n            ]\n          }\n        ]\n        name: 'NetworkCollectionAllowDefault'\n        priority: NetworkRuleCollectionGroupPriority\n      }\n    ]\n  }\n}\n\noutput fwPolicyArrayIDs array = [\n  hub1FirewallPolicy.id\n  hub2FirewallPolicy.id\n]\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1240."}, {"role": "assistant", "content": "param vWANhubs array\nparam logAnalyticsWorkspaceID string\n// param logAnalyticsWorkspaceRetentionDays int\n\nresource hub1Firewall 'Microsoft.Network/azureFirewalls@2023-04-01' existing = {\n  name: vWANhubs[0].fwname\n}\n\nresource hub2Firewall 'Microsoft.Network/azureFirewalls@2023-04-01' existing = {\n  name: vWANhubs[1].fwname\n}\n\nresource Firewall1DiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: '${vWANhubs[0].fwname}-DiagnosticSettings'\n  scope: hub1Firewall\n  properties: {\n    workspaceId: logAnalyticsWorkspaceID\n    logs: [\n      {\n        categoryGroup: 'allLogs'\n        enabled: true\n        /* retentionPolicy: {\n          enabled: true\n          days: logAnalyticsWorkspaceRetentionDays\n        } */\n      }      \n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n       /* retentionPolicy: {\n          enabled: true\n          days: logAnalyticsWorkspaceRetentionDays\n        } */\n      }\n    ]\n  }\n}\n\nresource Firewall2DiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: '${vWANhubs[1].fwname}-DiagnosticSettings' \n  scope: hub2Firewall\n  properties: {\n    workspaceId: logAnalyticsWorkspaceID\n    logs: [\n      {\n        categoryGroup: 'allLogs'\n        enabled: true\n       /* retentionPolicy: {\n          enabled: true\n          days: logAnalyticsWorkspaceRetentionDays\n        } */\n      }      \n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n        /* retentionPolicy: {\n          enabled: true\n          days: logAnalyticsWorkspaceRetentionDays\n        } */\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1241?"}, {"role": "assistant", "content": "param vWANname string\nparam vWANhubs array\n\nresource IPGroupHub1SpokeVnet1 'Microsoft.Network/ipGroups@2023-04-01' = {\n  name: 'IPGroup-${vWANname}-${vWANhubs[0].spoke1.name}'\n  location: vWANhubs[0].location\n  properties: {\n    ipAddresses: [\n      vWANhubs[0].spoke1.addressSpace\n    ]\n  }\n}\n\nresource IPGroupHub1SpokeVnet2 'Microsoft.Network/ipGroups@2023-04-01' = {\n  name: 'IPGroup-${vWANname}-${vWANhubs[0].spoke2.name}'\n  location: vWANhubs[0].location\n  properties: {\n    ipAddresses: [\n      vWANhubs[0].spoke2.addressSpace\n    ]\n  }\n  #disable-next-line no-unnecessary-dependson // This is required to avoid conflicts with multiple concurrent updates on IPGroups\n  dependsOn: [IPGroupHub1SpokeVnet1]\n}\n\nresource IPGroupHub2SpokeVnet1 'Microsoft.Network/ipGroups@2023-04-01' = {\n  name: 'IPGroup-${vWANname}-${vWANhubs[1].spoke1.name}'\n  location: vWANhubs[1].location\n  properties: {\n    ipAddresses: [\n      vWANhubs[1].spoke1.addressSpace\n    ]\n  }\n  #disable-next-line no-unnecessary-dependson // This is required to avoid conflicts with multiple concurrent updates on IPGroups\n  dependsOn: [IPGroupHub1SpokeVnet2]\n}\n\nresource IPGroupHub2SpokeVnet2 'Microsoft.Network/ipGroups@2023-04-01' = {\n  name: 'IPGroup-${vWANname}-${vWANhubs[1].spoke2.name}'\n  location: vWANhubs[1].location\n  properties: {\n    ipAddresses: [\n      vWANhubs[1].spoke2.addressSpace\n    ]\n  }\n  #disable-next-line no-unnecessary-dependson // This is required to avoid conflicts with multiple concurrent updates on IPGroups\n  dependsOn: [IPGroupHub2SpokeVnet1]\n}\n\noutput IPGroupsIDs array = [\n  IPGroupHub1SpokeVnet1.id\n  IPGroupHub1SpokeVnet2.id\n  IPGroupHub2SpokeVnet1.id\n  IPGroupHub2SpokeVnet2.id\n]\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1242."}, {"role": "assistant", "content": "param logAnalyticsWorkspaceName string\nparam location string\nparam logAnalyticsWorkspaceSKU string\n//param logAnalyticsWorkspaceRetentionDays int\n\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {\n  name: logAnalyticsWorkspaceName\n  location: location\n  properties: {\n    sku: {\n      name: logAnalyticsWorkspaceSKU\n    }\n    //retentionInDays: logAnalyticsWorkspaceRetentionDays\n    features: {\n      enableLogAccessUsingOnlyResourcePermissions: true\n    }\n    workspaceCapping: {\n      dailyQuotaGb: -1\n    }\n    publicNetworkAccessForIngestion: 'Enabled'\n    publicNetworkAccessForQuery: 'Enabled'\n  }\n}\n\noutput LogAnalyticsWorkspaceID string = logAnalyticsWorkspace.id \n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1243."}, {"role": "assistant", "content": "param vWANhubs array\nparam internetTrafficRoutingPolicy bool\nparam privateTrafficRoutingPolicy bool\nparam customPrivateTrafficPrefixes string[]\n\n// NOTE: vWAN Routing Intent and Policy requires either InternetTrafficRoutingPolicy or PrivateTrafficRoutingPolicy to be true, otherwise feature will be disabled.\n\nresource hub1Firewall 'Microsoft.Network/azureFirewalls@2023-04-01' existing = {\n  name: vWANhubs[0].fwname\n}\n\nresource hub2Firewall 'Microsoft.Network/azureFirewalls@2023-04-01' existing = {\n  name: vWANhubs[1].fwname\n}\n\nresource virtualHubs_Hub1_defaultRouteTable 'Microsoft.Network/virtualHubs/hubRouteTables@2023-06-01' = {\n    name: '${vWANhubs[0].name}/defaultRouteTable'\n    properties: {\n      routes: (internetTrafficRoutingPolicy == true && privateTrafficRoutingPolicy == true) ? [\n        {\n          name: '_policy_PublicTraffic'\n          destinationType: 'CIDR'\n          destinations: [\n            '0.0.0.0/0'\n          ]\n          nextHopType: 'ResourceId'\n          nextHop: hub1Firewall.id\n        }\n        {\n          name: '_policy_PrivateTraffic'\n          destinationType: 'CIDR'\n          destinations: [\n            '10.0.0.0/8'\n            '172.16.0.0/12'\n            '192.168.0.0/16'\n          ]\n          nextHopType: 'ResourceId'\n          nextHop: hub1Firewall.id\n        }\n        {\n          name: 'private_traffic'\n          destinationType: 'CIDR'\n          destinations: customPrivateTrafficPrefixes\n          nextHopType: 'ResourceId'\n          nextHop: hub1Firewall.id \n        }\n      ] : (internetTrafficRoutingPolicy == true && privateTrafficRoutingPolicy == false) ? [\n        {\n          name: '_policy_PublicTraffic'\n          destinationType: 'CIDR'\n          destinations: [\n            '0.0.0.0/0'\n          ]\n          nextHopType: 'ResourceId'\n          nextHop: hub1Firewall.id\n        }\n      ] : [\n        {\n          name: '_policy_PrivateTraffic'\n          destinationType: 'CIDR'\n          destinations: [\n            '10.0.0.0/8'\n            '172.16.0.0/12'\n            '192.168.0.0/16'\n          ]\n          nextHopType: 'ResourceId'\n          nextHop: hub1Firewall.id\n        }\n        {\n          name: 'private_traffic'\n          destinationType: 'CIDR'\n          destinations: customPrivateTrafficPrefixes\n          nextHopType: 'ResourceId'\n          nextHop: hub1Firewall.id \n        }\n      ]\n      labels: [\n        'default'\n      ]\n    }\n  }\n  \n  \n  resource virtualHubs_Hub2_defaultRouteTable 'Microsoft.Network/virtualHubs/hubRouteTables@2023-06-01' = {\n    name: '${vWANhubs[1].name}/defaultRouteTable'\n    properties: {\n      routes: (internetTrafficRoutingPolicy == true && privateTrafficRoutingPolicy == true) ? [\n        {\n          name: '_policy_PublicTraffic'\n          destinationType: 'CIDR'\n          destinations: [\n            '0.0.0.0/0'\n          ]\n          nextHopType: 'ResourceId'\n          nextHop: hub2Firewall.id\n        }\n        {\n          name: '_policy_PrivateTraffic'\n          destinationType: 'CIDR'\n          destinations: [\n            '10.0.0.0/8'\n            '172.16.0.0/12'\n            '192.168.0.0/16'\n          ]\n          nextHopType: 'ResourceId'\n          nextHop: hub2Firewall.id\n        }\n        {\n          name: 'private_traffic'\n          destinationType: 'CIDR'\n          destinations: customPrivateTrafficPrefixes\n          nextHopType: 'ResourceId'\n          nextHop: hub2Firewall.id \n        }\n      ] : (internetTrafficRoutingPolicy == true && privateTrafficRoutingPolicy == false) ? [\n        {\n          name: '_policy_PublicTraffic'\n          destinationType: 'CIDR'\n          destinations: [\n            '0.0.0.0/0'\n          ]\n          nextHopType: 'ResourceId'\n          nextHop: hub2Firewall.id\n        }\n      ] : [\n        {\n          name: '_policy_PrivateTraffic'\n          destinationType: 'CIDR'\n          destinations: [\n            '10.0.0.0/8'\n            '172.16.0.0/12'\n            '192.168.0.0/16'\n          ]\n          nextHopType: 'ResourceId'\n          nextHop: hub2Firewall.id\n        }\n        {\n          name: 'private_traffic'\n          destinationType: 'CIDR'\n          destinations: customPrivateTrafficPrefixes\n          nextHopType: 'ResourceId'\n          nextHop: hub2Firewall.id \n        }\n      ]\n      labels: [\n        'default'\n      ]\n    }\n  }\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1244?"}, {"role": "assistant", "content": "param vWANhubs array\nparam internetTrafficRoutingPolicy bool\nparam privateTrafficRoutingPolicy bool\n// NOTE: vWAN Routing Intent and Policy requires either InternetTrafficRoutingPolicy or PrivateTrafficRoutingPolicy to be true, otherwise feature will be disabled.\n\nresource vWANHub1 'Microsoft.Network/virtualHubs@2023-04-01' existing = {\n  name: vWANhubs[0].name\n}\n\nresource vWANHub2 'Microsoft.Network/virtualHubs@2022-11-01' existing = {\n  name: vWANhubs[1].name\n}\n\nresource hub1Firewall 'Microsoft.Network/azureFirewalls@2023-04-01' existing = {\n  name: vWANhubs[0].fwname\n}\n\nresource hub2Firewall 'Microsoft.Network/azureFirewalls@2023-04-01' existing = {\n  name: vWANhubs[1].fwname\n}\n\nresource vWANHub1RoutingIntent 'Microsoft.Network/virtualHubs/routingIntent@2023-04-01' = {\n  parent: vWANHub1\n  name: '${vWANhubs[0].name}-RoutingIntent'\n  properties: {\n    routingPolicies: (internetTrafficRoutingPolicy == true && privateTrafficRoutingPolicy == true) ? [\n        {\n          name: 'PublicTraffic'\n          destinations: [\n            'Internet'\n          ]\n          nextHop: hub1Firewall.id\n        }\n       {\n          name: 'PrivateTraffic'\n          destinations: [\n            'PrivateTraffic'\n          ]\n          nextHop: hub1Firewall.id        \n       }\n      ] : (internetTrafficRoutingPolicy == true && privateTrafficRoutingPolicy == false) ? [\n        {\n          name: 'PublicTraffic'\n          destinations: [\n            'Internet'\n          ]\n          nextHop: hub1Firewall.id\n        }\n    ] : [\n      {\n        name: 'PrivateTraffic'\n        destinations: [\n          'PrivateTraffic'\n        ]\n        nextHop: hub1Firewall.id        \n     }\n    ]\n  }\n}\n\nresource vWANHub2RoutingIntent 'Microsoft.Network/virtualHubs/routingIntent@2023-04-01' = {\n  parent: vWANHub2\n  name: '${vWANhubs[1].name}-RoutingIntent'\n  properties: {\n    routingPolicies: (internetTrafficRoutingPolicy == true && privateTrafficRoutingPolicy == true) ? [\n        {\n          name: 'PublicTraffic'\n          destinations: [\n            'Internet'\n          ]\n          nextHop: hub2Firewall.id\n        }\n       {\n          name: 'PrivateTraffic'\n          destinations: [\n            'PrivateTraffic'\n          ]\n          nextHop: hub2Firewall.id        \n       }\n      ] : (internetTrafficRoutingPolicy == true && privateTrafficRoutingPolicy == false) ? [\n        {\n          name: 'PublicTraffic'\n          destinations: [\n            'Internet'\n          ]\n          nextHop: hub2Firewall.id\n        }\n    ] : [\n      {\n        name: 'PrivateTraffic'\n        destinations: [\n          'PrivateTraffic'\n        ]\n        nextHop: hub2Firewall.id        \n     }\n    ]\n  }\n}\n\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1245."}, {"role": "assistant", "content": "param vWANhubs array\nparam vNetsIDs array\n\nresource vWANHub1 'Microsoft.Network/virtualHubs@2022-11-01' existing = {\n  name: vWANhubs[0].name\n}\n\nresource hub1VNet1Connection 'Microsoft.Network/virtualHubs/hubVirtualNetworkConnections@2023-04-01' = {\n  parent: vWANHub1\nname: '${vWANhubs[0].name}-to-${vWANhubs[0].spoke1.name}-connection'\n  properties: {\n    remoteVirtualNetwork: {\n      id: vNetsIDs[0]\n    }\n    allowHubToRemoteVnetTransit: true\n    allowRemoteVnetToUseHubVnetGateways: true\n    enableInternetSecurity: true\n  }\n}\n\nresource hub1VNet2Connection 'Microsoft.Network/virtualHubs/hubVirtualNetworkConnections@2023-04-01' = {\n  parent: vWANHub1\n  name: '${vWANhubs[0].name}-to-${vWANhubs[0].spoke2.name}-connection'\n  properties: {\n    remoteVirtualNetwork: {\n      id: vNetsIDs[1]\n    }\n    allowHubToRemoteVnetTransit: true\n    allowRemoteVnetToUseHubVnetGateways: true\n    enableInternetSecurity: true\n  }\n}\n\nresource vWANHub2 'Microsoft.Network/virtualHubs@2023-04-01' existing = {\n  name: vWANhubs[1].name\n}\n\nresource hub2VNet1Connection 'Microsoft.Network/virtualHubs/hubVirtualNetworkConnections@2023-04-01' = {\n  parent: vWANHub2\n  name: '${vWANhubs[1].name}-to-${vWANhubs[1].spoke1.name}-connection'\n  properties: {\n    remoteVirtualNetwork: {\n      id: vNetsIDs[2]\n    }\n    allowHubToRemoteVnetTransit: true\n    allowRemoteVnetToUseHubVnetGateways: true\n    enableInternetSecurity: true\n  }\n}\n\nresource hub2VNet2Connection 'Microsoft.Network/virtualHubs/hubVirtualNetworkConnections@2023-04-01' = {\n  parent: vWANHub2\n  name: '${vWANhubs[1].name}-to-${vWANhubs[1].spoke2.name}-connection'\n  properties: {\n    remoteVirtualNetwork: {\n      id: vNetsIDs[3] \n    }\n    allowHubToRemoteVnetTransit: true\n    allowRemoteVnetToUseHubVnetGateways: true\n    enableInternetSecurity: true\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1246."}, {"role": "assistant", "content": "param vWANhubs array\n\nresource hub1SpokeVnet1 'Microsoft.Network/virtualNetworks@2023-04-01' = {\n  name: vWANhubs[0].spoke1.name\n  location: vWANhubs[0].location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vWANhubs[0].spoke1.addressSpace\n      ]\n    }\n    enableDdosProtection: false\n  }\n}\n\nresource hub1SpokeVnet2 'Microsoft.Network/virtualNetworks@2023-04-01' = {\n  name: vWANhubs[0].spoke2.name\n  location: vWANhubs[0].location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vWANhubs[0].spoke2.addressSpace\n      ]\n    }\n    enableDdosProtection: false\n  }\n}\n\nresource hub2SpokeVnet1 'Microsoft.Network/virtualNetworks@2023-04-01' = {\n  name: vWANhubs[1].spoke1.name\n  location: vWANhubs[1].location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vWANhubs[1].spoke1.addressSpace\n      ]\n    }\n    enableDdosProtection: false\n  }\n}\n\nresource hub2SpokeVnet2 'Microsoft.Network/virtualNetworks@2023-04-01' = {\n  name: vWANhubs[1].spoke2.name\n  location: vWANhubs[1].location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vWANhubs[1].spoke2.addressSpace\n      ]\n    }\n    enableDdosProtection: false\n  }\n}\n\nresource hub1SpokeVnet1Subnet 'Microsoft.Network/virtualNetworks/subnets@2023-04-01' = {\n  parent: hub1SpokeVnet1\n  name: '${vWANhubs[0].spoke1.name}-subnet'\n  properties: {\n    addressPrefix: vWANhubs[0].spoke1.addressSpace\n    privateEndpointNetworkPolicies: 'Disabled'\n    privateLinkServiceNetworkPolicies: 'Enabled'\n  } \n}\n\nresource hub1SpokeVnet2Subnet 'Microsoft.Network/virtualNetworks/subnets@2023-04-01' = {\n  parent: hub1SpokeVnet2\n  name: '${vWANhubs[0].spoke2.name}-subnet'\n  properties: {\n    addressPrefix: vWANhubs[0].spoke2.addressSpace\n    privateEndpointNetworkPolicies: 'Disabled'\n    privateLinkServiceNetworkPolicies: 'Enabled'\n  } \n}\n\nresource hub2SpokeVnet1Subnet 'Microsoft.Network/virtualNetworks/subnets@2023-04-01' = {\n  parent: hub2SpokeVnet1\n  name: '${vWANhubs[1].spoke1.name}-subnet'\n  properties: {\n    addressPrefix: vWANhubs[1].spoke1.addressSpace \n    privateEndpointNetworkPolicies: 'Disabled'\n    privateLinkServiceNetworkPolicies: 'Enabled'\n  }\n}\n\nresource hub2SpokeVnet2Subnet 'Microsoft.Network/virtualNetworks/subnets@2023-04-01' = {\n  parent: hub2SpokeVnet2\n  name: '${vWANhubs[1].spoke2.name}-subnet'\n  properties: {\n    addressPrefix: vWANhubs[1].spoke2.addressSpace\n    privateEndpointNetworkPolicies: 'Disabled'\n    privateLinkServiceNetworkPolicies: 'Enabled'\n  }\n}\n\noutput spokeVnetsIDs array = [\n  hub1SpokeVnet1.id\n  hub1SpokeVnet2.id\n  hub2SpokeVnet1.id\n  hub2SpokeVnet2.id\n]\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1247."}, {"role": "assistant", "content": "param vWANhubs array\nparam vWANHub1ID string\nparam vWANHub2ID string\nparam vpnGatewayScaleUnit int\nparam logAnalyticsWorkspaceID string\n//param logAnalyticsWorkspaceRetentionDays int\n\nvar defaultASN = 65515\nvar defaultPeerWeight = 0\n\nresource hub1VPNs2sGateway 'Microsoft.Network/vpnGateways@2023-04-01' = {\n  name: '${vWANhubs[0].name}-VPNs2sGateway'\n  location: vWANhubs[0].location\n  properties: {\n    virtualHub: {\n      id: vWANHub1ID\n    }\n    bgpSettings: {\n      asn: defaultASN\n      peerWeight: defaultPeerWeight\n    }\n    vpnGatewayScaleUnit: vpnGatewayScaleUnit\n    enableBgpRouteTranslationForNat: false\n    isRoutingPreferenceInternet: false\n  }\n}\n\nresource S2SvpnGw1DiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: '${vWANhubs[0].name}-VPNs2sGateway-DiagnosticSettings' \n  scope: hub1VPNs2sGateway\n  properties: {\n    workspaceId: logAnalyticsWorkspaceID\n    logs: [\n      {\n        categoryGroup: 'allLogs'\n        enabled: true\n        /* retentionPolicy: {\n          enabled: true\n          days: logAnalyticsWorkspaceRetentionDays\n        } */\n      }      \n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n        /* retentionPolicy: {\n          enabled: true\n          days: logAnalyticsWorkspaceRetentionDays\n        } */\n      }\n    ]\n  }\n}\n\nresource hub2VPNs2sGateway 'Microsoft.Network/vpnGateways@2023-04-01' = {\n  name: '${vWANhubs[1].name}-VPNs2sGateway'\n  location: vWANhubs[1].location\n  properties: {\n    virtualHub: {\n      id: vWANHub2ID\n    }\n    bgpSettings: {\n      asn: defaultASN\n      peerWeight: defaultPeerWeight\n    }\n    vpnGatewayScaleUnit: vpnGatewayScaleUnit \n    enableBgpRouteTranslationForNat: false\n    isRoutingPreferenceInternet: false\n  }\n}\n\nresource S2SvpnGw2DiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  name: '${vWANhubs[1].name}-VPNs2sGateway_DiagnosticSettings'  \n  scope: hub2VPNs2sGateway\n  properties: {\n    workspaceId: logAnalyticsWorkspaceID\n    logs: [\n      {\n        categoryGroup: 'allLogs'\n        enabled: true\n        /* retentionPolicy: {\n          enabled: true\n          days: logAnalyticsWorkspaceRetentionDays\n        } */\n      }      \n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n        /* retentionPolicy: {\n          enabled: true\n          days: logAnalyticsWorkspaceRetentionDays\n        } */\n      }\n    ]\n  }\n}\n\noutput vpnGatewayConfigs array = [\n   hub1VPNs2sGateway.properties.ipConfigurations\n   hub2VPNs2sGateway.properties.ipConfigurations\n]\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1248 please."}, {"role": "assistant", "content": "@description('Virtual network name')\nparam vnetName string = uniqueString(resourceGroup().id)\n\n@description('Virtual network location')\nparam location string = resourceGroup().location\n\n@description('Array containing virtual network address space(s)')\nparam vnetAddressSpace array = [\n  '10.0.0.0/16'\n]\n\n@description('Array containing DNS Servers')\nparam dnsServers array = []\n\n@description('Array containing subnets to create within the Virtual Network. For properties format refer to https://docs.microsoft.com/en-us/azure/templates/microsoft.network/virtualnetworks/subnets?tabs=bicep#subnetpropertiesformat')\nparam subnets array = [\n  {\n    name: 'subnet1'\n    addressPrefix: '10.0.1.0/24'\n    privateEndpointNetworkPolicies: 'disabled'\n    privateLinkServiceNetworkPolicies: 'disabled'\n  }\n]\n\n@description('Enable delete lock')\nparam enableDeleteLock bool = false\n\n@description('Enable diagnostic logs')\nparam enableDiagnostics bool = false\n\n@description('Storage account resource id. Only required if enableDiagnostics is set to true.')\nparam diagnosticStorageAccountId string = ''\n\n@description('Log analytics workspace resource id. Only required if enableDiagnostics is set to true.')\nparam logAnalyticsWorkspaceId string = ''\n\nvar lockName = '${vnet.name}-lck'\nvar diagnosticsName = '${vnet.name}-dgs'\n\nresource vnet 'Microsoft.Network/virtualNetworks@2021-02-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: vnetAddressSpace\n    }\n    dhcpOptions: empty(dnsServers) ? null : {\n      dnsServers: dnsServers\n    }\n    subnets: [for subnet in subnets: {\n      name: subnet.name\n      properties: {\n        addressPrefix: subnet.addressPrefix\n        delegations: contains(subnet, 'delegation') ? [\n          {\n            name: '${subnet.name}-delegation'\n            properties: {\n              serviceName: subnet.delegation\n            }\n          }\n        ] : []\n        natGateway: contains(subnet, 'natGatewayId') ? {\n          id: subnet.natGatewayId\n        } : null\n        networkSecurityGroup: contains(subnet, 'nsgId') ? {\n          id: subnet.nsgId\n        } : null\n        routeTable: contains(subnet, 'udrId') ? {\n          id: subnet.udrId\n        } : null\n        privateEndpointNetworkPolicies: subnet.privateEndpointNetworkPolicies\n        privateLinkServiceNetworkPolicies: subnet.privateLinkServiceNetworkPolicies\n        serviceEndpoints: contains(subnet, 'serviceEndpoints') ? subnet.serviceEndpoints : null\n      }\n    }]\n  }\n}\n\nresource diagnostics 'microsoft.insights/diagnosticSettings@2021-05-01-preview' = if (enableDiagnostics) {\n  scope: vnet\n  name: diagnosticsName\n  properties: {\n    workspaceId: empty(logAnalyticsWorkspaceId) ? null : logAnalyticsWorkspaceId\n    storageAccountId: empty(diagnosticStorageAccountId) ? null : diagnosticStorageAccountId\n    logs: [\n      {\n        category: 'VMProtectionAlerts'\n        enabled: true\n      }\n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n      }\n    ]\n  }\n}\n\nresource lock 'Microsoft.Authorization/locks@2017-04-01' = if (enableDeleteLock) {\n  scope: vnet\n  name: lockName\n  properties: {\n    level: 'CanNotDelete'\n  }\n}\n\noutput name string = vnet.name\noutput id string = vnet.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1249?"}, {"role": "assistant", "content": "@description('The shared key used to establish connection between the two vNet Gateways.')\n@secure()\nparam sharedKey string\n\n@description('The SKU for the VPN Gateway. Cannot be Basic SKU.')\n@allowed([\n  'Standard'\n  'HighPerformance'\n  'VpnGw1'\n  'VpnGw2'\n  'VpnGw3'\n])\nparam gatewaySku string = 'VpnGw1'\n\n@description('Location of the resources')\nparam location string = resourceGroup().location\n\nvar vnet1cfg = {\n  name: 'vNet1-${location}'\n  addressSpacePrefix: '10.0.0.0/23'\n  subnetName: 'subnet1'\n  subnetPrefix: '10.0.0.0/24'\n  gatewayName: 'vNet1-Gateway'\n  gatewaySubnetPrefix: '10.0.1.224/27'\n  gatewayPublicIPName: 'gw1pip${uniqueString(resourceGroup().id)}'\n  connectionName: 'vNet1-to-vNet2'\n  asn: 65010\n}\nvar vnet2cfg = {\n  name: 'vnet2-${location}'\n  addressSpacePrefix: '10.0.2.0/23'\n  subnetName: 'subnet1'\n  subnetPrefix: '10.0.2.0/24'\n  gatewayName: 'vnet2-Gateway'\n  gatewaySubnetPrefix: '10.0.3.224/27'\n  gatewayPublicIPName: 'gw2pip${uniqueString(resourceGroup().id)}'\n  connectionName: 'vnet2-to-vnet1'\n  asn: 65050\n}\n\nresource vnet1 'Microsoft.Network/virtualNetworks@2020-06-01' = {\n  name: vnet1cfg.name\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnet1cfg.addressSpacePrefix\n      ]\n    }\n    subnets: [\n      {\n        name: vnet1cfg.subnetName\n        properties: {\n          addressPrefix: vnet1cfg.subnetPrefix\n        }\n      }\n      {\n        name: 'GatewaySubnet'\n        properties: {\n          addressPrefix: vnet1cfg.gatewaySubnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource vnet2 'Microsoft.Network/virtualNetworks@2020-06-01' = {\n  name: vnet2cfg.name\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnet2cfg.addressSpacePrefix\n      ]\n    }\n    subnets: [\n      {\n        name: vnet2cfg.subnetName\n        properties: {\n          addressPrefix: vnet2cfg.subnetPrefix\n        }\n      }\n      {\n        name: 'GatewaySubnet'\n        properties: {\n          addressPrefix: vnet2cfg.gatewaySubnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource gw1pip 'Microsoft.Network/publicIPAddresses@2020-06-01' = {\n  name: vnet1cfg.gatewayPublicIPName\n  location: location\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n\nresource gw2pip 'Microsoft.Network/publicIPAddresses@2020-06-01' = {\n  name: vnet2cfg.gatewayPublicIPName\n  location: location\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n\nresource vnet1Gateway 'Microsoft.Network/virtualNetworkGateways@2020-06-01' = {\n  name: vnet1cfg.gatewayName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'vnet1GatewayConfig'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets',vnet1.name , 'GatewaySubnet')\n          }\n          publicIPAddress: {\n            id: gw1pip.id\n          }\n        }\n      }\n    ]\n    gatewayType: 'Vpn'\n    sku: {\n      name: gatewaySku\n      tier: gatewaySku\n    }\n    vpnType: 'RouteBased'\n    enableBgp: true\n    bgpSettings: {\n      asn: vnet1cfg.asn\n    }\n  }\n}\n\nresource vnet2Gateway 'Microsoft.Network/virtualNetworkGateways@2020-05-01' = {\n  name: vnet2cfg.gatewayName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'vNet2GatewayConfig'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: {\n            id: resourceId('Microsoft.Network/virtualNetworks/subnets',vnet2.name , 'GatewaySubnet')\n          }\n          publicIPAddress: {\n            id: gw2pip.id\n          }\n        }\n      }\n    ]\n    gatewayType: 'Vpn'\n    sku: {\n      name: gatewaySku\n      tier: gatewaySku\n    }\n    vpnType: 'RouteBased'\n    enableBgp: true\n    bgpSettings: {\n      asn: vnet2cfg.asn\n    }\n  }\n}\n\nresource vpn1to2Connection 'Microsoft.Network/connections@2020-05-01' = {\n  name: vnet1cfg.connectionName\n  location: location\n  properties: {\n    virtualNetworkGateway1: {\n      id: vnet1Gateway.id\n      properties: {}\n    }\n    virtualNetworkGateway2: {\n      id: vnet2Gateway.id\n      properties: {}\n    }\n    connectionType: 'Vnet2Vnet'\n    routingWeight: 3\n    sharedKey: sharedKey\n    enableBgp: true\n  }\n}\n\nresource vpn2to1Connection 'Microsoft.Network/connections@2020-05-01' = {\n  name: vnet2cfg.connectionName\n  location: location\n  properties: {\n    virtualNetworkGateway1: {\n      id: vnet2Gateway.id\n      properties: {}\n    }\n    virtualNetworkGateway2: {\n      id: vnet1Gateway.id\n      properties: {}\n    }\n    connectionType: 'Vnet2Vnet'\n    routingWeight: 3\n    sharedKey: sharedKey\n    enableBgp: true\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1250."}, {"role": "assistant", "content": "@description('Location of the resources')\nparam location string = resourceGroup().location\n\n@description('Name for vNet 1')\nparam vnet1Name string = 'vNet1'\n\n@description('Name for vNet 2')\nparam vnet2Name string = 'vNet2'\n\nvar vnet1Config = {\n  addressSpacePrefix: '10.0.0.0/24'\n  subnetName: 'subnet1'\n  subnetPrefix: '10.0.0.0/24'\n}\nvar vnet2Config = {\n  addressSpacePrefix: '192.168.0.0/24'\n  subnetName: 'subnet1'\n  subnetPrefix: '192.168.0.0/24'\n}\n\nresource vnet1 'Microsoft.Network/virtualNetworks@2020-05-01' = {\n  name: vnet1Name\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnet1Config.addressSpacePrefix\n      ]\n    }\n    subnets: [\n      {\n        name: vnet1Config.subnetName\n        properties: {\n          addressPrefix: vnet1Config.subnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource VnetPeering1 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2020-05-01' = {\n  parent: vnet1\n  name: '${vnet1Name}-${vnet2Name}'\n  properties: {\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: false\n    allowGatewayTransit: false\n    useRemoteGateways: false\n    remoteVirtualNetwork: {\n      id: vnet2.id\n    }\n  }\n}\n\nresource vnet2 'Microsoft.Network/virtualNetworks@2020-05-01' = {\n  name: vnet2Name\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnet2Config.addressSpacePrefix\n      ]\n    }\n    subnets: [\n      {\n        name: vnet2Config.subnetName\n        properties: {\n          addressPrefix: vnet2Config.subnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource vnetPeering2 'Microsoft.Network/virtualNetworks/virtualNetworkPeerings@2020-05-01' = {\n  parent: vnet2\n  name: '${vnet2Name}-${vnet1Name}'\n  properties: {\n    allowVirtualNetworkAccess: true\n    allowForwardedTraffic: false\n    allowGatewayTransit: false\n    useRemoteGateways: false\n    remoteVirtualNetwork: {\n      id: vnet1.id\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1251?"}, {"role": "assistant", "content": "@description('VNet name')\nparam vnetName string = 'VNet1'\n\n@description('Address prefix')\nparam vnetAddressPrefix string = '10.0.0.0/16'\n\n@description('Subnet 1 Prefix')\nparam subnet1Prefix string = '10.0.0.0/24'\n\n@description('Subnet 1 Name')\nparam subnet1Name string = 'Subnet1'\n\n@description('Subnet 2 Prefix')\nparam subnet2Prefix string = '10.0.1.0/24'\n\n@description('Subnet 2 Name')\nparam subnet2Name string = 'Subnet2'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nresource vnet 'Microsoft.Network/virtualNetworks@2021-08-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnet1Name\n        properties: {\n          addressPrefix: subnet1Prefix\n        }\n      }\n      {\n        name: subnet2Name\n        properties: {\n          addressPrefix: subnet2Prefix\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1252."}, {"role": "assistant", "content": "@description('The name of the Notification Hubs namespace.')\nparam namespaceName string\n\n@description('The location in which the Notification Hubs resources should be deployed.')\nparam location string = resourceGroup().location\n\nvar hubName = 'MyHub'\n\nresource namespace 'Microsoft.NotificationHubs/namespaces@2017-04-01' = {\n  name: namespaceName\n  location: location\n  sku: {\n    name: 'Free'\n  }\n}\n\nresource notificationHub 'Microsoft.NotificationHubs/namespaces/notificationHubs@2017-04-01' = {\n  name: hubName\n  location: location\n  parent: namespace\n  properties: {\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1253."}, {"role": "assistant", "content": "param location string = resourceGroup().location\nparam sentinelName string = 'sentinel'\n\n@minValue(30)\n@maxValue(730)\nparam retentionInDays int = 90\n\nvar workspaceName = '${location}-${sentinelName}-${uniqueString(resourceGroup().id)}'\nvar solutionName = 'SecurityInsights(${sentinelWorkspace.name})'\n\nresource sentinelWorkspace 'Microsoft.OperationalInsights/workspaces@2020-08-01' = {\n  name: workspaceName\n  location: location\n  properties: {\n    sku: {\n      name: 'PerGB2018'\n    }\n    retentionInDays: retentionInDays\n  }\n}\n\nresource sentinelSolution 'Microsoft.OperationsManagement/solutions@2015-11-01-preview' = {\n  name: solutionName\n  location: location\n  properties: {\n    workspaceResourceId: sentinelWorkspace.id\n  }\n  plan: {\n    name: solutionName\n    publisher: 'Microsoft'\n    product: 'OMSGallery/SecurityInsights'\n    promotionCode: ''\n  }\n}\n\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1254?"}, {"role": "assistant", "content": "@description('Name of the existing virtual machine to show in the dashboard')\nparam virtualMachineName string\n\n@description('Name of the resource group that contains the virtual machine')\nparam virtualMachineResourceGroup string\n\n@metadata({ Description: 'Resource name that Azure portal uses for the dashboard' })\nparam dashboardName string = guid(virtualMachineName, virtualMachineResourceGroup)\n\n@description('Name of the dashboard to display in Azure portal')\nparam dashboardDisplayName string = 'Simple VM Dashboard'\nparam location string = resourceGroup().location\n\nresource dashboard 'Microsoft.Portal/dashboards@2020-09-01-preview' = {\n  name: dashboardName\n  location: location\n  tags: {\n    'hidden-title': dashboardDisplayName\n  }\n  properties: {\n    lenses: [\n      {\n        order: 0\n        parts: [\n          {\n            position: {\n              x: 0\n              y: 0\n              rowSpan: 2\n              colSpan: 3\n            }\n            metadata: {\n              inputs: []\n              type: 'Extension/HubsExtension/PartType/MarkdownPart'\n              settings: {\n                content: {\n                  settings: {\n                    content: '## Azure Virtual Machines Overview\\r\\nNew team members should watch this video to get familiar with Azure Virtual Machines.'\n                  }\n                }\n              }\n            }\n          }\n          {\n            position: {\n              x: 3\n              y: 0\n              rowSpan: 4\n              colSpan: 8\n            }\n            metadata: {\n              inputs: []\n              type: 'Extension/HubsExtension/PartType/MarkdownPart'\n              settings: {\n                content: {\n                  settings: {\n                    content: 'This is the team dashboard for the test VM we use on our team. Here are some useful links:\\r\\n\\r\\n1. [Create a Linux virtual machine](https://docs.microsoft.com/azure/virtual-machines/linux/quick-create-portal)\\r\\n1. [Create a Windows virtual machine](https://docs.microsoft.com/azure/virtual-machines/windows/quick-create-portal)\\r\\n1. [Create a virtual machine scale set](https://docs.microsoft.com/azure/virtual-machine-scale-sets/quick-create-portal)'\n                    title: 'Test VM Dashboard'\n                    subtitle: 'Contoso'\n                  }\n                }\n              }\n            }\n          }\n          {\n            position: {\n              x: 0\n              y: 2\n              rowSpan: 2\n              colSpan: 3\n            }\n            metadata: {\n              inputs: []\n              type: 'Extension/HubsExtension/PartType/VideoPart'\n              settings: {\n                content: {\n                  settings: {\n                    src: 'https://www.youtube.com/watch?v=rOiSRkxtTeU'\n                    autoplay: false\n                  }\n                }\n              }\n            }\n          }\n          {\n            position: {\n              x: 0\n              y: 4\n              rowSpan: 3\n              colSpan: 11\n            }\n            metadata: {\n              inputs: [\n                {\n                  name: 'queryInputs'\n                  value: {\n                    timespan: {\n                      duration: 'PT1H'\n                    }\n                    id: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                    chartType: 0\n                    metrics: [\n                      {\n                        name: 'Percentage CPU'\n                        resourceId: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                      }\n                    ]\n                  }\n                }\n              ]\n              type: 'Extension/Microsoft_Azure_Monitoring/PartType/MetricsChartPart'\n            }\n          }\n          {\n            position: {\n              x: 0\n              y: 7\n              rowSpan: 2\n              colSpan: 3\n            }\n            metadata: {\n              inputs: [\n                {\n                  name: 'queryInputs'\n                  value: {\n                    timespan: {\n                      duration: 'PT1H'\n                    }\n                    id: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                    chartType: 0\n                    metrics: [\n                      {\n                        name: 'Disk Read Operations/Sec'\n                        resourceId: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                      }\n                      {\n                        name: 'Disk Write Operations/Sec'\n                        resourceId: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                      }\n                    ]\n                  }\n                }\n              ]\n              type: 'Extension/Microsoft_Azure_Monitoring/PartType/MetricsChartPart'\n            }\n          }\n          {\n            position: {\n              x: 3\n              y: 7\n              rowSpan: 2\n              colSpan: 3\n            }\n            metadata: {\n              inputs: [\n                {\n                  name: 'queryInputs'\n                  value: {\n                    timespan: {\n                      duration: 'PT1H'\n                    }\n                    id: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                    chartType: 0\n                    metrics: [\n                      {\n                        name: 'Disk Read Bytes'\n                        resourceId: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                      }\n                      {\n                        name: 'Disk Write Bytes'\n                        resourceId: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                      }\n                    ]\n                  }\n                }\n              ]\n              type: 'Extension/Microsoft_Azure_Monitoring/PartType/MetricsChartPart'\n            }\n          }\n          {\n            position: {\n              x: 6\n              y: 7\n              rowSpan: 2\n              colSpan: 3\n            }\n            metadata: {\n              inputs: [\n                {\n                  name: 'queryInputs'\n                  value: {\n                    timespan: {\n                      duration: 'PT1H'\n                    }\n                    id: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                    chartType: 0\n                    metrics: [\n                      {\n                        name: 'Network In Total'\n                        resourceId: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                      }\n                      {\n                        name: 'Network Out Total'\n                        resourceId: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                      }\n                    ]\n                  }\n                }\n              ]\n              type: 'Extension/Microsoft_Azure_Monitoring/PartType/MetricsChartPart'\n            }\n          }\n          {\n            position: {\n              x: 9\n              y: 7\n              rowSpan: 2\n              colSpan: 2\n            }\n            metadata: {\n              inputs: [\n                {\n                  name: 'id'\n                  value: resourceId(virtualMachineResourceGroup, 'Microsoft.Compute/virtualMachines', virtualMachineName)\n                }\n              ]\n              type: 'Extension/Microsoft_Azure_Compute/PartType/VirtualMachinePart'\n              asset: {\n                idInputName: 'id'\n                type: 'VirtualMachine'\n              }\n            }\n          }\n        ]\n      }\n    ]\n  }\n}\noutput location string = location\noutput name string = dashboard.name\noutput resourceGroupName string = resourceGroup().name\noutput resourceId string = dashboard.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1255."}, {"role": "assistant", "content": "@description('Username for the Virtual Machine.')\nparam adminUsername string\n\n@description('Password for the Virtual Machine.')\n@secure()\nparam adminPassword string\n\n@description('Unique DNS Name for the Public IP used to access the Virtual Machine.')\nparam dnsLabelPrefix string\n\n@description('The Windows version for the VM. This will pick a fully patched image of this given Windows version.')\n@allowed([\n  '2008-R2-SP1'\n  '2012-Datacenter'\n  '2012-R2-Datacenter'\n  '2016-Nano-Server'\n  '2016-Datacenter-with-Containers'\n  '2016-Datacenter'\n  '2019-Datacenter'\n])\nparam windowsOSVersion string = '2016-Datacenter'\n\n@description('Size of the virtual machine.')\nparam vmSize string = 'Standard_D2_v3'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar storageAccountName = '${uniqueString(resourceGroup().id)}sawinvm'\nvar nicName = 'myVMNic'\nvar addressPrefix = '10.0.0.0/16'\nvar subnetName = 'Subnet'\nvar subnetPrefix = '10.0.0.0/24'\nvar publicIPAddressName = 'myPublicIP'\nvar vmName = 'SimpleWinVM'\nvar virtualNetworkName = 'MyVNET'\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\nvar networkSecurityGroupName = 'default-NSG'\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-09-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'Storage'\n  properties: {\n  }\n}\n\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2022-01-01' = {\n  name: publicIPAddressName\n  location: location\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n    dnsSettings: {\n      domainNameLabel: dnsLabelPrefix\n    }\n  }\n}\n\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2022-01-01' = {\n  name: networkSecurityGroupName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'default-allow-3389'\n        properties: {\n          priority: 1000\n          access: 'Allow'\n          direction: 'Inbound'\n          destinationPortRange: '3389'\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n        }\n      }\n    ]\n  }\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-01-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        addressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: subnetPrefix\n          networkSecurityGroup: {\n            id: networkSecurityGroup.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource nic 'Microsoft.Network/networkInterfaces@2022-01-01' = {\n  name: nicName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: publicIPAddress.id\n          }\n          subnet: {\n            id: subnetRef\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    virtualNetwork\n  ]\n}\n\nresource vm 'Microsoft.Compute/virtualMachines@2022-03-01' = {\n  name: vmName\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: vmName\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: windowsOSVersion\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n      }\n      dataDisks: [\n        {\n          diskSizeGB: 1023\n          lun: 0\n          createOption: 'Empty'\n        }\n      ]\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: nic.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: storageAccount.properties.primaryEndpoints.blob\n      }\n    }\n  }\n}\n\noutput resourcegroup string = resourceGroup().name\noutput virtualmachine string = vmName\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1256."}, {"role": "assistant", "content": "@description('Name of the Existing Recovery Services Vault (Vault and VM to be protected must be in same GEO)')\nparam existingRecoveryServicesVaultName string\n\n@description('Array of iaasvm protection containers. This will take different input for classic and ARM vms. e.g. iaasvmcontainer;iaasvmcontainerv2;my-resource-group;my-arm-vm for ARM vm and iaasvmcontainer;iaasvmcontainer;my-classic-vm;my-classic-vm for classic vm')\nparam existingProtectionContainers array\n\n@description('Array of iaasvm protectable items. This will take different input for classic and ARM vms. e.g. vm;iaasvmcontainerv2;my-resource-group;my-arm-vm for ARM vm and vm;iaasvmcontainer;my-classic-vm;my-classic-vm for classic vm')\nparam existingProtectableItems array\n\n@description('Array of resourceid of iaasvm protectable items. Provide resourceids of each VMs for which you want to configure protection. e.g. /subscriptions/subscriptionid/resourceGroups/resourceGroupName/providers/Microsoft.Compute/virtualMachines/vmName')\nparam existingSourceResourceIds array\n\n@description('Name of existing Backup Policy in same Recovery Services Vault.')\nparam existingBackupPolicyName string\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar backupFabric = 'Azure'\nvar protectedItemType = 'Microsoft.ClassicCompute/virtualMachines'\n\nresource protectedItems 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems@2016-06-01' = [for (item, i) in existingProtectableItems: {\n  name: '${existingRecoveryServicesVaultName}/${backupFabric}/${existingProtectionContainers[i]}/${item}'\n  location: location\n  properties: {\n    protectedItemType: protectedItemType\n    policyId: resourceId('Microsoft.RecoveryServices/vaults/backupPolicies', existingRecoveryServicesVaultName, existingBackupPolicyName)\n    sourceResourceId: existingSourceResourceIds[i]\n  }\n}]\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1257."}, {"role": "assistant", "content": "@description('Name of the existing Resource Group in which the existing Storage Account is present.')\nparam existingResourceGroupName string = resourceGroup().name\n\n@description('Name of the existing Storage Account in which the existing File Share to be protected is present.')\nparam existingStorageAccountName string\n\n@description('Name of the existing File Share to be protected.')\nparam existingFileShareName string\n\n@description('Location of the existing Storage Account containing the existing File Share to be protected. New Recovery Services Vault will be created in this location. (Ignore if using existing Recovery Services Vault).')\nparam location string = resourceGroup().location\n\n@description('Set to true if a new Recovery Services Vault is to be created; set to false otherwise.')\nparam isNewVault bool = true\n\n@description('Set to true if a new Backup Policy is to be created for the Recovery Services Vault; set to false otherwise.')\nparam isNewPolicy bool = true\n\n@description('Set to true if the existing Storage Account has to be registered to the Recovery Services Vault; set to false otherwise.')\nparam registerStorageAccount bool = true\n\n@description('Name of the Recovery Services Vault. (Should have the same location as the Storage Account containing the File Share to be protected in case of an existing Recovery Services Vault).')\nparam vaultName string = 'RSVault1'\n\n@description('Name of the Backup Policy.')\nparam policyName string = 'DailyBackupPolicy1'\n\n@description('Time of day when backup should be triggered in 24 hour HH:MM format, where MM must be 00 or 30. (Ignore if using existing Backup Policy).')\nparam scheduleRunTime string = '05:30'\n\n@description('Any valid timezone, for example: UTC, Pacific Standard Time. Refer: https://msdn.microsoft.com/en-us/library/gg154758.aspx (Ignore if using existing Backup Policy).')\nparam timeZone string = 'UTC'\n\n@description('Number of days for which the daily backup is to be retained. (Ignore if using existing Backup Policy).')\nparam dailyRetentionDurationCount int = 30\n\n@description('Array of days on which backup is to be performed for Weekly Retention. (Ignore if using existing Backup Policy).')\nparam daysOfTheWeek array = [\n  'Sunday'\n  'Tuesday'\n  'Thursday'\n]\n\n@description('Number of weeks for which the weekly backup is to be retained. (Ignore if using existing Backup Policy).')\nparam weeklyRetentionDurationCount int = 12\n\n@description('Number of months for which the monthly backup is to be retained. Backup will be performed on the 1st day of every month. (Ignore if using existing Backup Policy).')\nparam monthlyRetentionDurationCount int = 60\n\n@description('Array of months on which backup is to be performed for Yearly Retention. Backup will be performed on the 1st day of each month of year provided. (Ignore if using existing Backup Policy).')\nparam monthsOfYear array = [\n  'January'\n  'May'\n  'September'\n]\n\n@description('Number of years for which the yearly backup is to be retained. (Ignore if using existing Backup Policy).')\nparam yearlyRetentionDurationCount int = 10\n\nvar backupFabric = 'Azure'\nvar backupManagementType = 'AzureStorage'\nvar scheduleRunTimes = [\n  '2020-01-01T${scheduleRunTime}:00Z'\n]\n\nresource vault 'Microsoft.RecoveryServices/vaults@2021-12-01' = if (isNewVault) {\n  name: vaultName\n  location: location\n  sku: {\n    name: 'RS0'\n    tier: 'Standard'\n  }\n  properties: {}\n}\n\nresource backupPolicy 'Microsoft.RecoveryServices/vaults/backupPolicies@2021-12-01' = if (isNewPolicy) {\n  parent: vault\n  name: policyName\n  properties: {\n    backupManagementType: backupManagementType\n    schedulePolicy: {\n      scheduleRunFrequency: 'Daily'\n      scheduleRunTimes: scheduleRunTimes\n      schedulePolicyType: 'SimpleSchedulePolicy'\n    }\n    retentionPolicy: {\n      dailySchedule: {\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: dailyRetentionDurationCount\n          durationType: 'Days'\n        }\n      }\n      weeklySchedule: {\n        daysOfTheWeek: daysOfTheWeek\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: weeklyRetentionDurationCount\n          durationType: 'Weeks'\n        }\n      }\n      monthlySchedule: {\n        retentionScheduleFormatType: 'Daily'\n        retentionScheduleDaily: {\n          daysOfTheMonth: [\n            {\n              date: 1\n              isLast: false\n            }\n          ]\n        }\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: monthlyRetentionDurationCount\n          durationType: 'Months'\n        }\n      }\n      yearlySchedule: {\n        retentionScheduleFormatType: 'Daily'\n        monthsOfYear: monthsOfYear\n        retentionScheduleDaily: {\n          daysOfTheMonth: [\n            {\n              date: 1\n              isLast: false\n            }\n          ]\n        }\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: yearlyRetentionDurationCount\n          durationType: 'Years'\n        }\n      }\n      retentionPolicyType: 'LongTermRetentionPolicy'\n    }\n    timeZone: timeZone\n    workLoadType: 'AzureFileShare'\n  }\n}\n\nresource protectionContainer 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers@2021-12-01' = if (registerStorageAccount) {\n  name: '${vaultName}/${backupFabric}/storagecontainer;Storage;${existingResourceGroupName};${existingStorageAccountName}'\n  properties: {\n    backupManagementType: backupManagementType\n    containerType: 'StorageContainer'\n    sourceResourceId: resourceId(existingResourceGroupName, 'Microsoft.Storage/storageAccounts', existingStorageAccountName)\n  }\n  dependsOn: [\n    vault\n  ]\n}\n\nresource protectedItem 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems@2021-12-01' = {\n  parent: protectionContainer\n  name: 'AzureFileShare;${existingFileShareName}'\n  properties: {\n    protectedItemType: 'AzureFileShareProtectedItem'\n    sourceResourceId: resourceId(existingResourceGroupName, 'Microsoft.Storage/storageAccounts', existingStorageAccountName)\n    policyId: backupPolicy.id\n    isInlineInquiry: true\n  }\n  dependsOn: [\n    vault\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1258 please."}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Storage account.')\nparam storageAccountName string = 'storage${uniqueString(resourceGroup().id)}'\n\n@description('Specifies the name of the File Share. File share names must be between 3 and 63 characters in length and use numbers, lower-case letters and dash (-) only.')\n@minLength(3)\n@maxLength(63)\nparam fileShareName string\n\n@description('Specifies the location in which the Azure Storage resources should be deployed.')\nparam location string = resourceGroup().location\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-08-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    accessTier: 'Hot'\n  }\n}\n\nresource fileShare 'Microsoft.Storage/storageAccounts/fileServices/shares@2021-08-01' = {\n  name: '${storageAccountName}/default/${fileShareName}'\n  dependsOn: [\n    storageAccount\n  ]\n}\n\noutput resourceGroupName string = resourceGroup().name\noutput storageAccountName string = storageAccountName\noutput fileShareName string = fileShareName\noutput storageAccountLocation string = location\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1259?"}, {"role": "assistant", "content": "@description('Name of the existing Resource Group in which the existing Storage Account is present.')\nparam existingResourceGroupName string = resourceGroup().name\n\n@description('Name of the existing Storage Account in which the existing File Share to be protected is present.')\nparam existingStorageAccountName string\n\n@description('Name of the existing File Share to be protected.')\nparam existingFileShareName string\n\n@description('Location of the existing Storage Account containing the existing File Share to be protected. New Recovery Services Vault will be created in this location. (Ignore if using existing Recovery Services Vault).')\nparam location string = resourceGroup().location\n\n@description('Set to true if a new Recovery Services Vault is to be created; set to false otherwise.')\nparam isNewVault bool = true\n\n@description('Set to true if a new Backup Policy is to be created for the Recovery Services Vault; set to false otherwise.')\nparam isNewPolicy bool = true\n\n@description('Set to true if the existing Storage Account has to be registered to the Recovery Services Vault; set to false otherwise.')\nparam registerStorageAccount bool = true\n\n@description('Name of the Recovery Services Vault. (Should have the same location as the Storage Account containing the File Share to be protected in case of an existing Recovery Services Vault).')\nparam vaultName string = 'RSVault-${substring(uniqueString(resourceGroup().id), 6)}'\n\n@description('Name of the Backup Policy.')\nparam policyName string = 'HourlyBackupPolicy'\n\n@description('Time of day when backup should be triggered in 24 hour HH:MM format, where MM must be 00 or 30. (Ignore if using existing Backup Policy).')\nparam scheduleRunTime string = '05:30'\n\n@description('Any valid timezone, for example: UTC, Pacific Standard Time. Refer: https://msdn.microsoft.com/en-us/library/gg154758.aspx (Ignore if using existing Backup Policy).')\nparam timeZone string = 'UTC'\n\n@description('Number of days for which the daily backup is to be retained. (Ignore if using existing Backup Policy).')\nparam dailyRetentionDurationCount int = 5\n\n@description('Array of days on which backup is to be performed for Weekly Retention. (Ignore if using existing Backup Policy).')\nparam daysOfTheWeek array = [\n  'Sunday'\n  'Tuesday'\n  'Thursday'\n]\n\n@description('Number of weeks for which the weekly backup is to be retained. (Ignore if using existing Backup Policy).')\nparam weeklyRetentionDurationCount int = 12\n\n@description('Number of months for which the monthly backup is to be retained. Backup will be performed on the 1st day of every month. (Ignore if using existing Backup Policy).')\nparam monthlyRetentionDurationCount int = 60\n\n@description('Array of months on which backup is to be performed for Yearly Retention. Backup will be performed on the 1st day of each month of year provided. (Ignore if using existing Backup Policy).')\nparam monthsOfYear array = [\n  'January'\n  'May'\n  'September'\n]\n\n@description('Number of years for which the yearly backup is to be retained. (Ignore if using existing Backup Policy).')\nparam yearlyRetentionDurationCount int = 10\n\n@description('Hourly Schedule window start time')\nparam scheduleWindowStartTime string = '${substring(utcNow('2020-01-01T{0}:00Z'), 0, 11)}08:00:00.000Z'\n\n@description('Hourly backup frequency (Ignore if using existing Backup Policy).')\nparam backupFrequency int = 4\n\nvar backupFabric = 'Azure'\nvar backupManagementType = 'AzureStorage'\nvar scheduleRunTimes = [\n  '2020-01-01T${scheduleRunTime}:00Z'\n]\n\nresource vault 'Microsoft.RecoveryServices/vaults@2021-12-01' = if (isNewVault) {\n  name: vaultName\n  location: location\n  sku: {\n    name: 'RS0'\n    tier: 'Standard'\n  }\n  properties: {\n  }\n}\n\nresource backupPolicy 'Microsoft.RecoveryServices/vaults/backupPolicies@2022-02-01' = if (isNewPolicy) {\n  parent: vault\n  name: policyName\n  properties: {\n    backupManagementType: backupManagementType\n    schedulePolicy: {\n      schedulePolicyType: 'SimpleSchedulePolicy'\n      scheduleRunFrequency: 'Hourly'\n      scheduleRunTimes: scheduleRunTimes\n      hourlySchedule: {\n        interval: backupFrequency\n        scheduleWindowStartTime: scheduleWindowStartTime\n        scheduleWindowDuration: 12\n      }\n    }\n    retentionPolicy: {\n      dailySchedule: {\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: dailyRetentionDurationCount\n          durationType: 'Days'\n        }\n      }\n      weeklySchedule: {\n        daysOfTheWeek: daysOfTheWeek\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: weeklyRetentionDurationCount\n          durationType: 'Weeks'\n        }\n      }\n      monthlySchedule: {\n        retentionScheduleFormatType: 'Daily'\n        retentionScheduleDaily: {\n          daysOfTheMonth: [\n            {\n              date: 1\n              isLast: false\n            }\n          ]\n        }\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: monthlyRetentionDurationCount\n          durationType: 'Months'\n        }\n      }\n      yearlySchedule: {\n        retentionScheduleFormatType: 'Daily'\n        monthsOfYear: monthsOfYear\n        retentionScheduleDaily: {\n          daysOfTheMonth: [\n            {\n              date: 1\n              isLast: false\n            }\n          ]\n        }\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: yearlyRetentionDurationCount\n          durationType: 'Years'\n        }\n      }\n      retentionPolicyType: 'LongTermRetentionPolicy'\n    }\n    timeZone: timeZone\n    workLoadType: 'AzureFileShare'\n  }\n}\n\nresource protectionContainer 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers@2021-12-01' = if (registerStorageAccount) {\n  name: '${vaultName}/${backupFabric}/storagecontainer;Storage;${existingResourceGroupName};${existingStorageAccountName}'\n  dependsOn: [\n    vault\n    backupPolicy\n  ]\n  properties: {\n    backupManagementType: backupManagementType\n    containerType: 'StorageContainer'\n    sourceResourceId: resourceId(existingResourceGroupName, 'Microsoft.Storage/storageAccounts', existingStorageAccountName)\n  }\n}\n\nresource protectedItem 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems@2021-12-01'={\n  name:'${split('${vaultName}/${backupFabric}/storagecontainer;Storage;${existingResourceGroupName};${existingStorageAccountName}', '/')[0]}/${split('${vaultName}/${backupFabric}/storagecontainer;Storage;${existingResourceGroupName};${existingStorageAccountName}', '/')[1]}/${split('${vaultName}/${backupFabric}/storagecontainer;Storage;${existingResourceGroupName};${existingStorageAccountName}', '/')[2]}/AzureFileShare;${existingFileShareName}'\n  dependsOn:[\n    vault\n  ]\n  properties:{\n    protectedItemType:'AzureFileShareProtectedItem'\n    sourceResourceId:resourceId(existingResourceGroupName, 'Microsoft.Storage/storageAccounts', existingStorageAccountName)\n    policyId:backupPolicy.id\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1260."}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Storage account.')\nparam storageAccountName string = 'storage${uniqueString(resourceGroup().id)}'\n\n@description('Specifies the name of the File Share. File share names must be between 3 and 63 characters in length and use numbers, lower-case letters and dash (-) only.')\n@minLength(3)\n@maxLength(63)\nparam fileShareName string\n\n@description('Specifies the location in which the Azure Storage resources should be deployed.')\nparam location string = resourceGroup().location\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-08-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    accessTier: 'Hot'\n  }\n}\n\nresource fileShare 'Microsoft.Storage/storageAccounts/fileServices/shares@2021-08-01' = {\n  name: '${storageAccountName}/default/${fileShareName}'\n  dependsOn: [\n    storageAccount\n  ]\n}\n\noutput resourceGroupName string = resourceGroup().name\noutput storageAccountName string = storageAccountName\noutput fileShareName string = fileShareName\noutput storageAccountLocation string = location\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1261?"}, {"role": "assistant", "content": "@description('Resource group where the virtual machines are located. This can be different than resource group of the vault. ')\nparam existingVirtualMachinesResourceGroup string\n\n@description('Array of Azure virtual machines. e.g. [\"vm1\",\"vm2\",\"vm3\"]')\nparam existingVirtualMachines array\n\n@description('Name of the Recovery Services Vault')\nparam vaultName string = 'RecoveryServicesVault'\n\n@description('Conditional parameter for New or Existing Vault')\nparam isNewVault bool = false\n\n@description('Backup policy to be used to backup VMs. Backup POlicy defines the schedule of the backup and how long to retain backup copies. By default every vault comes with a \\'DefaultPolicy\\' which canbe used here.')\nparam policyName string = 'DefaultPolicy'\n\n@description('Conditional parameter for New or Existing Backup Policy')\nparam isNewPolicy bool = false\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar backupFabric = 'Azure'\nvar scheduleRunTimes = [\n  '2017-01-26T05:30:00Z'\n]\nvar v2VmType = 'Microsoft.Compute/virtualMachines'\nvar v2VmContainer = 'iaasvmcontainer;iaasvmcontainerv2;'\nvar v2Vm = 'vm;iaasvmcontainerv2;'\n\nresource recoveryServicesVault 'Microsoft.RecoveryServices/vaults@2021-03-01' = if (isNewVault) {\n  name: vaultName\n  location: location\n  sku: {\n    name: 'RS0'\n    tier: 'Standard'\n  }\n  properties: {}\n}\n\nresource backupPolicy 'Microsoft.RecoveryServices/vaults/backupPolicies@2021-03-01' = if (isNewPolicy) {\n  parent: recoveryServicesVault\n  name: policyName\n  location: location\n  properties: {\n    backupManagementType: 'AzureIaasVM'\n    instantRpRetentionRangeInDays: 5\n    schedulePolicy: {\n      scheduleRunFrequency: 'Daily'\n      scheduleRunTimes: scheduleRunTimes\n      schedulePolicyType: 'SimpleSchedulePolicy'\n    }\n    retentionPolicy: {\n      dailySchedule: {\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: 104\n          durationType: 'Days'\n        }\n      }\n      weeklySchedule: {\n        daysOfTheWeek: [\n          'Sunday'\n          'Tuesday'\n          'Thursday'\n        ]\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: 104\n          durationType: 'Weeks'\n        }\n      }\n      monthlySchedule: {\n        retentionScheduleFormatType: 'Daily'\n        retentionScheduleDaily: {\n          daysOfTheMonth: [\n            {\n              date: 1\n              isLast: false\n            }\n          ]\n        }\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: 60\n          durationType: 'Months'\n        }\n      }\n      yearlySchedule: {\n        retentionScheduleFormatType: 'Daily'\n        monthsOfYear: [\n          'January'\n          'March'\n          'August'\n        ]\n        retentionScheduleDaily: {\n          daysOfTheMonth: [\n            {\n              date: 1\n              isLast: false\n            }\n          ]\n        }\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: 10\n          durationType: 'Years'\n        }\n      }\n      retentionPolicyType: 'LongTermRetentionPolicy'\n    }\n    timeZone: 'UTC'\n  }\n}\n\nresource protectedItems 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems@2021-03-01' = [for item in existingVirtualMachines: {\n  name: '${vaultName}/${backupFabric}/${v2VmContainer}${existingVirtualMachinesResourceGroup};${item}/${v2Vm}${existingVirtualMachinesResourceGroup};${item}'\n  location: location\n  properties: {\n    protectedItemType: v2VmType\n    policyId: backupPolicy.id\n    sourceResourceId: resourceId(subscription().subscriptionId, existingVirtualMachinesResourceGroup, 'Microsoft.Compute/virtualMachines', item)\n  }\n  dependsOn: [\n    recoveryServicesVault\n  ]\n}]\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1262."}, {"role": "assistant", "content": "param numberOfInstances int\nparam virtualMachineName string\nparam adminUsername string\nparam virtualNetworkName string\nparam networkInterfaceName string\nparam networkSecurityGroupName string\nparam location string = resourceGroup().location\n\n@secure()\nparam adminPassword string\nparam addressPrefix string\nparam subnetName string\nparam subnetPrefix string\nparam publicIpAddressName string\nparam publicIpAddressType string\nparam publicIpAddressSku string\nparam virtualMachineSize string = 'Standard_B1s'\n\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2021-03-01' = [for i in range(0, numberOfInstances): {\n  name: '${virtualMachineName}${range(0, numberOfInstances)[i]}'\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: virtualMachineSize\n    }\n    osProfile: {\n      computerName: '${virtualMachineName}${range(0, numberOfInstances)[i]}'\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2012-R2-Datacenter'\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n      }\n      dataDisks: [\n        {\n          createOption: 'Empty'\n          lun: 0\n          diskSizeGB: 1023\n          caching: 'ReadOnly'\n          managedDisk: {\n            storageAccountType: 'Premium_LRS'\n          }\n        }\n      ]\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkInterface[i].id\n        }\n      ]\n    }\n  }\n}]\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-11-01' = [for i in range(0, length(range(0, numberOfInstances))): {\n  name: '${virtualNetworkName}${range(0, numberOfInstances)[i]}'\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        addressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: subnetPrefix\n        }\n      }\n    ]\n  }\n}]\n\nresource networkInterface 'Microsoft.Network/networkInterfaces@2020-11-01' = [for i in range(0, length(range(0, numberOfInstances))): {\n  name: '${networkInterfaceName}${range(0, numberOfInstances)[i]}'\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          subnet: {\n            id: virtualNetwork[i].properties.subnets[0].id\n          }\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: publicIpAddress[i].id\n          }\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: networkSecurityGroup[i].id\n    }\n  }\n}]\n\nresource publicIpAddress 'Microsoft.Network/publicIPAddresses@2020-11-01' = [for i in range(0, length(range(0, numberOfInstances))): {\n  name: '${publicIpAddressName}${range(0, numberOfInstances)[i]}'\n  sku: {\n    name: publicIpAddressSku\n  }\n  location: location\n  properties: {\n    publicIPAllocationMethod: publicIpAddressType\n  }\n}]\n\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2020-11-01' = [for i in range(0, length(range(0, numberOfInstances))): {\n  name: '${networkSecurityGroupName}${range(0, numberOfInstances)[i]}'\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'RDP'\n        properties: {\n          priority: 300\n          protocol: 'Tcp'\n          access: 'Allow'\n          direction: 'Inbound'\n          sourceAddressPrefix: '*'\n          sourcePortRange: '*'\n          destinationAddressPrefix: '*'\n          destinationPortRange: '3389'\n        }\n      }\n      {\n        name: 'default-allow-sql'\n        properties: {\n          priority: 1500\n          protocol: 'Tcp'\n          access: 'Allow'\n          direction: 'Inbound'\n          sourceAddressPrefix: '*'\n          sourcePortRange: '*'\n          destinationAddressPrefix: '*'\n          destinationPortRange: '1433'\n        }\n      }\n    ]\n  }\n}]\n\noutput adminUsername string = adminUsername\noutput resourceGroupName string = resourceGroup().name\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1263."}, {"role": "assistant", "content": "@description('Email addresses to which the notifications should be sent. Should be specified as an array of strings, for example, [\"user1@contoso.com\", \"user2@contoso.com\"].')\nparam emailAddress array\n\n@description('An action group is the channel to which a notification is sent, for example, email. Edit this field if you wish to use a custom name for the action group, otherwise, you can leave this unchanged. An action group name can have a length of 1-260 characters. You cannot use :,<,>,+,/,&,%,\\\\,? or control characters. The name cannot end with a space or period.')\nparam actionGroupName string = 'ActionGroup-${resourceGroup().name}'\n\n@description('Short name of the action group used for display purposes. Can be 1-12 characters in length.')\n@maxLength(12)\nparam actionGroupShortName string = 'ag-${((length(resourceGroup().name) >= 9) ? substring(resourceGroup().name, 0, 9) : resourceGroup().name)}'\n\n@description('An alert processing rule lets you associate alerts to action groups. Edit this field if you wish to use a custom name for the alert processing rule, otherwise, you can leave this unchanged. An alert processing rule name can have a length of 1-260 characters. You cannot use <,>,*,%,&,:,\\\\,?,+,/,#,@,{,}.')\nparam alertProcessingRuleName string = 'AlertProcessingRule-${resourceGroup().name}'\n\n@description('Description of the alert processing rule.')\nparam alertProcessingRuleDescription string = 'Sample alert processing rule'\n\n@description('The scope of resources for which the alert processing rule will apply. You can leave this field unchanged if you wish to apply the rule for all Recovery Services vault within the subscription. If you wish to apply the rule on smaller scopes, you can specify an array of ARM URLs representing the scopes, eg. [\\'/subscriptions/<sub-id>/resourceGroups/RG1\\', \\'/subscriptions/<sub-id>/resourceGroups/RG2\\']')\nparam alertProcessingRuleScope array = [\n  subscription().id\n]\n\nresource actionGroup 'Microsoft.Insights/actionGroups@2021-09-01' = {\n  name: actionGroupName\n  location: 'Global'\n  properties: {\n    emailReceivers: [for item in emailAddress: {\n      name: 'emailReceivers-${uniqueString(item)}'\n      emailAddress: item\n      useCommonAlertSchema: true\n    }]\n    groupShortName: actionGroupShortName\n    enabled: true\n  }\n}\n\nresource alertProcessingRule 'Microsoft.AlertsManagement/actionRules@2021-08-08' = {\n  name: alertProcessingRuleName\n  location: 'Global'\n  properties: {\n    scopes: alertProcessingRuleScope\n    conditions: [\n      {\n        field: 'TargetResourceType'\n        operator: 'Equals'\n        values: [\n          'microsoft.recoveryservices/vaults'\n        ]\n      }\n    ]\n    description: alertProcessingRuleDescription\n    enabled: true\n    actions: [\n      {\n        actionGroupIds: [\n          actionGroup.id\n        ]\n        actionType: 'AddActionGroups'\n      }\n    ]\n  }\n}\n\noutput actionGroupId string = actionGroup.id\noutput alertProcessingRuleId string = alertProcessingRule.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1264?"}, {"role": "assistant", "content": "@description('Name of the Vault')\nparam vaultName string\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Specify the workspace region')\nparam workspaceLocation string\n\nvar omsWorkspaceName = '${uniqueString(resourceGroup().id)}ws'\nvar storageAccountName = '${uniqueString(resourceGroup().id)}storage'\nvar storageAccountType = 'Standard_LRS'\n\nresource recoveryServicesVault 'Microsoft.RecoveryServices/vaults@2021-07-01' = {\n  name: vaultName\n  location: location\n  sku: {\n    name: 'RS0'\n    tier: 'Standard'\n  }\n  properties: {}\n}\n\nresource omsWorkspace 'Microsoft.OperationalInsights/workspaces@2021-06-01' = {\n  name: omsWorkspaceName\n  location: workspaceLocation\n  properties: {\n    sku: {\n      name: 'PerGB2018'\n    }\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-06-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'Storage'\n  properties: {}\n}\n\nresource vaultName_microsoft_insights_omsWorkspaceName 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: recoveryServicesVault\n  name: omsWorkspaceName\n  properties: {\n    storageAccountId: storageAccount.id\n    workspaceId: omsWorkspace.id\n    logs: [\n      {\n        category: 'AzureBackupReport'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1265."}, {"role": "assistant", "content": "@description('Recovery Services vault name')\nparam vaultName string = uniqueString(resourceGroup().id)\n\n@description('Location of Recovery Services vault')\nparam location string = resourceGroup().location\n\n@description('Enable system identity for Recovery Services vault')\nparam enableSystemIdentity bool = false\n\n@description('Enable system identity for Recovery Services vault')\n@allowed([\n  'Standard'\n  'RS0'\n])\nparam sku string = 'RS0'\n\n@description('Storage replication type for Recovery Services vault')\n@allowed([\n  'LocallyRedundant'\n  'GeoRedundant'\n  'ReadAccessGeoZoneRedundant'\n  'ZoneRedundant'\n])\nparam storageType string = 'GeoRedundant'\n\n@description('Enable cross region restore')\nparam enablecrossRegionRestore bool = false\n\n@description('Array containing backup policies')\n@metadata({\n  policyName: 'Backup policy name'\n  properties: 'Object containing backup policy settings'\n})\nparam backupPolicies array = []\n\n@description('Enable delete lock')\nparam enableDeleteLock bool = false\n\n@description('Enable diagnostic logs')\nparam enableDiagnostics bool = false\n\n@description('Storage account resource id. Only required if enableDiagnostics is set to true.')\nparam diagnosticStorageAccountId string = ''\n\n@description('Log analytics workspace resource id. Only required if enableDiagnostics is set to true.')\nparam logAnalyticsWorkspaceId string = ''\n\nvar lockName = '${vault.name}-lck'\nvar diagnosticsName = '${vault.name}-dgs'\n\nresource vault 'Microsoft.RecoveryServices/vaults@2021-06-01' = {\n  name: vaultName\n  location: location\n  identity: {\n    type: enableSystemIdentity ? 'SystemAssigned' : 'None'\n  }\n  properties: {}\n  sku: {\n    name: sku\n    tier: 'Standard'\n  }\n}\n\nresource backupPolicy 'Microsoft.RecoveryServices/vaults/backupPolicies@2021-06-01' = [for policy in backupPolicies: {\n  parent: vault\n  name: policy.policyName\n  location: location\n  properties: policy.properties\n}]\n\nresource vaultConfig 'Microsoft.RecoveryServices/vaults/backupstorageconfig@2021-04-01' = {\n  name: '${vault.name}/VaultStorageConfig'\n  properties: {\n    crossRegionRestoreFlag: enablecrossRegionRestore\n    storageType: storageType\n  }\n}\n\nresource lock 'Microsoft.Authorization/locks@2016-09-01' = if (enableDeleteLock) {\n  scope: vault\n  name: lockName\n  properties: {\n    level: 'CanNotDelete'\n  }\n}\n\nresource diagnostics 'microsoft.insights/diagnosticSettings@2017-05-01-preview' = if (enableDiagnostics) {\n  scope: vault\n  name: diagnosticsName\n  properties: {\n    workspaceId: logAnalyticsWorkspaceId\n    storageAccountId: diagnosticStorageAccountId\n    logs: [\n      {\n        category: 'AzureBackupReport'\n        enabled: true\n      }\n      {\n        category: 'AzureSiteRecoveryJobs'\n        enabled: true\n      }\n      {\n        category: 'AzureSiteRecoveryEvents'\n        enabled: true\n      }\n      {\n        category: 'AzureSiteRecoveryReplicatedItems'\n        enabled: true\n      }\n      {\n        category: 'AzureSiteRecoveryReplicationStats'\n        enabled: true\n      }\n      {\n        category: 'AzureSiteRecoveryRecoveryPoints'\n        enabled: true\n      }\n      {\n        category: 'AzureSiteRecoveryReplicationDataUploadRate'\n        enabled: true\n      }\n      {\n        category: 'AzureSiteRecoveryProtectedDiskDataChurn'\n        enabled: true\n      }\n      {\n        category: 'CoreAzureBackup'\n        enabled: true\n      }\n      {\n        category: 'CoreAzureBackup'\n        enabled: true\n      }\n      {\n        category: 'AddonAzureBackupJobs'\n        enabled: true\n      }\n      {\n        category: 'AddonAzureBackupAlerts'\n        enabled: true\n      }\n      {\n        category: 'AddonAzureBackupPolicy'\n        enabled: true\n      }\n      {\n        category: 'AddonAzureBackupStorage'\n        enabled: true\n      }\n      {\n        category: 'AddonAzureBackupProtectedInstance'\n        enabled: true\n      }\n    ]\n    metrics: [\n      {\n        category: 'Health'\n        enabled: true\n      }\n    ]\n  }\n}\n\noutput name string = vault.name\noutput id string = vault.id\noutput systemIdentityPrincipalId string = enableSystemIdentity ? vault.identity.principalId : 'None'\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1266."}, {"role": "assistant", "content": "@description('Specifies a name for generating resource names.')\n@maxLength(8)\nparam projectName string\n\n@description('Specifies the location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Specifies the administrator username for the Virtual Machine.')\nparam adminUsername string\n\n@description('Specifies the administrator password for the Virtual Machine.')\n@secure()\nparam adminPassword string\n\n@description('Specifies the unique DNS Name for the Public IP used to access the Virtual Machine.')\nparam dnsLabelPrefix string\n\n@description('Virtual machine size.')\nparam vmSize string = 'Standard_A2'\n\n@description('Specifies the Windows version for the VM. This will pick a fully patched image of this given Windows version.')\n@allowed([\n  '2008-R2-SP1'\n  '2012-Datacenter'\n  '2012-R2-Datacenter'\n  '2016-Nano-Server'\n  '2016-Datacenter-with-Containers'\n  '2016-Datacenter'\n  '2019-Datacenter'\n  '2019-Datacenter-Core'\n  '2019-Datacenter-Core-smalldisk'\n  '2019-Datacenter-Core-with-Containers'\n  '2019-Datacenter-Core-with-Containers-smalldisk'\n  '2019-Datacenter-smalldisk'\n  '2019-Datacenter-with-Containers'\n  '2019-Datacenter-with-Containers-smalldisk'\n])\nparam windowsOSVersion string = '2016-Datacenter'\n\nvar storageAccountName = '${projectName}store'\nvar networkInterfaceName = '${projectName}-nic'\nvar vNetAddressPrefix = '10.0.0.0/16'\nvar vNetSubnetName = 'default'\nvar vNetSubnetAddressPrefix = '10.0.0.0/24'\nvar publicIPAddressName = '${projectName}-ip'\nvar vmName = '${projectName}-vm'\nvar vNetName = '${projectName}-vnet'\nvar vaultName = '${projectName}-vault'\nvar backupFabric = 'Azure'\nvar backupPolicyName = 'DefaultPolicy'\nvar protectionContainer = 'iaasvmcontainer;iaasvmcontainerv2;${resourceGroup().name};${vmName}'\nvar protectedItem = 'vm;iaasvmcontainerv2;${resourceGroup().name};${vmName}'\nvar networkSecurityGroupName = 'default-NSG'\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-08-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'Storage'\n  properties: {}\n}\n\nresource publicIPAddress 'Microsoft.Network/publicIPAddresses@2021-05-01' = {\n  name: publicIPAddressName\n  location: location\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n    dnsSettings: {\n      domainNameLabel: dnsLabelPrefix\n    }\n  }\n}\n\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2021-05-01' = {\n  name: networkSecurityGroupName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'default-allow-3389'\n        properties: {\n          priority: 1000\n          access: 'Allow'\n          direction: 'Inbound'\n          destinationPortRange: '3389'\n          protocol: 'Tcp'\n          sourceAddressPrefix: '*'\n          sourcePortRange: '*'\n          destinationAddressPrefix: '*'\n        }\n      }\n    ]\n  }\n}\n\nresource vNet 'Microsoft.Network/virtualNetworks@2021-05-01' = {\n  name: vNetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vNetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: vNetSubnetName\n        properties: {\n          addressPrefix: vNetSubnetAddressPrefix\n          networkSecurityGroup: {\n            id: networkSecurityGroup.id\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource networkInterface 'Microsoft.Network/networkInterfaces@2021-05-01' = {\n  name: networkInterfaceName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: publicIPAddress.id\n          }\n          subnet: {\n            id: '${vNet.id}/subnets/${vNetSubnetName}'\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2021-11-01' = {\n  name: vmName\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: vmSize\n    }\n    osProfile: {\n      computerName: vmName\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: windowsOSVersion\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n      }\n      dataDisks: [\n        {\n          diskSizeGB: 1023\n          lun: 0\n          createOption: 'Empty'\n        }\n      ]\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkInterface.id\n        }\n      ]\n    }\n    diagnosticsProfile: {\n      bootDiagnostics: {\n        enabled: true\n        storageUri: storageAccount.properties.primaryEndpoints.blob\n      }\n    }\n  }\n}\n\nresource recoveryServicesVault 'Microsoft.RecoveryServices/vaults@2022-01-01' = {\n  name: vaultName\n  location: location\n  sku: {\n    name: 'RS0'\n    tier: 'Standard'\n  }\n  properties: {}\n}\n\nresource vaultName_backupFabric_protectionContainer_protectedItem 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems@2022-01-01' = {\n  name: '${vaultName}/${backupFabric}/${protectionContainer}/${protectedItem}'\n  properties: {\n    protectedItemType: 'Microsoft.Compute/virtualMachines'\n    policyId: '${recoveryServicesVault.id}/backupPolicies/${backupPolicyName}'\n    sourceResourceId: virtualMachine.id\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1267."}, {"role": "assistant", "content": "@description('Name of the Recovery Services Vault')\nparam vaultName string\n\n@description('Name of the Backup Policy')\nparam policyName string\n\n@description('Times in day when backup should be triggered. e.g. 01:00 or 13:00. Must be an array, however for IaaS VMs only one value is valid. This will be used in LTR too for daily, weekly, monthly and yearly backup.')\nparam scheduleRunTimes array\n\n@description('Any Valid timezone, for example:UTC, Pacific Standard Time. Refer: https://msdn.microsoft.com/en-us/library/gg154758.aspx')\nparam timeZone string\n\n@description('Number of days Instant Recovery Point should be retained')\n@allowed([\n  1\n  2\n  3\n  4\n  5\n])\nparam instantRpRetentionRangeInDays int = 2\n\n@description('Number of days you want to retain the backup')\nparam dailyRetentionDurationCount int\n\n@description('Backup will run on array of Days like, Monday, Tuesday etc. Applies in Weekly retention only.')\nparam daysOfTheWeek array\n\n@description('Number of weeks you want to retain the backup')\nparam weeklyRetentionDurationCount int\n\n@description('Number of months you want to retain the backup')\nparam monthlyRetentionDurationCount int\n\n@description('Array of Months for Yearly Retention')\nparam monthsOfYear array\n\n@description('Number of years you want to retain the backup')\nparam yearlyRetentionDurationCount int\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nresource recoveryServicesVault 'Microsoft.RecoveryServices/vaults@2020-10-01' = {\n  name: vaultName\n  location: location\n  sku: {\n    name: 'RS0'\n    tier: 'Standard'\n  }\n  properties: {}\n}\n\nresource backupPolicy 'Microsoft.RecoveryServices/vaults/backupPolicies@2016-06-01' = {\n  parent: recoveryServicesVault\n  name: policyName\n  location: location\n  properties: {\n    backupManagementType: 'AzureIaasVM'\n    instantRpRetentionRangeInDays: instantRpRetentionRangeInDays\n    schedulePolicy: {\n      scheduleRunFrequency: 'Daily'\n      scheduleRunTimes: scheduleRunTimes\n      schedulePolicyType: 'SimpleSchedulePolicy'\n    }\n    retentionPolicy: {\n      dailySchedule: {\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: dailyRetentionDurationCount\n          durationType: 'Days'\n        }\n      }\n      weeklySchedule: {\n        daysOfTheWeek: daysOfTheWeek\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: weeklyRetentionDurationCount\n          durationType: 'Weeks'\n        }\n      }\n      monthlySchedule: {\n        retentionScheduleFormatType: 'Daily'\n        retentionScheduleDaily: {\n          daysOfTheMonth: [\n            {\n              date: 1\n              isLast: false\n            }\n          ]\n        }\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: monthlyRetentionDurationCount\n          durationType: 'Months'\n        }\n      }\n      yearlySchedule: {\n        retentionScheduleFormatType: 'Daily'\n        monthsOfYear: monthsOfYear\n        retentionScheduleDaily: {\n          daysOfTheMonth: [\n            {\n              date: 1\n              isLast: false\n            }\n          ]\n        }\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: yearlyRetentionDurationCount\n          durationType: 'Years'\n        }\n      }\n      retentionPolicyType: 'LongTermRetentionPolicy'\n    }\n    timeZone: timeZone\n  }\n}"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1268 please."}, {"role": "assistant", "content": "@description('Name of the Vault')\nparam vaultName string\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nresource recoveryServicesVault 'Microsoft.RecoveryServices/vaults@2020-10-01' = {\n  name: vaultName\n  location: location\n  properties: {}\n  sku: {\n    name: 'RS0'\n    tier: 'Standard'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1269?"}, {"role": "assistant", "content": "@description('Name of the Vault')\nparam vaultName string\n\n@description('Enable CRR (Works if vault has not registered any backup instance)')\nparam enableCRR bool = true\n\n@description('Change Vault Storage Type (Works if vault has not registered any backup instance)')\n@allowed([\n  'LocallyRedundant'\n  'GeoRedundant'\n])\nparam vaultStorageType string = 'GeoRedundant'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar skuName = 'RS0'\nvar skuTier = 'Standard'\n\nresource recoveryServicesVault 'Microsoft.RecoveryServices/vaults@2022-02-01' = {\n  name: vaultName\n  location: location\n  sku: {\n    name: skuName\n    tier: skuTier\n  }\n  properties: {}\n}\n\nresource vaultName_vaultstorageconfig 'Microsoft.RecoveryServices/vaults/backupstorageconfig@2022-02-01' = {\n  parent: recoveryServicesVault\n  name: 'vaultstorageconfig'\n  properties: {\n    storageModelType: vaultStorageType\n    crossRegionRestoreFlag: enableCRR\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1270."}, {"role": "assistant", "content": "\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n\n// Required parameters\n@description('Location of the recovery service Vault for disaster recovery')\nparam replicationLocation string = 'eastus'\n\n@description('Virtual network resource name.')\nparam virtualNetworkName string\n@description('Virtual network resource Address Space.')\nparam virtualNetworkAddressSpace string = '10.100.0.0/16'\n@description('Virtual network resource Subnet 1 name.')\nparam subnetName1 string\n@description('Virtual network resource Subnet 2 name.')\nparam subnetName2 string\n@description('Virtual network resource Subnet 1 Address Prefix.')\nparam subnetAddressPrefix1 string = '10.100.0.0/24'\n@description('Virtual network resource Subnet 2 Address Prefix.')\nparam subnetAddressPrefix2 string = '10.100.1.0/24'\n@description('Storage account name')\nparam storageAccountName string = 'storage${uniqueString(subscription().id)}'\n@description('Azure recovery service vault name')\nparam recoveryServiceVaultName string = 'rsv-${uniqueString(subscription().id)}'\nparam replicationPolicyName string = 'DailyPolicy-${uniqueString(resourceGroup().id)}'\n\n\n@description('Set to true is disaster recovery vm replication should be enabled on the VM')\nparam disasterRecoveryEnabled bool = false\n\n@description('Provide the virtual network ID for replication secondary region')\nparam recoveryNetworkId string = 'none'\n\n@description('Resource ID of the Virtual machine that needs replication')\nparam virtualMachineId string = 'none'\n\n@description('Resource group ID of where the virtual machine will be replicated to')\nparam recoveryResourceGroupId string = 'none'\nvar blobPrivateDnsZoneName = 'privatelink.blob.${environment().suffixes.storage}'\nvar filePrivateDnsZoneName = 'privatelink.file.${environment().suffixes.storage}'\nvar queuePrivateDnsZoneName = 'privatelink.queue.${environment().suffixes.storage}'\nvar roleDefinitionContributorId = resourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\nvar roleDefinitionStorageBlobDataContributorId = resourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')\nvar rsvPrivateDnsZoneName = 'privatelink.siterecovery.windowsazure.com'\nvar instanceType = 'A2A'\n\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2024-01-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [virtualNetworkAddressSpace]\n    }\n  }\n}\n\nresource computeSubnet 'Microsoft.Network/virtualNetworks/subnets@2024-01-01' = {\n  parent: virtualNetwork\n  name: subnetName1\n  properties: {\n    addressPrefix: subnetAddressPrefix1\n    privateEndpointNetworkPolicies: 'Enabled'\n  }\n}\n\nresource privateEndpointSubnet 'Microsoft.Network/virtualNetworks/subnets@2024-01-01' = {\n  parent: virtualNetwork\n  name: subnetName2\n  properties: {\n    addressPrefix: subnetAddressPrefix2\n    privateEndpointNetworkPolicies: 'Enabled'\n  }\n\n  dependsOn: [\n    computeSubnet\n  ]\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-05-01' = {\n  name: toLower(storageAccountName)\n  location: location\n  sku: {\n    name: 'Standard_GRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    accessTier: 'Hot'\n    allowBlobPublicAccess: false\n    minimumTlsVersion: 'TLS1_2'\n    supportsHttpsTrafficOnly: true\n    networkAcls: {\n      bypass: 'AzureServices'\n      defaultAction: 'Deny'\n    }\n  }\n}\n\nresource blobPrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = {\n  name: blobPrivateDnsZoneName\n  location: 'global'\n}\n\nresource filePrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = {\n  name: filePrivateDnsZoneName\n  location: 'global'\n}\n\nresource queuePrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = {\n  name: queuePrivateDnsZoneName\n  location: 'global'\n}\n\nresource blobPrivateDnsZoneNameVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01' = {\n  parent: blobPrivateDnsZone\n  name: 'link_to_${toLower(split(virtualNetwork.id, '/')[8])}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetwork.id\n    }\n  }\n}\n\nresource filePrivateDnsZoneNameVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01' = {\n  parent: filePrivateDnsZone\n  name: 'link_to_${toLower(split(virtualNetwork.id, '/')[8])}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetwork.id\n    }\n  }\n}\n\nresource queuePrivateDnsZoneNameVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01' = {\n  parent: queuePrivateDnsZone\n  name: 'link_to_${toLower(split(virtualNetwork.id, '/')[8])}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetwork.id\n    }\n  }\n}\n\nresource blobPrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\n  name: '${storageAccount.name}-blob-pe'\n  location: location\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: '${storageAccount.name}-blob-pe'\n        properties: {\n          privateLinkServiceId: storageAccount.id\n          groupIds: [\n            'blob'\n          ]\n        }\n      }\n    ]\n    subnet: {\n      id: privateEndpointSubnet.id\n    }\n  }\n}\n\nresource filePrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\n  name: '${storageAccount.name}-file-pe'\n  location: location\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: '${storageAccount.name}-file-pe'\n        properties: {\n          privateLinkServiceId: storageAccount.id\n          groupIds: [\n            'file'\n          ]\n        }\n      }\n    ]\n    subnet: {\n      id: privateEndpointSubnet.id\n    }\n  }\n}\n\nresource queuePrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\n  name: '${storageAccount.name}-queue-pe'\n  location: location\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: '${storageAccount.name}-queue-pe'\n        properties: {\n          privateLinkServiceId: storageAccount.id\n          groupIds: [\n            'queue'\n          ]\n        }\n      }\n    ]\n    subnet: {\n      id: privateEndpointSubnet.id\n    }\n  }\n}\n\nresource blobPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2024-01-01' = {\n  parent: blobPrivateEndpoint\n  name: 'blob'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'dnsConfig'\n        properties: {\n          privateDnsZoneId: blobPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource filePrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2024-01-01' = {\n  parent: filePrivateEndpoint\n  name: 'file'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'dnsConfig'\n        properties: {\n          privateDnsZoneId: filePrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource queuePrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2024-01-01' = {\n  parent: queuePrivateEndpoint\n  name: 'queue'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'dnsConfig'\n        properties: {\n          privateDnsZoneId: queuePrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource recoveryServiceVault 'Microsoft.RecoveryServices/vaults@2024-04-30-preview' = {\n  name: recoveryServiceVaultName\n  location: replicationLocation\n  identity: {\n    type: 'SystemAssigned'\n  }\n  sku: {\n    name: 'RS0'\n    tier: 'Standard'\n  }\n  properties: {\n    redundancySettings: {\n      crossRegionRestore: 'Disabled'\n      standardTierStorageRedundancy: 'GeoRedundant'\n    }\n    publicNetworkAccess: 'Enabled'\n  }\n}\n\nresource roleAssignmentContributor 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  scope: storageAccount\n  name: guid(resourceGroup().id, storageAccount.id, 'Contributor')\n  properties: {\n    roleDefinitionId: roleDefinitionContributorId\n    principalType: 'ServicePrincipal'\n    principalId: recoveryServiceVault.identity.principalId\n  }\n}\n\nresource roleAssignmentStorageBlobDataContributor 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  scope: storageAccount\n  name: guid(resourceGroup().id, storageAccount.id, 'Storage Blob Data Contributor')\n  properties: {\n    roleDefinitionId: roleDefinitionStorageBlobDataContributorId\n    principalType: 'ServicePrincipal'\n    principalId: recoveryServiceVault.identity.principalId\n  }\n}\n\nresource rsvPrivateDnsZone 'Microsoft.Network/privateDnsZones@2024-06-01' = {\n  name: rsvPrivateDnsZoneName\n  location: 'global'\n}\n\nresource rsvPrivateDnsZoneNameVnetLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01' = {\n  parent: rsvPrivateDnsZone\n  name: 'link_to_${toLower(split(virtualNetwork.id, '/')[8])}'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetwork.id\n    }\n  }\n}\n\nresource rsvPrivateEndpoint 'Microsoft.Network/privateEndpoints@2024-01-01' = {\n  name: '${recoveryServiceVault.name}-rsv-pe'\n  location: location\n  properties: {\n    privateLinkServiceConnections: [\n      {\n        name: '${recoveryServiceVault.name}-rsv-pe'\n        properties: {\n          privateLinkServiceId: recoveryServiceVault.id\n          groupIds: [\n            'AzureSiteRecovery'\n          ]\n        }\n      }\n    ]\n    subnet: {\n      id: privateEndpointSubnet.id\n    }\n  }\n}\n\nresource rsvPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2024-01-01' = {\n  parent: rsvPrivateEndpoint\n  name: 'AzureSiteRecovery'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'dnsConfig'\n        properties: {\n          privateDnsZoneId: rsvPrivateDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource replicationPolicies 'Microsoft.RecoveryServices/vaults/replicationPolicies@2024-04-01' = {\n  parent: recoveryServiceVault\n  name: replicationPolicyName\n  properties: {\n    providerSpecificInput: {\n      instanceType: instanceType\n      appConsistentFrequencyInMinutes: 4 * 60\n      crashConsistentFrequencyInMinutes: 5\n      multiVmSyncStatus: 'Enable'\n      recoveryPointHistory: 24 * 60\n    }\n  }\n}\n\nresource primaryRSVFabric 'Microsoft.RecoveryServices/vaults/replicationFabrics@2024-04-01' = {\n  parent: recoveryServiceVault\n  name: 'Primary-Fabric'\n  properties: {\n    customDetails: {\n      instanceType: 'Azure'\n      location: location\n    }\n  }\n}\n\nresource secondaryRSVFabric 'Microsoft.RecoveryServices/vaults/replicationFabrics@2024-04-01' = {\n  parent: recoveryServiceVault\n  name: 'Secondary-Fabric'\n  properties: {\n    customDetails: {\n      instanceType: 'Azure'\n      location: recoveryServiceVault.location\n    }\n  }\n}\n\nresource primaryRSVFabricProtectionContainers 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers@2024-04-01' = {\n  parent: primaryRSVFabric\n  name: 'Primary-Protection-Container'\n  properties: {\n    providerSpecificInput: [\n      {\n        instanceType: instanceType\n      }\n    ]\n  }\n}\n\nresource secondaryRSVFabricProtectionContainers 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers@2024-04-01' = {\n  parent: secondaryRSVFabric\n  name: 'Secondary-Protection-Container'\n  properties: {\n    providerSpecificInput: [\n      {\n        instanceType: instanceType\n      }\n    ]\n  }\n}\n\nresource protectionContainerMappings 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers/replicationProtectionContainerMappings@2024-04-01' = {\n  parent: primaryRSVFabricProtectionContainers\n  name: 'Primary-Container-Mapping'\n  properties: {\n    policyId: replicationPolicies.id\n    providerSpecificInput: {\n      instanceType: instanceType\n    }\n    targetProtectionContainerId: secondaryRSVFabricProtectionContainers.id\n  }\n}\n\nresource primaryReplicationNetworkMappings 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationNetworks/replicationNetworkMappings@2024-04-01' = if(disasterRecoveryEnabled) {\n  name: format('{0}/{1}/{2}/{3}',recoveryServiceVault.name, primaryRSVFabric.name, 'azureNetwork', 'Source-Network-Mapping')\n  properties: {\n    fabricSpecificDetails: {\n      instanceType: 'AzureToAzure'\n      primaryNetworkId: virtualNetwork.id\n    }\n    recoveryFabricName: secondaryRSVFabric.name\n    recoveryNetworkId: recoveryNetworkId\n  }\n}\n\nresource secondaryReplicationNetworkMappings 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationNetworks/replicationNetworkMappings@2024-04-01' = if(disasterRecoveryEnabled) {\n  name: format('{0}/{1}/{2}/{3}',recoveryServiceVault.name, secondaryRSVFabric.name, 'azureNetwork', 'Target-Network-Mapping')\n  properties: {\n    fabricSpecificDetails: {\n      instanceType: 'AzureToAzure'\n      primaryNetworkId: recoveryNetworkId\n    }\n    recoveryFabricName: primaryRSVFabric.name\n    recoveryNetworkId: virtualNetwork.id\n  }\n}\n\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2024-07-01' existing = if(disasterRecoveryEnabled) {\n  scope: az.resourceGroup(split(virtualMachineId, '/')[4])\n  name: split(virtualMachineId, '/')[8]\n}\n\nresource replicationProtectedItems 'Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers/replicationProtectedItems@2024-04-01' = if(disasterRecoveryEnabled) {\n  parent: primaryRSVFabricProtectionContainers\n  name: virtualMachine.name\n  properties: {\n    policyId: replicationPolicies.id\n    providerSpecificDetails: {\n      instanceType: instanceType\n      autoProtectionOfDataDisk: 'Enabled'\n      fabricObjectId: virtualMachine.id\n      recoveryResourceGroupId: recoveryResourceGroupId\n      recoveryContainerId: secondaryRSVFabricProtectionContainers.id\n      recoveryAzureNetworkId: recoveryNetworkId\n      recoverySubnetName: computeSubnet.name\n      vmManagedDisks: [\n        {\n          diskId: virtualMachine.id\n          primaryStagingAzureStorageAccountId: storageAccount.id\n          recoveryReplicaDiskAccountType: virtualMachine.properties.storageProfile.osDisk.managedDisk.storageAccountType\n          recoveryTargetDiskAccountType: virtualMachine.properties.storageProfile.osDisk.managedDisk.storageAccountType\n          recoveryResourceGroupId: recoveryResourceGroupId\n        }\n      ]\n    }\n  }\n\n  dependsOn: [\n    protectionContainerMappings\n    primaryReplicationNetworkMappings\n    secondaryReplicationNetworkMappings\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1271?"}, {"role": "assistant", "content": "@description('Name of the Vault')\nparam vaultName string = 'SqlBackupDemoVault'\n\n@description('Resource group of Compute VM containing the workload')\nparam vmResourceGroup string\n\n@description('Name of the Compute VM containing the workload')\nparam vmName string = 'sqlvmbackupdemo'\n\n@description('Backup Policy Name')\nparam policyName string\n\n@description('Name of database server instance')\nparam databaseInstanceName string\n\n@description('Name of protectable data source i.e. Database Name')\nparam databaseName string\n\n@description('Conditional parameter for New or Existing Vault')\nparam isNewVault bool = false\n\n@description('Conditional parameter for New or Existing Backup Policy')\nparam isNewPolicy bool = false\n\n@description('Workload type which is installed in VM and Pre-Registration Steps are performed')\n@allowed([\n  'SQLDataBase'\n])\nparam workloadType string = 'SQLDataBase'\n\n@description('Protected Item (Database) type')\n@allowed([\n  'AzureVmWorkloadSQLDatabaseProtectedItem'\n])\nparam protectedItemType string = 'AzureVmWorkloadSQLDatabaseProtectedItem'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar skuName = 'RS0'\nvar skuTier = 'Standard'\nvar backupFabric = 'Azure'\nvar containerType = 'VMAppContainer'\nvar backupManagementType = 'AzureWorkload'\n\nresource recoveryServicesVault 'Microsoft.RecoveryServices/vaults@2020-10-01' = if (isNewVault) {\n  name: vaultName\n  location: location\n  sku: {\n    name: skuName\n    tier: skuTier\n  }\n  properties: {}\n}\n\nresource protectionContainer 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers@2021-03-01' = {\n  name: '${vaultName}/${backupFabric}/${containerType};compute;${vmResourceGroup};${vmName}'\n  properties: {\n    containerType: containerType\n    backupManagementType: backupManagementType\n    workloadType: workloadType\n    friendlyName: vmName\n    sourceResourceId: resourceId(vmResourceGroup, 'Microsoft.Compute/virtualMachines', vmName)\n  }\n  dependsOn: [\n    recoveryServicesVault\n    backupPolicy\n  ]\n}\n\nresource backupPolicy 'Microsoft.RecoveryServices/vaults/backupPolicies@2021-03-01' = if (isNewPolicy) {\n  parent: recoveryServicesVault\n  name: policyName\n  properties: {\n    backupManagementType: backupManagementType\n    workloadType: workloadType\n    settings: {\n      timeZone: 'UTC'\n      issqlcompression: false\n      isCompression: false\n    }\n    subProtectionPolicy: [\n      {\n        policyType: 'Full'\n        schedulePolicy: {\n          schedulePolicyType: 'SimpleSchedulePolicy'\n          scheduleRunFrequency: 'Daily'\n          scheduleRunTimes: [\n            '2019-03-24T16:00:00Z'\n          ]\n          scheduleWeeklyFrequency: 0\n        }\n        retentionPolicy: {\n          retentionPolicyType: 'LongTermRetentionPolicy'\n          dailySchedule: {\n            retentionTimes: [\n              '2019-03-24T16:00:00Z'\n            ]\n            retentionDuration: {\n              count: 30\n              durationType: 'Days'\n            }\n          }\n        }\n      }\n      {\n        policyType: 'Log'\n        schedulePolicy: {\n          schedulePolicyType: 'LogSchedulePolicy'\n          scheduleFrequencyInMins: 60\n        }\n        retentionPolicy: {\n          retentionPolicyType: 'SimpleRetentionPolicy'\n          retentionDuration: {\n            count: 30\n            durationType: 'Days'\n          }\n        }\n      }\n    ]\n  }\n}\n\nresource protectedItem 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems@2021-03-01' = {\n  parent: protectionContainer\n  name: '${workloadType};${databaseInstanceName};${databaseName}'\n  properties: {\n    backupManagementType: backupManagementType\n    workloadType: workloadType\n    protectedItemType: protectedItemType\n    friendlyName: databaseName\n    policyId: backupPolicy.id\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1272."}, {"role": "assistant", "content": "param virtualMachineName string\nparam virtualMachineSize string\nparam adminUsername string\nparam virtualNetworkName string\nparam networkInterfaceName string\nparam networkSecurityGroupName string\nparam location string = resourceGroup().location\n\n@secure()\nparam adminPassword string\nparam addressPrefix string\nparam subnetName string\nparam subnetPrefix string\nparam publicIpAddressName string\nparam publicIpAddressType string\nparam publicIpAddressSku string\nparam sqlConnectivityType string\nparam sqlPortNumber int\nparam sqlStorageDisksCount int\nparam sqlStorageWorkloadType string\nparam sqlStorageDisksConfigurationType string\nparam sqlStorageStartingDeviceId int\nparam sqlAutopatchingDayOfWeek string\nparam sqlAutopatchingStartHour string\nparam sqlAutopatchingWindowDuration string\nparam sqlAuthenticationLogin string\n\n@secure()\nparam sqlAuthenticationPassword string\nparam rServicesEnabled string\n\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\n\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2021-03-01' = {\n  name: virtualMachineName\n  location: location\n  properties: {\n    osProfile: {\n      computerName: virtualMachineName\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        provisionVMAgent: true\n      }\n    }\n    hardwareProfile: {\n      vmSize: virtualMachineSize\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftSQLServer'\n        offer: 'SQL2016SP1-WS2016'\n        sku: 'Enterprise'\n        version: 'latest'\n      }\n      osDisk: {\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n      }\n      dataDisks: [\n        {\n          createOption: 'Empty'\n          lun: 0\n          diskSizeGB: 1023\n          caching: 'ReadOnly'\n          managedDisk: {\n            storageAccountType: 'Premium_LRS'\n          }\n        }\n      ]\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkInterface.id\n        }\n      ]\n    }\n  }\n}\n\nresource sqlVirtualMachine 'Microsoft.SqlVirtualMachine/sqlVirtualMachines@2017-03-01-preview' = {\n  name: virtualMachineName\n  location: location\n  properties: {\n    virtualMachineResourceId: virtualMachine.id\n    autoPatchingSettings: {\n      enable: true\n      dayOfWeek: sqlAutopatchingDayOfWeek\n      maintenanceWindowStartingHour: sqlAutopatchingStartHour\n      maintenanceWindowDuration: sqlAutopatchingWindowDuration\n    }\n    keyVaultCredentialSettings: {\n      enable: false\n    }\n    serverConfigurationsManagementSettings: {\n      sqlConnectivityUpdateSettings: {\n        connectivityType: sqlConnectivityType\n        port: sqlPortNumber\n        sqlAuthUpdateUserName: sqlAuthenticationLogin\n        sqlAuthUpdatePassword: sqlAuthenticationPassword\n      }\n      sqlWorkloadTypeUpdateSettings: {\n        sqlWorkloadType: sqlStorageWorkloadType\n      }\n      sqlStorageUpdateSettings: {\n        diskCount: sqlStorageDisksCount\n        diskConfigurationType: sqlStorageDisksConfigurationType\n        startingDeviceId: sqlStorageStartingDeviceId\n      }\n      additionalFeaturesServerConfigurations: {\n        isRServicesEnabled: rServicesEnabled\n      }\n    }\n  }\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-11-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        addressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: subnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource networkInterface 'Microsoft.Network/networkInterfaces@2020-11-01' = {\n  name: networkInterfaceName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          subnet: {\n            id: subnetRef\n          }\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: publicIpAddress.id\n          }\n        }\n      }\n    ]\n    networkSecurityGroup: {\n      id: networkSecurityGroup.id\n    }\n  }\n  dependsOn: [\n    virtualNetwork\n  ]\n}\n\nresource publicIpAddress 'Microsoft.Network/publicIPAddresses@2020-11-01' = {\n  sku: {\n    name: publicIpAddressSku\n  }\n  name: publicIpAddressName\n  location: location\n  properties: {\n    publicIPAllocationMethod: publicIpAddressType\n  }\n}\n\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2020-11-01' = {\n  name: networkSecurityGroupName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'RDP'\n        properties: {\n          priority: 300\n          protocol: 'Tcp'\n          access: 'Allow'\n          direction: 'Inbound'\n          sourceAddressPrefix: '*'\n          sourcePortRange: '*'\n          destinationAddressPrefix: '*'\n          destinationPortRange: '3389'\n        }\n      }\n      {\n        name: 'default-allow-sql'\n        properties: {\n          priority: 1500\n          protocol: 'Tcp'\n          access: 'Allow'\n          direction: 'Inbound'\n          sourceAddressPrefix: '*'\n          sourcePortRange: '*'\n          destinationAddressPrefix: '*'\n          destinationPortRange: '1433'\n        }\n      }\n    ]\n  }\n}\n\noutput adminUsername string = adminUsername\noutput virtualMachineName string = virtualMachineName\noutput resourceGroupName string = resourceGroup().name\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1273."}, {"role": "assistant", "content": "@description('Name of the Recovery Services Vault')\nparam vaultName string\n\n@description('Name of the Backup Policy')\nparam policyName string\n\n@description('Backup Schedule will run on array of Days like, Monday, Tuesday etc. Applies in Weekly Backup Type only.')\nparam scheduleRunDays array\n\n@description('Times in day when backup should be triggered. e.g. 01:00, 13:00. This will be used in LTR too for daily, weekly, monthly and yearly backup.')\nparam scheduleRunTimes array\n\n@description('Any Valid timezone, for example:UTC, Pacific Standard Time. Refer: https://msdn.microsoft.com/en-us/library/gg154758.aspx')\nparam timeZone string\n\n@description('Number of weeks you want to retain the backup')\nparam weeklyRetentionDurationCount int\n\n@description('Array of Days for Monthly Retention (Min One or Max all values from scheduleRunDays, but not any other days which are not part of scheduleRunDays)')\nparam daysOfTheWeekForMontlyRetention array\n\n@description('Array of Weeks for Monthly Retention - First, Second, Third, Fourth, Last')\nparam weeksOfTheMonthForMonthlyRetention array\n\n@description('Number of months you want to retain the backup')\nparam monthlyRetentionDurationCount int\n\n@description('Array of Months for Yearly Retention')\nparam monthsOfYear array\n\n@description('Array of Days for Yearly Retention (Min One or Max all values from scheduleRunDays, but not any other days which are not part of scheduleRunDays)')\nparam daysOfTheWeekForYearlyRetention array\n\n@description('Array of Weeks for Yearly Retention - First, Second, Third, Fourth, Last')\nparam weeksOfTheMonthForYearlyRetention array\n\n@description('Number of years you want to retain the backup')\nparam yearlyRetentionDurationCount int\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nresource recoveryServicesVault 'Microsoft.RecoveryServices/vaults@2020-10-01' = {\n  name: vaultName\n  location: location\n  sku: {\n    name: 'RS0'\n    tier: 'Standard'\n  }\n  properties: {}\n}\n\nresource backupPolicy 'Microsoft.RecoveryServices/vaults/backupPolicies@2016-06-01' = {\n  parent: recoveryServicesVault\n  name: policyName\n  location: location\n  properties: {\n    backupManagementType: 'AzureIaasVM'\n    instantRpRetentionRangeInDays: 5\n    schedulePolicy: {\n      scheduleRunFrequency: 'Weekly'\n      scheduleRunDays: scheduleRunDays\n      scheduleRunTimes: scheduleRunTimes\n      schedulePolicyType: 'SimpleSchedulePolicy'\n    }\n    retentionPolicy: {\n      weeklySchedule: {\n        daysOfTheWeek: scheduleRunDays\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: weeklyRetentionDurationCount\n          durationType: 'Weeks'\n        }\n      }\n      monthlySchedule: {\n        retentionScheduleFormatType: 'Weekly'\n        retentionScheduleDaily: {\n          daysOfTheMonth: [\n            {\n              date: 1\n              isLast: false\n            }\n          ]\n        }\n        retentionScheduleWeekly: {\n          daysOfTheWeek: daysOfTheWeekForMontlyRetention\n          weeksOfTheMonth: weeksOfTheMonthForMonthlyRetention\n        }\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: monthlyRetentionDurationCount\n          durationType: 'Months'\n        }\n      }\n      yearlySchedule: {\n        retentionScheduleFormatType: 'Weekly'\n        monthsOfYear: monthsOfYear\n        retentionScheduleDaily: {\n          daysOfTheMonth: [\n            {\n              date: 1\n              isLast: false\n            }\n          ]\n        }\n        retentionScheduleWeekly: {\n          daysOfTheWeek: daysOfTheWeekForYearlyRetention\n          weeksOfTheMonth: weeksOfTheMonthForYearlyRetention\n        }\n        retentionTimes: scheduleRunTimes\n        retentionDuration: {\n          count: yearlyRetentionDurationCount\n          durationType: 'Years'\n        }\n      }\n      retentionPolicyType: 'LongTermRetentionPolicy'\n    }\n    timeZone: timeZone\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1274?"}, {"role": "assistant", "content": "@description('The name of the Azure Container Registry')\nparam AcrName string = 'cr${uniqueString(resourceGroup().id)}'\n\n@description('The location to deploy the resources to')\nparam location string = resourceGroup().location\n\n@description('The Git Repository URL, eg. https://github.com/YOURORG/YOURREPO.git')\nparam gitRepositoryUrl string = 'https://github.com/Azure-Samples/DotNet47WinContainerModernize.git'\n\n@description('The name of the repository branch to use')\nparam gitBranch string = 'main'\n\n@description('The directory in the repo that contains the dockerfile')\nparam gitRepoDirectory string = 'eShopLegacyWebFormsSolution'\n\n@description('The image name/path you want to create in ACR')\nparam imageName string = 'dotnet/framework/aspnet'\n\nparam imageTag string = '4.8-windowsservercore-ltsc2019'\n\n@description('The ACR compute platform needed to build the image')\nparam acrBuildPlatform string = 'windows'\n\nresource acr 'Microsoft.ContainerRegistry/registries@2021-12-01-preview' = {\n  name: AcrName\n  location: location\n  sku: {\n    name: 'Basic'\n  }\n}\n\nmodule buildAcrImage 'br/public:deployment-scripts/build-acr:1.0.1' = {\n  name: 'buildAcrImage-${replace(imageName,'/','-')}'\n  params: {\n    AcrName: acr.name\n    location: location\n    gitRepositoryUrl: gitRepositoryUrl\n    gitBranch: gitBranch\n    gitRepoDirectory: gitRepoDirectory\n    imageName: imageName\n    imageTag: imageTag\n    acrBuildPlatform: acrBuildPlatform\n  }\n}\n\noutput acrImage string = buildAcrImage.outputs.acrImage\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1275."}, {"role": "assistant", "content": "@description('The name of the Azure Container Registry')\nparam AcrName string = 'cr${uniqueString(resourceGroup().id)}'\n\n@description('The location to deploy the resources to')\nparam location string = resourceGroup().location\n\n@description('An array of fully qualified images names to import')\nparam images array = [\n  'docker.io/bitnami/external-dns:latest'\n]\n\nresource acr 'Microsoft.ContainerRegistry/registries@2021-12-01-preview' = {\n  name: AcrName\n  location: location\n  sku: {\n    name: 'Basic'\n  }\n}\n\nmodule acrImport 'br/public:deployment-scripts/import-acr:1.0.1' = {\n  name: 'ImportAcrImages'\n  params: {\n    acrName: acr.name\n    location: location\n    images: images\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1276."}, {"role": "assistant", "content": "param location string = resourceGroup().location\nparam appName string\n\n@allowed([\n  'mcr.microsoft.com/oss/nginx/nginx:1.9.15-alpine'\n  'mcr.microsoft.com/azuredocs/aci-helloworld:latest'\n])\nparam appImage string = 'mcr.microsoft.com/oss/nginx/nginx:1.9.15-alpine'\n\nresource aci 'Microsoft.ContainerInstance/containerGroups@2021-09-01' = {\n  name: appName\n  location: location\n  properties: {\n    containers:  [\n      {\n        name: 't1'\n        properties: {\n          image: appImage\n          resources: {\n            requests: {\n              cpu: 1\n              memoryInGB: 2\n            }\n          }\n          \n          ports: [\n            {\n              port: 80\n              protocol: 'TCP'\n            }\n          ]\n        }\n      }\n    ]\n    restartPolicy: 'OnFailure'\n    sku: 'Standard'\n    ipAddress: {\n      type:  'Public'\n      ports: [\n        {\n          port: 80\n          protocol: 'TCP'\n        }\n      ]\n    }\n    osType: 'Linux'\n  }\n}\n\noutput IpAddress string  = aci.properties.ipAddress.ip\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1277."}, {"role": "assistant", "content": "@description('The name of the Azure Application Gateway')\nparam agwName string = 'agw-${uniqueString(resourceGroup().id)}'\n\n@description('The name of the Azure Application Gateway Managed Identity')\nparam agwIdName string = 'id-${agwName}'\n\n@description('The name of the Azure Key Vault')\nparam akvName string\n\n@secure()\n@description('The URI of the frontend KeyVault Certificate Secret Id')\nparam frontEndCertificateSecretId string\n\n@description('This is the IP address the web application is hosted on')\nparam backendIpAddress string\n\n@description('The location to deploy the resources to')\nparam location string = resourceGroup().location\n\nvar appgwSubnetAddress = '10.0.1.0/24'\nvar frontendAgwCertificateName = 'frontend'\n\nvar appgwResourceId = resourceId('Microsoft.Network/applicationGateways', '${agwName}')\nvar frontendAgwCertificateId = '${appgwResourceId}/sslCertificates/${frontendAgwCertificateName}'\n\nvar keyVaultSecretsUserRole = resourceId('Microsoft.Authorization/roleDefinitions', '4633458b-17de-408a-b874-0445c86b69e6')\n\nresource akv 'Microsoft.KeyVault/vaults@2021-11-01-preview' existing = {\n  name: akvName\n}\n\nresource vnet 'Microsoft.Network/virtualNetworks@2021-05-01' = {\n  name: 'vnet-${uniqueString(resourceGroup().id)}'\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        appgwSubnetAddress\n      ]\n    }\n    subnets: [\n      {\n        name: 'agw'\n        properties: {\n          addressPrefix: appgwSubnetAddress\n        }\n      }\n    ]\n  }\n}\n\nresource agwId 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\n  name: agwIdName\n  location: location\n}\n\nresource agw 'Microsoft.Network/applicationGateways@2021-08-01' = {\n  name: agwName\n  location: location\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${agwId.id}': {}\n    }\n  }\n  dependsOn: [\n    rbacPropagationDelay\n  ]\n  properties: {\n      sslCertificates: [\n        {\n          name: frontendAgwCertificateName\n          properties: {\n            keyVaultSecretId: frontEndCertificateSecretId\n          }\n        }\n      ]\n      sku: {\n        capacity: 1\n        tier: 'Standard_v2'\n        name: 'Standard_v2'\n      }\n      gatewayIPConfigurations: [\n        {\n          name: 'besubnet'\n          properties: {\n            subnet: {\n              id: vnet.properties.subnets[0].id\n            }\n          }\n        }\n      ]\n      frontendIPConfigurations: [{\n        properties: {\n          publicIPAddress: {\n            id: appgwpip.id\n          }\n        }\n        name: 'appGatewayFrontendIP'\n      }]\n      frontendPorts: [\n        {\n          name: 'appGatewayFrontendPort'\n          properties: {\n            port: 443\n          }\n        }\n      ]\n      backendAddressPools: [\n        {\n          name: 'defaultaddresspool'\n          properties: {\n            backendAddresses: [\n              {\n                ipAddress: backendIpAddress\n              }\n            ]\n          }\n        }\n      ]\n      backendHttpSettingsCollection: [\n        {\n          name: 'defaulthttpsetting'\n          properties: {\n            port: 80\n            protocol: 'Http'\n            cookieBasedAffinity: 'Disabled'\n            requestTimeout: 30\n            pickHostNameFromBackendAddress: true\n          }\n        }\n      ]\n      httpListeners: [\n        {\n          name: 'hlisten'\n          properties: {\n            frontendIPConfiguration: {\n              id: '${appgwResourceId}/frontendIPConfigurations/appGatewayFrontendIP'\n            }\n            frontendPort: {\n              id: '${appgwResourceId}/frontendPorts/appGatewayFrontendPort'\n            }\n            protocol: 'Https'\n            sslCertificate: {\n              id: frontendAgwCertificateId\n            }\n          }\n        }\n      ]\n      requestRoutingRules: [\n        {\n          name: 'appGwRoutingRuleName'\n          properties: {\n            ruleType: 'Basic'\n            priority: 100\n            httpListener: {\n              id: '${appgwResourceId}/httpListeners/hlisten'\n            }\n            backendAddressPool: {\n              id: '${appgwResourceId}/backendAddressPools/defaultaddresspool'\n            }\n            backendHttpSettings: {\n              id: '${appgwResourceId}/backendHttpSettingsCollection/defaulthttpsetting'\n            }\n          }\n        }\n      ]\n  }\n}\n\nresource appgwpip 'Microsoft.Network/publicIPAddresses@2020-07-01' = {\n  name: 'pip-${agwName}'\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n}\noutput agwPip string = appgwpip.properties.ipAddress\n\nresource kvAppGwSecretsUserRole 'Microsoft.Authorization/roleAssignments@2020-08-01-preview' = {\n  scope: akv\n  name: guid(agwId.id, akv.id, keyVaultSecretsUserRole)\n  properties: {\n    roleDefinitionId: keyVaultSecretsUserRole\n    principalType: 'ServicePrincipal'\n    principalId: agwId.properties.principalId\n  }\n}\n\nmodule rbacPropagationDelay 'br/public:deployment-scripts/wait:1.0.1' = {\n  name: 'DeploymentDelay'\n  dependsOn: [\n    kvAppGwSecretsUserRole\n  ]\n  params: {\n    waitSeconds: 60\n    location: location\n  }\n}\n\noutput agwId string = agw.id\noutput agwName string = agw.name\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1278 please."}, {"role": "assistant", "content": "@description('The name of the Azure Application Gateway')\nparam AgwName string = 'agw-${uniqueString(resourceGroup().id)}'\n\n@description('The name of the Azure Key Vault')\nparam AkvName string = 'akv-${uniqueString(resourceGroup().id)}'\n\n@description('The name of the certificate to generate for the frontend AGW. Name will be used as a ARecord in a Private DNS zone.')\nparam FrontendCertificateName string = 'frontend'\n\n@description('The location to deploy the resources to')\nparam Location string = resourceGroup().location\n\n@description('The name of the DNS Private Zone to create')\nparam DnsPrivateZoneName string = 'Contoso.local'\n\nvar FrontendCertificateFqdn = '${FrontendCertificateName}.${DnsPrivateZoneName}'\n\nresource dns 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: DnsPrivateZoneName\n  location: 'global'\n  \n  resource frontend 'A@2020-06-01' = {\n    name: FrontendCertificateName\n    properties: {\n      ttl: 60\n      aRecords: [\n        {\n          ipv4Address: agw.outputs.agwPip\n        }\n      ]\n    }\n  }\n  \n  resource appdirect 'A@2020-06-01' = {\n    name: 'appdirect'\n    properties: {\n      ttl: 60\n      aRecords: [\n        {\n          ipv4Address: app.outputs.IpAddress\n        }\n      ]\n    }\n  }\n}\n\nresource akv 'Microsoft.KeyVault/vaults@2021-11-01-preview' = {\n  name: AkvName\n  location: Location\n  properties: {\n    sku: {\n      family: 'A'\n      name: 'standard'\n    }\n    tenantId: subscription().tenantId\n    enableSoftDelete: false\n    enableRbacAuthorization: true\n    accessPolicies: []\n  }\n}\n\nmodule akvCertFrontend 'br/public:deployment-scripts/create-kv-certificate:1.1.1' = {\n  name: 'CreateFeKvCert'\n  params: {\n    akvName: akv.name\n    certificateName: FrontendCertificateName\n    certificateCommonName: FrontendCertificateFqdn\n  }\n}\n\nmodule agw 'appgw.bicep' = {\n  name: AgwName\n  params: {\n    location: Location\n    akvName: akv.name\n    frontEndCertificateSecretId: akvCertFrontend.outputs.certificateSecretIdUnversioned\n    backendIpAddress: app.outputs.IpAddress\n  }\n}\n\n@description('This is just a *random* sample app to sit behind the Application Gateway.')\nmodule app 'aciApp.bicep' = {\n  name: 'sampleWebApplication'\n  params: {\n    appName: 'SampleWebApp'\n    location: Location\n  }\n}\n\noutput FrontendPrivateDnsFqdn string = FrontendCertificateFqdn\noutput ApplicationGatewayPublicIp string = agw.outputs.agwPip\noutput KeyVaultName string = akv.name\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1279?"}, {"role": "assistant", "content": "@description('The name of the user-assigned managed identity that has permission to create Azure AD applications.')\nparam managedIdentityName string\n\n@description('The name of the resource group that contains the user-assigned managed identity.')\nparam managedIdentityResourceGroupName string = resourceGroup().name\n\n@description('The display name of the application to create in Azure AD.')\nparam azureADApplicationName string\n\n@description('The location that the Azure resources should be deployed to.')\nparam location string = resourceGroup().location\n\nresource managedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2022-01-31-preview' existing = {\n  name: managedIdentityName\n  scope: resourceGroup(managedIdentityResourceGroupName)\n}\n\nresource createAzureADApplicationScript 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\n  name: 'createAzureADApplication'\n  location: location\n  kind: 'AzureCLI'\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${managedIdentity.id}': {}\n    }\n  }\n  properties: {\n    forceUpdateTag: '1'\n    azCliVersion: '2.40.0'\n    environmentVariables: [\n      {\n        name: 'AzureADApplicationName'\n        value: azureADApplicationName\n      }\n    ]\n    scriptContent: loadTextContent('scripts/create-application.sh')\n    timeout: 'PT30M'\n    cleanupPreference: 'OnSuccess'\n    retentionInterval: 'P1D'\n  }\n}\n\noutput applicationObjectId string = createAzureADApplicationScript.properties.outputs.applicationObjectId\noutput applicationClientId string = createAzureADApplicationScript.properties.outputs.applicationClientId\noutput servicePrincipalObjectId string = createAzureADApplicationScript.properties.outputs.servicePrincipalObjectId\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1280."}, {"role": "assistant", "content": "@description('An example of a boolean parameter')\nparam myBool bool\n\n@description('An example of an integer parameter')\nparam myInt int\n\n@description('An example of a string parameter')\nparam myString string\n\n@description('An example of an array parameter')\nparam myArray array\n\n@description('An example of an object parameter')\nparam myObject object\n\nvar scriptArguments = [\n  /*myBool*/ myBool ? 'true' : 'false'\n  /*myInt*/ '${myInt}'\n  /*myString*/ '\"${replace(myString, '\"', '\\\\\"')}\"'\n  /*myArray*/ '\"${replace(string(myArray), '\"', '\\\\\"')}\"'\n  /*myObject*/ '\"${replace(string(myObject), '\"', '\\\\\"')}\"'\n]\nvar scriptContent = loadTextContent('./script.sh')\n\nresource myScript 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\n  name: 'myScript'\n#disable-next-line no-loc-expr-outside-params\n  location: resourceGroup().location\n  kind: 'AzureCLI'\n  properties: {\n    azCliVersion: '2.50.0'\n    retentionInterval: 'PT1H'\n    scriptContent: scriptContent\n    arguments: join(scriptArguments, ' ')\n  }\n}\n\nresource logs 'Microsoft.Resources/deploymentScripts/logs@2020-10-01' existing = {\n  parent: myScript\n  name: 'default'\n}\n\n@description('The logs written by the script')\noutput logs array = split(logs.properties.log, '\\n')\n\n@description('An example of a boolean output')\noutput myBool bool = myScript.properties.outputs.myBool\n\n@description('An example of an integer output')\noutput myInt int = myScript.properties.outputs.myInt\n\n@description('An example of a string output')\noutput myString string = myScript.properties.outputs.myString\n\n@description('An example of an array output')\noutput myArray array = myScript.properties.outputs.myArray\n\n@description('An example of an object output')\noutput myObject object = myScript.properties.outputs.myObject\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1281?"}, {"role": "assistant", "content": "@description('An example of a boolean parameter')\nparam myBool bool\n\n@description('An example of an integer parameter')\nparam myInt int\n\n@description('An example of a string parameter')\nparam myString string\n\n@description('An example of an array parameter')\nparam myArray array\n\n@description('An example of an object parameter')\nparam myObject object\n\nvar scriptArguments = {\n  myBool: myBool ? '$True' : '$False'\n  myInt: '${myInt}'\n  myString: '\\'${replace(replace(myString, '\\'', '\\\\\\''), '\"', '\\\\\"')}\\''\n  myArray: '(ConvertFrom-Json \\'${replace(replace(string(myArray), '\\'', '\\\\\\''), '\"', '\\\\\"')}\\')'\n  myObject: '(ConvertFrom-Json \\'${replace(replace(string(myObject), '\\'', '\\\\\\''), '\"', '\\\\\"')}\\')'\n}\nvar scriptContent = loadTextContent('./script.ps1')\n\nresource myScript 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\n  name: 'myScript'\n#disable-next-line no-loc-expr-outside-params\n  location: resourceGroup().location\n  kind: 'AzurePowerShell'\n  properties: {\n    azPowerShellVersion: '10.1'\n    retentionInterval: 'PT1H'\n    scriptContent: scriptContent\n    arguments: join(map(items(scriptArguments), arg => '-${arg.key} ${arg.value}'), ' ')\n  }\n}\n\nresource logs 'Microsoft.Resources/deploymentScripts/logs@2020-10-01' existing = {\n  parent: myScript\n  name: 'default'\n}\n\n@description('The logs written by the script')\noutput logs array = split(logs.properties.log, '\\n')\n\n@description('An example of a boolean output')\noutput myBool bool = myScript.properties.outputs.myBool\n\n@description('An example of an integer output')\noutput myInt int = myScript.properties.outputs.myInt\n\n@description('An example of a string output')\noutput myString string = myScript.properties.outputs.myString\n\n@description('An example of an array output')\noutput myArray array = myScript.properties.outputs.myArray\n\n@description('An example of an object output')\noutput myObject object = myScript.properties.outputs.myObject\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1282."}, {"role": "assistant", "content": "@description('Service name must only contain lowercase letters, digits or dashes, cannot use dash as the first two or last one characters, cannot contain consecutive dashes, and is limited between 2 and 60 characters in length.')\n@minLength(2)\n@maxLength(60)\nparam name string\n\n@allowed([\n  'free'\n  'basic'\n  'standard'\n  'standard2'\n  'standard3'\n  'storage_optimized_l1'\n  'storage_optimized_l2'\n])\n@description('The pricing tier of the search service you want to create (for example, basic or standard).')\nparam sku string = 'standard'\n\n@description('Replicas distribute search workloads across the service. You need at least two replicas to support high availability of query workloads (not applicable to the free tier).')\n@minValue(1)\n@maxValue(12)\nparam replicaCount int = 1\n\n@description('Partitions allow for scaling of document count as well as faster indexing by sharding your index over multiple search units.')\n@allowed([\n  1\n  2\n  3\n  4\n  6\n  12\n])\nparam partitionCount int = 1\n\n@description('Applicable only for SKUs set to standard3. You can set this property to enable a single, high density partition that allows up to 1000 indexes, which is much higher than the maximum indexes allowed for any other SKU.')\n@allowed([\n  'default'\n  'highDensity'\n])\nparam hostingMode string = 'default'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nresource search 'Microsoft.Search/searchServices@2020-08-01' = {\n  name: name\n  location: location\n  sku: {\n    name: sku\n  }\n  properties: {\n    replicaCount: replicaCount\n    partitionCount: partitionCount\n    hostingMode: hostingMode\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1283."}, {"role": "assistant", "content": "@minLength(3)\n@maxLength(24)\nparam automationName string\n\n@description('Location for the automation')\nparam location string = resourceGroup().location\n\n@minLength(3)\nparam logicAppName string\n\n@minLength(3)\nparam logicAppResourceGroupName string\n\n@description('The Azure resource GUID id of the subscription')\nparam subscriptionId string = subscription().subscriptionId\n\n@description('The alert settings object used for deploying the automation')\nparam alertSettings object\n\nvar automationDescription = 'automation description for subscription {0}'\nvar scopeDescription = 'automation scope for subscription {0}'\n\nresource automation 'Microsoft.Security/automations@2019-01-01-preview' = {\n  name: automationName\n  location: location\n  properties: {\n    description: format(automationDescription, subscriptionId)\n    isEnabled: true\n    actions: [\n      {\n        actionType: 'LogicApp'\n        logicAppResourceId: resourceId('Microsoft.Logic/workflows', logicAppName)\n        uri: listCallbackURL(resourceId(subscriptionId, logicAppResourceGroupName, 'Microsoft.Logic/workflows/triggers', logicAppName, 'manual'), '2019-05-01').value\n      }\n    ]\n    scopes: [\n      {\n        description: format(scopeDescription, subscriptionId)\n        scopePath: subscription().id\n      }\n    ]\n    sources: [\n      {\n        eventSource: 'Alerts'\n        ruleSets: [for j in range(0, length(alertSettings.alertSeverityMapping)): {\n          rules: [\n            {\n              propertyJPath: alertSettings.alertSeverityMapping[j].jpath\n              propertyType: 'String'\n              expectedValue: alertSettings.alertSeverityMapping[j].expectedValue\n              operator: alertSettings.alertSeverityMapping[j].operator\n            }\n            {\n              propertyJPath: 'Severity'\n              propertyType: 'String'\n              expectedValue: alertSettings.alertSeverityMapping[j].severity\n              operator: 'Equals'\n            }\n          ]\n        }]\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1284?"}, {"role": "assistant", "content": "@description('Name of the Service Bus namespace')\nparam serviceBusNamespaceName string\n\n@description('Name of the Queue')\nparam serviceBusQueueName string\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nresource serviceBusNamespace 'Microsoft.ServiceBus/namespaces@2022-01-01-preview' = {\n  name: serviceBusNamespaceName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {}\n}\n\nresource serviceBusQueue 'Microsoft.ServiceBus/namespaces/queues@2022-01-01-preview' = {\n  parent: serviceBusNamespace\n  name: serviceBusQueueName\n  properties: {\n    lockDuration: 'PT5M'\n    maxSizeInMegabytes: 1024\n    requiresDuplicateDetection: false\n    requiresSession: false\n    defaultMessageTimeToLive: 'P10675199DT2H48M5.4775807S'\n    deadLetteringOnMessageExpiration: false\n    duplicateDetectionHistoryTimeWindow: 'PT10M'\n    maxDeliveryCount: 10\n    autoDeleteOnIdle: 'P10675199DT2H48M5.4775807S'\n    enablePartitioning: false\n    enableExpress: false\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1285."}, {"role": "assistant", "content": "@description('Name of the Service Bus namespace')\nparam serviceBusNamespaceName string\n\n@description('Name of the Virtual Network Rule')\nparam vnetRuleName string\n\n@description('Name of the Virtual Network Sub Net')\nparam subnetName string\n\n@description('Location for Namespace')\nparam location string = resourceGroup().location\n\nresource serviceBusNamespace 'Microsoft.ServiceBus/namespaces@2017-04-01' = {\n  name: serviceBusNamespaceName\n  location: location\n  sku: {\n    name: 'Premium'\n    tier: 'Premium'\n  }\n  properties: {}\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2021-02-01' = {\n  name: '${vnetRuleName}-vn'\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/23'\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: '10.0.0.0/23'\n          serviceEndpoints: [\n            {\n              service: 'Microsoft.ServiceBus'\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource namespaceVirtualNetworkRule 'Microsoft.ServiceBus/namespaces/virtualnetworkrules@2018-01-01-preview' = {\n  parent: serviceBusNamespace\n  name: vnetRuleName\n  properties: {\n    virtualNetworkSubnetId: resourceId('Microsoft.Network/virtualNetworks/subnets',virtualNetwork.name ,subnetName)\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1286."}, {"role": "assistant", "content": "@description('Location of the Cluster')\nparam location string = resourceGroup().location\n\n@description('Name of your cluster - Between 3 and 23 characters. Letters and numbers only')\nparam clusterName string\n\n@description('Remote desktop user Id')\nparam adminUsername string\n\n@description('Remote desktop user password. Must be a strong password')\n@secure()\nparam adminPassword string\n\n@description('VM image Publisher')\nparam vmImagePublisher string = 'MicrosoftWindowsServer'\n\n@description('VM image offer')\nparam vmImageOffer string = 'WindowsServer'\n\n@description('VM image SKU')\nparam vmImageSku string = '2019-Datacenter'\n\n@description('VM image version')\nparam vmImageVersion string = 'latest'\n\n@description('Input endpoint1 for the application to use. Replace it with what your application uses')\nparam loadBalancedAppPort1 int = 80\n\n@description('Input endpoint2 for the application to use. Replace it with what your application uses')\nparam loadBalancedAppPort2 int = 8081\n\n@description('The store name where the cert will be deployed in the virtual machine')\n@allowed([\n  'My'\n])\nparam certificateStoreValue string = 'My'\n\n@description('Certificate Thumbprint')\nparam certificateThumbprint string\n\n@description('Resource Id of the key vault, is should be in the format of /subscriptions/<Sub ID>/resourceGroups/<Resource group name>/providers/Microsoft.KeyVault/vaults/<vault name>')\nparam sourceVaultResourceId string\n\n@description('Refers to the location URL in your key vault where the certificate was uploaded')\nparam certificateUrlValue string\n\n@description('Protection level.Three values are allowed - EncryptAndSign, Sign, None. It is best to keep the default of EncryptAndSign, unless you have a need not to')\n@allowed([\n  'None'\n  'Sign'\n  'EncryptAndSign'\n])\nparam clusterProtectionLevel string = 'EncryptAndSign'\n\n@description('Instance count for node type')\nparam nt0InstanceCount int = 5\n\n@description('The drive to use to store data on a cluster node.')\n@allowed([\n  'OS'\n  'Temp'\n])\nparam nodeDataDrive string = 'Temp'\n\n@description('The VM size to use for cluster nodes.')\nparam nodeTypeSize string = 'Standard_D2_v3'\n\nparam tenantId string\nparam clusterApplication string\nparam clientapplication string\n\nvar dnsName = clusterName\nvar vmName = 'vm'\nvar virtualNetworkName = 'VNet'\nvar addressPrefix = '10.0.0.0/16'\nvar nicName = 'NIC'\nvar lbIPName = 'PublicIP-LB-FE'\nvar overProvision = false\nvar nt0applicationStartPort = 20000\nvar nt0applicationEndPort = 30000\nvar nt0ephemeralStartPort = 49152\nvar nt0ephemeralEndPort = 65534\nvar nt0fabricTcpGatewayPort = 19000\nvar nt0fabricHttpGatewayPort = 19080\nvar subnet0Name = 'Subnet-0'\nvar subnet0Prefix = '10.0.0.0/24'\nvar subnet0Ref = resourceId('Microsoft.Network/virtualNetworks/subnets/', virtualNetworkName, subnet0Name)\nvar supportLogStorageAccountName = '${uniqueString(resourceGroup().id)}2'\nvar applicationDiagnosticsStorageAccountName = '${uniqueString(resourceGroup().id)}3'\nvar lbName = 'LB-${clusterName}-${vmNodeType0Name}'\nvar lbIPConfig0 = resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations/', lbName, 'LoadBalancerIPConfig')\nvar lbPoolID0 = resourceId('Microsoft.Network/loadBalancers/backendAddressPools', lbName, 'LoadBalancerBEAddressPool')\nvar lbProbeID0 = resourceId('Microsoft.Network/loadBalancers/probes', lbName, 'FabricGatewayProbe')\nvar lbHttpProbeID0 = resourceId('Microsoft.Network/loadBalancers/probes', lbName, 'FabricHttpGatewayProbe')\nvar lbNatPoolID0 = resourceId('Microsoft.Network/loadBalancers/inboundNatPools', lbName, 'LoadBalancerBEAddressNatPool')\nvar vmNodeType0Name = toLower('NT1${vmName}')\nvar vmNodeType0Size = nodeTypeSize\n\nresource supportLogStorageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: supportLogStorageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'Storage'\n  tags: {\n    resourceType: 'Service Fabric'\n    clusterName: clusterName\n  }\n  properties: {}\n}\n\nresource applicationDiagnosticsStorageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: applicationDiagnosticsStorageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'Storage'\n  tags: {\n    resourceType: 'Service Fabric'\n    clusterName: clusterName\n  }\n  properties: {}\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2023-09-01' = {\n  name: virtualNetworkName\n  location: location\n  tags: {\n    resourceType: 'Service Fabric'\n    clusterName: clusterName\n  }\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        addressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnet0Name\n        properties: {\n          addressPrefix: subnet0Prefix\n        }\n      }\n    ]\n  }\n}\n\nresource lbIP 'Microsoft.Network/publicIPAddresses@2023-09-01' = {\n  name: lbIPName\n  location: location\n  tags: {\n    resourceType: 'Service Fabric'\n    clusterName: clusterName\n  }\n  properties: {\n    dnsSettings: {\n      domainNameLabel: dnsName\n    }\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n\nresource lb 'Microsoft.Network/loadBalancers@2023-09-01' = {\n  name: lbName\n  location: location\n  tags: {\n    resourceType: 'Service Fabric'\n    clusterName: clusterName\n  }\n  properties: {\n    frontendIPConfigurations: [\n      {\n        name: 'LoadBalancerIPConfig'\n        properties: {\n          publicIPAddress: {\n            id: lbIP.id\n          }\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: 'LoadBalancerBEAddressPool'\n        properties: {}\n      }\n    ]\n    loadBalancingRules: [\n      {\n        name: 'LBRule'\n        properties: {\n          backendAddressPool: {\n            id: lbPoolID0\n          }\n          backendPort: nt0fabricTcpGatewayPort\n          enableFloatingIP: false\n          frontendIPConfiguration: {\n            id: lbIPConfig0\n          }\n          frontendPort: nt0fabricTcpGatewayPort\n          idleTimeoutInMinutes: 5\n          probe: {\n            id: lbProbeID0\n          }\n          protocol: 'Tcp'\n        }\n      }\n      {\n        name: 'LBHttpRule'\n        properties: {\n          backendAddressPool: {\n            id: lbPoolID0\n          }\n          backendPort: nt0fabricHttpGatewayPort\n          enableFloatingIP: false\n          frontendIPConfiguration: {\n            id: lbIPConfig0\n          }\n          frontendPort: nt0fabricHttpGatewayPort\n          idleTimeoutInMinutes: 5\n          probe: {\n            id: lbHttpProbeID0\n          }\n          protocol: 'Tcp'\n        }\n      }\n      {\n        name: 'AppPortLBRule1'\n        properties: {\n          backendAddressPool: {\n            id: lbPoolID0\n          }\n          backendPort: loadBalancedAppPort1\n          enableFloatingIP: false\n          frontendIPConfiguration: {\n            id: lbIPConfig0\n          }\n          frontendPort: loadBalancedAppPort1\n          idleTimeoutInMinutes: 5\n          probe: {\n            id: resourceId('Microsoft.Network/loadBalancers/probes', lbName, 'AppPortProbe1')\n          }\n          protocol: 'Tcp'\n        }\n      }\n      {\n        name: 'AppPortLBRule2'\n        properties: {\n          backendAddressPool: {\n            id: lbPoolID0\n          }\n          backendPort: loadBalancedAppPort2\n          enableFloatingIP: false\n          frontendIPConfiguration: {\n            id: lbIPConfig0\n          }\n          frontendPort: loadBalancedAppPort2\n          idleTimeoutInMinutes: 5\n          probe: {\n            id: resourceId('Microsoft.Network/loadBalancers/probes', lbName, 'AppPortProbe2')\n          }\n          protocol: 'Tcp'\n        }\n      }\n    ]\n    probes: [\n      {\n        name: 'FabricGatewayProbe'\n        properties: {\n          intervalInSeconds: 5\n          numberOfProbes: 2\n          port: nt0fabricTcpGatewayPort\n          protocol: 'Tcp'\n        }\n      }\n      {\n        name: 'FabricHttpGatewayProbe'\n        properties: {\n          intervalInSeconds: 5\n          numberOfProbes: 2\n          port: nt0fabricHttpGatewayPort\n          protocol: 'Tcp'\n        }\n      }\n      {\n        name: 'AppPortProbe1'\n        properties: {\n          intervalInSeconds: 5\n          numberOfProbes: 2\n          port: loadBalancedAppPort1\n          protocol: 'Tcp'\n        }\n      }\n      {\n        name: 'AppPortProbe2'\n        properties: {\n          intervalInSeconds: 5\n          numberOfProbes: 2\n          port: loadBalancedAppPort2\n          protocol: 'Tcp'\n        }\n      }\n    ]\n    inboundNatPools: [\n      {\n        name: 'LoadBalancerBEAddressNatPool'\n        properties: {\n          backendPort: 3389\n          frontendIPConfiguration: {\n            id: lbIPConfig0\n          }\n          frontendPortRangeEnd: 4500\n          frontendPortRangeStart: 3389\n          protocol: 'Tcp'\n        }\n      }\n    ]\n  }\n}\n\nresource vmNodeType0 'Microsoft.Compute/virtualMachineScaleSets@2023-09-01' = {\n  name: vmNodeType0Name\n  location: location\n  sku: {\n    name: vmNodeType0Size\n    capacity: nt0InstanceCount\n    tier: 'Standard'\n  }\n  tags: {\n    resourceType: 'Service Fabric'\n    clusterName: clusterName\n  }\n  properties: {\n    overprovision: overProvision\n    upgradePolicy: {\n      mode: 'Automatic'\n    }\n    virtualMachineProfile: {\n      extensionProfile: {\n        extensions: [\n          {\n            name: 'ServiceFabricNodeVmExt_vmNodeType0Name'\n            properties: {\n              type: 'ServiceFabricNode'\n              autoUpgradeMinorVersion: true\n              protectedSettings: {\n                StorageAccountKey1:  supportLogStorageAccount.listKeys().keys[0].value\n                StorageAccountKey2: supportLogStorageAccount.listkeys().keys[1].value\n              }\n              publisher: 'Microsoft.Azure.ServiceFabric'\n              settings: {\n                clusterEndpoint: cluster.properties.clusterEndpoint\n                nodeTypeRef: vmNodeType0Name\n                dataPath: '${((nodeDataDrive == 'OS') ? 'C' : 'D')}:\\\\\\\\SvcFab'\n                durabilityLevel: 'Silver'\n                nicPrefixOverride: subnet0Prefix\n                certificate: {\n                  thumbprint: certificateThumbprint\n                  x509StoreName: certificateStoreValue\n                }\n              }\n              typeHandlerVersion: '1.0'\n            }\n          }\n          {\n            name: 'VMDiagnosticsVmExt_vmNodeType0Name'\n            properties: {\n              type: 'IaaSDiagnostics'\n              autoUpgradeMinorVersion: true\n              protectedSettings: {\n                storageAccountName: applicationDiagnosticsStorageAccountName\n                storageAccountKey: listKeys(applicationDiagnosticsStorageAccount.id, '2021-01-01').keys[0].value\n                storageAccountEndPoint: 'https://${environment().suffixes.storage}'\n              }\n              publisher: 'Microsoft.Azure.Diagnostics'\n              settings: {\n                WadCfg: {\n                  DiagnosticMonitorConfiguration: {\n                    overallQuotaInMB: '50000'\n                    EtwProviders: {\n                      EtwEventSourceProviderConfiguration: [\n                        {\n                          provider: 'Microsoft-ServiceFabric-Actors'\n                          scheduledTransferKeywordFilter: '1'\n                          scheduledTransferPeriod: 'PT5M'\n                          DefaultEvents: {\n                            eventDestination: 'ServiceFabricReliableActorEventTable'\n                          }\n                        }\n                        {\n                          provider: 'Microsoft-ServiceFabric-Services'\n                          scheduledTransferPeriod: 'PT5M'\n                          DefaultEvents: {\n                            eventDestination: 'ServiceFabricReliableServiceEventTable'\n                          }\n                        }\n                      ]\n                      EtwManifestProviderConfiguration: [\n                        {\n                          provider: 'cbd93bc2-71e5-4566-b3a7-595d8eeca6e8'\n                          scheduledTransferLogLevelFilter: 'Information'\n                          scheduledTransferKeywordFilter: '4611686018427387904'\n                          scheduledTransferPeriod: 'PT5M'\n                          DefaultEvents: {\n                            eventDestination: 'ServiceFabricSystemEventTable'\n                          }\n                        }\n                      ]\n                    }\n                  }\n                }\n                StorageAccount: applicationDiagnosticsStorageAccountName\n              }\n              typeHandlerVersion: '1.5'\n            }\n          }\n        ]\n      }\n      networkProfile: {\n        networkInterfaceConfigurations: [\n          {\n            name: '${nicName}-0'\n            properties: {\n              ipConfigurations: [\n                {\n                  name: '${nicName}-0'\n                  properties: {\n                    loadBalancerBackendAddressPools: [\n                      {\n                        id: lbPoolID0\n                      }\n                    ]\n                    loadBalancerInboundNatPools: [\n                      {\n                        id: lbNatPoolID0\n                      }\n                    ]\n                    subnet: {\n                      id: subnet0Ref\n                    }\n                  }\n                }\n              ]\n              primary: true\n            }\n          }\n        ]\n      }\n      osProfile: {\n        adminPassword: adminPassword\n        adminUsername: adminUsername\n        computerNamePrefix: vmNodeType0Name\n        secrets: [\n          {\n            sourceVault: {\n              id: sourceVaultResourceId\n            }\n            vaultCertificates: [\n              {\n                certificateStore: certificateStoreValue\n                certificateUrl: certificateUrlValue\n              }\n            ]\n          }\n        ]\n      }\n      storageProfile: {\n        imageReference: {\n          publisher: vmImagePublisher\n          offer: vmImageOffer\n          sku: vmImageSku\n          version: vmImageVersion\n        }\n        osDisk: {\n          managedDisk: {\n            storageAccountType: 'StandardSSD_LRS'\n          }\n          caching: 'ReadOnly'\n          createOption: 'FromImage'\n        }\n      }\n    }\n  }\n  dependsOn: [\n    virtualNetwork\n    lb\n  ]\n}\n\nresource cluster 'Microsoft.ServiceFabric/clusters@2023-11-01-preview' = {\n  name: clusterName\n  location: location\n  tags: {\n    resourceType: 'Service Fabric'\n    clusterName: clusterName\n  }\n  properties: {\n    azureActiveDirectory: {\n      clientApplication: clientapplication\n      clusterApplication: clusterApplication\n      tenantId: tenantId\n    }\n    certificate: {\n      thumbprint: certificateThumbprint\n      x509StoreName: certificateStoreValue\n    }\n    diagnosticsStorageAccountConfig: {\n      blobEndpoint: reference(supportLogStorageAccount.id, '2021-01-01').primaryEndpoints.blob\n      protectedAccountKeyName: 'StorageAccountKey1'\n      queueEndpoint: reference(supportLogStorageAccount.id, '2021-01-01').primaryEndpoints.queue\n      storageAccountName: supportLogStorageAccountName\n      tableEndpoint: reference(supportLogStorageAccount.id, '2021-01-01').primaryEndpoints.table\n    }\n    fabricSettings: [\n      {\n        parameters: [\n          {\n            name: 'ClusterProtectionLevel'\n            value: clusterProtectionLevel\n          }\n        ]\n        name: 'Security'\n      }\n    ]\n    managementEndpoint: 'https://${lbIP.properties.dnsSettings.fqdn}:${nt0fabricHttpGatewayPort}'\n    nodeTypes: [\n      {\n        name: vmNodeType0Name\n        applicationPorts: {\n          endPort: nt0applicationEndPort\n          startPort: nt0applicationStartPort\n        }\n        clientConnectionEndpointPort: nt0fabricTcpGatewayPort\n        durabilityLevel: 'Silver'\n        ephemeralPorts: {\n          endPort: nt0ephemeralEndPort\n          startPort: nt0ephemeralStartPort\n        }\n        httpGatewayEndpointPort: nt0fabricHttpGatewayPort\n        isPrimary: true\n        vmInstanceCount: nt0InstanceCount\n      }\n    ]\n    reliabilityLevel: 'Silver'\n    upgradeMode: 'Automatic'\n    vmImage: 'Windows'\n  }\n}\n\noutput location string = location\noutput name string = cluster.name\noutput resourceGroupName string = resourceGroup().name\noutput resourceId string = cluster.id\noutput clusterProperties object = cluster.properties\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1287."}, {"role": "assistant", "content": "@description('The globally unique name of the SignalR resource to create.')\nparam name string = uniqueString(resourceGroup().id)\n\n@description('Location for the SignalR resource.')\nparam location string = resourceGroup().location\n\n@description('The pricing tier of the SignalR resource.')\n@allowed([\n  'Free_F1'\n  'Standard_S1'\n  'Premium_P1'\n])\nparam pricingTier string = 'Standard_S1'\n\n@description('The number of SignalR Unit.')\n@allowed([\n  1\n  2\n  5\n  10\n  20\n  50\n  100\n])\nparam capacity int = 1\n\n@description('Visit https://github.com/Azure/azure-signalr/blob/dev/docs/faq.md#service-mode to understand SignalR Service Mode.')\n@allowed([\n  'Default'\n  'Serverless'\n  'Classic'\n])\nparam serviceMode string = 'Default'\n\nparam enableConnectivityLogs bool = true\n\nparam enableMessagingLogs bool = true\n\nparam enableLiveTrace bool = true\n\n@description('Set the list of origins that should be allowed to make cross-origin calls.')\nparam allowedOrigins array = [\n  '*'\n]\n\nresource signalR 'Microsoft.SignalRService/signalR@2022-02-01' = {\n  name: name\n  location: location\n  sku: {\n    capacity: capacity\n    name: pricingTier\n  }\n  kind: 'SignalR'\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    tls: {\n      clientCertEnabled: false\n    }\n    features: [\n      {\n        flag: 'ServiceMode'\n        value: serviceMode\n      }\n      {\n        flag: 'EnableConnectivityLogs'\n        value: string(enableConnectivityLogs)\n      }\n      {\n        flag: 'EnableMessagingLogs'\n        value: string(enableMessagingLogs)\n      }\n      {\n        flag: 'EnableLiveTrace'\n        value: string(enableLiveTrace)\n      }\n    ]\n    cors: {\n      allowedOrigins: allowedOrigins\n    }\n    networkACLs: {\n      defaultAction: 'Deny'\n      publicNetwork: {\n        allow: [\n          'ClientConnection'\n        ]\n      }\n      privateEndpoints: [\n        {\n          name: 'mySignalRService.1fa229cd-bf3f-47f0-8c49-afb36723997e'\n          allow: [\n            'ServerConnection'\n          ]\n        }\n      ]\n    }\n    upstream: {\n      templates: [\n        {\n          categoryPattern: '*'\n          eventPattern: 'connect,disconnect'\n          hubPattern: '*'\n          urlTemplate: 'https://example.com/chat/api/connect'\n        }\n      ]\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1288 please."}, {"role": "assistant", "content": "@description('The administrator username of the SQL logical server')\nparam sqlAdministratorLogin string\n\n@description('The administrator password of the SQL logical server.')\n@secure()\nparam sqlAdministratorLoginPassword string\n\n@description('Username for the Virtual Machine.')\nparam vmAdminUsername string\n\n@description('Password for the Virtual Machine. The password must be at least 12 characters long and have lower case, upper characters, digit and a special character (Regex match)')\n@secure()\nparam vmAdminPassword string\n\n@description('The size of the VM')\nparam VmSize string = 'Standard_D2_v3'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar vnetName = 'myVirtualNetwork'\nvar vnetAddressPrefix = '10.0.0.0/16'\nvar subnet1Prefix = '10.0.0.0/24'\nvar subnet1Name = 'mySubnet'\nvar sqlServerName = 'sqlserver${uniqueString(resourceGroup().id)}'\nvar databaseName = '${sqlServerName}/sample-db'\nvar privateEndpointName = 'myPrivateEndpoint'\nvar privateDnsZoneName = 'privatelink${environment().suffixes.sqlServerHostname}'\nvar pvtEndpointDnsGroupName = '${privateEndpointName}/mydnsgroupname'\nvar vmName = take('myVm${uniqueString(resourceGroup().id)}', 15)\nvar publicIpAddressName = '${vmName}PublicIP'\nvar networkInterfaceName = '${vmName}NetInt'\nvar osDiskType = 'StandardSSD_LRS'\n\nresource sqlServer 'Microsoft.Sql/servers@2021-11-01-preview' = {\n  name: sqlServerName\n  location: location\n  tags: {\n    displayName: sqlServerName\n  }\n  properties: {\n    administratorLogin: sqlAdministratorLogin\n    administratorLoginPassword: sqlAdministratorLoginPassword\n    version: '12.0'\n    publicNetworkAccess: 'Disabled'\n  }\n}\n\nresource database 'Microsoft.Sql/servers/databases@2021-11-01-preview' = {\n  name: databaseName\n  location: location\n  sku: {\n    name: 'Basic'\n    tier: 'Basic'\n    capacity: 5\n  }\n  tags: {\n    displayName: databaseName\n  }\n  properties: {\n    collation: 'SQL_Latin1_General_CP1_CI_AS'\n    maxSizeBytes: 104857600\n    sampleName: 'AdventureWorksLT'\n  }\n  dependsOn: [\n    sqlServer\n  ]\n}\n\nresource vnet 'Microsoft.Network/virtualNetworks@2021-05-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n  }\n}\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2021-05-01' = {\n  parent: vnet\n  name: subnet1Name\n  properties: {\n    addressPrefix: subnet1Prefix\n    privateEndpointNetworkPolicies: 'Disabled'\n  }\n}\n\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2021-05-01' = {\n  name: privateEndpointName\n  location: location\n  properties: {\n    subnet: {\n      id: subnet.id\n    }\n    privateLinkServiceConnections: [\n      {\n        name: privateEndpointName\n        properties: {\n          privateLinkServiceId: sqlServer.id\n          groupIds: [\n            'sqlServer'\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource privateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDnsZoneName\n  location: 'global'\n  properties: {}\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource privateDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateDnsZone\n  name: '${privateDnsZoneName}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n\nresource pvtEndpointDnsGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2021-05-01' = {\n  name: pvtEndpointDnsGroupName\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config1'\n        properties: {\n          privateDnsZoneId: privateDnsZone.id\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    privateEndpoint\n  ]\n}\n\nresource publicIpAddress 'Microsoft.Network/publicIPAddresses@2021-05-01' = {\n  name: publicIpAddressName\n  location: location\n  tags: {\n    displayName: publicIpAddressName\n  }\n  properties: {\n    publicIPAllocationMethod: 'Dynamic'\n  }\n}\n\nresource networkInterface 'Microsoft.Network/networkInterfaces@2021-05-01' = {\n  name: networkInterfaceName\n  location: location\n  tags: {\n    displayName: networkInterfaceName\n  }\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipConfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: publicIpAddress.id\n          }\n          subnet: {\n            id: subnet.id\n          }\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource vm 'Microsoft.Compute/virtualMachines@2021-11-01' = {\n  name: vmName\n  location: location\n  tags: {\n    displayName: vmName\n  }\n  properties: {\n    hardwareProfile: {\n      vmSize: VmSize\n    }\n    osProfile: {\n      computerName: vmName\n      adminUsername: vmAdminUsername\n      adminPassword: vmAdminPassword\n    }\n    storageProfile: {\n      imageReference: {\n        publisher: 'MicrosoftWindowsServer'\n        offer: 'WindowsServer'\n        sku: '2019-Datacenter'\n        version: 'latest'\n      }\n      osDisk: {\n        name: '${vmName}OsDisk'\n        caching: 'ReadWrite'\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: osDiskType\n        }\n        diskSizeGB: 128\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkInterface.id\n        }\n      ]\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1289?"}, {"role": "assistant", "content": "@description('Name of the SQL server')\nparam sqlServerName string = 'sql-${uniqueString(resourceGroup().id)}'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('The administrator username of the SQL Server.')\nparam sqlAdministratorLogin string\n\n@description('The administrator password of the SQL Server.')\n@secure()\nparam sqlAdministratorLoginPassword string\n\n@description('Log Analytics workspace name')\nparam omsWorkspaceName string = 'oms-${uniqueString(resourceGroup().id)}'\n\n@description('Specify the region for your OMS workspace')\nparam workspaceRegion string\n\n@description('Select the SKU for OMS workspace')\n@allowed([\n  'Free'\n  'Standalone'\n  'PerNode'\n])\nparam omsSku string = 'Free'\n\n@description('Enable Auditing of Microsoft support operations (DevOps)')\nparam isMSDevOpsAuditEnabled bool = false\n\nvar diagnosticSettingsName = 'SQLSecurityAuditEvents_3d229c42-c7e7-4c97-9a99-ec0d0d8b86c1'\n\nresource omsWorkspace 'Microsoft.OperationalInsights/workspaces@2020-08-01' = {\n  name: omsWorkspaceName\n  location: workspaceRegion\n  properties: {\n    sku: {\n      name: omsSku\n    }\n  }\n}\n\nresource sqlServer 'Microsoft.Sql/servers@2021-11-01-preview' = {\n  location: location\n  name: sqlServerName\n  properties: {\n    administratorLogin: sqlAdministratorLogin\n    administratorLoginPassword: sqlAdministratorLoginPassword\n    version: '12.0'\n  }\n  tags: {\n    DisplayName: sqlServerName\n  }\n}\n\nresource masterDb 'Microsoft.Sql/servers/databases@2021-11-01-preview' = {\n  parent: sqlServer\n  location: location\n  name: 'master'\n  properties: {}\n}\n\nresource diagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: masterDb\n  name: diagnosticSettingsName\n  properties: {\n    workspaceId: omsWorkspace.id\n    logs: [\n      {\n        category: 'SQLSecurityAuditEvents'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      }\n      {\n        category: 'DevOpsOperationsAudit'\n        enabled: true\n        retentionPolicy: {\n          days: 0\n          enabled: false\n        }\n      }\n    ]\n  }\n}\n\nresource auditingSettings 'Microsoft.Sql/servers/auditingSettings@2021-11-01-preview' = {\n  parent: sqlServer\n  name: 'default'\n  properties: {\n    state: 'Enabled'\n    isAzureMonitorTargetEnabled: true\n  }\n}\n\nresource devOpsAuditingSettings 'Microsoft.Sql/servers/devOpsAuditingSettings@2021-11-01-preview' = if (isMSDevOpsAuditEnabled) {\n  parent: sqlServer\n  name: 'default'\n  properties: {\n    state: 'Enabled'\n    isAzureMonitorTargetEnabled: true\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1290."}, {"role": "assistant", "content": "@description('The SQL Logical Server name.')\nparam sqlServerName string = 'sql${uniqueString(resourceGroup().id)}'\n\n@description('The administrator username of the SQL Server.')\nparam sqlAdministratorLogin string\n\n@description('The administrator password of the SQL Server.')\n@secure()\nparam sqlAdministratorPassword string\n\n@description('The name of the Database.')\nparam databasesName string\n\n@description('Enable/Disable Transparent Data Encryption')\n@allowed([\n  'Enabled'\n  'Disabled'\n])\nparam transparentDataEncryption string = 'Enabled'\n\n@description('DW Performance Level expressed in DTU (i.e. 900 DTU = DW100c)')\n@minValue(900)\n@maxValue(54000)\nparam capacity int\n\n@description('The SQL Database collation.')\nparam databaseCollation string = 'SQL_Latin1_General_CP1_CI_AS'\n\n@description('Resource location')\nparam location string = resourceGroup().location\n\nresource sqlServer 'Microsoft.Sql/servers@2023-08-01-preview' = {\n  name: sqlServerName\n  location: location\n  properties: {\n    administratorLogin: sqlAdministratorLogin\n    administratorLoginPassword: sqlAdministratorPassword\n    version: '12.0'\n    publicNetworkAccess: 'Enabled'\n    minimalTlsVersion: '1.2'\n    restrictOutboundNetworkAccess: 'Disabled'\n  }\n}\n\nresource sqlServerDatabase 'Microsoft.Sql/servers/databases@2023-08-01-preview' = {\n  parent: sqlServer\n  name: databasesName\n  location: location\n  sku: {\n    name: 'DataWarehouse'\n    tier: 'DataWarehouse'\n    capacity: capacity\n  }\n  properties: {\n    collation: databaseCollation\n    catalogCollation: databaseCollation\n    readScale: 'Disabled'\n    requestedBackupStorageRedundancy: 'Geo'\n    isLedgerOn: false\n  }\n}\n\nresource encryption 'Microsoft.Sql/servers/databases/transparentDataEncryption@2023-08-01-preview' = {\n  parent: sqlServerDatabase\n  name: 'current'\n  properties: {\n    state: transparentDataEncryption\n  }\n}\n\nresource securityAlertPolicy 'Microsoft.Sql/servers/securityAlertPolicies@2023-08-01-preview' = {\n  parent: sqlServer\n  name: 'default'\n  properties: {\n    state: 'Enabled'\n  }\n}\n\nresource auditingSetting 'Microsoft.Sql/servers/auditingSettings@2023-08-01-preview' = {\n  parent: sqlServer\n  name: 'default'\n  properties: {\n    isAzureMonitorTargetEnabled: true\n    state: 'Enabled'\n    retentionDays: 7\n    auditActionsAndGroups: [\n      'SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP'\n      'FAILED_DATABASE_AUTHENTICATION_GROUP'\n      'BATCH_COMPLETED_GROUP'\n    ]\n  }\n}\n\noutput location string = location\noutput name string = sqlServer.name\noutput resourceGroupName string = resourceGroup().name\noutput resourceId string = sqlServer.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1291?"}, {"role": "assistant", "content": "@description('The name of the SQL logical server.')\nparam serverName string = uniqueString('sql', resourceGroup().id)\n\n@description('The name of the SQL Database.')\nparam sqlDBName string = 'SampleDB'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('The administrator username of the SQL logical server.')\nparam administratorLogin string\n\n@description('The administrator password of the SQL logical server.')\n@secure()\nparam administratorLoginPassword string\n\nresource sqlServer 'Microsoft.Sql/servers@2022-05-01-preview' = {\n  name: serverName\n  location: location\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n  }\n}\n\nresource sqlDB 'Microsoft.Sql/servers/databases@2022-05-01-preview' = {\n  parent: sqlServer\n  name: sqlDBName\n  location: location\n  sku: {\n    name: 'Standard'\n    tier: 'Standard'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1292."}, {"role": "assistant", "content": "@description('The name of the SQL logical server.')\nparam serverName string = uniqueString('sql', resourceGroup().id)\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('The administrator username of the SQL logical server.')\nparam administratorLogin string\n\n@description('The administrator password of the SQL logical server.')\n@secure()\nparam administratorLoginPassword string\n\n@description('Enable Microsoft Defender for SQL, the user deploying the template must have an administrator or owner permissions.')\nparam enableSqlDefender bool = true\n\n@description('Allow Azure services to access server.')\nparam allowAzureIPs bool = true\n\n@description('SQL logical server connection type.')\n@allowed([\n  'Default'\n  'Redirect'\n  'Proxy'\n])\nparam connectionType string = 'Default'\n\nresource server 'Microsoft.Sql/servers@2022-05-01-preview' = {\n  name: serverName\n  location: location\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    version: '12.0'\n  }\n}\n\nresource firewallRule 'Microsoft.Sql/servers/firewallRules@2022-05-01-preview' = if (allowAzureIPs) {\n  parent: server\n  name: 'AllowAllWindowsAzureIps'\n  properties: {\n    endIpAddress: '0.0.0.0'\n    startIpAddress: '0.0.0.0'\n  }\n}\n\nresource protectionSetting 'Microsoft.Sql/servers/advancedThreatProtectionSettings@2022-05-01-preview' = if (enableSqlDefender) {\n  parent: server\n  name: 'Default'\n  properties: {\n    state: 'Enabled'\n  }\n}\n\nresource assessment 'Microsoft.Sql/servers/sqlVulnerabilityAssessments@2022-05-01-preview' = if (enableSqlDefender) {\n  parent: server\n  name: 'Default'\n  properties: {\n    state: 'Enabled'\n  }\n}\n\nresource connectionPolicy 'Microsoft.Sql/servers/connectionPolicies@2022-05-01-preview' = {\n  parent: server\n  name: 'Default'\n  properties: {\n    connectionType: connectionType\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1293."}, {"role": "assistant", "content": "@description('Enter managed instance name.')\nparam managedInstanceName string\n\n@description('Enter user name.')\nparam administratorLogin string\n\n@description('Enter password.')\n@secure()\nparam administratorLoginPassword string\n\n@description('Enter location. If you leave this field blank resource group location would be used.')\nparam location string = resourceGroup().location\n\n@description('Enter virtual network name. If you leave this field blank name will be created by the template.')\nparam virtualNetworkName string = 'SQLMI-VNET'\n\n@description('Enter virtual network address prefix.')\nparam addressPrefix string = '10.0.0.0/16'\n\n@description('Enter subnet name.')\nparam subnetName string = 'ManagedInstance'\n\n@description('Enter subnet address prefix.')\nparam subnetPrefix string = '10.0.0.0/24'\n\n@description('Enter sku name.')\n@allowed([\n  'GP_Gen5'\n  'BC_Gen5'\n])\nparam skuName string = 'GP_Gen5'\n\n@description('Enter number of vCores.')\n@allowed([\n  4\n  8\n  16\n  24\n  32\n  40\n  64\n  80\n])\nparam vCores int = 16\n\n@description('Enter storage size.')\n@minValue(32)\n@maxValue(8192)\nparam storageSizeInGB int = 256\n\n@description('Enter license type.')\n@allowed([\n  'BasePrice'\n  'LicenseIncluded'\n])\nparam licenseType string = 'LicenseIncluded'\n\nvar networkSecurityGroupName = 'SQLMI-${managedInstanceName}-NSG'\nvar routeTableName = 'SQLMI-${managedInstanceName}-Route-Table'\n\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2021-08-01' = {\n  name: networkSecurityGroupName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'allow_tds_inbound'\n        properties: {\n          description: 'Allow access to data'\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '1433'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 1000\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'allow_redirect_inbound'\n        properties: {\n          description: 'Allow inbound redirect traffic to Managed Instance inside the virtual network'\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '11000-11999'\n          sourceAddressPrefix: 'VirtualNetwork'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 1100\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'deny_all_inbound'\n        properties: {\n          description: 'Deny all other inbound traffic'\n          protocol: '*'\n          sourcePortRange: '*'\n          destinationPortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Deny'\n          priority: 4096\n          direction: 'Inbound'\n        }\n      }\n      {\n        name: 'deny_all_outbound'\n        properties: {\n          description: 'Deny all other outbound traffic'\n          protocol: '*'\n          sourcePortRange: '*'\n          destinationPortRange: '*'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Deny'\n          priority: 4096\n          direction: 'Outbound'\n        }\n      }\n    ]\n  }\n}\n\nresource routeTable 'Microsoft.Network/routeTables@2021-08-01' = {\n  name: routeTableName\n  location: location\n  properties: {\n    disableBgpRoutePropagation: false\n  }\n}\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2021-08-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        addressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: subnetPrefix\n          routeTable: {\n            id: routeTable.id\n          }\n          networkSecurityGroup: {\n            id: networkSecurityGroup.id\n          }\n          delegations: [\n            {\n              name: 'managedInstanceDelegation'\n              properties: {\n                serviceName: 'Microsoft.Sql/managedInstances'\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource managedInstance 'Microsoft.Sql/managedInstances@2021-11-01-preview' = {\n  name: managedInstanceName\n  location: location\n  sku: {\n    name: skuName\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  dependsOn: [\n    virtualNetwork\n  ]\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    subnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\n    storageSizeInGB: storageSizeInGB\n    vCores: vCores\n    licenseType: licenseType\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1294?"}, {"role": "assistant", "content": "@description('The name of the VM')\nparam virtualMachineName string = 'myVM'\n\n@description('The virtual machine size.')\nparam virtualMachineSize string = 'Standard_D8s_v3'\n\n@description('Specify the name of an existing VNet in the same resource group')\nparam existingVirtualNetworkName string\n\n@description('Specify the resrouce group of the existing VNet')\nparam existingVnetResourceGroup string = resourceGroup().name\n\n@description('Specify the name of the Subnet Name')\nparam existingSubnetName string\n\n@description('Windows Server and SQL Offer')\n@allowed([\n  'sql2019-ws2019'\n  'sql2017-ws2019'\n  'sql2019-ws2022'\n  'SQL2016SP1-WS2016'\n  'SQL2016SP2-WS2016'\n  'SQL2014SP3-WS2012R2'\n  'SQL2014SP2-WS2012R2'\n])\nparam imageOffer string = 'sql2019-ws2022'\n\n@description('SQL Server Sku')\n@allowed([\n  'standard-gen2'\n  'enterprise-gen2'\n  'SQLDEV-gen2'\n  'web-gen2'\n  'enterprisedbengineonly-gen2'\n])\nparam sqlSku string = 'standard-gen2'\n\n@description('The admin user name of the VM')\nparam adminUsername string\n\n@description('The admin password of the VM')\n@secure()\nparam adminPassword string\n\n@description('SQL Server Workload Type')\n@allowed([\n  'General'\n  'OLTP'\n  'DW'\n])\nparam storageWorkloadType string = 'General'\n\n@description('Amount of data disks (1TB each) for SQL Data files')\n@minValue(1)\n@maxValue(8)\nparam sqlDataDisksCount int = 1\n\n@description('Path for SQL Data files. Please choose drive letter from F to Z, and other drives from A to E are reserved for system')\nparam dataPath string = 'F:\\\\SQLData'\n\n@description('Amount of data disks (1TB each) for SQL Log files')\n@minValue(1)\n@maxValue(8)\nparam sqlLogDisksCount int = 1\n\n@description('Path for SQL Log files. Please choose drive letter from F to Z and different than the one used for SQL data. Drive letter from A to E are reserved for system')\nparam logPath string = 'G:\\\\SQLLog'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Security Type of the Virtual Machine.')\n@allowed([\n  'Standard'\n  'TrustedLaunch'\n])\nparam securityType string = 'TrustedLaunch'\n\nvar securityProfileJson = {\n  uefiSettings: {\n    secureBootEnabled: true\n    vTpmEnabled: true\n  }\n  securityType: securityType\n}\n\nvar networkInterfaceName = '${virtualMachineName}-nic'\nvar networkSecurityGroupName = '${virtualMachineName}-nsg'\nvar networkSecurityGroupRules = [\n  {\n    name: 'RDP'\n    properties: {\n      priority: 300\n      protocol: 'Tcp'\n      access: 'Allow'\n      direction: 'Inbound'\n      sourceAddressPrefix: '*'\n      sourcePortRange: '*'\n      destinationAddressPrefix: '*'\n      destinationPortRange: '3389'\n    }\n  }\n]\nvar publicIpAddressName = '${virtualMachineName}-publicip-${uniqueString(virtualMachineName)}'\nvar publicIpAddressType = 'Dynamic'\nvar publicIpAddressSku = 'Basic'\nvar diskConfigurationType = 'NEW'\nvar nsgId = networkSecurityGroup.id\nvar subnetRef = resourceId(existingVnetResourceGroup, 'Microsoft.Network/virtualNetWorks/subnets', existingVirtualNetworkName, existingSubnetName)\nvar dataDisksLuns = range(0, sqlDataDisksCount)\nvar logDisksLuns = range(sqlDataDisksCount, sqlLogDisksCount)\nvar dataDisks = {\n  createOption: 'Empty'\n  caching: 'ReadOnly'\n  writeAcceleratorEnabled: false\n  storageAccountType: 'Premium_LRS'\n  diskSizeGB: 1023\n}\nvar tempDbPath = 'D:\\\\SQLTemp'\nvar extensionName = 'GuestAttestation'\nvar extensionPublisher = 'Microsoft.Azure.Security.WindowsAttestation'\nvar extensionVersion = '1.0'\nvar maaTenantName = 'GuestAttestation'\n\nresource publicIpAddress 'Microsoft.Network/publicIPAddresses@2022-01-01' = {\n  name: publicIpAddressName\n  location: location\n  sku: {\n    name: publicIpAddressSku\n  }\n  properties: {\n    publicIPAllocationMethod: publicIpAddressType\n  }\n}\n\nresource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2022-01-01' = {\n  name: networkSecurityGroupName\n  location: location\n  properties: {\n    securityRules: networkSecurityGroupRules\n  }\n}\n\nresource networkInterface 'Microsoft.Network/networkInterfaces@2022-01-01' = {\n  name: networkInterfaceName\n  location: location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          subnet: {\n            id: subnetRef\n          }\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: publicIpAddress.id\n          }\n        }\n      }\n    ]\n    enableAcceleratedNetworking: true\n    networkSecurityGroup: {\n      id: nsgId\n    }\n  }\n}\n\nresource virtualMachine 'Microsoft.Compute/virtualMachines@2022-03-01' = {\n  name: virtualMachineName\n  location: location\n  properties: {\n    hardwareProfile: {\n      vmSize: virtualMachineSize\n    }\n    storageProfile: {\n      dataDisks: [for j in range(0, length(range(0, (sqlDataDisksCount + sqlLogDisksCount)))): {\n        lun: range(0, (sqlDataDisksCount + sqlLogDisksCount))[j]\n        createOption: dataDisks.createOption\n        caching: ((range(0, (sqlDataDisksCount + sqlLogDisksCount))[j] >= sqlDataDisksCount) ? 'None' : dataDisks.caching)\n        writeAcceleratorEnabled: dataDisks.writeAcceleratorEnabled\n        diskSizeGB: dataDisks.diskSizeGB\n        managedDisk: {\n          storageAccountType: dataDisks.storageAccountType\n        }\n      }]\n      osDisk: {\n        createOption: 'FromImage'\n        managedDisk: {\n          storageAccountType: 'Premium_LRS'\n        }\n      }\n      imageReference: {\n        publisher: 'MicrosoftSQLServer'\n        offer: imageOffer\n        sku: sqlSku\n        version: 'latest'\n      }\n    }\n    networkProfile: {\n      networkInterfaces: [\n        {\n          id: networkInterface.id\n        }\n      ]\n    }\n    osProfile: {\n      computerName: virtualMachineName\n      adminUsername: adminUsername\n      adminPassword: adminPassword\n      windowsConfiguration: {\n        enableAutomaticUpdates: true\n        provisionVMAgent: true\n      }\n    }\n    securityProfile: ((securityType == 'TrustedLaunch') ? securityProfileJson : null)\n  }\n}\n\nresource virtualMachineName_extension 'Microsoft.Compute/virtualMachines/extensions@2022-03-01' = if ((securityType == 'TrustedLaunch') && ((securityProfileJson.uefiSettings.secureBootEnabled == true) && (securityProfileJson.uefiSettings.vTpmEnabled == true))) {\n  parent: virtualMachine\n  name: extensionName\n  location: location\n  properties: {\n    publisher: extensionPublisher\n    type: extensionName\n    typeHandlerVersion: extensionVersion\n    autoUpgradeMinorVersion: true\n    enableAutomaticUpgrade: true\n    settings: {\n      AttestationConfig: {\n        MaaSettings: {\n          maaEndpoint: ''\n          maaTenantName: maaTenantName\n        }\n        AscSettings: {\n          ascReportingEndpoint: ''\n          ascReportingFrequency: ''\n        }\n        useCustomToken: 'false'\n        disableAlerts: 'false'\n      }\n    }\n  }\n}\n\nresource Microsoft_SqlVirtualMachine_sqlVirtualMachines_virtualMachine 'Microsoft.SqlVirtualMachine/sqlVirtualMachines@2022-07-01-preview' = {\n  name: virtualMachineName\n  location: location\n  properties: {\n    virtualMachineResourceId: virtualMachine.id\n    sqlManagement: 'Full'\n    sqlServerLicenseType: 'PAYG'\n    storageConfigurationSettings: {\n      diskConfigurationType: diskConfigurationType\n      storageWorkloadType: storageWorkloadType\n      sqlDataSettings: {\n        luns: dataDisksLuns\n        defaultFilePath: dataPath\n      }\n      sqlLogSettings: {\n        luns: logDisksLuns\n        defaultFilePath: logPath\n      }\n      sqlTempDbSettings: {\n        defaultFilePath: tempDbPath\n      }\n    }\n  }\n}\n\noutput adminUsername string = adminUsername\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1295."}, {"role": "assistant", "content": "@description('Storage Account type')\n@allowed([\n  'Premium_LRS'\n  'Premium_ZRS'\n  'Standard_GRS'\n  'Standard_GZRS'\n  'Standard_LRS'\n  'Standard_RAGRS'\n  'Standard_RAGZRS'\n  'Standard_ZRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('The storage account location.')\nparam location string = resourceGroup().location\n\n@description('The name of the storage account')\nparam storageAccountName string = 'store${uniqueString(resourceGroup().id)}'\n\nresource sa 'Microsoft.Storage/storageAccounts@2022-09-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'StorageV2'\n  properties: {}\n}\n\noutput storageAccountName string = storageAccountName\noutput storageAccountId string = sa.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1296."}, {"role": "assistant", "content": "@description('Storage Account type.')\n@allowed([\n  'Premium_LRS'\n  'Premium_ZRS'\n  'Standard_GRS'\n  'Standard_GZRS'\n  'Standard_LRS'\n  'Standard_RAGRS'\n  'Standard_RAGZRS'\n  'Standard_ZRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('Enable or disable Blob encryption at Rest.')\nparam blobEncryptionEnabled bool = true\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('The name of the Storage Account')\nparam storageAccountName string = 'store${uniqueString(resourceGroup().id)}'\n\nresource sa 'Microsoft.Storage/storageAccounts@2021-04-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'Storage'\n  properties: {\n    encryption: {\n      keySource: 'Microsoft.Storage'\n      services: {\n        blob: {\n          enabled: blobEncryptionEnabled\n        }\n      }\n    }\n  }\n}\n\noutput storageAccountName string = sa.name\noutput storageAccountId string = sa.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1297."}, {"role": "assistant", "content": "@description('The name must be unique across all existing storage account names in Azure. It must be 3 to 24 characters long, and can contain only lowercase letters and numbers.')\nparam storageAccountName string = 'store${uniqueString(resourceGroup().id)}'\n\n@description('Storage account location, default is same as resource group location.')\nparam location string = resourceGroup().location\n\n@description('Storage account replication, for more info see \\'https://docs.microsoft.com/en-us/azure/storage/common/storage-redundancy\\'.')\n@allowed([\n  'Premium_LRS'\n  'Premium_ZRS'\n  'Standard_GRS'\n  'Standard_GZRS'\n  'Standard_LRS'\n  'Standard_RAGRS'\n  'Standard_RAGZRS'\n  'Standard_ZRS'\n])\nparam storageAccountReplication string = 'Standard_LRS'\n\n@description('Enable or disable Advanced Threat Protection.')\nparam advancedThreatProtectionEnabled bool = true\n\nresource sa 'Microsoft.Storage/storageAccounts@2021-04-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountReplication\n  }\n  kind: 'StorageV2'\n  properties: {}\n}\n\nresource atpSettings 'Microsoft.Security/advancedThreatProtectionSettings@2019-01-01' = if (advancedThreatProtectionEnabled) {\n  name: 'current'\n  scope: sa\n  properties: {\n    isEnabled: true\n  }\n}\n\noutput storageAccountName string = storageAccountName\noutput storageAccountId string = sa.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1298 please."}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Storage account.')\nparam storageAccountName string\n\n@description('Specifies the name of the blob container.')\nparam containerName string\n\n@description('Specifies the location in which the Azure Storage resources should be deployed.')\nparam location string = resourceGroup().location\n\nresource sa 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    accessTier: 'Hot'\n  }\n}\n\nresource blobServices 'Microsoft.Storage/storageAccounts/blobServices@2023-01-01' = {\n  parent: sa\n  name: 'default'\n}\n\nresource container 'Microsoft.Storage/storageAccounts/blobServices/containers@2023-01-01' = {\n  parent: blobServices\n  name: containerName\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1299?"}, {"role": "assistant", "content": "@description('Storage account name')\nparam storageAccountName string = uniqueString(resourceGroup().id)\n\n@description('Storage account location')\nparam location string = resourceGroup().location\n\n@description('Storage account sku')\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n  'Standard_ZRS'\n  'Premium_LRS'\n  'Premium_ZRS'\n  'Standard_GZRS'\n  'Standard_RAGZRS'\n])\nparam storageSku string = 'Standard_LRS'\n\n@description('Storage account kind')\n@allowed([\n  'Storage'\n  'StorageV2'\n  'BlobStorage'\n  'FileStorage'\n  'BlockBlobStorage'\n])\nparam storageKind string = 'StorageV2'\n\n@description('Storage account access tier, Hot for frequently accessed data or Cool for infreqently accessed data')\n@allowed([\n  'Hot'\n  'Cool'\n])\nparam storageTier string = 'Hot'\n\n@description('Amount of days the soft deleted data is stored and available for recovery')\n@minValue(1)\n@maxValue(365)\nparam deleteRetentionPolicy int = 7\n\n@description('Enable blob encryption at rest')\nparam blobEncryptionEnabled bool = true\n\nresource storage 'Microsoft.Storage/storageAccounts@2021-04-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageSku\n  }\n  kind: storageKind\n  properties: {\n    accessTier: storageTier\n    encryption: {\n      keySource: 'Microsoft.Storage'\n      services: {\n        blob: {\n          enabled: blobEncryptionEnabled\n        }\n      }\n    }\n  }\n}\n\nresource blobServices 'Microsoft.Storage/storageAccounts/blobServices@2021-04-01' = {\n  parent: storage\n  name: 'default'\n  properties: {\n    deleteRetentionPolicy: {\n      enabled: true\n      days: deleteRetentionPolicy\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1300."}, {"role": "assistant", "content": "@description('The location into which the resources should be deployed.')\nparam location string = resourceGroup().location\n\n@description('The Tenant Id that should be used throughout the deployment.')\nparam tenantId string = subscription().tenantId\n\n@description('The name of the existing User Assigned Identity.')\nparam userAssignedIdentityName string\n\n@description('The name of the resource group for the User Assigned Identity.')\nparam userAssignedIdentityResourceGroupName string\n\n@description('The name of the Key Vault.')\nparam keyVaultName string  = 'vault-${uniqueString(resourceGroup().id)}'\n\n@description('Name of the key in the Key Vault')\nparam keyVaultKeyName string = 'cmkey'\n\n@description('Expiration time of the key')\nparam keyExpiration int = dateTimeToEpoch(dateTimeAdd(utcNow(), 'P1Y'))\n\n@description('The name of the Storage Account')\nparam storageAccountName string =  'storage${uniqueString(resourceGroup().id)}'\n\n\nresource userAssignedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' existing = {\n  scope: resourceGroup(userAssignedIdentityResourceGroupName)\n  name: userAssignedIdentityName  \n}\n\nresource keyVault 'Microsoft.KeyVault/vaults@2021-10-01' = {\n  name: keyVaultName\n  location: location\n  properties: {\n    sku: {\n      name: 'standard'\n      family: 'A'\n    }\n    enableSoftDelete: true\n    enablePurgeProtection: true\n    enabledForDiskEncryption: true\n    tenantId: tenantId\n    accessPolicies: [\n      {\n        tenantId: tenantId\n        permissions: {\n          keys: [\n            'unwrapKey'\n            'wrapKey'\n            'get'\n          ]\n        }\n        objectId: userAssignedIdentity.properties.principalId\n      }\n    ]\n  }\n}\n\nresource kvKey 'Microsoft.KeyVault/vaults/keys@2021-10-01' = {\n  parent: keyVault\n  name: keyVaultKeyName\n  properties: {\n    attributes: {\n      enabled: true\n      exp: keyExpiration\n    }\n    keySize: 4096\n    kty: 'RSA'\n  }\n}\n\nresource storage 'Microsoft.Storage/storageAccounts@2021-04-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'StorageV2'\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${userAssignedIdentity.id}': {}\n    }\n  }\n  properties: {\n    accessTier: 'Hot'\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    encryption: {\n      identity: {\n        userAssignedIdentity: userAssignedIdentity.id\n      }\n      services: {\n         blob: {\n           enabled: true\n         }\n      }\n      keySource: 'Microsoft.Keyvault'\n      keyvaultproperties: {\n        keyname: kvKey.name\n        keyvaulturi: endsWith(keyVault.properties.vaultUri,'/') ? substring(keyVault.properties.vaultUri,0,length(keyVault.properties.vaultUri)-1) : keyVault.properties.vaultUri\n      }\n    }\n  }\n}\n\n\n\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1301?"}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Storage account.')\nparam storageAccountName string = 'storage${uniqueString(resourceGroup().id)}'\n\n@description('Specifies the name of the File Share. File share names must be between 3 and 63 characters in length and use numbers, lower-case letters and dash (-) only.')\n@minLength(3)\n@maxLength(63)\nparam fileShareName string\n\n@description('Specifies the location in which the Azure Storage resources should be deployed.')\nparam location string = resourceGroup().location\n\nresource sa 'Microsoft.Storage/storageAccounts@2021-04-01' = {\n  name: storageAccountName\n  location: location\n  kind: 'StorageV2'\n  sku: {\n    name: 'Standard_LRS'\n  }\n  properties: {\n    accessTier: 'Hot'\n  }\n}\n\nresource fileShare 'Microsoft.Storage/storageAccounts/fileServices/shares@2021-04-01' = {\n  name: '${sa.name}/default/${fileShareName}'\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1302."}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Storage account.')\nparam storageAccountName string\n\n@description('Specifies the prefix of the blob container names.')\n@minLength(2)\nparam containerPrefix string\n\n@description('Specifies the number of blob containers to create.')\nparam numberOfContainers int\n\n@description('Specifies the location in which the Azure Storage resources should be deployed.')\nparam location string = resourceGroup().location\n\nresource sa 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n  }\n  kind: 'StorageV2'\n  properties: {\n    accessTier: 'Hot'\n  }\n}\n\nresource blobServices 'Microsoft.Storage/storageAccounts/blobServices@2023-01-01' = {\n  parent: sa\n  name: 'default'\n}\n\nresource containers 'Microsoft.Storage/storageAccounts/blobServices/containers@2023-01-01' = [for i in range(0, numberOfContainers): {\n  parent: blobServices\n  name: '${containerPrefix}${i}'\n}]\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1303."}, {"role": "assistant", "content": "@description('Specifies the name of the Azure Storage account.')\nparam storageAccountName string = 'storage${uniqueString(resourceGroup().id)}'\n\n@description('Specifies the prefix of the file share names.')\nparam sharePrefix string = 'logs'\n\n@description('Specifies the location in which the Azure Storage resources should be deployed.')\nparam location string = resourceGroup().location\n\n@description('Specifies the number of file shares to be created.')\n@minValue(1)\n@maxValue(100)\nparam shareCopy int = 1\n\nresource sa 'Microsoft.Storage/storageAccounts@2021-04-01' = {\n  name: storageAccountName\n  location: location\n  kind: 'StorageV2'\n  sku: {\n    name: 'Standard_LRS'\n  }\n  properties: {\n    accessTier: 'Hot'\n  }\n}\n\nresource fileShares 'Microsoft.Storage/storageAccounts/fileServices/shares@2021-04-01' = [for i in range(0, shareCopy): {\n  name: '${sa.name}/default/${sharePrefix}${i}'\n}]\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1304?"}, {"role": "assistant", "content": "@description('Storage Account Name')\nparam storageAccountName string\n\n@description('Storage Account type')\n@allowed([\n  'Standard_LRS'\n  'Standard_ZRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('Region')\n@allowed([\n  'northcentralus'\n  'eastus2'\n  'eastus2euap'\n  'centralus'\n  'canadaeast'\n  'canadacentral'\n  'northeurope'\n  'australiaeast'\n  'switzerlandnorth'\n  'germanywestcentral'\n  'eastasia'\n  'francecentral'\n])\nparam location string\n\n@description('Username of primary user')\nparam userName string\n\n@description('Home directory of primary user. Should be a container.')\nparam homeDirectory string\n\n@description('SSH Public Key for primary user. If not specified, Azure will generate a password which can be accessed securely')\nparam publicKey string = ''\n\nresource sa 'Microsoft.Storage/storageAccounts@2023-05-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'StorageV2'\n  properties: {\n    isHnsEnabled: true\n    isLocalUserEnabled: true\n    isSftpEnabled: true\n  }\n}\n\nresource container 'Microsoft.Storage/storageAccounts/blobServices/containers@2023-05-01' = {\n  name: '${sa.name}/default/${homeDirectory}'\n  properties: {\n    publicAccess: 'None'\n  }\n\n}\n\nresource user 'Microsoft.Storage/storageAccounts/localUsers@2023-05-01' = {\n  parent: sa\n  name: userName\n  properties: {\n    permissionScopes: [\n      {\n        permissions: 'rcwdl'\n        service: 'blob'\n        resourceName: homeDirectory\n      }\n    ]\n    homeDirectory: homeDirectory\n    sshAuthorizedKeys: empty(publicKey) ? null : [\n      {\n        description: '${userName} public key'\n        key: publicKey\n      }\n    ]\n    hasSharedKey: false\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1305."}, {"role": "assistant", "content": "// This template deploys an Azure Storage account, and then configures it to support static website hosting.\n// Enabling static website hosting isn't possible directly in Bicep or an ARM template,\n// so this sample uses a deployment script to enable the feature.\n\n@description('The location into which the resources should be deployed.')\nparam location string = resourceGroup().location\n\n@description('The name of the storage account to use for site hosting.')\nparam storageAccountName string = 'stor${uniqueString(resourceGroup().id)}'\n\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_ZRS'\n  'Premium_LRS'\n])\n@description('The storage account sku name.')\nparam storageSku string = 'Standard_LRS'\n\n@description('The path to the web index document.')\nparam indexDocumentPath string = 'index.html'\n\n@description('The contents of the web index document.')\nparam indexDocumentContents string = '<h1>Example static website</h1>'\n\n@description('The path to the web error document.')\nparam errorDocument404Path string = 'error.html'\n\n@description('The contents of the web error document.')\nparam errorDocument404Contents string = '<h1>Example 404 error page</h1>'\n\nresource contributorRoleDefinition 'Microsoft.Authorization/roleDefinitions@2018-01-01-preview' existing = {\n  scope: subscription()\n  // This is the Storage Account Contributor role, which is the minimum role permission we can give. See https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#:~:text=17d1049b-9a84-46fb-8f53-869881c3d3ab\n  name: '17d1049b-9a84-46fb-8f53-869881c3d3ab'\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-06-01' = {\n  name: storageAccountName\n  location: location\n  kind: 'StorageV2'\n  sku: {\n    name: storageSku\n  }\n}\n\nresource managedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\n  name: 'DeploymentScript'\n  location: location\n}\n\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2020-04-01-preview' = {\n  scope: storageAccount\n  name: guid(resourceGroup().id, managedIdentity.id, contributorRoleDefinition.id)\n  properties: {\n    roleDefinitionId: contributorRoleDefinition.id\n    principalId: managedIdentity.properties.principalId\n    principalType: 'ServicePrincipal'\n  }\n}\n\nresource deploymentScript 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\n  name: 'deploymentScript'\n  location: location\n  kind: 'AzurePowerShell'\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${managedIdentity.id}': {}\n    }\n  }\n  dependsOn: [\n    // we need to ensure we wait for the role assignment to be deployed before trying to access the storage account\n    roleAssignment\n  ]\n  properties: {\n    azPowerShellVersion: '3.0'\n    scriptContent: loadTextContent('./scripts/enable-static-website.ps1')\n    retentionInterval: 'PT4H'\n    environmentVariables: [\n      {\n        name: 'ResourceGroupName'\n        value: resourceGroup().name\n      }\n      {\n        name: 'StorageAccountName'\n        value: storageAccount.name\n      }\n      {\n        name: 'IndexDocumentPath'\n        value: indexDocumentPath\n      }\n      {\n        name: 'IndexDocumentContents'\n        value: indexDocumentContents\n      }\n      {\n        name: 'ErrorDocument404Path'\n        value: errorDocument404Path\n      }\n      {\n        name: 'ErrorDocument404Contents'\n        value: errorDocument404Contents\n      }\n    ]\n  }\n}\n\noutput staticWebsiteUrl string = storageAccount.properties.primaryEndpoints.web\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1306."}, {"role": "assistant", "content": "@sys.description('The name of storage task.')\n@minLength(3)\n@maxLength(18)\nparam storageTaskName string\n\n@sys.description('A description of the storage task.')\nparam description string\n\n@sys.description('The region in which to create the storage task.')\nparam location string = resourceGroup().location\n\n@sys.description('Locks the file for one day.')\nparam lockedUntilDate string = dateTimeAdd(utcNow(), 'P1D')\n\nresource storageTask 'Microsoft.StorageActions/storageTasks@2023-01-01' = {\n  name: storageTaskName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    action: {\n      if: {\n        condition: '[[endsWith(Name, \\'.docx\\')]]'\n        operations: [\n         {\n            name: 'SetBlobImmutabilityPolicy'\n            onSuccess: 'continue'\n            onFailure: 'break'\n            parameters: {\n              untilDate: lockedUntilDate\n              mode: 'locked'\n            }\n         }\n         {\n            name: 'SetBlobTags'\n            onSuccess: 'continue'\n            onFailure: 'break'\n            parameters: {\n                tagsetImmutabilityUpdatedBy: 'StorageTaskQuickstart'\n            }     \n         }\n        ]\n      }\n\n    }\n    description: description\n    enabled: true\n  }\n}\n  \n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1307."}, {"role": "assistant", "content": "@description('Location of the Disk Pool')\n@allowed([\n  'AustraliaEast'\n  'CanadaCentral'\n  'CentralUS'\n  'EastUS'\n  'JapanEast'\n  'NorthEurope'\n  'SouthCentralUS'\n  'SoutheastAsia'\n  'UKSouth'\n  'WestEurope'\n  'WestUS2'\n])\nparam diskPoolLocation string\n\n@description('Sku of the Disk Pool')\n@allowed([\n  'Basic_B1'\n  'Standard_S1'\n  'Premium_P1'\n])\nparam diskPoolSku string = 'Standard_S1'\n\n@description('Name of the Disk Pool')\n@minLength(7)\n@maxLength(30)\nparam diskPoolName string = 'diskpool-01'\n\n@description('Availability zone to deploy the Disk Pool')\nparam diskPoolAvailabilityZone string\n\n@description('Name of the managed disk (512 sector size) to create and export as an iSCSI LUN in the Disk Pool')\nparam existingManagedDiskName string = 'disk-1'\n\n@description('Name of the iSCSI Target')\n@minLength(5)\n@maxLength(40)\nparam targetName string = 'iscsi-target-01'\n\n@description('Name of the resourceGroup for the existing virtual network and disk to deploy the Disk Pool.')\nparam existingResourceGroupName string\n\n@description('Name of the existing virtual network to deploy the Disk Pool into.')\nparam existingVnetName string\n\n@description('Name of the existing subnet to deploy the Disk Pool into.')\nparam existingSubnetName string\n\nresource vnet 'Microsoft.Network/virtualNetworks@2020-05-01' existing = {\n  scope: resourceGroup(existingResourceGroupName)\n  name: existingVnetName\n}\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2020-05-01' existing = {\n  name: existingSubnetName\n  parent: vnet\n}\nvar subnetId = subnet.id\n\nresource disk 'Microsoft.Compute/disks@2021-04-01' existing =  {\n  scope: resourceGroup(existingResourceGroupName)\n  name: existingManagedDiskName\n}\nvar diskId = disk.id\n\nresource diskPool 'Microsoft.StoragePool/diskPools@2021-08-01' = {\n  name: diskPoolName\n  sku: {\n    name: diskPoolSku\n  }\n  location: diskPoolLocation\n  properties: {\n    availabilityZones: [\n      diskPoolAvailabilityZone\n    ]\n    subnetId: subnetId\n    disks: [\n      {\n        id: diskId\n      }\n    ]\n  }\n}\n\nresource target 'Microsoft.StoragePool/diskPools/iscsiTargets@2021-08-01' = {\n  parent: diskPool\n  name: targetName\n  properties: {\n    targetIqn: 'iqn.2021-04.org.microsoft.com:target'\n    aclMode: 'Dynamic'\n    luns: [\n      {\n        managedDiskAzureResourceId: diskId\n        name: 'lun0'\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1308 please."}, {"role": "assistant", "content": "@description('Location for the resources.')\nparam location string = resourceGroup().location\n\n@description('Stream Analytics Job Name, can contain alphanumeric characters and hypen and must be 3-63 characters long')\n@minLength(3)\n@maxLength(63)\nparam streamAnalyticsJobName string\n\n@description('You can choose the number of Streaming Units, ranging from 3, 7, 10, 20, 30, in multiples of 10, and continuing up to 660.')\n@minValue(3)\n@maxValue(660)\n\nparam numberOfStreamingUnits int\n\nresource streamingJob 'Microsoft.StreamAnalytics/streamingjobs@2021-10-01-preview' = {\n  name: streamAnalyticsJobName\n  location: location\n  properties: {\n    sku: {\n      name: 'StandardV2'\n    }\n    outputErrorPolicy: 'Stop'\n    eventsOutOfOrderPolicy: 'Adjust'\n    eventsOutOfOrderMaxDelayInSeconds: 0\n    eventsLateArrivalMaxDelayInSeconds: 5\n    dataLocale: 'en-US'\n    transformation: {\n      name: 'Transformation'\n      properties: {\n        streamingUnits: numberOfStreamingUnits\n        query: 'SELECT\\r\\n    *\\r\\nINTO\\r\\n    [YourOutputAlias]\\r\\nFROM\\r\\n    [YourInputAlias]'\n      }\n    }\n  }\n}\n\noutput location string = location\noutput name string = streamingJob.name\noutput resourceGroupName string = resourceGroup().name\noutput resourceId string = streamingJob.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1309?"}, {"role": "assistant", "content": "@description('The name of you Web Site.')\nparam siteName string = 'FuncApp-${uniqueString(resourceGroup().id)}'\nparam storageAccountName string = 'store${uniqueString(resourceGroup().id)}'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar hostingPlanName = 'hpn-${resourceGroup().name}'\n\nresource site 'Microsoft.Web/sites@2022-03-01' = {\n  name: siteName\n  kind: 'functionapp,linux'\n  location: location\n  properties: {\n    siteConfig: {\n      appSettings: [\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: 'python'\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n      ]\n    }\n    serverFarmId: hostingPlan.id\n    clientAffinityEnabled: false\n  }\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanName\n  location: location\n  kind: 'linux'\n  properties: {\n    reserved: true\n  }\n  sku: {\n    tier: 'Standard'\n    name: 'S1'\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' = {\n  name: storageAccountName\n  location: location\n  kind: 'StorageV2'\n  sku: {\n    name: 'Standard_LRS'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1310."}, {"role": "assistant", "content": "@description('Web app name.')\n@minLength(2)\nparam webAppName string = 'webApp-${uniqueString(resourceGroup().id)}'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('The SKU of App Service Plan.')\nparam sku string = 'F1'\n\n@description('The Runtime stack of current web app')\nparam linuxFxVersion string = 'DOTNETCORE|3.0'\n\n@description('Optional Git Repo URL')\nparam repoUrl string = ' '\n\nvar appServicePlanPortalName = 'AppServicePlan-${webAppName}'\n\nresource appServicePlan 'Microsoft.Web/serverfarms@2021-02-01' = {\n  name: appServicePlanPortalName\n  location: location\n  sku: {\n    name: sku\n  }\n  kind: 'linux'\n  properties: {\n    reserved: true\n  }\n}\n\nresource webApp 'Microsoft.Web/sites@2021-02-01' = {\n  name: webAppName\n  location: location\n  properties: {\n    httpsOnly: true\n    serverFarmId: appServicePlan.id\n    siteConfig: {\n      linuxFxVersion: linuxFxVersion\n      minTlsVersion: '1.2'\n      ftpsState: 'FtpsOnly'\n    }\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n}\n\nresource webAppSourceControl 'Microsoft.Web/sites/sourcecontrols@2021-02-01' = if(contains(repoUrl,'http')){\n  name: 'web'\n  parent: webApp\n  properties: {\n    repoUrl: repoUrl\n    branch: 'master'\n    isManualIntegration: true\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1311?"}, {"role": "assistant", "content": "@description('Web app name.')\n@minLength(2)\nparam webAppName string = 'webApp-${uniqueString(resourceGroup().id)}'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('The SKU of App Service Plan.')\nparam sku string = 'F1'\n\n@description('The language stack of the app.')\n@allowed([\n  '.net'\n  'php'\n  'node'\n  'html'\n])\nparam language string = '.net'\n\n@description('true = deploy a sample Hello World app.')\nparam helloWorld bool = false\n\n@description('Optional Git Repo URL')\nparam repoUrl string = ''\n\nvar appServicePlanPortalName = 'AppServicePlan-${webAppName}'\nvar gitRepoReference = {\n  '.net': 'https://github.com/Azure-Samples/app-service-web-dotnet-get-started'\n  node: 'https://github.com/Azure-Samples/nodejs-docs-hello-world'\n  php: 'https://github.com/Azure-Samples/php-docs-hello-world'\n  html: 'https://github.com/Azure-Samples/html-docs-hello-world'\n}\nvar gitRepoUrl = (bool(helloWorld) ? gitRepoReference[toLower(language)] : repoUrl)\nvar configReference = {\n  '.net': {\n    comments: '.Net app. No additional configuration needed.'\n  }\n  html: {\n    comments: 'HTML app. No additional configuration needed.'\n  }\n  php: {\n    phpVersion: '7.4'\n  }\n  node: {\n    appSettings: [\n      {\n        name: 'WEBSITE_NODE_DEFAULT_VERSION'\n        value: '12.15.0'\n      }\n    ]\n  }\n}\n\nresource appServicePlanPortal 'Microsoft.Web/serverfarms@2023-01-01' = {\n  name: appServicePlanPortalName\n  location: location\n  sku: {\n    name: sku\n  }\n}\n\nresource webApp 'Microsoft.Web/sites@2023-01-01' = {\n  name: webAppName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }  \n  properties: {\n    siteConfig: configReference[language]\n    serverFarmId: appServicePlanPortal.id\n    httpsOnly: true\n  }\n}\n\nresource site 'Microsoft.Web/sites/sourcecontrols@2023-01-01' = if (contains(gitRepoUrl, 'http')) {\n  parent: webApp\n  name: 'web'\n  properties: {\n    repoUrl: gitRepoUrl\n    branch: 'master'\n    isManualIntegration: true\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1312."}, {"role": "assistant", "content": "@description('Web App name.')\n@minLength(2)\nparam appServiceWebAppName string = 'webApp-${uniqueString(resourceGroup().id)}'\n\n@description('App Service Plan name.')\n@minLength(2)\nparam appServicePlanName string = 'webApp-${uniqueString(resourceGroup().id)}'\nparam skuTier string = 'P1v3'\nparam location string = resourceGroup().location\n\nresource appServiceWebApp 'Microsoft.Web/sites@2023-01-01' = {\n  name: appServiceWebAppName\n  location: location\n  tags: {\n    'hidden-related:${appServicePlan.id}': 'empty'\n  }\n  properties: {\n    siteConfig: {\n      appSettings: [\n        {\n          name: 'PORT'\n          value: '8080'\n        }\n      ]\n      appCommandLine: ''\n      windowsFxVersion: 'DOCKER|mcr.microsoft.com/dotnet/samples:aspnetapp'\n    }\n    serverFarmId: appServicePlan.id \n  }\n}\n\nresource appServicePlan 'Microsoft.Web/serverfarms@2023-01-01' = {\n  name: appServicePlanName\n  location: location\n  sku: {\n    name: skuTier\n  }\n  kind: 'windows'\n  properties: {\n    hyperV: true\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1313."}, {"role": "assistant", "content": "@description('The location in which all resources should be deployed.')\nparam location string = resourceGroup().location\n\n@description('The name of the app to create.')\nparam appName string = uniqueString(resourceGroup().id)\n\nvar appServicePlanName = '${appName}${uniqueString(subscription().subscriptionId)}'\nvar vnetName = '${appName}vnet'\nvar vnetAddressPrefix = '10.0.0.0/16'\nvar subnetName = '${appName}sn'\nvar subnetAddressPrefix = '10.0.0.0/24'\nvar appServicePlanSku = 'S1'\n\nresource appServicePlan 'Microsoft.Web/serverfarms@2020-06-01' = {\n  name: appServicePlanName\n  location: location\n  sku: {\n    name: appServicePlanSku\n  }\n  kind: 'app'\n}\n\nresource vnet 'Microsoft.Network/virtualNetworks@2020-06-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: subnetAddressPrefix\n          delegations: [\n            {\n              name: 'delegation'\n              properties: {\n                serviceName: 'Microsoft.Web/serverFarms'\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource webApp 'Microsoft.Web/sites@2021-01-01' = {\n  name: appName\n  location: location\n  kind: 'app'\n  properties: {\n    serverFarmId: appServicePlan.id\n    virtualNetworkSubnetId: vnet.properties.subnets[0].id\n    httpsOnly: true\n    vnetRouteAllEnabled: true\n    siteConfig: {\n      http20Enabled: true\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1314?"}, {"role": "assistant", "content": "@description('Name of the App Service Environment')\nparam aseName string\n\n@description('The name of the vnet')\nparam virtualNetworkName string\n\n@description('The resource group name that contains the vnet')\nparam vnetResourceGroupName string\n\n@description('Subnet name that will contain the App Service Environment')\nparam subnetName string\n\n@description('Location for the resources')\nparam location string = resourceGroup().location\n\n@description('None: public VIP only. Publishing: only ports 80/443 are mapped to ILB VIP. Web: only FTP ports are mapped to ILB VIP:  Web,Publishing: ports 80/443 and FTP ports are mapped to an ILB VIP.')\n@allowed([\n  'None'\n  'Publishing'\n  'Web'\n  'Web, Publishing'\n])\nparam internalLoadBalancingMode string = 'Web, Publishing'\n\n@description('Used when deploying an ILB enabled ASE.  Set this to the root domain associated with the ASE.  For example: contoso.com')\nparam dnsSuffix string = ''\n\n@description('The name of the web app that will be created.')\nparam siteName string\n\n@description('The name of the App Service plan to use for hosting the web app.')\nparam appServicePlanName string\n\n@description('The owner of the resource will be used for tagging.')\nparam owner string\n\n@description('Defines the number of workers from the worker pool that will be used by the app service plan.')\nparam numberOfWorkers int = 1\n\n@description('Defines which worker pool\\'s (WP1, WP2 or WP3) resources will be used for the app service plan.')\n@allowed([\n  '1'\n  '2'\n  '3'\n])\nparam workerPool string = '1'\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2021-02-01' existing = {\n  scope: resourceGroup(vnetResourceGroupName)\n  name: virtualNetworkName\n}\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2021-02-01' existing = {\n  parent: virtualNetwork\n  name: subnetName\n}\n\nresource hostingEnvironment 'Microsoft.Web/hostingEnvironments@2020-12-01' = {\n  name: aseName\n  kind: 'ASEV2'\n  location: location\n  tags: {\n    displayName: 'ASE Environment'\n    usage: 'Hosting PaaS applications'\n    category: 'Environment'\n    owner: owner\n  }\n  properties: {\n    ipsslAddressCount: 0\n    internalLoadBalancingMode: internalLoadBalancingMode\n    dnsSuffix: dnsSuffix\n    virtualNetwork: {\n      id: subnet.id\n    }\n  }\n}\n\nresource serverFarm 'Microsoft.Web/serverFarms@2020-12-01' = {\n  name: appServicePlanName\n  location: location\n  tags: {\n    displayName: 'ASE Hosting Plan'\n    usage: 'Hosting Plan within ASE'\n    category: 'Hosting'\n    owner: owner\n  }\n  properties: {\n    hostingEnvironmentProfile: {\n      id: hostingEnvironment.id\n    }\n  }\n  sku: {\n    name: 'I${workerPool}'\n    tier: 'Isolated'\n    size: 'I${workerPool}'\n    family: 'I'\n    capacity: numberOfWorkers\n  }\n}\n\nresource website 'Microsoft.Web/sites@2020-12-01' = {\n  name: siteName\n  location: location\n  tags: {\n    displayName: 'ASE Web App'\n    usage: 'Web App Hosted within ASE'\n    category: 'Web App'\n    owner: owner\n  }\n  properties: {\n    serverFarmId: serverFarm.id\n    hostingEnvironmentProfile: {\n      id: hostingEnvironment.id\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1315."}, {"role": "assistant", "content": "/* This Bicep file deploys a new instance of Azure Web PubSub service. */\n\n// Parameters\n\n@description('The name for your new Web PubSub instance.')\n@maxLength(63)\n@minLength(3)\nparam wpsName string = uniqueString(resourceGroup().id)\n\n@description('The region in which to create the new instance, defaults to the same location as the resource group.')\nparam location string = resourceGroup().location\n\n@description('Unit count')\n@allowed([\n  1\n  2\n  5\n  10\n  20\n  50\n  100\n])\nparam unitCount int = 1\n\n@description('SKU name')\n@allowed([\n  'Standard_S1'\n  'Free_F1'\n])\nparam sku string = 'Free_F1'\n\n@description('Pricing tier')\n@allowed([\n  'Free'\n  'Standard'\n])\nparam pricingTier string = 'Free'\n\n// Resource definition\nresource webpubsub 'Microsoft.SignalRService/webPubSub@2021-10-01' = {\n  name: wpsName\n  location: location\n  sku: {\n    capacity: unitCount\n    name: sku\n    tier: pricingTier\n  }\n  identity: {\n    type: 'None'\n  }\n  properties: {\n    disableAadAuth: false\n    disableLocalAuth: false\n    liveTraceConfiguration: {\n      categories: [\n        {\n          enabled: 'false'\n          name: 'ConnectivityLogs'\n        }\n        {\n          enabled: 'false'\n          name: 'MessagingLogs'\n        }\n      ]\n      enabled: 'false'\n    }\n    networkACLs: {\n      defaultAction: 'Deny'     \n      publicNetwork: {\n        allow: [\n          'ServerConnection'\n          'ClientConnection'\n          'RESTAPI'\n          'Trace'\n        ]\n      }\n    }\n    publicNetworkAccess: 'Enabled'\n    resourceLogConfiguration: {\n      categories: [\n        {\n          enabled: 'true'\n          name: 'ConnectivityLogs'\n        }\n        {\n          enabled: 'true'\n          name: 'MessagingLogs'\n        }\n      ]\n    }\n    tls: {\n      clientCertEnabled: false\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1316."}, {"role": "assistant", "content": "@description('The Azure Cosmos DB database account name.')\nparam databaseAccountName string\n\n@description('The name of the App Service Plan that will host the Web App.')\nparam appSvcPlanName string\n\n@description('The instance size of the App Service Plan.')\nparam svcPlanSize string = 'F1'\n\n@description('The pricing tier of the App Service plan.')\n@allowed([\n  'Free'\n  'Shared'\n  'Basic'\n  'Standard'\n  'Premium'\n])\nparam svcPlanSku string = 'Free'\n\n@description('The name of the Web App.')\nparam webAppName string\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar databaseAccountTier = 'Standard'\n\nresource databaseAccount'Microsoft.DocumentDB/databaseAccounts@2021-10-15' = {\n  name: databaseAccountName\n  location: location\n  properties: {\n    databaseAccountOfferType: databaseAccountTier\n    locations: [\n      {\n        locationName: location\n        failoverPriority: 0\n      }\n    ]\n  }\n}\n\nresource appSvcPlan 'Microsoft.Web/serverfarms@2021-02-01' = {\n  name: appSvcPlanName\n  location: location\n  sku: {\n    name: svcPlanSize\n    tier: svcPlanSku\n    capacity: 1\n  }\n}\n\nresource webApp 'Microsoft.Web/sites@2021-02-01' = {\n  name: webAppName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    serverFarmId: appSvcPlan.id\n    httpsOnly: true\n    \n    siteConfig: {\n      ftpsState: 'FtpsOnly'\n      phpVersion: 'off'\n      minTlsVersion: '1.2'\n      appSettings: [\n        {\n          name: 'DOCUMENTDB_ENDPOINT'\n          value: databaseAccount.properties.documentEndpoint\n        }\n        {\n          name: 'DOCUMENTDB_PRIMARY_KEY'\n          value: databaseAccount.listKeys().primaryMasterKey\n        }\n      ]\n    }\n    \n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1317."}, {"role": "assistant", "content": "@description('The name of the function app that you wish to create.')\nparam appName string\n\n@description('The pricing tier for the hosting plan.')\n@allowed([\n  'D1'\n  'F1'\n  'B1'\n  'B2'\n  'B3'\n  'S1'\n  'S2'\n  'S3'\n  'P1'\n  'P2'\n  'P3'\n  'P1V2'\n  'P2V2'\n  'P3V2'\n  'I1'\n  'I2'\n  'I3'\n  'Y1'\n])\nparam sku string = 'S1'\n\n@description('Storage Account type')\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Location for Application Insights')\nparam appInsightsLocation string\n\nvar functionAppName = appName\nvar hostingPlanName = appName\nvar applicationInsightsName = appName\nvar storageAccountName = '${uniqueString(resourceGroup().id)}functions'\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-09-01' = {\n  name: storageAccountName\n  location: location\n  kind: 'Storage'\n  sku: {\n    name: storageAccountType\n  }\n}\n\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: appInsightsLocation\n  tags: {\n    'hidden-link:${resourceId('Microsoft.Web/sites', applicationInsightsName)}': 'Resource'\n  }\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    Request_Source: 'IbizaWebAppExtensionCreate'\n  }\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    name: sku\n  }\n  properties: { }\n}\n\nresource functionApp 'Microsoft.Web/sites@2022-03-01' = {\n  name: functionAppName\n  location: location\n  kind: 'functionapp'\n  identity:{\n    type:'SystemAssigned'\n  }\n  properties: {\n    serverFarmId: hostingPlan.id\n    clientAffinityEnabled: false\n    siteConfig: {\n      alwaysOn: true\n    }\n    httpsOnly: true\n  }\n}\n\nresource appsettings 'Microsoft.Web/sites/config@2022-03-01' = {\n  parent: functionApp\n  name: 'appsettings'\n  properties: {\n    AzureWebJobsStorage: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${listKeys(storageAccount.id, '2021-09-01').keys[0].value}'\n    APPINSIGHTS_INSTRUMENTATIONKEY: reference(applicationInsights.id, '2020-02-02').InstrumentationKey\n    FUNCTIONS_EXTENSION_VERSION: '~4'\n    ftpsState: 'Disabled'\n    minTlsVersion: '1.2'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1318 please."}, {"role": "assistant", "content": "@description('The name of the function app that you wish to create.')\nparam appName string = 'fnapp${uniqueString(resourceGroup().id)}'\n\n@description('Storage Account type')\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Location for Application Insights')\nparam appInsightsLocation string\n\n@description('The language worker runtime to load in the function app.')\n@allowed([\n  'node'\n  'dotnet'\n  'java'\n])\nparam runtime string = 'node'\n\nvar functionAppName = appName\nvar hostingPlanName = appName\nvar applicationInsightsName = appName\nvar storageAccountName = '${uniqueString(resourceGroup().id)}azfunctions'\nvar functionWorkerRuntime = runtime\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'Storage'\n  properties: {\n    supportsHttpsTrafficOnly: true\n    defaultToOAuthAuthentication: true\n  }\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2021-03-01' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    name: 'Y1'\n    tier: 'Dynamic'\n  }\n  properties: {}\n}\n\nresource functionApp 'Microsoft.Web/sites@2021-03-01' = {\n  name: functionAppName\n  location: location\n  kind: 'functionapp'\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    serverFarmId: hostingPlan.id\n    siteConfig: {\n      appSettings: [\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTSHARE'\n          value: toLower(functionAppName)\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\n          value: '~14'\n        }\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: applicationInsights.properties.InstrumentationKey\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n      ]\n      ftpsState: 'FtpsOnly'\n      minTlsVersion: '1.2'\n    }\n    httpsOnly: true\n  }\n}\n\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: appInsightsLocation\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    Request_Source: 'rest'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1319?"}, {"role": "assistant", "content": "@description('The name of the function app that you wish to create.')\nparam appName string = 'fnapp${uniqueString(resourceGroup().id)}'\n\n@description('Storage Account type')\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Location for Application Insights')\nparam appInsightsLocation string\n\n@description('The language worker runtime to load in the function app.')\n@allowed([\n  'node'\n  'dotnet'\n  'java'\n])\nparam runtime string = 'node'\n\nvar functionAppName = appName\nvar hostingPlanName = appName\nvar applicationInsightsName = appName\nvar storageAccountName = '${uniqueString(resourceGroup().id)}azfunctions'\nvar functionWorkerRuntime = runtime\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'Storage'\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2023-01-01' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    name: 'Y1'\n    tier: 'Dynamic'\n  }\n}\n\nresource functionApp 'Microsoft.Web/sites@2023-01-01' = {\n  name: functionAppName\n  location: location\n  kind: 'functionapp'\n  properties: {\n    serverFarmId: hostingPlan.id\n    siteConfig: {\n      appSettings: [\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTSHARE'\n          value: toLower(functionAppName)\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\n          value: '~14'\n        }\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: applicationInsights.properties.InstrumentationKey\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n      ]\n    }\n  }\n}\n\nresource deploymentSlot 'Microsoft.Web/sites/slots@2023-01-01' = {\n  parent: functionApp\n  name: 'deployment'\n  kind: 'functionapp'\n  location: location\n  properties: {\n    serverFarmId: hostingPlan.id\n    siteConfig: {\n      appSettings: [\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${listKeys(storageAccount.id, '2019-06-01').keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${listKeys(storageAccount.id, '2019-06-01').keys[0].value}'\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~3'\n        }\n        {\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\n          value: '~10'\n        }\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: applicationInsights.properties.InstrumentationKey\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n      ]\n    }\n  }\n}\n\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: appInsightsLocation\n  tags: {\n    'hidden-link:${resourceId('Microsoft.Web/sites', applicationInsightsName)}': 'Resource'\n  }\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    Request_Source: 'IbizaWebAppExtensionCreate'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1320."}, {"role": "assistant", "content": "@description('The name of the Azure Function app.')\nparam functionAppName string = 'func-${uniqueString(resourceGroup().id)}'\n\n@description('Storage Account type')\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Location for Application Insights')\nparam appInsightsLocation string = resourceGroup().location\n\n@description('The language worker runtime to load in the function app.')\n@allowed([\n  'dotnet'\n  'node'\n  'python'\n  'java'\n])\nparam functionWorkerRuntime string = 'node'\n\n@description('Specifies the OS used for the Azure Function hosting plan.')\n@allowed([\n  'Windows'\n  'Linux'\n])\nparam functionPlanOS string = 'Windows'\n\n@description('Specifies the Azure Function hosting plan SKU.')\n@allowed([\n  'EP1'\n  'EP2'\n  'EP3'\n])\nparam functionAppPlanSku string = 'EP1'\n\n@description('Only required for Linux app to represent runtime stack in the format of \\'runtime|runtimeVersion\\'. For example: \\'python|3.9\\'')\nparam linuxFxVersion string = ''\n\nvar hostingPlanName = functionAppName\nvar applicationInsightsName = functionAppName\nvar storageAccountName = '${uniqueString(resourceGroup().id)}azfunctions'\nvar isReserved = ((functionPlanOS == 'Linux') ? true : false)\nvar slotContentShareName = '${functionAppName}-deployment'\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'Storage'\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    tier: 'ElasticPremium'\n    name: functionAppPlanSku\n    family: 'EP'\n  }\n  properties: {\n    maximumElasticWorkerCount: 20\n    reserved: isReserved\n  }\n  kind: 'elastic'\n}\n\nresource applicationInsight 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: appInsightsLocation\n  tags: {\n    'hidden-link:${resourceId('Microsoft.Web/sites', applicationInsightsName)}': 'Resource'\n  }\n  properties: {\n    Application_Type: 'web'\n  }\n  kind: 'web'\n}\n\nresource functionApp 'Microsoft.Web/sites@2022-03-01' = {\n  name: functionAppName\n  location: location\n  kind: (isReserved ? 'functionapp,linux' : 'functionapp')\n  properties: {\n    reserved: isReserved\n    serverFarmId: hostingPlan.id\n    siteConfig: {\n      linuxFxVersion: (isReserved ? linuxFxVersion : json('null'))\n      appSettings: [\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: applicationInsight.properties.InstrumentationKey\n        }\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTSHARE'\n          value: toLower(functionAppName)\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n        {\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\n          value: '~14'\n        }\n      ]\n    }\n  }\n}\n\nresource slot 'Microsoft.Web/sites/slots@2022-03-01' = {\n  parent: functionApp\n  name: 'deployment'\n  kind: (isReserved ? 'functionapp,linux' : 'functionapp')\n  location: location\n  properties: {\n    reserved: isReserved\n    serverFarmId: hostingPlan.id\n    siteConfig: {\n      linuxFxVersion: (isReserved ? linuxFxVersion : json('null'))\n      appSettings: [\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: applicationInsight.properties.InstrumentationKey\n        }\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTSHARE'\n          value: slotContentShareName\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n        {\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\n          value: '~14'\n        }\n      ]\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1321?"}, {"role": "assistant", "content": "@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('The name of the Azure Function app.')\nparam functionAppName string = 'func-${uniqueString(resourceGroup().id)}'\n\n@description('Storage Account type')\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('The language worker runtime to load in the function app.')\n@allowed([\n  'dotnet'\n  'node'\n  'python'\n  'java'\n])\nparam functionWorkerRuntime string = 'python'\n\n@description('Required for Linux app to represent runtime stack in the format of \\'runtime|runtimeVersion\\'. For example: \\'python|3.9\\'')\nparam linuxFxVersion string\n\n@description('The zip content url.')\nparam packageUri string\n\n@description('Name of Event Hub namespace')\nparam eventHubNamespaceName string = 'ehns-${uniqueString(resourceGroup().id)}'\n\n@description('The messaging tier for Event Hub namespace')\n@allowed([\n  'Basic'\n  'Standard'\n])\nparam eventhubSku string = 'Standard'\n\n@description('Event Hub throughput units.')\n@allowed([\n  1\n  2\n  4\n])\nparam eventHubSkuCapacity int = 1\n\n@description('Name of Event Hub')\nparam eventHubName string\n\nvar hostingPlanName = 'plan-${uniqueString(resourceGroup().id)}'\nvar applicationInsightsName = 'ai-${uniqueString(resourceGroup().id)}'\nvar storageAccountName = 'st${uniqueString(resourceGroup().id)}'\nvar logAnalyticsName = 'log-${uniqueString(resourceGroup().id)}'\n\n// https://learn.microsoft.com/azure/role-based-access-control/built-in-roles#storage-blob-data-owner\nvar storageBlobDataOwnerRoleId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b7e6dc6d-f1e8-4753-8033-0f276bb0955b')\nvar storageFunctionRoleAssignment = guid(resourceGroup().id, storageBlobDataOwnerRoleId)\n\n// https://learn.microsoft.com/azure/role-based-access-control/built-in-roles#azure-event-hubs-data-receiver\nvar eventHubDataReceiverRoleId = subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'a638d3c7-ab3a-418d-83e6-5f17a39d4fde')\nvar eventHubFunctionRoleAssignment = guid(resourceGroup().id, eventHubDataReceiverRoleId)\n\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {\n  name: logAnalyticsName\n  location: location\n  properties: {\n    sku: {\n      name: 'PerGB2018'\n    }\n  }\n}\n\nresource applicationInsight 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: location\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    WorkspaceResourceId: logAnalyticsWorkspace.id\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'Storage'\n  properties: {\n    supportsHttpsTrafficOnly: true\n    minimumTlsVersion: 'TLS1_2'\n    allowBlobPublicAccess: false\n  }\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    name: 'Y1'\n    tier: 'Dynamic'\n    size: 'Y1'\n    family: 'Y'\n  }\n  properties: {\n    reserved: true\n  }\n}\n\nresource functionApp 'Microsoft.Web/sites@2022-03-01' = {\n  name: functionAppName\n  location: location\n  kind: 'functionapp,linux'\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    reserved: true\n    serverFarmId: hostingPlan.id\n    httpsOnly: true\n    siteConfig: {\n      linuxFxVersion: linuxFxVersion\n      appSettings: [\n        {\n          name: 'APPLICATIONINSIGHTS_CONNECTION_STRING'\n          value: applicationInsight.properties.ConnectionString\n        }\n        {\n          name: 'AzureWebJobsStorage__accountName'\n          value: storageAccountName\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n        {\n          name: 'WEBSITE_RUN_FROM_PACKAGE'\n          value: packageUri\n        }\n        {\n          name: 'EventHubConnection__fullyQualifiedNamespace'\n          value: '${eventHubNamespace.name}.servicebus.windows.net'\n        }\n        {\n          // Used for Python v2 (https://learn.microsoft.com/en-us/azure/azure-functions/create-first-function-cli-python?tabs=azure-cli%2Cbash&pivots=python-mode-decorators#update-app-settings)\n          name: 'AzureWebJobsFeatureFlags'\n          value: 'EnableWorkerIndexing'\n        }\n      ]\n    }\n  }\n\n  resource config 'config' = {\n    name: 'web'\n    properties: {\n      ftpsState: 'Disabled'\n      minTlsVersion: '1.2'\n    }\n  }\n}\n\nresource eventHubNamespace 'Microsoft.EventHub/namespaces@2022-10-01-preview' = {\n  name: eventHubNamespaceName\n  location: location\n  sku: {\n    name: eventhubSku\n    capacity: eventHubSkuCapacity\n  }\n  properties: {}\n\n  resource eventHub 'eventhubs' = {\n    name: eventHubName\n    properties: {}\n  }\n}\n\nresource storageRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: storageFunctionRoleAssignment\n  properties: {\n    principalId: functionApp.identity.principalId\n    roleDefinitionId: storageBlobDataOwnerRoleId\n  }\n  scope: storageAccount\n}\n\nresource eventHubRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: eventHubFunctionRoleAssignment\n  properties: {\n    principalId: functionApp.identity.principalId\n    roleDefinitionId: eventHubDataReceiverRoleId\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1322."}, {"role": "assistant", "content": "/* This Bicep file creates a function app running in a Flex Consumption plan \nthat connects to Azure Storage by using managed identities with Microsoft Entra ID. */\n\n//********************************************\n// Parameters\n//********************************************\n\n@description('Primary region for all Azure resources.')\n@minLength(1)\nparam location string = resourceGroup().location \n\n@description('Language runtime used by the function app.')\n@allowed(['dotnet-isolated','python','java', 'node', 'powerShell'])\nparam functionAppRuntime string = 'dotnet-isolated' //Defaults to .NET isolated worker\n\n@description('Target language version used by the function app.')\n@allowed(['3.10','3.11', '7.4', '8.0', '9.0', '10', '11', '17', '20'])\nparam functionAppRuntimeVersion string = '8.0' //Defaults to .NET 8.\n\n@description('The maximum scale-out instance count limit for the app.')\n@minValue(40)\n@maxValue(1000)\nparam maximumInstanceCount int = 100\n\n@description('The memory size of instances used by the app.')\n@allowed([2048,4096])\nparam instanceMemoryMB int = 2048\n\n@description('A unique token used for resource name generation.')\n@minLength(3)\nparam resourceToken string = toLower(uniqueString(subscription().id, location))\n\n@description('A globally unique name for your deployed function app.')\nparam appName string = 'func-${resourceToken}'\n\n//********************************************\n// Variables\n//********************************************\n\n// Generates a unique container name for deployments.\nvar deploymentStorageContainerName = 'app-package-${take(appName, 32)}-${take(resourceToken, 7)}'\n\n// Key access to the storage account is disabled by default \nvar storageAccountAllowSharedKeyAccess = false\n\n// Define the IDs of the roles we need to assign to our managed identities.\nvar storageBlobDataOwnerRoleId  = 'b7e6dc6d-f1e8-4753-8033-0f276bb0955b'\nvar storageBlobDataContributorRoleId = 'ba92f5b4-2d11-453d-a403-e96b0029c9fe'\nvar storageQueueDataContributorId = '974c5e8b-45b9-4653-ba55-5f855dd0fb88'\nvar storageTableDataContributorId = '0a9a7e1f-b9d0-4cc4-a60d-0319b160aaa3'\nvar monitoringMetricsPublisherId = '3913510d-42f4-4e42-8a64-420c390055eb'\n\n//********************************************\n// Azure resources required by your function app.\n//********************************************\n\nresource logAnalytics 'Microsoft.OperationalInsights/workspaces@2023-09-01' = {\n  name: 'log-${resourceToken}'\n  location: location\n  properties: any({\n    retentionInDays: 30\n    features: {\n      searchVersion: 1\n    }\n    sku: {\n      name: 'PerGB2018'\n    }\n  })\n}\n\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: 'appi-${resourceToken}'\n  location: location\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    WorkspaceResourceId: logAnalytics.id\n    DisableLocalAuth: true\n  }\n}\n\nresource storage 'Microsoft.Storage/storageAccounts@2023-05-01' = {\n  name: 'st${resourceToken}'\n  location: location\n  kind: 'StorageV2'\n  sku: { name: 'Standard_LRS' }\n  properties: {\n    accessTier: 'Hot'\n    allowBlobPublicAccess: false\n    allowSharedKeyAccess: storageAccountAllowSharedKeyAccess\n    dnsEndpointType: 'Standard'\n    minimumTlsVersion: 'TLS1_2'\n    networkAcls: {\n      bypass: 'AzureServices'\n      defaultAction: 'Allow'\n    }\n    publicNetworkAccess: 'Enabled'\n  }\n  resource blobServices 'blobServices' = {\n    name: 'default'\n    properties: {\n      deleteRetentionPolicy: {}\n    }\n    resource deploymentContainer 'containers' = {\n      name: deploymentStorageContainerName\n      properties: {\n        publicAccess: 'None'\n      }\n    }\n  }\n}\n\nresource userAssignedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2023-01-31' = {\n  name: 'uai-data-owner-${resourceToken}'\n  location: location\n}\n\nresource roleAssignmentBlobDataOwner 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: guid(subscription().id, storage.id, userAssignedIdentity.id, 'Storage Blob Data Owner')\n  scope: storage\n  properties: {\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', storageBlobDataOwnerRoleId)\n    principalId: userAssignedIdentity.properties.principalId\n    principalType: 'ServicePrincipal'\n  }\n}\n\nresource roleAssignmentBlob 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: guid(subscription().id, storage.id, userAssignedIdentity.id, 'Storage Blob Data Contributor')\n  scope: storage\n  properties: {\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', storageBlobDataContributorRoleId)\n    principalId: userAssignedIdentity.properties.principalId\n    principalType: 'ServicePrincipal'\n  }\n}\n\nresource roleAssignmentQueueStorage 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: guid(subscription().id, storage.id, userAssignedIdentity.id, 'Storage Queue Data Contributor')\n  scope: storage\n  properties: {\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', storageQueueDataContributorId)\n    principalId: userAssignedIdentity.properties.principalId\n    principalType: 'ServicePrincipal'\n  }\n}\n\nresource roleAssignmentTableStorage 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: guid(subscription().id, storage.id, userAssignedIdentity.id, 'Storage Table Data Contributor')\n  scope: storage\n  properties: {\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', storageTableDataContributorId)\n    principalId: userAssignedIdentity.properties.principalId\n    principalType: 'ServicePrincipal'\n  }\n}\n\nresource roleAssignmentAppInsights 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: guid(subscription().id, applicationInsights.id, userAssignedIdentity.id, 'Monitoring Metrics Publisher')\n  scope: applicationInsights\n  properties: {\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', monitoringMetricsPublisherId)\n    principalId: userAssignedIdentity.properties.principalId\n    principalType: 'ServicePrincipal'\n  }\n}\n\n//********************************************\n// Function app and Flex Consumption plan definitions\n//********************************************\n\nresource appServicePlan 'Microsoft.Web/serverfarms@2024-04-01' = {\n  name: 'plan-${resourceToken}'\n  location: location\n  kind: 'functionapp'\n  sku: {\n    tier: 'FlexConsumption'\n    name: 'FC1'\n  }\n  properties: {\n    reserved: true\n  }\n}\n\nresource functionApp 'Microsoft.Web/sites@2024-04-01' = {\n  name: appName\n  location: location\n  kind: 'functionapp,linux'\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${userAssignedIdentity.id}':{}\n      }\n    }\n  properties: {\n    serverFarmId: appServicePlan.id\n    httpsOnly: true\n    siteConfig: {\n      minTlsVersion: '1.2'\n    }\n    functionAppConfig: {\n      deployment: {\n        storage: {\n          type: 'blobContainer'\n          value: '${storage.properties.primaryEndpoints.blob}${deploymentStorageContainerName}'\n          authentication: {\n            type: 'UserAssignedIdentity'\n            userAssignedIdentityResourceId: userAssignedIdentity.id\n          }\n        }\n      }\n      scaleAndConcurrency: {\n        maximumInstanceCount: maximumInstanceCount\n        instanceMemoryMB: instanceMemoryMB\n      }\n      runtime: { \n        name: functionAppRuntime\n        version: functionAppRuntimeVersion\n      }\n    }\n  }\n  resource configAppSettings 'config' = {\n    name: 'appsettings'\n    properties: {\n        AzureWebJobsStorage__accountName: storage.name\n        AzureWebJobsStorage__credential : 'managedidentity'\n        AzureWebJobsStorage__clientId: userAssignedIdentity.properties.clientId\n        APPINSIGHTS_INSTRUMENTATIONKEY: applicationInsights.properties.InstrumentationKey\n        APPLICATIONINSIGHTS_AUTHENTICATION_STRING: 'ClientId=${userAssignedIdentity.properties.clientId};Authorization=AAD'\n      }\n  }\n}\n\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1323."}, {"role": "assistant", "content": "@description('The name of the Azure Function app.')\nparam functionAppName string = 'func-${uniqueString(resourceGroup().id)}'\n\n@description('Storage Account type')\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Location for Application Insights')\nparam appInsightsLocation string = resourceGroup().location\n\n@description('The language worker runtime to load in the function app.')\n@allowed([\n  'dotnet'\n  'node'\n  'python'\n  'java'\n])\nparam functionWorkerRuntime string = 'node'\n\n@description('Required for Linux app to represent runtime stack in the format of \\'runtime|runtimeVersion\\'. For example: \\'python|3.9\\'')\nparam linuxFxVersion string\n\n@description('The zip content url.')\nparam packageUri string\n\nvar hostingPlanName = functionAppName\nvar applicationInsightsName = functionAppName\nvar storageAccountName = '${uniqueString(resourceGroup().id)}azfunctions'\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'Storage'\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    name: 'Y1'\n    tier: 'Dynamic'\n    size: 'Y1'\n    family: 'Y'\n  }\n  properties: {\n    reserved: true\n  }\n}\n\nresource applicationInsight 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: appInsightsLocation\n  tags: {\n    'hidden-link:${resourceId('Microsoft.Web/sites', functionAppName)}': 'Resource'\n  }\n  properties: {\n    Application_Type: 'web'\n  }\n  kind: 'web'\n}\n\nresource functionApp 'Microsoft.Web/sites@2022-03-01' = {\n  name: functionAppName\n  location: location\n  kind: 'functionapp,linux'\n  properties: {\n    reserved: true\n    serverFarmId: hostingPlan.id\n    siteConfig: {\n      linuxFxVersion: linuxFxVersion\n      appSettings: [\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: reference(resourceId('Microsoft.Insights/components', functionAppName), '2020-02-02').InstrumentationKey\n        }\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTSHARE'\n          value: toLower(functionAppName)\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n        {\n          name: 'WEBSITE_RUN_FROM_PACKAGE'\n          value: packageUri\n        }\n      ]\n    }\n  }\n  dependsOn: [\n    applicationInsight\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1324?"}, {"role": "assistant", "content": "@description('The name of the Azure Function app.')\nparam functionAppName string = 'func-${uniqueString(resourceGroup().id)}'\n\n@description('The location into which the resources should be deployed.')\nparam location string = resourceGroup().location\n\n@description('The language worker runtime to load in the function app.')\n@allowed([\n  'dotnet'\n  'node'\n  'python'\n  'java'\n])\nparam functionWorkerRuntime string = 'node'\n\n@description('Specifies the OS used for the Azure Function hosting plan.')\n@allowed([\n  'Windows'\n  'Linux'\n])\nparam functionPlanOS string = 'Windows'\n\n@description('Specifies the Azure Function hosting plan SKU.')\n@allowed([\n  'EP1'\n  'EP2'\n  'EP3'\n])\nparam functionAppPlanSku string = 'EP1'\n\n@description('The name of the Azure Function hosting plan.')\nparam functionAppPlanName string = 'plan-${uniqueString(resourceGroup().id)}'\n\n@description('The name of the backend Azure storage account used by the Azure Function app.')\nparam functionStorageAccountName string = 'st${uniqueString(resourceGroup().id)}'\n\n@description('The name of the virtual network for virtual network integration.')\nparam vnetName string = 'vnet-${uniqueString(resourceGroup().id)}'\n\n@description('The name of the virtual network subnet to be associated with the Azure Function app.')\nparam functionSubnetName string = 'snet-func'\n\n@description('The name of the virtual network subnet used for allocating IP addresses for private endpoints.')\nparam privateEndpointSubnetName string = 'snet-pe'\n\n@description('The IP adddress space used for the virtual network.')\nparam vnetAddressPrefix string = '10.100.0.0/16'\n\n@description('The IP address space used for the Azure Function integration subnet.')\nparam functionSubnetAddressPrefix string = '10.100.0.0/24'\n\n@description('The IP address space used for the private endpoints.')\nparam privateEndpointSubnetAddressPrefix string = '10.100.1.0/24'\n\n@description('Only required for Linux app to represent runtime stack in the format of \\'runtime|runtimeVersion\\'. For example: \\'python|3.9\\'')\nparam linuxFxVersion string = ''\n\nvar applicationInsightsName = 'appi-${uniqueString(resourceGroup().id)}'\nvar privateFunctionAppDnsZoneName = 'privatelink.azurewebsites.net'\nvar privateEndpointFunctionAppName = '${functionAppName}-private-endpoint'\nvar privateStorageFileDnsZoneName = 'privatelink.file.${environment().suffixes.storage}'\nvar privateEndpointStorageFileName = '${functionStorageAccountName}-file-private-endpoint'\nvar privateStorageTableDnsZoneName = 'privatelink.table.${environment().suffixes.storage}'\nvar privateEndpointStorageTableName = '${functionStorageAccountName}-table-private-endpoint'\nvar privateStorageBlobDnsZoneName = 'privatelink.blob.${environment().suffixes.storage}'\nvar privateEndpointStorageBlobName = '${functionStorageAccountName}-blob-private-endpoint'\nvar privateStorageQueueDnsZoneName = 'privatelink.queue.${environment().suffixes.storage}'\nvar privateEndpointStorageQueueName = '${functionStorageAccountName}-queue-private-endpoint'\nvar functionContentShareName = 'function-content-share'\nvar isReserved = ((functionPlanOS == 'Linux') ? true : false)\n\nresource vnet 'Microsoft.Network/virtualNetworks@2022-05-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: functionSubnetName\n        properties: {\n          privateEndpointNetworkPolicies: 'Enabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n          delegations: [\n            {\n              name: 'webapp'\n              properties: {\n                serviceName: 'Microsoft.Web/serverFarms'\n              }\n            }\n          ]\n          addressPrefix: functionSubnetAddressPrefix\n        }\n      }\n      {\n        name: privateEndpointSubnetName\n        properties: {\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n          addressPrefix: privateEndpointSubnetAddressPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource privateStorageFileDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateStorageFileDnsZoneName\n  location: 'global'\n}\n\nresource privateStorageBlobDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateStorageBlobDnsZoneName\n  location: 'global'\n}\n\nresource privateStorageQueueDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateStorageQueueDnsZoneName\n  location: 'global'\n}\n\nresource privateStorageTableDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateStorageTableDnsZoneName\n  location: 'global'\n}\n\nresource privateStorageFileDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateStorageFileDnsZone\n  name: '${privateStorageFileDnsZoneName}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n\nresource privateStorageBlobDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateStorageBlobDnsZone\n  name: '${privateStorageBlobDnsZoneName}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n\nresource privateStorageTableDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateStorageTableDnsZone\n  name: '${privateStorageTableDnsZoneName}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n\nresource privateStorageQueueDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateStorageQueueDnsZone\n  name: '${privateStorageQueueDnsZoneName}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n\nresource privateEndpointStorageFile 'Microsoft.Network/privateEndpoints@2022-05-01' = {\n  name: privateEndpointStorageFileName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, privateEndpointSubnetName)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: 'MyStorageFilePrivateLinkConnection'\n        properties: {\n          privateLinkServiceId: storageAccount.id\n          groupIds: [\n            'file'\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource privateEndpointStorageBlob 'Microsoft.Network/privateEndpoints@2022-05-01' = {\n  name: privateEndpointStorageBlobName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, privateEndpointSubnetName)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: 'MyStorageBlobPrivateLinkConnection'\n        properties: {\n          privateLinkServiceId: storageAccount.id\n          groupIds: [\n            'blob'\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource privateEndpointStorageTable 'Microsoft.Network/privateEndpoints@2022-05-01' = {\n  name: privateEndpointStorageTableName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, privateEndpointSubnetName)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: 'MyStorageTablePrivateLinkConnection'\n        properties: {\n          privateLinkServiceId: storageAccount.id\n          groupIds: [\n            'table'\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource privateEndpointStorageQueue 'Microsoft.Network/privateEndpoints@2022-05-01' = {\n  name: privateEndpointStorageQueueName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, privateEndpointSubnetName)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: 'MyStorageQueuePrivateLinkConnection'\n        properties: {\n          privateLinkServiceId: storageAccount.id\n          groupIds: [\n            'queue'\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource privateEndpointStorageFilePrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-05-01' = {\n  parent: privateEndpointStorageFile\n  name: 'filePrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config'\n        properties: {\n          privateDnsZoneId: privateStorageFileDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource privateEndpointStorageBlobPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-05-01' = {\n  parent: privateEndpointStorageBlob\n  name: 'blobPrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config'\n        properties: {\n          privateDnsZoneId: privateStorageBlobDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource privateEndpointStorageTablePrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-05-01' = {\n  parent: privateEndpointStorageTable\n  name: 'tablePrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config'\n        properties: {\n          privateDnsZoneId: privateStorageTableDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource privateEndpointStorageQueuePrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-05-01' = {\n  parent: privateEndpointStorageQueue\n  name: 'queuePrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config'\n        properties: {\n          privateDnsZoneId: privateStorageQueueDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\n  name: functionStorageAccountName\n  location: location\n  kind: 'StorageV2'\n  sku: {\n    name: 'Standard_LRS'\n  }\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    allowBlobPublicAccess: false\n    networkAcls: {\n      bypass: 'None'\n      defaultAction: 'Deny'\n    }\n  }\n}\n\nresource fileService 'Microsoft.Storage/storageAccounts/fileServices/shares@2022-05-01' = {\n  name: '${functionStorageAccountName}/default/${functionContentShareName}'\n  dependsOn: [\n    storageAccount\n  ]\n}\n\nresource applicationInsight 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: location\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n  }\n}\n\nresource functionAppPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: functionAppPlanName\n  location: location\n  sku: {\n    tier: 'ElasticPremium'\n    name: functionAppPlanSku\n    size: functionAppPlanSku\n    family: 'EP'\n  }\n  kind: 'elastic'\n  properties: {\n    maximumElasticWorkerCount: 20\n    reserved: isReserved\n  }\n}\n\nresource site 'Microsoft.Web/sites@2022-03-01' = {\n  name: functionAppName\n  location: location\n  kind: (isReserved ? 'functionapp,linux' : 'functionapp')\n  properties: {\n    reserved: isReserved\n    serverFarmId: functionAppPlan.id\n    siteConfig: {\n      functionsRuntimeScaleMonitoringEnabled: true\n      linuxFxVersion: (isReserved ? linuxFxVersion : json('null'))\n      appSettings: [\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: applicationInsight.properties.InstrumentationKey\n        }\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${functionStorageAccountName};AccountKey=${storageAccount.listkeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${functionStorageAccountName};AccountKey=${storageAccount.listkeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTSHARE'\n          value: functionContentShareName\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n        {\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\n          value: '~14'\n        }\n        {\n          name: 'WEBSITE_VNET_ROUTE_ALL'\n          value: '1'\n        }\n        {\n          name: 'WEBSITE_CONTENTOVERVNET'\n          value: '1'\n        }\n      ]\n    }\n  }\n  dependsOn: [\n    fileService\n    privateStorageFileDnsZoneLink\n    privateEndpointStorageFilePrivateDnsZoneGroup\n    privateStorageBlobDnsZoneLink\n    privateEndpointStorageBlobPrivateDnsZoneGroup\n    privateStorageTableDnsZoneLink\n    privateEndpointStorageTablePrivateDnsZoneGroup\n    privateStorageQueueDnsZoneLink\n    privateEndpointStorageQueuePrivateDnsZoneGroup\n  ]\n}\n\nresource networkConfig 'Microsoft.Web/sites/networkConfig@2022-03-01' = {\n  parent: site\n  name: 'virtualNetwork'\n  properties: {\n    subnetResourceId: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, functionSubnetName)\n    swiftSupported: true\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource privateFunctionAppDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateFunctionAppDnsZoneName\n  location: 'global'\n}\n\nresource privateDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateFunctionAppDnsZone\n  name: '${privateFunctionAppDnsZoneName}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2022-05-01' = {\n  name: privateEndpointFunctionAppName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, privateEndpointSubnetName)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: 'MyFunctionAppPrivateLinkConnection'\n        properties: {\n          privateLinkServiceId: site.id\n          groupIds: [\n            'sites'\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource privateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-05-01' = {\n  parent: privateEndpoint\n  name: 'funcPrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config'\n        properties: {\n          privateDnsZoneId: privateFunctionAppDnsZone.id\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1325."}, {"role": "assistant", "content": "@description('The name of the Azure Function app.')\nparam functionAppName string = 'func-${uniqueString(resourceGroup().id)}'\n\n@description('The location into which the resources should be deployed.')\nparam location string = resourceGroup().location\n\n@description('The language worker runtime to load in the function app.')\n@allowed([\n  'dotnet'\n  'node'\n  'python'\n  'java'\n])\nparam functionWorkerRuntime string = 'node'\n\n@description('Specifies the OS used for the Azure Function hosting plan.')\n@allowed([\n  'Windows'\n  'Linux'\n])\nparam functionPlanOS string = 'Windows'\n\n@description('Specifies the Azure Function hosting plan SKU.')\n@allowed([\n  'EP1'\n  'EP2'\n  'EP3'\n])\nparam functionAppPlanSku string = 'EP1'\n\n@description('The name of the Azure Function hosting plan.')\nparam functionAppPlanName string = 'plan-${uniqueString(resourceGroup().id)}'\n\n@description('The name of the backend Azure storage account used by the Azure Function app.')\nparam functionStorageAccountName string = 'st${uniqueString(resourceGroup().id)}'\n\n@description('The name of the virtual network for virtual network integration.')\nparam vnetName string = 'vnet-${uniqueString(resourceGroup().id)}'\n\n@description('The name of the virtual network subnet to be associated with the Azure Function app.')\nparam functionSubnetName string = 'snet-func'\n\n@description('The name of the virtual network subnet used for allocating IP addresses for private endpoints.')\nparam privateEndpointSubnetName string = 'snet-pe'\n\n@description('The IP adddress space used for the virtual network.')\nparam vnetAddressPrefix string = '10.100.0.0/16'\n\n@description('The IP address space used for the Azure Function integration subnet.')\nparam functionSubnetAddressPrefix string = '10.100.0.0/24'\n\n@description('The IP address space used for the private endpoints.')\nparam privateEndpointSubnetAddressPrefix string = '10.100.1.0/24'\n\n@description('Only required for Linux app to represent runtime stack in the format of \\'runtime|runtimeVersion\\'. For example: \\'python|3.9\\'')\nparam linuxFxVersion string = ''\n\nvar applicationInsightsName = 'appi-${uniqueString(resourceGroup().id)}'\nvar privateStorageFileDnsZoneName = 'privatelink.file.${environment().suffixes.storage}'\nvar privateEndpointStorageFileName = '${functionStorageAccountName}-file-private-endpoint'\nvar privateStorageTableDnsZoneName = 'privatelink.table.${environment().suffixes.storage}'\nvar privateEndpointStorageTableName = '${functionStorageAccountName}-table-private-endpoint'\nvar privateStorageBlobDnsZoneName = 'privatelink.blob.${environment().suffixes.storage}'\nvar privateEndpointStorageBlobName = '${functionStorageAccountName}-blob-private-endpoint'\nvar privateStorageQueueDnsZoneName = 'privatelink.queue.${environment().suffixes.storage}'\nvar privateEndpointStorageQueueName = '${functionStorageAccountName}-queue-private-endpoint'\nvar functionContentShareName = 'function-content-share'\nvar isReserved = ((functionPlanOS == 'Linux') ? true : false)\n\nresource vnet 'Microsoft.Network/virtualNetworks@2022-05-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: functionSubnetName\n        properties: {\n          privateEndpointNetworkPolicies: 'Enabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n          delegations: [\n            {\n              name: 'webapp'\n              properties: {\n                serviceName: 'Microsoft.Web/serverFarms'\n              }\n            }\n          ]\n          addressPrefix: functionSubnetAddressPrefix\n        }\n      }\n      {\n        name: privateEndpointSubnetName\n        properties: {\n          privateEndpointNetworkPolicies: 'Disabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n          addressPrefix: privateEndpointSubnetAddressPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource privateStorageFileDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateStorageFileDnsZoneName\n  location: 'global'\n}\n\nresource privateStorageBlobDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateStorageBlobDnsZoneName\n  location: 'global'\n}\n\nresource privateStorageQueueDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateStorageQueueDnsZoneName\n  location: 'global'\n}\n\nresource privateStorageTableDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateStorageTableDnsZoneName\n  location: 'global'\n}\n\nresource privateStorageFileDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateStorageFileDnsZone\n  name: '${privateStorageFileDnsZoneName}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n\nresource privateStorageBlobDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateStorageBlobDnsZone\n  name: '${privateStorageBlobDnsZoneName}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n\nresource privateStorageTableDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateStorageTableDnsZone\n  name: '${privateStorageTableDnsZoneName}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n\nresource privateStorageQueueDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateStorageQueueDnsZone\n  name: '${privateStorageQueueDnsZoneName}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: vnet.id\n    }\n  }\n}\n\nresource privateEndpointStorageFilePrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-05-01' = {\n  parent: privateEndpointStorageFile\n  name: 'filePrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config'\n        properties: {\n          privateDnsZoneId: privateStorageFileDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource privateEndpointStorageBlobPrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-05-01' = {\n  parent: privateEndpointStorageBlob\n  name: 'blobPrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config'\n        properties: {\n          privateDnsZoneId: privateStorageBlobDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource privateEndpointStorageTablePrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-05-01' = {\n  parent: privateEndpointStorageTable\n  name: 'tablePrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config'\n        properties: {\n          privateDnsZoneId: privateStorageTableDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource privateEndpointStorageQueuePrivateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-05-01' = {\n  parent: privateEndpointStorageQueue\n  name: 'queuePrivateDnsZoneGroup'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config'\n        properties: {\n          privateDnsZoneId: privateStorageQueueDnsZone.id\n        }\n      }\n    ]\n  }\n}\n\nresource privateEndpointStorageFile 'Microsoft.Network/privateEndpoints@2022-05-01' = {\n  name: privateEndpointStorageFileName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, privateEndpointSubnetName)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: 'MyStorageFilePrivateLinkConnection'\n        properties: {\n          privateLinkServiceId: functionStorageAccount.id\n          groupIds: [\n            'file'\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource privateEndpointStorageBlob 'Microsoft.Network/privateEndpoints@2022-05-01' = {\n  name: privateEndpointStorageBlobName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, privateEndpointSubnetName)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: 'MyStorageBlobPrivateLinkConnection'\n        properties: {\n          privateLinkServiceId: functionStorageAccount.id\n          groupIds: [\n            'blob'\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource privateEndpointStorageTable 'Microsoft.Network/privateEndpoints@2022-05-01' = {\n  name: privateEndpointStorageTableName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, privateEndpointSubnetName)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: 'MyStorageTablePrivateLinkConnection'\n        properties: {\n          privateLinkServiceId: functionStorageAccount.id\n          groupIds: [\n            'table'\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource privateEndpointStorageQueue 'Microsoft.Network/privateEndpoints@2022-05-01' = {\n  name: privateEndpointStorageQueueName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, privateEndpointSubnetName)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: 'MyStorageQueuePrivateLinkConnection'\n        properties: {\n          privateLinkServiceId: functionStorageAccount.id\n          groupIds: [\n            'queue'\n          ]\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource functionStorageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\n  name: functionStorageAccountName\n  location: location\n  kind: 'StorageV2'\n  sku: {\n    name: 'Standard_LRS'\n  }\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    allowBlobPublicAccess: false\n    networkAcls: {\n      bypass: 'None'\n      defaultAction: 'Deny'\n    }\n  }\n}\n\nresource share 'Microsoft.Storage/storageAccounts/fileServices/shares@2022-05-01' = {\n  name: '${functionStorageAccountName}/default/${functionContentShareName}'\n  dependsOn: [\n    functionStorageAccount\n  ]\n}\n\nresource applicationInsight 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: location\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n  }\n}\n\nresource functionAppPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: functionAppPlanName\n  location: location\n  sku: {\n    tier: 'ElasticPremium'\n    name: functionAppPlanSku\n    size: functionAppPlanSku\n    family: 'EP'\n  }\n  kind: 'elastic'\n  properties: {\n    maximumElasticWorkerCount: 20\n    reserved: isReserved\n  }\n}\n\nresource functionApp 'Microsoft.Web/sites@2022-03-01' = {\n  name: functionAppName\n  location: location\n  kind: (isReserved ? 'functionapp,linux' : 'functionapp')\n  properties: {\n    reserved: isReserved\n    serverFarmId: functionAppPlan.id\n    siteConfig: {\n      functionsRuntimeScaleMonitoringEnabled: true\n      linuxFxVersion: (isReserved ? linuxFxVersion : json('null'))\n      appSettings: [\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: applicationInsight.properties.InstrumentationKey\n        }\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${functionStorageAccountName};AccountKey=${functionStorageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${functionStorageAccountName};AccountKey=${functionStorageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTSHARE'\n          value: functionContentShareName\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n        {\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\n          value: '~14'\n        }\n        {\n          name: 'WEBSITE_VNET_ROUTE_ALL'\n          value: '1'\n        }\n        {\n          name: 'WEBSITE_CONTENTOVERVNET'\n          value: '1'\n        }\n      ]\n    }\n  }\n  dependsOn: [\n    share\n    privateStorageFileDnsZoneLink\n    privateEndpointStorageFilePrivateDnsZoneGroup\n    privateStorageBlobDnsZoneLink\n    privateEndpointStorageBlobPrivateDnsZoneGroup\n    privateStorageTableDnsZoneLink\n    privateEndpointStorageTablePrivateDnsZoneGroup\n    privateStorageQueueDnsZoneLink\n    privateEndpointStorageQueuePrivateDnsZoneGroup\n  ]\n}\n\nresource networkConfig 'Microsoft.Web/sites/networkConfig@2022-03-01' = {\n  parent: functionApp\n  name: 'virtualNetwork'\n  properties: {\n    subnetResourceId: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, functionSubnetName)\n    swiftSupported: true\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1326."}, {"role": "assistant", "content": "@description('The name of the Azure Function app.')\nparam functionAppName string = 'func-${uniqueString(resourceGroup().id)}'\n\n@description('Storage Account type')\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Location for Application Insights')\nparam appInsightsLocation string = resourceGroup().location\n\n@description('The language worker runtime to load in the function app.')\n@allowed([\n  'dotnet'\n  'node'\n  'python'\n  'java'\n])\nparam functionWorkerRuntime string = 'node'\n\n@description('Specifies the OS used for the Azure Function hosting plan.')\n@allowed([\n  'Windows'\n  'Linux'\n])\nparam functionPlanOS string = 'Windows'\n\n@description('Specifies the Azure Function hosting plan SKU.')\n@allowed([\n  'EP1'\n  'EP2'\n  'EP3'\n])\nparam functionAppPlanSku string = 'EP1'\n\n@description('The name of the virtual network to be created.')\nparam vnetName string = 'vnet-${uniqueString(resourceGroup().id)}'\n\n@description('The name of the subnet to be created within the virtual network.')\nparam subnetName string = 'subnet-${uniqueString(resourceGroup().id)}'\n\n@description('Only required for Linux app to represent runtime stack in the format of \\'runtime|runtimeVersion\\'. For example: \\'python|3.9\\'')\nparam linuxFxVersion string = ''\n\nvar vnetAddressPrefix = '10.0.0.0/16'\nvar subnetAddressPrefix = '10.0.0.0/24'\nvar hostingPlanName = functionAppName\nvar applicationInsightsName = functionAppName\nvar storageAccountName = '${uniqueString(resourceGroup().id)}azfunctions'\nvar isReserved = ((functionPlanOS == 'Linux') ? true : false)\n\nresource vnet 'Microsoft.Network/virtualNetworks@2022-05-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: subnetAddressPrefix\n          delegations: [\n            {\n              name: 'delegation'\n              properties: {\n                serviceName: 'Microsoft.Web/serverFarms'\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'Storage'\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    tier: 'ElasticPremium'\n    name: functionAppPlanSku\n    family: 'EP'\n  }\n  properties: {\n    maximumElasticWorkerCount: 20\n    reserved: isReserved\n  }\n  kind: 'elastic'\n}\n\nresource insight 'Microsoft.Insights/components@2020-02-02' = {\n  name: applicationInsightsName\n  location: appInsightsLocation\n  tags: {\n    'hidden-link:${resourceId('Microsoft.Web/sites', applicationInsightsName)}': 'Resource'\n  }\n  properties: {\n    Application_Type: 'web'\n  }\n  kind: 'web'\n}\n\nresource site 'Microsoft.Web/sites@2022-03-01' = {\n  name: functionAppName\n  location: location\n  kind: (isReserved ? 'functionapp,linux' : 'functionapp')\n  properties: {\n    reserved: isReserved\n    serverFarmId: hostingPlan.id\n    siteConfig: {\n      linuxFxVersion: (isReserved ? linuxFxVersion : json('null'))\n      appSettings: [\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: insight.properties.InstrumentationKey\n        }\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix= ${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value};'\n        }\n        {\n          name: 'WEBSITE_CONTENTSHARE'\n          value: toLower(functionAppName)\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n        {\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\n          value: '~14'\n        }\n      ]\n    }\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n\nresource functionAppName_virtualNetwork 'Microsoft.Web/sites/networkConfig@2022-03-01' = {\n  parent: site\n  name: 'virtualNetwork'\n  properties: {\n    subnetResourceId: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, subnetName)\n    swiftSupported: true\n  }\n  dependsOn: [\n    vnet\n  ]\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1327."}, {"role": "assistant", "content": "@description('Specifies region of all resources.')\nparam location string = resourceGroup().location\n\n@description('Suffix for function app, storage account, and key vault names.')\nparam appNameSuffix string = uniqueString(resourceGroup().id)\n\n@description('Key Vault SKU name.')\nparam keyVaultSku string = 'Standard'\n\n@description('Storage account SKU name.')\nparam storageSku string = 'Standard_LRS'\n\nvar functionAppName = 'fn-${appNameSuffix}'\nvar appServicePlanName = 'FunctionPlan-${appNameSuffix}'\nvar appInsightsName = 'AppInsights-${appNameSuffix}'\nvar storageAccountName = 'fnstor${replace(appNameSuffix, '-', '')}'\nvar functionNameComputed = 'MyHttpTriggeredFunction'\nvar functionRuntime = 'dotnet'\nvar keyVaultName = 'kv${replace(appNameSuffix, '-', '')}'\nvar functionAppKeySecretName = 'FunctionAppHostKey'\nvar workspaceName = 'workspace-${appNameSuffix}'\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-04-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: storageSku\n  }\n  kind: 'StorageV2'\n  properties: {\n    supportsHttpsTrafficOnly: true\n    encryption: {\n      services: {\n        file: {\n          keyType: 'Account'\n          enabled: true\n        }\n        blob: {\n          keyType: 'Account'\n          enabled: true\n        }\n      }\n      keySource: 'Microsoft.Storage'\n    }\n    accessTier: 'Hot'\n  }\n}\n\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {\n  name: workspaceName\n  location: location\n}\n\nresource appInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: appInsightsName\n  location: location\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    publicNetworkAccessForIngestion: 'Enabled'\n    publicNetworkAccessForQuery: 'Enabled'\n    WorkspaceResourceId: logAnalyticsWorkspace.id\n  }\n}\n\nresource plan 'Microsoft.Web/serverfarms@2020-12-01' = {\n  name: appServicePlanName\n  location: location\n  kind: 'functionapp'\n  sku: {\n    name: 'Y1'\n  }\n  properties: {}\n}\n\nresource functionApp 'Microsoft.Web/sites@2020-12-01' = {\n  name: functionAppName\n  location: location\n  kind: 'functionapp'\n  properties: {\n    serverFarmId: plan.id\n    siteConfig: {\n      appSettings: [\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccount.name};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccount.name};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: appInsights.properties.InstrumentationKey\n        }\n        {\n          name: 'APPLICATIONINSIGHTS_CONNECTION_STRING'\n          value: 'InstrumentationKey=${appInsights.properties.InstrumentationKey}'\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionRuntime\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n      ]\n    }\n    httpsOnly: true\n  }\n}\n\nresource function 'Microsoft.Web/sites/functions@2020-12-01' = {\n  parent: functionApp\n  name: functionNameComputed\n  properties: {\n    config: {\n      disabled: false\n      bindings: [\n        {\n          name: 'req'\n          type: 'httpTrigger'\n          direction: 'in'\n          authLevel: 'function'\n          methods: [\n            'get'\n          ]\n        }\n        {\n          name: '$return'\n          type: 'http'\n          direction: 'out'\n        }\n      ]\n    }\n    files: {\n      'run.csx': loadTextContent('run.csx')\n    }\n  }\n}\n\nresource keyVault 'Microsoft.KeyVault/vaults@2019-09-01' = {\n  name: keyVaultName\n  location: location\n  properties: {\n    tenantId: subscription().tenantId\n    sku: {\n      family: 'A'\n      name: keyVaultSku\n    }\n    accessPolicies: []\n  }\n}\n\nresource keyVaultSecret 'Microsoft.KeyVault/vaults/secrets@2019-09-01' = {\n  parent: keyVault\n  name: functionAppKeySecretName\n  properties: {\n    value: listKeys('${functionApp.id}/host/default', functionApp.apiVersion).functionKeys.default\n  }\n}\n\noutput functionAppHostName string = functionApp.properties.defaultHostName\noutput functionName string = functionNameComputed\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1328 please."}, {"role": "assistant", "content": "@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('The language worker runtime to load in the function app.')\n@allowed([\n  'node'\n  'dotnet'\n  'java'\n])\nparam runtime string = 'dotnet'\n\n@description('The name of the function app that you wish to create.')\nparam appName string = 'fnapp${uniqueString(resourceGroup().id)}'\n\nvar functionAppName = appName\nvar hostingPlanName = appName\nvar storageAccountName = '${uniqueString(resourceGroup().id)}azfunctions'\nvar functionWorkerRuntime = runtime\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-04-01' = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_ZRS'\n  }\n  kind: 'StorageV2'\n}\n\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2021-06-01' = {\n  name: 'log-${functionAppName}'\n  location: location\n  properties: {\n    sku: {\n      name: 'PerGB2018'\n    }\n  }\n}\n\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: 'ai-${functionAppName}'\n  location: location\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    WorkspaceResourceId: logAnalyticsWorkspace.id\n  }\n}\n\nresource serverFarm 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    name: 'EP1'\n    tier: 'ElasticPremium'\n    capacity: 3\n  }\n  kind: 'elastic'\n  properties: {\n    maximumElasticWorkerCount: 20\n    zoneRedundant: true\n  }\n}\n\nresource function 'Microsoft.Web/sites@2022-03-01' = {\n  name: functionAppName\n  location: location\n  kind: 'functionapp'\n  properties: {\n    serverFarmId: serverFarm.id\n    siteConfig: {\n      appSettings: [\n        {\n          name: 'APPLICATIONINSIGHTS_CONNECTION_STRING'\n          value: 'InstrumentationKey=${applicationInsights.properties.InstrumentationKey}'\n        }\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccount.name};EndpointSuffix= ${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccountName};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value};'\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n      ]\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1329?"}, {"role": "assistant", "content": "@description('Function app name.')\nparam functionAppName string = 'func-${uniqueString(resourceGroup().id)}'\n\n@description('Frontdoor name.')\nparam frontdoorName string = 'fd-${uniqueString(resourceGroup().id)}'\n\n@description('Waf policy name.')\nparam wafPolicyName string = 'waf${uniqueString(resourceGroup().id)}'\n\n@description('Message for the private link request approval.')\nparam frontdoorPrivateLinkRequestMessage string = 'Hi, I want to add frontdoor to functions'\n\n@description('Function app web app plan name.')\nparam appPlanName string = 'plan-${uniqueString(resourceGroup().id)}'\n\n@description('Application Insights name.')\nparam appInsightsName string = 'appi-${uniqueString(resourceGroup().id)}'\n\n@description('Storage account name.')\nparam storageAccountName string = 'st${uniqueString(resourceGroup().id)}'\n\n@description('Name of the virtual network.')\nparam vNetName string = 'vnet-${uniqueString(resourceGroup().id)}'\n\n@description('Name of the private endpoint.')\nparam privateEndpointName string = 'pve-${uniqueString(resourceGroup().id)}'\n\n@description('Storage Account type')\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\n@description('Location for Application Insights')\nparam appInsightsLocation string = resourceGroup().location\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('The SKU of App Service Plan.')\n@allowed([\n  'EP1'\n  'EP2'\n  'EP3'\n])\nparam sku string = 'EP1'\n\nvar blobStoragePrivateLinkZoneName = 'privatelink.blob.${environment().suffixes.storage}'\nvar filesStoragePrivateLinkZoneName = 'privatelink.file.${environment().suffixes.storage}'\n\n// Storage\nresource storageAccount 'Microsoft.Storage/storageAccounts@2021-09-01' = {\n  name: storageAccountName\n  location: location\n  kind: 'StorageV2'\n  sku: {\n    name: storageAccountType\n  }\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    supportsHttpsTrafficOnly: true\n    allowBlobPublicAccess: false\n    minimumTlsVersion: 'TLS1_2'\n    networkAcls: {\n      defaultAction: 'Deny'\n      bypass: 'None'\n    }\n  }\n}\n\nresource fileServices 'Microsoft.Storage/storageAccounts/fileServices@2021-09-01' existing = {\n  name: 'default'\n  parent: storageAccount\n}\n\nresource functionContentShare 'Microsoft.Storage/storageAccounts/fileServices/shares@2021-04-01' = {\n  name: toLower(replace(functionAppName, '-', ''))\n  parent: fileServices\n}\n\n// Network\nresource vnet 'Microsoft.Network/virtualNetworks@2022-01-01' = {\n  name: vNetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/20'\n      ]\n    }\n    subnets: [\n      {\n        name: 'data'\n        properties: {\n          privateEndpointNetworkPolicies: 'Enabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n          addressPrefix: '10.0.0.0/24'\n        }\n      }\n      {\n        name: 'function'\n        properties: {\n          addressPrefix: '10.0.1.0/24'\n          privateEndpointNetworkPolicies: 'Enabled'\n          privateLinkServiceNetworkPolicies: 'Enabled'\n          delegations: [\n            {\n              name: 'AzureFunctions'\n              properties: {\n                serviceName: 'Microsoft.Web/serverFarms'\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource dataSubnet 'Microsoft.Network/virtualNetworks/subnets@2022-01-01' existing = {\n  name: 'data'\n  parent: vnet\n}\n\nresource functionSubnet 'Microsoft.Network/virtualNetworks/subnets@2022-01-01' existing = {\n  name: 'function'\n  parent: vnet\n}\n\n// Private Endpoints\nresource blobStoragePrivateDns 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: blobStoragePrivateLinkZoneName\n  location: 'global'\n  resource blobStoragePrivateDnsVnetLink 'virtualNetworkLinks' = {\n    name: 'link-${blobStoragePrivateLinkZoneName}'\n    location: 'global'\n    properties: {\n      registrationEnabled: false\n      virtualNetwork: {\n        id: vnet.id\n      }\n    }\n  }\n}\n\nresource filesStoragePrivateDns 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: filesStoragePrivateLinkZoneName\n  location: 'global'\n  resource filesStoragePrivateDnsVnetLink 'virtualNetworkLinks' = {\n    name: 'link-${filesStoragePrivateLinkZoneName}'\n    location: 'global'\n    properties: {\n      registrationEnabled: false\n      virtualNetwork: {\n        id: vnet.id\n      }\n    }\n  }\n}\n\nresource privateEndpointBlobStorage 'Microsoft.Network/privateEndpoints@2022-01-01' = {\n  name: '${privateEndpointName}-blob'\n  location: location\n  dependsOn: [\n    functionSubnet\n  ]\n  properties: {\n    subnet: {\n      id: dataSubnet.id\n    }\n    privateLinkServiceConnections: [\n      {\n        name: '${privateEndpointName}-blob'\n        properties: {\n          privateLinkServiceId: storageAccount.id\n          groupIds: [\n            'blob'\n          ]\n        }\n      }\n    ]\n  }\n  resource privateEndpointBlobStorageDnsEntry 'privateDnsZoneGroups' = {\n    name: blobStoragePrivateDns.name\n    properties: {\n      privateDnsZoneConfigs: [\n        {\n          name: 'config1'\n          properties: {\n            privateDnsZoneId: blobStoragePrivateDns.id\n          }\n        }\n      ]\n    }\n  }\n}\n\nresource privateEndpointFilesStorage 'Microsoft.Network/privateEndpoints@2022-01-01' = {\n  name: '${privateEndpointName}-files'\n  location: location\n  dependsOn: [\n    functionSubnet\n  ]\n  properties: {\n    subnet: {\n      id: dataSubnet.id\n    }\n    privateLinkServiceConnections: [\n      {\n        name: '${privateEndpointName}-files'\n        properties: {\n          privateLinkServiceId: storageAccount.id\n          groupIds: [\n            'file'\n          ]\n        }\n      }\n    ]\n  }\n  resource privateEndpointFilesStorageDnsEntry 'privateDnsZoneGroups' = {\n    name: filesStoragePrivateDns.name\n    properties: {\n      privateDnsZoneConfigs: [\n        {\n          name: 'config1'\n          properties: {\n            privateDnsZoneId: filesStoragePrivateDns.id\n          }\n        }\n      ]\n    }\n  }\n}\n\n// App Insights\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: appInsightsName\n  location: appInsightsLocation\n  tags: {\n    'hidden-link:${resourceId('Microsoft.Web/sites', functionAppName)}': 'Resource'\n  }\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    Request_Source: 'IbizaWebAppExtensionCreate'\n  }\n}\n\n// Function App\nresource appServicePlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: appPlanName\n  location: location\n  sku: {\n    tier: 'ElasticPremium'\n    family: 'EP'\n    size: sku\n    name: sku\n  }\n  kind: 'elastic'\n  properties: {\n    maximumElasticWorkerCount: 20\n  }\n}\n\nresource functionApp 'Microsoft.Web/sites@2022-03-01' = {\n  name: functionAppName\n  location: location\n  kind: 'functionapp'\n  dependsOn: [\n    privateEndpointBlobStorage\n    privateEndpointFilesStorage\n  ]\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    publicNetworkAccess: 'Disabled'\n    serverFarmId: appServicePlan.id\n    virtualNetworkSubnetId: functionSubnet.id\n    httpsOnly: true\n    siteConfig: {\n      vnetRouteAllEnabled: true\n      functionsRuntimeScaleMonitoringEnabled: true\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      appSettings: [\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: applicationInsights.properties.InstrumentationKey\n        }\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccount.name};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccount.name};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: 'dotnet'\n        }\n        {\n          name: 'WEBSITE_CONTENTOVERVNET'\n          value: '1'\n        }\n        {\n          name: 'WEBSITE_CONTENTSHARE'\n          value: toLower(replace(functionAppName, '-', ''))\n        }\n        {\n          name: 'WEBSITE_DNS_SERVER'\n          value: '168.63.129.16'\n        }\n      ]\n    }\n  }\n}\n\nresource functionVNetIntegration 'Microsoft.Web/sites/networkConfig@2022-03-01' = {\n  name: 'virtualNetwork'\n  parent: functionApp\n  properties: {\n    subnetResourceId: functionSubnet.id\n  }\n}\n\n// Frontdoor\nresource frontdoorProfile 'Microsoft.Cdn/profiles@2021-06-01' = {\n  name: frontdoorName\n  location: 'Global'\n  sku: {\n    name: 'Premium_AzureFrontDoor'\n  }\n}\n\nresource frontdoorEndpoint 'Microsoft.Cdn/profiles/afdEndpoints@2021-06-01' = {\n  name: frontdoorName\n  location: 'Global'\n  parent: frontdoorProfile\n}\n\nresource frontdoorOriginGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\n  name: location\n  parent: frontdoorProfile\n  properties: {\n    healthProbeSettings: {\n      probePath: '/'\n      probeIntervalInSeconds: 120\n      probeProtocol: 'Https'\n      probeRequestType: 'HEAD'\n    }\n    loadBalancingSettings: {\n      sampleSize: 4\n      additionalLatencyInMilliseconds: 50\n      successfulSamplesRequired: 3\n    }\n  }\n}\n\nresource functionOrigin 'Microsoft.Cdn/profiles/originGroups/origins@2021-06-01' = {\n  name: functionAppName\n  parent: frontdoorOriginGroup\n  properties: {\n    hostName: '${functionAppName}.azurewebsites.net'\n    httpPort: 80\n    httpsPort: 443\n    originHostHeader: '${functionAppName}.azurewebsites.net'\n    priority: 1\n    weight: 1000\n    enforceCertificateNameCheck: true\n    sharedPrivateLinkResource: {\n      groupId: 'sites'\n      privateLinkLocation: location\n      privateLink: {\n         id: functionApp.id\n      }\n      requestMessage: frontdoorPrivateLinkRequestMessage\n    }\n  }\n}\n\nresource wafPolicy 'Microsoft.Network/FrontDoorWebApplicationFirewallPolicies@2022-05-01' = {\n  name: wafPolicyName\n  sku: {\n    name: 'Premium_AzureFrontDoor'\n  }\n  location: 'Global'\n  properties: {\n    policySettings: {\n      mode: 'Prevention'\n      customBlockResponseStatusCode: 403\n      requestBodyCheck: 'Enabled'\n      enabledState: 'Enabled'\n    }\n    managedRules: {\n      managedRuleSets: [\n        {\n          ruleSetType: 'Microsoft_DefaultRuleSet'\n          ruleSetVersion: '2.0'\n          ruleSetAction: 'Block'\n        }\n      ]\n    }\n  }\n}\n\nresource waf 'Microsoft.Cdn/profiles/securityPolicies@2021-06-01' = {\n  name: 'waf-${frontdoorName}'\n  parent: frontdoorProfile\n  properties: {\n    parameters: {\n      type: 'WebApplicationFirewall'\n      wafPolicy: {\n        id: wafPolicy.id\n      }\n      associations: [\n        {\n          domains: [\n            {\n              id: frontdoorEndpoint.id\n            }\n          ]\n          patternsToMatch: [\n             '/*'\n          ]\n        }\n      ]\n    }\n  }\n}\n\nresource frontdoorRoute 'Microsoft.Cdn/profiles/afdEndpoints/routes@2021-06-01' = {\n  name: 'default'\n  parent: frontdoorEndpoint\n  dependsOn: [\n    functionOrigin\n  ]\n  properties: {\n    originGroup: {\n      id: frontdoorOriginGroup.id\n    }\n    supportedProtocols: [\n      'Http' \n      'Https'\n    ]\n    patternsToMatch: [\n      '/*'\n    ]\n    httpsRedirect: 'Enabled'\n    forwardingProtocol: 'MatchRequest'\n    linkToDefaultDomain: 'Enabled'\n  } \n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1330."}, {"role": "assistant", "content": "@description('Location for all resources except Application Insights.')\nparam location string = resourceGroup().location\n\n@description('The language worker runtime to load in the function app.')\n@allowed([\n  'node'\n  'dotnet'\n  'java'\n])\nparam runtime string = 'node'\n\n@description('Storage Account type')\n@allowed([\n  'Standard_LRS'\n  'Standard_GRS'\n  'Standard_RAGRS'\n])\nparam storageAccountType string = 'Standard_LRS'\n\nvar resourceBaseName = uniqueString(resourceGroup().id)\nvar vnetAddressPrefix = '10.0.0.0/16'\nvar subnetAddressPrefix = '10.0.0.0/24'\nvar subnetName = 'default'\nvar functionWorkerRuntime = runtime\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2022-05-01' = {\n  name: 'vnet-${resourceBaseName}'\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: subnetAddressPrefix\n          delegations: [\n            {\n              name: 'delegation'\n              properties: {\n                serviceName: 'Microsoft.Web/serverFarms'\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n\n  resource integrationSubnet 'subnets' existing = {\n    name: subnetName\n  }\n}\n\nresource storageAccount 'Microsoft.Storage/storageAccounts@2022-05-01' = {\n  name: 'st${resourceBaseName}'\n  location: location\n  sku: {\n    name: storageAccountType\n  }\n  kind: 'StorageV2'\n  properties: {\n    minimumTlsVersion: 'TLS1_2'\n    allowBlobPublicAccess: false\n    supportsHttpsTrafficOnly: true\n  }\n}\n\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {\n  name: 'log-${resourceBaseName}'\n  location: location\n  properties: {\n    sku: {\n      name: 'PerGB2018'\n    }\n  }\n}\nresource appInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: 'ai-${resourceBaseName}'\n  location: location\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    WorkspaceResourceId: logAnalyticsWorkspace.id\n  }\n}\n\nresource serverFarm 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: 'asp-${resourceBaseName}'\n  location: location\n  sku: {\n    name: 'EP1'\n    tier: 'ElasticPremium'\n  }\n  kind: 'elastic'\n  properties: {\n    maximumElasticWorkerCount: 20\n  }\n}\n\nresource function 'Microsoft.Web/sites@2022-03-01' = {\n  name: 'func-${resourceBaseName}'\n  location: location\n  kind: 'functionapp'\n  properties: {\n    serverFarmId: serverFarm.id\n    httpsOnly: true\n    virtualNetworkSubnetId: virtualNetwork::integrationSubnet.id // Specify a virtual network subnet resource ID to enable regional virtual network integration.\n    siteConfig: {\n      appSettings: [\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: appInsights.properties.InstrumentationKey\n        }\n        {\n          name: 'APPLICATIONINSIGHTS_CONNECTION_STRING'\n          value: 'InstrumentationKey=${appInsights.properties.InstrumentationKey}'\n        }\n        {\n          name: 'AzureWebJobsStorage'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccount.name};EndpointSuffix= ${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value}'\n        }\n        {\n          name: 'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING'\n          value: 'DefaultEndpointsProtocol=https;AccountName=${storageAccount.name};EndpointSuffix=${environment().suffixes.storage};AccountKey=${storageAccount.listKeys().keys[0].value};'\n        }\n        {\n          name: 'FUNCTIONS_EXTENSION_VERSION'\n          value: '~4'\n        }\n        {\n          name: 'FUNCTIONS_WORKER_RUNTIME'\n          value: functionWorkerRuntime\n        }\n        {\n          name: 'WEBSITE_NODE_DEFAULT_VERSION'\n          value: '~14'\n        }\n      ]\n    }\n  }\n\n  resource config 'config' = {\n    name: 'web'\n    properties: {\n      ftpsState: 'Disabled'\n      minTlsVersion: '1.2'\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1331?"}, {"role": "assistant", "content": "@description('The Azure region for the specified resources.')\nparam location string = resourceGroup().location\n\n// ---- Azure API Management parameters ----\n@description('A unique name for the API Management service. The service name refers to both the service and the corresponding Azure resource. The service name is used to generate a default domain name: <name>.azure-api.net.')\nparam apiManagementPublisherName string\n\n@description('The email address to which all the notifications from API Management will be sent.')\nparam apiManagementPublisherEmailAddress string\n\n@description('The API Management SKU.')\n@allowed([\n  'Developer'\n  'Premium'\n])\nparam apiManagementSku string = 'Developer'\n\n@description('A custom domain name to be used for the API Management service.')\nparam apiManagementCustomDnsName string\n\n@description('A custom domain name for the API Management service developer portal (e.g., portal.consoto.com). ')\nparam apiManagementPortalCustomHostname string\n\n@description('A custom domain name for the API Management service gateway/proxy endpoint (e.g., api.consoto.com).')\nparam apiManagementProxyCustomHostname string\n\n@description('A custom domain name for the API Management service management portal (e.g., management.consoto.com).')\nparam apiManagementManagementCustomHostname string\n\n@description('Password for corresponding to the certificate for the API Management custom developer portal domain name.')\n@secure()\nparam apiManagementPortalCertificatePassword string\n\n@description('Used by Application Gateway, the Base64 encoded PFX certificate corresponding to the API Management custom developer portal domain name.')\n@secure()\nparam apiManagementPortalCustomHostnameBase64EncodedCertificate string\n\n@description('Password for corresponding to the certificate for the API Management custom proxy domain name.')\n@secure()\nparam apiManagementProxyCertificatePassword string\n\n@description('Used by Application Gateway, the Base64 encoded PFX certificate corresponding to the API Management custom proxy domain name.')\n@secure()\nparam apiManagementProxyCustomHostnameBase64EncodedCertificate string\n\n@description('Password for corresponding to the certificate for the API Management custom management domain name.')\n@secure()\nparam apiManagementManagementCertificatePassword string\n\n@description('Used by Application Gateway, the Base64 encoded PFX certificate corresponding to the API Management custom management domain name.')\n@secure()\nparam apiManagementManagementCustomHostnameBase64EncodedCertificate string\n\n// ---- Application Gateway parameters ----\n@description('Used by Application Gateway, the Base64 encoded CER/CRT certificate corresponding to the root certificate for Application Gateway.')\n@secure()\nparam applicationGatewayTrustedRootBase64EncodedCertificate string\n\n@description('Flag to indicate if certificates used by Application Gateway were signed by a public Certificate Authority.')\nparam useWellKnownCertificateAuthority bool = true\n\n// ---- Virtual Network parameters ----\n@description('The virtual network IP space to use for the new virutal network.')\nparam vnetAddressPrefix string = '10.0.0.0/20'\n\n@description('The IP space to use for the subnet for Azure App Service regional virtual network integration.')\nparam subnetAppServiceIntAddressPrefix string = '10.0.3.0/26'\n\n@description('The IP space to use for the subnet for private endpoints.')\nparam subnetPrivateEndpointAddressPrefix string = '10.0.4.0/26'\n\n@description('Address prefix for the api subnet.')\nparam subnetApiManagementAddressPrefix string = '10.0.5.0/24'\n\n@description('Address prefix for the gateway subnet.')\nparam subnetApplicationGatewayAddressPrefix string = '10.0.6.0/24'\n\n// ---- Azure Web App parameters\n@description('SKU name, must be minimum P1v2')\n@allowed([\n  'P1v2'\n  'P1v3'\n  'P2v2'\n  'P2v3'\n  'P3v2'\n  'P3v3'\n])\nparam webAppSkuName string = 'P1v2'\n\n// ---- Variables ----\nvar baseName = uniqueString(resourceGroup().id)\nvar keyVaultName = 'kv-${baseName}'\nvar applicationGatewayName = 'agw-${baseName}'\nvar apiManagementServiceName = 'apim-${baseName}'\nvar appGatewayPublicIpAddressName = 'pip-${baseName}-agw'\n\nvar vnetName = 'vnet-${baseName}'\nvar subnetApiManagementName = 'snet-${baseName}-apim'\nvar subnetAppGatewayName = 'snet-${baseName}-agw'\nvar subnetPrivateEndpointName = 'snet-${baseName}-pe'\nvar subnetAppServiceIntName = 'snet-${baseName}-ase'\n\nvar nsgAppGatewayName = 'nsg-${baseName}-agw'\nvar nsgApiManagementName = 'nsg-${baseName}-apim'\n\nvar apimSubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, subnetApiManagementName)\nvar appGatewaySubnetId = resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, subnetAppGatewayName)\nvar appServiceIntegrationSubnetId = resourceId(\n  'Microsoft.Network/virtualNetworks/subnets',\n  vnetName,\n  subnetAppServiceIntName\n)\nvar privateEndpointSubnetId = resourceId(\n  'Microsoft.Network/virtualNetworks/subnets',\n  vnetName,\n  subnetPrivateEndpointName\n)\n\nvar webAppName = 'web-${baseName}'\n\nvar applicationGatewayTrustedRootCertificates = [\n  {\n    name: 'trustedrootcert'\n    properties: {\n      data: applicationGatewayTrustedRootBase64EncodedCertificate\n    }\n  }\n]\n\nvar applicationGatewayTrustedRootCertificateReferences = [\n  {\n    id: resourceId(\n      'Microsoft.Network/applicationGateways/trustedRootCertificates',\n      applicationGatewayName,\n      'trustedrootcert'\n    )\n  }\n]\n\n// ---- Create Virtual Network with subnets ----\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2024-01-01' = {\n  name: vnetName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        vnetAddressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetAppServiceIntName\n        properties: {\n          addressPrefix: subnetAppServiceIntAddressPrefix\n          delegations: [\n            {\n              name: 'delegation'\n              properties: {\n                serviceName: 'Microsoft.Web/serverFarms'\n              }\n            }\n          ]\n        }\n      }\n      {\n        name: subnetPrivateEndpointName\n        properties: {\n          addressPrefix: subnetPrivateEndpointAddressPrefix\n          privateEndpointNetworkPolicies: 'Disabled'\n        }\n      }\n      {\n        name: subnetApiManagementName\n        properties: {\n          addressPrefix: subnetApiManagementAddressPrefix\n          networkSecurityGroup: {\n            id: nsgApiManagemnt.id\n          }\n        }\n      }\n      {\n        name: subnetAppGatewayName\n        properties: {\n          addressPrefix: subnetApplicationGatewayAddressPrefix\n          networkSecurityGroup: {\n            id: nsgAppGateway.id\n          }\n        }\n      }\n    ]\n  }\n}\n\n// ---- Create Network Security Groups (NSGs) ----\nresource nsgAppGateway 'Microsoft.Network/networkSecurityGroups@2024-01-01' = {\n  name: nsgAppGatewayName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'agw-in'\n        properties: {\n          direction: 'Inbound'\n          access: 'Allow'\n          protocol: '*'\n          description: 'App Gateway inbound'\n          priority: 100\n          sourceAddressPrefix: 'GatewayManager'\n          sourcePortRange: '*'\n          destinationAddressPrefix: '*'\n          destinationPortRange: '65200-65535'\n        }\n      }\n      {\n        name: 'https-in'\n        properties: {\n          protocol: 'Tcp'\n          sourcePortRange: '*'\n          destinationPortRange: '443'\n          sourceAddressPrefix: '*'\n          destinationAddressPrefix: '*'\n          access: 'Allow'\n          priority: 110\n          direction: 'Inbound'\n          description: 'Allow HTTPS Inbound'\n        }\n      }\n    ]\n  }\n}\n\nresource nsgApiManagemnt 'Microsoft.Network/networkSecurityGroups@2024-01-01' = {\n  name: nsgApiManagementName\n  location: location\n  properties: {\n    securityRules: [\n      {\n        name: 'apim-in'\n        properties: {\n          direction: 'Inbound'\n          access: 'Allow'\n          protocol: 'Tcp'\n          description: 'API Management inbound'\n          priority: 100\n          sourceAddressPrefix: 'ApiManagement'\n          sourcePortRange: '*'\n          destinationAddressPrefix: 'VirtualNetwork'\n          destinationPortRange: '3443'\n        }\n      }\n    ]\n  }\n}\n\n// ---- Public IP Address ----\nresource applicationGatewayPublicIpAddress 'Microsoft.Network/publicIPAddresses@2024-01-01' = {\n  name: appGatewayPublicIpAddressName\n  location: location\n  sku: {\n    name: 'Standard'\n  }\n  properties: {\n    publicIPAllocationMethod: 'Static'\n    publicIPAddressVersion: 'IPv4'\n    idleTimeoutInMinutes: 4\n  }\n}\n\n// ---- Private DNS Zone ----\nresource apiManagementPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: apiManagementCustomDnsName\n  location: 'global'\n\n  resource apiRecord 'A' = {\n    name: 'api'\n    properties: {\n      ttl: 3600\n      aRecords: [\n        {\n          ipv4Address: apiManagementInstance.properties.privateIPAddresses[0]\n        }\n      ]\n    }\n  }\n\n  resource managementRecord 'A' = {\n    name: 'management'\n    properties: {\n      ttl: 3600\n      aRecords: [\n        {\n          ipv4Address: apiManagementInstance.properties.privateIPAddresses[0]\n        }\n      ]\n    }\n  }\n\n  resource portalRecord 'A' = {\n    name: 'portal'\n    properties: {\n      ttl: 3600\n      aRecords: [\n        {\n          ipv4Address: apiManagementInstance.properties.privateIPAddresses[0]\n        }\n      ]\n    }\n  }\n\n  resource link 'virtualNetworkLinks' = {\n    name: 'privateDnsZoneLink'\n    location: 'global'\n    properties: {\n      registrationEnabled: false\n      virtualNetwork: {\n        id: virtualNetwork.id\n      }\n    }\n  }\n}\n\nresource webAppPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: 'privatelink.azurewebsites.net'\n  location: 'global'\n\n  resource link 'virtualNetworkLinks' = {\n    name: 'webAppPrivateDnsZoneLink'\n    location: 'global'\n    properties: {\n      registrationEnabled: false\n      virtualNetwork: {\n        id: virtualNetwork.id\n      }\n    }\n  }\n}\n\n// ---- Private Endpoint ----\nresource webAppPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-11-01' = {\n  name: 'pe-${baseName}-sites'\n  location: location\n  properties: {\n    subnet: {\n      id: privateEndpointSubnetId\n    }\n    privateLinkServiceConnections: [\n      {\n        name: 'plsc-${baseName}-sites'\n        properties: {\n          privateLinkServiceId: webApp.id\n          groupIds: [\n            'sites'\n          ]\n        }\n      }\n    ]\n  }\n\n  resource webAppPrivateDnsZoneGroup 'privateDnsZoneGroups' = {\n    name: 'webAppPrivateDnsZoneGroup'\n    properties: {\n      privateDnsZoneConfigs: [\n        {\n          name: 'config'\n          properties: {\n            privateDnsZoneId: webAppPrivateDnsZone.id\n          }\n        }\n      ]\n    }\n  }\n}\n\nresource keyVaultPrivateEndpoint 'Microsoft.Network/privateEndpoints@2023-11-01' = {\n  name: 'pe-${baseName}-kv'\n  location: location\n  properties: {\n    subnet: {\n      id: privateEndpointSubnetId\n      name: subnetPrivateEndpointName\n    }\n    privateLinkServiceConnections: [\n      {\n        id: keyVault.id\n        name: 'plsc-${baseName}-kv'\n        properties: {\n          privateLinkServiceId: keyVault.id\n          groupIds: [\n            'vault'\n          ]\n        }\n      }\n    ]\n  }\n\n  resource keyVaultPrivateDnsZoneGroup 'privateDnsZoneGroups' = {\n    name: 'keyVaultPrivateDnsZoneGroup'\n    properties: {\n      privateDnsZoneConfigs: [\n        {\n          name: 'config'\n          properties: {\n            privateDnsZoneId: keyVaultPrivateDnsZone.id\n          }\n        }\n      ]\n    }\n  }\n}\n\nresource keyVaultPrivateDnsZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: 'privatelink.vaultcore.azure.net'\n  location: 'Global'\n\n  resource keyVaultPrivateDnsZoneLink 'virtualNetworkLinks' = {\n    name: 'keyVaultPrivateDnsZoneLink'\n    location: 'global'\n    properties: {\n      registrationEnabled: false\n      virtualNetwork: {\n        id: virtualNetwork.id\n      }\n    }\n  }\n}\n\n// ---- Application Insights ----\nresource applicationInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: 'ai-${baseName}'\n  location: location\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n    WorkspaceResourceId: logAnalyticsWorkspace.id\n  }\n}\n\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2023-09-01' = {\n  name: 'log-${baseName}'\n  location: location\n  properties: {\n    sku: {\n      name: 'PerGB2018'\n    }\n  }\n}\n\n// ---- Azure Web App ----\nresource webAppPlan 'Microsoft.Web/serverfarms@2023-12-01' = {\n  name: 'plan-${baseName}'\n  location: location\n  kind: 'app'\n  sku: {\n    name: webAppSkuName\n    capacity: 1\n  }\n  properties: {}\n}\n\nresource webApp 'Microsoft.Web/sites@2023-12-01' = {\n  name: webAppName\n  location: location\n  kind: 'app'\n  dependsOn: [\n    virtualNetwork\n  ]\n  properties: {\n    httpsOnly: true\n    serverFarmId: webAppPlan.id\n\n    // Specify a virtual network subnet resource ID to enable regional virtual network integration.\n    virtualNetworkSubnetId: appServiceIntegrationSubnetId\n    siteConfig: {\n      vnetRouteAllEnabled: true\n    }\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n\n  resource config 'config' = {\n    name: 'web'\n    properties: {\n      ftpsState: 'Disabled'\n      minTlsVersion: '1.2'\n      detailedErrorLoggingEnabled: true\n      httpLoggingEnabled: true\n      requestTracingEnabled: true\n      remoteDebuggingEnabled: false\n    }\n  }\n}\n\nresource webAppSettings 'Microsoft.Web/sites/config@2023-12-01' = {\n  name: '${webAppName}/appsettings'\n  dependsOn: [\n    webApp\n  ]\n  properties: {\n    APPINSIGHTS_INSTRUMENTATIONKEY: '@Microsoft.KeyVault(SecretUri=${keyVault::appInsightsInstrumentationKeyKeyVaultSecret.properties.secretUri})'\n  }\n}\n\n// ---- Azure API Management and related API operations ----\nresource apiManagementInstance 'Microsoft.ApiManagement/service@2023-09-01-preview' = {\n  name: apiManagementServiceName\n  dependsOn: [\n    virtualNetwork\n  ]\n  location: location\n  sku: {\n    capacity: 1\n    name: apiManagementSku\n  }\n  properties: {\n    publisherEmail: apiManagementPublisherEmailAddress\n    publisherName: apiManagementPublisherName\n    virtualNetworkType: 'Internal'\n    virtualNetworkConfiguration: {\n      subnetResourceId: apimSubnetId\n    }\n    hostnameConfigurations: [\n      {\n        type: 'DeveloperPortal'\n        hostName: apiManagementPortalCustomHostname\n        encodedCertificate: apiManagementPortalCustomHostnameBase64EncodedCertificate\n        certificatePassword: apiManagementPortalCertificatePassword\n        negotiateClientCertificate: false\n      }\n      {\n        type: 'Proxy'\n        hostName: apiManagementProxyCustomHostname\n        encodedCertificate: apiManagementProxyCustomHostnameBase64EncodedCertificate\n        certificatePassword: apiManagementProxyCertificatePassword\n        negotiateClientCertificate: false\n      }\n      {\n        type: 'Management'\n        hostName: apiManagementManagementCustomHostname\n        encodedCertificate: apiManagementManagementCustomHostnameBase64EncodedCertificate\n        certificatePassword: apiManagementManagementCertificatePassword\n        negotiateClientCertificate: false\n      }\n    ]\n  }\n\n  resource appInsightsLogger 'loggers' = {\n    name: 'appInsightsLogger'\n    properties: {\n      loggerType: 'applicationInsights'\n      credentials: {\n        instrumentationKey: applicationInsights.properties.InstrumentationKey\n      }\n    }\n  }\n\n  resource appInsightsDiagnostics 'diagnostics' = {\n    name: 'applicationinsights'\n    properties: {\n      loggerId: appInsightsLogger.id\n      logClientIp: true\n      alwaysLog: 'allErrors'\n      verbosity: 'information'\n      sampling: {\n        percentage: 100\n        samplingType: 'fixed'\n      }\n      httpCorrelationProtocol: 'Legacy'\n    }\n  }\n}\n\nresource apiManagementDiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: apiManagementInstance\n  name: 'apiManagementDiagnosticSettings'\n  properties: {\n    workspaceId: logAnalyticsWorkspace.id\n    logs: [\n      {\n        category: 'GatewayLogs'\n        enabled: true\n      }\n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n      }\n    ]\n  }\n}\n\n// ---- Azure Application Gateway ----\nresource applicationGateway 'Microsoft.Network/applicationGateways@2024-01-01' = {\n  name: applicationGatewayName\n  location: location\n  dependsOn: [\n    virtualNetwork\n    apiManagementPrivateDnsZone\n    apiManagementInstance\n  ]\n  properties: {\n    sku: {\n      name: 'WAF_v2'\n      tier: 'WAF_v2'\n      capacity: 2\n    }\n    gatewayIPConfigurations: [\n      {\n        name: 'gatewayIP01'\n        properties: {\n          subnet: {\n            id: appGatewaySubnetId\n          }\n        }\n      }\n    ]\n    sslCertificates: [\n      {\n        name: 'gatewaycert'\n        properties: {\n          data: apiManagementProxyCustomHostnameBase64EncodedCertificate\n          password: apiManagementProxyCertificatePassword\n        }\n      }\n      {\n        name: 'portalcert'\n        properties: {\n          data: apiManagementPortalCustomHostnameBase64EncodedCertificate\n          password: apiManagementPortalCertificatePassword\n        }\n      }\n      {\n        name: 'managementcert'\n        properties: {\n          data: apiManagementManagementCustomHostnameBase64EncodedCertificate\n          password: apiManagementManagementCertificatePassword\n        }\n      }\n    ]\n    trustedRootCertificates: useWellKnownCertificateAuthority ? null : applicationGatewayTrustedRootCertificates\n    frontendIPConfigurations: [\n      {\n        name: 'frontend1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          publicIPAddress: {\n            id: applicationGatewayPublicIpAddress.id\n          }\n        }\n      }\n    ]\n    frontendPorts: [\n      {\n        name: 'port01'\n        properties: {\n          port: 443\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: 'gatewaybackend'\n        properties: {\n          backendAddresses: [\n            {\n              fqdn: apiManagementProxyCustomHostname\n            }\n          ]\n        }\n      }\n      {\n        name: 'portalbackend'\n        properties: {\n          backendAddresses: [\n            {\n              fqdn: apiManagementPortalCustomHostname\n            }\n          ]\n        }\n      }\n      {\n        name: 'managementbackend'\n        properties: {\n          backendAddresses: [\n            {\n              fqdn: apiManagementManagementCustomHostname\n            }\n          ]\n        }\n      }\n    ]\n    backendHttpSettingsCollection: [\n      {\n        name: 'apimPoolGatewaySetting'\n        properties: {\n          port: 443\n          protocol: 'Https'\n          cookieBasedAffinity: 'Disabled'\n          pickHostNameFromBackendAddress: true\n          requestTimeout: 180\n          probe: {\n            id: resourceId('Microsoft.Network/applicationGateways/probes', applicationGatewayName, 'apimgatewayprobe')\n          }\n          trustedRootCertificates: useWellKnownCertificateAuthority\n            ? null\n            : applicationGatewayTrustedRootCertificateReferences\n        }\n      }\n      {\n        name: 'apimPoolPortalSetting'\n        properties: {\n          port: 443\n          protocol: 'Https'\n          cookieBasedAffinity: 'Disabled'\n          pickHostNameFromBackendAddress: true\n          requestTimeout: 180\n          probe: {\n            id: resourceId('Microsoft.Network/applicationGateways/probes', applicationGatewayName, 'apimportalprobe')\n          }\n          trustedRootCertificates: useWellKnownCertificateAuthority\n            ? null\n            : applicationGatewayTrustedRootCertificateReferences\n        }\n      }\n      {\n        name: 'apimPoolManagementSetting'\n        properties: {\n          port: 443\n          protocol: 'Https'\n          cookieBasedAffinity: 'Disabled'\n          pickHostNameFromBackendAddress: true\n          requestTimeout: 180\n          probe: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/probes',\n              applicationGatewayName,\n              'apimmanagementprobe'\n            )\n          }\n          trustedRootCertificates: useWellKnownCertificateAuthority\n            ? null\n            : applicationGatewayTrustedRootCertificateReferences\n        }\n      }\n    ]\n    httpListeners: [\n      {\n        name: 'gatewaylistener'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/frontendIPConfigurations',\n              applicationGatewayName,\n              'frontend1'\n            )\n          }\n          frontendPort: {\n            id: resourceId('Microsoft.Network/applicationGateways/frontendPorts', applicationGatewayName, 'port01')\n          }\n          protocol: 'Https'\n          sslCertificate: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/sslCertificates',\n              applicationGatewayName,\n              'gatewaycert'\n            )\n          }\n          hostName: apiManagementProxyCustomHostname\n          requireServerNameIndication: true\n        }\n      }\n      {\n        name: 'portallistener'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/frontendIPConfigurations',\n              applicationGatewayName,\n              'frontend1'\n            )\n          }\n          frontendPort: {\n            id: resourceId('Microsoft.Network/applicationGateways/frontendPorts', applicationGatewayName, 'port01')\n          }\n          protocol: 'Https'\n          sslCertificate: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/sslCertificates',\n              applicationGatewayName,\n              'portalcert'\n            )\n          }\n          hostName: apiManagementPortalCustomHostname\n          requireServerNameIndication: true\n        }\n      }\n      {\n        name: 'managementlistener'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/frontendIPConfigurations',\n              applicationGatewayName,\n              'frontend1'\n            )\n          }\n          frontendPort: {\n            id: resourceId('Microsoft.Network/applicationGateways/frontendPorts', applicationGatewayName, 'port01')\n          }\n          protocol: 'Https'\n          sslCertificate: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/sslCertificates',\n              applicationGatewayName,\n              'managementcert'\n            )\n          }\n          hostName: apiManagementManagementCustomHostname\n          requireServerNameIndication: true\n        }\n      }\n    ]\n    requestRoutingRules: [\n      {\n        name: 'gatewayrule'\n        properties: {\n          ruleType: 'Basic'\n          priority: 1\n          httpListener: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/httpListeners',\n              applicationGatewayName,\n              'gatewaylistener'\n            )\n          }\n          backendAddressPool: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/backendAddressPools',\n              applicationGatewayName,\n              'gatewaybackend'\n            )\n          }\n          backendHttpSettings: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/backendHttpSettingsCollection',\n              applicationGatewayName,\n              'apimPoolGatewaySetting'\n            )\n          }\n        }\n      }\n      {\n        name: 'portalrule'\n        properties: {\n          ruleType: 'Basic'\n          priority: 2\n          httpListener: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/httpListeners',\n              applicationGatewayName,\n              'portallistener'\n            )\n          }\n          backendAddressPool: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/backendAddressPools',\n              applicationGatewayName,\n              'portalbackend'\n            )\n          }\n          backendHttpSettings: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/backendHttpSettingsCollection',\n              applicationGatewayName,\n              'apimPoolPortalSetting'\n            )\n          }\n        }\n      }\n      {\n        name: 'managementrule'\n        properties: {\n          ruleType: 'Basic'\n          priority: 3\n          httpListener: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/httpListeners',\n              applicationGatewayName,\n              'managementlistener'\n            )\n          }\n          backendAddressPool: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/backendAddressPools',\n              applicationGatewayName,\n              'managementbackend'\n            )\n          }\n          backendHttpSettings: {\n            id: resourceId(\n              'Microsoft.Network/applicationGateways/backendHttpSettingsCollection',\n              applicationGatewayName,\n              'apimPoolManagementSetting'\n            )\n          }\n        }\n      }\n    ]\n    probes: [\n      {\n        name: 'apimgatewayprobe'\n        properties: {\n          protocol: 'Https'\n          host: apiManagementProxyCustomHostname\n          path: '/status-0123456789abcdef'\n          interval: 30\n          timeout: 120\n          unhealthyThreshold: 8\n          pickHostNameFromBackendHttpSettings: false\n          minServers: 0\n        }\n      }\n      {\n        name: 'apimportalprobe'\n        properties: {\n          protocol: 'Https'\n          host: apiManagementPortalCustomHostname\n          path: '/signin'\n          interval: 60\n          timeout: 300\n          unhealthyThreshold: 8\n          pickHostNameFromBackendHttpSettings: false\n          minServers: 0\n        }\n      }\n      {\n        name: 'apimmanagementprobe'\n        properties: {\n          protocol: 'Https'\n          host: apiManagementManagementCustomHostname\n          path: '/ServiceStatus'\n          interval: 60\n          timeout: 300\n          unhealthyThreshold: 8\n          pickHostNameFromBackendHttpSettings: false\n          minServers: 0\n        }\n      }\n    ]\n    sslPolicy: {\n      policyType: 'Predefined'\n      policyName: 'AppGwSslPolicy20170401S'\n    }\n    webApplicationFirewallConfiguration: {\n      enabled: true\n      firewallMode: 'Detection'\n      ruleSetType: 'OWASP'\n      ruleSetVersion: '3.2'\n      requestBodyCheck: true\n      maxRequestBodySizeInKb: 128\n      fileUploadLimitInMb: 100\n    }\n  }\n}\n\nresource applicationGatewayDiagnosticSettings 'Microsoft.Insights/diagnosticSettings@2021-05-01-preview' = {\n  scope: applicationGateway\n  name: 'diagnosticSettings'\n  properties: {\n    workspaceId: logAnalyticsWorkspace.id\n    logs: [\n      {\n        category: 'ApplicationGatewayAccessLog'\n        enabled: true\n      }\n      {\n        category: 'ApplicationGatewayPerformanceLog'\n        enabled: true\n      }\n      {\n        category: 'ApplicationGatewayFirewallLog'\n        enabled: true\n      }\n    ]\n    metrics: [\n      {\n        category: 'AllMetrics'\n        enabled: true\n      }\n    ]\n  }\n}\n\n// ---- Azure Key Vault ----\nresource keyVault 'Microsoft.KeyVault/vaults@2023-07-01' = {\n  name: keyVaultName\n  location: location\n  properties: {\n    sku: {\n      family: 'A'\n      name: 'standard'\n    }\n    tenantId: subscription().tenantId\n    accessPolicies: [\n      {\n        tenantId: webApp.identity.tenantId\n        objectId: webApp.identity.principalId\n        permissions: {\n          secrets: [\n            'get'\n          ]\n        }\n      }\n    ]\n    networkAcls: {\n      bypass: 'None'\n      defaultAction: 'Deny'\n    }\n  }\n\n  resource appInsightsInstrumentationKeyKeyVaultSecret 'secrets' = {\n    name: 'kvs-${baseName}-aikey'\n    properties: {\n      value: applicationInsights.properties.InstrumentationKey\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1332."}, {"role": "assistant", "content": "@description('Name of the App Service Environment')\nparam aseName string\n\n@description('Location of the App Service Environment')\nparam location string = resourceGroup().location\n\n@description('Name of the existing VNET')\nparam existingVirtualNetworkName string\n\n@description('Name of the existing VNET resource group')\nparam existingVirtualNetworkResourceGroup string\n\n@description('Subnet name that will contain the App Service Environment')\nparam existingSubnetName string\n\nresource existingVnet 'Microsoft.Network/virtualNetworks@2021-02-01' existing = {\n  scope: resourceGroup(existingVirtualNetworkResourceGroup)\n  name: existingVirtualNetworkName\n}\n\nresource existingSubnet 'Microsoft.Network/virtualNetworks/subnets@2020-06-01' existing = {\n  parent: existingVnet\n  name: existingSubnetName\n}\n\nresource ase 'Microsoft.Web/hostingEnvironments@2020-06-01' = {\n  name: aseName\n  kind: 'ASEV2'\n  location: location\n  properties: {\n    location: location\n    name: aseName\n    workerPools: []\n    virtualNetwork: {\n      id: existingSubnet.id\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1333."}, {"role": "assistant", "content": "@description('Required. Use existing virtual network and subnet.')\nparam useExistingVnetandSubnet bool = false\n\n@description('Required. Resource Group name of virtual network if using existing vnet and subnet.')\nparam vNetResourceGroupName string = resourceGroup().name\n\n@description('Required. The Virtual Network (vNet) Name.')\nparam virtualNetworkName string = 'vnet-asev3'\n\n@description('Required. Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Required. An Array of 1 or more IP Address Prefixes for the Virtual Network.')\nparam vNetAddressPrefixes array = [\n  '172.16.0.0/16'\n]\n\n@description('Required. The subnet Name of ASEv3.')\nparam subnetAddressPrefix string = '172.16.0.0/24'\n\n@description('Required. The subnet Name of ASEv3.')\nparam subnetName string = 'snet-asev3'\n\n@description('Required. The subnet properties.')\nparam subnets array = [\n  {\n    name: 'snet-asev3'\n    addressPrefix: '172.16.0.0/24'\n    delegations: [\n      {\n        name: 'Microsoft.Web.hostingEnvironments'\n        properties: {\n          serviceName: 'Microsoft.Web/hostingEnvironments'\n        }\n      }\n    ]\n    privateEndpointNetworkPolicies: 'Enabled'\n    privateLinkServiceNetworkPolicies: 'Enabled'\n    networkSecurityGroupName: 'nsg-asev3'\n  }\n]\n\n@description('Required. Name of ASEv3.')\nparam aseName string\n\n@description('Required. Dedicated host count of ASEv3.')\nparam dedicatedHostCount string = '0'\n\n@description('Required. Zone redundant of ASEv3.')\nparam zoneRedundant bool = false\n\n@description('Optional. Create a private DNS zone for ASEv3.')\nparam createPrivateDNS bool = true\n@description('Required. Load balancer mode: 0-external load balancer, 3-internal load balancer for ASEv3.')\n@allowed([\n  0\n  3\n])\nparam internalLoadBalancingMode int = 3\n\n@description('Required. Name of the Network Security Group.')\n@minLength(1)\nparam networkSecurityGroupName string = 'nsg-asev3'\n\n@description('Required. Array of Security Rules to deploy to the Network Security Group.')\nparam networkSecurityGroupSecurityRules array = []\n\nvar uniStr = uniqueString(resourceGroup().id)\nvar virtualNetworkId = resourceId(vNetResourceGroupName, 'Microsoft.Network/virtualNetworks', virtualNetworkName)\nvar subnetId = resourceId(vNetResourceGroupName, 'Microsoft.Network/virtualNetworks/subnets', virtualNetworkName, subnetName)\nvar privateDNSZoneName = asev3.properties.dnsSuffix\n\nresource networksecuritygroup 'Microsoft.Network/networkSecurityGroups@2020-11-01' = if (!useExistingVnetandSubnet) {\n  name: networkSecurityGroupName\n  location: location\n  properties: {\n    securityRules: [for item in networkSecurityGroupSecurityRules: {\n      name: item.name\n      properties: {\n        description: item.properties.description\n        access: item.properties.access\n        destinationAddressPrefix: ((item.properties.destinationAddressPrefix == '') ? json('null') : item.properties.destinationAddressPrefix)\n        destinationAddressPrefixes: ((length(item.properties.destinationAddressPrefixes) == 0) ? json('null') : item.properties.destinationAddressPrefixes)\n        destinationPortRanges: ((length(item.properties.destinationPortRanges) == 0) ? json('null') : item.properties.destinationPortRanges)\n        destinationPortRange: ((item.properties.destinationPortRange == '') ? json('null') : item.properties.destinationPortRange)\n        direction: item.properties.direction\n        priority: int(item.properties.priority)\n        protocol: item.properties.protocol\n        sourceAddressPrefix: ((item.properties.sourceAddressPrefix == '') ? json('null') : item.properties.sourceAddressPrefix)\n        sourcePortRanges: ((length(item.properties.sourcePortRanges) == 0) ? json('null') : item.properties.sourcePortRanges)\n        sourcePortRange: item.properties.sourcePortRange\n      }\n    }]\n  }\n}\n\nresource virtualnetwork 'Microsoft.Network/virtualNetworks@2020-11-01' = if (!useExistingVnetandSubnet) {\n  name: virtualNetworkName\n  location: location\n  dependsOn: [\n    networksecuritygroup\n  ]\n  properties: {\n    addressSpace: {\n      addressPrefixes: vNetAddressPrefixes\n    }\n    subnets: [for item in subnets: {\n      name: item.name\n      properties: {\n        addressPrefix: item.addressPrefix\n        networkSecurityGroup: (empty(item.networkSecurityGroupName) ? json('null') : json('{\"id\": \"${resourceId('Microsoft.Network/networkSecurityGroups', item.networkSecurityGroupName)}\"}'))\n        delegations: item.delegations\n      }\n    }]\n  }\n}\n\nmodule subnet 'modules/subnet.bicep' = if (useExistingVnetandSubnet) {\n  name: '${subnetName}-subnet-delegation-${uniStr}'\n  scope: resourceGroup(vNetResourceGroupName)\n  params: {\n    virtualNetworkName: virtualNetworkName\n    subnetName: subnetName\n    subnetAddressPrefix: subnetAddressPrefix\n  }\n}\n\nresource asev3 'Microsoft.Web/hostingEnvironments@2020-12-01' = {\n  name: aseName\n  location: location\n  kind: 'ASEV3'\n  dependsOn: [\n    virtualnetwork\n  ] \n  properties: {\n    dedicatedHostCount: dedicatedHostCount\n    zoneRedundant: zoneRedundant\n    internalLoadBalancingMode: internalLoadBalancingMode\n    virtualNetwork: {\n      id: subnetId\n    } \n  }\n}\n\nmodule privatednszone 'modules/privatednszone.bicep' = if (createPrivateDNS && internalLoadBalancingMode == 3) {\n  name: 'private-dns-zone-deployment-${uniStr}'\n  params: {\n    privateDNSZoneName: privateDNSZoneName\n    virtualNetworkId: virtualNetworkId\n    aseName: aseName\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1334?"}, {"role": "assistant", "content": "@description('Required. ASE name.')\nparam aseName string\n\n@description('Required. Private DNS zone name.')\nparam privateDNSZoneName string\n\n@description('Required. Network Id.')\nparam virtualNetworkId string\n\nresource aseConfig 'Microsoft.Web/hostingEnvironments/configurations@2021-01-15' existing = {\n  name: '${aseName}/networking'\n  }\n\nresource privatezone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDNSZoneName\n  location: 'global'\n  properties: {}\n}\n\nresource vnetlink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privatezone\n  name: 'vnetLink'\n  location: 'global'\n  properties: {\n    virtualNetwork: {\n      id: virtualNetworkId\n    }\n    registrationEnabled: false\n  }\n}\n\nresource webrecord 'Microsoft.Network/privateDnsZones/A@2020-06-01' = {\n  parent: privatezone\n  name: '*'\n  properties: {\n    ttl: 3600\n    aRecords: [\n      {\n        ipv4Address: aseConfig.properties.internalInboundIpAddresses[0]\n      }\n    ]\n  }\n}\n\nresource scmrecord 'Microsoft.Network/privateDnsZones/A@2020-06-01' = {\n  parent: privatezone\n  name: '*.scm'\n  properties: {\n    ttl: 3600\n    aRecords: [\n      {\n        ipv4Address: aseConfig.properties.internalInboundIpAddresses[0]\n      }\n    ]\n  }\n}\n\nresource atrecord 'Microsoft.Network/privateDnsZones/A@2020-06-01' = {\n  parent: privatezone\n  name: '@'\n  properties: {\n    ttl: 3600\n    aRecords: [\n      {\n        ipv4Address: aseConfig.properties.internalInboundIpAddresses[0]\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1335."}, {"role": "assistant", "content": "@description('App service prefix.')\nparam appName string\n\n@description('App service location.')\nparam location string = resourceGroup().location\n\n@description('App service plan prefix.')\nparam hostingPlanName string\n\n@description('App service plan hosting environment profile name (ASEv3 name).')\nparam hostingEnvironmentProfileName string\n\n@description('Enable Always-on of App service.')\nparam alwaysOn bool = true\n\n@description('App service plan sku.')\nparam sku string = 'IsolatedV2'\n\n@description('App service plan sku code.')\nparam skuCode string = 'I1V2'\n\n@description('Enable php of App service.')\nparam phpVersion string = 'OFF'\n\n@description('.NET Framework version of App service.')\nparam netFrameworkVersion string = 'v5.0'\n\nresource site 'Microsoft.Web/sites@2021-01-15' = {\n  name: appName\n  location: location\n  properties: {\n    siteConfig: {\n      phpVersion: phpVersion\n      netFrameworkVersion: netFrameworkVersion\n      alwaysOn: alwaysOn\n    }\n    serverFarmId: hostingPlan.id\n    clientAffinityEnabled: true\n    hostingEnvironmentProfile: {\n      id: resourceId('Microsoft.Web/hostingEnvironments', hostingEnvironmentProfileName)\n    }\n  }\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2021-01-15' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    tier: sku\n    name: skuCode\n  }\n  properties: {\n    hostingEnvironmentProfile: {\n      id: resourceId('Microsoft.Web/hostingEnvironments', hostingEnvironmentProfileName)\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1336."}, {"role": "assistant", "content": "@description('Required. The Virtual Network (vNet) Name.')\nparam virtualNetworkName string\n\n@description('Required. The subnet Name of ASEv3.')\nparam subnetName string\n\n@description('Required. The subnet Name of ASEv3.')\nparam subnetAddressPrefix string\n\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2020-11-01' = {\n    name: '${virtualNetworkName}/${subnetName}'\n    properties:{\n      addressPrefix: subnetAddressPrefix\n      delegations: [\n        {\n          name: 'Microsoft.Web.hostingEnvironments'\n          properties: {\n            serviceName: 'Microsoft.Web/hostingEnvironments'\n          }\n        }\n      ]\n    }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1337."}, {"role": "assistant", "content": "@description('The name of you Web Site.')\nparam siteName string = 'WebApp-${uniqueString(resourceGroup().id)}'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('The pricing tier for the hosting plan.')\n@allowed([\n  'F1'\n  'D1'\n  'B1'\n  'B2'\n  'B3'\n  'S1'\n  'S2'\n  'S3'\n  'P1'\n  'P2'\n  'P3'\n  'P4'\n])\nparam sku string = 'F1'\n\n@description('The instance size of the hosting plan (small, medium, or large).')\n@allowed([\n  '0'\n  '1'\n  '2'\n])\nparam workerSize string = '0'\n\n@description('The URL for the GitHub repository that contains the project to deploy.')\nparam repoURL string = 'https://github.com/Azure-Samples/app-service-web-html-get-started.git'\n\n@description('The branch of the GitHub repository to use.')\nparam branch string = 'master'\n\nvar hostingPlanName = 'hpn-${resourceGroup().name}'\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2023-01-01' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    name: sku\n    capacity: int(workerSize)\n  }\n  properties: {\n  }\n}\n\nresource site 'Microsoft.Web/sites@2023-01-01' = {\n  name: siteName\n  location: location\n  properties: {\n  }\n}\n\nresource sourceControl 'Microsoft.Web/sites/sourcecontrols@2023-01-01' = {\n  parent: site\n  name: 'web'\n  properties: {\n    repoUrl: repoURL\n    branch: branch\n    isManualIntegration: true\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1338 please."}, {"role": "assistant", "content": "@description('Name of the hosting plan to use in Azure.')\n@minLength(1)\nparam hostingPlanName string\n\n@description('Name of the Azure Web app to create.')\n@minLength(1)\nparam webSiteName string\n\n@description('Describes plan\\'s pricing tier and instance size. Check details at https://azure.microsoft.com/en-us/pricing/details/app-service/')\n@allowed([\n  'F1'\n  'D1'\n  'B1'\n  'B2'\n  'B3'\n  'S1'\n  'S2'\n  'S3'\n  'P1'\n  'P2'\n  'P3'\n  'P4'\n])\nparam skuName string = 'F1'\n\n@description('Describes plan\\'s instance count')\n@minValue(1)\n@maxValue(3)\nparam skuCapacity int = 1\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanName\n  location: location\n  tags: {\n    displayName: 'HostingPlan'\n  }\n  sku: {\n    name: skuName\n    capacity: skuCapacity\n  }\n  properties: {}\n}\n\nresource webSite 'Microsoft.Web/sites@2022-03-01' = {\n  name: webSiteName\n  location: location\n  tags: {\n    'hidden-related:${resourceGroup().id}/providers/Microsoft.Web/serverfarms/${hostingPlanName}': 'Resource'\n    displayName: 'Website'\n  }\n  properties: {\n    serverFarmId: hostingPlan.id\n  }\n}\n\nresource webSiteConfig 'Microsoft.Web/sites/config@2022-03-01' = {\n  parent: webSite\n  name: 'web'\n  properties: {\n    javaVersion: '1.8'\n    javaContainer: 'TOMCAT'\n    javaContainerVersion: '9.0'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1339?"}, {"role": "assistant", "content": "@description('Which Pricing tier our App Service Plan to')\nparam skuName string = 'S1'\n\n@description('How many instances of our app service will be scaled out to')\nparam skuCapacity int = 1\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Name that will be used to build associated artifacts')\nparam appName string = uniqueString(resourceGroup().id)\n\nvar appServicePlanName = toLower('asp-${appName}')\nvar webSiteName = toLower('wapp-${appName}')\nvar appInsightName = toLower('appi-${appName}')\nvar logAnalyticsName = toLower('la-${appName}')\n\nresource appServicePlan 'Microsoft.Web/serverfarms@2020-06-01' = {\n  name: appServicePlanName\n  location: location\n  sku: {\n    name: skuName\n    capacity: skuCapacity\n  }\n  tags: {\n    displayName: 'HostingPlan'\n    ProjectName: appName\n  }\n}\n\nresource appService 'Microsoft.Web/sites@2020-06-01' = {\n  name: webSiteName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  tags: {\n    displayName: 'Website'\n    ProjectName: appName\n  }\n  dependsOn: [\n    logAnalyticsWorkspace\n  ]\n  properties: {\n    serverFarmId: appServicePlan.id\n    httpsOnly: true\n    siteConfig: {\n      minTlsVersion: '1.2'\n    }\n  }\n}\n\nresource appServiceLogging 'Microsoft.Web/sites/config@2020-06-01' = {\n  parent: appService\n  name: 'appsettings'\n  properties: {\n    APPINSIGHTS_INSTRUMENTATIONKEY: appInsights.properties.InstrumentationKey\n  }\n  dependsOn: [\n    appServiceSiteExtension\n  ]\n}\n\nresource appServiceSiteExtension 'Microsoft.Web/sites/siteextensions@2020-06-01' = {\n  parent: appService\n  name: 'Microsoft.ApplicationInsights.AzureWebSites'\n  dependsOn: [\n    appInsights\n  ]\n}\n\nresource appServiceAppSettings 'Microsoft.Web/sites/config@2020-06-01' = {\n  parent: appService\n  name: 'logs'\n  properties: {\n    applicationLogs: {\n      fileSystem: {\n        level: 'Warning'\n      }\n    }\n    httpLogs: {\n      fileSystem: {\n        retentionInMb: 40\n        enabled: true\n      }\n    }\n    failedRequestsTracing: {\n      enabled: true\n    }\n    detailedErrorMessages: {\n      enabled: true\n    }\n  }\n}\n\nresource appInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: appInsightName\n  location: location\n  kind: 'string'\n  tags: {\n    displayName: 'AppInsight'\n    ProjectName: appName\n  }\n  properties: {\n    Application_Type: 'web'\n    WorkspaceResourceId: logAnalyticsWorkspace.id\n  }\n}\n\nresource logAnalyticsWorkspace 'Microsoft.OperationalInsights/workspaces@2020-08-01' = {\n  name: logAnalyticsName\n  location: location\n  tags: {\n    displayName: 'Log Analytics'\n    ProjectName: appName\n  }\n  properties: {\n    sku: {\n      name: 'PerGB2018'\n    }\n    retentionInDays: 120\n    features: {\n      searchVersion: 1\n      legacy: 0\n      enableLogAccessUsingOnlyResourcePermissions: true\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1340."}, {"role": "assistant", "content": "@description('Specifies region for all resources')\nparam location string = resourceGroup().location\n\n@description('Specifies app plan SKU')\nparam skuName string = 'F1'\n\n@description('Specifies app plan capacity')\nparam skuCapacity int = 1\n\n@description('Specifies sql admin login')\nparam sqlAdministratorLogin string\n\n@description('Specifies sql admin password')\n@secure()\nparam sqlAdministratorPassword string\n\n@description('Specifies managed identity name')\nparam managedIdentityName string\n\nvar databaseName = 'sampledb'\n\n// Data resources\nresource sqlserver 'Microsoft.Sql/servers@2020-11-01-preview' = {\n  name: 'sqlserver${uniqueString(resourceGroup().id)}'\n  location: location\n  properties: {\n    administratorLogin: sqlAdministratorLogin\n    administratorLoginPassword: sqlAdministratorPassword\n    version: '12.0'\n  }\n\n  resource database 'databases@2020-08-01-preview' = {\n    name: databaseName\n    location: location\n    sku: {\n      name: 'Basic'\n    }\n    properties: {\n      collation: 'SQL_Latin1_General_CP1_CI_AS'\n      maxSizeBytes: 1073741824\n    }\n  }\n\n  resource firewallRule 'firewallRules@2020-11-01-preview' = {\n    name: 'AllowAllWindowsAzureIps'\n    properties: {\n      endIpAddress: '0.0.0.0'\n      startIpAddress: '0.0.0.0'\n    }\n  }\n}\n\n// Web App resources\nresource hostingPlan 'Microsoft.Web/serverfarms@2020-12-01' = {\n  name: 'hostingplan${uniqueString(resourceGroup().id)}'\n  location: location\n  sku: {\n    name: skuName\n    capacity: skuCapacity\n  }\n}\n\nresource webSite 'Microsoft.Web/sites@2020-12-01' = {\n  name: 'webSite${uniqueString(resourceGroup().id)}'\n  location: location\n  tags: {\n    'hidden-related:${hostingPlan.id}': 'empty'\n    displayName: 'Website'\n  }\n  properties: {\n    serverFarmId: hostingPlan.id\n  }\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${msi.id}': {}\n    }\n  }\n\n  resource connectionString 'config@2020-12-01' = {\n    name: 'connectionstrings'\n    properties: {\n      DefaultConnection: {\n        value: 'Data Source=tcp:${sqlserver.properties.fullyQualifiedDomainName},1433;Initial Catalog=${sqlserver::database.name};User Id=${sqlserver.properties.administratorLogin}@${sqlserver.properties.fullyQualifiedDomainName};Password=${sqlAdministratorPassword};'\n        type: 'SQLAzure'\n      }\n    }\n  }\n}\n\n// Managed Identity resources\nresource msi 'Microsoft.ManagedIdentity/userAssignedIdentities@2018-11-30' = {\n  name: managedIdentityName\n  location: location\n}\n\nresource roleassignment 'Microsoft.Authorization/roleAssignments@2020-04-01-preview' = {\n  name: guid(msi.id, resourceGroup().id, 'b24988ac-6180-42a0-ab88-20f7382dd24c')\n  properties: {\n    principalType: 'ServicePrincipal'\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')\n    principalId: msi.properties.principalId\n  }\n}\n\n// Monitor\nresource appInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: 'AppInsights${webSite.name}'\n  location: location\n  tags: {\n    'hidden-link:${webSite.id}': 'Resource'\n    displayName: 'AppInsightsComponent'\n  }\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1341?"}, {"role": "assistant", "content": "@description('Describes plan\\'s pricing tier and instance size. Check details at https://azure.microsoft.com/en-us/pricing/details/app-service/')\n@allowed([\n  'F1'\n  'D1'\n  'B1'\n  'B2'\n  'B3'\n  'S1'\n  'S2'\n  'S3'\n  'P1'\n  'P2'\n  'P3'\n  'P4'\n])\nparam skuName string = 'F1'\n\n@description('Describes plan\\'s instance count')\n@minValue(1)\n@maxValue(3)\nparam skuCapacity int = 1\n\n@description('The admin user of the SQL Server')\nparam sqlAdministratorLogin string\n\n@description('The password of the admin user of the SQL Server')\n@secure()\nparam sqlAdministratorLoginPassword string\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar hostingPlanName = 'hostingplan${uniqueString(resourceGroup().id)}'\nvar websiteName = 'website${uniqueString(resourceGroup().id)}'\nvar sqlserverName = 'sqlServer${uniqueString(resourceGroup().id)}'\nvar databaseName = 'sampledb'\n\nresource sqlServer 'Microsoft.Sql/servers@2021-02-01-preview' = {\n  name: sqlserverName\n  location: location\n  tags: {\n    displayName: 'SQL Server'\n  }\n  properties: {\n    administratorLogin: sqlAdministratorLogin\n    administratorLoginPassword: sqlAdministratorLoginPassword\n    version: '12.0'\n  }\n}\n\nresource sqlDatabase 'Microsoft.Sql/servers/databases@2021-02-01-preview' = {\n  parent: sqlServer\n  name: databaseName\n  location: location\n  tags: {\n    displayName: 'Database'\n  }\n  sku: {\n    name: 'Basic'\n  }\n  properties: {\n    collation: 'SQL_Latin1_General_CP1_CI_AS'\n    maxSizeBytes: 1073741824\n  }\n}\n\nresource allowAllWindowsAzureIps 'Microsoft.Sql/servers/firewallRules@2021-02-01-preview' = {\n  parent: sqlServer\n  name: 'AllowAllWindowsAzureIps'\n  properties: {\n    endIpAddress: '0.0.0.0'\n    startIpAddress: '0.0.0.0'\n  }\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2020-12-01' = {\n  name: hostingPlanName\n  location: location\n  tags: {\n    displayName: 'HostingPlan'\n  }\n  sku: {\n    name: skuName\n    capacity: skuCapacity\n  }\n}\n\nresource website 'Microsoft.Web/sites@2020-12-01' = {\n  name: websiteName\n  location: location\n  tags: {\n    'hidden-related:${hostingPlan.id}': 'empty'\n    displayName: 'Website'\n  }\n  properties: {\n    serverFarmId: hostingPlan.id\n  }\n}\n\nresource webSiteConnectionStrings 'Microsoft.Web/sites/config@2020-12-01' = {\n  parent: website\n  name: 'connectionstrings'\n  properties: {\n    DefaultConnection: {\n      value: 'Data Source=tcp:${sqlServer.properties.fullyQualifiedDomainName},1433;Initial Catalog=${databaseName};User Id=${sqlAdministratorLogin}@${sqlServer.properties.fullyQualifiedDomainName};Password=${sqlAdministratorLoginPassword};'\n      type: 'SQLAzure'\n    }\n  }\n}\n\nresource appInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: 'AppInsights${website.name}'\n  location: location\n  tags: {\n    'hidden-link:${website.id}': 'Resource'\n    displayName: 'AppInsightsComponent'\n  }\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1342."}, {"role": "assistant", "content": "@description('Describes plan\\'s pricing tier and instance size. Check details at https://azure.microsoft.com/en-us/pricing/details/app-service/')\n@allowed([\n  'F1'\n  'D1'\n  'B1'\n  'B2'\n  'B3'\n  'S1'\n  'S2'\n  'S3'\n  'P1'\n  'P2'\n  'P3'\n  'P4'\n])\nparam skuName string = 'F1'\n\n@description('Describes plan\\'s instance count')\n@minValue(1)\n@maxValue(7)\nparam skuCapacity int = 1\n\n@description('The pricing tier of the new Azure Redis Cache.')\n@allowed([\n  'Basic'\n  'Standard'\n])\nparam cacheSKUName string = 'Basic'\n\n@description('The family for the sku.')\n@allowed([\n  'C'\n])\nparam cacheSKUFamily string = 'C'\n\n@description('The size of the new Azure Redis Cache instance. ')\n@minValue(0)\n@maxValue(6)\nparam cacheSKUCapacity int = 0\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar hostingPlanName = 'hostingplan${uniqueString(resourceGroup().id)}'\nvar webSiteName = 'webSite${uniqueString(resourceGroup().id)}'\nvar cacheName = 'cache${uniqueString(resourceGroup().id)}'\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2021-03-01' = {\n  name: hostingPlanName\n  location: location\n  tags: {\n    displayName: 'HostingPlan'\n  }\n  sku: {\n    name: skuName\n    capacity: skuCapacity\n  }\n  properties: {\n  }\n}\n\nresource webSite 'Microsoft.Web/sites@2021-03-01' = {\n  name: webSiteName\n  location: location\n  tags: {\n    'hidden-related:${hostingPlan.id}': 'empty'\n    displayName: 'Website'\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    serverFarmId: hostingPlan.id\n    httpsOnly: true\n  }\n  dependsOn: [\n    cache\n  ]\n}\n\nresource appsettings 'Microsoft.Web/sites/config@2021-03-01' = {\n  parent: webSite\n  name: 'appsettings'\n  properties: {\n    CacheConnection: '${cacheName}.redis.cache.windows.net,abortConnect=false,ssl=true,password=${cache.listKeys().primaryKey}'\n    minTlsVersion: '1.2'\n    ftpsState: 'FtpsOnly'\n  }\n}\n\nresource cache 'Microsoft.Cache/Redis@2021-06-01' = {\n  name: cacheName\n  location: location\n  tags: {\n    displayName: 'cache'\n  }\n  properties: {\n    sku: {\n      name: cacheSKUName\n      family: cacheSKUFamily\n      capacity: cacheSKUCapacity\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1343."}, {"role": "assistant", "content": "@description('Base name of the resource such as web app name and app service plan ')\n@minLength(2)\nparam webAppName string = 'AzureLinuxApp'\n\n@description('The SKU of App Service Plan ')\nparam sku string = 'S1'\n\n@description('The Runtime stack of current web app')\nparam linuxFxVersion string = 'php|7.4'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar webAppPortalName = '${webAppName}-webapp'\nvar appServicePlanName = 'AppServicePlan-${webAppName}'\n\nresource appServicePlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: appServicePlanName\n  location: location\n  sku: {\n    name: sku\n  }\n  kind: 'linux'\n  properties: {\n    reserved: true\n  }\n}\n\nresource webAppPortal 'Microsoft.Web/sites@2022-03-01' = {\n  name: webAppPortalName\n  location: location\n  kind: 'app'\n  properties: {\n    serverFarmId: appServicePlan.id\n    siteConfig: {\n      linuxFxVersion: linuxFxVersion\n      ftpsState: 'FtpsOnly'\n    }\n    httpsOnly: true\n  }\n  identity: {\n    type: 'SystemAssigned'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1344?"}, {"role": "assistant", "content": "@description('Web app name.')\n@minLength(2)\nparam webAppName string = 'webApp-${uniqueString(resourceGroup().id)}'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Describes plan\\'s pricing tier and instance size. Check details at https://azure.microsoft.com/en-us/pricing/details/app-service/')\n@allowed([\n  'F1'\n  'D1'\n  'B1'\n  'B2'\n  'B3'\n  'S1'\n  'S2'\n  'S3'\n  'P1'\n  'P2'\n  'P3'\n  'P4'\n])\nparam sku string = 'F1'\n\n@description('The language stack of the app.')\n@allowed([\n  '.net'\n  'php'\n  'node'\n  'html'\n])\nparam language string = '.net'\n\n@description('Optional Git Repo URL, if empty a \\'hello world\\' app will be deploy from the Azure-Samples repo')\nparam repoUrl string = ''\n\nvar appServicePlanName = 'AppServicePlan-${webAppName}'\nvar gitRepoReference = {\n  '.net': 'https://github.com/Azure-Samples/app-service-web-dotnet-get-started'\n  node: 'https://github.com/Azure-Samples/nodejs-docs-hello-world'\n  php: 'https://github.com/Azure-Samples/php-docs-hello-world'\n  html: 'https://github.com/Azure-Samples/html-docs-hello-world'\n}\nvar gitRepoUrl = (empty(repoUrl) ? gitRepoReference[language] : repoUrl)\nvar configReference = {\n  '.net': {\n    comments: '.Net app. No additional configuration needed.'\n  }\n  html: {\n    comments: 'HTML app. No additional configuration needed.'\n  }\n  php: {\n    phpVersion: '7.4'\n  }\n  node: {\n    appSettings: [\n      {\n        name: 'WEBSITE_NODE_DEFAULT_VERSION'\n        value: '12.15.0'\n      }\n    ]\n  }\n}\n\nresource asp 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: appServicePlanName\n  location: location\n  sku: {\n    name: sku\n  }\n}\n\nresource webApp 'Microsoft.Web/sites@2022-03-01' = {\n  name: webAppName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    siteConfig: union(configReference[language],{\n      minTlsVersion: '1.2'\n      scmMinTlsVersion: '1.2'\n      ftpsState: 'FtpsOnly'\n    })\n    serverFarmId: asp.id\n    httpsOnly: true\n  }\n}\n\nresource gitsource 'Microsoft.Web/sites/sourcecontrols@2022-03-01' = {\n  parent: webApp\n  name: 'web'\n  properties: {\n    repoUrl: gitRepoUrl\n    branch: 'master'\n    isManualIntegration: true\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1345."}, {"role": "assistant", "content": "@description('That name is the name of our application. It has to be unique.Type a name followed by your resource group name. (<name>-<resourceGroupName>)')\nparam webAppName string = 'Django-${uniqueString(resourceGroup().id)}'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar sku = 'Free'\nvar skuCode = 'F1'\nvar workerSize = 0\nvar appInsightName = '${webAppName}-insights'\nvar hostingPlanName = 'hpn-${resourceGroup().name}'\n\nresource webApp 'Microsoft.Web/sites@2022-03-01' = {\n  name: webAppName\n  location: location\n  properties: {\n    siteConfig: {\n      appSettings: [\n        {\n          name: 'WEBSITES_ENABLE_APP_SERVICE_STORAGE'\n          value: 'false'\n        }\n        {\n          name: 'APPINSIGHTS_INSTRUMENTATIONKEY'\n          value: appInsights.properties.InstrumentationKey\n        }\n        {\n          name: 'XDT_MicrosoftApplicationInsights_Mode'\n          value: 'default'\n        }\n        {\n          name: 'ApplicationInsightsAgent_EXTENSION_VERSION'\n          value: '~2'\n        }\n      ]\n      linuxFxVersion: 'DOCKER|appsvcorg/django-python:0.1'\n    }\n    clientAffinityEnabled: false\n    serverFarmId: hostingPlan.id\n  }\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    tier: sku\n    name: skuCode\n  }\n  kind: 'linux'\n  properties: {\n    reserved: true\n    targetWorkerSizeId: workerSize\n    targetWorkerCount: 1\n  }\n}\n\nresource appInsights 'Microsoft.Insights/components@2020-02-02' = {\n  name: appInsightName\n  location: location\n  kind: 'web'\n  properties: {\n    Application_Type: 'web'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1346."}, {"role": "assistant", "content": "@description('That name is the name of our application. It has to be unique.Type a name followed by your resource group name. (<name>-<resourceGroupName>)')\nparam webAppName string = 'flask-${uniqueString(resourceGroup().id)}'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\nvar alwaysOn = false\nvar sku = 'Free'\nvar skuCode = 'F1'\nvar workerSizeId = 0\nvar numberOfWorkers = 1\nvar linuxFxVersion = 'PYTHON|3.7'\nvar hostingPlanName = 'hpn-${resourceGroup().name}'\n\nresource webApp 'Microsoft.Web/sites@2022-03-01' = {\n  name: webAppName\n  location: location\n  properties: {\n    siteConfig: {\n      linuxFxVersion: linuxFxVersion\n      alwaysOn: alwaysOn\n    }\n    serverFarmId: hostingPlan.id\n    clientAffinityEnabled: false\n  }\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanName\n  location: location\n  kind: 'linux'\n  properties: {\n    targetWorkerCount: numberOfWorkers\n    targetWorkerSizeId: workerSizeId\n    reserved: true\n  }\n  sku: {\n    tier: sku\n    name: skuCode\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1347."}, {"role": "assistant", "content": "@description('The unique name of your website.')\nparam siteName string = uniqueString(resourceGroup().id)\n\n@description('Database administrator login name')\n@minLength(1)\nparam administratorLogin string\n\n@description('Database administrator password')\n@minLength(8)\n@secure()\nparam administratorLoginPassword string\n\n@description('Azure database for mySQL compute capacity in vCores (2,4,8,16,32)')\n@allowed([\n  2\n  4\n  8\n  16\n  32\n])\nparam dbSkucapacity int = 2\n\n@description('Azure database for mySQL sku name ')\n@allowed([\n  'GP_Gen5_2'\n  'GP_Gen5_4'\n  'GP_Gen5_8'\n  'GP_Gen5_16'\n  'GP_Gen5_32'\n  'MO_Gen5_2'\n  'MO_Gen5_4'\n  'MO_Gen5_8'\n  'MO_Gen5_16'\n  'MO_Gen5_32'\n])\nparam dbSkuName string = 'GP_Gen5_2'\n\n@description('Azure database for mySQL Sku Size ')\n@allowed([\n  102400\n  51200\n])\nparam dbSkuSizeMB int = 51200\n\n@description('Azure database for mySQL pricing tier')\n@allowed([\n  'GeneralPurpose'\n  'MemoryOptimized'\n])\nparam dbSkuTier string = 'GeneralPurpose'\n\n@description('MySQL version')\n@allowed([\n  '5.6'\n  '5.7'\n])\nparam mysqlVersion string = '5.7'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Azure database for mySQL sku family')\nparam databaseskuFamily string = 'Gen5'\n\nvar databaseName = uniqueString(resourceGroup().id)\nvar mysqlserverName = uniqueString(resourceGroup().id)\nvar hostingPlanName = uniqueString(resourceGroup().id)\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2020-06-01' = {\n  name: hostingPlanName\n  location: location\n  sku: {\n    tier: 'Standard'\n    name: 'S1'\n  }\n  kind: 'linux'\n  properties: {\n    reserved: true\n  }\n}\n\nresource site 'Microsoft.Web/sites@2021-02-01' = {\n  name: siteName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    siteConfig: {\n      linuxFxVersion: 'php|7.0'\n      ftpsState: 'FtpsOnly'\n      minTlsVersion: '1.2'\n      scmMinTlsVersion: '1.2'\n      connectionStrings: [\n        {\n          name: 'defaultConnection'\n          connectionString: 'Database=${databaseName};Data Source=${mysqlserver.properties.fullyQualifiedDomainName};User Id=${administratorLogin}@${mysqlserverName};Password=${administratorLoginPassword}'\n          type: 'MySql'\n        }\n      ]\n    }\n    serverFarmId: hostingPlan.id\n    httpsOnly: true\n  }     \n}\n\nresource mysqlserver 'Microsoft.DBforMySQL/servers@2017-12-01' = {\n  name: mysqlserverName\n  location: location\n  sku: {\n    name: dbSkuName\n    tier: dbSkuTier\n    capacity: dbSkucapacity\n    family: databaseskuFamily\n  }\n  properties: {\n    createMode: 'Default'\n    version: mysqlVersion\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    storageProfile: {\n      storageMB: dbSkuSizeMB\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Disabled'\n    }\n    sslEnforcement: 'Disabled'\n  }\n}\n\nresource serverName_AllowAzureIPs 'Microsoft.DBforMySQL/servers/firewallrules@2017-12-01' = {\n  parent: mysqlserver\n  name: 'AllowAzureIPs'\n  properties: {\n    startIpAddress: '0.0.0.0'\n    endIpAddress: '255.255.255.255'\n  }\n}\n\nresource mysqlserverName_databaseName 'Microsoft.DBforMySQL/servers/databases@2017-12-01' = {\n  parent: mysqlserver\n  name: databaseName\n  properties: {\n    charset: 'utf8'\n    collation: 'utf8_general_ci'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1348 please."}, {"role": "assistant", "content": "@description('Name of Azure Web App')\nparam siteName string = 'sonarqube-${uniqueString(resourceGroup().id)}'\n\n@description('The version of the Sonarqube container image to use. Only recent versions of Sonarqube which uses the new variables prefix and can run, as development purposes, with Azure App Service Web App for Containers.')\n@allowed([\n  '10.5-community'\n  '10.4-community'\n  '10.3-community'\n  '10.2-community'\n  '10.1-community'\n  '10.0-community'\n  '9.9-community'\n  '9.8-community'\n  '9.7-community'\n  '9.6-community'\n  '8.9-community'\n  'latest'\n])\nparam sonarqubeImageVersion string = '10.5-community'\n\n@description('App Service Plan Pricing Tier')\n@allowed([\n  'B1'\n  'B2'\n  'B3'\n  'S1'\n  'S2'\n  'S3'\n  'P1V2'\n  'P2V2'\n  'P2V3'\n])\nparam servicePlanPricingTier string = 'S2'\n\n@description('App Service Capacity')\n@minValue(1)\n@maxValue(3)\nparam servicePlanCapacity int = 1\n\n@description('Azure SQL Server Administrator Username')\n@minLength(1)\nparam sqlServerAdministratorUsername string\n\n@description('Azure SQL Server Administrator Password')\n@minLength(12)\n@maxLength(128)\n@secure()\nparam sqlServerAdministratorPassword string\n\n@description('Azure SQL Database SKU Name')\n@allowed([\n  'GP_Gen4_1'\n  'GP_Gen4_2'\n  'GP_Gen4_3'\n  'GP_Gen4_4'\n  'GP_Gen4_5'\n  'GP_Gen4_6'\n  'GP_Gen4_7'\n  'GP_Gen4_8'\n  'GP_Gen4_9'\n  'GP_Gen4_10'\n  'GP_Gen4_16'\n  'GP_Gen4_24'\n  'GP_Gen5_2'\n  'GP_Gen5_4'\n  'GP_Gen5_6'\n  'GP_Gen5_8'\n  'GP_Gen5_10'\n  'GP_Gen5_12'\n  'GP_Gen5_14'\n  'GP_Gen5_16'\n  'GP_Gen5_18'\n  'GP_Gen5_20'\n  'GP_Gen5_24'\n  'GP_Gen5_32'\n  'GP_Gen5_40'\n  'GP_Gen5_80'\n  'GP_S_Gen5_1'\n  'GP_S_Gen5_2'\n  'GP_S_Gen5_4'\n])\nparam sqlDatabaseSkuName string = 'GP_S_Gen5_2'\n\n@description('Azure SQL Database Storage Max Size in GB')\n@minValue(1)\n@maxValue(1024)\nparam sqlDatabaseSkuSizeGB int = 16\n\n@description('Location for all the resources.')\nparam location string = resourceGroup().location\n\nvar databaseName = 'sonarqube'\nvar sqlServerName = '${siteName}-sql'\nvar servicePlanName = '${siteName}-asp'\nvar servicePlanPricingTiers = {\n  F1: {\n    tier: 'Free'\n  }\n  B1: {\n    tier: 'Basic'\n  }\n  B2: {\n    tier: 'Basic'\n  }\n  B3: {\n    tier: 'Basic'\n  }\n  S1: {\n    tier: 'Standard'\n  }\n  S2: {\n    tier: 'Standard'\n  }\n  S3: {\n    tier: 'Standard'\n  }\n  P1V2: {\n    tier: 'Standard'\n  }\n  P2V2: {\n    tier: 'Standard'\n  }\n  P2V3: {\n    tier: 'Standard'\n  }\n}\n\nresource servicePlan 'Microsoft.Web/serverfarms@2023-01-01' = {\n  name: servicePlanName\n  location: location\n  properties: {\n    reserved: true\n  }\n  sku: {\n    name: servicePlanPricingTier\n    tier: servicePlanPricingTiers[servicePlanPricingTier].tier\n    capacity: servicePlanCapacity\n  }\n  kind: 'linux'\n}\n\nresource site 'Microsoft.Web/sites@2023-01-01' = {\n  name: siteName\n  location: location\n  properties: {\n    siteConfig: {\n      linuxFxVersion: 'DOCKER|sonarqube:${sonarqubeImageVersion}'\n    }\n    serverFarmId: servicePlan.id\n  }\n}\n\nresource siteAppSettings 'Microsoft.Web/sites/config@2023-01-01' = {\n  parent: site\n  name: 'appsettings'\n  properties: {\n    SONAR_ES_BOOTSTRAP_CHECKS_DISABLE: 'true'\n    SONAR_JDBC_URL: 'jdbc:sqlserver://${sqlServer.properties.fullyQualifiedDomainName}:1433;databaseName=${databaseName};encrypt=true;trustServerCertificate=false;hostNameInCertificate=${replace(sqlServer.properties.fullyQualifiedDomainName, '${sqlServerName}.', '*.')};loginTimeout=30;'\n    SONAR_JDBC_USERNAME: sqlServerAdministratorUsername\n    SONAR_JDBC_PASSWORD: sqlServerAdministratorPassword\n  }\n}\n\nresource sqlServer 'Microsoft.Sql/servers@2021-11-01' = {\n  location: location\n  name: sqlServerName\n  properties: {\n    administratorLogin: sqlServerAdministratorUsername\n    administratorLoginPassword: sqlServerAdministratorPassword\n    version: '12.0'\n  }\n}\n\nresource sqlServerFirewall 'Microsoft.Sql/servers/firewallrules@2021-11-01' = {\n  parent: sqlServer\n  name: '${sqlServerName}firewall'\n  properties: {\n    startIpAddress: '0.0.0.0'\n    endIpAddress: '0.0.0.0'\n  }\n}\n\nresource sqlDatabase 'Microsoft.Sql/servers/databases@2021-11-01' = {\n  parent: sqlServer\n  name: databaseName\n  location: location\n  sku: {\n    name: sqlDatabaseSkuName\n    tier: 'GeneralPurpose'\n  }\n  properties: {\n    collation: 'SQL_Latin1_General_CP1_CS_AS'\n    catalogCollation: 'SQL_Latin1_General_CP1_CI_AS'\n    maxSizeBytes: (((sqlDatabaseSkuSizeGB * 1024) * 1024) * 1024)\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1349?"}, {"role": "assistant", "content": "@description('Name of azure web app')\nparam siteName string\n\n@description('Tier for Service Plan')\n@allowed([\n  'Basic'\n  'Standard'\n])\nparam servicePlanTier string = 'Standard'\n\n@description('Size for Service Plan')\n@allowed([\n  'B1'\n  'B2'\n  'B3'\n  'S1'\n  'S2'\n  'S3'\n])\nparam servicePlanSku string = 'S2'\n\n@description('Database administrator login name')\n@minLength(1)\nparam administratorLogin string\n\n@description('Database administrator password')\n@minLength(8)\n@maxLength(128)\n@secure()\nparam administratorLoginPassword string\n\n@description('Azure database for PostgreSQL compute capacity in vCores (2,4,8,16,32)')\n@allowed([\n  2\n  4\n  8\n  16\n  32\n])\nparam databaseSkuCapacity int = 2\n\n@description('Azure database for PostgreSQL sku name ')\n@allowed([\n  'GP_Gen5_2'\n  'GP_Gen5_4'\n  'GP_Gen5_8'\n  'GP_Gen5_16'\n  'GP_Gen5_32'\n  'MO_Gen5_2'\n  'MO_Gen5_4'\n  'MO_Gen5_8'\n  'MO_Gen5_16'\n  'MO_Gen5_32'\n])\nparam databaseSkuName string = 'GP_Gen5_2'\n\n@description('Azure database for PostgreSQL Sku Size ')\n@allowed([\n  102400\n  51200\n])\nparam databaseSkuSizeMB int = 51200\n\n@description('Azure database for PostgreSQL pricing tier')\n@allowed([\n  'GeneralPurpose'\n  'MemoryOptimized'\n])\nparam databaseSkuTier string = 'GeneralPurpose'\n\n@description('PostgreSQL version')\n@allowed([\n  '9.5'\n  '9.6'\n])\nparam postgresqlVersion string = '9.6'\n\n@description('Azure database for PostgreSQL sku family')\nparam databaseskuFamily string = 'Gen5'\n\n@description('Location for all the resources.')\nparam location string = resourceGroup().location\n\nvar databaseName = '${siteName}database'\nvar serverName = '${siteName}pgserver'\nvar jdbcSonarUserName = '${administratorLogin}@${serverName}'\nvar hostingPlanName = '${siteName}serviceplan'\n\nresource site 'Microsoft.Web/sites@2022-03-01' = {\n  name: siteName\n  location: location\n  properties: {\n    siteConfig: {\n      linuxFxVersion: 'DOCKER|SONARQUBE'\n    }\n    serverFarmId: hostingPlan.id\n  }\n}\n\nresource config 'Microsoft.Web/sites/config@2022-03-01' = {\n  parent: site\n  name: 'appsettings'\n  dependsOn: [\n    database\n  ]\n  properties: {\n    SONARQUBE_JDBC_URL: 'jdbc:postgresql://${server.properties.fullyQualifiedDomainName}:5432/${databaseName}?user=${jdbcSonarUserName}&password=${administratorLoginPassword}&ssl=true'\n    SONARQUBE_JDBC_USERNAME: jdbcSonarUserName\n    SONARQUBE_JDBC_PASSWORD: administratorLoginPassword\n    SONAR_ES_BOOTSTRAP_CHECKS_DISABLE: 'true'\n  }\n}\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanName\n  location: location\n  properties: {\n    targetWorkerSizeId: 1\n    reserved: true\n    targetWorkerCount: 1\n  }\n  sku: {\n    tier: servicePlanTier\n    name: servicePlanSku\n  }\n  kind: 'linux'\n}\n\nresource server 'Microsoft.DBforPostgreSQL/servers@2017-12-01' = {\n  location: location\n  name: serverName\n  sku: {\n    name: databaseSkuName\n    tier: databaseSkuTier\n    capacity: databaseSkuCapacity\n    size: '51200'\n    family: databaseskuFamily\n  }\n  properties: {\n    createMode: 'Default'\n    version: postgresqlVersion\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    storageProfile: {\n      storageMB: databaseSkuSizeMB\n    }\n  }\n}\n\nresource firewall 'Microsoft.DBforPostgreSQL/servers/firewallRules@2017-12-01' = {\n  parent: server\n  name: '${serverName}firewall'\n  properties: {\n    startIpAddress: '0.0.0.0'\n    endIpAddress: '255.255.255.255'\n  }\n}\n\nresource database 'Microsoft.DBforPostgreSQL/servers/databases@2017-12-01' = {\n  parent: server\n  name: databaseName\n  properties: {\n    charset: 'utf8'\n    collation: 'English_United States.1252'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1350."}, {"role": "assistant", "content": "@description('Name of Azure Web App')\nparam siteName string\n\n@description('The location into which the resources should be deployed')\nparam location string = resourceGroup().location\n\n@description('Database administrator login name')\n@minLength(1)\n@secure()\nparam administratorLogin string\n\n@description('Database administrator password')\n@minLength(8)\n@maxLength(128)\n@secure()\nparam administratorLoginPassword string\n\n@description('Sonarqube docker tag')\nparam sonarqubeDockerTag string = 'latest'\n\n@description('The tier of the particular SKU, e.g. Burstable')\n@allowed([\n  'Burstable'\n  'GeneralPurpose'\n  'MemoryOptimized'\n])\nparam postgresFlexibleServersSkuTier string = 'Burstable'\n\n@description('The name of the sku, typically, tier + family + cores, e.g. Standard_D4s_v3')\nparam postgresFlexibleServersSkuName string = 'Standard_B1ms'\n\n@description('The version of a PostgreSQL server')\n@allowed([\n  '11'\n  '12'\n  '13'\n])\nparam postgresFlexibleServersversion string = '13'\n\n@description('The mode to create a new PostgreSQL server')\n@allowed([\n  'Create'\n  'Default'\n  'PointInTimeRestore'\n  'Update'\n])\nparam createMode string = 'Default'\n\n@description('Sku and size of App Service Plan (F1 does not support virtual network integration)')\n@allowed([\n  'B1'\n  'B2'\n  'B3'\n  'D1'\n  'I1'\n  'I1v2'\n  'I2v2'\n  'I3v2'\n  'P1V2'\n  'P1V3'\n  'P2V2'\n  'P2V3'\n  'P3V2'\n  'P3V3'\n  'S1'\n  'S2'\n  'S3'\n])\nparam appServicePlanSkuName string = 'B1'\n\nvar appServicePlanName = '${siteName}serviceplan'\nvar virtualNetworkName = '${siteName}vnet'\nvar privateDNSZoneName = '${siteName}.private.postgres.database.azure.com'\nvar privateDNSZoneLinkName = '${siteName}privatelink'\nvar postgresFlexibleServersName = '${siteName}postgres'\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2023-11-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/16'\n      ]\n    }\n    subnets: [\n      {\n        name: 'appNet'\n        properties: {\n          addressPrefix: '10.0.0.0/24'\n          delegations: [\n            {\n              name: 'appDelegation'\n              properties: {\n                serviceName: 'Microsoft.Web/serverfarms'\n              }\n            }\n          ]\n        }\n      }\n      {\n        name: 'dbNet'\n        properties: {\n          addressPrefix: '10.0.1.0/24'\n          delegations: [\n            {\n              name: 'dbDelegation'\n              properties: {\n                serviceName: 'Microsoft.DBforPostgreSQL/flexibleServers'\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource privateDNSZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDNSZoneName\n  location: 'global'\n}\n\nresource privateDNSZoneRecordA 'Microsoft.Network/privateDnsZones/A@2020-06-01' = {\n  parent: privateDNSZone\n  name: uniqueString(siteName)\n  properties: {\n    ttl: 30\n    aRecords: [\n      {\n        ipv4Address: '10.0.1.4'\n      }\n    ]\n  }\n}\n\nresource privateDNSZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateDNSZone\n  name: privateDNSZoneLinkName\n  location: 'global'\n  properties: {\n    registrationEnabled: true\n    virtualNetwork: {\n      id: virtualNetwork.id\n    }\n  }\n}\n\nresource postgresFlexibleServers 'Microsoft.DBforPostgreSQL/flexibleServers@2023-12-01-preview' = {\n  name: postgresFlexibleServersName\n  location: location\n  sku: {\n    name: postgresFlexibleServersSkuName\n    tier: postgresFlexibleServersSkuTier\n  }\n  properties: {\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    createMode: createMode\n    network: {\n      delegatedSubnetResourceId: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, 'dbNet')\n      privateDnsZoneArmResourceId: privateDNSZone.id\n    }\n    storage: {\n      storageSizeGB: 32\n    }\n    backup: {\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Disabled'\n    }\n    highAvailability: {\n      mode: 'Disabled'\n    }\n    maintenanceWindow: {\n      customWindow: 'Disabled'\n      dayOfWeek: 0\n      startHour: 0\n      startMinute: 0\n    }\n    version: postgresFlexibleServersversion\n  }\n  dependsOn: [\n    privateDNSZoneLink\n  ]\n}\n\nresource appServicePlan 'Microsoft.Web/serverfarms@2023-12-01' = {\n  name: appServicePlanName\n  location: location\n  kind: 'linux'\n  properties: {\n    reserved: true\n  }\n  sku: {\n    name: appServicePlanSkuName\n  }\n}\n\nresource webApplication 'Microsoft.Web/sites@2023-12-01' = {\n  name: siteName\n  location: location\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    virtualNetworkSubnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, 'appNet')\n    serverFarmId: appServicePlan.id\n    httpsOnly: true\n    siteConfig: {\n      minTlsVersion: '1.2'\n      ftpsState: 'Disabled'\n      linuxFxVersion: 'DOCKER|sonarqube:${sonarqubeDockerTag}'\n      appSettings: [\n        {\n          name: 'WEBSITES_PORT'\n          value: '9000'\n        }\n        {\n          name: 'SONAR_ES_BOOTSTRAP_CHECKS_DISABLE'\n          value: 'true'\n        }\n        {\n          name: 'SONAR_JDBC_URL'\n          value: 'jdbc:postgresql://${postgresFlexibleServers.properties.fullyQualifiedDomainName}:5432/postgres'\n        }\n        {\n          name: 'SONAR_JDBC_USERNAME'\n          value: administratorLogin\n        }\n        {\n          name: 'SONAR_JDBC_PASSWORD'\n          value: administratorLoginPassword\n        }\n      ]\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1351?"}, {"role": "assistant", "content": "@description('Name of azure web app')\nparam siteName string\n\n@description('Database administrator login name')\n@minLength(1)\nparam administratorLogin string\n\n@description('Database administrator password')\n@minLength(8)\n@maxLength(128)\n@secure()\nparam administratorLoginPassword string\n\n@description('Azure database for MySQL compute capacity in vCores (2,4,8,16,32)')\n@allowed([\n  2\n  4\n  8\n  16\n  32\n])\nparam databaseSkucapacity int = 2\n\n@description('Azure database for MySQL sku name ')\n@allowed([\n  'GP_Gen5_2'\n  'GP_Gen5_4'\n  'GP_Gen5_8'\n  'GP_Gen5_16'\n  'GP_Gen5_32'\n  'MO_Gen5_2'\n  'MO_Gen5_4'\n  'MO_Gen5_8'\n  'MO_Gen5_16'\n  'MO_Gen5_32'\n])\nparam databaseSkuName string = 'GP_Gen5_2'\n\n@description('Azure database for MySQL Sku Size ')\n@allowed([\n  51200\n  102400\n])\nparam databaseSkuSizeMB int = 51200\n\n@description('Azure database for MySQL pricing tier')\n@allowed([\n  'GeneralPurpose'\n  'MemoryOptimized'\n])\nparam databaseSkuTier string = 'GeneralPurpose'\n\n@description('MySQL version')\n@allowed([\n  '5.6'\n  '5.7'\n])\nparam mySqlVersion string = '5.6'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Azure database for MySQL sku family')\nparam databaseSkuFamily string = 'Gen5'\n\nvar databaseName = '${siteName}-database'\nvar serverName = '${siteName}-server'\nvar hostingPlanName = '${siteName}-serviceplan'\n\nresource hostingPlan 'Microsoft.Web/serverfarms@2020-06-01' = {\n  name: hostingPlanName\n  location: location\n  properties: {\n    reserved: true\n  }\n  sku: {\n    tier: 'Standard'\n    name: 'S1'\n  }\n}\n\nresource website 'Microsoft.Web/sites@2020-06-01' = {\n  name: siteName\n  location: location\n  properties: {\n    serverFarmId: hostingPlan.id\n  }\n}\n\nresource connectionString 'Microsoft.Web/sites/config@2020-06-01' = {\n  parent: website\n  name: 'connectionstrings'\n  properties: {\n    defaultConnection: {\n      value: 'Database=${databaseName};Data Source=${server.properties.fullyQualifiedDomainName};User Id=${administratorLogin}@${serverName};Password=${administratorLoginPassword}'\n      type: 'MySql'\n    }\n  }\n}\n\nresource server 'Microsoft.DBforMySQL/servers@2017-12-01' = {\n  location: location\n  name: serverName\n  sku: {\n    name: databaseSkuName\n    tier: databaseSkuTier\n    capacity: databaseSkucapacity\n    size: string(databaseSkuSizeMB)\n    family: databaseSkuFamily\n  }\n  properties: {\n    createMode: 'Default'\n    version: mySqlVersion\n    administratorLogin: administratorLogin\n    administratorLoginPassword: administratorLoginPassword\n    storageProfile: {\n      storageMB: databaseSkuSizeMB\n      backupRetentionDays: 7\n      geoRedundantBackup: 'Disabled'\n    }\n    sslEnforcement: 'Disabled'\n  }\n}\n\nresource firewallRules 'Microsoft.DBforMySQL/servers/firewallrules@2017-12-01' = {\n  parent: server\n  name: 'AllowAzureIPs'\n  dependsOn: [\n    database\n  ]\n  properties: {\n    startIpAddress: '0.0.0.0'\n    endIpAddress: '0.0.0.0'\n  }\n}\n\nresource database 'Microsoft.DBforMySQL/servers/databases@2017-12-01' = {\n  parent: server\n  name: databaseName\n  properties: {\n    charset: 'utf8'\n    collation: 'utf8_general_ci'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1352."}, {"role": "assistant", "content": "@description('The location into which regionally scoped resources should be deployed. Note that Front Door is a global resource.')\nparam location string = resourceGroup().location\n\n@description('The location into which regionally scoped resources for the secondary should be deployed.')\nparam secondaryLocation string = 'eastus'\n\n@description('The name of the App Service application to create. This must be globally unique.')\nparam webAppName string = 'myApp-${uniqueString(resourceGroup().id)}'\n\n@description('The name of the secondary App Service application to create. This must be globally unique.')\nparam secondaryWebAppName string = 'mySecondaryApp-${uniqueString(resourceGroup().id)}'\n\n@description('The name of the SKU to use when creating the App Service plan.')\nparam appServicePlanSkuName string = 'P1V2'\n\n@description('The number of worker instances of your App Service plan that should be provisioned.')\nparam appServicePlanCapacity int = 1\n\n@description('The name of the Front Door endpoint to create. This must be globally unique.')\nparam frontDoorEndpointName string = 'afd-${uniqueString(resourceGroup().id)}'\n\n@description('The name of the SKU to use when creating the Front Door profile.')\n@allowed([\n  'Standard_AzureFrontDoor'\n  'Premium_AzureFrontDoor'\n])\nparam frontDoorSkuName string = 'Standard_AzureFrontDoor'\n\nvar appServicePlanName = 'AppServicePlan'\nvar secondaryAppServicePlanName = 'SecondaryAppServicePlan'\n\nvar frontDoorProfileName = 'MyFrontDoor'\nvar frontDoorOriginGroupName = 'MyOriginGroup'\nvar frontDoorOriginName = 'MyAppServiceOrigin'\nvar secondaryFrontDoorOriginName = 'MySecondaryAppServiceOrigin'\nvar frontDoorRouteName = 'MyRoute'\n\nresource frontDoorProfile 'Microsoft.Cdn/profiles@2021-06-01' = {\n  name: frontDoorProfileName\n  location: 'global'\n  sku: {\n    name: frontDoorSkuName\n  }\n}\n\nresource appServicePlan 'Microsoft.Web/serverFarms@2020-06-01' = {\n  name: appServicePlanName\n  location: location\n  sku: {\n    name: appServicePlanSkuName\n    capacity: appServicePlanCapacity\n  }\n  kind: 'app'\n  properties: {\n    reserved: true\n  }\n}\n\nresource secondaryAppServicePlan 'Microsoft.Web/serverFarms@2020-06-01' = {\n  name: secondaryAppServicePlanName\n  location: secondaryLocation\n  sku: {\n    name: appServicePlanSkuName\n    capacity: appServicePlanCapacity\n  }\n  kind: 'app'\n  properties: {\n    reserved: true\n  }\n}\n\nresource app 'Microsoft.Web/sites@2020-06-01' = {\n  name: webAppName\n  location: location\n  kind: 'app'\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    serverFarmId: appServicePlan.id\n    httpsOnly: true\n    siteConfig: {\n      detailedErrorLoggingEnabled: true\n      httpLoggingEnabled: true\n      requestTracingEnabled: true\n      ftpsState: 'Disabled'\n      minTlsVersion: '1.2'\n      ipSecurityRestrictions: [\n        {\n          tag: 'ServiceTag'\n          ipAddress: 'AzureFrontDoor.Backend'\n          action: 'Allow'\n          priority: 100\n          headers: {\n            'x-azure-fdid': [\n              frontDoorProfile.properties.frontDoorId\n            ]\n          }\n          name: 'Allow traffic from Front Door'\n        }\n      ]\n      scmIpSecurityRestrictionsDefaultAction: 'Deny'\n    }\n  }\n}\n\nresource ftpPolicy 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'ftp'\n  location: location\n  kind: 'string'\n  parent: app\n  properties: {\n    allow: false\n  }\n}\n\nresource scmPolicy 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'scm'\n  location: location\n  kind: 'string'\n  parent: app\n  properties: {\n    allow: false\n  }\n}\n\nresource appSlot 'Microsoft.Web/sites/slots@2020-06-01' = {\n  name: '${webAppName}/stage'\n  location: location\n  kind: 'app'\n  identity: {\n    type: 'SystemAssigned'\n  }\n  dependsOn: [\n    app\n  ]\n  properties: {\n    serverFarmId: appServicePlan.id\n    httpsOnly: true\n    siteConfig: {\n      detailedErrorLoggingEnabled: true\n      httpLoggingEnabled: true\n      requestTracingEnabled: true\n      ftpsState: 'Disabled'\n      minTlsVersion: '1.2'\n      ipSecurityRestrictions: [\n        {\n          tag: 'ServiceTag'\n          ipAddress: 'AzureFrontDoor.Backend'\n          action: 'Allow'\n          priority: 100\n          headers: {\n            'x-azure-fdid': [\n              frontDoorProfile.properties.frontDoorId\n            ]\n          }\n          name: 'Allow traffic from Front Door'\n        }\n      ]\n    }\n  }\n}\n\nresource ftpPolicySlot 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'ftp'\n  location: location\n  kind: 'string'\n  parent: appSlot\n  properties: {\n    allow: false\n  }\n}\n\nresource scmPolicySlot 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'scm'\n  location: location\n  kind: 'string'\n  parent: appSlot\n  properties: {\n    allow: false\n  }\n}\n\nresource secondaryApp 'Microsoft.Web/sites@2020-06-01' = {\n  name: secondaryWebAppName\n  location: secondaryLocation\n  kind: 'app'\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    serverFarmId: secondaryAppServicePlan.id\n    httpsOnly: true\n    siteConfig: {\n      detailedErrorLoggingEnabled: true\n      httpLoggingEnabled: true\n      requestTracingEnabled: true\n      ftpsState: 'Disabled'\n      minTlsVersion: '1.2'\n      ipSecurityRestrictions: [\n        {\n          tag: 'ServiceTag'\n          ipAddress: 'AzureFrontDoor.Backend'\n          action: 'Allow'\n          priority: 100\n          headers: {\n            'x-azure-fdid': [\n              frontDoorProfile.properties.frontDoorId\n            ]\n          }\n          name: 'Allow traffic from Front Door'\n        }\n      ]\n      scmIpSecurityRestrictionsDefaultAction: 'Deny'\n    }\n  }\n}\n\nresource secondaryFtpPolicy 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'ftp'\n  location: secondaryLocation\n  kind: 'string'\n  parent: secondaryApp\n  properties: {\n    allow: false\n  }\n}\n\nresource secondaryScmPolicy 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'scm'\n  location: secondaryLocation\n  kind: 'string'\n  parent: secondaryApp\n  properties: {\n    allow: false\n  }\n}\n\nresource secondaryAppSlot 'Microsoft.Web/sites/slots@2020-06-01' = {\n  name: '${secondaryWebAppName}/stage'\n  location: secondaryLocation\n  kind: 'app'\n  identity: {\n    type: 'SystemAssigned'\n  }\n  dependsOn: [\n    secondaryApp\n  ]\n  properties: {\n    serverFarmId: secondaryAppServicePlan.id\n    httpsOnly: true\n    siteConfig: {\n      detailedErrorLoggingEnabled: true\n      httpLoggingEnabled: true\n      requestTracingEnabled: true\n      ftpsState: 'Disabled'\n      minTlsVersion: '1.2'\n      ipSecurityRestrictions: [\n        {\n          tag: 'ServiceTag'\n          ipAddress: 'AzureFrontDoor.Backend'\n          action: 'Allow'\n          priority: 100\n          headers: {\n            'x-azure-fdid': [\n              frontDoorProfile.properties.frontDoorId\n            ]\n          }\n          name: 'Allow traffic from Front Door'\n        }\n      ]\n    }\n  }\n}\n\nresource secondaryFtpPolicySlot 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'ftp'\n  location: secondaryLocation\n  kind: 'string'\n  parent: secondaryAppSlot\n  properties: {\n    allow: false\n  }\n}\n\nresource secondaryScmPolicySlot 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'scm'\n  location: secondaryLocation\n  kind: 'string'\n  parent: secondaryAppSlot\n  properties: {\n    allow: false\n  }\n}\n\nresource frontDoorEndpoint 'Microsoft.Cdn/profiles/afdEndpoints@2021-06-01' = {\n  name: frontDoorEndpointName\n  location: 'global'\n  parent: frontDoorProfile\n  properties: {\n    enabledState: 'Enabled'\n  }\n}\n\nresource frontDoorOriginGroup 'Microsoft.Cdn/profiles/originGroups@2021-06-01' = {\n  name: frontDoorOriginGroupName\n  parent: frontDoorProfile\n  properties: {\n    loadBalancingSettings: {\n      sampleSize: 4\n      successfulSamplesRequired: 3\n    }\n    healthProbeSettings: {\n      probePath: '/'\n      probeRequestType: 'HEAD'\n      probeProtocol: 'Http'\n      probeIntervalInSeconds: 100\n    }\n  }\n}\n\nresource frontDoorOrigin 'Microsoft.Cdn/profiles/originGroups/origins@2021-06-01' = {\n  name: frontDoorOriginName\n  parent: frontDoorOriginGroup\n  properties: {\n    hostName: app.properties.defaultHostName\n    httpPort: 80\n    httpsPort: 443\n    originHostHeader: app.properties.defaultHostName\n    priority: 1\n    weight: 1000\n  }\n}\n\nresource secondaryFrontDoorOrigin 'Microsoft.Cdn/profiles/originGroups/origins@2021-06-01' = {\n  name: secondaryFrontDoorOriginName\n  parent: frontDoorOriginGroup\n  properties: {\n    hostName: secondaryApp.properties.defaultHostName\n    httpPort: 80\n    httpsPort: 443\n    originHostHeader: app.properties.defaultHostName\n    priority: 2\n    weight: 1000\n  }\n}\n\nresource frontDoorRoute 'Microsoft.Cdn/profiles/afdEndpoints/routes@2021-06-01' = {\n  name: frontDoorRouteName\n  parent: frontDoorEndpoint\n  dependsOn: [\n    frontDoorOrigin\n  ]\n  properties: {\n    originGroup: {\n      id: frontDoorOriginGroup.id\n    }\n    supportedProtocols: [\n      'Http'\n      'Https'\n    ]\n    patternsToMatch: [\n      '/*'\n    ]\n    forwardingProtocol: 'HttpsOnly'\n    linkToDefaultDomain: 'Enabled'\n    httpsRedirect: 'Enabled'\n  }\n}\n\noutput appServiceHostName string = app.properties.defaultHostName\noutput secondaryAppServiceHostName string = secondaryApp.properties.defaultHostName\noutput appServiceSlotHostName string = appSlot.properties.defaultHostName\noutput secondaryAppServiceSlotHostName string = secondaryAppSlot.properties.defaultHostName\noutput frontDoorEndpointHostName string = frontDoorEndpoint.properties.hostName\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1353."}, {"role": "assistant", "content": "@description('Name of the VNet')\nparam virtualNetworkName string = 'vnet1'\n\n@description('Name of the Web Farm')\nparam serverFarmName string = 'serverfarm'\n\n@description('Web App 1 name must be unique DNS name worldwide')\nparam site1_Name string = 'webapp1-${uniqueString(resourceGroup().id)}'\n\n@description('Web App 2 name must be unique DNS name worldwide')\nparam site2_Name string = 'webapp2-${uniqueString(resourceGroup().id)}'\n\n@description('CIDR of your VNet')\nparam virtualNetwork_CIDR string = '10.200.0.0/16'\n\n@description('Name of the subnet')\nparam subnet1Name string = 'Subnet1'\n\n@description('Name of the subnet')\nparam subnet2Name string = 'Subnet2'\n\n@description('CIDR of your subnet')\nparam subnet1_CIDR string = '10.200.1.0/24'\n\n@description('CIDR of your subnet')\nparam subnet2_CIDR string = '10.200.2.0/24'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('SKU name, must be minimum P1v2')\n@allowed([\n  'P1v2'\n  'P2v2'\n  'P3v2'\n])\nparam skuName string = 'P1v2'\n\n@description('SKU size, must be minimum P1v2')\n@allowed([\n  'P1v2'\n  'P2v2'\n  'P3v2'\n])\nparam skuSize string = 'P1v2'\n\n@description('SKU family, must be minimum P1v2')\n@allowed([\n  'P1v2'\n  'P2v2'\n  'P3v2'\n])\nparam skuFamily string = 'P1v2'\n\n@description('Name of your Private Endpoint')\nparam privateEndpointName string = 'PrivateEndpoint1'\n\n@description('Link name between your Private Endpoint and your Web App')\nparam privateLinkConnectionName string = 'PrivateEndpointLink1'\n\nvar webapp_dns_name = '.azurewebsites.net'\nvar privateDNSZoneName = 'privatelink.azurewebsites.net'\nvar SKU_tier = 'PremiumV2'\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-06-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        virtualNetwork_CIDR\n      ]\n    }\n    subnets: [\n      {\n        name: subnet1Name\n        properties: {\n          addressPrefix: subnet1_CIDR\n          privateEndpointNetworkPolicies: 'Disabled'\n        }\n      }\n      {\n        name: subnet2Name\n        properties: {\n          addressPrefix: subnet2_CIDR\n          delegations: [\n            {\n              name: 'delegation'\n              properties: {\n                serviceName: 'Microsoft.Web/serverfarms'\n              }\n            }\n          ]\n          privateEndpointNetworkPolicies: 'Enabled'\n        }\n      }\n    ]\n  }\n}\n\nresource serverFarm 'Microsoft.Web/serverfarms@2020-06-01' = {\n  name: serverFarmName\n  location: location\n  sku: {\n    name: skuName\n    tier: SKU_tier\n    size: skuSize\n    family: skuFamily\n    capacity: 1\n  }\n  kind: 'app'\n}\n\nresource webApp1 'Microsoft.Web/sites@2022-03-01' = {\n  name: site1_Name\n  location: location\n  kind: 'app'\n  properties: {\n    serverFarmId: serverFarm.id\n  }\n}\n\nresource webApp2 'Microsoft.Web/sites@2022-03-01' = {\n  name: site2_Name\n  location: location\n  kind: 'app'\n  properties: {\n    serverFarmId: serverFarm.id\n    virtualNetworkSubnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, subnet2Name)\n    vnetRouteAllEnabled: true\n  }\n}\n\nresource webApp1Config 'Microsoft.Web/sites/config@2020-06-01' = {\n  parent: webApp1\n  name: 'web'\n  properties: {\n    ftpsState: 'AllAllowed'\n  }\n}\n\nresource webApp2Config 'Microsoft.Web/sites/config@2020-06-01' = {\n  parent: webApp2\n  name: 'web'\n  properties: {\n    ftpsState: 'AllAllowed'\n  }\n}\n\nresource webApp1Binding 'Microsoft.Web/sites/hostNameBindings@2019-08-01' = {\n  parent: webApp1\n  name: '${webApp1.name}${webapp_dns_name}'\n  properties: {\n    siteName: webApp1.name\n    hostNameType: 'Verified'\n  }\n}\n\nresource webApp2Binding 'Microsoft.Web/sites/hostNameBindings@2019-08-01' = {\n  parent: webApp2\n  name: '${webApp2.name}${webapp_dns_name}'\n  properties: {\n    siteName: webApp2.name\n    hostNameType: 'Verified'\n  }\n}\n\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2020-06-01' = {\n  name: privateEndpointName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets',virtualNetwork.name ,subnet1Name)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: privateLinkConnectionName\n        properties: {\n          privateLinkServiceId: webApp1.id\n          groupIds: [\n            'sites'\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource privateDnsZones 'Microsoft.Network/privateDnsZones@2018-09-01' = {\n  name: privateDNSZoneName\n  location: 'global'\n  dependsOn: [\n    virtualNetwork\n  ]\n}\n\nresource privateDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2018-09-01' = {\n  parent: privateDnsZones\n  name: '${privateDnsZones.name}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetwork.id\n    }\n  }\n}\n\nresource privateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2020-03-01' = {\n  parent: privateEndpoint\n  name: 'dnsgroupname'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config1'\n        properties: {\n          privateDnsZoneId: privateDnsZones.id\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1354?"}, {"role": "assistant", "content": "@description('Name of the VNet')\nparam virtualNetworkName string = 'ntier-vnet'\n\n@description('Name of the Web Farm')\nparam serverFarmName string = 'serverfarm'\n\n@description('Backend Web App name must be unique DNS name worldwide')\nparam webAppNameBackend string = 'backend-${uniqueString(resourceGroup().id)}'\n\n@description('Frontend Web App name must be unique DNS name worldwide')\nparam webAppNameFrontend string = 'frontend-${uniqueString(resourceGroup().id)}'\n\n@description('CIDR of your VNet')\nparam virtualNetworkCidr string = '10.200.0.0/16'\n\n@description('Name of the backend subnet')\nparam subnetNamePrivateEndpoint string = 'PrivateEndpointSubnet'\n\n@description('Name of the frontend subnet')\nparam subnetNameVnetIntegration string = 'VnetIntegrationSubnet'\n\n@description('CIDR of your backend subnet')\nparam subnetCidrPrivateEndpoint string = '10.200.1.0/24'\n\n@description('CIDR of your frontend subnet')\nparam subnetCidrVnetIntegration string = '10.200.2.0/24'\n\n@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('SKU name')\n@allowed([\n  'P1v2'\n  'P2v2'\n  'P3v2'\n])\nparam skuName string = 'P1v2'\n\n@description('SKU size')\n@allowed([\n  'P1v2'\n  'P2v2'\n  'P3v2'\n])\nparam skuSize string = 'P1v2'\n\n@description('SKU family')\n@allowed([\n  'P1v2'\n  'P2v2'\n  'P3v2'\n])\nparam skuFamily string = 'P1v2'\n\n@description('Name of your Private Endpoint')\nparam privateEndpointName string = 'PrivateEndpoint1'\n\n@description('Name of your slot Private Endpoint')\nparam privateEndpointSlotName string = 'PrivateEndpoint2'\n\n@description('Link name between your Private Endpoint and your Web App')\nparam privateLinkConnectionName string = 'PrivateEndpointLink1'\n\n@description('Link name between your Private Endpoint and your Web App slot')\nparam privateLinkConnectionSlotName string = 'PrivateEndpointLink2'\n\nvar webappDnsName = '.azurewebsites.net'\nvar privateDNSZoneName = 'privatelink.azurewebsites.net'\nvar skuTier = 'PremiumV2'\n\nresource virtualNetwork 'Microsoft.Network/virtualNetworks@2020-06-01' = {\n  name: virtualNetworkName\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        virtualNetworkCidr\n      ]\n    }\n    subnets: [\n      {\n        name: subnetNamePrivateEndpoint\n        properties: {\n          addressPrefix: subnetCidrPrivateEndpoint\n          privateEndpointNetworkPolicies: 'Disabled'\n        }\n      }\n      {\n        name: subnetNameVnetIntegration\n        properties: {\n          addressPrefix: subnetCidrVnetIntegration\n          delegations: [\n            {\n              name: 'delegation'\n              properties: {\n                serviceName: 'Microsoft.Web/serverfarms'\n              }\n            }\n          ]\n          privateEndpointNetworkPolicies: 'Enabled'\n        }\n      }\n    ]\n  }\n}\n\nresource serverFarm 'Microsoft.Web/serverfarms@2020-06-01' = {\n  name: serverFarmName\n  location: location\n  sku: {\n    name: skuName\n    tier: skuTier\n    size: skuSize\n    family: skuFamily\n    capacity: 1\n  }\n  kind: 'app'\n  properties: {\n    reserved: true\n  }\n}\n\nresource webAppBackend 'Microsoft.Web/sites@2022-03-01' = {\n  name: webAppNameBackend\n  location: location\n  kind: 'app'\n  properties: {\n    serverFarmId: serverFarm.id\n    httpsOnly: true\n    siteConfig: {\n      detailedErrorLoggingEnabled: true\n      httpLoggingEnabled: true\n      requestTracingEnabled: true\n      ftpsState: 'Disabled'\n      minTlsVersion: '1.2'\n    }\n  }\n}\n\nresource ftpPolicyBackend 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'ftp'\n  location: location\n  kind: 'string'\n  parent: webAppBackend\n  properties: {\n    allow: false\n  }\n}\n\nresource scmPolicyBackend 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'scm'\n  location: location\n  kind: 'string'\n  parent: webAppBackend\n  properties: {\n    allow: false\n  }\n}\n\nresource webAppSlotBackend 'Microsoft.Web/sites/slots@2022-03-01' = {\n  name: '${webAppNameBackend}/stage'\n  location: location\n  kind: 'app'\n  dependsOn: [\n    webAppBackend\n  ]\n  properties: {\n    serverFarmId: serverFarm.id\n    httpsOnly: true\n    siteConfig: {\n      detailedErrorLoggingEnabled: true\n      httpLoggingEnabled: true\n      requestTracingEnabled: true\n      ftpsState: 'Disabled'\n      minTlsVersion: '1.2'\n    }\n  }\n}\n\nresource ftpPolicySlotBackend 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'ftp'\n  location: location\n  kind: 'string'\n  parent: webAppSlotBackend\n  properties: {\n    allow: false\n  }\n}\n\nresource scmPolicySlotBackend 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'scm'\n  location: location\n  kind: 'string'\n  parent: webAppSlotBackend\n  properties: {\n    allow: false\n  }\n}\n\nresource webAppFrontend 'Microsoft.Web/sites@2022-03-01' = {\n  name: webAppNameFrontend\n  location: location\n  kind: 'app'\n  properties: {\n    serverFarmId: serverFarm.id\n    httpsOnly: true\n    virtualNetworkSubnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, subnetNameVnetIntegration)\n    vnetRouteAllEnabled: true\n    siteConfig: {\n      detailedErrorLoggingEnabled: true\n      httpLoggingEnabled: true\n      requestTracingEnabled: true\n      ftpsState: 'Disabled'\n      minTlsVersion: '1.2'\n    }\n  }\n}\n\nresource ftpPolicyFrontend 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'ftp'\n  location: location\n  kind: 'string'\n  parent: webAppFrontend\n  properties: {\n    allow: false\n  }\n}\n\nresource scmPolicyFrontend 'Microsoft.Web/sites/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'scm'\n  location: location\n  kind: 'string'\n  parent: webAppFrontend\n  properties: {\n    allow: false\n  }\n}\n\nresource webAppSlotFrontend 'Microsoft.Web/sites/slots@2022-03-01' = {\n  name: '${webAppNameFrontend}/stage'\n  location: location\n  kind: 'app'\n  dependsOn: [\n    webAppFrontend\n  ]\n  properties: {\n    serverFarmId: serverFarm.id\n    httpsOnly: true\n    virtualNetworkSubnetId: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, subnetNameVnetIntegration)\n    vnetRouteAllEnabled: true\n    siteConfig: {\n      detailedErrorLoggingEnabled: true\n      httpLoggingEnabled: true\n      requestTracingEnabled: true\n      ftpsState: 'Disabled'\n      minTlsVersion: '1.2'\n    }\n  }\n}\n\nresource ftpPolicySlotFrontend 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'ftp'\n  location: location\n  kind: 'string'\n  parent: webAppSlotFrontend\n  properties: {\n    allow: false\n  }\n}\n\nresource scmPolicySlotFrontend 'Microsoft.Web/sites/slots/basicPublishingCredentialsPolicies@2022-03-01' = {\n  name: 'scm'\n  location: location\n  kind: 'string'\n  parent: webAppSlotFrontend\n  properties: {\n    allow: false\n  }\n}\n\nresource webAppBindingBackend 'Microsoft.Web/sites/hostNameBindings@2019-08-01' = {\n  name: '${webAppBackend.name}${webappDnsName}'\n  parent: webAppBackend\n  properties: {\n    siteName: webAppBackend.name\n    hostNameType: 'Verified'\n  }\n}\n\nresource webAppBindingFrontend 'Microsoft.Web/sites/hostNameBindings@2019-08-01' = {\n  name: '${webAppFrontend.name}${webappDnsName}'\n  parent: webAppFrontend\n  properties: {\n    siteName: webAppFrontend.name\n    hostNameType: 'Verified'\n  }\n}\n\nresource privateEndpoint 'Microsoft.Network/privateEndpoints@2020-06-01' = {\n  name: privateEndpointName\n  location: location\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, subnetNamePrivateEndpoint)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: privateLinkConnectionName\n        properties: {\n          privateLinkServiceId: webAppBackend.id\n          groupIds: [\n            'sites'\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource privateEndpointSlot 'Microsoft.Network/privateEndpoints@2020-06-01' = {\n  name: privateEndpointSlotName\n  location: location\n  dependsOn: [\n    webAppSlotBackend\n  ]\n  properties: {\n    subnet: {\n      id: resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetwork.name, subnetNamePrivateEndpoint)\n    }\n    privateLinkServiceConnections: [\n      {\n        name: privateLinkConnectionSlotName\n        properties: {\n          privateLinkServiceId: webAppBackend.id\n          groupIds: [\n            'sites-stage'\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource privateDnsZones 'Microsoft.Network/privateDnsZones@2018-09-01' = {\n  name: privateDNSZoneName\n  location: 'global'\n  dependsOn: [\n    virtualNetwork\n  ]\n}\n\nresource privateDnsZoneLink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2018-09-01' = {\n  name: '${privateDnsZones.name}-link'\n  parent: privateDnsZones\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetwork.id\n    }\n  }\n}\n\nresource privateDnsZoneGroup 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2020-03-01' = {\n  name: 'dnsgroupname'\n  parent: privateEndpoint\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config1'\n        properties: {\n          privateDnsZoneId: privateDnsZones.id\n        }\n      }\n    ]\n  }\n}\n\nresource privateDnsZoneGroupSlot 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2020-03-01' = {\n  name: 'slotdnsgroupname'\n  parent: privateEndpointSlot\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config2'\n        properties: {\n          privateDnsZoneId: privateDnsZones.id\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1355."}, {"role": "assistant", "content": "@description('Location for all resources.')\nparam location string = resourceGroup().location\n\n@description('Name of the WebApp')\nparam siteName string = 'AppService0001'\n\n@description('Address prefix for the Virtual Network')\nvar addressPrefix  = '10.0.0.0/16'\n\n@description('Subnet prefix of the App Gateway')\nvar AppGatewaySubnetPrefix  = '10.0.0.0/28'\n\n@description('Subnet prefix of the Private Endpoint of the Web App ')\nvar PrivateEndPointSubnetPrefix  = '10.0.1.0/28'\n\n@description('Name of your Private Endpoint')\nvar privateEndpoint_name  = '${siteName}-privateEndpoint'\n\n\n@allowed([\n  'B1'\n  'B2'\n  'B3'\n  'S1'\n  'S2'\n  'S3'\n  'P1v2'\n  'P2v2'\n  'P3v2'\n  'P1v3'\n  'P2v3'\n  'P3v3'\n])\nparam ASPSKU string = 'B1'\n\n@description('Name of the Subnet for PrivateEndpoint')\nvar PESubnetName  = '${siteName}-PeSubnet'\n\n@description('Link name between your Private Endpoint and your Web App')\nvar privateLinkConnection_name = '${siteName}-privatelinkconnection'\n\n@description('Name must be privatelink.azurewebsites.net')\nvar privateDNSZone_name = 'privatelink.azurewebsites.net'\n\n@description('Virtual Network Resouce Name')\nvar virtualNetworkNameResource = '${siteName}-virtualNetwork'\n\n@description('App Gateway Resource name')\nvar applicationGatewayNameResource = '${siteName}-agw'\n\n@description('Name of the Subnet for ApplicationGateway')\nvar subnetName = '${applicationGatewayNameResource}-appGatewaySubnet'\n\n@description('Public Ip Resource Name')\nvar publicIPAddressNameResource = '${siteName}-pip'\n\n@description('App Service Plan Resource name')\nvar hostingPlanNameResource = '${siteName}-serviceplan'\n\nvar subnetRef = resourceId('Microsoft.Network/virtualNetworks/subnets', virtualNetworkNameResource, subnetName)\nvar publicIPRef = publicIPAddressName.id\n\nresource publicIPAddressName 'Microsoft.Network/publicIPAddresses@2022-07-01' = {\n  name: publicIPAddressNameResource\n  location: location\n  properties: {\n    publicIPAllocationMethod: 'Static'\n  }\n  sku: {\n    name: 'Standard'\n  }\n}\n\nresource virtualNetworkName 'Microsoft.Network/virtualNetworks@2022-07-01' = {\n  name: virtualNetworkNameResource\n  location: location\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        addressPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: subnetName\n        properties: {\n          addressPrefix: AppGatewaySubnetPrefix\n        }\n      }, {\n        name: PESubnetName\n        properties: {\n          addressPrefix: PrivateEndPointSubnetPrefix\n        }\n      }\n    ]\n  }\n}\n\nresource ApplicationGateway 'Microsoft.Network/applicationGateways@2022-07-01' = {\n  name: applicationGatewayNameResource\n  location: location\n  properties: {\n    sku: {\n      name: 'Standard_v2'\n      tier: 'Standard_v2'\n      capacity: 2\n    }\n    gatewayIPConfigurations: [\n      {\n        name: 'appGatewayIpConfig'\n        properties: {\n          subnet: {\n            id: subnetRef\n          }\n        }\n      }\n    ]\n    frontendIPConfigurations: [\n      {\n        name: 'appGatewayFrontendIP'\n        properties: {\n          publicIPAddress: {\n            id: publicIPRef\n          }\n        }\n      }\n    ]\n    frontendPorts: [\n      {\n        name: 'appGatewayFrontendPort'\n        properties: {\n          port: 80\n        }\n      }\n    ]\n    backendAddressPools: [\n      {\n        name: 'appGatewayBackendPool'\n        properties: {\n          backendAddresses: [\n            {\n              ipAddress: AppService.properties.defaultHostName\n            }\n          ]\n        }\n      }\n    ]\n    backendHttpSettingsCollection: [\n      {\n        name: 'appGatewayBackendHttpSettings'\n        properties: {\n          port: 80\n          hostName: '${siteName}.azurewebsites.net'\n          protocol: 'Http'\n          cookieBasedAffinity: 'Disabled'\n          pickHostNameFromBackendAddress: false\n          probeEnabled: true\n          probe: {\n            id: resourceId('Microsoft.Network/applicationGateways/probes/', applicationGatewayNameResource, 'Probe1')\n          }\n        }\n      }\n    ]\n    httpListeners: [\n      {\n        name: 'appGatewayHttpListener'\n        properties: {\n          frontendIPConfiguration: {\n            id: resourceId('Microsoft.Network/applicationGateways/frontendIPConfigurations/', applicationGatewayNameResource, 'appGatewayFrontendIP')\n          }\n          frontendPort: {\n            id: resourceId('Microsoft.Network/applicationGateways/frontendPorts/', applicationGatewayNameResource, 'appGatewayFrontendPort')\n          }\n          protocol: 'Http'\n        }\n      }\n    ]\n    requestRoutingRules: [\n      {\n        name: 'rule1'\n        properties: {\n          priority: 100\n          ruleType: 'Basic'\n          httpListener: {\n            id: resourceId('Microsoft.Network/applicationGateways/httpListeners/', applicationGatewayNameResource, 'appGatewayHttpListener')\n          }\n          backendAddressPool: {\n            id: resourceId('Microsoft.Network/applicationGateways/backendAddressPools/', applicationGatewayNameResource, 'appGatewayBackendPool')\n          }\n          backendHttpSettings: {\n            id: resourceId('Microsoft.Network/applicationGateways/backendHttpSettingsCollection/', applicationGatewayNameResource, 'appGatewayBackendHttpSettings')\n          }\n        }\n      }\n    ]\n    probes: [\n      {\n        name: 'Probe1'\n        properties: {\n          protocol: 'Http'\n          path: '/'\n          interval: 30\n          timeout: 10\n          unhealthyThreshold: 3\n          minServers: 0\n          pickHostNameFromBackendHttpSettings: true\n        }\n      }\n    ]\n  }\n  dependsOn: [\n    virtualNetworkName\n\n  ]\n}\n\nresource hostingPlanName 'Microsoft.Web/serverfarms@2022-03-01' = {\n  name: hostingPlanNameResource\n  location: location\n  tags: {\n    displayName: 'HostingPlan'\n  }\n  sku: {\n    name: ASPSKU\n  }\n  kind: 'app'\n}\n\nresource AppService 'Microsoft.Web/sites@2022-03-01' = {\n  name: siteName\n  location: location\n  properties: {\n\n    serverFarmId: hostingPlanName.id\n  }\n}\n\nresource PrivateEndpoint 'Microsoft.Network/privateEndpoints@2022-07-01' = {\n  name: privateEndpoint_name\n  location: location\n  properties: {\n    subnet: {\n      id: virtualNetworkName.properties.subnets[1].id\n    }\n    privateLinkServiceConnections: [\n      {\n        name: privateLinkConnection_name\n        properties: {\n          privateLinkServiceId: AppService.id\n          groupIds: [\n            'sites'\n          ]\n        }\n      }\n    ]\n  }\n}\n\nresource privateDNSZone 'Microsoft.Network/privateDnsZones@2020-06-01' = {\n  name: privateDNSZone_name\n  location: 'global'\n  dependsOn: [\n    virtualNetworkName\n  ]\n}\n\nresource privateDNSZonePrivateDNSZonelink 'Microsoft.Network/privateDnsZones/virtualNetworkLinks@2020-06-01' = {\n  parent: privateDNSZone\n  name: '${privateDNSZone_name}-link'\n  location: 'global'\n  properties: {\n    registrationEnabled: false\n    virtualNetwork: {\n      id: virtualNetworkName.id\n    }\n  }\n}\n\nresource privateEndpointDnsGroupname 'Microsoft.Network/privateEndpoints/privateDnsZoneGroups@2022-07-01' = {\n  parent: PrivateEndpoint\n  name: 'dnsgroupname'\n  properties: {\n    privateDnsZoneConfigs: [\n      {\n        name: 'config1'\n        properties: {\n          privateDnsZoneId: privateDNSZone.id\n        }\n      }\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1356."}, {"role": "assistant", "content": "targetScope = 'subscription'\n\n@description('Specify the name of the resource group in which the newrelic resource will be created')\nparam resourceGroupName string\n\n@description('Specify a name for the NewRelic resource')\nparam resourceName string\n\n@description('Specify the region for the monitor resource')\n@allowed([\n  'eastus'\n  'centraluseuap'\n  'eastus2euap'\n])\nparam location string = 'eastus'\n\n@description('Provide your first name (same as that setup as subscription owner on Azure)')\nparam firstName string\n\n@description('Provide your last name (same as that setup as subscription owner on Azure)')\nparam lastName string\n\n@description('Provide your work email address (same as that setup as subscription owner on Azure)')\nparam emailAddress string\n\nvar guidValue = guid(deployment().name, 'newrelic')\nvar monitorDeploymentName = 'NewRelicMonitor_${substring(guidValue, 0, 8)}'\nvar roleAssignmentName = guidValue\n\nmodule monitorDeployment './nested_monitorDeployment.bicep' = {\n  name: monitorDeploymentName\n  scope: resourceGroup(resourceGroupName)\n  params: {\n    resourceName: resourceName\n    location: location\n    emailAddress: emailAddress\n    firstName: firstName\n    lastName: lastName\n    tagRulesProperties: {\n      logRules: {\n        sendAadLogs: 'Disabled'\n        sendSubscriptionLogs: 'Disabled'\n        sendActivityLogs: 'Enabled'\n        filteringTags: []\n      }\n      metricRules: {\n        sendMetrics: 'Enabled'\n        filteringTags: []\n        userEmail: emailAddress\n      }\n    }\n  }\n}\n\nresource monitoringReaderRoleDefinition 'Microsoft.Authorization/roleDefinitions@2022-04-01' existing = {\n  scope: subscription()\n  name: '43d0d8ad-25c7-4714-9337-8ba259a9fe05' //Azure monitor reader role\n}\n\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: roleAssignmentName\n  properties: {\n    roleDefinitionId: monitoringReaderRoleDefinition.id\n    principalId: monitorDeployment.outputs.monitorPrincipalId\n    principalType: 'ServicePrincipal'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1357."}, {"role": "assistant", "content": "param resourceName string\nparam location string\nparam emailAddress string\nparam firstName string\nparam lastName string\nparam tagRulesProperties object\nparam monitorTags object = {}\nparam effectiveDate string = utcNow('yyyy-MM-ddTHH:mm:ssZ')\n\nresource monitor 'NewRelic.Observability/monitors@2022-07-01' = {\n  name: resourceName\n  location: location\n  properties: {\n    planData: {\n      usageType: 'PAYG'\n      billingCycle: 'MONTHLY'\n      planDetails: 'newrelic-pay-as-you-go-free-live@TIDgmz7xq9ge3py@PUBIDnewrelicinc1635200720692.newrelic_liftr_payg'\n      effectiveDate: effectiveDate\n    }\n    userInfo: {\n      firstName: firstName\n      lastName: lastName\n      emailAddress: emailAddress\n      phoneNumber: ''\n    }\n  }\n  tags: monitorTags\n  identity: {\n    type: 'SystemAssigned'\n  }\n}\n\nresource resourceName_default 'NewRelic.Observability/monitors/tagRules@2022-07-01' = {\n  parent: monitor\n  name: 'default'\n  properties: tagRulesProperties\n}\n\noutput monitorPrincipalId string = monitor.identity.principalId\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1358 please."}, {"role": "assistant", "content": "targetScope = 'subscription'\n\n@description('Name of the resource group to create.')\nparam rgName string\n\n@description('Azure Region the resource group will be created in.')\nparam rgLocation string = deployment().location\n\nresource resourceGroup 'Microsoft.Resources/resourceGroups@2022-09-01' = {\n  name: rgName\n  location: rgLocation\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1359?"}, {"role": "assistant", "content": "targetScope = 'resourceGroup'\n\n@description('principalId of the user that will be given contributor access to the resourceGroup')\nparam principalId string\n\n@description('roleDefinition to apply to the resourceGroup - default is contributor')\nparam roleDefinitionId string\n\n@description('Unique name for the roleAssignment in the format of a guid')\nparam roleAssignmentName string\n\nresource dontDeleteLock 'Microsoft.Authorization/locks@2016-09-01' = {\n  name: 'DontDelete'\n  properties: {\n    level: 'CanNotDelete'\n    notes: 'Prevent deletion of the resourceGroup'\n  }\n}\n\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2020-04-01-preview' = {\n  name: guid(roleAssignmentName)\n  properties: {\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', roleDefinitionId)\n    principalId: principalId\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1360."}, {"role": "assistant", "content": "targetScope = 'subscription'\n\n@description('Name of the resourceGroup to create')\nparam rgName string\n\n@description('Location for the resourceGroup')\nparam rgLocation string\n\n@description('principalId of the user that will be given contributor access to the resourceGroup')\nparam principalId string\n\n@description('roleDefinition to apply to the resourceGroup - default is contributor')\nparam roleDefinitionId string = 'b24988ac-6180-42a0-ab88-20f7382dd24c'\n\n@description('Unique name for the roleAssignment in the format of a guid')\nparam roleAssignmentName string = guid(principalId, roleDefinitionId, rgName)\n\nresource newRg 'Microsoft.Resources/resourceGroups@2019-10-01' = {\n  name: rgName\n  location: rgLocation\n  tags: {\n    Note: 'subscription level deployment'\n  }\n  properties: {}\n}\n\nmodule applyLock './applylock.bicep' = {\n  scope: newRg\n  name: 'applyLock'\n  params: {\n    principalId: principalId\n    roleDefinitionId: roleDefinitionId\n    roleAssignmentName: roleAssignmentName\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1361?"}, {"role": "assistant", "content": "targetScope = 'subscription'\n\n@description('Array of actions for the roleDefinition')\nparam actions array = [\n  'Microsoft.Resources/subscriptions/resourceGroups/read'\n]\n\n@description('Array of notActions for the roleDefinition')\nparam notActions array = []\n\n@description('Friendly name of the role definition')\nparam roleName string = 'Custom Role - RG Reader'\n\n@description('Detailed description of the role definition')\nparam roleDescription string = 'Subscription Level Deployment of a Role Definition'\n\nvar roleDefName = guid(roleName)\n\nresource roleDef 'Microsoft.Authorization/roleDefinitions@2022-04-01' = {\n  name: roleDefName\n  properties: {\n    roleName: roleName\n    description: roleDescription\n    type: 'customRole'\n    permissions: [\n      {\n        actions: actions\n        notActions: notActions\n      }\n    ]\n    assignableScopes: [\n      subscription().id\n    ]\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1362."}, {"role": "assistant", "content": "// deployment uses a 'subscription' target scope in order to create resource group and policy\ntargetScope = 'subscription'\n\n/*** PARAMETERS ***/\n\n@description('The resource group name where the AVNM and VNET resources will be created')\nparam resourceGroupName string = 'rg-avnm-sample'\n\n@description('The location of this regional hub. All resources, including spoke resources, will be deployed to this region.')\n@minLength(6)\nparam location string\n\n// Connectivity Topology Options:\n//\n// Mesh: connects both the spokes and hub VNETs using a Connected Group mesh. WARNING: connected group connectivity does not propagate gateway routes from the hub to spokes, requiring route tables with UDRs!\n// Hub and Spoke: connected the spokes to the hub using VNET Peering. Spoke-to-spoke connectivity will need to be routed throug an NVA in the hub, requiring UDRs and an NVA (not part of this sample)\n// Mesh with Hub and Spoke: connects spoke VNETs to eachover with a connected group mesh; connects spokes to the hub with traditional peering. \n//\n@description('Defines how spokes will connect to each other and how spokes will connect the hub. Valid values: \"mesh\", \"hubAndSpoke\", \"meshWithHubAndSpoke\"; default value: \"meshWithHubAndSpoke\"')\n@allowed(['mesh','hubAndSpoke','meshWithHubAndSpoke'])\nparam connectivityTopology string = 'meshWithHubAndSpoke'\n\n// Network Group Membership Options:\n//\n// Static: Only the VNET IDs specified in the Network Group are part of the Connectivity Configurations\n// Dynamic: Network Group membership is dynamic using Azure Policy, adding and removing Network Group members based on Policy rules\n//\n@description('Connectivity group membership type. Valid values: \"static\", \"dynamic\"; default: \"static\"')\n@allowed(['static','dynamic'])\nparam networkGroupMembershipType string = 'static'\n\n/*** RESOURCE GROUP ***/\nresource resourceGroup 'Microsoft.Resources/resourceGroups@2022-09-01' = {\n  name: resourceGroupName\n  location: location\n}\n\n/*** RESOURCES (HUB) ***/\n\nmodule hub 'modules/hub.bicep' = {\n  name: 'vnet-hub'\n  scope: resourceGroup\n  params: {\n    location: location\n    connectivityTopology: connectivityTopology\n  }\n}\n\n/*** RESOURCES (SPOKE A) ***/\nmodule spokeA 'modules/spoke.bicep' = {\n  name: 'vnet-spokeA'\n  scope: resourceGroup\n  params: {\n    location: location\n    spokeName: 'spokeA'\n    spokeVnetPrefix: '10.100.0.0/22'\n  }\n}\n\n/*** RESOURCES (SPOKE B) ***/\nmodule spokeB 'modules/spoke.bicep' = {\n  name: 'vnet-spokeB'\n  scope: resourceGroup\n  params: {\n    location: location\n    spokeName: 'spokeB'\n    spokeVnetPrefix: '10.101.0.0/22'\n  }\n}\n\n/*** RESOURCES (SPOKE C) ***/\nmodule spokeC 'modules/spoke.bicep' = {\n  name: 'vnet-spokeC'\n  scope: resourceGroup\n  params: {\n    location: location\n    spokeName: 'spokeC'\n    spokeVnetPrefix: '10.102.0.0/22'\n  }\n}\n\n/*** RESOURCES (SPOKE D) - this VNET is left out of the Connected Group ***/\nmodule spokeD 'modules/spoke.bicep' = {\n  name: 'vnet-spokeD'\n  scope: resourceGroup\n  params: {\n    location: location\n    spokeName: 'spokeD'\n    spokeVnetPrefix: '10.103.0.0/22'\n  }\n}\n\n/*** Dynamic Membership Policy ***/\nmodule policy 'modules/dynMemberPolicy.bicep' = if (networkGroupMembershipType == 'dynamic') {\n  name: 'policy'\n  scope: subscription()\n  params: {\n    networkGroupId: avnm.outputs.networkGroupId\n    resourceGroupName: resourceGroupName\n  }\n}\n\n/*** AZURE VIRTUAL NETWORK MANAGER RESOURCES ***/\nmodule avnm 'modules/avnm.bicep' = {\n  name: 'avnm'\n  scope: resourceGroup\n  params: {\n    location: location\n    hubVnetId: hub.outputs.hubVnetId\n    spokeNetworkGroupMembers: [\n      spokeA.outputs.vnetId\n      spokeB.outputs.vnetId\n      spokeC.outputs.vnetId\n      spokeD.outputs.vnetId\n    ]\n    connectivityTopology: connectivityTopology\n    networkGroupMembershipType: networkGroupMembershipType\n  }\n}\n\n//\n// In order to deploy a Connectivity or Security configruation, the /commit endpoint must be called or a Deployment created in the Portal. \n// This DeploymentScript resource executes a PowerShell script which calls the /commit endpoint and monitors the status of the deployment.\n//\nmodule deploymentScriptConnectivityConfigs 'modules/avnmDeploymentScript.bicep' = {\n  name: 'ds-${location}-connectivityconfigs'\n  scope: resourceGroup\n  dependsOn: [\n    policy\n  ]\n  params: {\n    location: location\n    userAssignedIdentityId: avnm.outputs.userAssignedIdentityId\n    configurationId: avnm.outputs.connectivityConfigurationId\n    configType: 'Connectivity'\n    networkManagerName: avnm.outputs.networkManagerName\n    deploymentScriptName: 'ds-${location}-connectivityconfigs'\n  }\n}\n\n// output policy resource ids to facilitate cleanup\noutput policyDefinitionId string = (networkGroupMembershipType == 'dynamic') ? policy.outputs.policyDefinitionId : 'not_deployed'\noutput policyAssignmentId string = (networkGroupMembershipType == 'dynamic') ? policy.outputs.policyAssignmentId : 'not_deployed'\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1363."}, {"role": "assistant", "content": "param location string\nparam spokeNetworkGroupMembers array\nparam hubVnetId string\nparam connectivityTopology string\nparam networkGroupMembershipType string\n\n// only these spoke VNETs will be added to the static Network Group\nvar groupedVNETs = [\n  'vnet-${location}-spokea'\n  'vnet-${location}-spokeb'\n  'vnet-${location}-spokec'\n]\n\n@description('This is the Azure Virtual Network Manager which will be used to implement the connected group for spoke-to-spoke connectivity.')\nresource networkManager 'Microsoft.Network/networkManagers@2022-09-01' = {\n  name: 'avnm-${location}'\n  location: location\n  properties: {\n    networkManagerScopeAccesses: [\n      'Connectivity'\n    ]\n    networkManagerScopes: {\n      subscriptions: [\n        '/subscriptions/${subscription().subscriptionId}'\n      ]\n      managementGroups: []\n    }\n  }\n}\n\n@description('This is the static network group for the spoke VNETs, and hub when topology is mesh.')\nresource networkGroupSpokesStatic 'Microsoft.Network/networkManagers/networkGroups@2022-09-01' = if (networkGroupMembershipType == 'static') {\n  name: 'ng-${location}-static'\n  parent: networkManager\n  properties: {\n    description: 'Network Group - Static'\n  }\n\n  // add spoke vnets A, B, and C to the static network group\n  resource staticMemberSpoke 'staticMembers@2022-09-01' = [for spokeMember in spokeNetworkGroupMembers: if (contains(groupedVNETs,last(split(spokeMember,'/')))) {\n    name: 'sm-${(last(split(spokeMember, '/')))}'\n    properties: {\n      resourceId: spokeMember\n    }\n  }]\n\n  // add hub if connectivity topology is 'mesh' (otherwise, hub is connected via hub and spoke peering)\n  resource staticMemberHub 'staticMembers@2022-09-01' = if (connectivityTopology == 'mesh') {\n    name: 'sm-${(toLower(last(split(hubVnetId, '/'))))}'\n    properties: {\n      resourceId: hubVnetId\n    }\n  }\n}\n\n@description('This is the dynamic group for spoke VNETs.')\nresource networkGroupSpokesDynamic 'Microsoft.Network/networkManagers/networkGroups@2022-09-01' = if (networkGroupMembershipType == 'dynamic') {\n  name: 'ng-${location}-dynamic'\n  parent: networkManager\n  properties: {\n    description: 'Network Group - Dynamic'\n  }\n}\n\n// Connectivity Topology: mesh\n//\n// Spoke 'A' VM Effective routes\n// Source    State    Address Prefix               Next Hop Type    Next Hop IP\n// --------  -------  ---------------------------  ---------------  -------------\n// Default   Active   10.100.0.0/22                VnetLocal\n// Default   Active   10.0.0.0/22 10.102.0.0/22 10.101.0.0/22  ConnectedGroup\n// Default   Active   0.0.0.0/0                    Internet\n// ...\n@description('This connectivity configuration defines the connectivity between VNETs using Direct Connection. The hub will be part of the mesh, but gateway routes from the hub will not propagate to spokes.')\nresource connectivityConfigurationMesh 'Microsoft.Network/networkManagers/connectivityConfigurations@2022-09-01' = if (connectivityTopology == 'mesh') {\n  name: 'cc-${location}-spokes-mesh'\n  parent: networkManager\n  properties: {\n    description: 'Spoke-to-spoke connectivity configuration'\n    appliesToGroups: [\n      {\n        networkGroupId: (networkGroupMembershipType == 'static') ? networkGroupSpokesStatic.id : networkGroupSpokesDynamic.id\n        isGlobal: 'False'\n        useHubGateway: 'False'\n        groupConnectivity: 'DirectlyConnected'\n      }\n    ]\n    connectivityTopology: 'Mesh'\n    deleteExistingPeering: 'True'\n    hubs: []\n    isGlobal: 'False'\n  }\n}\n\n// Connectivity Topology: mesh with hub and spoke\n//\n// Spoke 'A' VM Effective routes\n// Source    State    Address Prefix               Next Hop Type    Next Hop IP\n// --------  -------  ---------------------------  ---------------  -------------\n// Default   Active   10.100.0.0/22                VnetLocal\n// Default   Active   10.0.0.0/22                  VNetPeering\n// Default   Active   10.102.0.0/22 10.101.0.0/22  ConnectedGroup\n// Default   Active   0.0.0.0/0                    Internet\n// ...\n@description('This connectivity configuration defines the connectivity between the spokes using Hub and Spoke - traffic flow through hub requires an NVA to route it.')\nresource connectivityConfigurationMeshWithHubAndSpoke 'Microsoft.Network/networkManagers/connectivityConfigurations@2022-09-01' = if (connectivityTopology == 'meshWithHubAndSpoke') {\n  name: 'cc-${location}-meshwithhubandspoke'\n  parent: networkManager\n  properties: {\n    description: 'Spoke-to-spoke connectivity configuration'\n    appliesToGroups: [\n      {\n        networkGroupId: (networkGroupMembershipType == 'static') ? networkGroupSpokesStatic.id : networkGroupSpokesDynamic.id\n        isGlobal: 'False'\n        useHubGateway: 'False' // cannot be true unless hub has a gateway deployed\n        groupConnectivity: 'DirectlyConnected'\n      }\n    ]\n    connectivityTopology: 'HubAndSpoke'\n    deleteExistingPeering: 'True'\n    hubs: [\n      {\n        resourceId: hubVnetId\n        resourceType: 'Microsoft.Network/virtualNetworks'\n      }\n    ]\n    isGlobal: 'False'\n  }\n}\n\n// Connectivity Topology: hub and spoke\n//\n// Spoke 'A' VM Effective routes\n// Source    State    Address Prefix               Next Hop Type    Next Hop IP\n// --------  -------  ---------------------------  ---------------  -------------\n// Default   Active   10.100.0.0/22                VnetLocal\n// Default   Active   10.0.0.0/22                  VNetPeering\n// Default   Active   0.0.0.0/0                    Internet\n// ...\n@description('This connectivity configuration defines the connectivity between the spokes using Hub and Spoke - traffic flow through hub requires an NVA to route it.')\nresource connectivityConfigurationHubAndSpoke 'Microsoft.Network/networkManagers/connectivityConfigurations@2022-09-01' = if (connectivityTopology == 'hubAndSpoke') {\n  name: 'cc-${location}-hubandspoke'\n  parent: networkManager\n  properties: {\n    description: 'Spoke-to-spoke connectivity configuration'\n    appliesToGroups: [\n      {\n        networkGroupId: (networkGroupMembershipType == 'static') ? networkGroupSpokesStatic.id : networkGroupSpokesDynamic.id\n        isGlobal: 'False'\n        useHubGateway: 'False'\n        groupConnectivity: 'None'\n      }\n    ]\n    connectivityTopology: 'HubAndSpoke'\n    deleteExistingPeering: 'True'\n    hubs: [\n      {\n        resourceId: hubVnetId\n        resourceType: 'Microsoft.Network/virtualNetworks'\n      }\n    ]\n    isGlobal: 'False'\n  }\n}\n\n@description('This user assigned identity is used by the Deployment Script resource to interact with Azure resources.')\nresource userAssignedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2022-01-31-preview' = {\n  name: 'uai-${location}'\n  location: location\n}\n\n@description('This role assignment grants the user assigned identity the Contributor role on the resource group.')\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {\n  name: guid(resourceGroup().id, userAssignedIdentity.name)\n  properties: {\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c') // Contributor: b24988ac-6180-42a0-ab88-20f7382dd24c\n    principalId: userAssignedIdentity.properties.principalId\n    principalType: 'ServicePrincipal'\n  }\n}\n\noutput networkManagerName string = networkManager.name\noutput userAssignedIdentityId string = userAssignedIdentity.id\noutput connectivityConfigurationId string =  (connectivityTopology == 'meshWithHubAndSpoke') ? connectivityConfigurationMeshWithHubAndSpoke.id : (connectivityTopology == 'hubAndSpoke') ? connectivityConfigurationHubAndSpoke.id : connectivityConfigurationMesh.id\noutput networkGroupId string = networkGroupSpokesDynamic.id ?? networkGroupSpokesStatic.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need help creating a classic Bicep template for non-AVM infrastructure. Can you provide guidance for case 1364?"}, {"role": "assistant", "content": "param location string\nparam userAssignedIdentityId string\nparam networkManagerName string\nparam configurationId string\nparam deploymentScriptName string\n@allowed([\n  'Connectivity'\n])\nparam configType string\n\n// the commit action is idempotent, so re-running the deployment will not cause any issues\n@description('Create a Deployment Script resource to perform the commit/deployment of the Network Manager connectivity configuration.')\nresource deploymentScript 'Microsoft.Resources/deploymentScripts@2020-10-01' = {\n  name: deploymentScriptName\n  location: location\n  kind: 'AzurePowerShell'\n  identity: {\n    type: 'UserAssigned'\n    userAssignedIdentities: {\n      '${userAssignedIdentityId}': {}\n    }\n  }\n  properties: {\n    azPowerShellVersion: '8.3'\n    retentionInterval: 'PT1H'\n    timeout: 'PT1H'\n    arguments: '-networkManagerName \"${networkManagerName}\" -targetLocations ${location} -configIds ${configurationId} -subscriptionId ${subscription().subscriptionId} -configType ${configType} -resourceGroupName ${resourceGroup().name}'\n    scriptContent: '''\n    param (\n      # AVNM subscription id\n      [parameter(mandatory=$true)][string]$subscriptionId,\n\n      # AVNM resource name\n      [parameter(mandatory=$true)][string]$networkManagerName,\n\n      # string with comma-separated list of config ids to deploy. ids must be of the same config type\n      [parameter(mandatory=$true)][string[]]$configIds,\n\n      # string with comma-separated list of deployment target regions\n      [parameter(mandatory=$true)][string[]]$targetLocations,\n\n      # configuration type to deploy. must be either connecticity or securityadmin\n      [parameter(mandatory=$true)][ValidateSet('Connectivity','SecurityAdmin','Routing')][string]$configType,\n\n      # AVNM resource group name\n      [parameter(mandatory=$true)][string]$resourceGroupName\n    )\n  \n    $null = Login-AzAccount -Identity -Subscription $subscriptionId\n  \n    [System.Collections.Generic.List[string]]$configIdList = @()  \n    $configIdList.addRange($configIds) \n    [System.Collections.Generic.List[string]]$targetLocationList = @() # target locations for deployment\n    $targetLocationList.addRange($targetLocations)     \n    \n    $deployment = @{\n        Name = $networkManagerName\n        ResourceGroupName = $resourceGroupName\n        ConfigurationId = $configIdList\n        TargetLocation = $targetLocationList\n        CommitType = $configType\n    }\n  \n    try {\n      Deploy-AzNetworkManagerCommit @deployment -ErrorAction Stop\n    }\n    catch {\n      Write-Error \"Deployment failed with error: $_\"\n      throw \"Deployment failed with error: $_\"\n    }\n    '''\n    }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Show me a classic Bicep template for non-AVM deployment without Azure Verified Modules. This is for use case 1365."}, {"role": "assistant", "content": "targetScope = 'subscription'\n\nparam networkGroupId string\nparam resourceGroupName string\n\n@description('This is a Policy definition for dyanamic group membership')\nresource policyDefinition 'Microsoft.Authorization/policyDefinitions@2021-06-01' = {\n  name: uniqueString(networkGroupId)\n  properties: {\n    description: 'AVNM quickstart dynamic group membership Policy'\n    displayName: 'AVNM quickstart dynamic group membership Policy'\n    mode: 'Microsoft.Network.Data'\n    policyRule: {\n      if: {\n        allof: [\n          {\n            field: 'type'\n            equals: 'Microsoft.Network/virtualNetworks'\n          }\n          {\n            // virtual networks must have a tag where the key is '_avnm_quickstart_deployment'\n            field: 'tags[_avnm_quickstart_deployment]'\n            exists: true\n          }\n          {\n            // virtual network ids must include this sample's resource group ID - limiting the chance that dynamic membership impacts other vnets in your subscriptions\n            field: 'id'\n            like: '${subscription().id}/resourcegroups/${resourceGroupName}/*'\n          }\n        ]\n      }\n      then: {\n        // 'addToNetworkGroup' is a special effect used by AVNM network groups\n        effect: 'addToNetworkGroup'\n        details: {\n          networkGroupId: networkGroupId\n        }\n      }\n    }\n  }\n}\n\n// once assigned, the policy will evaluate as new VNETs are created and on a special evaluation cycle for AVNM, enabling quick dynamic group updates\n@description('Assigns above policy for dynamic group membership')\nresource policyAssignment 'Microsoft.Authorization/policyAssignments@2022-06-01' = {\n  name: uniqueString(networkGroupId)\n  properties: {\n    description: 'AVNM quickstart dynamic group membership Policy'\n    displayName: 'AVNM quickstart dynamic group membership Policy'\n    enforcementMode: 'Default'\n    policyDefinitionId: policyDefinition.id\n  }\n}\n\noutput policyDefinitionId string = policyDefinition.id\noutput policyAssignmentId string = policyAssignment.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I want a classic Bicep solution for non-AVM infrastructure that avoids AVM patterns. Help with template 1366."}, {"role": "assistant", "content": "param location string\nparam connectivityTopology string\n\n@description('The regional hub network.')\nresource vnetHub 'Microsoft.Network/virtualNetworks@2022-01-01' = {\n  name: 'vnet-${location}-hub'\n  location: location\n  // add tag to include hub vnet in the connected group mesh only when connectivity topology is 'mesh'\n  tags: (connectivityTopology == 'mesh') ? {\n    _avnm_quickstart_deployment: 'hub'\n  } : {}\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        '10.0.0.0/22'\n      ]\n    }\n    subnets: [\n      {\n        name: 'AzureBastionSubnet'\n        properties: {\n          addressPrefix: '10.0.1.0/26'\n        }\n      }\n      {\n        name: 'GatewaySubnet'\n        properties: {\n          addressPrefix: '10.0.2.0/27'\n        }\n      }\n      {\n        name: 'AzureFirewallSubnet'\n        properties: {\n          addressPrefix: '10.0.3.0/26'\n        }\n      }\n      {\n        name: 'AzureFirewallManagementSubnet'\n        properties: {\n          addressPrefix: '10.0.3.64/26'\n        }\n      }\n      {\n        name: 'default'\n        properties: {\n          addressPrefix: '10.0.3.128/25'\n        }\n      }\n    ]\n  }\n}\n\noutput hubVnetId string = vnetHub.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you provide a classic Bicep example for non-AVM deployment using traditional approaches? This is scenario 1367."}, {"role": "assistant", "content": "param location string\nparam spokeName string \nparam spokeVnetPrefix string\n\n// only these VNETs are tagged and will be added to the dynamic Network Group by Policy\nvar taggedVNETs = [\n  'spokeA'\n  'spokeB'\n  'spokeC'\n]\n\nresource vnet 'Microsoft.Network/virtualNetworks@2022-01-01' = {\n  name: 'vnet-${location}-${toLower(spokeName)}'\n  location: location\n  // add tags to the vnet names in variable tagged vnets - for dynamic group membership\n  tags: contains(taggedVNETs,spokeName) ? {\n    _avnm_quickstart_deployment: 'spoke'\n  } : {}\n  properties: {\n    addressSpace: {\n      addressPrefixes: [\n        spokeVnetPrefix\n      ]\n    }\n    subnets: [\n      {\n        name: 'default'\n        properties: {\n          addressPrefix: replace(spokeVnetPrefix, '.0.0/22', '.1.0/24')\n        }\n      }\n    ]\n  }\n}\n\noutput vnetId string = vnet.id\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Need a classic Bicep template for non-AVM solution without Azure Verified Modules. Template 1368 please."}, {"role": "assistant", "content": "targetScope = 'subscription'\n\n@description('principalId if the user that will be given contributor access to the resourceGroup')\nparam principalId string\n\n@description('roleDefinition for the assignment - default is contributor')\nparam roleDefinitionId string = 'b24988ac-6180-42a0-ab88-20f7382dd24c'\n\n// this creates an idempotent GUID for the role assignment\nvar roleAssignmentName = guid(subscription().id, principalId, roleDefinitionId)\n\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2020-08-01-preview' = {\n  name: roleAssignmentName\n  properties: {\n    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', roleDefinitionId)\n    principalId: principalId\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I am looking for a classic Bicep approach for non-AVM deployment. Can you help with example 1369?"}, {"role": "assistant", "content": "targetScope = 'tenant'\n\n@description('principalId if the user that will be given contributor access to the tenant')\nparam principalId string\n\n@description('roleDefinition for the assignment - default is owner')\nparam roleDefinitionId string = '8e3af657-a8ff-443c-a75c-2fe8c4bcb635'\n\nvar roleAssignmentName = guid('/', principalId, roleDefinitionId)\n\nresource roleAssignment 'Microsoft.Authorization/roleAssignments@2020-03-01-preview' = {\n  name: roleAssignmentName\n  properties: {\n    roleDefinitionId: tenantResourceId('Microsoft.Authorization/roleDefinitions', roleDefinitionId)\n    principalId: principalId\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Help me create a classic Bicep template for non-AVM infrastructure without AVM patterns. Case 1370."}, {"role": "assistant", "content": "@description('p1 description')\nparam p1 string\n\nresource resource1 'Microsoft.Storage/storageAccounts@2021-01-01' = {\n  name: 'storageaccount1'\n  location: 'westus'\n  properties: {\n    allowBlobPublicAccess: true\n  }\n  kind: 'BlobStorage'\n  sku: {\n    name: 'Premium_LRS'\n  }\n}\n\nresource resource2 'Microsoft.Storage/storageAccounts@2021-01-01' = {\n  name: 'storageaccount2'\n  location: 'westus'\n  properties: {\n    allowBlobPublicAccess: true\n  }\n  kind: 'BlobStorage'\n  sku: {\n    name: 'Premium_LRS'\n  }\n}\n\nmodule module1a 'Module1.bicep' = {\n  name: 'myModule1a'\n}\n\nmodule module1b 'Module1.bicep' = {\n  name: 'myModule1b'\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "I need a classic Bicep template for a non-AVM infrastructure deployment. Can you help me with template 1371?"}, {"role": "assistant", "content": "module module2 'Module2.bicep' = {\n  name: 'mymodule2'\n  params: {\n    p2: 'p2 value'\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Can you show me a classic Bicep approach for non-AVM solution deployment without using Azure Verified Modules? This is for scenario 1372."}, {"role": "assistant", "content": "@description('p2 description')\nparam p2 string\n\nresource containerGroup 'Microsoft.ContainerInstance/containerGroups@2021-03-01' = {\n  name: 'name'\n  location: resourceGroup().location\n  properties: {\n    containers: [\n      {\n        name: 'containername'\n        properties: {\n          image: 'mcr.microsoft.com/azuredocs/aci-helloworld:latest'\n          ports: [\n            {\n              port: 80\n            }\n          ]\n          resources: {\n            requests: {\n              cpu: 1\n              memoryInGB: 4\n            }\n          }\n        }\n      }\n    ]\n    restartPolicy: 'OnFailure'\n    osType: 'Linux'\n    ipAddress: {\n      type: 'Public'\n      ports: [\n        {\n          protocol: 'TCP'\n          port: 80\n        }\n      ]\n    }\n  }\n}\n"}]}
{"messages": [{"role": "system", "content": "Generate an Azure Resource Manager (ARM) template in Bicep format according to the user's request."}, {"role": "user", "content": "Looking for a classic Bicep example for non-AVM deployment pattern. Need help with implementation 1373."}, {"role": "assistant", "content": "@description('p1 description')\nparam p1 string\n\nresource resource1 'Microsoft.Storage/storageAccounts@2021-01-01' = {\n  name: 'storageaccount1'\n  location: 'westus'\n  properties: {\n    allowBlobPublicAccess: true\n  }\n  kind: 'BlobStorage'\n  sku: {\n    name: 'Premium_LRS'\n  }\n}\n"}]}
